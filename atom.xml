<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æœ¨å­</title>
  <icon>https://blog.k8s.li/icon.png</icon>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://blog.k8s.li/"/>
  <updated>2020-04-16T16:00:00.000Z</updated>
  <id>https://blog.k8s.li/</id>
  
  <author>
    <name>æœ¨å­</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä¸€æ¬¡æœ‰è¶£çš„é¢è¯•ï¼šWordPress éƒ¨ç½²</title>
    <link href="https://blog.k8s.li/interview-wordpress-install.html"/>
    <id>https://blog.k8s.li/interview-wordpress-install.html</id>
    <published>2020-04-15T16:00:00.000Z</published>
    <updated>2020-04-16T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ”¶åˆ°ä¸€ä»½é¢è¯•é¢˜ï¼Œå†…å®¹çœ‹ä¼¼å¾ˆç®€å•ï¼š</p><blockquote><ol><li><p>CentOS7ï¼Œnginx æœ€æ–°ç‰ˆï¼Œphp 7.xï¼Œmysql ä¸åšè¦æ±‚ + wordpress</p></li><li><p>ä»¥æ–‡ä»¶çš„æ–¹å¼åˆ›å»ºå¹¶æŒ‚è½½2Gçš„swapåˆ†åŒº</p><p>è¯·æŠŠå­¦ä¹ è®°å½•ä»¥ URLï¼Œæˆªå›¾ç­‰æ–¹å¼ä¿ç•™ã€‚æœ€ç»ˆã€‚æˆ‘åœ¨æ‰‹æœºä¸Šå¯ä»¥çœ‹åˆ°wordpressç«™ç‚¹å°±å¥½ã€‚æ—¶é—´1å°æ—¶ä»¥å†…ï¼Œæ–¹æ³•æ–¹å¼ä¸é™</p></li></ol></blockquote><p>è™½ç„¶çœ‹èµ·æ¥å’Œç®€å•ï¼Œæ¯”å¦‚ç”¨ <code>docker-compose</code> ä¸€é”®å°±èƒ½å®Œæˆéƒ¨ç½²å®Œæˆï¼Œä¸è¿‡ä¸ºäº†æŠŠéƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜è¯¦ç»†åœ°è®°å½•ä¸‹æ¥ï¼Œä»¥åŠå‚è€ƒçš„ä¸€äº›æ–‡æ¡£ç­‰ï¼Œé€šè¿‡ä¸€ç¯‡æ­£å¼çš„åšå®¢å±•ç°å‡ºæ¥ï¼Œè¿™æ ·æ•ˆæœä¼šå¥½ä¸€äº›ã€‚åŒæ—¶å’±ä½œä¸ºå®Œç¾ä¸»ä¹‰è€…ï¼Œå¸Œæœ›ç»™å†åšä¸€äº›é¢å¤–çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚ HTTPS ï¼Œä»¥åŠä¸ä¹…å‰å’Œå’±ç»™åšå®¢åŠ çš„ Webp Server ğŸ˜‚ã€‚<a href="https://blog.k8s.li/oh-my-webpsh.html">è®©å›¾ç‰‡é£èµ·æ¥ oh-my-webp.sh ï¼</a> å’±æ¥æ¨é”€ <a href="https://github.com/webp-sh/webp_server_go" target="_blank" rel="noopener">Webp Server Go</a> å•¦ ï¼ˆå°å£°ã€‚</p><p>å¦å¤–æä¸€ç‚¹çš„æ˜¯ï¼Œå¦‚æœä½ æ·±å…¥ç†è§£ LNMP æŠ€æœ¯æ ˆçš„è¯ï¼Œè¿˜æ˜¯æ¨èä½¿ç”¨ä¼ ç»Ÿçš„æ–¹å¼æ¯”å¦‚ yum å®‰è£…æˆ–æºç ç¼–è¯‘å®‰è£…ï¼Œé‚£æ ·ä¼šèƒ½ç†è§£è¿™äº›æœåŠ¡ä¹‹é—´çš„å·¥ä½œæµç¨‹ï¼Œä¼šå¯¹æ•´ä¸ªç³»ç»Ÿæœ‰æ·±å…¥çš„äº†è§£ã€‚è€Œ <code>docker-compose</code> ç®€å•ç²—æš´çš„æ–¹å¼ä¸ºæˆ‘ä»¬å±è”½äº†è¿™äº›ç»†èŠ‚ï¼Œä¼šè®©æˆ‘ä»¬æ”¾å¼ƒå»æ€è€ƒè¿™äº›åº•å±‚çš„ç»†èŠ‚ï¼Œå¯¹äºæˆ‘ä»¬å­¦ä¹ è¿™é—¨æŠ€æœ¯æ ˆæ¥è®²ï¼Œè¿˜æ˜¯å¼Šå¤§äºåˆ©ã€‚ä¸è¿‡ä»Šå¤©ä¸ºäº†å¿«é€Ÿéƒ¨ç½²èµ·æ¥ï¼Œè¿˜æ˜¯é€‰ç”¨ docker-compose å§ğŸ˜‚</p><h2 id="WordPress"><a href="#WordPress" class="headerlink" title="WordPress"></a>WordPress</h2><blockquote><p>Get WordPress Use the software that powers over 35% of the web.</p></blockquote><p>WordPress æƒ³å¿…å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰å•¦ï¼Œæ¯•ç«Ÿæ”¶æ˜¯å…¨çƒå†…å®¹ç®¡ç†ç³»ç»Ÿé‡Œçš„è€å¤§å“¥ï¼Œå¸¸å¹´å æ®åœ¨ç¬¬ä¸€çš„ä½ç½®ï¼ˆå æœ‰ç‡ 35%ï¼‰ã€‚å®˜ç½‘ <a href="https://wordpress.org" target="_blank" rel="noopener">wordpress.org</a></p><h2 id="ä»»åŠ¡2-ä»¥æ–‡ä»¶çš„æ–¹å¼åˆ›å»ºå¹¶æŒ‚è½½2Gçš„swapåˆ†åŒº"><a href="#ä»»åŠ¡2-ä»¥æ–‡ä»¶çš„æ–¹å¼åˆ›å»ºå¹¶æŒ‚è½½2Gçš„swapåˆ†åŒº" class="headerlink" title="ä»»åŠ¡2 ä»¥æ–‡ä»¶çš„æ–¹å¼åˆ›å»ºå¹¶æŒ‚è½½2Gçš„swapåˆ†åŒº"></a>ä»»åŠ¡2 ä»¥æ–‡ä»¶çš„æ–¹å¼åˆ›å»ºå¹¶æŒ‚è½½2Gçš„swapåˆ†åŒº</h2><p>è¿™ä¸ªä»»åŠ¡ä¸ WordPress ä¸å¤ªç›¸å…³ï¼Œæ‰€ä»¥å°±å…ˆå®Œæˆè¿™ä¸ªã€‚æ‹¿åˆ°æœºå™¨å ssh ç™»å½•åˆ°ç³»ç»Ÿï¼Œå…ˆä½¿ç”¨å¸¸ç”¨çš„å‘½ä»¤çœ‹ä¸€ä¸‹æœåŠ¡å™¨çš„ä¿¡æ¯ï¼Œå¦å¤–åœ¨è‡ªå·±çš„åŸŸåä¸Šæ·»åŠ äº† A  è®°å½•<code>wordpress.k8s.li</code> åˆ°è¿™å°æœåŠ¡å™¨  IP ï¼Œå¹¶å¼€å¯ HTTPS ï¼Œé˜²æ­¢è¢« DDOS æ”»å‡»ï¼Œæ¯•ç«Ÿæœ‰ CloudFlare çš„ Anycast CDN ç»™æˆ‘ä»¬åœ¨å‰å¤´æ‰›ä¸€æŠŠğŸ˜‚è¿˜æ˜¯ä¸é”™æ»´ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@interview ~]# uname -a</span><br><span class="line">Linux interview 3.10.0-1062.12.1.el7.x86_64 #1 SMP Tue Feb 4 23:02:59 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line">[root@interview ~]# cat /proc/cpuinfo</span><br><span class="line">processor       : 0</span><br><span class="line">vendor_id       : GenuineIntel</span><br><span class="line">cpu family      : 6</span><br><span class="line">model           : 45</span><br><span class="line">model name      : Intel(R) Xeon(R) CPU E5-2670 0 @ 2.60GHz</span><br><span class="line">stepping        : 7</span><br><span class="line">microcode       : 0x710</span><br><span class="line">cpu MHz         : 2594.123</span><br><span class="line">cache size      : 20480 KB</span><br><span class="line">physical id     : 0</span><br><span class="line">siblings        : 1</span><br><span class="line">core id         : 0</span><br><span class="line">cpu cores       : 1</span><br><span class="line">apicid          : 0</span><br><span class="line">initial apicid  : 0</span><br><span class="line">fpu             : yes</span><br><span class="line">fpu_exception   : yes</span><br><span class="line">cpuid level     : 13</span><br><span class="line">wp              : yes</span><br><span class="line">flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat clflush mmx fxsr sse sse2 syscall nx rdtscp lm constant_tsc rep_good nopl eagerfpu pni pclmulqdq ssse3 cx16 sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes hypervisor lahf_lm</span><br><span class="line">bogomips        : 5187.68</span><br><span class="line">clflush size    : 64</span><br><span class="line">cache_alignment : 64</span><br><span class="line">address sizes   : 46 bits physical, 48 bits virtual</span><br><span class="line">power management:</span><br><span class="line"></span><br><span class="line">[root@interview ~]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           985M        150M        451M         12M        382M        680M</span><br><span class="line">Swap:            0B          0B          0B</span><br></pre></td></tr></table></figure><ul><li><code>uanme -a</code> æŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿçš„å†…æ ¸ç‰ˆæœ¬ ï¼Œ<code>3.10.0-1062</code> çš„å†…æ ¸çœ‹æ ·å­æ˜¯ CentOS7.7</li><li><code>cat /proc/cpuinfo</code> æŸ¥çœ‹ä¸€ä¸‹ CPU çš„ä¿¡æ¯ï¼ŒE5-2670 çš„ CPU ï¼Œå±äº Intel ç¬¬å…­ä»£ CPU ç³»åˆ—ã€‚</li><li><code>free</code> æŸ¥çœ‹ä¸€ä¸‹å†…å­˜çš„æƒ…å†µï¼Œ1GB çš„å°å†…å­˜ğŸ˜‚</li></ul><blockquote><p>Q2 ä»¥æ–‡ä»¶çš„æ–¹å¼åˆ›å»ºå¹¶æŒ‚è½½2Gçš„swapåˆ†åŒº</p></blockquote><p>è¿™ä¸ªé—®é¢˜æ¯”è¾ƒç®€å•ï¼Œä¹‹å‰è‡ªå·±çš„ GCE å°é¸¡ 512M å†…å­˜ä¸Šä¹Ÿæ˜¯ä½¿ç”¨æ–‡ä»¶çš„æ–¹å¼åˆ›å»º 1GB çš„äº¤æ¢åˆ†åŒºğŸ˜‚ã€‚æ‰€ä»¥å¯¹è¿™ä¸ªæ­¥éª¤æ—©å°±ç†Ÿè®°äºå¿ƒï¼Œå¹¶ä¸éœ€è¦æœç´¢å°±èƒ½æå®šğŸ˜‹ã€‚ä½¿ç”¨ dd å‘½ä»¤å³å¯ç”Ÿæˆä¸€ä¸ª 2GB å¤§å°çš„æ–‡ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@interview ~]# dd if&#x3D;&#x2F;dev&#x2F;zero of&#x3D;&#x2F;swapfile bs&#x3D;4M count&#x3D;500</span><br><span class="line">500+0 records in</span><br><span class="line">500+0 records out</span><br><span class="line">2097152000 bytes (2.1 GB) copied, 11.0648 s, 190 MB&#x2F;s</span><br></pre></td></tr></table></figure><p><code>2097152000 bytes (2.1 GB) copied, 11.0648 s, 190 MB/s</code> æ€ä¹ˆä¼šæ˜¯ 2.1 GB å‘¢ï¼Ÿï¼Œå¤šå‡ºæ¥ 0.1GB ï¼Œå¼ºè¿«ç—‡å—ä¸äº†ã€‚æƒ³èµ·æ¥äº†ï¼Œå¯èƒ½æ˜¯ <code>bs=4M</code> å‚æ•°çš„é—®é¢˜ã€‚äºæ˜¯æˆ‘åœ¨æˆ‘çš„ debian æœºå™¨ä¸Šæµ‹è¯•äº†ä¸€ä¸‹</p><p>é¡ºå¸¦ man ä¸€ä¸‹ dd çœ‹çœ‹ bs å‚æ•°æ˜¯æ€ä¹ˆå®šä¹‰çš„</p><blockquote><p>  bs=BYTES read and write up to BYTES bytes at a time (default: 512); overrides ibs and obs</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€debian@debian ~</span><br><span class="line">â•°â”€$ dd if=/dev/zero of=./test bs=4MB count=4</span><br><span class="line">4+0 records in</span><br><span class="line">4+0 records out</span><br><span class="line">16000000 bytes (16 MB, 15 MiB) copied, 0.0147078 s, 1.1 GB/s</span><br></pre></td></tr></table></figure><p>åŸå› æ˜¯æ–‡ä»¶å¤§å°å•ä½ä¸åŒï¼Œä¸€ä¸ªæ˜¯ <code>MB</code> å¦ä¸€ä¸ªæ˜¯ <code>MiB</code> ï¼Œåœ¨ Google ä¸Šæœç´¢äº†ä¸€ä¸‹ ã€‚çœ‹åˆ°ä¸Šçš„ä¸€ä¸ªå›ç­” <a href="https://www.quora.com/What-is-the-difference-between-1-MiB-and-1-MB-and-why-should-we-care" target="_blank" rel="noopener">What is the difference between 1 MiB and 1 MB and why should we care?</a> ã€‚ä¹Ÿæƒ³èµ·äº†å‰ä¸¤å¤©çœ‹åˆ° <a href="https://draveness.me/" target="_blank" rel="noopener">é¢å‘ä¿¡ä»°ç¼–ç¨‹</a> å¤§ä½¬çš„ä¸€ä¸ªæ¨æ–‡ï¼š</p><blockquote class="twitter-tweet"><p lang="zh" dir="ltr">æœ€è¿‘æ‰å‘ç° MB å’Œ MiB æ˜¯ä¸ä¸€æ ·çš„ï¼š<br><br>+ MiB æ˜¯ 1024 çš„å€æ•°<br>+ MB æ˜¯ 1000 çš„å€æ•°<br><br>Git ä¸‹è½½æ—¶çš„å•ä½æ˜¯ MiBï¼Œä½†æ˜¯ macOS é‡Œæ˜¾ç¤ºçš„ç¡®å® MBï¼Œéƒ¨åˆ†æœåŠ¡ä¼šæŠŠä¸¤è€…ç”¨æ··ï¼Œæ¯”å¦‚ DigitalOcean é‡Œçš„ S3 æœåŠ¡ï¼Œä¸‹è½½æ–‡ä»¶çš„æ—¶å€™æˆ‘è¿˜ä»¥ä¸ºåªä¸‹è½½äº†ä¸€éƒ¨åˆ†ğŸ˜‚ <a href="https://twitter.com/hashtag/%E5%86%B7%E7%9F%A5%E8%AF%86?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#å†·çŸ¥è¯†</a> <a href="https://t.co/U1IoRlgjXJ" target="_blank" rel="noopener">pic.twitter.com/U1IoRlgjXJ</a></p>&mdash; Draveness (@draven0xff) <a href="https://twitter.com/draven0xff/status/1249290829161590786?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">April 12, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>æ¥ä¸‹æ¥ä½¿ç”¨ <code>mkswap</code> å‘½ä»¤å°†åˆšåˆšåˆ›å»ºå¥½çš„ <code>/swapfile</code> æ–‡ä»¶æ ¼å¼åŒ–ä¸ºäº¤æ¢åˆ†åŒºæ‰€éœ€è¦çš„æ ¼å¼ï¼Œå¹¶ä¿®æ”¹ä¸€ä¸‹æ–‡ä»¶æƒé™ä¸º 600 ï¼Œå³åªèƒ½ç”± root ç”¨æˆ·è¯»ï¼Œä¸ç„¶é»˜è®¤çš„ 755 ä¼šè¢«å…¶ä»–ç”¨æˆ·çœ‹åˆ°ï¼Œè€Œé‡Œé¢çš„å†…å®¹æ˜¯å†…å­˜é‡Œçš„ä¿¡æ¯ï¼Œæ‰€ä»¥å®‰å…¨èµ·è§è¿˜æ˜¯ä¿®æ”¹ä¸€ä¸‹æƒé™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@interview ~]# mkswap /swapfile</span><br><span class="line">Setting up swapspace version 1, size = 2047996 KiB</span><br><span class="line">no label, UUID=a4eab465-75d1-4830-b870-c222c7e2e87b</span><br><span class="line">[root@interview ~]#</span><br><span class="line">[root@interview ~]# chmod 600 /swapfile</span><br><span class="line">[root@interview ~]# swapon !$</span><br><span class="line">swapon /swapfile</span><br><span class="line">[root@interview ~]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           985M        212M        140M         12M        633M        612M</span><br><span class="line">Swap:          2.0G          0B        2.0G</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ä»»åŠ¡äºŒå®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯é¢˜ç›®çš„æ ¸å¿ƒå®‰è£… WordPress å•¦</p><h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><p>åˆšå¼€å§‹æ‰“ç®—ä½¿ç”¨å¸¸è§„çš„æ–¹æ³•æ¥éƒ¨ç½² WordPress çš„ï¼Œä½¿ç”¨ Google æœç´¢å…³é”®å­— <code>CentOS install WordPress</code> ï¼Œæ’åç¬¬äºŒçš„æ˜¯ <code>DigitalOcean</code> å®˜æ–¹åšå®¢é‡Œçš„ <a href="https://www.digitalocean.com/community/tutorials/how-to-install-wordpress-on-centos-7" target="_blank" rel="noopener">How To Install WordPress on CentOS 7</a>ã€‚å®˜æ–¹åšå®¢é‡Œæåˆ°ï¼š</p><blockquote><p>Additionally, youâ€™ll need to have a LAMP (Linux, Apache, MySQL, and PHP) stack installed on your CentOS 7 server. If you donâ€™t have these components already installed or configured, you can use this guide to learn how to install LAMP on CentOS 7.</p></blockquote><p>è™½ç„¶ WordPress å®˜æ–¹æ²¡æœ‰ç»™å‡ºè¯¦ç»†çš„æ­å»ºæ­¥éª¤ï¼Œä½†å¯ä»¥å‚è€ƒ DigitalOcean å®˜æ–¹çš„å†…å®¹ï¼Œæ¯•ç«Ÿå…¬æœ‰äº‘æœåŠ¡æä¾›å•†çš„æŠ€æœ¯ä¸“å®¶å†™çš„åšå®¢æ›´å¯é ä¸€äº›ã€‚ç”±äºè¦æ±‚çš„æ˜¯ nginx æœ€æ–°ç‰ˆæœ¬ï¼Œyum å®‰è£…çš„ nginx ç‰ˆæœ¬å¯èƒ½ä¼šæ—§ä¸€äº›ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@interview wordpress]# yum list nginx</span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: centos-distro.1gservers.com</span><br><span class="line"> * epel: d2lzkl7pfhq30w.cloudfront.net</span><br><span class="line"> * extras: mirror.dal.nexril.net</span><br><span class="line"> * updates: mirror.dal10.us.leaseweb.net</span><br><span class="line">Available Packages</span><br><span class="line">nginx.x86_64       1:1.16.1-1.el7            epel</span><br></pre></td></tr></table></figure><p><code>yum list nginx</code> é‡Œçš„ä¿¡æ¯æ˜¾ç¤º nginx ç‰ˆæœ¬ä¸º 1.16.1 å¹¶ä¸æ˜¯ <a href="https://nginx.org/en/download.html" target="_blank" rel="noopener">å®˜ç½‘</a> ä¸Šçš„æœ€æ–°ç‰ˆ <code>1.17.10</code> ï¼Œæºç ç¼–è¯‘çš„æ—¶é—´å¯èƒ½ä¼šæœ‰ç‚¹é•¿ï¼Œå› ä¸ºå‰å¤©çœ‹åˆ°ä¸€ä¸ªæ¨æ–‡è¯´ä»–ä½¿ç”¨ GCP çš„å°é¸¡ç¼–è¯‘ nginx å¤§æ¦‚èŠ±äº† 3 ä¸ªå°æ—¶ğŸ˜‚ã€‚è€Œæˆ‘é¢è¯•è§„å®šçš„æ—¶é—´æ˜¯è¦æ±‚ 1 ä¸ªå°æ—¶å†…è§£å†³ã€‚æˆ‘å»ï¼Œæƒ³è¦æœ€æ–°ç‰ˆ nginx ï¼Œè€Œä¸”æœ€çœæ—¶é—´çš„åŠæ³•çœ‹æ¥åªç”¨ docker çš„æ–¹å¼å®‰è£… nginx äº† ï¼Œä½¿ç”¨ nginx å®˜æ–¹çš„é•œåƒ nginx:latest å³ä¸º nginx æœ€æ–°çš„ç‰ˆæœ¬ã€‚Google æœç´¢ <code>docker hub nginx</code> æ¥åˆ° docker å®˜æ–¹çš„  nginx é•œåƒä»“åº“ <a href="https://hub.docker.com/_/nginx" target="_blank" rel="noopener">nginx</a> ã€‚æˆ‘å“­äº†ï¼Œè™½ç„¶æ˜¯ 1.17 ç‰ˆæœ¬ï¼Œä½†æ˜¯ 1.17.9 ç‰ˆæœ¬è€Œä¸æ˜¯ 1.17.10 ï¼Œå°±å·®äº†ä¸€ç‚¹ç‚¹å•Šï¼æ€æ¡Œå„¿ï¼ˆã€‚å°†å°±ç€ç”¨å§ï¼Œè™½ç„¶å·®äº†é‚£ä¹ˆä¸€ç‚¹ç‚¹ã€‚</p><blockquote class="twitter-tweet"><p lang="zh" dir="ltr">å°æŠ˜è…¾äº†ä¸€æŠŠï¼šåœ¨é—²ç½®çš„æ‰‹æœºä¸Šè·‘äº†ä¸ªRuby on Railsç½‘ç«™ï¼Œå®ƒè¿˜å¸¦æœ‰HTTPSè¯ä¹¦ä¸”å…¬ç½‘å¯ä»¥è®¿é—®ã€‚æœ›ç€å±å¹•ä¸Šæ»šåŠ¨çš„Nginxæ—¥å¿—æ„Ÿè§‰è¿˜æŒºä¸å¯æ€è®®çš„ã€‚<br><br>ç³»ç»Ÿæ˜¯Androidä¸Šè·‘çš„Debianã€‚<br><br>å¦å¤–ç”¨è¿™å‡ å¹´å‰çš„æ‰‹æœºç¼–è¯‘Nginxå±…ç„¶åªèŠ±äº†å¤§æ¦‚3å°æ—¶ï¼Œæ¯”GCPæœ€ä½æ¡£çš„VPSè¿˜å¿«ã€‚ <a href="https://t.co/5PGy96al5D" target="_blank" rel="noopener">pic.twitter.com/5PGy96al5D</a></p>&mdash; ä¸å®‡ | DING Yu (@felixding) <a href="https://twitter.com/felixding/status/1249675123218497536?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">April 13, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>äº‹å®è¯æ˜æˆ‘æ¨æ–­é”™äº†ï¼Œç¬¬äºŒå¤©æˆ‘åœ¨æˆ‘çš„å¦ä¸€å°æœºå™¨ä¸Šç¼–è¯‘ nginx èŠ±äº†ä¸åˆ° 1 åˆ†é’Ÿï¼Œè¢«å¤§ä½¬å‘æƒ¨äº†å•ŠğŸ˜‚ã€‚åœ¨ GCE å°é¸¡ä¸Šç¼–è¯‘ nginx æ ¹æœ¬ä¸å¯èƒ½éœ€è¦ 3 å°æ—¶å§ï¼Œ3 åˆ†é’Ÿæ‰å¯¹çš„å§ã€‚å½“åˆçœ‹åˆ°åå°±æ„Ÿè§‰ç¼–è¯‘ nginx éœ€è¦ 3ä¸ªå°æ—¶å°±æœ‰ç‚¹é—®é¢˜ï¼Œä½†å¹¶æ²¡æœ‰äº²è‡ªå»éªŒè¯ã€‚å”‰ï¼Œè¿˜æ˜¯è‡ªå·±ä¸å¤Ÿç»†è‡´å•Šï¼Œ<strong>ä¸€çŸ¥åŠè§£çœŸæ˜¯å¾ˆå±é™©çš„äº‹å„¿ï¼</strong></p><h3 id="install-docker"><a href="#install-docker" class="headerlink" title="install docker"></a>install docker</h3><p>å®‰è£… docker çš„æ–¹å¼å†ç†Ÿæ‚‰ä¸è¿‡äº†ï¼Œä½¿ç”¨ä¸€ä¸ª curl å‘½ä»¤å°±èƒ½æå®š <code>curl -fsSL https://get.docker.com | bash -s docker</code> å¦‚æœåœ¨å›½å†…ç¯å¢ƒçš„è¯ï¼Œåé¢åŠ ä¸Š  <code>--mirror Aliyun</code>  å‚æ•°å°±èƒ½ä½¿ç”¨é˜¿é‡Œäº‘çš„é•œåƒç«™ï¼Œè¿™æ ·ä¼šæ›´å¿«ä¸€äº›ã€‚å³ <code>curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</code> ã€‚</p><p>ä¸è¿‡æˆ‘è¿˜æ˜¯ä»ç¬¬ä¸€æ¬¡æ¥è§¦çš„è§’åº¦æ¥å®‰è£… docker ï¼ŒGoogle æœç´¢ <code>centos install docker</code> ç‚¹è¿›å…¥ç¬¬ä¸€ä¸ªæœç´¢ç»“æœå³ä¸ºå®˜ç½‘ <a href="https://docs.docker.com/engine/install/centos/" target="_blank" rel="noopener">Install Docker Engine on CentOS</a> ï¼Œä¸ºäº†èŠ‚çœæ—¶é—´å°±æ²¡æœ‰æŒ‰ç…§å®˜ç½‘çš„æ­¥éª¤æ¥ï¼Œè€Œæ˜¯ä½¿ç”¨å®˜æ–¹çš„ä¸€é”®è„šæœ¬æ¥å®‰è£…ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@interview ~]# curl -fsSL https://get.docker.com -o get-docker.sh</span><br><span class="line">[root@interview ~]# ls</span><br><span class="line">get-docker.sh</span><br><span class="line">[root@interview ~]# chmod +x get-docker.sh</span><br><span class="line">[root@interview ~]# ./get-docker.sh</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆä¹‹åä½¿ç”¨ <code>docker info</code> æ¥æŸ¥çœ‹ä¸€ä¸‹ docker ä¿¡æ¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šç›®å‰æœ€æ–°ç‰ˆæœ¬çš„ docker é»˜è®¤ä¼˜å…ˆé‡‡ç”¨ <strong>overlay2</strong> çš„å­˜å‚¨é©±åŠ¨ï¼Œå¯¹äºå·²æ”¯æŒè¯¥é©±åŠ¨çš„ Linux å‘è¡Œç‰ˆï¼Œä¸éœ€è¦ä»»ä½•è¿›è¡Œä»»ä½•é¢å¤–çš„é…ç½®ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯<code>devicemapper</code> å­˜å‚¨é©±åŠ¨å·²ç»åœ¨ docker 18.09 ç‰ˆæœ¬ä¸­è¢«åºŸå¼ƒï¼Œdocker å®˜æ–¹æ¨èä½¿ç”¨ <code>overlay2</code> æ›¿ä»£<code>devicemapper</code>ï¼Œåœ¨æˆ‘å¸ç”Ÿäº§ç¯å¢ƒæ›¾ç»å› ä¸º <code>devicemapper</code> é‡åˆ°è¿‡å­˜å‚¨æŒ‚ä¸èµ·çš„å‘ğŸ˜‘ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@interview</span> <span class="string">~]#</span> <span class="string">docker</span> <span class="string">info</span></span><br><span class="line"><span class="attr">Client:</span></span><br><span class="line"> <span class="attr">Debug Mode:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">Server:</span></span><br><span class="line"> <span class="attr">Containers:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Running:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Paused:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Stopped:</span> <span class="number">0</span></span><br><span class="line"> <span class="attr">Images:</span> <span class="number">0</span></span><br><span class="line"> <span class="attr">Server Version:</span> <span class="number">19.03</span><span class="number">.8</span></span><br><span class="line"> <span class="attr">Storage Driver:</span> <span class="string">overlay2</span></span><br><span class="line">  <span class="attr">Backing Filesystem:</span> <span class="string">&lt;unknown&gt;</span></span><br><span class="line">  <span class="attr">Supports d_type:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">Native Overlay Diff:</span> <span class="literal">true</span></span><br><span class="line"> <span class="attr">Logging Driver:</span> <span class="string">json-file</span></span><br><span class="line"> <span class="attr">Cgroup Driver:</span> <span class="string">cgroupfs</span></span><br><span class="line"> <span class="attr">Plugins:</span></span><br><span class="line">  <span class="attr">Volume:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">Network:</span> <span class="string">bridge</span> <span class="string">host</span> <span class="string">ipvlan</span> <span class="string">macvlan</span> <span class="literal">null</span> <span class="string">overlay</span></span><br><span class="line">  <span class="attr">Log:</span> <span class="string">awslogs</span> <span class="string">fluentd</span> <span class="string">gcplogs</span> <span class="string">gelf</span> <span class="string">journald</span> <span class="string">json-file</span> <span class="string">local</span> <span class="string">logentries</span> <span class="string">splunk</span> <span class="string">syslog</span></span><br><span class="line"> <span class="attr">Swarm:</span> <span class="string">inactive</span></span><br><span class="line"> <span class="attr">Runtimes:</span> <span class="string">runc</span></span><br><span class="line"> <span class="attr">Default Runtime:</span> <span class="string">runc</span></span><br><span class="line"> <span class="attr">Init Binary:</span> <span class="string">docker-init</span></span><br><span class="line"> <span class="attr">containerd version:</span> <span class="string">7ad184331fa3e55e52b890ea95e65ba581ae3429</span></span><br><span class="line"> <span class="attr">runc version:</span> <span class="string">dc9208a3303feef5b3839f4323d9beb36df0a9dd</span></span><br><span class="line"> <span class="attr">init version:</span> <span class="string">fec3683</span></span><br><span class="line"> <span class="attr">Security Options:</span></span><br><span class="line">  <span class="string">seccomp</span></span><br><span class="line">   <span class="attr">Profile:</span> <span class="string">default</span></span><br><span class="line"> <span class="attr">Kernel Version:</span> <span class="number">3.10</span><span class="number">.0</span><span class="number">-1062.12</span><span class="number">.1</span><span class="string">.el7.x86_64</span></span><br><span class="line"> <span class="attr">Operating System:</span> <span class="string">CentOS</span> <span class="string">Linux</span> <span class="number">7</span> <span class="string">(Core)</span></span><br><span class="line"> <span class="attr">OSType:</span> <span class="string">linux</span></span><br><span class="line"> <span class="attr">Architecture:</span> <span class="string">x86_64</span></span><br><span class="line"> <span class="attr">CPUs:</span> <span class="number">1</span></span><br><span class="line"> <span class="attr">Total Memory:</span> <span class="number">985.</span><span class="string">3MiB</span></span><br><span class="line"> <span class="attr">Name:</span> <span class="string">interview</span></span><br><span class="line"> <span class="attr">ID:</span> <span class="string">YSZO:TT5U:GDLH:3FYT:LFGP:NLOS:L4YI:5LFU:3EAV:KHP2:F746:I5P3</span></span><br><span class="line"> <span class="attr">Docker Root Dir:</span> <span class="string">/var/lib/docker</span></span><br><span class="line"> <span class="attr">Debug Mode:</span> <span class="literal">false</span></span><br><span class="line"> <span class="attr">Registry:</span> <span class="string">https://index.docker.io/v1/</span></span><br><span class="line"> <span class="attr">Labels:</span></span><br><span class="line"> <span class="attr">Experimental:</span> <span class="literal">false</span></span><br><span class="line"> <span class="attr">Insecure Registries:</span></span><br><span class="line">  <span class="number">127.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/8</span></span><br><span class="line"> <span class="attr">Live Restore Enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="install-docker-compose"><a href="#install-docker-compose" class="headerlink" title="install docker-compose"></a>install docker-compose</h3><p>å®‰è£…å®Œ docker ä¹‹åï¼Œæ¥ä¸‹æ¥å®‰è£… docker-compose ï¼Œä½¿ç”¨ Google æœç´¢ <code>centos install docker-compose</code> ç‚¹è¿›å…¥ç¬¬ä¸€ä¸ªæœç´¢ç»“æœå³ä¸ºå®˜ç½‘çš„ <a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener">Install Docker Compose</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@interview ~] sudo curl -L "https://github.com/docker/compose/releases/download/1.25.4/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose</span><br><span class="line">[root@interview ~]# docker-compose version</span><br><span class="line">bash: /usr/local/bin/docker-compose: Permission denied</span><br><span class="line">[root@interview ~]# chmod +x /usr/local/bin/docker-compose</span><br><span class="line">[root@interview ~]# docker-compose version</span><br><span class="line">docker-compose version 1.25.4, build 8d51620a</span><br><span class="line">docker-py version: 4.1.0</span><br><span class="line">CPython version: 3.7.5</span><br><span class="line">OpenSSL version: OpenSSL 1.1.0l  10 Sep 2019</span><br></pre></td></tr></table></figure><p>é‡åˆ°äº† <code>Permission denied</code> é—®é¢˜ï¼ŒåŸæ¥æ˜¯å¿˜è®°åŠ æƒé™äº† <code>chmod +x /usr/local/bin/docker-compose</code> ä¸€ä¸‹å³å¯ã€‚</p><h3 id="WordPress-1"><a href="#WordPress-1" class="headerlink" title="WordPress"></a>WordPress</h3><p>å®˜æ–¹ <a href="https://docs.docker.com/compose/wordpress/" target="_blank" rel="noopener">Quickstart: Compose and WordPress</a> çš„ <code>docker-compose.yaml</code> ä¸­çš„ web æœåŠ¡å™¨æ˜¯ä½¿ç”¨çš„ apache è€Œä¸æ˜¯ nginx ï¼Œå› æ­¤è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ docker-compose.yamlï¼Œå‰æ®µæ—¶é—´åœ¨æŠ˜è…¾ Webp Server Go çš„æ—¶å€™é‡åˆ°è¿‡è¿™ç§éœ€æ±‚ã€‚äºæ˜¯åœ¨ GitHub ä¸Šæœç´¢ <code>wordpress nginx docker-compose</code> æ‰¾åˆ°äº†åˆé€‚çš„ repo å³ <a href="https://github.com/mjstealey/wordpress-nginx-docker" target="_blank" rel="noopener">wordpress-nginx-docker</a> ã€‚çœ‹ä¸€ä¸‹ docker-compose.yaml æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.6'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">wordpress:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">wordpress:$&#123;WORDPRESS_VERSION:-php7.3-fpm&#125;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">wordpress</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./config/php.conf.ini:/usr/local/etc/php/conf.d/conf.ini</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./wordpress:/var/www/html</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_DB_NAME=$&#123;WORDPRESS_DB_NAME:-wordpress&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_TABLE_PREFIX=$&#123;WORDPRESS_TABLE_PREFIX:-wp_&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_DB_HOST=$&#123;WORDPRESS_DB_HOST:-mysql&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_DB_USER=$&#123;WORDPRESS_DB_USER:-root&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_DB_PASSWORD=$&#123;WORDPRESS_DB_PASSWORD:-password&#125;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mariadb:$&#123;MARIADB_VERSION:-latest&#125;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql:/var/lib/mysql</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD:-password&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_USER=$&#123;MYSQL_USER:-root&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_PASSWORD=$&#123;MYSQL_PASSWORD:-password&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_DATABASE=$&#123;MYSQL_DATABASE:-wordpress&#125;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:$&#123;NGINX_VERSION:-latest&#125;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'80:80'</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'443:443'</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;NGINX_CONF_DIR:-./nginx&#125;:/etc/nginx/conf.d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;NGINX_LOG_DIR:-./logs/nginx&#125;:/var/log/nginx</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;WORDPRESS_DATA_DIR:-./wordpress&#125;:/var/www/html</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;SSL_CERTS_DIR:-./certs&#125;:/etc/letsencrypt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;SSL_CERTS_DATA_DIR:-./certs-data&#125;:/data/letsencrypt</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">wordpress</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">adminer:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">adminer</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8080</span><span class="string">:8080</span></span><br></pre></td></tr></table></figure><p>å…±æœ‰ 4 ä¸ªå®¹å™¨ï¼š wordpressã€mysqlã€nginxã€adminerï¼Œé»˜è®¤ä¸éœ€è¦ä¿®æ”¹æ—¢å¯ä»¥éƒ¨ç½²èµ·æ¥ã€‚adminer æ˜¯ä¸ª web ç«¯ç®¡ç† MySQL æ•°æ®åº“çš„ï¼Œå¯ä»¥åˆ æ‰ä¸éœ€è¦ã€‚</p><p>ç”±äºé»˜è®¤çš„ç³»ç»Ÿä¸å¸¦ git ï¼Œæ‰€ä»¥éœ€è¦å®‰è£…ä¸€ä¸‹ git <code>yum install git</code>ï¼Œç„¶åæŠŠ repo clone ä¸‹æ¥ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/mjstealey/wordpress-nginx-docker</span><br><span class="line">cd wordpress-nginx-docker</span><br><span class="line">docker-compose up</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä½¿ç”¨ <code>docker-compose up</code> å‘½ä»¤å°±èƒ½å¯åŠ¨ä¸€ä¸ª WordPress ç«™ç‚¹äº†ã€‚é€šè¿‡è®¿é—®åŸŸå <a href="https://wordpress.k8s.li/" target="_blank" rel="noopener"> wordpress.k8s.li</a> å³å¯è®¿é—®åˆšåˆšåˆ›å»ºå¥½çš„ç½‘ç«™äº†ã€‚</p><h3 id="Webp-Server"><a href="#Webp-Server" class="headerlink" title="Webp Server"></a>Webp Server</h3><p>ä¸ºäº†ä¼˜åŒ–ä¸€ä¸‹åšå®¢å›¾ç‰‡é™æ€èµ„æºçš„åŠ è½½é€Ÿåº¦ï¼Œå¯ä»¥ä¸º WordPress åŠ ä¸Šä¸€ä¸ª Webp Server æœåŠ¡ï¼Œå°†åŸå›¾ç‰‡å‹ç¼©ä¸º webp æ ¼å¼ã€‚éœ€è¦ä¿®æ”¹ä¸€ä¸‹ nginx çš„é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span><span class="regexp"> ^~</span> /wp-content/uploads/ &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://webp-server:3333;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ docker-compose.yaml æ–‡ä»¶ä¸­åŠ å…¥ webp server çš„å®¹å™¨</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.6'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">wordpress:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">wordpress:$&#123;WORDPRESS_VERSION:-php7.3-fpm&#125;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">wordpress</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./config/php.conf.ini:/usr/local/etc/php/conf.d/conf.ini</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./wordpress:/var/www/html</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_DB_NAME=$&#123;WORDPRESS_DB_NAME:-wordpress&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_TABLE_PREFIX=$&#123;WORDPRESS_TABLE_PREFIX:-wp_&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_DB_HOST=$&#123;WORDPRESS_DB_HOST:-mysql&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_DB_USER=$&#123;WORDPRESS_DB_USER:-root&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_DB_PASSWORD=$&#123;WORDPRESS_DB_PASSWORD:-password&#125;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mariadb:$&#123;MARIADB_VERSION:-latest&#125;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql:/var/lib/mysql</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD:-password&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_USER=$&#123;MYSQL_USER:-root&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_PASSWORD=$&#123;MYSQL_PASSWORD:-password&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_DATABASE=$&#123;MYSQL_DATABASE:-wordpress&#125;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:$&#123;NGINX_VERSION:-latest&#125;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'80:80'</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'443:443'</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;NGINX_CONF_DIR:-./nginx&#125;:/etc/nginx/conf.d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;NGINX_LOG_DIR:-./logs/nginx&#125;:/var/log/nginx</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;WORDPRESS_DATA_DIR:-./wordpress&#125;:/var/www/html</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;SSL_CERTS_DIR:-./certs&#125;:/etc/letsencrypt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;SSL_CERTS_DATA_DIR:-./certs-data&#125;:/data/letsencrypt</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">wordpress</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">webp-server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">webpsh/webps:latest</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">webp-server</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./webp-server/config.json:/etc/config.json</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./wordpress:/var/www/html</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3333</span><span class="string">:3333</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å¥½ docker-compose.yaml æ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸º  webp-server å‡†å¤‡ä¸€ä¸ª config.json æ–‡ä»¶ï¼Œå­˜æ”¾åœ¨ <code>./webp-server/config.json</code>  ä¸‹ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"HOST"</span>: <span class="string">"0.0.0.0"</span>,</span><br><span class="line">  <span class="attr">"PORT"</span>: <span class="string">"3333"</span>,</span><br><span class="line">  <span class="attr">"QUALITY"</span>: <span class="string">"80"</span>,</span><br><span class="line">  <span class="attr">"IMG_PATH"</span>: <span class="string">"/var/www/html"</span>,</span><br><span class="line">  <span class="attr">"EXHAUST_PATH"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"ALLOWED_TYPES"</span>: [<span class="string">"jpg"</span>,<span class="string">"png"</span>,<span class="string">"jpeg"</span>,<span class="string">"bmp"</span>,<span class="string">"gif"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ <code>docker-compose restart</code> å‘½ä»¤é‡å¯ä¸€ä¸‹å®¹å™¨ï¼Œä¹‹åå† WordPress ç«¯ä¸Šä¼ ä¸€å¼ å›¾ç‰‡æµ‹è¯•ä¸€ä¸‹ã€‚ä¸Šä¼ å®Œæˆä¹‹åï¼Œæ‹¿åˆ°å›¾ç‰‡çš„ url ï¼Œç„¶åä½¿ç”¨ wget å‘½ä»¤æµ‹è¯•ä¸€ä¸‹ï¼Œæ˜¾ç¤º <code>Length: 102288 (100K)  [image/webp]</code> å°±è¯´æ˜æˆ‘ä»¬çš„ webp server å·²ç»æˆåŠŸè¿è¡Œå•¦ğŸ˜‚ã€‚å®Œæ•´çš„ repo åœ¨æˆ‘çš„ GitHub ä¸Š <a href="https://github.com/muzi502/Wwordpress" target="_blank" rel="noopener">Wwordpress</a> ï¼Œæ¬¢è¿æ¥é£Ÿç”¨å‘€ğŸ˜‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /opt/wordpress-nginx-docker â€¹masterâ€º</span><br><span class="line">â•°â”€# wget  http://dl.amd64.xyz/wp-content/uploads/2020/04/74898710_p21.jpg</span><br><span class="line">--2020-04-17 01:06:29--  http://dl.amd64.xyz/wp-content/uploads/2020/04/74898710_p21.jpg</span><br><span class="line">Resolving dl.amd64.xyz (dl.amd64.xyz)... 3.1.38.108</span><br><span class="line">Connecting to dl.amd64.xyz (dl.amd64.xyz)|3.1.38.108|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 102288 (100K) [image/webp]</span><br><span class="line">Saving to: â€˜74898710_p21.jpgâ€™</span><br><span class="line"></span><br><span class="line">74898710_p21.jpg             100%[=======&gt;]  99.89K  --.-KB/s    in 0.001s</span><br><span class="line"></span><br><span class="line">2020-04-17 01:06:29 (130 MB/s) - â€˜74898710_p21.jpgâ€™ saved [102288/102288]</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><p><a href="https://wordpress.org/" target="_blank" rel="noopener">wordpress.org</a></p></li><li><p><a href="https://hub.docker.com/_/wordpress/" target="_blank" rel="noopener">dockerhub WordPress</a></p></li><li><p><a href="https://www.nginx.com/" target="_blank" rel="noopener">nginx.com</a></p></li><li><p><a href="https://github.com/mjstealey/wordpress-nginx-docker" target="_blank" rel="noopener">wordpress-nginx-docker</a></p></li><li><p><a href="https://github.com/muzi502/Wwordpress" target="_blank" rel="noopener">Wwordpress</a></p></li><li><p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-wordpress-on-centos-7" target="_blank" rel="noopener">How To Install WordPress on CentOS 7</a></p></li><li><p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-apache-mysql-php-lamp-stack-on-centos-7" target="_blank" rel="noopener">How To Install Linux, Apache, MySQL, PHP (LAMP) stack On CentOS 7</a></p></li><li><p><a href="https://docs.docker.com/compose/wordpress/" target="_blank" rel="noopener">Quickstart: Compose and WordPress</a></p></li><li><p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-wordpress-with-docker-compose" target="_blank" rel="noopener">How To Install WordPress With Docker Compose</a></p></li><li><p><a href="https://docs.docker.com/engine/install/centos/" target="_blank" rel="noopener">Install Docker Engine on CentOS</a></p></li><li><p><a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener">Install Docker Compose</a></p></li><li><p><a href="https://www.howtoforge.com/tutorial/how-to-build-nginx-from-source-on-ubuntu-1804-lts/" target="_blank" rel="noopener">How to Build NGINX from source on Ubuntu 18.04 LTS</a></p></li><li><p><a href="https://blog.k8s.li/oh-my-webpsh.html">è®©å›¾ç‰‡é£èµ·æ¥ oh-my-webp.sh ï¼</a></p></li></ul><h2 id="end"><a href="#end" class="headerlink" title="end"></a>end</h2><p>è‡³æ­¤éƒ¨ç½²ä¸€ä¸ª WordPress çš„æµç¨‹å°±ç»“æŸå•¦ï¼Œä¸ºäº†è¿½æ±‚é€Ÿåº¦å°±æ”¾å¼ƒäº†å¯¹ä¸€äº›ç»†èŠ‚çš„æ·±ç©¶ï¼Œå¾—ä¸å¿å¤±å•Šã€‚</p><p>æœ‰äº›å†…å®¹çœ‹ä¼¼ç®€å•ï¼Œä½†æƒ³æŠŠè¿™ä¸ªè¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ä»¥åŠæƒ³æ³•è½ç¬”æˆå­—ï¼Œå½¢æˆä¸€ç¯‡åšå®¢ï¼Œè¿˜æ˜¯éœ€è¦è¯­è¨€ç»„ç»‡èƒ½åŠ›ï¼Œçœ‹æ¥è‡ªå·±è¿™æ–¹é¢è¿˜æ˜¯æœ‰äº›æ¬ ç¼ºã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;ä»Šå¤©æ”¶åˆ°ä¸€ä»½é¢è¯•é¢˜ï¼Œå†…å®¹çœ‹ä¼¼å¾ˆç®€å•ï¼š&lt;/p&gt;
&lt;block
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="nginx" scheme="https://blog.k8s.li/tags/nginx/"/>
    
      <category term="WordPress" scheme="https://blog.k8s.li/tags/WordPress/"/>
    
      <category term="MySQL" scheme="https://blog.k8s.li/tags/MySQL/"/>
    
      <category term="PHP" scheme="https://blog.k8s.li/tags/PHP/"/>
    
      <category term="Webp" scheme="https://blog.k8s.li/tags/Webp/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ kubeadm å¿«é€Ÿéƒ¨ç½²ä½“éªŒ K8s</title>
    <link href="https://blog.k8s.li/kubeadm-deploy-k8s-v1.17.4.html"/>
    <id>https://blog.k8s.li/kubeadm-deploy-k8s-v1.17.4.html</id>
    <published>2020-04-14T16:00:00.000Z</published>
    <updated>2020-04-14T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç‚’å†·é¥­"><a href="#ç‚’å†·é¥­" class="headerlink" title="ç‚’å†·é¥­"></a>ç‚’å†·é¥­</h2><p>å¤§æ¦‚æ˜¯ä»å»å¹´ 5 æœˆå¼€å§‹æ‰æ¥è§¦  kubernetes ï¼Œæ—¶è‡³ä»Šæ—¥å·²ç»å¿«ä¸€å¹´ï¼Œå½“åˆå†™çš„ä¸€ç¯‡åšå®¢ <a href="https://blog.k8s.li/install-k8s-ubuntu18-04.html">ubuntu 1804 ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes</a> ç¿»å‡ºæ¥é‡æ–°ä¿®æ”¹ä¸€ä¸‹ï¼Œè®°å½•ä¸€ä¸‹ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes v1.17.4 ç‰ˆçš„æµç¨‹ã€‚é€‚ç”¨äºå›½å†…ç½‘ç»œç¯å¢ƒä¸‹ã€‚</p><h3 id="kubeadm"><a href="#kubeadm" class="headerlink" title="kubeadm"></a>kubeadm</h3><p>Kubernetes ä» 1.4 ç‰ˆæœ¬å¼€å§‹åå°±å¼•å…¥äº† kubeadm ç”¨äºç®€åŒ–é›†ç¾¤æ­å»ºçš„è¿‡ç¨‹ï¼Œåœ¨ Kubernetes 1.13 ç‰ˆæœ¬ä¸­ï¼Œkubeadm å·¥å…·è¿›å…¥ GA é˜¶æ®µï¼Œè€Œå½“å‰çš„ kubernetes æœ€æ–°ç‰ˆ stable ä¸º 1.18.1 ï¼Œkubeadm å·²ç»ç»å†è¿‡å¤šä¸ªç‰ˆæœ¬çš„è¿­ä»£ï¼Œå¯ç”¨äºç”Ÿäº§ç¯å¢ƒ Kubernetes é›†ç¾¤æ­å»ºã€‚å¯¹äºåˆšåˆšæ¥è§¦ kubernetes  çš„åˆå­¦è€…æ¥è®²ï¼Œkubeadm ä¹Ÿæ˜¯ä¸€ä¸ªå¿«é€Ÿéƒ¨ç½²ä½“éªŒ kubernetes çš„ä¸äºŒä¹‹é€‰ã€‚</p><h2 id="kubernetes-æ¶æ„"><a href="#kubernetes-æ¶æ„" class="headerlink" title="kubernetes æ¶æ„"></a>kubernetes æ¶æ„</h2><p><img src="img/components-of-kubernetes.png" alt="Components of Kubernetes"></p><p>æ¶æ„å›¾æ¥è‡ª kubernetes å®˜æ–¹æ–‡æ¡£ <a href="https://kubernetes.io/zh/docs/concepts/overview/components/" target="_blank" rel="noopener">Kubernetes ç»„ä»¶</a></p><h3 id="æ§åˆ¶å¹³é¢"><a href="#æ§åˆ¶å¹³é¢" class="headerlink" title="æ§åˆ¶å¹³é¢"></a>æ§åˆ¶å¹³é¢</h3><p>æ§åˆ¶å¹³é¢çš„ç»„ä»¶å¯¹é›†ç¾¤åšå‡ºå…¨å±€å†³ç­–(æ¯”å¦‚è°ƒåº¦)ï¼Œä»¥åŠæ£€æµ‹å’Œå“åº”é›†ç¾¤äº‹ä»¶ä¸»è¦çš„ç»„ä»¶ç”± </p><ul><li>kube-apiserverï¼šä¸»èŠ‚ç‚¹ä¸Šè´Ÿè´£æä¾› Kubernetes API æœåŠ¡çš„ç»„ä»¶ï¼›å®ƒæ˜¯ Kubernetes æ§åˆ¶é¢çš„å‰ç«¯ã€‚</li><li>etcdï¼šé›†ç¾¤ä¸­å”¯ä¸€ä¸€ä¸ªæœ‰çŠ¶æ€çš„æœåŠ¡ï¼Œç”¨æ¥å­˜å‚¨é›†ç¾¤ä¸­çš„æ‰€æœ‰èµ„æºä¿¡æ¯æ•°æ®ã€‚</li><li>kube-schedulerï¼šè´Ÿè´£è°ƒåº¦ Pod èµ„æºåˆ°æŸä¸ª Node èŠ‚ç‚¹ä¸Šã€‚</li><li>kube-controller-managerï¼šæ§åˆ¶å™¨ç®¡ç†å™¨ã€‚</li><li>kubeletï¼šå¦‚æœä½¿ç”¨ kubeadm éƒ¨ç½²çš„è¯éœ€è¦åœ¨ master èŠ‚ç‚¹å®‰è£… kubelet</li></ul><h3 id="å·¥ä½œå¹³é¢"><a href="#å·¥ä½œå¹³é¢" class="headerlink" title="å·¥ä½œå¹³é¢"></a>å·¥ä½œå¹³é¢</h3><ul><li>kubeletï¼šé€šè¿‡ç›‘å¬ kube-apiserver ï¼Œæ¥æ”¶ä¸€ç»„é€šè¿‡å„ç±»æœºåˆ¶æä¾›ç»™å®ƒçš„ PodSpecsï¼Œç¡®ä¿è¿™äº› PodSpecs ä¸­æè¿°çš„å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ä¸”å¥åº·ã€‚</li><li>kube-proxyï¼šå®ç° Kubernetes <a href="https://kubernetes.io/docs/concepts/services-networking/service/" target="_blank" rel="noopener">Service</a> æ¦‚å¿µçš„ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡ iptables è§„åˆ™å°† service è´Ÿè½½å‡è¡¡åˆ°å„ä¸ª Podã€‚</li><li>CRIå®¹å™¨è¿è¡Œæ—¶ï¼šæ ¹æ®ç»Ÿè®¡ç›®å‰ docker ä¾æ—§æ˜¯æ’åç¬¬ä¸€çš„å®¹å™¨è¿è¡Œæ—¶</li></ul><h3 id="kubeadm-init-æµç¨‹"><a href="#kubeadm-init-æµç¨‹" class="headerlink" title="kubeadm init æµç¨‹"></a>kubeadm init æµç¨‹</h3><p>åœ¨ä½¿ç”¨ kubeadm éƒ¨ç½²æ—¶ï¼Œé™¤äº† kubelet ç»„ä»¶éœ€è¦ä½¿ç”¨äºŒè¿›åˆ¶éƒ¨ç½²å¤–ï¼Œå…¶ä»–çš„ç»„ä»¶éƒ½æ˜¯ç”¨ <a href="">static Pod</a> çš„æ–¹å¼è¿è¡Œåœ¨ç›¸åº”çš„èŠ‚ç‚¹ã€‚</p><h2 id="èŠ‚ç‚¹åˆå§‹åŒ–"><a href="#èŠ‚ç‚¹åˆå§‹åŒ–" class="headerlink" title="èŠ‚ç‚¹åˆå§‹åŒ–"></a>èŠ‚ç‚¹åˆå§‹åŒ–</h2><p>ç³»ç»Ÿå»ºè®®é€‰æ‹© ubuntu 1804 æˆ–è€… CentOS 7.7ï¼Œå› ä¸º docker å®¹å™¨è™šæ‹ŸåŒ–ä»¥åŠ kubernetes è¿™äº›æ–°æŠ€æœ¯éƒ½æ˜¯å¾ˆä¾èµ–ä¸€äº›å†…æ ¸ç‰¹æ€§ï¼Œæ¯”å¦‚ overlay2ã€cgroupv2 ç­‰ï¼Œè¿™äº›ç‰¹æ€§åœ¨è¾ƒä½ç‰ˆæœ¬çš„å†…æ ¸ä¸Šå¹¶ä¸æ˜¯å¾ˆç¨³å®šï¼Œå»ºè®® 4.14 æˆ–è€… 4.19 ä»¥ä¸Šçš„ LTS  å†…æ ¸ï¼ŒåŠé•¿æœŸç¨³å®šæ”¯æŒç‰ˆå†…æ ¸ï¼Œåœ¨ <a href="https://www.kernel.org/category/releases.html" target="_blank" rel="noopener">kernel.org</a> ä¸Šæœ‰å†…æ ¸æ”¯æŒæ”¯æŒæƒ…å†µã€‚</p><h3 id="è®¾ç½®ä¸»æœºåå¹¶æ·»åŠ -hosts"><a href="#è®¾ç½®ä¸»æœºåå¹¶æ·»åŠ -hosts" class="headerlink" title="è®¾ç½®ä¸»æœºåå¹¶æ·»åŠ   hosts"></a>è®¾ç½®ä¸»æœºåå¹¶æ·»åŠ   hosts</h3><p>æ¯å°æœºå™¨ä¸Šéƒ½è¦è®¾ç½®ç›¸åº”çš„ä¸»æœºåå¹¶æ·»åŠ  hosts</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname k8s-maste-01</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /etc/hosts &lt;&lt;EOF</span><br><span class="line">10.20.172.211 k8s-master-01</span><br><span class="line">10.20.172.212 k8s-node-01</span><br><span class="line">10.20.172.213 k8s-node-02</span><br><span class="line">10.20.172.214 k8s-node-03</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="å…³é—­-swap-å’Œ-SELinux"><a href="#å…³é—­-swap-å’Œ-SELinux" class="headerlink" title="å…³é—­ swap å’Œ SELinux"></a>å…³é—­ swap å’Œ SELinux</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¸´æ—¶å…³é—­swapå’ŒSELinux</span></span><br><span class="line">swapoff -a</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ubuntu é»˜è®¤æ²¡æœ‰å®‰è£… SELinux å› ä¸ºæ— éœ€å…³é—­</span></span><br><span class="line">setenforce 0</span><br><span class="line">sed -i 's/^SELINUX=enforcing$/SELINUX= disabled/' /etc/selinux/config</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®å†…æ ¸å‚æ•°"><a href="#è®¾ç½®å†…æ ¸å‚æ•°" class="headerlink" title="è®¾ç½®å†…æ ¸å‚æ•°"></a>è®¾ç½®å†…æ ¸å‚æ•°</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/sysctl.d/99-kubernetes-cri.conf &lt;&lt;EOF</span><br><span class="line">net.bridge.bridge-nf-call-iptables  = 1</span><br><span class="line">enet.ipv4.ip_forward                = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">EOF</span><br><span class="line">sysctl --system</span><br></pre></td></tr></table></figure><h3 id="é…ç½®é•œåƒæºå’Œå®‰è£…"><a href="#é…ç½®é•œåƒæºå’Œå®‰è£…" class="headerlink" title="é…ç½®é•œåƒæºå’Œå®‰è£…"></a>é…ç½®é•œåƒæºå’Œå®‰è£…</h3><p>å¦‚æœå¯¹ docker-ce ç‰ˆæœ¬æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯å®‰è£… docker-ce æœ€æ–°çš„ stable ç‰ˆæœ¬ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br></pre></td></tr></table></figure><h4 id="CentOS7"><a href="#CentOS7" class="headerlink" title="CentOS7"></a>CentOS7</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœ docker ç‰ˆæœ¬ä½¿ç”¨ 18.09 + ä¸”å­˜å‚¨é©±åŠ¨ä½¿ç”¨ overlay2</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°±ä¸ç”¨ device-mapper-persistent-data å’Œ lvm2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ·»åŠ aliyunè½¯ä»¶åŒ…yumæº docker</span></span><br><span class="line">yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ·»åŠ aliyunè½¯ä»¶åŒ…yumæº kubelet kubeadm kubectl</span></span><br><span class="line"><span class="meta">cat&gt;</span><span class="bash">&gt;/etc/yum.repos.d/kubrenetes.repo&lt;&lt;EOF</span></span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes Repo</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">gpgcheck=0</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class="line">EOF</span><br><span class="line">yum makecache</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ—å‡ºå¯ä»¥å®‰è£…çš„ docker-ce ç‰ˆæœ¬ï¼Œå®‰è£…æŒ‡å®šçš„ docker ç‰ˆæœ¬</span></span><br><span class="line">yum list docker-ce --showduplicates|sort -r</span><br><span class="line">yum install -y docker-ce-19.03.3-3.el7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="comment"># åˆ—å‡ºå¯ä»¥å®‰è£…çš„ kubernetes ç‰ˆæœ¬ï¼Œå®‰è£…æŒ‡å®šçš„ kubeadm kubelet kubectl</span></span></span><br><span class="line">yum list kubeadm --showduplicates|sort -r</span><br><span class="line">yum install kubelet-1.17.4-0 kubeadm-1.17.4-0 kubectl-1.17.4-0 --disableexcludes=kubernetes</span><br></pre></td></tr></table></figure><h4 id="Ubuntu-1804"><a href="#Ubuntu-1804" class="headerlink" title="Ubuntu 1804"></a>Ubuntu 1804</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt-get install -y apt-transport-https ca-certificates curl software-properties-common</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ·»åŠ é˜¿é‡Œäº‘ docker-ce é•œåƒæº</span></span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line">add-apt-repository "deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable"</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ·»åŠ é˜¿é‡Œäº‘ kubernetes é•œåƒæº</span></span><br><span class="line">curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add -</span><br><span class="line">cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span><br><span class="line">deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main</span><br><span class="line">EOF</span><br><span class="line">apt-get update</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„ docker-ce</span></span><br><span class="line">apt list -a docker-ce</span><br><span class="line">apt install docker-ce=5:19.03.8~3-0~ubuntu-bionic</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„ kubernetes</span></span><br><span class="line">apt install kubeadm=1.17.4-00 kubelet=1.17.4-00 kubectl=1.17.4-00</span><br></pre></td></tr></table></figure><h4 id="åä¸ºäº‘å‘"><a href="#åä¸ºäº‘å‘" class="headerlink" title="åä¸ºäº‘å‘"></a>åä¸ºäº‘å‘</h4><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨çš„åä¸ºäº‘ kubernetes é•œåƒæºï¼Œç›®å‰ ï¼ˆ2020-04-15ï¼‰ åä¸ºäº‘ä¸Šçš„ kubernetes ç‰ˆæœ¬æœ€é«˜æ”¯æŒåˆ° 1.14.2ï¼Œè€Œ 1.14 ç‰ˆæœ¬ kubernetes å·²ç»ä¸åœ¨ç»´æŠ¤äº†ï¼Œæ‰€ä»¥æ¨èæ¢ä¸ªé•œåƒæºå®‰è£… v.1.16.8 æˆ–è€… v1.17.4 è¿™ä¸¤ä¸ªç‰ˆæœ¬ï¼Œv1.18.1 ä¹Ÿä¸å»ºè®®å»ºè®®å®‰è£…ä½¿ç”¨ã€‚å…³äºç‰ˆæœ¬çš„é€‰æ‹©å¯ä»¥å‚è€ƒ <a href="https://blog.k8s.li/How-to-choose-the-right-version-of-kubernetes.html">ç”Ÿäº§ç¯å¢ƒå¦‚ä½•ä¿å®ˆåœ°é€‰æ‹© kubernetes ç‰ˆæœ¬</a> ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 ~</span><br><span class="line">â•°â”€# yum list kubeadm --showduplicates|sort -r</span><br><span class="line">kubeadm.x86_64                       1.6.11-0                         kubernetes</span><br><span class="line">kubeadm.x86_64                       1.6.1-0                          kubernetes</span><br><span class="line">kubeadm.x86_64                       1.6.10-0                         kubernetes</span><br><span class="line">kubeadm.x86_64                       1.6.0-0                          kubernetes</span><br><span class="line">kubeadm.x86_64                       1.14.2-0                         kubernetes</span><br><span class="line">kubeadm.x86_64                       1.14.1-0                         kubernetes</span><br><span class="line">kubeadm.x86_64                       1.14.0-0                         kubernetes</span><br><span class="line">kubeadm.x86_64                       1.13.6-0                         kubernetes</span><br><span class="line">kubeadm.x86_64                       1.13.5-0                         kubernetes</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®-docker-çš„daemon-json"><a href="#è®¾ç½®-docker-çš„daemon-json" class="headerlink" title="è®¾ç½® docker çš„daemon.json"></a>è®¾ç½® docker çš„daemon.json</h3><p>å®‰è£…å®Œæˆä¹‹åå…ˆè®¾ç½®ä»¥ä¸‹ docker çš„å¯åŠ¨å‚æ•° <code>/etc/docker/daemon.json</code></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/docker/daemon.json &lt;&lt;EOF</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"exec-opts"</span>: [<span class="string">"native.cgroupdriver=systemd"</span>],</span><br><span class="line">  <span class="attr">"registry-mirrors"</span>: [<span class="string">"https://xlx9erfu.mirror.aliyuncs.com"</span>],</span><br><span class="line">  <span class="attr">"log-driver"</span>: <span class="string">"json-file"</span>,</span><br><span class="line">  <span class="attr">"log-opts"</span>: &#123;</span><br><span class="line">    <span class="attr">"max-size"</span>: <span class="string">"100m"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"storage-driver"</span>: <span class="string">"overlay2"</span></span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨"><a href="#è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨" class="headerlink" title="è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨"></a>è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable docker kubelet</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start docker kubelet</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">â•­â”€root@k8s-master-01</span> <span class="string">~</span></span><br><span class="line"><span class="string">â•°â”€#</span> <span class="string">docker</span> <span class="string">info</span></span><br><span class="line"><span class="attr">Client:</span></span><br><span class="line"> <span class="attr">Debug Mode:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">Server:</span></span><br><span class="line"> <span class="attr">Containers:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Running:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Paused:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Stopped:</span> <span class="number">0</span></span><br><span class="line"> <span class="attr">Images:</span> <span class="number">0</span></span><br><span class="line"> <span class="attr">Server Version:</span> <span class="number">19.03</span><span class="number">.3</span></span><br><span class="line"> <span class="attr">Storage Driver:</span> <span class="string">overlay2</span></span><br><span class="line">  <span class="attr">Backing Filesystem:</span> <span class="string">extfs</span></span><br><span class="line">  <span class="attr">Supports d_type:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">Native Overlay Diff:</span> <span class="literal">true</span></span><br><span class="line"> <span class="attr">Logging Driver:</span> <span class="string">json-file</span></span><br><span class="line"> <span class="attr">Cgroup Driver:</span> <span class="string">cgroupfs</span></span><br><span class="line"> <span class="attr">Plugins:</span></span><br><span class="line">  <span class="attr">Volume:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">Network:</span> <span class="string">bridge</span> <span class="string">host</span> <span class="string">ipvlan</span> <span class="string">macvlan</span> <span class="literal">null</span> <span class="string">overlay</span></span><br><span class="line">  <span class="attr">Log:</span> <span class="string">awslogs</span> <span class="string">fluentd</span> <span class="string">gcplogs</span> <span class="string">gelf</span> <span class="string">journald</span> <span class="string">json-file</span> <span class="string">local</span> <span class="string">logentries</span> <span class="string">splunk</span> <span class="string">syslog</span></span><br><span class="line"> <span class="attr">Swarm:</span> <span class="string">inactive</span></span><br><span class="line"> <span class="attr">Runtimes:</span> <span class="string">runc</span></span><br><span class="line"> <span class="attr">Default Runtime:</span> <span class="string">runc</span></span><br><span class="line"> <span class="attr">Init Binary:</span> <span class="string">docker-init</span></span><br><span class="line"> <span class="attr">containerd version:</span> <span class="string">894b81a4b802e4eb2a91d1ce216b8817763c29fb</span></span><br><span class="line"> <span class="attr">runc version:</span> <span class="string">425e105d5a03fabd737a126ad93d62a9eeede87f</span></span><br><span class="line"> <span class="attr">init version:</span> <span class="string">fec3683</span></span><br><span class="line"> <span class="attr">Security Options:</span></span><br><span class="line">  <span class="string">seccomp</span></span><br><span class="line">   <span class="attr">Profile:</span> <span class="string">default</span></span><br><span class="line"> <span class="attr">Kernel Version:</span> <span class="number">3.10</span><span class="number">.0</span><span class="number">-957.</span><span class="string">el7.x86_64</span></span><br><span class="line"> <span class="attr">Operating System:</span> <span class="string">CentOS</span> <span class="string">Linux</span> <span class="number">7</span> <span class="string">(Core)</span></span><br><span class="line"> <span class="attr">OSType:</span> <span class="string">linux</span></span><br><span class="line"> <span class="attr">Architecture:</span> <span class="string">x86_64</span></span><br><span class="line"> <span class="attr">CPUs:</span> <span class="number">4</span></span><br><span class="line"> <span class="attr">Total Memory:</span> <span class="number">3.</span><span class="string">683GiB</span></span><br><span class="line"> <span class="attr">Name:</span> <span class="string">k8s-master-01</span></span><br><span class="line"> <span class="attr">ID:</span> <span class="string">UXD4:IK6C:P3EO:TXRP:GQZD:STGH:GXZH:LO2C:HFBN:LV2B:LEVE:UWT2</span></span><br><span class="line"> <span class="attr">Docker Root Dir:</span> <span class="string">/var/lib/docker</span></span><br><span class="line"> <span class="attr">Debug Mode:</span> <span class="literal">false</span></span><br><span class="line"> <span class="attr">Registry:</span> <span class="string">https://index.docker.io/v1/</span></span><br><span class="line"> <span class="attr">Labels:</span></span><br><span class="line"> <span class="attr">Experimental:</span> <span class="literal">false</span></span><br><span class="line"> <span class="attr">Insecure Registries:</span></span><br><span class="line">  <span class="number">127.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/8</span></span><br><span class="line"> <span class="attr">Live Restore Enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>ç›®å‰æœ€æ–°ç‰ˆæœ¬çš„ docker é»˜è®¤ä¼˜å…ˆé‡‡ç”¨ <strong>overlay2</strong>  çš„å­˜å‚¨é©±åŠ¨ï¼Œå¯¹äºå·²æ”¯æŒè¯¥é©±åŠ¨çš„ Linux å‘è¡Œç‰ˆï¼Œä¸éœ€è¦ä»»ä½•è¿›è¡Œä»»ä½•é¢å¤–çš„é…ç½®ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯<code>devicemapper</code> å­˜å‚¨é©±åŠ¨å·²ç»åœ¨ docker 18.09 ç‰ˆæœ¬ä¸­è¢«åºŸå¼ƒï¼Œdocker å®˜æ–¹æ¨èä½¿ç”¨ <code>overlay2</code> æ›¿ä»£<code>devicemapper</code>ã€‚å¯ä½¿ç”¨ lsmod å‘½ä»¤æŸ¥çœ‹å½“å‰ç³»ç»Ÿå†…æ ¸æ˜¯å¦æ”¯æŒ overlay2 ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# lsmod |grep overlay</span><br><span class="line">overlay                71964  16</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²-master-èŠ‚ç‚¹"><a href="#éƒ¨ç½²-master-èŠ‚ç‚¹" class="headerlink" title="éƒ¨ç½² master èŠ‚ç‚¹"></a>éƒ¨ç½² master èŠ‚ç‚¹</h2><h3 id="å‡†å¤‡é•œåƒ"><a href="#å‡†å¤‡é•œåƒ" class="headerlink" title="å‡†å¤‡é•œåƒ"></a>å‡†å¤‡é•œåƒ</h3><p>å¯¹äº kubernetes 1.17.4 ç‰ˆæœ¬çš„ kubeadm éœ€è¦ä½¿ç”¨åˆ°ä»¥ä¸‹ docker é•œåƒå¦‚ä¸‹ï¼Œå¯¹äºå¢™å›½ç½‘ç»œç¯å¢ƒä¸‹ï¼Œä½ éœ€è¦æ‰¾å°å¯ä»¥è‡ªç”±è®¿é—®äº’è”ç½‘çš„æœåŠ¡å™¨ï¼Œåœ¨ä¸Šé¢æŠŠå®ƒ pull ä¸‹æ¥ï¼Œç„¶å save æˆ tar åŒ…ä¼ å›æœ¬åœ°å† docker load è¿›é•œåƒğŸ˜‚ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">k8s.gcr.io/kube-apiserver:v1.17.4</span><br><span class="line">k8s.gcr.io/kube-controller-manager:v1.17.4</span><br><span class="line">k8s.gcr.io/kube-scheduler:v1.17.4</span><br><span class="line">k8s.gcr.io/kube-proxy:v1.17.4</span><br><span class="line">k8s.gcr.io/pause:3.1</span><br><span class="line">k8s.gcr.io/etcd:3.4.3-0</span><br><span class="line">k8s.gcr.io/coredns:1.6.5</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä½¿ç”¨ kubeadm pull ç›¸å…³é•œåƒæ—¶ï¼Œkubeadm çš„ç‰ˆæœ¬æœ€å¥½å’Œ â€“kubernetes-version=${version} ç‰ˆæœ¬ä¸€è‡´ï¼Œä¸ä¸€è‡´çš„è¯æœ‰äº›ç‰ˆæœ¬çš„é•œåƒæ˜¯ pull ä¸ä¸‹æ¥çš„ã€‚å¯¹åº”ç‰ˆæœ¬çš„ kubenetes è¦ä½¿ç”¨å¯¹åº”ç‰ˆæœ¬çš„é•œåƒæ‰å¯ä»¥ã€‚å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è„šæœ¬åœ¨å¯ä»¥è‡ªç”±è®¿é—®äº’è”ç½‘çš„æœåŠ¡å™¨ä¸Šå°† pull æŒ‡å®šç‰ˆæœ¬çš„é•œåƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span>: use kubeadm pull kubernetes images</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> date: 2019-08-15</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> author: muzi502</span></span><br><span class="line"></span><br><span class="line">set -xue</span><br><span class="line">apt-get update &amp;&amp; apt-get install -y apt-transport-https curl</span><br><span class="line">curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -</span><br><span class="line">cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span><br><span class="line">deb https://apt.kubernetes.io/ kubernetes-xenial main</span><br><span class="line">EOF</span><br><span class="line">apt-get update</span><br><span class="line"></span><br><span class="line">for version in 1.17.4</span><br><span class="line">do</span><br><span class="line">    apt install kubeadm=$&#123;version&#125;-00</span><br><span class="line">    mkdir -p $&#123;version&#125;/bin</span><br><span class="line">    docker rmi $(docker images -q)</span><br><span class="line">    kubeadm config images pull --kubernetes-version=$&#123;version&#125;</span><br><span class="line">    docker save -o v$&#123;version&#125;.tar $(docker images | grep -v TAG | cut -d ' ' -f1)</span><br><span class="line">    gzip v$&#123;version&#125;.tar v$&#123;version&#125;.tar.gz</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>å¯¼å…¥ä¹‹åçš„é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# docker load &lt; v1.17.4.tar.gz</span><br><span class="line">fc4976bd934b: Loading layer [=============&gt;]  53.88MB/53.88MB</span><br><span class="line">f6953727aaba: Loading layer [=============&gt;]   42.1MB/42.1MB</span><br><span class="line">Loaded image: k8s.gcr.io/kube-scheduler:v1.17.4</span><br><span class="line">225df95e717c: Loading layer [=============&gt;]  336.4kB/336.4kB</span><br><span class="line">7c9b0f448297: Loading layer [=============&gt;]  41.37MB/41.37MB</span><br><span class="line">Loaded image: k8s.gcr.io/coredns:1.6.5</span><br><span class="line">fe9a8b4f1dcc: Loading layer [=============&gt;]  43.87MB/43.87MB</span><br><span class="line">ce04b89b7def: Loading layer [=============&gt;]  224.9MB/224.9MB</span><br><span class="line">1b2bc745b46f: Loading layer [=============&gt;]  21.22MB/21.22MB</span><br><span class="line">Loaded image: k8s.gcr.io/etcd:3.4.3-0</span><br><span class="line">e17133b79956: Loading layer [=============&gt;]  744.4kB/744.4kB</span><br><span class="line">Loaded image: k8s.gcr.io/pause:3.1</span><br><span class="line">682fbb19de80: Loading layer [=============&gt;]  21.06MB/21.06MB</span><br><span class="line">2dc2f2423ad1: Loading layer [=============&gt;]  5.168MB/5.168MB</span><br><span class="line">ad9fb2411669: Loading layer [=============&gt;]  4.608kB/4.608kB</span><br><span class="line">597151d24476: Loading layer [=============&gt;]  8.192kB/8.192kB</span><br><span class="line">0d8d54147a3a: Loading layer [=============&gt;]  8.704kB/8.704kB</span><br><span class="line">960d0ce862e2: Loading layer [=============&gt;]  37.81MB/37.81MB</span><br><span class="line">Loaded image: k8s.gcr.io/kube-proxy:v1.17.4</span><br><span class="line">9daac3fed755: Loading layer [=============&gt;]  118.7MB/118.7MB</span><br><span class="line">Loaded image: k8s.gcr.io/kube-apiserver:v1.17.4</span><br><span class="line">99df54617e88: Loading layer [=============&gt;]  108.6MB/108.6MB</span><br><span class="line">Loaded image: k8s.gcr.io/kube-controller-manager:v1.17.4</span><br><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# docker images</span><br><span class="line">REPOSITORY                           TAG                 CREATED             SIZE</span><br><span class="line">k8s.gcr.io/kube-proxy                v1.17.4             4 weeks ago         116MB</span><br><span class="line">k8s.gcr.io/kube-controller-manager   v1.17.4             4 weeks ago         161MB</span><br><span class="line">k8s.gcr.io/kube-apiserver            v1.17.4             4 weeks ago         171MB</span><br><span class="line">k8s.gcr.io/kube-scheduler            v1.17.4             4 weeks ago         94.4MB</span><br><span class="line">k8s.gcr.io/coredns                   1.6.5               5 months ago        41.6MB</span><br><span class="line">k8s.gcr.io/etcd                      3.4.3-0             5 months ago        288MB</span><br><span class="line">k8s.gcr.io/pause                     3.1                 2 years ago         742kB</span><br></pre></td></tr></table></figure><h3 id="åˆå§‹åŒ–-master-èŠ‚ç‚¹"><a href="#åˆå§‹åŒ–-master-èŠ‚ç‚¹" class="headerlink" title="åˆå§‹åŒ– master èŠ‚ç‚¹"></a>åˆå§‹åŒ– master èŠ‚ç‚¹</h3><p>ä½¿ç”¨ kubeadm init å‘½ä»¤åˆå§‹åŒ– master èŠ‚ç‚¹ï¼Œå…³äº kubeadm çš„å‚æ•°å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ <a href="https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/kubeadm-init/" target="_blank" rel="noopener">kubeadm init</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=10.20.172.211</span><br></pre></td></tr></table></figure><ul><li>â€“pod-network-cidr= æŒ‡å®š Pod ç½‘æ®µçš„ IP åœ°å€å—</li><li>â€“apiserver-advertise-address= æŒ‡å®š api-server ç›‘å¬çš„åœ°å€</li></ul><p>æ­£å¸¸å®Œæˆä¹‹åçš„æ—¥å¿—è¾“å‡ºå¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=10.20.172.211</span><br><span class="line"></span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  mkdir -p $HOME/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">Then you can join any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm join 10.20.172.211:6443 --token hi66lb.r13y2hottst2ks6f \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:9b96a436f2897a8371fccb3af4d8f2fff348fcb42763e005e9175a4e925c51d1</span><br></pre></td></tr></table></figure><p>åˆšåˆšå®‰è£…å®Œä¹‹å coreDNS çš„ Pod ä¼šä¸€ç›´å‡ºäº pending çŠ¶æ€ï¼Œè€Œä¸” Master çš„ STATUS çŠ¶æ€ä¹Ÿæ˜¯ <code>NotReady</code> ã€‚é‡åˆ°è¿™ç§é—®é¢˜<code>ä¸è¦æ…Œ,é—®é¢˜ä¸å¤§.jpg</code> è¿™æ˜¯å› ä¸ºé›†ç¾¤ä¸­è¿˜æ²¡æœ‰å®‰è£…å¥½ CNI ç½‘ç»œæ’ä»¶ï¼Œç­‰ä¸‹éƒ¨ç½²å¥½ flannel å°±å¯ä»¥ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl get node</span><br><span class="line">NAME            STATUS     ROLES    AGE     VERSION</span><br><span class="line">k8s-master-01   NotReady   master   9m19s   v1.17.4</span><br><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl get pod --all-namespaces</span><br><span class="line">NAMESPACE     NAME                                    READY   STATUS    RESTARTS   AGE</span><br><span class="line">kube-system   coredns-6955765f44-t4b6k                0/1     Pending   0          49s</span><br><span class="line">kube-system   coredns-6955765f44-vm5tm                0/1     Pending   0          49s</span><br><span class="line">kube-system   etcd-k8s-master-01                      1/1     Running   0          62s</span><br><span class="line">kube-system   kube-apiserver-k8s-master-01            1/1     Running   0          62s</span><br><span class="line">kube-system   kube-controller-manager-k8s-master-01   1/1     Running   0          62s</span><br><span class="line">kube-system   kube-proxy-rmgwl                        1/1     Running   0          49s</span><br><span class="line">kube-system   kube-scheduler-k8s-master-01            1/1     Running   0          62s</span><br></pre></td></tr></table></figure><h2 id="åŠ å…¥-node-èŠ‚ç‚¹"><a href="#åŠ å…¥-node-èŠ‚ç‚¹" class="headerlink" title="åŠ å…¥ node èŠ‚ç‚¹"></a>åŠ å…¥ node èŠ‚ç‚¹</h2><p>åœ¨å¦ä¸€å° Node èŠ‚ç‚¹ä¸Šé‡å¤èŠ‚ç‚¹åˆå§‹åŒ–çš„å†…å®¹ï¼Œå¹¶å°†å°†æ‰€éœ€çš„é•œåƒå¯¼å…¥åˆ° node èŠ‚ç‚¹ã€‚ä¹‹åä½¿ç”¨ kubeadm joine å‘½ä»¤å°† Node èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­å³å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-node-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubeadm join 10.20.172.211:6443 --token hi66lb.r13y2hottst2ks6f \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">     --discovery-token-ca-cert-hash sha256:9b96a436f2897a8371fccb3af4d8f2fff348fcb42763e005e9175a4e925c51d1</span></span><br><span class="line">W0415 00:52:08.127829    9901 join.go:346] [preflight] WARNING: JoinControlPane.controlPlane settings will be ignored when control-plane flag is not set.</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">        [WARNING Hostname]: hostname "k8s-node-01" could not be reached</span><br><span class="line">        [WARNING Hostname]: hostname "k8s-node-01": lookup k8s-node-01 on 192.168.10.254:53: no such host</span><br><span class="line">        [WARNING Service-Kubelet]: kubelet service is not enabled, please run 'systemctl enable kubelet.service'</span><br><span class="line">[preflight] Reading configuration from the cluster...</span><br><span class="line">[preflight] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml'</span><br><span class="line">[kubelet-start] Downloading configuration for the kubelet from the "kubelet-config-1.17" ConfigMap in the kube-system namespace</span><br><span class="line">[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"</span><br><span class="line">[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"</span><br><span class="line">[kubelet-start] Starting the kubelet</span><br><span class="line">[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...</span><br><span class="line"></span><br><span class="line">This node has joined the cluster:</span><br><span class="line">* Certificate signing request was sent to apiserver and a response was received.</span><br><span class="line">* The Kubelet was informed of the new secure connection details.</span><br><span class="line"></span><br><span class="line">Run 'kubectl get nodes' on the control-plane to see this node join the cluster.</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸å‡ºæ„å¤–çš„è¯ä¼šæç¤º <code>This node has joined the cluster:</code> ï¼Œç„¶ååœ¨ master èŠ‚ç‚¹çœ‹ä¸€ä¸‹èŠ‚ç‚¹æ˜¯å¦åŠ å…¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl get node</span><br><span class="line">NAME            STATUS     ROLES    AGE   VERSION</span><br><span class="line">k8s-master-01   NotReady   master   31m   v1.17.4</span><br><span class="line">k8s-node-01     NotReady   &lt;none&gt;   58s   v1.17.4</span><br></pre></td></tr></table></figure><p>å¦‚æœçŠ¶æ€è¿˜æ˜¯ <code>NotReady</code> ä¸è¦æ…Œï¼Œé—®é¢˜ä¸å¤§è§£ææ¥å®‰è£… CNI ç½‘ç»œæ’ä»¶å³å¯</p><h2 id="éƒ¨ç½²ç½‘ç»œæ’ä»¶"><a href="#éƒ¨ç½²ç½‘ç»œæ’ä»¶" class="headerlink" title="éƒ¨ç½²ç½‘ç»œæ’ä»¶"></a>éƒ¨ç½²ç½‘ç»œæ’ä»¶</h2><p>åœ¨è¿™æˆ‘ä»¬ä½¿ç”¨ flannel ä½œä¸º Kubernetes ç½‘ç»œè§£å†³æ–¹æ¡ˆï¼Œåœ¨ kubeadm init çš„æ—¶å€™æŒ‡å®šçš„ â€“pod-network-cidr= æŒ‡å®š Pod ç½‘æ®µçš„ IP åœ°å€å—ï¼Œå³ä¸º flannel é»˜è®¤çš„ IP æ®µï¼Œå¦‚æœæ²¡æœ‰ä¿®æ”¹çš„è¯å°±ç›´æ¥åœ¨ master èŠ‚ç‚¹ä¸Šä½¿ç”¨ kubectl apply -f å‘½ä»¤éƒ¨ç½²å³å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure><p>ç”±äºå¢™å›½ç½‘ç»œåŸå› ï¼Œè®¿é—® <code>raw.githubusercontent.com</code> è¿™ä¸ªåŸŸåä¼šæ¯”è¾ƒæ…¢ï¼Œåœ¨è¿™é‡Œå¯ä»¥ä½¿ç”¨ jsdelivr æ¥è¿›è¡ŒåŠ é€Ÿã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl apply -f https://cdn.jsdelivr.net/gh/coreos/flannel/Documentation/kube-flannel.yml</span><br><span class="line">podsecuritypolicy.policy/psp.flannel.unprivileged created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/flannel created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/flannel created</span><br><span class="line">serviceaccount/flannel created</span><br><span class="line">configmap/kube-flannel-cfg created</span><br><span class="line">daemonset.apps/kube-flannel-ds-amd64 created</span><br><span class="line">daemonset.apps/kube-flannel-ds-arm64 created</span><br><span class="line">daemonset.apps/kube-flannel-ds-arm created</span><br><span class="line">daemonset.apps/kube-flannel-ds-ppc64le created</span><br><span class="line">daemonset.apps/kube-flannel-ds-s390x created</span><br></pre></td></tr></table></figure><p>flannel çš„ docker é•œåƒæ˜¯åœ¨ <code>quay.io/coreos/flannel</code> ä¸€èˆ¬æƒ…å†µä¸‹æ²¡é—®é¢˜èƒ½é¡ºåˆ© pull ä¸‹æ¥ã€‚ç„¶åä½¿ç”¨ <code>kubectl get pod -n kube-system</code> å‘½ä»¤æŸ¥çœ‹ pod çš„çŠ¶æ€æ˜¯ä¸æ˜¯éƒ½åœ¨ running çŠ¶æ€ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl get pod -n kube-system</span><br><span class="line">NAME                                    READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-6955765f44-g5fwl                1/1     Running   0          23h</span><br><span class="line">coredns-6955765f44-g7cls                1/1     Running   0          23h</span><br><span class="line">etcd-k8s-master-01                      1/1     Running   0          24h</span><br><span class="line">kube-apiserver-k8s-master-01            1/1     Running   0          24h</span><br><span class="line">kube-controller-manager-k8s-master-01   1/1     Running   0          24h</span><br><span class="line">kube-flannel-ds-amd64-94hfr             1/1     Running   0          23h</span><br><span class="line">kube-flannel-ds-amd64-vpdfd             1/1     Running   0          23h</span><br><span class="line">kube-proxy-rmgwl                        1/1     Running   0          24h</span><br><span class="line">kube-proxy-xqcsq                        1/1     Running   0          24h</span><br><span class="line">kube-scheduler-k8s-master-01            1/1     Running   0          24h</span><br><span class="line"></span><br><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl get node</span><br><span class="line">NAME            STATUS   ROLES    AGE   VERSION</span><br><span class="line">k8s-master-01   Ready    master   29h   v1.17.4</span><br><span class="line">k8s-node-01     Ready    &lt;none&gt;   28h   v1.17.4</span><br></pre></td></tr></table></figure><p>ç”±æ­¤ï¼Œä¸€ä¸ªç®€é™‹çš„ kubernetes é›†ç¾¤å·²ç»éƒ¨ç½²å®Œäº†ğŸ˜‚ï¼Œæ–‡ç« æœ‰ç‚¹æ°´äº†~~ã€‚å¯¹äºæƒ³è¦å…¥é—¨å’Œå­¦ä¹  kubernetes çš„åŒå­¦æ¥è¯´ kubeadm æ˜¯ä¸ªå¥½å·¥å…·ã€‚åç»­ä¼šæ›´æ–°ä¸€äº› kubernetes å†…å®¹ã€‚</p><h2 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h2><p>æœ€åæä¸€ä¸‹ï¼Œæ–‡ä¸­æåˆ°çš„å¯¹äºä¸‹è½½ github ä¸Šæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹è§„åˆ™è¿›è¡Œæ›¿æ¢ï¼Œå°±å¯ä»¥ä½¿ç”¨ jsdelivr æ¥ fuck ä¸€ä¸‹ GFW ï¼Œæ— ç—›ä¸‹è½½ GitHub ä¸Šçš„æ–‡ä»¶ã€‚è¿™è¿˜æ˜¯ä» <a href="https://chanshiyu.com/#/post/94" target="_blank" rel="noopener">JsDelivr å…¨ç«™æ‰˜ç®¡</a> å­¦æ¥çš„éªšæ“ä½œğŸ˜‚ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">GitHub rul:</span> <span class="string">https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh</span></span><br><span class="line"><span class="attr">jsDelivr url:</span> <span class="string">https://cdn.jsdelivr.net/gh/ohmyzsh/ohmyzsh/tools/install.sh</span></span><br></pre></td></tr></table></figure><p>è§„åˆ™å°±æ˜¯å°† <code>github.com</code> æ›¿æ¢ä¸º <code>cdn.jsdelivr.net/gh</code> ï¼Œç„¶åå»æ‰ <code>/blob/master</code>ï¼Œæ¥ä¸Š repo é‡Œæ–‡ä»¶çš„ç»å¯¹è·¯å¾„å³å¯ã€‚ä¹Ÿå¯ä»¥å°†ä»¥ä¸‹è„šæœ¬ä¿å­˜ä¸ºä¸€ä¸ªå¯æ‰§è¡Œè„šæœ¬æ–‡ä»¶ /usr/bin/rawgï¼Œå½“ä½¿ç”¨ rawg <a href="https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh" target="_blank" rel="noopener">https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh</a> å°±å¯ä»¥ç›´æ¥å°† url è¿›è¡Œæ›¿æ¢ï¼Œå¿«é€Ÿåœ°ä¸‹è½½æ–‡ä»¶ã€‚æ€ä¹ˆæ ·ï¼Œå¾ˆçˆ½å§ğŸ˜‚ï¼Œå¯¹äºæŸäº› Linux æœºå™¨ä¸Šæ²¡æœ‰ä»£ç†çš„æƒ…å†µä¸‹è¯¥æ–¹æ³•æœ‰æ•ˆã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> data: 2020-03-31</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> author: muzi502</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span>: Fuck GFW and download some raw file form github without proxy using jsDelivr CDN</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> usage: save the .she to your <span class="built_in">local</span> such as /usr/bin/rawg, and chmod +x /usr/bin/rawg</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> use rawg https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh to download</span></span><br><span class="line"></span><br><span class="line">set -xue</span><br><span class="line"><span class="meta">#</span><span class="bash"> GitHub rul: https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> jsDelivr url: https://cdn.jsdelivr.net/gh/ohmyzsh/ohmyzsh/tools/install.sh</span></span><br><span class="line"></span><br><span class="line">wget $(echo $1 | sed 's/raw.githubusercontent.com/cdn.jsdelivr.net\/gh/' \</span><br><span class="line">               | sed 's/github.com/cdn.jsdelivr.net\/gh/' \</span><br><span class="line">               | sed 's/\/master//' | sed 's/\/blob//' )</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> curl $(<span class="built_in">echo</span> <span class="variable">$1</span> | sed <span class="string">'s/raw.githubusercontent.com/cdn.jsdelivr.net\/gh/'</span> \</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                | sed <span class="string">'s/github.com/cdn.jsdelivr.net\/gh/'</span> \</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                | sed <span class="string">'s/\/master//'</span> | sed <span class="string">'s/\/blob//'</span> )</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;ç‚’å†·é¥­&quot;&gt;&lt;a href=&quot;#ç‚’å†·é¥­&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="kubernetes" scheme="https://blog.k8s.li/tags/kubernetes/"/>
    
      <category term="kubeadm" scheme="https://blog.k8s.li/tags/kubeadm/"/>
    
      <category term="ä»é›¶å¼€å§‹å­¦ä¹  K8s" scheme="https://blog.k8s.li/tags/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%AD%A6%E4%B9%A0-K8s/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäº Gitlab-ci + Harobr çš„ CI æµæ°´çº¿</title>
    <link href="https://blog.k8s.li/gitlab-ci-harbor.html"/>
    <id>https://blog.k8s.li/gitlab-ci-harbor.html</id>
    <published>2020-04-11T16:00:00.000Z</published>
    <updated>2020-04-11T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¯¹äº CI/CDï¼ˆæŒç»­é›†æˆä¸æŒç»­äº¤ä»˜ï¼‰çš„åŸºæœ¬æ¦‚å¿µç½‘ç»œä¸Šå·²ç»æœ‰å¾ˆå¤šå¤§ä½¬åœ¨æ™®åŠå•¦ï¼Œå’±æ‰ç–å­¦æµ…æ€•è¯¯äººå­å¼Ÿæ‰€ä»¥å°±å‰½çªƒä¸€ä¸‹åˆ«äººçš„è§£é‡Šå•¦ğŸ˜‚ã€‚ä¸‹é¢å°±å‰½çªƒä¸€ä¸‹çº¢å¸½å­å®¶çš„ <a href="https://www.redhat.com/zh/topics/devops/what-is-ci-cd" target="_blank" rel="noopener">CI/CDæ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ç†è§£æŒç»­é›†æˆã€æŒç»­äº¤ä»˜å’ŒæŒç»­éƒ¨ç½²</a> å®˜æ–¹æ–‡æ¡£ï¼š</p><p><strong>CI æŒç»­é›†æˆ</strong></p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/409-images-for-snap-blog-postedit_image1.png" alt="Continuous integration puts the integration phase earlier in the development cycle"></p><p>å›¾ç‰‡å‰½çªƒè‡ª  <a href="https://www.mindtheproduct.com/what-the-hell-are-ci-cd-and-devops-a-cheatsheet-for-the-rest-of-us/" target="_blank" rel="noopener">The Product Managersâ€™ Guide to Continuous Delivery and DevOps</a></p><blockquote><p>CI/CD ä¸­çš„â€œCIâ€å§‹ç»ˆæŒ‡æŒç»­é›†æˆï¼Œå®ƒå±äºå¼€å‘äººå‘˜çš„è‡ªåŠ¨åŒ–æµç¨‹ã€‚æˆåŠŸçš„ CI æ„å‘³ç€åº”ç”¨ä»£ç çš„æ–°æ›´æ”¹ä¼šå®šæœŸæ„å»ºã€æµ‹è¯•å¹¶åˆå¹¶åˆ°å…±äº«å­˜å‚¨åº“ä¸­ã€‚è¯¥è§£å†³æ–¹æ¡ˆå¯ä»¥è§£å†³åœ¨ä¸€æ¬¡å¼€å‘ä¸­æœ‰å¤ªå¤šåº”ç”¨åˆ†æ”¯ï¼Œä»è€Œå¯¼è‡´ç›¸äº’å†²çªçš„é—®é¢˜ã€‚</p></blockquote><p><strong>CD æŒç»­äº¤ä»˜</strong></p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/409-images-for-snap-blog-postedit_image4-manual.png" alt="Continuous Delivery is a software development discipline "></p><p>å›¾ç‰‡å‰½çªƒè‡ª <a href="https://www.mindtheproduct.com/what-the-hell-are-ci-cd-and-devops-a-cheatsheet-for-the-rest-of-us/" target="_blank" rel="noopener">The Product Managersâ€™ Guide to Continuous Delivery and DevOps</a></p><blockquote><p>CI/CD ä¸­çš„â€œCDâ€æŒ‡çš„æ˜¯æŒç»­äº¤ä»˜å’Œ/æˆ–æŒç»­éƒ¨ç½²ï¼Œè¿™äº›ç›¸å…³æ¦‚å¿µæœ‰æ—¶ä¼šäº¤å‰ä½¿ç”¨ã€‚ä¸¤è€…éƒ½äº‹å…³ç®¡é“åç»­é˜¶æ®µçš„è‡ªåŠ¨åŒ–ï¼Œä½†å®ƒä»¬æœ‰æ—¶ä¹Ÿä¼šå•ç‹¬ä½¿ç”¨ï¼Œç”¨äºè¯´æ˜è‡ªåŠ¨åŒ–ç¨‹åº¦ã€‚</p><p>æŒç»­<em>äº¤ä»˜</em>é€šå¸¸æ˜¯æŒ‡å¼€å‘äººå‘˜å¯¹åº”ç”¨çš„æ›´æ”¹ä¼šè‡ªåŠ¨è¿›è¡Œé”™è¯¯æµ‹è¯•å¹¶ä¸Šä¼ åˆ°å­˜å‚¨åº“ï¼ˆå¦‚ <a href="https://redhatofficial.github.io/#!/main" target="_blank" rel="noopener">GitHub</a> æˆ–å®¹å™¨æ³¨å†Œè¡¨ï¼‰ï¼Œç„¶åç”±è¿ç»´å›¢é˜Ÿå°†å…¶éƒ¨ç½²åˆ°å®æ—¶ç”Ÿäº§ç¯å¢ƒä¸­ã€‚è¿™æ—¨åœ¨è§£å†³å¼€å‘å’Œè¿ç»´å›¢é˜Ÿä¹‹é—´å¯è§æ€§åŠæ²Ÿé€šè¾ƒå·®çš„é—®é¢˜ã€‚å› æ­¤ï¼ŒæŒç»­äº¤ä»˜çš„ç›®çš„å°±æ˜¯ç¡®ä¿å°½å¯èƒ½å‡å°‘éƒ¨ç½²æ–°ä»£ç æ—¶æ‰€éœ€çš„å·¥ä½œé‡ã€‚</p></blockquote><p><strong>æŒç»­éƒ¨ç½²</strong></p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/409-images-for-snap-blog-postedit_image4-manual-1585574252795.png" alt="Continuous Delivery is a software development discipline "></p><p>å›¾ç‰‡å‰½çªƒè‡ª  <a href="https://www.mindtheproduct.com/what-the-hell-are-ci-cd-and-devops-a-cheatsheet-for-the-rest-of-us/" target="_blank" rel="noopener">The Product Managersâ€™ Guide to Continuous Delivery and DevOps</a></p><blockquote><p>æŒç»­<em>éƒ¨ç½²</em>ï¼ˆå¦ä¸€ç§â€œCDâ€ï¼‰æŒ‡çš„æ˜¯è‡ªåŠ¨å°†å¼€å‘äººå‘˜çš„æ›´æ”¹ä»å­˜å‚¨åº“å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼Œä»¥ä¾›å®¢æˆ·ä½¿ç”¨ã€‚å®ƒä¸»è¦ä¸ºäº†è§£å†³å› æ‰‹åŠ¨æµç¨‹é™ä½åº”ç”¨äº¤ä»˜é€Ÿåº¦ï¼Œä»è€Œä½¿è¿ç»´å›¢é˜Ÿè¶…è´Ÿè·çš„é—®é¢˜ã€‚æŒç»­éƒ¨ç½²ä»¥æŒç»­äº¤ä»˜çš„ä¼˜åŠ¿ä¸ºæ ¹åŸºï¼Œå®ç°äº†ç®¡é“åç»­é˜¶æ®µçš„è‡ªåŠ¨åŒ–ã€‚</p></blockquote><p>æ€»ä¹‹è€Œè¨€  CI/CD æ˜¯ä¸€æ•´å¥—è½¯ä»¶å¼€å‘çš„æµæ°´çº¿ï¼Œå¼€å‘äººå‘˜æäº¤å®Œæ›´æ–°çš„ä»£ç ä¹‹åï¼Œæ ¹æ®æµæ°´çº¿çš„è§¦å‘æƒ…å†µæ¥æ‰§è¡Œè‡ªå®šä¹‰çš„æµæ°´çº¿ä»»åŠ¡ï¼Œæ¯”å¦‚ä»£ç è´¨é‡æ£€æµ‹ã€æ„å»º docker é•œåƒä¸ºäº¤ä»˜äº§å“ã€è‡ªåŠ¨åŒ–éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒæˆ–ç”Ÿäº§ç¯å¢ƒç­‰ç­‰ã€‚è¿™äº›éœ€è¦ä¸€ç³»åˆ—ç›¸å…³çš„è½¯ä»¶æ¥æ„å»ºè¿™å¥— CI/CD çš„ç³»ç»Ÿï¼Œæœ¬æ–‡å°±é€šè¿‡ Gitlab + gitlab-ci + Harbor æ„å»ºä¸€ä¸ªç®€é™‹çš„ CI/CD æµæ°´çº¿ã€‚</p><p>å¦å¤–æ¨èè¯»ä¸€ä¸‹è¿™ç¯‡ <a href="https://www.mindtheproduct.com/what-the-hell-are-ci-cd-and-devops-a-cheatsheet-for-the-rest-of-us/" target="_blank" rel="noopener">The Product Managersâ€™ Guide to Continuous Delivery and DevOps </a></p><h2 id="Gitlab"><a href="#Gitlab" class="headerlink" title="Gitlab"></a>Gitlab</h2><p>ç›®å‰ Gitlab å®˜æ–¹ç»™å‡ºçš„å®‰è£…æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œæ™®éé‡‡ç”¨ Omnibus åŒ…ã€Docker å®‰è£…ã€‚ä¹Ÿå¯ä»¥ç”¨å®˜æ–¹çš„ helm Chart éƒ¨ç½²åœ¨ Kubernenets é›†ç¾¤ä¸­ï¼Œç„¶åä½¿ç”¨ç½‘ç»œå­˜å‚¨ï¼Œæ¯”å¦‚ Glusterã€NFSã€Cephã€vSAN ç­‰è¿›è¡Œ PG æ•°æ®åº“å’Œä»£ç ä»“åº“æŒä¹…åŒ–å­˜å‚¨ã€‚</p><p><strong>å®˜æ–¹å»ºè®®é‡‡ç”¨ Omnibus æ–¹å¼å®‰è£…ï¼š</strong></p><blockquote><p>æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½¿ç”¨ Omnibus åŒ…å®‰è£… GitLab ï¼Œå› ä¸ºå®ƒå®‰è£…èµ·æ¥æ›´å¿«ã€æ›´å®¹æ˜“å‡çº§ç‰ˆæœ¬ï¼Œè€Œä¸”åŒ…å«äº†å…¶ä»–å®‰è£…æ–¹å¼æ‰€æ²¡æœ‰çš„å¯é æ€§åŠŸèƒ½ã€‚</p></blockquote><h3 id="Omnibus-åŒ…å®‰è£…æ–¹å¼æ¯”è¾ƒ"><a href="#Omnibus-åŒ…å®‰è£…æ–¹å¼æ¯”è¾ƒ" class="headerlink" title="Omnibus åŒ…å®‰è£…æ–¹å¼æ¯”è¾ƒ"></a>Omnibus åŒ…å®‰è£…æ–¹å¼æ¯”è¾ƒ</h3><p>æ‘˜è‡ªå®˜æ–¹æ–‡æ¡£</p><ul><li>âœ… - Installed by default</li><li>âš™ - Requires additional configuration, or GitLab Managed Apps</li><li>â¤“ - Manual installation required</li><li>âŒ - Not supported or no instructions available</li><li>N/A - Not applicable</li></ul><table><thead><tr><th align="left">Component</th><th align="left">Description</th><th align="center"><a href="https://docs.gitlab.com/omnibus/" target="_blank" rel="noopener">Omnibus GitLab</a></th><th align="center"><a href="https://docs.gitlab.com/charts/" target="_blank" rel="noopener">GitLab chart</a></th><th align="center"><a href="https://gitlab.com/" target="_blank" rel="noopener">GitLab.com</a></th></tr></thead><tbody><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#nginx" target="_blank" rel="noopener">NGINX</a></td><td align="left">Routes requests to appropriate components, terminates SSL</td><td align="center"><a href="https://docs.gitlab.com/omnibus/settings/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/nginx/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#service-architecture" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#unicorn" target="_blank" rel="noopener">Unicorn (GitLab Rails)</a></td><td align="left">Handles requests for the web interface and API</td><td align="center"><a href="https://docs.gitlab.com/omnibus/settings/unicorn.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/unicorn/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#unicorn" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#sidekiq" target="_blank" rel="noopener">Sidekiq</a></td><td align="left">Background jobs processor</td><td align="center"><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-config-template/gitlab.rb.template" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/sidekiq/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#sidekiq" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitaly" target="_blank" rel="noopener">Gitaly</a></td><td align="left">Git RPC service for handling all Git calls made by GitLab</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/gitaly/index.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/gitaly/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#service-architecture" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#praefect" target="_blank" rel="noopener">Praefect</a></td><td align="left">A transparent proxy between any Git client and Gitaly storage nodes.</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/gitaly/index.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/gitaly/" target="_blank" rel="noopener">âŒ</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#service-architecture" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-workhorse" target="_blank" rel="noopener">GitLab Workhorse</a></td><td align="left">Smart reverse proxy, handles large HTTP requests</td><td align="center"><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-config-template/gitlab.rb.template" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/unicorn/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#service-architecture" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-shell" target="_blank" rel="noopener">GitLab Shell</a></td><td align="left">Handles <code>git</code> over SSH sessions</td><td align="center"><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-config-template/gitlab.rb.template" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/gitlab-shell/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#service-architecture" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-pages" target="_blank" rel="noopener">GitLab Pages</a></td><td align="left">Hosts static websites</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/pages/index.html" target="_blank" rel="noopener">âš™</a></td><td align="center"><a href="https://gitlab.com/gitlab-org/charts/gitlab/issues/37" target="_blank" rel="noopener">âŒ</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#gitlab-pages" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#registry" target="_blank" rel="noopener">Registry</a></td><td align="left">Container registry, allows pushing and pulling of images</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/packages/container_registry.html#container-registry-domain-configuration" target="_blank" rel="noopener">âš™</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/registry/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/packages/container_registry/index.html#build-and-push-images-using-gitlab-cicd" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#redis" target="_blank" rel="noopener">Redis</a></td><td align="left">Caching service</td><td align="center"><a href="https://docs.gitlab.com/omnibus/settings/redis.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/omnibus/settings/redis.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#service-architecture" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#postgresql" target="_blank" rel="noopener">PostgreSQL</a></td><td align="left">Database</td><td align="center"><a href="https://docs.gitlab.com/omnibus/settings/database.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://github.com/helm/charts/tree/master/stable/postgresql" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#postgresql" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#pgbouncer" target="_blank" rel="noopener">PgBouncer</a></td><td align="left">Database connection pooling, failover</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/high_availability/pgbouncer.html" target="_blank" rel="noopener">âš™</a></td><td align="center"><a href="https://docs.gitlab.com/charts/installation/deployment.html#postgresql" target="_blank" rel="noopener">âŒ</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#database-architecture" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#consul" target="_blank" rel="noopener">Consul</a></td><td align="left">Database node discovery, failover</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/high_availability/consul.html" target="_blank" rel="noopener">âš™</a></td><td align="center"><a href="https://docs.gitlab.com/charts/installation/deployment.html#postgresql" target="_blank" rel="noopener">âŒ</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#consul" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#prometheus" target="_blank" rel="noopener">GitLab self-monitoring: Prometheus</a></td><td align="left">Time-series database, metrics collection, and query service</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/prometheus/index.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://github.com/helm/charts/tree/master/stable/prometheus" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#prometheus" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#alertmanager" target="_blank" rel="noopener">GitLab self-monitoring: Alertmanager</a></td><td align="left">Deduplicates, groups, and routes alerts from Prometheus</td><td align="center"><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-config-template/gitlab.rb.template" target="_blank" rel="noopener">âš™</a></td><td align="center"><a href="https://github.com/helm/charts/tree/master/stable/prometheus" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/monitoring/" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#grafana" target="_blank" rel="noopener">GitLab self-monitoring: Grafana</a></td><td align="left">Metrics dashboard</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/performance/grafana_configuration.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://github.com/helm/charts/tree/master/stable/grafana" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://dashboards.gitlab.com/d/RZmbBr7mk/gitlab-triage?refresh=30s" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#sentry" target="_blank" rel="noopener">GitLab self-monitoring: Sentry</a></td><td align="left">Track errors generated by the GitLab instance</td><td align="center"><a href="https://docs.gitlab.com/omnibus/settings/configuration.html#error-reporting-and-logging-with-sentry" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://gitlab.com/gitlab-org/charts/gitlab/issues/1319" target="_blank" rel="noopener">âŒ</a></td><td align="center"><a href="https://about.gitlab.com/handbook/support/workflows/500_errors.html#searching-sentry" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#jaeger" target="_blank" rel="noopener">GitLab self-monitoring: Jaeger</a></td><td align="left">View traces generated by the GitLab instance</td><td align="center"><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/issues/4104" target="_blank" rel="noopener">âŒ</a></td><td align="center"><a href="https://gitlab.com/gitlab-org/charts/gitlab/issues/1320" target="_blank" rel="noopener">âŒ</a></td><td align="center"><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/issues/4104" target="_blank" rel="noopener">âŒ</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#redis-exporter" target="_blank" rel="noopener">Redis Exporter</a></td><td align="left">Prometheus endpoint with Redis metrics</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/prometheus/redis_exporter.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/redis/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/monitoring/" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#postgresql-exporter" target="_blank" rel="noopener">PostgreSQL Exporter</a></td><td align="left">Prometheus endpoint with PostgreSQL metrics</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/prometheus/postgres_exporter.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://github.com/helm/charts/tree/master/stable/postgresql" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/monitoring/" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#pgbouncer-exporter" target="_blank" rel="noopener">PgBouncer Exporter</a></td><td align="left">Prometheus endpoint with PgBouncer metrics</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/prometheus/pgbouncer_exporter.html" target="_blank" rel="noopener">âš™</a></td><td align="center"><a href="https://docs.gitlab.com/charts/installation/deployment.html#postgresql" target="_blank" rel="noopener">âŒ</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/monitoring/" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-exporter" target="_blank" rel="noopener">GitLab Exporter</a></td><td align="left">Generates a variety of GitLab metrics</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/prometheus/gitlab_exporter.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/gitlab-exporter/index.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/monitoring/" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#node-exporter" target="_blank" rel="noopener">Node Exporter</a></td><td align="left">Prometheus endpoint with system metrics</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/prometheus/node_exporter.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://gitlab.com/gitlab-org/charts/gitlab/issues/1332" target="_blank" rel="noopener">N/A</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/monitoring/" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#mattermost" target="_blank" rel="noopener">Mattermost</a></td><td align="left">Open-source Slack alternative</td><td align="center"><a href="https://docs.gitlab.com/omnibus/gitlab-mattermost/" target="_blank" rel="noopener">âš™</a></td><td align="center"><a href="https://docs.mattermost.com/install/install-mmte-helm-gitlab-helm.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/integrations/mattermost.html" target="_blank" rel="noopener">â¤“</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#minio" target="_blank" rel="noopener">MinIO</a></td><td align="left">Object storage service</td><td align="center"><a href="https://min.io/download" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/minio/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#storage-architecture" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-runner" target="_blank" rel="noopener">Runner</a></td><td align="left">Executes GitLab CI/CD jobs</td><td align="center"><a href="https://docs.gitlab.com/runner/" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/runner/install/kubernetes.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#shared-runners" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#database-migrations" target="_blank" rel="noopener">Database Migrations</a></td><td align="left">Database migrations</td><td align="center"><a href="https://docs.gitlab.com/omnibus/settings/database.html#disabling-automatic-database-migration" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/migrations/" target="_blank" rel="noopener">âœ…</a></td><td align="center">âœ…</td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#certificate-management" target="_blank" rel="noopener">Certificate Management</a></td><td align="left">TLS Settings, Letâ€™s Encrypt</td><td align="center"><a href="https://docs.gitlab.com/omnibus/settings/ssl.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/installation/tls.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#secrets-management" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-geo" target="_blank" rel="noopener">GitLab Geo Node</a></td><td align="left">Geographically distributed GitLab nodes</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/geo/replication/index.html#setup-instructions" target="_blank" rel="noopener">âš™</a></td><td align="center"><a href="https://gitlab.com/gitlab-org/charts/gitlab/issues/8" target="_blank" rel="noopener">âŒ</a></td><td align="center">âœ…</td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#ldap-authentication" target="_blank" rel="noopener">LDAP Authentication</a></td><td align="left">Authenticate users against centralized LDAP directory</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/auth/ldap.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/globals.html#ldap" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://about.gitlab.com/pricing/#gitlab-com" target="_blank" rel="noopener">âŒ</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#outbound-email" target="_blank" rel="noopener">Outbound email (SMTP)</a></td><td align="left">Send email messages to users</td><td align="center"><a href="https://docs.gitlab.com/omnibus/settings/smtp.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/charts/installation/command-line-options.html#outgoing-email-configuration" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#mail-configuration" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#inbound-email" target="_blank" rel="noopener">Inbound email (SMTP)</a></td><td align="left">Receive messages to update issues</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/incoming_email.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/charts/installation/command-line-options.html#incoming-email-configuration" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#mail-configuration" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#elasticsearch" target="_blank" rel="noopener">Elasticsearch</a></td><td align="left">Improved search within GitLab</td><td align="center"><a href="https://docs.gitlab.com/ee/integration/elasticsearch.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/integration/elasticsearch.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://gitlab.com/groups/gitlab-org/-/epics/153" target="_blank" rel="noopener">âŒ</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#sentry" target="_blank" rel="noopener">Sentry integration</a></td><td align="left">Error tracking for deployed apps</td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/operations/error_tracking.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/operations/error_tracking.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/operations/error_tracking.html" target="_blank" rel="noopener">â¤“</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#jaeger" target="_blank" rel="noopener">Jaeger integration</a></td><td align="left">Distributed tracing for deployed apps</td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/operations/tracing.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/operations/tracing.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/operations/tracing.html" target="_blank" rel="noopener">â¤“</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-managed-apps" target="_blank" rel="noopener">GitLab Managed Apps</a></td><td align="left">Deploy <a href="https://helm.sh/docs/" target="_blank" rel="noopener">Helm</a>, <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/" target="_blank" rel="noopener">Ingress</a>, <a href="https://docs.cert-manager.io/en/latest/" target="_blank" rel="noopener">Cert-Manager</a>, <a href="https://prometheus.io/docs/introduction/overview/" target="_blank" rel="noopener">Prometheus</a>, a <a href="https://docs.gitlab.com/runner/" target="_blank" rel="noopener">Runner</a>, <a href="https://jupyter.org/" target="_blank" rel="noopener">JupyterHub</a>, <a href="https://cloud.google.com/knative/" target="_blank" rel="noopener">Knative</a> to a cluster</td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/clusters/index.html#installing-applications" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/clusters/index.html#installing-applications" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/clusters/index.html#installing-applications" target="_blank" rel="noopener">â¤“</a></td></tr></tbody></table><h2 id="å®‰è£…-Gitlab"><a href="#å®‰è£…-Gitlab" class="headerlink" title="å®‰è£… Gitlab"></a>å®‰è£… Gitlab</h2><p>å’±éµä»å®˜æ–¹çš„å»ºè®®ï¼Œä½¿ç”¨ Omnibus åŒ…çš„æ–¹å¼æ¥éƒ¨ç½² Gitlab å®ä¾‹ã€‚</p><h3 id="Ubuntu-1804"><a href="#Ubuntu-1804" class="headerlink" title="Ubuntu 1804"></a>Ubuntu 1804</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br><span class="line">curl https://packages.gitlab.com/gpg.key 2&gt; /dev/null | sudo apt-key add - &amp;&gt;/dev/null</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ æ¸…åå¤§å­¦çš„é•œåƒç«™æº bionicæ˜¯ Ubuntu18.04 xenialæ˜¯16.04ï¼Œæ ¹æ®è‡ªå·±çš„ Ubuntu å‘è¡Œç‰ˆæœ¬ä¿®æ”¹ä¸€ä¸‹ä¸‹</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu bionic main</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install gitlab-ce</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ wget çš„æ–¹å¼æŠŠ deb åŒ…ä¸‹è½½ä¸‹æ¥</span></span><br><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu/pool/bionic/main/g/gitlab-ce/gitlab-ce_12.3.5-ce.0_amd64.deb</span><br><span class="line"></span><br><span class="line">opkg -i gitlab-ce/gitlab-ce_12.3.5-ce.0_amd64.deb</span><br></pre></td></tr></table></figure><h3 id="CentOS7"><a href="#CentOS7" class="headerlink" title="CentOS7"></a>CentOS7</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…ä¾èµ–</span></span><br><span class="line">sudo yum install -y curl policycoreutils-python openssh-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®é˜²ç«å¢™</span></span><br><span class="line">sudo firewall-cmd --permanent --add-service=http</span><br><span class="line">sudo systemctl reload firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ¸…åå¤§å­¦é•œåƒç«™çš„æºï¼Œä¸‹è½½é€Ÿåº¦ä¼šå¿«äº›ã€‚</span></span><br><span class="line">sudo cat &gt; /etc/yum.repos.d/gitlab-ce.repo &lt;&lt;EOF</span><br><span class="line">[gitlab-ce]</span><br><span class="line">name=Gitlab CE Repository</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">Ece</span><br><span class="line"></span><br><span class="line">sudo yum makecache</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¯ç”¨çš„ç‰ˆæœ¬neng'b</span></span><br><span class="line">yum list gitlab-ce --showduplicates</span><br><span class="line"><span class="comment"># ç„¶åå®‰è£…æœ€æ–°çš„ç‰ˆæœ¬</span></span><br><span class="line">yum install -y gitlab-ce</span><br><span class="line"><span class="comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬ 12.3.5</span></span><br><span class="line">yum install gitlab-ce-12.3.5-ce.0.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ä½¿ç”¨ wget çš„æ–¹å¼æŠŠ rpm åŒ…ä¸‹è½½ä¸‹æ¥å®‰è£…</span></span><br><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-12.8.2-ce.0.el7.x86_64.rpm</span><br><span class="line">yum install gitlab-ce-12.8.2-ce.0.el7.x86_64.rpm</span><br></pre></td></tr></table></figure><p>å®‰è£…æˆåŠŸä¹‹åä¼šå‡ºç° Gitlab çš„ Logo</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">       *.                  *.</span><br><span class="line">      ***                 ***</span><br><span class="line">     *****               *****</span><br><span class="line">    .******             *******</span><br><span class="line">    ********            ********</span><br><span class="line">   ,,,,,,,,,***********,,,,,,,,,</span><br><span class="line">  ,,,,,,,,,,,*********,,,,,,,,,,,</span><br><span class="line">  .,,,,,,,,,,,*******,,,,,,,,,,,,</span><br><span class="line">      ,,,,,,,,,*****,,,,,,,,,.</span><br><span class="line">         ,,,,,,,****,,,,,,</span><br><span class="line">            .,,,***,,,,</span><br><span class="line">                ,*,.</span><br><span class="line"></span><br><span class="line">     _______ __  __          __</span><br><span class="line">    / ____(_) /_/ /   ____ _/ /_</span><br><span class="line">   / / __/ / __/ /   / __ `/ __ \</span><br><span class="line">  / /_/ / / /_/ /___/ /_/ / /_/ /</span><br><span class="line">  \____/_/\__/_____/\__,_/_.___/</span><br><span class="line"></span><br><span class="line">Thank you for installing GitLab!</span><br><span class="line">GitLab was unable to detect a valid hostname for your instance.</span><br><span class="line">Please configure a URL for your GitLab instance by setting `external_url`</span><br><span class="line">configuration in /etc/gitlab/gitlab.rb file.</span><br><span class="line">Then, you can start your GitLab instance by running the following command:</span><br><span class="line">  sudo gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure><h3 id="2-æ‰“è¡¥ä¸ï¼Œè¡¥å……æ±‰åŒ–çš„è¡¥ä¸"><a href="#2-æ‰“è¡¥ä¸ï¼Œè¡¥å……æ±‰åŒ–çš„è¡¥ä¸" class="headerlink" title="2.æ‰“è¡¥ä¸ï¼Œè¡¥å……æ±‰åŒ–çš„è¡¥ä¸"></a>2.æ‰“è¡¥ä¸ï¼Œè¡¥å……æ±‰åŒ–çš„è¡¥ä¸</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://gitlab.com/xhang/gitlab.git</span><br><span class="line"><span class="built_in">cd</span> gitlab</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å½“å‰å®‰è£…çš„ç‰ˆæœ¬</span></span><br><span class="line">gitlab_version=$(cat /opt/gitlab/embedded/service/gitlab-rails/VERSION)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆå¯¹åº”ç‰ˆæœ¬è¡¥ä¸æ–‡ä»¶</span></span><br><span class="line">git diff v<span class="variable">$&#123;gitlab_version&#125;</span> v<span class="variable">$&#123;gitlab_version&#125;</span>-zh &gt; ../<span class="variable">$&#123;gitlab_version&#125;</span>-zh.diff</span><br><span class="line"></span><br><span class="line">gitlab-ctl stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“è¡¥ä¸çš„æ—¶å€™ä¼šæç¤ºä¸€äº›è¡¥ä¸æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¸€å®šè¦è·³è¿‡è¿™äº›æ–‡ä»¶ï¼Œä¸ç„¶åé¢reconfigçš„æ—¶å€™ä¼šæŠ¥é”™çš„ã€‚</span></span><br><span class="line">patch -d /opt/gitlab/embedded/service/gitlab-rails -p1 &lt; <span class="variable">$&#123;gitlab_version&#125;</span>-zh.diff</span><br></pre></td></tr></table></figure><h3 id="3-ä¿®æ”¹é»˜è®¤é…ç½®"><a href="#3-ä¿®æ”¹é»˜è®¤é…ç½®" class="headerlink" title="3. ä¿®æ”¹é»˜è®¤é…ç½®"></a>3. ä¿®æ”¹é»˜è®¤é…ç½®</h3><p>ä¿®æ”¹ gitlab çš„é…ç½®æ–‡ä»¶ <code>/etc/gitlab/gitlab.rb</code></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹ä¸ºä½ è‡ªå·±çš„åŸŸåæˆ–è€… IPï¼Œæ˜¯å•å¼•å·ï¼Œè€Œä¸”å‰é¢çš„ http ä¸è¦æ”¹</span></span><br><span class="line">external_url  'http://gitlab.domain'</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‚®ä»¶é…ç½®ï¼Œæ²¡æœ‰é‚®ä»¶æœåŠ¡å™¨å¯ä»¥å…³é—­é‚®ä»¶æœåŠ¡åŠŸèƒ½</span></span><br><span class="line">gitlab_rails['smtp_enable'] = false</span><br><span class="line">gitlab_rails['smtp_address'] = ""</span><br><span class="line">gitlab_rails['smtp_port'] =  587</span><br><span class="line">gitlab_rails['smtp_user_name'] = ""</span><br><span class="line">gitlab_rails['smtp_password'] = ""</span><br><span class="line">gitlab_rails['smtp_authentication'] = ""</span><br><span class="line">gitlab_rails['smtp_enable_starttls_auto'] =</span><br><span class="line">gitlab_rails['smtp_tls'] =</span><br><span class="line">gitlab_rails['gitlab_email_from'] = ''</span><br></pre></td></tr></table></figure><h3 id="4-åˆå§‹åŒ–è®¾ç½®"><a href="#4-åˆå§‹åŒ–è®¾ç½®" class="headerlink" title="4. åˆå§‹åŒ–è®¾ç½®"></a>4. åˆå§‹åŒ–è®¾ç½®</h3><p>ä¿®æ”¹å®Œæˆé…ç½®ä¹‹åä½¿ç”¨ <code>gitlab-ctl reconfigure</code> é‡æ–°æ›´æ–°ä¸€ä¸‹ gitlab æœåŠ¡çš„é…ç½®ï¼Œæ›´æ–°å®Œæˆé…ç½®ä¹‹åä½¿ç”¨<br><code>gitlab-ctl restart</code> æ¥é‡æ–°å¯åŠ¨ gitlab ã€‚å¦‚æœ reconfigure å¤±è´¥ï¼Œåˆ™éœ€è¦ <code>systemctl enable gitlab- runsvdir &amp;&amp; systemctl restart gitlab- runsvdir</code> é‡å¯ä¸€ä¸‹  <code>gitlab-runsvdir</code> æœåŠ¡ã€‚</p><p>æ‰“å¼€æµè§ˆå™¨è¿›è¡Œåˆå§‹åŒ–è´¦æˆ·è®¾å®šå¯†ç ï¼Œè¿™ä¸ªå¯†ç ä¸º root ç®¡ç†å‘˜è´¦æˆ·çš„å¯†ç ã€‚è®¾ç½®å®Œå¯†ç ä¹‹åä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢ã€‚username ä¸º <code>root</code> å¯†ç ä¸ºåˆšåˆšè®¾ç½®çš„å¯†ç ã€‚</p><h2 id="å®‰è£…-gitlab-runner"><a href="#å®‰è£…-gitlab-runner" class="headerlink" title="å®‰è£… gitlab-runner"></a>å®‰è£… gitlab-runner</h2><h3 id="Debian-Ubuntu"><a href="#Debian-Ubuntu" class="headerlink" title="Debian/Ubuntu"></a>Debian/Ubuntu</h3><p>é¦–å…ˆä¿¡ä»» GitLab çš„ GPG å…¬é’¥:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://packages.gitlab.com/gpg.key 2&gt; /dev/null | sudo apt-key add - &amp;&gt;/dev/null</span><br></pre></td></tr></table></figure><p>å†é€‰æ‹©ä½ çš„ Debian/Ubuntu ç‰ˆæœ¬ï¼Œæ–‡æœ¬æ¡†ä¸­å†…å®¹å†™è¿› <code>/etc/apt/sources.list.d/gitlab-runner.list</code></p><h4 id="Debian"><a href="#Debian" class="headerlink" title="Debian"></a>Debian</h4><p>æ ¹æ®è‡ªå·±çš„å‘è¡Œç‰ˆä»£å·ä¿®æ”¹ä¸€ä¸‹ <code>stretch</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/gitlab-runner/debian stretch main</span><br></pre></td></tr></table></figure><h4 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h4><p>æ ¹æ®è‡ªå·±çš„å‘è¡Œç‰ˆä»£å·ä¿®æ”¹ä¸€ä¸‹ <code>bionic</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/gitlab-runner/ubuntu bionic main</span><br></pre></td></tr></table></figure><p>é…ç½®å¥½ deb æºä¹‹åå†æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt uodate</span><br><span class="line">apt install gitlab-runner -y</span><br></pre></td></tr></table></figure><h3 id="CentOS7-1"><a href="#CentOS7-1" class="headerlink" title="CentOS7"></a>CentOS7</h3><p>æ–°å»º <code>/etc/yum.repos.d/gitlab-runner.repo</code>ï¼Œå†…å®¹ä¸º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[gitlab-runner]</span><br><span class="line">name=gitlab-runner</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-runner/yum/el7</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://packages.gitlab.com/gpg.key</span><br></pre></td></tr></table></figure><p>å†æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo yum makecache</span><br><span class="line">sudo yum install gitlab-runner -y</span><br><span class="line"><span class="comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬ å…¶ä¸­ 12.3.5 å³ä¸ºæŒ‡å®šçš„ç‰ˆæœ¬å·</span></span><br><span class="line">yum install gitlab-runner-12.3.5-1.x86_64 -y</span><br></pre></td></tr></table></figure><h3 id="æ³¨å†Œ-gitlab-runner"><a href="#æ³¨å†Œ-gitlab-runner" class="headerlink" title="æ³¨å†Œ gitlab-runner"></a>æ³¨å†Œ gitlab-runner</h3><p>ä½¿ç”¨ root ç”¨æˆ·ä» web ç«¯ç™»å½•åˆ° gitlab ç®¡ç†ä¸­å¿ƒã€‚åœ¨ <code>æ¦‚è§ˆ</code> â€“&gt; <code>Runner</code> ã€‚åœ¨å³ä¸Šè§’ä¼šæœ‰ä»¥ä¸‹ï¼Œç¨åä¼šç”¨åˆ°ã€‚</p><ul><li>åœ¨ Runner è®¾ç½®æ—¶æŒ‡å®šä»¥ä¸‹ URL</li><li>åœ¨å®‰è£…è¿‡ç¨‹ä¸­ä½¿ç”¨ä»¥ä¸‹æ³¨å†Œä»¤ç‰Œï¼š</li></ul><p>å®‰è£…å¥½ gitlab-runner ä¹‹åå¦‚æœç›´æ¥å‘ gitlab æ³¨å†Œåˆ™ä¼šæç¤ºå¤±è´¥ï¼Œæç¤º <code>ERROR: Registering runner... failed   runner=qRGh2M86 status=500 Internal Server Error</code> ã€‚è¿™æ˜¯å› ä¸º Gitlab é»˜è®¤ç¦æ­¢äº†ç§æœ‰ç½‘æ®µ IP é‡Œçš„ API è¯·æ±‚ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯æ‰è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab ~</span><br><span class="line">â•°â”€<span class="comment"># gitlab-runner register</span></span><br><span class="line">Runtime platform   arch=amd64 os=linux pid=6818 revision=1b659122 version=12.8.0</span><br><span class="line">Running <span class="keyword">in</span> system-mode.</span><br><span class="line">Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):</span><br><span class="line">http://10.10.107.216/</span><br><span class="line">Please enter the gitlab-ci token <span class="keyword">for</span> this runner:</span><br><span class="line">qRGh2M86iTasjBn1dU8L</span><br><span class="line">Please enter the gitlab-ci description <span class="keyword">for</span> this runner:</span><br><span class="line">[gitlab]: runner-centos</span><br><span class="line">Please enter the gitlab-ci tags <span class="keyword">for</span> this runner (comma separated):</span><br><span class="line">centos</span><br><span class="line">ERROR: Registering runner... failed   runner=qRGh2M86 status=500 Internal Server Error</span><br><span class="line">PANIC: Failed to register this runner. Perhaps you are having network problems</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-gitlab-é»˜è®¤ç½‘ç»œè®¾ç½®"><a href="#ä¿®æ”¹-gitlab-é»˜è®¤ç½‘ç»œè®¾ç½®" class="headerlink" title="ä¿®æ”¹ gitlab é»˜è®¤ç½‘ç»œè®¾ç½®"></a>ä¿®æ”¹ gitlab é»˜è®¤ç½‘ç»œè®¾ç½®</h3><p>ä½¿ç”¨ root ç”¨æˆ·ä» web ç«¯ç™»å½•åˆ° gitlab ç®¡ç†ä¸­å¿ƒ http://${ip}/admin ã€‚ç®¡ç†ä¸­å¿ƒ â€“&gt; è®¾ç½® â€“&gt; ç½‘ç»œ â€“&gt; å¤–å‘è¯·æ±‚ â€“&gt; å…è®¸æ¥è‡ªé’©å­å’ŒæœåŠ¡çš„å¯¹æœ¬åœ°ç½‘ç»œçš„è¯·æ±‚ã€‚ä»¥ä¸‹é€‰é¡¹å…¨éƒ¨å…è®¸ï¼Œæ‰èƒ½é€šè¿‡å¤–éƒ¨è¯·æ±‚çš„æ–¹å¼æ³¨å†Œ gitlab-runnerã€‚</p><ul><li>Allow requests to the local network from web hooks and services</li><li>Allow requests to the local network from system hooks</li></ul><p><strong>ä¸ºäº†å®‰å…¨èµ·è§</strong>ï¼Œä¹Ÿå¯ä»¥åœ¨ Whitelist to allow requests to the local network from hooks and services ä¸‹æ–¹çš„é‚£ä¸ªæ¡†æ¡†é‡Œæ·»åŠ ä¸Šç™½åå•ï¼Œå…è®¸æˆæƒçš„ IP ã€‚ä¿®æ”¹å¥½ä¹‹åä¸è¦å¿˜è®°ç‚¹å‡»åº•éƒ¨é‚£ä¸ªç»¿è‰²æŒ‰é’® <code>ä¿å­˜ä¿®æ”¹</code> ã€‚</p><h4 id="500-é”™è¯¯"><a href="#500-é”™è¯¯" class="headerlink" title="500 é”™è¯¯"></a>500 é”™è¯¯</h4><p>å¦‚æœç‚¹å‡» <code>ä¿å­˜ä¿®æ”¹</code> ä¹‹åå°±è·³è½¬åˆ° Gitlab 500 é”™è¯¯çš„é¡µé¢ã€‚å°è¯•åœ¨ç®¡ç†ä¸­å¿ƒä¿®æ”¹å…¶ä»–è®¾ç½®ä¿å­˜æ—¶ï¼Œä¹Ÿä¼šå‡ºç° 500 çš„æƒ…å†µã€‚åœ¨å®‰è£… gitlab çš„æœºå™¨ä¸ŠæŸ¥çœ‹ä¸€ä¸‹æ—¥å¿—ã€‚è¿è¡Œ <code>gitlab-ctl tail</code> æŸ¥çœ‹å®æ—¶çš„æ—¥å¿—ã€‚æ­¤æ—¶ç­‰åˆ°æ—¥å¿—è¾“å‡ºå‡æ…¢çš„æ—¶å€™æˆ‘ä»¬å¤šæŒ‰å‡ ä¸‹å›è½¦ï¼Œç„¶åå°±ç«‹å³å»ç‚¹å‡»<code>ä¿å­˜ä¿®æ”¹</code>  æŒ‰é’®ï¼Œè¿™æ ·å°±èƒ½æ•æ‰åˆ°æ­¤åˆ»çš„é”™è¯¯æ—¥å¿—ã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">==&gt; /<span class="keyword">var</span>/log/gitlab/gitlab-rails/production<span class="variable">.log</span> &lt;==</span><br><span class="line">Started PATCH <span class="string">"/admin/application_settings/network"</span> <span class="keyword">for</span> <span class="number">10</span><span class="variable">.0</span><span class="variable">.30</span><span class="variable">.2</span> at <span class="number">2020</span>-<span class="number">03</span>-<span class="number">10</span> <span class="number">11</span>:<span class="number">08</span>:<span class="number">20</span> +<span class="number">0000</span></span><br><span class="line">Processing by Admin::ApplicationSettingsController#network as HTML</span><br><span class="line">  Parameters: &#123;<span class="string">"utf8"</span>=&gt;<span class="string">"âœ“"</span>, <span class="string">"authenticity_token"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"application_setting"</span>=&gt;&#123;<span class="string">"allow_local_requests_from_web_hooks_and_services"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"allow_local_requests_from_system_hooks"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"outbound_local_requests_whitelist_raw"</span>=&gt;<span class="string">""</span>, <span class="string">"dns_rebinding_protection_enabled"</span>=&gt;<span class="string">"1"</span>&#125;&#125;</span><br><span class="line">Completed <span class="number">500</span> Internal Server Error in <span class="number">40</span>ms (ActiveRecord: <span class="number">14</span><span class="variable">.5ms</span> | Elasticsearch: <span class="number">0</span><span class="variable">.0ms</span>)</span><br><span class="line">OpenSSL::Cipher::CipherError ():</span><br><span class="line">lib/gitlab/crypto_helper<span class="variable">.rb</span>:<span class="number">27</span>:in <span class="meta">`aes256_gcm_decrypt'</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­é”™è¯¯çš„è¾“å‡ºæ˜¯åœ¨ <code>OpenSSL::Cipher::CipherError ():</code></p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Processing by Admin::ApplicationSettingsController#network as HTML</span><br><span class="line">  Parameters: &#123;<span class="string">"utf8"</span>=&gt;<span class="string">"âœ“"</span>, <span class="string">"authenticity_token"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"application_setting"</span>=&gt;&#123;<span class="string">"allow_local_requests_from_web_hooks_and_services"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"allow_local_requests_from_system_hooks"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"outbound_local_requests_whitelist_raw"</span>=&gt;<span class="string">""</span>, <span class="string">"dns_rebinding_protection_enabled"</span>=&gt;<span class="string">"1"</span>&#125;&#125;</span><br><span class="line">Completed <span class="number">500</span> Internal Server Error in <span class="number">40</span>ms (ActiveRecord: <span class="number">14</span><span class="variable">.5ms</span> | Elasticsearch: <span class="number">0</span><span class="variable">.0ms</span>)</span><br><span class="line">OpenSSL::Cipher::CipherError ():</span><br></pre></td></tr></table></figure><blockquote><p>æœç´¢äº†ä¸€ä¸‹ï¼Œå‘ç°ç½‘ä¸Šè¯´æ˜¯ç”±äºè¿ç§»å¯¼å…¥é¡¹ç›®åï¼Œæ²¡æœ‰å¯¼å…¥åŸæ¥çš„åŠ å¯†ä¿¡æ¯<code>/etc/gitlab/gitlab-secrets.json</code>ï¼Œ ä½†æ˜¯åŸæ¥çš„åŠ å¯†ä¿¡æ¯æ–‡ä»¶æˆ‘å·²ç»æ‰¾ä¸åˆ°äº†ï¼Œåé¢å‘ç°å¯ä»¥ç›´æ¥é‡ç½®å°±è¡Œäº†</p><p>å‚è€ƒ <a href="https://hihozhou.com/blog/2019/08/01/gitlab-500.html" target="_blank" rel="noopener">è‡ªæ­gitlabæŠ¥500é”™è¯¯</a></p></blockquote><p>å‘½ä»¤è¡Œè¾“å…¥<code>gitlab-rails console</code>ï¼Œç„¶åè¾“å…¥</p><p><code>ApplicationSetting.current.reset_runners_registration_token!</code>å³å¯ï¼Œè¿™æ ·åœ¨ä¿å­˜ä¿®æ”¹çš„æ—¶å€™å°±ä¸ä¼šå†æŠ¥ 500 çš„é—®é¢˜äº†ã€‚åº”è¯¥æ˜¯é‡æ–°å®‰è£… Gitlab ä¹‹åçš„åŠ å¯†ä¿¡æ¯ä¸å¯¹æ‰€è‡´ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab ~</span><br><span class="line">â•°â”€<span class="comment"># gitlab-rails console</span></span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line"> GitLab:       12.3.5 (2417d5becc7)</span><br><span class="line"> GitLab Shell: 10.0.0</span><br><span class="line"> PostgreSQL:   10.9</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Loading production environment (Rails 5.2.3)</span><br><span class="line">irb(main):001:0&gt; ApplicationSetting.current.reset_runners_registration_token!</span><br><span class="line">=&gt; <span class="literal">true</span></span><br><span class="line">irb(main):002:0&gt; <span class="built_in">exit</span></span><br></pre></td></tr></table></figure><h3 id="åœ¨é¡¹ç›®ä¸­æ³¨å†Œ-Runner"><a href="#åœ¨é¡¹ç›®ä¸­æ³¨å†Œ-Runner" class="headerlink" title="åœ¨é¡¹ç›®ä¸­æ³¨å†Œ Runner"></a>åœ¨é¡¹ç›®ä¸­æ³¨å†Œ Runner</h3><p>ä»¥ä¸Šå·²ç»å®‰è£…å¥½å¹¶ä¿®æ”¹é»˜è®¤çš„ç½‘ç»œè®¾ç½®å…è®¸ runner æ‰€åœ¨çš„ IP å‘ gitlab å‘èµ·å¤–éƒ¨è¯·æ±‚ã€‚è¿è¡Œ <code>gitlab-runner register</code> æ ¹æ®ç›¸åº”çš„æç¤ºè¾“å…¥ <code>URL</code> å’Œ <code>token</code> å³å¯ã€‚æœ€åæ ¹æ®æœºå™¨çš„ç±»å‹é€‰æ‹©å¥½ runner çš„ç±»å‹ï¼Œè¿™ä¸ªä¹Ÿæ˜¯è·‘ CI ä»»åŠ¡æ—¶çš„ç¯å¢ƒï¼Œåˆ°æ—¶å€™å¯ä»¥åœ¨é¡¹ç›®çš„è®¾ç½®ä¸­é€‰æ‹©å¯åŠ¨ç›¸åº”çš„ runner ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@runner ~</span><br><span class="line">â•°â”€<span class="comment"># gitlab-runner register</span></span><br><span class="line">Runtime platform   arch=amd64 os=linux pid=7501 revision=1b659122 version=12.8.0</span><br><span class="line">Running <span class="keyword">in</span> system-mode.</span><br><span class="line">Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):</span><br><span class="line">http://10.10.107.216/</span><br><span class="line">Please enter the gitlab-ci token <span class="keyword">for</span> this runner:</span><br><span class="line">4hjjA7meRGuxEm3LyMjq</span><br><span class="line">Please enter the gitlab-ci description <span class="keyword">for</span> this runner:</span><br><span class="line">[runner]:</span><br><span class="line">Please enter the gitlab-ci tags <span class="keyword">for</span> this runner (comma separated):</span><br><span class="line">centos</span><br><span class="line">Registering runner... succeeded                     runner=4hjjA7me</span><br><span class="line">Please enter the executor: shell, ssh, virtualbox, docker-ssh+machine, kubernetes, docker, docker-ssh, parallels, docker+machine, custom:</span><br><span class="line">[shell]: shell</span><br><span class="line">Runner registered successfully. Feel free to start it, but <span class="keyword">if</span> it<span class="string">'s running already the config should be automatically reloaded!</span></span><br></pre></td></tr></table></figure><ul><li>æç¤ºæˆåŠŸä¹‹åç„¶ååœ¨ <code>ç®¡ç†ä¸­å¿ƒ</code>â€“&gt; <code>æ¦‚è§ˆ</code> â€“&gt; <code>Runner</code> å¯ä»¥æŸ¥çœ‹åˆ°ç›¸åº”çš„ Runner äº†ã€‚ä¹Ÿå¯ä»¥æ‰‹åŠ¨ç¼–è¾‘ <code>/etc/gitlab-runner/config.toml</code> æ¥æ³¨å†Œç›¸åº”ç±»å‹çš„  Runner</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">concurrent</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">check_interval</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="section">[session_server]</span></span><br><span class="line">  session_timeout = 1800</span><br><span class="line"></span><br><span class="line"><span class="section">[[runners]]</span></span><br><span class="line">  name = "runner"</span><br><span class="line">  url = "http://10.10.107.216/"</span><br><span class="line">  token = "ZTSAQ3q6x_upW9toyKTY"</span><br><span class="line">  executor = "shell"</span><br><span class="line">  <span class="section">[runners.custom_build_dir]</span></span><br><span class="line">  <span class="section">[runners.cache]</span></span><br><span class="line">    <span class="section">[runners.cache.s3]</span></span><br><span class="line">    <span class="section">[runners.cache.gcs]</span></span><br><span class="line"></span><br><span class="line"><span class="section">[[runners]]</span></span><br><span class="line">  name = "docker-runner"</span><br><span class="line">  url = "http://10.10.107.216/"</span><br><span class="line">  token = "Cf1cy6yx4Y-bGjVnRf8m"</span><br><span class="line">  executor = "docker"</span><br><span class="line">  <span class="section">[runners.custom_build_dir]</span></span><br><span class="line">  <span class="section">[runners.cache]</span></span><br><span class="line">    <span class="section">[runners.cache.s3]</span></span><br><span class="line">    <span class="section">[runners.cache.gcs]</span></span><br><span class="line">  <span class="section">[runners.docker]</span></span><br><span class="line">  <span class="comment"># åœ¨è¿™é‡Œéœ€è¦æ·»åŠ ä¸Š harbor çš„åœ°å€ï¼Œæ‰èƒ½å…è®¸ pull ç§æœ‰ registry çš„é•œåƒ</span></span><br><span class="line">    allowed_images = ["10.10.107.217/*:*"]</span><br><span class="line">    tls_verify = false</span><br><span class="line">    image = "golang:latest"</span><br><span class="line">    privileged = true</span><br><span class="line">    disable_entrypoint_overwrite = false</span><br><span class="line">    oom_kill_disable = false</span><br><span class="line">    disable_cache = false</span><br><span class="line">    volumes = ["/cache"]</span><br><span class="line">    shm_size = 0</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²-Harbor"><a href="#éƒ¨ç½²-Harbor" class="headerlink" title="éƒ¨ç½² Harbor"></a>éƒ¨ç½² Harbor</h2><ul><li>åœ¨ harbor é¡¹ç›®çš„ release é¡µé¢ä¸‹è½½ç¦»çº¿å®‰è£…åŒ… <a href="https://github.com/goharbor/harbor/releases/download/v1.9.4/harbor-offline-installer-v1.9.4.tgz" target="_blank" rel="noopener">harbor-offline-installer-v1.9.4.tgz</a> åˆ°éƒ¨ç½²çš„æœºå™¨ä¸Šã€‚éƒ¨ç½²ä¹‹å‰éœ€è¦å®‰è£…å¥½ <code>docker</code> å’Œ <code>docker-compose</code> ã€‚ä¹‹åå†ä¿®æ”¹ <code>harbor.yml</code> é…ç½®æ–‡ä»¶ä¸­çš„ä»¥ä¸‹å†…å®¹ï¼š</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hostname éœ€è¦ä¿®æ”¹ä¸ºç›¸åº”çš„åŸŸåæˆ–è€… IP</span></span><br><span class="line"><span class="attr">hostname:</span> <span class="number">10.10</span><span class="number">.107</span><span class="number">.217</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># http related config</span></span><br><span class="line"><span class="attr">http:</span></span><br><span class="line">  <span class="comment"># port for http, default is 80. If https enabled, this port will redirect to https port</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é¦–æ¬¡ç™»å½•æ—¶è®¾å®šçš„ admin è´¦æˆ·å¯†ç </span></span><br><span class="line"><span class="attr">harbor_admin_password:</span> <span class="string">Harbor12345</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®å­˜å‚¨çš„ç›®å½•</span></span><br><span class="line"><span class="attr">data_volume:</span> <span class="string">/data</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># clair CVE æ¼æ´æ•°æ®åº“æ›´æ–°ï¼Œè¿™é‡Œå»ºè®®è®¾ç½®ä¸º 1h</span></span><br><span class="line"><span class="comment"># ç”±äº clair æ•°æ®åº“åœ¨å›½å†…ç½‘ç»œè®¿é—®é—®é¢˜ï¼Œéœ€è¦è®¾ç½® http ä»£ç†</span></span><br><span class="line"><span class="attr">clair:</span></span><br><span class="line">  <span class="comment"># The interval of clair updaters, the unit is hour, set to 0 to disable the updaters.</span></span><br><span class="line">  <span class="attr">updaters_interval:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">proxy:</span></span><br><span class="line">  <span class="attr">http_proxy:</span> <span class="number">10.20</span><span class="number">.172</span><span class="number">.106</span><span class="string">:2080</span></span><br><span class="line">  <span class="attr">https_proxy:</span></span><br><span class="line">  <span class="attr">no_proxy:</span></span><br><span class="line">  <span class="attr">components:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">clair</span></span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶ä¹‹åå†è¿è¡Œ <code>./install.sh --with-clair --with-chartmuseum</code> å°† clair é›†æˆåˆ° harbor ä¸­ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@harbor /opt/harbor</span><br><span class="line">â•°â”€# ./install.sh --with-clair --with-chartmuseum</span><br><span class="line">[Step 0]: checking installation environment ...</span><br><span class="line">[Step 1]: loading Harbor images ...</span><br><span class="line">[Step 2]: preparing environment ...</span><br><span class="line">[Step 3]: starting Harbor ...</span><br><span class="line">Creating network "harbor_harbor" with the default driver</span><br><span class="line">Creating network "harbor_harbor-clair" with the default driver</span><br><span class="line">Creating network "harbor_harbor-chartmuseum" with the default driver</span><br><span class="line">Creating harbor-log ... done</span><br><span class="line">Creating harbor-db     ... done</span><br><span class="line">Creating registryctl   ... done</span><br><span class="line">Creating harbor-portal ... done</span><br><span class="line">Creating chartmuseum   ... done</span><br><span class="line">Creating registry      ... done</span><br><span class="line">Creating redis         ... done</span><br><span class="line">Creating clair         ... done</span><br><span class="line">Creating harbor-core   ... done</span><br><span class="line">Creating harbor-jobservice ... done</span><br><span class="line">Creating nginx             ... done</span><br><span class="line"></span><br><span class="line">âœ” ----Harbor has been installed and started successfully.----</span><br><span class="line"></span><br><span class="line">Now you should be able to visit the admin portal at http://10.20.172.236.</span><br><span class="line">For more details, please visit https://github.com/goharbor/harbor .</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>docker-compose ps</code> æ£€æŸ¥ harbor ç›¸å…³å®¹å™¨æ˜¯å¦æ­£å¸¸ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@harbor /opt/harbor</span><br><span class="line">â•°â”€# docker-compose ps</span><br><span class="line">      Name                     Command                  State                 Ports</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line">chartmuseum         /docker-entrypoint.sh            Up (healthy)   9999/tcp</span><br><span class="line">clair               /docker-entrypoint.sh            Up (healthy)   6060/tcp, 6061/tcp</span><br><span class="line">harbor-core         /harbor/harbor_core              Up (healthy)</span><br><span class="line">harbor-db           /docker-entrypoint.sh            Up (healthy)   5432/tcp</span><br><span class="line">harbor-jobservice   /harbor/harbor_jobservice  ...   Up (healthy)</span><br><span class="line">harbor-log          /bin/sh -c /usr/local/bin/ ...   Up (healthy)   127.0.0.1:1514-&gt;10514/tcp</span><br><span class="line">harbor-portal       nginx -g daemon off;             Up (healthy)   8080/tcp</span><br><span class="line">nginx               nginx -g daemon off;             Up (healthy)   0.0.0.0:80-&gt;8080/tcp</span><br><span class="line">redis               redis-server /etc/redis.conf     Up (healthy)   6379/tcp</span><br><span class="line">registry            /entrypoint.sh /etc/regist ...   Up (healthy)   5000/tcp</span><br><span class="line">registryctl         /harbor/start.sh                 Up (healthy)</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200326163733610.png" alt="image-20200326163733610"></p><h3 id="è®¾ç½®-insecure-registry"><a href="#è®¾ç½®-insecure-registry" class="headerlink" title="è®¾ç½® insecure registry"></a>è®¾ç½® insecure registry</h3><ul><li>åœ¨ runner æœåŠ¡å™¨ä¸Šè®¾ç½®ä¸€ä¸‹ <code>/etc/docker/daemon.json</code> å°†ç§æœ‰ registry çš„ IP åœ°å€å¡«å…¥åˆ° <code>insecure-registries</code> æ•°ç»„ä¸­ã€‚è¿™æ ·æ‰å¯ä»¥æ¨é€å’Œæ‹‰å–é•œåƒ</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"insecure-registries"</span> : [<span class="string">"10.10.107.217"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>docker login</code> æµ‹è¯•æ˜¯å¦èƒ½ç™»å½•æˆåŠŸï¼š</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@docker-230 /opt</span><br><span class="line">â•°â”€# docker login 10.10.107.217</span><br><span class="line">Username: admin</span><br><span class="line">Password:</span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure><ul><li>ç™»å½•åˆ° harbor æ–°å»ºä¸€ä¸ªé¡¹ç›®ä»“åº“ï¼Œå¹¶æŒ‰ç…§ <code>docker tag SOURCE_IMAGE[:TAG] 10.20.172.236/ciest/IMAGE[:TAG]</code> æ ¼å¼ç»™æœ¬åœ° docker é•œåƒæ‰“ä¸Š tag å¹¶æµ‹è¯•æ¨é€åˆ° harbor æ˜¯å¦æˆåŠŸã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@docker-230 /opt</span><br><span class="line">â•°â”€# docker tag openjdk:8-jdk-alpine 10.10.107.217/ops/openjdk:8-jdk-alpine</span><br><span class="line">â•­â”€root@docker-230 /opt</span><br><span class="line">â•°â”€# docker push !$</span><br><span class="line">â•­â”€root@docker-230 /opt</span><br><span class="line">â•°â”€# docker push 10.10.107.217/ops/openjdk:8-jdk-alpine</span><br><span class="line">The push refers to repository [10.10.107.217/ops/openjdk]</span><br><span class="line">ceaf9e1ebef5: Mounted from ops/ci-test</span><br><span class="line">9b9b7f3d56a0: Mounted from ops/ci-test</span><br><span class="line">f1b5933fe4b5: Mounted from ops/ci-test</span><br><span class="line">8-jdk-alpine: digest: sha256:44b3cea369c947527e266275cee85c71a81f20fc5076f6ebb5a13f19015dce71 size: 947</span><br></pre></td></tr></table></figure><ul><li>åœ¨ harbor é¡¹ç›®çš„é¡µé¢æŸ¥çœ‹æ˜¯å¦æ¨é€æˆåŠŸ</li></ul><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200326170403918.png" alt="image-20200326170403918"></p><h2 id="æµ‹è¯•-CI-CD-é¡¹ç›®"><a href="#æµ‹è¯•-CI-CD-é¡¹ç›®" class="headerlink" title="æµ‹è¯• CI/CD é¡¹ç›®"></a>æµ‹è¯• CI/CD é¡¹ç›®</h2><ul><li>åœ¨ Gitlab ä¸­ä½¿ç”¨ Spring æ¨¡æ¿æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå¹¶æ·»åŠ  <code>.gitlab-ci.yaml</code> é…ç½®æ–‡ä»¶ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200326170523433.png" alt="image-20200326170523433"></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line"><span class="attr">build-master:</span></span><br><span class="line">  <span class="comment"># Official docker image.</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">docker:latest</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">maven-runner</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">services:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker:dind</span></span><br><span class="line">  <span class="attr">before_script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">login</span> <span class="string">-u</span> <span class="string">"$CI_REGISTRY_USER"</span> <span class="string">-p</span> <span class="string">"$CI_REGISTRY_PASSWORD"</span> <span class="string">$CI_REGISTRY</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">info</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">build</span> <span class="string">--pull</span> <span class="string">-t</span> <span class="string">"$CI_REGISTRY_IMAGE"</span> <span class="string">.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">push</span> <span class="string">"$CI_REGISTRY_IMAGE"</span></span><br><span class="line">  <span class="attr">allow_failure:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="comment"># Official docker image.</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">docker:latest</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">services:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker:dind</span></span><br><span class="line">  <span class="attr">before_script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">login</span> <span class="string">-u</span> <span class="string">"$CI_REGISTRY_USER"</span> <span class="string">-p</span> <span class="string">"$CI_REGISTRY_PASSWORD"</span> <span class="string">$CI_REGISTRY</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">build</span> <span class="string">--pull</span> <span class="string">-t</span> <span class="string">"$CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG"</span> <span class="string">.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">push</span> <span class="string">"$CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG"</span></span><br><span class="line">  <span class="attr">except:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><h3 id="gitlab-ci-yaml"><a href="#gitlab-ci-yaml" class="headerlink" title=".gitlab-ci.yaml"></a>.gitlab-ci.yaml</h3><p><code>.gitlab-ci.yaml</code> æ–‡ä»¶çš„é…ç½®é«˜åº¦ä¾èµ–äºé¡¹ç›®æœ¬èº«ï¼Œä»¥åŠ CI/CD æµæ°´çº¿çš„éœ€æ±‚ã€‚å…¶é…ç½®æ–‡ä»¶ä¸»è¦ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š</p><h4 id="Pipeline"><a href="#Pipeline" class="headerlink" title="Pipeline"></a>Pipeline</h4><p>ä¸€æ¬¡ Pipeline å…¶å®ç›¸å½“äºä¸€æ¬¡æ„å»ºä»»åŠ¡ï¼Œé‡Œé¢å¯ä»¥åŒ…å«å¾ˆå¤šä¸ªæµç¨‹ï¼Œå¦‚å®‰è£…ä¾èµ–ã€è¿è¡Œæµ‹è¯•ã€ç¼–è¯‘ã€éƒ¨ç½²æµ‹è¯•æœåŠ¡å™¨ã€éƒ¨ç½²ç”Ÿäº§æœåŠ¡å™¨ç­‰æµç¨‹ã€‚ä»»ä½•æäº¤æˆ–è€… Merge Request çš„åˆå¹¶éƒ½å¯ä»¥è§¦å‘ Pipeline æ„å»ºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+------------------+           +----------------+</span><br><span class="line">|                  |  trigger  |                |</span><br><span class="line">|   Commit &#x2F; MR    +----------&gt;+    Pipeline    |</span><br><span class="line">|                  |           |                |</span><br><span class="line">+------------------+           +----------------+</span><br></pre></td></tr></table></figure><h4 id="Stages"><a href="#Stages" class="headerlink" title="Stages"></a>Stages</h4><p>Stages è¡¨ç¤ºä¸€ä¸ªæ„å»ºé˜¶æ®µï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„ä¸€ä¸ªæµç¨‹ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¸€æ¬¡ Pipeline ä¸­å®šä¹‰å¤šä¸ª Stagesï¼Œè¿™äº› Stages ä¼šæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>æ‰€æœ‰ Stages ä¼šæŒ‰ç…§é¡ºåºè¿è¡Œï¼Œå³å½“ä¸€ä¸ª Stage å®Œæˆåï¼Œä¸‹ä¸€ä¸ª Stage æ‰ä¼šå¼€å§‹</li><li>åªæœ‰å½“æ‰€æœ‰ Stages å®Œæˆåï¼Œè¯¥æ„å»ºä»»åŠ¡ (Pipeline) æ‰ä¼šæˆåŠŸ</li><li>å¦‚æœä»»ä½•ä¸€ä¸ª Stage å¤±è´¥ï¼Œé‚£ä¹ˆåé¢çš„ Stages ä¸ä¼šæ‰§è¡Œï¼Œè¯¥æ„å»ºä»»åŠ¡ (Pipeline) å¤±è´¥</li></ul><p>Stages å’Œ Pipeline çš„å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+--------------------------------------------------------+</span><br><span class="line">|                                                        |</span><br><span class="line">|  Pipeline                                              |</span><br><span class="line">|                                                        |</span><br><span class="line">|  +-----------+     +------------+      +------------+  |</span><br><span class="line">|  |  Stage 1  |----&gt;|   Stage 2  |-----&gt;|   Stage 3  |  |</span><br><span class="line">|  +-----------+     +------------+      +------------+  |</span><br><span class="line">|                                                        |</span><br><span class="line">+--------------------------------------------------------+</span><br></pre></td></tr></table></figure><h4 id="Jobs"><a href="#Jobs" class="headerlink" title="Jobs"></a>Jobs</h4><p>Jobs è¡¨ç¤ºæ„å»ºå·¥ä½œï¼Œè¡¨ç¤ºæŸä¸ª Stage é‡Œé¢æ‰§è¡Œçš„å·¥ä½œã€‚æˆ‘ä»¬å¯ä»¥åœ¨ Stages é‡Œé¢å®šä¹‰å¤šä¸ª Jobsï¼Œè¿™äº› Jobs ä¼šæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>ç›¸åŒ Stage ä¸­çš„ Jobs ä¼šå¹¶è¡Œæ‰§è¡Œ</li><li>ç›¸åŒ Stage ä¸­çš„ Jobs éƒ½æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œè¯¥ Stage æ‰ä¼šæˆåŠŸ</li><li>å¦‚æœä»»ä½•ä¸€ä¸ª Job å¤±è´¥ï¼Œé‚£ä¹ˆè¯¥ Stage å¤±è´¥ï¼Œå³è¯¥æ„å»ºä»»åŠ¡ (Pipeline) å¤±è´¥</li></ul><p>Jobs å’Œ Stage çš„å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+------------------------------------------+</span><br><span class="line">|                                          |</span><br><span class="line">|  Stage 1                                 |</span><br><span class="line">|                                          |</span><br><span class="line">|  +---------+  +---------+  +---------+   |</span><br><span class="line">|  |  Job 1  |  |  Job 2  |  |  Job 3  |   |</span><br><span class="line">|  +---------+  +---------+  +---------+   |</span><br><span class="line">|                                          |</span><br><span class="line">+------------------------------------------+</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸€ä¸ª<code>.gitlab-ci.yaml</code>  æ ·ä¾‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">analytics</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">package</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">analytics</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tags</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== å¼€å§‹ä»£ç è´¨é‡æ£€æµ‹ ==============="</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== ç»“æŸä»£ç è´¨é‡æ£€æµ‹ ==============="</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tags</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">runner-tag</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== å¼€å§‹ç¼–è¯‘ä»»åŠ¡ ==============="</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== ç»“æŸç¼–è¯‘ä»»åŠ¡ ==============="</span></span><br><span class="line"></span><br><span class="line"><span class="attr">package:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">package</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">runner-tag</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== å¼€å§‹æ‰“åŒ…ä»»åŠ¡  ==============="</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== ç»“æŸæ‰“åŒ…ä»»åŠ¡  ==============="</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tags</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">runner-tag</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== å¼€å§‹æµ‹è¯•ä»»åŠ¡ ==============="</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== ç»“æŸæµ‹è¯•ä»»åŠ¡ ==============="</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy_test:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">deploy</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">runner-tag</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== è‡ªåŠ¨éƒ¨ç½²åˆ°æµ‹è¯•æœåŠ¡å™¨  ==============="</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">test</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://staging.example.com</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy_test_manual:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">deploy</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">runner-tag</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== æ‰‹åŠ¨éƒ¨ç½²åˆ°æµ‹è¯•æœåŠ¡å™¨  ==============="</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">test</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://staging.example.com</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">manual</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy_production_manual:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">deploy</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">runner-tag</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== æ‰‹åŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨  ==============="</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">production</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://staging.example.com</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">manual</span></span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹å¥½ <code>.gitlab-ci.yaml</code> ä¹‹åï¼Œå°† CI/CD è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°çš„ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œä½¿ç”¨å˜é‡çš„æ–¹å¼å¡«å…¥åœ¨ é¡¹ç›® <code>è®¾ç½®</code> â€”&gt; <code>CI/CD</code> â€”&gt; <code>å˜é‡</code> é‡Œã€‚æ¯”å¦‚ Harbor ä»“åº“çš„ç”¨æˆ·åå¯†ç ã€ssh å¯†é’¥ä¿¡æ¯ã€æ•°æ®åº“é…ç½®ä¿¡æ¯ç­‰æœºå¯†ä¿¡æ¯ã€‚</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CI_REGISTRY: # Harbor é•œåƒä»“åº“çš„åœ°å€</span><br><span class="line">CI_REGISTRY_USER: # Harbor ç”¨æˆ·å</span><br><span class="line">CI_REGISTRY_PASSWORD: # Harbor å¯†ç </span><br><span class="line">CI_REGISTRY_IMAGE: # æ„å»ºé•œåƒçš„åç§°</span><br><span class="line">SSH_PASSWORD: # éƒ¨ç½²æµ‹è¯•æœåŠ¡å™¨ ssh å¯†ç </span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200327102511419.png" alt="image-20200327102511419"></p><ul><li>è®¾ç½®å¥½ç›¸å…³å˜é‡ä¹‹ååœ¨ï¼Œåœ¨é¡¹ç›®é¡µé¢çš„ <code>CI/CD</code> â€”â€“&gt; <code>æµæ°´çº¿</code> é¡µé¢ç‚¹å‡» <code>è¿è¡Œæµæ°´çº¿</code>æ‰‹åŠ¨è§¦å‘æµæ°´çº¿ä»»åŠ¡è¿›è¡Œæµ‹è¯•ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200325163138089.png" alt="image-20200325163138089"></p><ul><li>å¦‚æœæµæ°´çº¿ä»»åŠ¡æ„å»ºæˆåŠŸçš„è¯ï¼Œä¼šæ˜¾ç¤º <code>å·²é€šè¿‡</code> çš„è¡¨ç¤º</li></ul><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200325163254316.png" alt="image-20200325163254316"></p><ul><li>ç™»å½•åˆ° Harbor <a href="http://10.10.107.217" target="_blank" rel="noopener">http://10.10.107.217</a> æŸ¥çœ‹é•œåƒæ˜¯å¦æ„å»ºæˆåŠŸ</li></ul><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200325163400519.png" alt="image-20200325163400519"></p><h2 id="å‚è€ƒ-æ¨è"><a href="#å‚è€ƒ-æ¨è" class="headerlink" title="å‚è€ƒ/æ¨è"></a>å‚è€ƒ/æ¨è</h2><ul><li><p><a href="https://docs.gitlab.com/runner/" target="_blank" rel="noopener">GitLab Runner Docs</a></p></li><li><p><a href="https://docs.gitlab.com/ee/README.html" target="_blank" rel="noopener">GitLab Docs</a></p></li><li><p><a href="https://nicksors.cc/2019/07/12/kubernetesç³»åˆ—ä¹‹ã€Šæ„å»ºä¼ä¸šçº§CICDå¹³å°-ä¸€-ã€‹.html" target="_blank" rel="noopener">kubernetesç³»åˆ—ä¹‹ã€Šæ„å»ºä¼ä¸šçº§CICDå¹³å°(ä¸€)ã€‹</a></p></li><li><p><a href="https://notes.mengxin.science/2018/09/02/gitlab-ci-cd-question-and-answer/" target="_blank" rel="noopener">GitLabçš„CI/CDä½¿ç”¨é—®é¢˜æ±‡æ€»</a></p></li><li><p><a href="https://moelove.info/2018/08/05/%E5%9F%BA%E4%BA%8E-GitLab-%E7%9A%84-CI-%E5%AE%9E%E8%B7%B5/" target="_blank" rel="noopener">åŸºäº GitLab çš„ CI å®è·µ</a></p></li><li><p><a href="https://blog.fleeto.us/courses/gitlab-notes/" target="_blank" rel="noopener">gitlab-notes</a></p></li><li><p><a href="https://xiaogenban1993.github.io/18.5/xiaomi_gitlabrunner.html" target="_blank" rel="noopener">gitlab runneréƒ¨ç½²ç»†èŠ‚ä¼˜åŒ–</a></p></li><li><p><a href="https://tech.meituan.com/2018/08/02/erp-cd-jenkins-pipeline.html" target="_blank" rel="noopener">Jenkinsçš„Pipelineè„šæœ¬åœ¨ç¾å›¢é¤é¥®SaaSä¸­çš„å®è·µ</a></p></li><li><p><a href="https://laogen.site/gitlab-ci/example-docker-ssh-deploy/" target="_blank" rel="noopener">GitLab CI ç¤ºä¾‹ï¼šDocker é•œåƒæ‰“åŒ…å‘å¸ƒ &amp; SSH éƒ¨ç½²</a></p></li><li><p><a href="https://theviper.xyz/gitlab-ci-cd-optimize.html" target="_blank" rel="noopener">gitlab CI/CDä¼˜åŒ–</a></p></li><li><p><a href="http://zacksleo.top/2017/04/22/GitLab-CI%E4%BD%BF%E7%94%A8Docker%E8%BF%9B%E8%A1%8C%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2/" target="_blank" rel="noopener">GitLab-CIä½¿ç”¨Dockerè¿›è¡ŒæŒç»­éƒ¨ç½²</a></p></li><li><p><a href="https://furur.xyz/2019/11/03/docker-gitlab-ci-deploy-springboot-project/" target="_blank" rel="noopener">Docker Gitlab CI éƒ¨ç½² Spring Boot é¡¹ç›®</a></p></li><li><p><a href="https://wsgzao.github.io/post/gitlab/" target="_blank" rel="noopener">RHEL7/CentOS7 åœ¨çº¿å’Œç¦»çº¿å®‰è£… GitLab é…ç½®ä½¿ç”¨å®è·µ</a></p></li><li><p><a href="https://wayjam.me/post/how-gitlab-shell-works-with-ssh.md" target="_blank" rel="noopener">GitLab Shellå¦‚ä½•é€šè¿‡SSHå·¥ä½œ</a></p></li><li><p><a href="https://websoft9.gitbook.io/gitlab-image-guide/" target="_blank" rel="noopener">GitLabé•œåƒæ‰‹å†Œ</a></p></li><li><p><a href="https://xuanwo.io/2016/04/13/gitlab-install-intro/" target="_blank" rel="noopener">Gitlabéƒ¨ç½²å’Œæ±‰åŒ–ä»¥åŠç®€å•è¿ç»´</a></p></li></ul><h2 id="ç¤¾ç¾¤é—®ç­”-QA-CI-CD-ç›¸å…³"><a href="#ç¤¾ç¾¤é—®ç­”-QA-CI-CD-ç›¸å…³" class="headerlink" title="ç¤¾ç¾¤é—®ç­” QA | CI/CD ç›¸å…³"></a>ç¤¾ç¾¤é—®ç­” QA | CI/CD ç›¸å…³</h2><p>ä»¥ä¸‹å†…å®¹æ˜¯æ•´ç†æ‘˜è‡ª <a href="https://blog.k8s.li/K8s-QA.html">ã€Š(2000+) kubernetes ç¤¾ç¾¤åˆ†äº« QA æ±‡æ€»ã€‹</a>ï¼Œä¸­æœ‰å…³ CI/CD ç›¸å…³çš„é—®ç­”ï¼Œä» 2000 å¤šä¸ª QA é‡Œä½¿ç”¨å…³é”®å­—æœç´¢ Gitlabã€CI/CDã€Jenkins ç­‰ï¼Œç„¶åå°†ä¸€äº›ç›¸å…³çš„é—®é¢˜è¿›è¡Œæ±‡æ€»ã€‚æ–¹ä¾¿é—®é¢˜è‡ªæŸ¥å’Œä»ä¸­å¸å–ç»éªŒã€‚</p><h3 id="2019-04-03ï¼šå®¹å™¨ç¯å¢ƒä¸‹çš„æŒç»­é›†æˆæœ€ä½³å®è·µ"><a href="#2019-04-03ï¼šå®¹å™¨ç¯å¢ƒä¸‹çš„æŒç»­é›†æˆæœ€ä½³å®è·µ" class="headerlink" title="2019-04-03ï¼šå®¹å™¨ç¯å¢ƒä¸‹çš„æŒç»­é›†æˆæœ€ä½³å®è·µ"></a>2019-04-03ï¼šå®¹å™¨ç¯å¢ƒä¸‹çš„æŒç»­é›†æˆæœ€ä½³å®è·µ</h3><blockquote><p>Qï¼šKubernetes ä¸Šä¸»æµçš„ CI/CD æ–¹æ¡ˆæ˜¯å•¥ï¼Ÿ</p></blockquote><p>Aï¼šå…¶å®è¿™æ— å…³Kubernetesï¼Œä»å¸‚åœºå æœ‰ç‡æ¥çœ‹ï¼Œå‰ä¸‰ååˆ†åˆ«æ˜¯ Jenkinsã€JetBrains TeamCityã€CircleCIã€‚<a href="https://www.datanyze.com/market-share/ci" target="_blank" rel="noopener">æ¥æºï¼š</a></p><blockquote><p>Qï¼šGitLab è‡ªå¸¦çš„ CI ä¸Jenkins å’Œ GitLab ç»“åˆçš„ CIï¼Œè¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿæƒ³çŸ¥é“æ›´æ·±å±‚æ¬¡çš„ç†è§£ã€‚</p></blockquote><p>Aï¼šè¿˜æ˜¯è¦ç»“åˆè‡ªå·±å›¢é˜Ÿçš„å®é™…æƒ…å†µåšé€‰æ‹©ã€‚ä»æˆç†Ÿåº¦æ¥è¯´ï¼Œè‚¯å®šæ˜¯ Jenkinsç”¨æˆ·æœ€å¤šï¼Œæˆç†Ÿåº¦æœ€é«˜ï¼Œç¼ºç‚¹æ˜¯ä¾§é‡ Javaï¼Œé…ç½®ç›¸å¯¹ç¹çã€‚GitLab è‡ªå¸¦çš„ CIç›¸å¯¹ç®€å•ï¼Œå¯ä»¥ç”¨ yamlï¼Œå’Œ GitLab ç»“åˆçš„æœ€å¥½ï¼Œä½†åŠŸèƒ½è‚¯å®šæ²¡æœ‰ Jenkinså…¨é¢ã€‚å¦‚æœæ˜¯å°å›¢é˜Ÿæ–°é¡¹ç›®ï¼ŒGitLab CI åˆå·²ç»å¯ä»¥æ»¡è¶³éœ€æ±‚çš„è¯ï¼Œå¹¶ä¸éœ€è¦ä¸ŠJenkinsï¼Œå¦‚æœæ˜¯è¾ƒå¤§çš„å›¢é˜Ÿï¼Œåˆæ˜¯å Java çš„ï¼Œä¸ªäººæ›´åå‘ Jenkinsã€‚</p><blockquote><p>Qï¼šJenkins å¦‚æœä¸æƒ³è¿è¡Œåœ¨ Kubernetes é‡Œé¢ï¼Œè¯¥æ€ä¹ˆå’Œ Kubernetes é›†æˆï¼Ÿ</p></blockquote><p>Aï¼šä» CI çš„æµç¨‹æ¥è¯´ï¼ŒCI åº”ç”¨æ˜¯ä¸æ˜¯è·‘åœ¨ Kubernetes çš„å¹¶ä¸é‡è¦ï¼ŒCIåªè¦èƒ½è®¿é—®ä»£ç åº“ï¼Œæœ‰æƒé™åœ¨ç”Ÿäº§ç¯å¢ƒå‘å¸ƒï¼Œæ˜¯ä¸æ˜¯è·‘åœ¨å®¹å™¨é‡Œä»æ•ˆæœæ¥è¯´å…¶å®æ²¡æœ‰åŒºåˆ«ï¼Œåªæ˜¯ç”¨Kubernetes éƒ¨ç½² Jenkinsçš„è¯ï¼Œè¿ç»´çš„ä¸€è‡´æ€§æ¯”è¾ƒå¥½ï¼Œè¿ç»´å›¢é˜Ÿä¸ç”¨é¢å¤–èŠ±æ—¶é—´ç»´æŠ¤ä¸€å¥—ç‰©ç†æœºçš„éƒ¨ç½²æ–¹æ¡ˆã€‚</p><blockquote><p>Qï¼šKubernetesçš„å›æ»šæ–¹æ¡ˆæ˜¯å›æ»šä»£ç ï¼Œé‡åšé•œåƒï¼Œè¿˜æ˜¯å…ˆåˆ‡æµé‡ï¼Œååšä¿®æ”¹ï¼Ÿ</p></blockquote><p>Aï¼šä»£ç ä¸€å®šæ˜¯æ‰“åŒ…åˆ°é•œåƒé‡Œçš„ï¼Œé•œåƒçš„ç‰ˆæœ¬å°±æ˜¯ä»£ç çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¸€å®šæ˜¯åˆ‡é•œåƒã€‚è‡³äºå›æ»šæ“ä½œæœ¬èº«ï¼ŒKuberneteså·²ç»å†…ç½®äº†å¾ˆå¤šæ»šåŠ¨å‘å¸ƒï¼ˆRollingupdateï¼‰çš„ç­–ç•¥ï¼Œæ— è®ºæ˜¯å‘æ–°ç‰ˆæœ¬è¿˜æ˜¯å›æ»šç‰ˆæœ¬ï¼Œéƒ½å¯ä»¥åšåˆ°ç”¨æˆ·æ— æ„ŸçŸ¥ã€‚</p><blockquote><p>Qï¼šé•œåƒå¤§åˆ°å‡  G çš„è¯å¦‚ä½•æ›´æ–°éƒ¨ç½²ï¼Œæœ‰ä»€ä¹ˆå¥½çš„å®è·µå‘¢ï¼Œä»¥åŠå¦‚ä½•å›æ»šï¼Ÿ</p></blockquote><p>Aï¼šå‡ ä¸ªè¦ç‚¹ï¼š&gt; Qï¼šDrone å¼€æ”¾ API æœåŠ¡å—ï¼Ÿè¿™æ ·æ–¹ä¾¿å…¶ä»–ç³»ç»Ÿé›†æˆã€‚</p><p>Aï¼šå¯ä»¥è°ƒæ•´ä¸€ä¸‹æ€è·¯ï¼Œç›´æ¥æŠŠéœ€è¦çš„åŠŸèƒ½åšæˆé•œåƒåœ¨ Drone é‡Œè°ƒç”¨å°±å¥½äº†ã€‚</p><blockquote><p>Qï¼šå¦‚æœæœ‰ Drone çš„ Serveræ€ä¹ˆåšé«˜å¯ç”¨ï¼Ÿ</p></blockquote><p>Aï¼šDrone serve rç”¨ Kuberneteséƒ¨ç½²çš„è¯æœ¬èº«åªèµ·åˆ°äº†ä¸€ä¸ªä»»åŠ¡è°ƒåº¦çš„ä½œç”¨ï¼Œå¾ˆéš¾ä¼šé‡åˆ°æ€§èƒ½ç“¶é¢ˆã€‚çœŸçš„æœ‰æ€§èƒ½é—®é¢˜å¯ä»¥å°è¯•æ°´å¹³æ‰©å±•Drone serverï¼Œå…±äº«åŒä¸€æ•°æ®åº“ã€‚</p><h3 id="åŸºäº-GitLab-çš„-CI-å®è·µ"><a href="#åŸºäº-GitLab-çš„-CI-å®è·µ" class="headerlink" title="åŸºäº GitLab çš„ CI å®è·µ"></a><a href="https://moelove.info/2018/08/05/åŸºäº-GitLab-çš„-CI-å®è·µ/" target="_blank" rel="noopener">åŸºäº GitLab çš„ CI å®è·µ</a></h3><blockquote><p>Qï¼šæ‚¨æåˆ°æŠŠå„ç§ä¾èµ–éƒ½ä»¥ Service çš„æä¾›ï¼Œè¯·é—®æ˜¯ä»¥å“ªç§æ–¹å¼å‘¢ï¼Ÿ æ¯”å¦‚Pythonçš„ä¾èµ–ï¼Œæ€ä¹ˆåšæˆServiceå‘¢ï¼Ÿ</p></blockquote><p>Aï¼šService åŒ–çš„ä¾èµ–ï¼Œä¸»è¦æ˜¯æŒ‡ç±»ä¼¼ DB / MySQL/ Reids ä¹‹ç±»çš„ã€‚ æˆ–è€…æ˜¯ dind å…¶å®å®ƒæä¾›çš„æ˜¯ 2375 ç«¯å£çš„TCPæœåŠ¡ã€‚ Python çš„ä¾èµ–ï¼Œæˆ‘æ¨èçš„åšæ³•æ˜¯ï¼Œ æ„å»ºä¸€ä¸ªæ¢äº†æºçš„ Python é•œåƒã€‚ å®‰è£…ä¾èµ–çš„æ—¶å€™ï¼Œè€—æ—¶ä¼šå°‘å¾ˆå¤šã€‚ æˆ–è€…è¯´ï¼Œ å¯ä»¥åœ¨å®šä¹‰ Pipeline çš„æ—¶å€™ï¼Œ å°†è™šæ‹Ÿç¯å¢ƒçš„ venv æ–‡ä»¶å¤¹ä½œä¸º cache ï¼Œä¹‹åçš„å®‰è£…ä¹Ÿä¼šæ£€æŸ¥è¿™ä¸ªï¼Œé¿å…ä¸å¿…è¦çš„å®‰è£…ã€‚</p><blockquote><p>Qï¼šè¯·é—®ï¼Œä½ ä»¬ä¸ºä»€ä¹ˆä¸ç”¨Jenkins Pipelineï¼Œè€Œä½¿ç”¨GitLab CIï¼Ÿ</p></blockquote><p>Aï¼šä¸»è¦åŸå› æ˜¯æˆ‘æåˆ°çš„é‚£å‡ ä¸ªæ–¹é¢ã€‚ é›†æˆè¾ƒå¥½ï¼Œ ç•Œé¢ç¾è§‚ä¼˜é›…ï¼Œ ä½¿ç”¨ç®€å•ï¼ˆæ‰€æœ‰æœ‰ä»“åº“å†™æƒé™çš„äºº éƒ½å¯ä»¥ä½¿ç”¨ï¼Œ åªè¦åˆ›å»º .gitlab-ci.yml å¹¶ä¸”é…ç½®äº† Runner å³å¯ä½¿ç”¨ï¼‰ ã€‚æ¢ä¸ªè§’åº¦ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä½¿ç”¨Jenkins çš„é—®é¢˜ï¼Œ Jenkins å¯¹äºé¡¹ç›®çš„é…ç½®å…¶å®å’Œ GitLab çš„ä»£ç æ˜¯åˆ†ç¦»çš„ï¼Œ ä¸¤éƒ¨åˆ†çš„ï¼Œ ç”¨æˆ·ï¼ˆæˆ–è€…è¯´æˆ‘ä»¬çš„å¼€å‘è€…ï¼‰åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œ éœ€è¦æœ‰ä¸¤ä¸ªå¹³å°ï¼Œ å¹¶ä¸”ï¼Œå¤§å¤šæ•°æ—¶å€™ï¼Œ Jenkins çš„æƒé™æ˜¯ä¸æ”¾å¼€çš„ã€‚ å¯¹ç”¨æˆ·æ¥è®²ï¼Œ é‚£ç›¸å½“äºæ˜¯ä¸ªé»‘ç›’ã€‚ é‚£å¯èƒ½çš„é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ é‡åˆ°æ„å»ºå¤±è´¥äº†ï¼Œ ä½†æ˜¯åªæœ‰è¿ç»´çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä½†æ˜¯ç ”å‘æ— èƒ½ä¸ºåŠ›ï¼Œå› ä¸ºæ²¡æœ‰æƒé™ã€‚ ä½¿ç”¨GItLabçš„å¥½å¤„ï¼Œè¿™ä¸ªæ—¶å€™å°±æ›´åŠ çªå‡ºäº†ï¼Œ é…ç½®å°±åœ¨ä»£ç ä»“åº“é‡Œé¢ï¼Œå¹¶ä¸”ä½¿ç”¨ YAML çš„é…ç½®ï¼Œå¾ˆç®€å•ã€‚ æœ‰å•¥é—®é¢˜ï¼Œç›´æ¥æŸ¥ï¼Œç›´æ¥æ”¹ã€‚</p><blockquote><p>Qï¼šå…³äº Runner çš„æ¸…ç†çš„é—®é¢˜ï¼Œåœ¨é•¿æ—¶é—´ä½¿ç”¨åï¼ŒRunner æœºå™¨ä¸Šå›äº§ç”Ÿå¾ˆå¤šçš„ Cache å®¹å™¨ï¼Œå¦‚ä½•æ¸…ç†å‘¢ã€‚èƒ½å¤Ÿåœ¨ä»»åŠ¡ä¸­è‡ªåŠ¨æ¸…é™¤å—ï¼Ÿ</p></blockquote><p>Aï¼šè¿™ä¸ªå°±ç›¸å¯¹ç®€å•äº†ï¼Œé¦–å…ˆï¼Œ å¦‚æœä½ çš„ Cache å®¹å™¨ç¡®è®¤æ²¡ç”¨äº†ï¼Œ æ¯ä¸ª Cache å®¹å™¨å…¶å®éƒ½æœ‰åå­—çš„ï¼Œ ç›´æ¥æŒ‰ Cache çš„åå­—è¿‡ç•¥ï¼Œ æ‰¹é‡åˆ æ‰ã€‚ å¦‚æœä½ ä¸ç¡®å®šå®ƒæ˜¯å¦æœ‰ç”¨ï¼Œé‚£ä½ ç›´æ¥åˆ æ‰ä¹Ÿæ˜¯ä¸å½±å“çš„ï¼Œ å› ä¸º Docker Excutor çš„æ‰§è¡Œæœºåˆ¶æ˜¯åˆ›å»ºå®Œ Service å®¹å™¨åï¼Œ åˆ›å»º Cache å®¹å™¨ã€‚ è¦æ˜¯åˆ æ‰äº†ï¼Œå®ƒåªæ˜¯ä¼šå†åˆ›å»ºä¸€æ¬¡ã€‚ å¦‚æœä½ æƒ³åœ¨ä»»åŠ¡ä¸­æ¸…é™¤ï¼Œ ç›®å‰è¿˜æ²¡åšç›¸å…³çš„å®è·µï¼Œå¾…æˆ‘å®è·µåï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å¾ˆä¼˜é›…çš„æ–¹å¼ã€‚</p><blockquote><p>Qï¼šè¯·é—®ä¸‹Mavençš„settings.xmlæ€ä¹ˆå¤„ç†ï¼Ÿæœ¬åœ°Mavenä»“åº“å‘¢ï¼Ÿ</p></blockquote><p>Aï¼šæˆ‘ä»¬æ„å»ºäº†ç§æœ‰çš„ Maven é•œåƒï¼Œ ç§æœ‰é•œåƒä¸­æ˜¯é»˜è®¤ä½¿ç”¨äº†æˆ‘ä»¬çš„ç§æœ‰æºã€‚ å¯¹äºé¡¹ç›®ä¸­ç”¨æˆ·æ— éœ€å…³æ³¨ settings.xml ä¸­æ˜¯å¦é…ç½®repoã€‚</p><blockquote><p>Qï¼šåœ¨GitLabçš„CDæ–¹æ¡ˆä¸­ï¼Œåœ¨éƒ¨ç½²çš„æ—¶å€™ï¼Œéœ€è¦åœ¨å˜é‡ä¸­é…ç½®è·³æ¿æœºçš„ç§é’¥ï¼Œå¦‚æœè¿™ä¸ªé¡¹ç›®æ˜¯å¯¹å…¬å¸æ•´éƒ¨é—¨å¼€å‘ï¼Œé‚£ä¹ˆå¦‚ä½•ä¿æŠ¤è¿™ä¸ªç§é’¥å‘¢ï¼Ÿ</p></blockquote><p>Aï¼šå¯ä»¥ä½¿ç”¨ secret variable å°†ç§é’¥å†™å…¥å…¶ä¸­ï¼Œ ï¼ˆä½†æ˜¯é¡¹ç›®çš„ç®¡ç†å‘˜ï¼Œå…·å¤‡æŸ¥çœ‹è¯¥ variable çš„æƒé™ï¼‰å¼€å‘ä¸€ä¸ª web server ï¼ˆå…¶å®åªè¦æš´éœ² IP ç«¯å£ä¹‹ç±»çš„å°±å¯ä»¥ï¼‰ åœ¨ CI æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å»è¯·æ±‚ï¼Œ server å¯¹æ¥æºåšåˆ¤æ–­ ï¼ˆæ¯”å¦‚ æ‰§è¡ŒCI çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€äº›ç‰¹å®šçš„å˜é‡ï¼Œä»¥æ­¤æ¥åˆ¤æ–­ï¼Œæ˜¯å¦çœŸçš„æ˜¯ CI åœ¨è¯·æ±‚ï¼‰ç„¶åè¿”å›ç§é’¥ã€‚</p><blockquote><p>Qï¼šGitLab CIé€‚åˆä»€ä¹ˆç±»å‹çš„é¡¹ç›®å‘¢ï¼Ÿå›½å†…ç›®å‰è¿˜æ¯”è¾ƒå°ä¼—å§ï¼Ÿ</p></blockquote><p>Aï¼šå›½å†…ç›®å‰è¿˜è¾ƒä¸ºå°ä¼—ï¼ˆç›¸æ¯” Jenkins æ¥è¯´ï¼‰å…¶å®åªè¦éœ€è¦ CI çš„é¡¹ç›®ï¼Œå®ƒéƒ½é€‚åˆã€‚</p><h2 id="2015-09-23ï¼šåŸºäºDockerå’ŒJavaçš„æŒç»­é›†æˆå®è·µ"><a href="#2015-09-23ï¼šåŸºäºDockerå’ŒJavaçš„æŒç»­é›†æˆå®è·µ" class="headerlink" title="2015-09-23ï¼šåŸºäºDockerå’ŒJavaçš„æŒç»­é›†æˆå®è·µ"></a>2015-09-23ï¼šåŸºäºDockerå’ŒJavaçš„æŒç»­é›†æˆå®è·µ</h2><blockquote><p>Qï¼šCIè¿‡ç¨‹ä¸­testéœ€è¦è¿æ¥æ•°æ®åº“çš„ä»£ç æ—¶ï¼Œæ‚¨åœ¨å†™æµ‹è¯•æ¡ˆä¾‹æ–¹é¢æœ‰å“ªäº›ç»éªŒåˆ†äº«ï¼Ÿ</p></blockquote><p>Aï¼šå•å…ƒæµ‹è¯•ä¸èƒ½ä¾èµ–å¤–éƒ¨èµ„æºï¼Œç”¨mockï¼Œæˆ–è€…ç”¨h2ç­‰å†…å­˜æ•°æ®åº“æ›¿ä»£ã€‚é›†æˆæµ‹è¯•çš„æ—¶å€™æ˜¯ä»æ¥å£å±‚ç›´æ¥è°ƒç”¨æµ‹è¯•çš„ï¼Œæµ‹è¯•ç”¨ä¾‹å¯¹æ•°æ®åº“æ— æ„ŸçŸ¥ã€‚</p><blockquote><p>Qï¼šè¯·é—®éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ˜¯è‡ªåŠ¨è§¦å‘è¿˜æ˜¯éœ€è¦æ‰‹åŠ¨å®¡æ‰¹ï¼ŸSQLæ‰§è¡Œæˆ–å›æ»šæ˜¯å¦è‡ªåŠ¨åŒ–ï¼Ÿ</p></blockquote><p>Aï¼šå½“å‰æ˜¯éœ€è¦æ‰‹åŠ¨è§¦å‘ã€‚SQLæ›´æ–°å½“å‰æ²¡åšåˆ°è‡ªåŠ¨åŒ–ï¼Œè¿™å—æ­£åœ¨æ”¹è¿›ï¼Œå› ä¸ºéƒ¨ç½²ç§æœ‰ç¯å¢ƒéœ€è¦ã€‚SQLä¸æ”¯æŒå›æ»šï¼Œä»£ç åšå…¼å®¹ã€‚Dockeré•œåƒå›æ»šæ²¡æœ‰è‡ªåŠ¨åŒ–ã€‚</p><blockquote><p>Qï¼š é—®ä¸€ä¸‹ä½ ä»¬çš„Rediså†…å­˜ç‰ˆæ˜¯ç”¨çš„ä»€ä¹ˆï¼Ÿ</p></blockquote><p>Aï¼šæˆ‘ä»¬ç”¨çš„å†…å­˜ç‰ˆçš„redisæ˜¯ <a href="https://github.com/spullara/redis-protocol" target="_blank" rel="noopener">spullara/redis-protocol</a>ä¸­çš„serverå®ç°ã€‚ä¸è¿‡è¿™ä¸ªå®ç°éƒ¨åˆ†åŠŸèƒ½æ²¡æ”¯æŒï¼Œæ¯”å¦‚luaè„šæœ¬ï¼Œæˆ‘ä»¬è‡ªå·±åšäº†æ”¹è¿›ã€‚</p><blockquote><p>Qï¼šä»‹ç»ä¸‹workflowå¸¦æ¥çš„å¥½å¤„ã€‚</p></blockquote><p>Aï¼šworkflowçš„å¥½å¤„æˆ‘é‚£ç¯‡æ–‡ç« ä¸­æœ‰è¯´æ˜ï¼Œå¦‚æœæ²¡æœ‰workflowï¼Œæ‰€æœ‰çš„æ­¥éª¤éƒ½åœ¨åŒä¸€ä¸ªé…ç½®çš„ä¸åŒstepå®ç°ï¼Œå¦‚æœåé¢çš„å¤±è´¥ï¼Œè¦é‡æ–°ä»å¤´å¼€å§‹ã€‚workflowå¯ä»¥ä¸­é€”å¼€å§‹ï¼Œå¹¶ä¸”æ¯ä¸€æ­¥éª¤å®Œæˆéƒ½ä¼šè§¦å‘é€šçŸ¥ã€‚</p><blockquote><p>Qï¼šh2å¹¶ä¸å®Œå…¨å…¼å®¹MySQLè„šæœ¬ï¼Œä½ ä»¬å¦‚ä½•å¤„ç†çš„ï¼Ÿ</p></blockquote><p>Aï¼šæˆ‘ä»¬é€šè¿‡ä¸€äº›hackçš„åŠæ³•ï¼Œä¼šæ¢æµ‹ä¸‹æ•°æ®åº“æ˜¯ä»€ä¹ˆç±»å‹çš„ï¼Œæ›¿æ¢æ‰ä¸€äº›ä¸å…¼å®¹çš„SQLï¼Œè¿›è¡Œå®¹é”™ã€‚</p><blockquote><p>Qï¼šè¯·é—®ä½ ä»¬åœ¨æ„å»ºçš„æ—¶å€™ï¼Œä½ è¯´æœ‰äº›éœ€è¦åŠä¸ªå°æ—¶å·¦å³ï¼Œé‚£ä¹ˆæ„å»ºè¿‡ç¨‹çš„è¿›åº¦ç›‘æ§å’Œå¥åº·ç›‘æ§ä½ ä»¬æ€ä¹ˆåšçš„å‘¢ï¼Œå¦‚æœæœ‰buildå¤±è´¥äº†æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p></blockquote><p>Aï¼šCIçš„æ¯ä¸€æ­¥éƒ½æœ‰è¿›åº¦çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„å›¢é˜Ÿé€šè®¯å·¥å…·å¯ä»¥å’ŒCIé›†æˆï¼Œå¦‚æœå¤±è´¥ä¼šå‘æ¶ˆæ¯åˆ°ç¾¤é‡Œé€šçŸ¥å¤§å®¶ã€‚</p><blockquote><p>Qï¼šcleanupè„šæœ¬åšå“ªäº›ï¼Ÿ</p></blockquote><p>Aï¼šä¸»è¦æ˜¯æ¸…ç†æ—§çš„Dockeré•œåƒï¼Œä»¥åŠæ¸…ç†è‡ªåŠ¨åŒ–æµ‹è¯•äº§ç”Ÿçš„åƒåœ¾æ•°æ®ã€‚</p><blockquote><p>Qï¼šè¯·é—®ä½ ä»¬æ–‡ä»¶å­˜å‚¨æ€ä¹ˆè§£å†³çš„å‘¢ï¼Œä½¿ç”¨è‡ªå·±çš„ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿè¿˜æ˜¯äº‘æœåŠ¡ï¼Ÿ</p></blockquote><p>Aï¼šæ–‡ä»¶ç³»ç»Ÿæ”¯æŒå¤šç§storageé…ç½®ï¼Œå¯ä»¥æ˜¯æœ¬åœ°ç›®å½•ï¼ˆä¾¿äºæµ‹è¯•ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿äº‘æœåŠ¡ï¼ˆæ¯”å¦‚s3ï¼‰ã€‚</p><blockquote><p>Qï¼šåˆšæ‰è¯´ä½ ä»¬èƒ½é€šè¿‡ä¸€é”®éƒ¨ç½²ï¼Œä½†æ˜¯ä¸­é—´æ— æ³•ç›‘æ§ï¼Œæµ‹è¯•ç¯å¢ƒå¯ä»¥è¿™ä¹ˆç©ï¼Œé‚£ç”Ÿäº§ç¯å¢ƒä½ ä»¬æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿè¿˜æœ‰ä½ ä»¬åç»­çš„æ”¹é€ æ–¹å‘æ˜¯è‡ªå·±å¼€å‘ï¼Ÿè¿˜æ˜¯é‡‡ç”¨é›†æˆç¬¬ä¸‰æ–¹è½¯ä»¶ï¼Ÿ</p></blockquote><p>Aï¼šç”Ÿäº§ç¯å¢ƒshellå½“å‰åªèƒ½æ˜¯å¤šåŠ é”™è¯¯åˆ¤æ–­ã€‚è¿™å—æˆ‘ä»¬åœ¨æ”¹è¿›ï¼Œæ¯”å¦‚é€šè¿‡ansibleç­‰å·¥å…·ï¼Œä»¥åŠä½¿ç”¨Kuberneteså†…ç½®çš„rolling-updateã€‚è‡ªåŠ¨åŒ–éƒ¨ç½²è¿™å—è¿˜æ²¡æœ‰å¥½çš„å¼€æºå·¥å…·ã€‚</p><blockquote><p>Qï¼šä½ ä»¬çš„æµ‹è¯•ç”¨äº†å¾ˆå¤šä»£æ›¿æ–¹æ¡ˆã€å¦‚h2ä»£MySQLï¼Œè¦ä¿è¯æµ‹è¯•æ•ˆæœï¼Œé™¤äº†ä½ ä»¬ç”¨çš„hackæ–¹æ³•ä¹‹å¤–ï¼Œæ˜¯ä¸æ˜¯ä»å†™ä»£ç çš„æ—¶å€™å°±å¼€å§‹åšäº†æ–¹ä¾¿æµ‹è¯•çš„è®¾è®¡ï¼Ÿ</p></blockquote><p>Aï¼šå¯¹ã€‚è¿™ä¹Ÿæ˜¯æˆ‘æ–‡ç« ä¸­åˆ†äº«çš„è§‚ç‚¹ä¹‹ä¸€ã€‚æµ‹è¯•ç”¨ä¾‹çš„ç¼–å†™äººå‘˜è¦æœ‰ä¸šåŠ¡ä»£ç çš„ä¿®æ”¹æƒé™ï¼Œæœ€å¥½æ˜¯åŒä¸€ä¸ªäººã€‚è¦åšè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œä¸šåŠ¡ä»£ç å¿…é¡»è¦ç»™æµ‹è¯•ç•™å„ç§é’©å­ä»¥åŠåé—¨ã€‚</p><blockquote><p>Qï¼šè¯·é—®ä½ ä»¬çš„é›†ç¾¤åº”ç”¨ç¼–æ’æ€ä¹ˆåšçš„ï¼Ÿ</p></blockquote><p>Aï¼šä¸Šé¢è¯´äº†ï¼Œè¿˜æ²¡ç”¨åˆ°ç¼–æ’ã€‚ä¸€ç›´ç­‰ç¼–æ’å·¥å…·çš„æˆç†Ÿã€‚æ­£åœ¨æµ‹è¯•k8sã€‚</p><blockquote><p>Qï¼šä½ ä»¬åšè¿™ä¸ªé¡¹ç›®é€‰å‹æ˜¯å‡ºäºä»€ä¹ˆè€ƒè™‘çš„ï¼Œä»‹ç»é‡Œæœ‰æåˆ°ä½¿ç”¨ä¸€äº›è„šæœ¬æ¥ç®¡ç†å®¹å™¨è§£å†³å¼€å‘å’Œæµ‹è¯•å„ç§é—®é¢˜ï¼Œæ„Ÿè§‰è¿™ç§ç®¡ç†å®¹å™¨æ–¹å¼è¿‡äºç®€å•ä¼šå¸¦æ¥ç®¡ç†é—®é¢˜ï¼Œä¸ºä½•ä¸ç”¨ç¬¬ä¸‰æ–¹å¼€æºé¡¹ç›®æ¥åšäºŒæ¬¡å¼€å‘ï¼Œå¦‚ï¼šKubernetesï¼›å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä¸‹ä¸€æ­¥æœ‰æ²¡æœ‰è€ƒè™‘å¦‚ä½•è®©ä½ çš„Dockerå’Œäº‘æœåŠ¡å¹³å°ç»“åˆï¼Œè¦è§£å†³è¿è¥æˆæœ¬é—®é¢˜ï¼ˆDockeræœ€å¤§å¸å¼•åŠ›åœ¨è¿™é‡Œï¼‰ï¼Œè€Œä¸åªæ˜¯è§£å†³å¼€å‘æµ‹è¯•é—®é¢˜ï¼Ÿ</p></blockquote><p>Aï¼šå› ä¸ºæˆ‘ä»¬æœ€æ—©ç”¨çš„æ—¶å€™k8s 1.0 è¿˜æ²¡æœ‰ï¼Œå˜åŒ–å¤ªå¤§ï¼Œåˆ›ä¸šå›¢é˜Ÿæ²¡ç²¾åŠ›è·Ÿè¿›ï¼Œè„šæœ¬æ˜¯ç²—æš´ç®€å•çš„åŠæ³•ã€‚ä¸€ç›´åœ¨ç­‰å¾…å„ç§åŸºäºDockerçš„äº‘è§£å†³æ–¹æ¡ˆå‘€ï¼Œè‚¯å®šè€ƒè™‘ç»“åˆã€‚</p><blockquote><p>Qï¼šå¯¹äºDocker storageåˆ†åŒºç”¨å®Œé—®é¢˜ï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹ï¼Œä½ ä»¬æ˜¯ä½¿ç”¨Dockerå®˜æ–¹æä¾›çš„Registryä»“åº“å—ï¼Œå¦‚ä½•è§£å†³ä»“åº“å•ç‚¹é—®é¢˜ï¼Œè¿™æœºå™¨è¦æ˜¯æ•…éšœäº†æ€ä¹ˆåŠï¼Ÿ</p></blockquote><p>Aï¼šRegistryç”¨çš„æ˜¯å®˜æ–¹çš„ï¼Œåç«¯å­˜å‚¨æ˜¯æŒ‚è½½åˆ°s3ä¸Šçš„ã€‚æ²¡æœ‰s3,æ¨èä½¿ç”¨äº¬ä¸œç”°çªå›¢é˜Ÿå¼€æºçš„<a href="https://github.com/jcloudpub/speedy" target="_blank" rel="noopener">Speedy</a>ï¼Œå®ç°äº†åˆ†å¸ƒå¼å­˜å‚¨ã€‚</p><blockquote><p>Qï¼šé™¤äº†ä»‹ç»çš„Javaç›¸å…³çš„CIæ–¹æ¡ˆï¼Œå¯¹äºC/C++å¼€å‘è¯­è¨€æœ‰æ²¡æœ‰æ¨èçš„CIæ–¹æ¡ˆï¼Ÿ</p></blockquote><p>Aï¼šTeamcity/Jenkinsç­‰CIå·¥å…·æ”¯æŒä»»ä½•è¯­è¨€çš„ã€‚å…¶å®ä»»ä½•è¯­è¨€çš„CIéƒ½å·®ä¸å¤šï¼Œå•å…ƒæµ‹è¯•ï¼Œé›†æˆæµ‹è¯•ã€‚å…³é”®è¿˜åœ¨äºä¾èµ–ç¯å¢ƒçš„å‡†å¤‡ä»¥åŠé›†æˆæµ‹è¯•ç”¨ä¾‹çš„ç®¡ç†ã€‚</p><blockquote><p>Qï¼šæˆ‘çœ‹åˆ°ä½ ä»¬ä¸ºäº†æ–¹ä¾¿æµ‹è¯•å’Œè°ƒè¯•ä¼šæœ‰ç‹¬ç«‹çš„é›†åˆDockerç¯å¢ƒï¼Œè¿™ç§ç¯å¢ƒå’Œä¸Šçº¿ç¯å¢ƒå…¶å®æ˜¯æœ‰å·®åˆ«çš„ï¼Œè¿™æ ·æµ‹è¯•çš„ç»“æœèƒ½å¤Ÿä»£è¡¨çº¿ä¸Šç¯å¢ƒå—ï¼Ÿè¿™ç§é—®é¢˜æ€ä¹ˆçœ‹å¾…ï¼Ÿ</p></blockquote><p>Aï¼šæ‰€ä»¥æˆ‘ä»¬æœ‰å¤šä¸ªæµç¨‹ã€‚æ¸…ç†æ•°æ®çš„æµ‹è¯•ç¯å¢ƒï¼Œä»¥åŠä¸æ¸…ç†ç¯å¢ƒçš„æ²™ç®±ç¯å¢ƒã€‚ä½†è¿™ä¹Ÿä¸èƒ½é¿å…ä¸€éƒ¨åˆ†çº¿ä¸Šç¯å¢ƒçš„æ•°æ®å¯¼è‡´çš„bugã€‚å¦å¤–å°±æ˜¯é…åˆç°åº¦ä¸Šçº¿æœºåˆ¶ã€‚å½“å‰æˆ‘ä»¬çš„ç°åº¦æ˜¯é€šè¿‡ä»£ç ä¸­çš„å¼€å…³å®ç°çš„ï¼Œä½¿ç”¨è¿™ç§æ–¹æ¡ˆçš„ä¹Ÿå¾ˆå¤šï¼Œæ¯”å¦‚facebookçš„Gatekeeperã€‚</p><blockquote><p>Qï¼šè¯·é—®Groukæœ‰æ¶‰åŠå‰ç«¯ï¼ˆNode.jsæ–¹é¢çš„ï¼‰å¹¶ç»“åˆDockerçš„CI/CDç»å†å—ï¼Œå¯ä»¥åˆ†äº«ä¸‹å—ï¼Ÿ</p></blockquote><p>Aï¼šè¿™æˆ‘ä»¬ä¹Ÿåœ¨å°è¯•ã€‚å½“å‰jsçš„æµ‹è¯•ä¸»è¦è¿˜æ˜¯åŸºäº<a href="https://github.com/ariya/phantomjs" target="_blank" rel="noopener">ariya/phantomjs</a>ï¼Œçº¯ç²¹çš„jsåº“æ¯”è¾ƒæ–¹ä¾¿æµ‹è¯•ï¼Œä½†å¦‚æœç‰µæ‰¯åˆ°ç•Œé¢ï¼Œå°±æ¯”è¾ƒå¤æ‚äº›äº†ã€‚</p><h2 id="2015-12-22ï¼šåŸºäºDockerå’ŒGitçš„æŒç»­é›†æˆå·¥ä½œæµ"><a href="#2015-12-22ï¼šåŸºäºDockerå’ŒGitçš„æŒç»­é›†æˆå·¥ä½œæµ" class="headerlink" title="2015-12-22ï¼šåŸºäºDockerå’ŒGitçš„æŒç»­é›†æˆå·¥ä½œæµ"></a>2015-12-22ï¼šåŸºäºDockerå’ŒGitçš„æŒç»­é›†æˆå·¥ä½œæµ</h2><blockquote><p>Qï¼šå¼€å‘æ¯æäº¤ä¸€ä¸ªbugfixï¼Œéƒ½ä¼šè§¦å‘jinkenså»æ„å»ºé•œåƒï¼Œé‚£ä¹ˆå¤šçš„å¼€å‘è€…ï¼Œå²‚ä¸æ˜¯è¦æ„å»ºå¾ˆå¤šé•œåƒï¼Ÿ</p></blockquote><p>Aï¼šæ²¡æœ‰é”™ï¼Œæˆ‘ä»¬æ˜¯æ¯æ¬¡éƒ½è§¦å‘æ„å»º imageï¼Œç”±äºimageæ˜¯åˆ†å±‚çš„ï¼Œåº•å±‚å·²ç»å­˜åœ¨çš„çˆ¶å¯¹è±¡ï¼Œæ˜¯ä¸ç”¨å­˜å‚¨ï¼Œåªå­˜å‚¨å˜åŒ–çš„éƒ¨åˆ†æ‰€ä»¥å†ç”¨çš„ç£ç›˜ç©ºé—´å¾ˆä½ï¼Œåœ¨ç³»ç»Ÿå¼€å§‹åˆï¼Œæˆ‘åšè¿‡ç»Ÿè®¡ï¼Œ1000ä¸ª image ä¹Ÿä¸åˆ° 9Gï¼Œè¿™å…¶ä¸­è¿˜æœ‰å¾ˆå¤šåŸºç¡€é•œåƒã€‚</p><blockquote><p>Qï¼šæƒ³é—®ä¸€ä¸ªé›†ç¾¤ç›¸å…³çš„ï¼ŒåƒDockeréƒ¨ç½²è¿™éƒ¨æ˜¯ç›´æ¥è°ƒç”¨Dockeréƒ¨ç½²å®¹å™¨ï¼Œè¿˜æ˜¯é€šè¿‡Ansibleæˆ–å…¶ä»–å·¥å…·ï¼Ÿ</p></blockquote><p>Aï¼šæœ‰äº† Kubernetes ç®¡ç†é›†ç¾¤åï¼Œå‘å¸ƒçš„å·¥ä½œå°±æ¯”è¾ƒç®€å•äº†ï¼Œç”¨ä¸ä¸Š Ansibleã€‚ä½†æ˜¯ Ansible è¿˜æ˜¯æœ‰å®ƒçš„ç”¨å¤„çš„ï¼Œæ¯”å¦‚æ¸…ç†é›†ç¾¤ä¸­è¿‡æ—¶çš„ imageï¼Œå’Œå·²ç»é€€å‡ºçš„ Containerç­‰ã€‚</p><blockquote><p>Qï¼šä½ å¥½ï¼Œä»¥å‰ä¹Ÿåšè¿‡ç±»ä¼¼çš„æœåŠ¡â€ç¬¬ä¸‰æ­¥ï¼šJenkins ä¼šæŠŠç›¸åº”çš„ imageéƒ¨ç½²åˆ°æœåŠ¡å™¨é›†ç¾¤ä¸­ï¼Œå¼€å‘è€…å°±å¯ä»¥é€šè¿‡ iss001.kingdeeè¿™ä¸ªåŸŸåè®¿é—®åˆšåˆšå¯¹åº”åˆ†æ”¯çš„æœåŠ¡äº†â€ï¼Œå•ç‹¬ä¸€ä¸ªåˆ†æ”¯è§£å†³äº†å¯¹åº”çš„bugï¼Œä½†å®é™…ç”Ÿäº§ä¸­éå¸¸å®¹æ˜“ä¿®æ”¹ä¸€ä¸ªbugå¼•èµ·å…¶ä»–çš„bugï¼Œä½ ä»¬æ˜¯æ€ä¹ˆå»æŠŠæ§æ•´ä½“çš„ç¨³å®šæ€§ï¼Ÿå¦‚ä½•æé«˜è¿™ç§å•ä¸ªbugåˆ†æ”¯å•ä¸ªæµ‹è¯•ç¯å¢ƒçš„æ„ä¹‰ï¼Ÿ</p></blockquote><p>Aï¼šè¿™ä¸ª pull-request çš„å·¥ä½œæ–¹å¼æ˜¯åº”å¯¹åŠŸèƒ½å¼€å‘çš„ï¼Œå¦‚åƒé•¿æœŸå¼€å‘æŸä¸ª new featureï¼Œä½ åˆšåˆšè¯´çš„ä¸€ä¸ª bug äº§ç”Ÿå¦å¤–ä¸€ä¸ªbugï¼Œæˆ‘ä»¬çš„åšæ³•æ˜¯æœ‰å›å½’æµ‹è¯•ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª smoke åˆ†æ”¯ï¼ŒæŒç»­ä¸æ–­çš„å¯¹å…¶åšåŠŸèƒ½å›å½’æµ‹è¯•ï¼Œåªæœ‰é€šè¿‡çš„æ‰èƒ½ cherry pick åˆ°release ä¸Šã€‚</p><blockquote><p>Qï¼šæµ‹è¯•ç¯å¢ƒä¾èµ–çš„redis/MQä¹‹ç±»çš„å¤–éƒ¨æœåŠ¡å¦‚ä½•åšçš„éš”ç¦»?æ¯æ¬¡æµ‹è¯•å•ç‹¬æ‹‰èµ·æ¥ä¸€å¥—å¤–éƒ¨ä¾èµ–çš„æœåŠ¡å—ï¼Ÿ</p></blockquote><p>Aï¼šæˆ‘ä»¬é€šè¿‡å¤šä¸ªæ‰‹æ®µæ¥å®ç°å…±äº«æ•°æ®ï¼šmasterã€smokeã€release åˆ†æ”¯æµ‹è¯•éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ä¸­é—´ä»¶ï¼Œè¦æ˜¯ä¸ç”¨è®¿é—®å…±äº«çš„æ•°æ®ï¼Œå¯ä»¥éƒ¨ç½²å¦‚ MQ imageï¼Œä»£ç å±‚é¢çš„ï¼Œå¦‚ MQ key çš„åç§°åŠ ä¸Šæœºå™¨çš„ IPã€‚</p><blockquote><p>Qï¼šæœ‰æ²¡æœ‰ç”¨åˆ°Mesosï¼Ÿæ˜¯å¦å®¹æ˜“é‡åˆ°é—®é¢˜ï¼Ÿè¿™æ–¹é¢çš„æ–‡æ¡£å¥½åƒå¹¶ä¸å¤šã€‚</p></blockquote><p>Aï¼šMesos æ˜¯ä¸ªäºŒçº§è°ƒåº¦ï¼Œé€‚ç”¨äºåƒå­˜åœ¨å¤šå¥—é›†ç¾¤çš„æƒ…å†µï¼Œæ¥å‡è¡¡èµ„æºï¼Œå¦‚ï¼šéƒ¨ç½²äº† Hadoop å’Œ storm ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨ storm æ¥å¤„ç†å®æ—¶çš„è¯·æ±‚ï¼ŒHadoop åšç¦»çº¿å·¥ä½œã€‚æ™šä¸Šå’Œç™½å¤©å°±å­˜åœ¨ä¸€ç§å¯èƒ½å°±æ˜¯ Hadoop é—²ç½®ï¼Œä½†æ˜¯ storm å¯èƒ½å¾ˆå¿™ï¼Œè¿™æ—¶ Mesos è¿™æ ·çš„äºŒçº§è°ƒåº¦å°±å¯ä»¥å¹³è¡¡èµ„æºï¼ŒèŠ‚çº¦æˆæœ¬ï¼Œæˆ‘ä»¬æš‚æ—¶æ²¡æœ‰è¿™æ ·çš„éœ€æ±‚ã€‚è‡³äºæ–‡æ¡£æ–¹é¢æˆ‘ä¹Ÿæ²¡æœ‰æ·±å…¥ç ”ç©¶ï¼Œå»ºè®®çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p><blockquote><p>Qï¼šè¯·é—®ä½ ä»¬åœ¨æ„å»ºçš„æ—¶å€™ï¼Œä½ è¯´æœ‰äº›éœ€è¦åŠä¸ªå°æ—¶å·¦å³ï¼Œé‚£ä¹ˆæ„å»ºè¿‡ç¨‹çš„è¿›åº¦ç›‘æ§å’Œå¥åº·ç›‘æ§ä½ ä»¬æ€ä¹ˆåšçš„å‘¢ï¼Œå¦‚æœæœ‰buildå¤±è´¥äº†æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p></blockquote><p>Aï¼šCIçš„æ¯ä¸€æ­¥éƒ½æœ‰è¿›åº¦çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„å›¢é˜Ÿé€šè®¯å·¥å…·å¯ä»¥å’ŒCIé›†æˆï¼Œå¦‚æœå¤±è´¥ä¼šå‘æ¶ˆæ¯åˆ°ç¾¤é‡Œé€šçŸ¥å¤§å®¶ã€‚</p><h2 id="QA-Gitlab"><a href="#QA-Gitlab" class="headerlink" title="QA Gitlab"></a>QA Gitlab</h2><blockquote><p>Q9ï¼šgitlabæ¥æ”¶ä¸€ä¸ªpush eventè§¦å‘æ„å»ºï¼Œè¿™ä¸ªæ˜¯ç›‘æ§æ‰€æœ‰çš„åˆ†æ”¯å—ï¼Œåˆ†æ”¯æ¨¡å‹æ˜¯æ€ä¹ˆæ ·çš„</p></blockquote><p>Aï¼šä¸æ˜¯çš„ï¼ŒæŒ‰éœ€ã€‚æˆ‘ä»¬å†…éƒ¨åˆ†æ”¯æ¨¡å‹å¤§æ¦‚æœ‰å››ç§ï¼Œdevâ€”â€”&gt;testâ€”â€”&gt;releaseâ€”â€”&gt;masterã€‚masterä»¥å¤–çš„ä¸ºäº†æ•ˆç‡éƒ½ä¼šåšè‡ªåŠ¨è§¦å‘</p><blockquote><p>Q11ï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨gitlab-runner è€Œæ¥jenkins</p></blockquote><p>Aï¼šgitlab-runner éœ€è¦æ¯ä¸ªä»“åº“éƒ½é…ç½®æ„å»ºä¿¡æ¯ï¼Œå½“éœ€è¦ç»Ÿä¸€ä¿®æ”¹æ„å»ºçš„æ—¶å€™å¾ˆéº»çƒ¦</p><blockquote><p>Qï¼šæŒç»­é›†æˆç³»ç»Ÿå…·ä½“çš„ç»†èŠ‚å¯ä»¥é€éœ²ä¸‹å—ï¼ŸåŸºäºgitlab ciï¼Œjekinsï¼Ÿæˆ–è€…å°å…¬å¸å¯ä»¥ç›´æ¥ç”¨Spinnaker è¿™äº›å—ï¼Ÿ</p></blockquote><p>Aï¼šci cdçš„è¯å› ä¸ºæˆ‘ä»¬æœ‰è‡ªå·±ç°æœ‰çš„å‘å¸ƒå¹³å°ï¼ŒèƒŒåçš„åŸç†å®é™…ä¸Šè¿˜æ˜¯è°ƒç”¨jenkinså»å¤„ç†</p><blockquote><p>Qï¼šå’Œgitlab ciç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿</p></blockquote><p>Aï¼š å’Œ gitlab ci ç›¸æ¯”çš„ä¼˜åŠ¿å¯ä»¥å‚è€ƒä¸‹ jenkins ä¸ jenkins xçš„å¯¹æ¯”ã€‚åœ¨ç”¨æˆ·è§’åº¦æ¥è¯´ï¼Œä»¥åº”ç”¨ä¸ºè§†è§’ä½¿ç”¨èµ·æ¥ä¼šæ›´åŠ æ–¹ä¾¿ï¼Œä¹Ÿæ–¹ä¾¿åˆ©ç”¨ç¤¾åŒºèµ„æºã€‚ä»æ¶æ„å’Œå¯ç»´æŠ¤æ€§æ¥è¯´ï¼ŒJenkins X çš„æ¶æ„ä¼šç›¸å¯¹æ›´åŠ å…ˆè¿›ï¼ˆä¸è¯ç”Ÿå¹´ä»£æœ‰ç›´æ¥å…³ç³»)ã€‚</p><blockquote><p>Qï¼š ç›®å‰æˆ‘ä»¬ä½¿ç”¨çš„gitlab-ci-runner éƒ¨ç½²äºk8sä¹‹å¤–å®ç°ci/cdã€‚å‘ç°gitlab-ciåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°å¡æ­»æŠ¥é”™ã€‚è¯·é—®ä¸‹ï¼Œç›¸æ¯”jenkins åšci/cd æ˜¯ä¼šæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Œä¹‹å‰å¹¶æ²¡æœ‰ä½¿ç”¨è¿‡jenkins.</p></blockquote><p>Aï¼šgitlab-ciç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰ä½¿ç”¨ï¼Œæˆ‘ä»¬è°ƒç ”çš„ç»“æœæ˜¯1ã€æœ‰ä¾µå…¥æ€§ 2ã€pipelineåŠŸèƒ½è¾ƒå¼±ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯é‡åˆ°é”™è¯¯å¥½åƒè¿˜å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚jenkinsé‡åˆ°é”™è¯¯ä¼šä¸­æ–­æµç¨‹ã€‚</p><blockquote><p>Qï¼šè¯·é—®Jenkinswebhooké‚£äº›æ„å»ºå‚æ•°å¦‚ä½•ä¼ å…¥GitLabè§¦å‘ï¼Ÿ</p></blockquote><p>Aï¼šwebhookçš„è§¦å‘å’Œç•Œé¢å‚æ•°ä¼šæœ‰ä¸€äº›åŒºåˆ«ï¼Œæˆ‘ä»¬åœ¨è„šæœ¬é‡Œé¢åšäº†å¤„ç†ã€‚</p><blockquote><p>Qï¼šç¦»çº¿éƒ¨ç½²ï¼Œæ˜¯ä¸æ˜¯é€šè¿‡æ‰“å‡ºé•œåƒå‹ç¼©åŒ…ï¼Œç„¶åå¸¦ç€é•œåƒåŒ…åˆ°ç°åœºéƒ¨ç½²çš„å®¹å™¨äº‘å¹³å°ä¸Šï¼Œä¸Šä¼ éƒ¨ç½²çš„æ–¹å¼ï¼Ÿ</p></blockquote><p>Aï¼šæ˜¯åœ¨å®¶é‡Œæ‰“å‡ºé•œåƒå‹ç¼©åŒ…ï¼Œç„¶ååˆ°ç°åœºè§£å‹å‡ºæ¥ï¼Œæ ¹æ®é•œåƒç±»å‹è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚ä¸€äº›åŸºç¡€é•œåƒï¼Œä¼šç›´æ¥ä¸Šä¼ åˆ°èŠ‚ç‚¹ï¼Œä¸šåŠ¡çš„é•œåƒä¼šåœ¨éƒ¨ç½²å®Œæˆåä¸Šä¼ åˆ°Harborï¼Œç„¶åèŠ‚ç‚¹ä»Harborå»æ‹‰å–ã€‚</p><blockquote><p>Qï¼šGitLab è‡ªå¸¦çš„ CI ä¸Jenkins å’Œ GitLab ç»“åˆçš„ CIï¼Œè¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿæƒ³çŸ¥é“æ›´æ·±å±‚æ¬¡çš„ç†è§£ã€‚</p></blockquote><p>Aï¼šè¿˜æ˜¯è¦ç»“åˆè‡ªå·±å›¢é˜Ÿçš„å®é™…æƒ…å†µåšé€‰æ‹©ã€‚ä»æˆç†Ÿåº¦æ¥è¯´ï¼Œè‚¯å®šæ˜¯ Jenkinsç”¨æˆ·æœ€å¤šï¼Œæˆç†Ÿåº¦æœ€é«˜ï¼Œç¼ºç‚¹æ˜¯ä¾§é‡ Javaï¼Œé…ç½®ç›¸å¯¹ç¹çã€‚GitLab è‡ªå¸¦çš„ CIç›¸å¯¹ç®€å•ï¼Œå¯ä»¥ç”¨ yamlï¼Œå’Œ GitLab ç»“åˆçš„æœ€å¥½ï¼Œä½†åŠŸèƒ½è‚¯å®šæ²¡æœ‰ Jenkinså…¨é¢ã€‚å¦‚æœæ˜¯å°å›¢é˜Ÿæ–°é¡¹ç›®ï¼ŒGitLab CI åˆå·²ç»å¯ä»¥æ»¡è¶³éœ€æ±‚çš„è¯ï¼Œå¹¶ä¸éœ€è¦ä¸ŠJenkinsï¼Œå¦‚æœæ˜¯è¾ƒå¤§çš„å›¢é˜Ÿï¼Œåˆæ˜¯å Java çš„ï¼Œä¸ªäººæ›´åå‘ Jenkinsã€‚</p><blockquote><p>Qï¼šæœ‰äº†Gerritï¼Œä¸ºä»€ä¹ˆè¿˜è¦GitLabï¼ŒGerritä¹Ÿå¯ä»¥æ‰˜ç®¡ä»£ç å•Šï¼Ÿ</p></blockquote><p>Aï¼šè¿™ä¸ªæ˜¯æœ‰å†å²èƒŒæ™¯çš„ï¼Œæˆ‘ä»¬æ˜¯å…ˆé€‰æ‹©ä½¿ç”¨GitLabåšä»£ç æ‰˜ç®¡ï¼ŒåæœŸæ‰åŠ å…¥Gerritåšcode reviewã€‚Gerritåœ¨ä»£ç reviewæ–¹é¢æ¯”GitLabçš„merge requestè¦æ–¹ä¾¿è®¸å¤šï¼Œæ›´é€‚åˆä¼ä¸šå†…éƒ¨ä½¿ç”¨ã€‚å…³äºè¿™ä¸ªï¼Œæˆ‘çš„æƒ³æ³•æ˜¯ï¼Œè¦ä¹ˆå°†GitLabè¿ç§»åˆ°Gerritï¼Œè¦ä¹ˆä¸ç”¨Gerritï¼Œå¯ä»¥ä½¿ç”¨GitLabçš„merge requestæ¥è¿›è¡Œreviewï¼Œé‚£GitLabå…¶å®æ˜¯å¯ä»¥ä¸è¦çš„ã€‚</p><blockquote><p>Qï¼šå…¬å¸ç¯å¢ƒè¾ƒå¤æ‚ï¼šåŒ…å«Javaé¡¹ç›®ã€PHPé¡¹ç›®ï¼ŒJavaé¡¹ç›®ç›®å‰å¤§å¤šæ˜¯SpringBootæ¡†æ¶ï¼ŒPHPæ˜¯ThinkPHPæ¡†æ¶ï¼Œé¡¹ç›®æ¶æ„å¹¶ä¸å¤æ‚ï¼Œæœ‰å°‘è®¸Javaé¡¹ç›®éœ€è¦ç”¨Redisåˆ°Memcachedã€ç¼“å­˜æœºåˆ¶ã€‚æœ€å¤§é—®é¢˜çš„æ˜¯å¤šï¼Œé¡¹ç›®åº”è¯¥å¦‚ä½•è¾ƒå¥½çš„ä¾æ‰˜Kubernetesé¡ºåˆ©æ¶æ„ï¼Œå°†é¡¹ç›®å¯æŒç»­é›†æˆï¼Ÿ</p></blockquote><p>Aï¼šæˆ‘ä»¬çš„Redisè¿™ä¸€ç±»ä¸­é—´ä»¶è¿˜æ”¾åœ¨VMä¸Šï¼Œç›®å‰å°šæœªæ‰“ç®—æ¬ç§»åˆ°Kubernetesä¸Šï¼ŒKubernetes+Dockerå¤©ç„¶æ˜¯è·¨å¹³å°çš„ï¼ŒPHPä¹Ÿå¯ä»¥æ”¯æŒï¼Œå¹¶ä¸”å¯¹å®¹å™¨é›†ç¾¤ï¼ˆæ—¢åº”ç”¨é›†ç¾¤ï¼‰ç®¡ç†éå¸¸å‡ºè‰²ï¼ŒåŒ…å«éƒ¨åˆ†è‡ªåŠ¨åŒ–è¿ç»´ï¼Œå¹¶ä¸ä¼šå› å¤šç§å¼€å‘è¯­è¨€è€Œå¢åŠ è´Ÿæ‹…ï¼ŒæŒç»­é›†æˆæ˜¯å¦å¤–ä¸€å—ï¼Œç›®å‰å„å¤§CIå·¥å…·å‚å•†ä¹Ÿéƒ½æ”¯æŒKubernetesï¼Œæ¯”è¾ƒå‹å¥½ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„æ˜¯GitLab-CIã€‚</p><blockquote><p>Qï¼šSonarQubeçš„æƒé™æ§åˆ¶åŠæ€§èƒ½å½“é¢ï¼Ÿ</p></blockquote><p>Aï¼šæƒé™æ§åˆ¶ä½¿ç”¨SonarQubeæä¾›çš„APIï¼Œå°†é¡¹ç›®è·ŸGitLabä¸­ç›¸åº”é¡¹ç›®æƒé™åŒ¹é…èµ·æ¥ï¼ŒGitLabä¸­å¯ä»¥æŸ¥çœ‹è¿™ä¸ªé¡¹ç›®ä»£ç ï¼Œé‚£ä¹ˆSonarQubeä¸­å°±èƒ½çœ‹åˆ°è¿™ä¸ªé¡¹ç›®ç»“æœå’ŒCodeã€‚</p><blockquote><p>Q: ä½ ä»¬æ˜¯ç›´æ¥å°†SonarQubeã€GitLab/Jenkinsçš„æƒé™æ§åˆ¶åˆ°ä¸€èµ·äº†ï¼Ÿæ€æ ·åšçš„ç»Ÿä¸€ï¼Ÿ</p></blockquote><p>Aï¼šä½¿ç”¨LDAPè®¤è¯ã€‚</p><blockquote><p>Qï¼šGit Checkoutçš„æ—¶å€™ï¼Œä½ ä»¬çš„Git SCMæ²¡æœ‰è€ƒè™‘éšç§å®‰å…¨çš„äº‹æƒ…å—ï¼Œæ¯”å¦‚ä»£ç æƒé™å—é™ï¼Ÿ</p></blockquote><p>Aï¼šJenkinsä½¿ç”¨äº†ä¸€ä¸ªæœ€å°æƒé™ç”¨æˆ·å»GitLabä¸Šæ‹‰ä»£ç ã€‚å®‰å…¨æ–¹é¢ï¼ŒJenkinsæ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯å¯æ§çš„ã€‚</p><blockquote><p>Qï¼šJenkinsçš„æŒç»­é›†æˆæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿæ¯”å¦‚ä¸åŒçš„æºç ä»“åº“çš„æäº¤è§¦å‘ï¼Œå¦‚GitHubã€GitLabç‰ˆæœ¬å·æ€ä¹ˆæ§åˆ¶çš„ï¼Ÿ</p></blockquote><p>Aï¼šJenkinsçš„CIæµç¨‹è§¦å‘å¯ä»¥æœ‰å¾ˆå¤šç§ï¼Œä»£ç æäº¤è§¦å‘ï¼Œå®šæ—¶è§¦å‘ï¼Œæ‰‹åŠ¨è§¦å‘ã€‚ç‰ˆæœ¬å·çš„æ§åˆ¶ä¹Ÿå¯ä»¥æœ‰å¾ˆå¤šæ–¹æ¡ˆï¼Œæ¯”å¦‚ä½¿ç”¨jobçš„ç¼–å·ï¼Œä½¿ç”¨Gitçš„commitå·ï¼Œä½¿ç”¨æ—¶é—´æˆ³ç­‰ç­‰ã€‚</p><blockquote><p>Qï¼šè¯·é—®ï¼Œæˆ‘ä»¬æ˜¯javaé¡¹ç›®ï¼Œåœ¨ä¸šåŠ¡ä»£ç æ‰“æˆwaråŒ…åï¼ŒwaråŒ…å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œåœ¨å‘å¸ƒæµç¨‹ä¸­ï¼Œå¦‚ä½•å®Œæˆpodä¸­çš„å®¹å™¨çš„ä»£ç æ›´æ–°ï¼Œæ˜¯é‡‡ç”¨æŒ‚è½½ä»£ç åé‡å¯å®¹å™¨æ–¹å¼ï¼Œè¿˜æ˜¯é‡‡ç”¨æ¯æ¬¡é‡æ–°æ„å»ºä»£ç é•œåƒï¼Œç›´æ¥æ›´æ–°å®¹å™¨ï¼Œæˆ–è€…æœ‰ä»€ä¹ˆæ›´å¥½çš„å»ºè®®å—</p></blockquote><p>Aï¼šé…ç½®åˆ†ç¦»ï¼ˆä¸Šé…ç½®ä¸­å¿ƒ)ï¼Œå‚æ•°é€šè¿‡å¯åŠ¨é‰´æƒä¸‹è½½é…ç½®æ–‡ä»¶å¯åŠ¨ï¼Œè¿™æ ·å­ç¯å¢ƒçš„æ›´æ–°åªéœ€è¦åŸºäºé€šè¿‡ä¸€ä¸ªåŒ…å³å¯ã€‚</p><blockquote><p>Qï¼šä¸€ä¸ªJobç”Ÿæˆæ‰€æœ‰çš„Dockeré•œåƒï¼Œå¦‚æœæ„å»ºé‡åˆ°é—®é¢˜ï¼Œæ€ä¹ˆå»è¿½è¸ªè¿™äº›è®°å½•ï¼Ÿ</p></blockquote><p>Aï¼šåœ¨é¡¹ç›®å‰æœŸæ¥å…¥æ—¶ï¼Œç”Ÿæˆé•œåƒçš„æµç¨‹éƒ½ä½œäº†å®£ä¼ å’Œæ¨å¹¿ã€‚æ ‡å‡†åŒ–çš„æµç¨‹ï¼Œä¼šå‡å°‘äº§ç”Ÿé—®é¢˜çš„æœºç‡ã€‚å¦‚æœåœ¨æ„å»ºä¸­é‡åˆ°é—®é¢˜ï¼ŒPrism4kçš„ç•Œé¢ä¸­ï¼Œä¼šç›´æ¥æœ‰é“¾æ¥åˆ°æœ¬æ¬¡å»ºçš„æ¬¡åºå·ã€‚ç‚¹å‡»é“¾æ¥ï¼Œå¯ç›´æ¥å®šä½åˆ°Consoleè¾“å‡ºã€‚</p><blockquote><p>Qï¼šJobå’Œdindå¦‚ä½•é…åˆå»å®ç°æ‰“åŒ…é•œåƒçš„å‘¢ï¼Ÿ</p></blockquote><p>Aï¼šé¦–å…ˆæ˜¯dindæŠ€æœ¯ï¼Œé€šè¿‡æŒ‚è½½å®¿ä¸»æœºçš„docker clientå’Œdockersockï¼Œå¯ä»¥å®ç°åœ¨å®¹å™¨å†…è°ƒç”¨å®¿ä¸»æœºçš„Dockeræ¥åšä¸€äº›äº‹æƒ…ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦å°±ç”¨äºbuildã€‚Kubernetesçš„Jobåˆ™æ˜¯ç”¨äºæ‰§è¡Œè¿™ä¸ªæ„å»ºworkerçš„æ–¹å¼ï¼Œåˆ©ç”¨Kubernetesçš„Jobæ¥è°ƒåº¦æ„å»ºä»»åŠ¡ï¼Œå……åˆ†åˆ©ç”¨æµ‹è¯•é›†ç¾¤çš„ç©ºé—²èµ„æºã€‚</p><blockquote><p>Qï¼šè¯·é—®ä¸‹Mavençš„settings.xmlæ€ä¹ˆå¤„ç†ï¼Ÿæœ¬åœ°Mavenä»“åº“å‘¢ï¼Ÿ</p></blockquote><p>Aï¼šæˆ‘ä»¬æ„å»ºäº†ç§æœ‰çš„ Maven é•œåƒï¼Œ ç§æœ‰é•œåƒä¸­æ˜¯é»˜è®¤ä½¿ç”¨äº†æˆ‘ä»¬çš„ç§æœ‰æºã€‚ å¯¹äºé¡¹ç›®ä¸­ç”¨æˆ·æ— éœ€å…³æ³¨ settings.xml ä¸­æ˜¯å¦é…ç½®repoã€‚</p><blockquote><p>Qï¼šç”Ÿæˆæ–°çš„é•œåƒæ€ä¹ˆè‡ªåŠ¨æ‰“æ–°çš„tagï¼Ÿ</p></blockquote><p>Aï¼šæˆ‘ä»¬é•œåƒTagä½¿ç”¨æœ¬æ¬¡æ„å»ºé€‰å®šçš„Gitç‰ˆæœ¬ï¼Œå¦‚åˆ†æ”¯åç§°æˆ–è€…Tagã€‚</p><blockquote><p>Qï¼š å¦‚ä½•åŠ¨æ€ç”ŸæˆDockerfileï¼Œå¦‚ä½•åœ¨Dockeré•œåƒé‡Œé…ç½®JVMå‚æ•°ï¼Ÿ</p></blockquote><p>Aï¼šDockerfileæ–‡ä»¶ï¼šæˆ‘ä»¬æ˜¯ä½¿ç”¨shè„šæœ¬ç”Ÿæˆçš„ï¼Œå°†å†…å®¹ &gt;&gt; Dockerfileä¸­ï¼›JVMå‚æ•°æ˜¯åœ¨åº”ç”¨ä¸­é…ç½®çš„ï¼Œå‘é€æ„å»ºæ¶ˆæ¯æ—¶ï¼Œä½œä¸ºæ¶ˆæ¯å†…å®¹é€è¿‡å»ã€‚</p><blockquote><p>Qï¼šDocker çš„æ­£ç¡®çš„ä½¿ç”¨å§¿åŠ¿ï¼Œåœ¨æœ¬åœ°ç¯å¢ƒå·²ç»æ„å»ºäº†ä¼ä¸šç§æœ‰ Registry Harborï¼Œé‚£ä¹ˆæˆ‘è¦æ„å»ºåŸºäºä¸šåŠ¡çš„åº”ç”¨æ—¶ï¼Œæ˜¯å…ˆä» Linux ç³»åˆ—çš„åƒ Ubuntu æˆ– CentOS çš„ Base çš„ Docker é•œåƒå¼€å§‹ï¼Œç„¶åé€šè¿‡ Dockerfile å®šåˆ¶ä¸šåŠ¡éœ€æ±‚ï¼Œæ¥ä½¿ç”¨å—ï¼Ÿ</p></blockquote><p>Aï¼šæˆ‘ä»¬åŸºç¡€é•œåƒç»Ÿä¸€é‡‡ç”¨ CentOS 6.8ï¼Œä¸åŒçš„ä¸šåŠ¡æœ‰ä¸åŒçš„ Dockerfile æ¨¡æ¿ï¼Œç”Ÿæˆé•œåƒçš„è¿‡ç¨‹ä¸šåŠ¡å¯¹ Dockerfile æ˜¯é€æ˜çš„ã€‚</p><blockquote><p>Qï¼šä½¿ç”¨Pipelineå…ˆæ„å»ºç¼–è¯‘ç¯å¢ƒé•œåƒï¼Œå†ç¼–è¯‘ï¼Œæ˜¯å¦ä¼šå¯¼è‡´æ•´ä¸ªæµç¨‹éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Ÿæ˜¯å¦æœ‰ä¼˜åŒ–æ–¹æ¡ˆï¼Ÿ</p></blockquote><p>Aï¼šç¼–è¯‘é•œåƒç”±äºä¸ä¼šç»å¸¸å˜åŠ¨ï¼Œå› æ­¤è¿™ä¸ªé•œåƒçš„æ„å»ºé€šå¸¸ä½¿ç”¨cacheå°±èƒ½ç›´æ¥å®Œæˆï¼Œå¦å¤–æˆ‘ä»¬ä¹ŸæŠŠç¼–è¯‘ç¯å¢ƒé•œåƒæ‰“åŒ…è¿™ä¸ªæ­¥éª¤æŠ½å‡ºæ¥å•ç‹¬ä½œä¸ºjobæ‰§è¡Œäº†ï¼Œè¿™æ ·åœ¨å®é™…ç¼–è¯‘æµç¨‹ä¸­å°±æ— éœ€å†è¿›è¡Œç¼–è¯‘ç¯å¢ƒæ„å»ºã€‚</p><blockquote><p>Qï¼šDockerå­˜å‚¨è€ƒè™‘è¿‡Overlayå½“æ—¶å—ï¼Ÿæ®è¯´è¿™ç§æ„å»ºé•œåƒæ¯”è¾ƒå¿«ã€‚</p></blockquote><p>Aï¼šè€ƒè™‘è¿‡ï¼Œå½“æ—¶ä¹Ÿåšè¿‡å„ä¸ªæ–¹é¢çš„æµ‹è¯•ï¼Œè¿™ç§å¢é‡å¼çš„æ„å»ºï¼Œè‚¯å®šæœ€å¿«ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æœ‰ä¸“äººä»æºç çº§åˆ«å¯¹å…¶è¿›è¡Œç»´æŠ¤ï¼Œæˆæœ¬å¯¹äºæˆ‘ä»¬è¿˜æ˜¯æœ‰ç‚¹é«˜ï¼Œæˆ‘ä»¬åæœŸæ‰“ç®—é‡‡ç”¨ç¯å¢ƒå’Œä»£ç åˆ†ç¦»çš„æ–¹å¼ï¼Œå³ç¯å¢ƒéƒ¨ç½²ä¸€æ¬¡ï¼Œä»£ç å¤šæ¬¡éƒ¨ç½²æ¥æå‡æ•ˆç‡ã€‚</p><blockquote><p>Qï¼šæ‚¨æåˆ°ä¸è¿‡åˆ†å¼ºè°ƒæµ‹è¯•è‡ªåŠ¨åŒ–ï¼Œå°½é‡ä¸æ”¹å˜æµ‹è¯•æµç¨‹ï¼Œé‚£ä¹ˆå¯¹äºè‡ªåŠ¨æ„å»ºå’Œå•å…ƒæµ‹è¯•çš„è‡ªåŠ¨åŒ–æœ‰æ²¡æœ‰è€ƒè™‘å‘¢ï¼Ÿæ¯•ç«Ÿè¿™äº›æ˜¯æ¯”è¾ƒæ¶ˆè€—äººåŠ›çš„éƒ¨åˆ†ã€‚</p></blockquote><p>Aï¼šè‡ªåŠ¨æ„å»ºæˆ‘è®¤ä¸ºæ¯”è¾ƒç°å®ï¼Œå•å…ƒæµ‹è¯•æœ‰è€ƒè™‘ã€‚ä¸è¿‡æˆ‘ä»¬æµ‹è¯•æ¡ˆä¾‹è¿‡äºå¤æ‚ï¼Œç›®å‰çœ‹çŸ­æœŸå®ç°ä¸å¤ªç°å®ã€‚è€Œä¸”æ€§èƒ½ä¹Ÿæ˜¯ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸‹ä¸€æ­¥è¦åšæˆ‘ä»¬ä¼šæ›´å¤šè€ƒè™‘ä¸€äº›ç‰¹å®šåœºæ™¯ã€‚æ¯”å¦‚äº§å“å‘å¸ƒåçš„å›å½’æµ‹è¯•ï¼Œè¿™ä¸ªæœ‰å¯èƒ½ï¼Œä½†ä¸ä¼šæ˜¯æ™®éåº”ç”¨ã€‚</p><blockquote><p>Qï¼šè‡ªåŠ¨åŒ–æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå¯¹åº”ç”¨çš„æµ‹è¯•æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</p></blockquote><p>Aï¼šå•å…ƒæµ‹è¯•å¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™å®Œæˆï¼ŒåŠŸèƒ½æµ‹è¯•éœ€è¦å¯åŠ¨éƒ¨ç½²ã€‚</p><blockquote><p>Qï¼šé€šè¿‡é•œåƒçš„æ„å»ºè„šæœ¬æ˜¯æ€ä¹ˆç”Ÿæˆé•œåƒçš„ï¼Ÿåœ¨åŸºç¡€é•œåƒä¸Šæ‰§è¡Œç›¸å…³è„šæœ¬ä¹ˆï¼Ÿä¸€äº›ç«¯å£å­˜å‚¨å·ç¯å¢ƒå˜é‡è¿™äº›é•œåƒä¸­çš„ä¿¡æ¯æ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿ</p></blockquote><p>Aï¼šæˆ‘ä»¬å¯¹Dockerfileè¿›è¡Œäº†å°è£…ï¼Œä¸šåŠ¡å’Œå¼€å‘äººå‘˜ä¸éœ€è¦å…³å¿ƒDockerfileè¯­æ³•ï¼Œç›´æ¥å†™ä¸€ä¸ªé•œåƒæ„å»ºè„šæœ¬ï¼Œæœ€åæ ¹æ®ä¸€å®šçš„è§„åˆ™ç”±Harborç”ŸæˆDockerfileï¼Œä¹‹åè°ƒç”¨docker buildå»ç”Ÿæˆé•œåƒã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ é•œåƒçš„åç§°ï¼Œç‰ˆæœ¬éƒ½å·²ç»æ ¹æ®è§„åˆ™ç”Ÿæˆ</p><blockquote><p>Qï¼šåœ¨æ„å»ºæ—¶å€™ï¼Œè¿™äº›ç¯å¢ƒå¯ä»¥æå‰å®‰è£…å¥½ï¼Ÿ</p></blockquote><p>Aï¼šåº”ç”¨é‡Œéƒ½æœ‰è‡ªå·±çš„ç‰ˆæœ¬æ¦‚å¿µï¼Œæ¯ä¸ªåº”ç”¨ç‰ˆæœ¬é‡Œæœ‰ï¼šé•œåƒç‰ˆæœ¬ï¼Œç¯å¢ƒå˜é‡ã€ exportã€Volmueç­‰ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨å›é€€æˆ–è€…å‡çº§æ—¶å€™ï¼Œæœ€ç»ˆçš„è¡¨ç°å½¢å¼å°±æ˜¯æ€æ‰æ—§å®¹å™¨ï¼Œæ ¹æ®ç‰ˆæœ¬çš„å‚æ•°åˆ›å»ºæ–°å®¹å™¨ã€‚</p><blockquote><p>Qï¼šè¯·é—®æ„å»ºä¸€æ¬¡å¹³å‡è¦å¤šé•¿æ—¶é—´ï¼Ÿ</p></blockquote><p>Aï¼šç°åœ¨Javaã€Dubboã€Pythonã€goçš„å¤šï¼Œ ä¸€èˆ¬2åˆ†é’Ÿï¼Œè€Œä¸”æœ‰çš„é•œåƒç”¨æˆ·å¼€å¯äº†è‡ªåŠ¨æ„å»ºåï¼Œåœ¨ä»–ä»¬æ²¡æ„è¯†çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½å·²ç»æ„å»ºå®Œæˆã€‚ åˆ°æ—¶å€™å‡çº§æ—¶å€™ï¼Œé€‰æ‹©å¯¹åº”çš„é•œåƒç‰ˆæœ¬å³å¯ã€‚</p><blockquote><p>Qï¼šAppçš„æ¯ä¸€æ¬¡æäº¤éƒ½æ˜¯ä¸€ä¸ªversionå—ï¼Œæ˜¯ä¸æ˜¯æ¯æ¬¡æ„å»ºå®Œæµ‹è¯•å®Œæˆï¼Œå°±å¯ä»¥å‘å¸ƒäº†ï¼Ÿ</p></blockquote><p>Aï¼šApp æ²¡æœ‰æäº¤çš„æ¦‚å¿µï¼Œæ‚¨è¯´çš„åº”è¯¥æ˜¯é•œåƒï¼Œæˆ‘ä»¬è®¾è®¡çš„æ˜¯ä¸€ä¸ªé•œåƒå¯¹åº”ä¸€ä¸ªGitä»“åº“ä»¥åŠåˆ†æ”¯ã€‚å½“æœ‰pushæˆ–è€…tagæ“ä½œåï¼Œä¼šè‡ªåŠ¨è§¦å‘æ„å»ºï¼Œæ„å»ºçš„è¡Œä¸ºæ˜¯æ ¹æ®ç”¨æˆ·å†™çš„é•œåƒæ„å»ºshellè„šæœ¬æ¥å†³å®šçš„ã€‚ ä¸€èˆ¬æˆ‘ä»¬å»ºè®®ä¸šåŠ¡éƒ¨é—¨åšå‡ºçš„é•œåƒè·Ÿæµ‹è¯•ç¯å¢ƒå’Œç”Ÿæˆç¯å¢ƒæ²¡å…³ç³»ã€‚ é•œåƒå°±æ˜¯é•œåƒï¼Œåªæœ‰åº”ç”¨æœ‰æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;å¯¹äº
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="gitlab" scheme="https://blog.k8s.li/tags/gitlab/"/>
    
      <category term="CI/CD" scheme="https://blog.k8s.li/tags/CI-CD/"/>
    
      <category term="harbor" scheme="https://blog.k8s.li/tags/harbor/"/>
    
  </entry>
  
  <entry>
    <title>å’Œè‰æ—¶é›¨çš„æœ‰è¶£ç¬”è°ˆ</title>
    <link href="https://blog.k8s.li/with-chanshiyu-qa.html"/>
    <id>https://blog.k8s.li/with-chanshiyu-qa.html</id>
    <published>2020-04-04T16:00:00.000Z</published>
    <updated>2020-04-09T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç”±æ¥"><a href="#ç”±æ¥" class="headerlink" title="ç”±æ¥"></a>ç”±æ¥</h2><p>èµ·åˆæ˜¯å’±çœ‹åˆ° <a href="https://blog.yoitsu.moe" target="_blank" rel="noopener">èŒç‹¼</a> å†™çš„ <a href="https://blog.yoitsu.moe/life/question_exchange_fiveyellowmice.html" target="_blank" rel="noopener">å’Œ FiveYellowMice äº¤æ¢é—®é¢˜ï¼</a> åšå®¢åå°±æƒ³ç€æ‰¾å‡ ä¸ªå‹é“¾é‡Œçš„å‹äººæ¥æ¬¡ç±»ä¼¼çš„ç¬”è°ˆï¼Œä½†ä¹Ÿæ˜¯å¾ˆçº ç»“æ€•è¢«æ‹’ç»å”‰ï¼Œæ‰€ä»¥å†ä¸‰æ–Ÿé…Œäº†ä¸€ä¸‹å°±æ‰¾åˆ°äº†å’±åšå®¢é‡Œç•™è¨€æ¬¡æ•°æœ€å¤šçš„å‹äºº <a href="https://chanshiyu.com/#/" target="_blank" rel="noopener">è‰æ—¶é›¨</a> æ¥è¿›è¡Œæ­¤æ¬¡ç¬”è°ˆğŸ˜‚ã€‚</p><h2 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h2><h3 id="Q1ï¼šæœ¨å­ã®ç‹¬ç™½ï¼Ÿä¸€å¥è¯ä»‹ç»è‡ªå·±"><a href="#Q1ï¼šæœ¨å­ã®ç‹¬ç™½ï¼Ÿä¸€å¥è¯ä»‹ç»è‡ªå·±" class="headerlink" title="Q1ï¼šæœ¨å­ã®ç‹¬ç™½ï¼Ÿä¸€å¥è¯ä»‹ç»è‡ªå·±~"></a>Q1ï¼šæœ¨å­ã®ç‹¬ç™½ï¼Ÿä¸€å¥è¯ä»‹ç»è‡ªå·±~</h3><p>æƒ³äº†åŠå¤©è§‰ç€è¿™ä¸ªé—®é¢˜ä¼°è®¡æ˜¯ 10 ä¸ªé—®é¢˜é‡Œæœ€éš¾çš„ğŸ˜‚ï¼ŒæŒ‘å‡ ä¸ª bio æ¥æ¦‚æ‹¬ä¸€ä¸‹å’±çš„ç»„æˆå§ğŸ˜‹ï¼š</p><p><strong>åœ°çƒäººã€ç´ é£Ÿè€…ã€æ°´æœè¿·ã€ç”µå­å‰å“¨åŸºé‡‘ä¼šæˆå‘˜ã€æ¬ç –ç¤¾ç•œã€è¿ç»´æ”»åŸç‹®ã€‚</strong></p><ul><li><p>åœ°çƒäººï¼šå› ä¸ºè¿™æ¬¡æ­¦æ±‰è‚ºç‚ç—…æ¯’ç–«æƒ…çš„å½±å“ï¼Œå…¨ä¸–ç•Œéƒ½åœ¨é­å—è¿™åœºç˜Ÿç–«çš„æŠ˜ç£¨ï¼Œè€Œæˆ‘ç°å®ä¸–ç•Œé‡Œå‘¨å›´çš„äººå´åœ¨å¹¸ç¾ä¹ç¥¸åœ°åº†ç¥æ¬§ç¾å›½å®¶æ„ŸæŸ“äººæ•°è¶Šå¤šè¶Šå¥½ã€‚æ¯å¬åˆ°èº«è¾¹çš„äººå¯¹å…¶ä»–å›½å®¶æ„Ÿäººäººæ•°å¢å¤šè€Œå¹¸ç¾ä¹ç¥¸åœ°å˜²ç¬‘ï¼Œå“å‘€ï¼å’±æ°”å¾—è·ºè„šå•Šï¼(æ€æ¡Œå„¿ã€‚åœ¨ææƒä¸“åˆ¶å›½å®¶ï¼Œç»Ÿæ²»è€…ä¸ºäº†ç»´æŠ¤å…¶æƒåŠ›çš„åˆæ³•æ€§è€Œè¿›è¡Œæ„è¯†å½¢æ€æ§åˆ¶ä½äººæ°‘çš„æ€æƒ³ï¼Œé€šè¿‡åˆ¶é€ ä»‡æ¨æ¥å¡‘é€ ä¸€ä¸ªè¿œåœ¨å¤©è¾¹çš„æ•Œäººè€Œè®©äººæ°‘å¿˜è®°èº«è¾¹çš„ç—›è‹¦ã€‚å’±å°±æƒ³ï¼šå’±ä¸åš<code>èµµ</code>å›½äººï¼Œåšä¸ªåœ°çƒäººå¤šå¥½å‘€ï¼›å¦‚æœäººç±»èƒ½å¤ŸæŠ›å¼ƒå›½å®¶å’Œæ°‘æ—è¿™ç§æ„è¯†å½¢æ€ä¸Šçš„èº«ä»½ï¼Œéƒ½æŠŠäººç±»å½“ä½œè¿™ä¸ªå­¤ç‹¬æ˜Ÿçƒä¸Šçš„åŒèƒï¼Œå‹å¥½ç›¸å¤„å¤šå¥½å‘€ã€‚</p></li><li><p>ç´ é£Ÿè€…ï¼šæœ‰æ—¶å’±åœ¨æƒ³æˆ‘ä»¬åœ¨å¤§è‡ªç„¶ä¸­ç´¢å–äº†å¤ªå¤šï¼ŒåŒæ—¶åˆä¸æ–­åœ°ç ´åå¤§è‡ªç„¶çš„ç”Ÿæ€å¹³è¡¡ã€‚æˆ‘ä»¬æœ‰ä¹‰åŠ¡ä¸ºå¤§è‡ªç„¶å»åšå‡ºç›¸åº”çš„è¡¥å¿ã€‚æˆ‘è‡ªå·±èº«ä½“åŠ›è¡Œçš„åšæ³•å°±æ˜¯åšä¸€ä¸ªç´ é£Ÿè€…ï¼Œå°½è‡ªå·±æœ€å¤§åŠªåŠ›å°Šé‡å’Œä¿æŠ¤åŠ¨ç‰©ã€‚æˆ‘ä¸æ˜¯åŠ¨ç‰©æƒåˆ©çš„å€¡å¯¼è€…ï¼Œæˆ‘è¿™æ ·åšåªæ˜¯å‡ºäºå¯¹å¤§è‡ªç„¶ï¼Œå¯¹ç”Ÿå‘½å°Šä¸¥çš„æ€è€ƒã€‚æ±‰å¯†å°”é¡¿æ³•åˆ™æ¨¡å‹è®¤ä¸º rB &gt; C æ˜¯åˆ©ä»–è¡Œä¸ºå‘ç”Ÿçš„åŸå› ï¼Œè€Œè¿™æ˜¯åŠ¨ç‰©çš„å¤©æ€§ã€‚å…¶ä¸­ r æ˜¯æ–½åˆ©è€…ä¸å—å®³è€…ä¹‹é—´çš„å…³ç³»ï¼Œå…³ç³»è¶Šå¥½å°±è¶Šé«˜ã€B æ˜¯å—åˆ©è€…æ‰€èƒ½è·å¾—çš„åˆ©ç›Šã€Cæ˜¯æ–½åˆ©è€…æ‰€éœ€ä»˜å‡ºçš„ä»£ä»·ã€‚æ‰€ä»¥ä¸¤è€…å…³ç³»è¶Šç´§å¯†ï¼Œé‚£ä¹ˆåˆ©ä»–è¡Œä¸ºè¶Šå®¹æ˜“å‘ç”Ÿã€‚æ­£æ˜¯å› ä¸º r å¾ˆå¤§è¿™ä¸ªåŸå› ï¼Œäººç±»å¾ˆå°‘ä¼šæŠŠçµé•¿ç±»åŠ¨ç‰©å½“ä½œé£Ÿç‰©ï¼Œä¹Ÿè¶Šæ¥è¶Šå°‘åœ°æŠŠäº²å¯†çš„åŠ¨ç‰©æ¯”å¦‚çŒ«ç‹—å½“ä½œé£Ÿç‰©ã€‚è€Œä» C è§’åº¦ä¹Ÿå°±æ˜¯äººç±»çš„ä»£ä»·æ¥çœ‹ï¼Œäººç±»æ‹¯æ•‘å…¶ä»–åŠ¨ç‰©çš„åˆ©ä»–è¡Œä¸ºï¼Œä¹Ÿå’Œäººç±»å‘å±•çš„ç¨‹åº¦æœ‰å…³ï¼Œå‘å±•ç¨‹åº¦è¶Šé«˜å¯ä»¥åšåˆ°çš„äº‹æƒ…ä¹Ÿå°±è¶Šå¤šï¼Œä¹Ÿå°±å¯ä»¥è€ƒè™‘æ›´å¤šçš„äº‹æƒ…ï¼Œè€Œç´ é£Ÿè¿™æ ·çš„äº‹æƒ…å¹¶ä¸éœ€è¦ä»˜å‡ºæé«˜çš„ä»£ä»·ï¼Œè¿™æ ·çš„äº‹æƒ…ä¸ºä»€ä¹ˆä¸åšå‘¢?</p></li><li><p>æ°´æœè¿·ï¼šå› ä¸ºå’±ç´ é£Ÿåå°±å¤±å»äº†å¾ˆå¤šç¾å‘³é£Ÿç‰©ï¼Œæ‰€ä»¥å”¯æœ‰æ°´æœæ‰èƒ½æ»¡è¶³å’±çš„èƒƒå£å•¦ï¼Œå’±ä¸æŒ‘é£Ÿï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„æ°´æœå’±éƒ½å–œæ¬¢åƒğŸ˜‹ã€‚è‘¡è„ğŸ‡å’Œè‰è“ğŸ“å¯èƒ½æ›´å–œæ¬¢ä¸€ç‚¹ğŸ˜‚</p></li><li><p>ç”µå­å‰å“¨åŸºé‡‘ä¼šæˆå‘˜ï¼šå…¶å®æ¯ä¸ªæœˆç»™ EFF æèµ å°±å¯ä»¥å•¦ğŸ˜‚ã€‚è‡ªä»å’±å¤§å­¦æ¯•ä¸šå½“äº†ç¤¾ç•œå¼€å§‹æ¬ç –ä¹‹åï¼Œè‡ªå·±èƒ½èµšä¸€ç‚¹å°é’±äº†ï¼Œæ‰€ä»¥å°±æ¯æœˆç»™ EFF ç”µå­å‰å“¨åŸºé‡‘ä¼šæèµ  5$ ã€‚å› ä¸º EFF æ˜¯ä¸€ä¸ªå…·æœ‰é¢†å¯¼åœ°ä½çš„éç›ˆåˆ©ç»„ç»‡ï¼Œè‡´åŠ›äºåœ¨æ•°å­—ä¸–ç•Œæå«å…¬æ°‘è‡ªç”±ã€‚è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šå’Œç”µå­å‰çº¿åŸºé‡‘ä¼šä¸€ç›´æ˜¯è‡ªç”±äº’è”ç½‘ä¸–ç•Œé‡Œå¯¹æŠ— BIG BROTHER çš„æœ€å‰çº¿ï¼Œè¿™ç§å¯¹æŠ—ä¸ä»…ä»…æ˜¯åœ¨æŠ€æœ¯é¢†åŸŸï¼Œæ³•å¾‹é¢†åŸŸä¹Ÿæ˜¯å¦‚æ­¤ã€‚EFF è¿‡å»çš„ 30 å¤šå¹´ä¸­ï¼Œé€šè¿‡å½±å“è¯‰è®¼ï¼Œæ”¿ç­–åˆ†æï¼ŒåŸºå±‚è¡ŒåŠ¨ä»¥åŠæŠ€æœ¯ç ”å‘ï¼Œæå«ç”¨æˆ·éšç§ï¼Œè¨€è®ºè‡ªç”±ä»¥åŠåˆ›æ–°ã€‚è¯¥åŸºé‡‘ä¼šçš„è¯•å›¾é€šè¿‡åŠªåŠ›ä¿éšœï¼Œåœ¨æŠ€æœ¯è¿›æ­¥çš„å‰æä¸‹ï¼Œäººä»¬çš„è‡ªç”±å’ŒæƒåŠ›ä¹Ÿå—åˆ°ç›¸åº”çš„ä¿æŠ¤ã€‚è™½ç„¶ä¸ªäººçš„æèµ å¯¹äºæ€»ä½“æ¥è®²å¾®ä¹å…¶å¾®ï¼Œ<strong>ä½†æ— è®ºæ•´ä½“ç»“æœå¦‚ä½•ï¼Œå¿ äºåŸåˆ™çš„è¡Œä¸ºï¼Œéƒ½æœ‰å…¶æœ¬èº«çš„é“å¾·ä»·å€¼ï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚</strong> å’±åšä¿¡çš„é“å¾·ä»·å€¼å°±æ˜¯ï¼š<strong>æ— è®ºå¢™æœ‰å¤šé«˜ï¼Œéƒ½ä¸èƒ½æ”¾å¼ƒå¯¹è‡ªç”±äº’è”ç½‘çš„è¿½æ±‚</strong>ï¼Œè€Œæèµ æ”¯æŒåƒç”µå­å‰å“¨åŸºé‡‘ä¼šã€ç»´åŸºåª’ä½“åŸºé‡‘ä¼šã€è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šã€äº’è”ç½‘æ¡£æ¡ˆé¦†ç­‰è¿™äº›æå«äº’è”ç½‘è‡ªç”±çš„éè¥åˆ©æ€§ç»„ç»‡ï¼Œæ­£æ˜¯åœ¨ä¼ æ’­è‡ªç”±äº’è”ç½‘çš„ç²¾ç¥ã€‚</p></li></ul><h3 id="Q2ï¼šå¯¹æ—¶é›¨çš„åˆå°è±¡ï¼Ÿ"><a href="#Q2ï¼šå¯¹æ—¶é›¨çš„åˆå°è±¡ï¼Ÿ" class="headerlink" title="Q2ï¼šå¯¹æ—¶é›¨çš„åˆå°è±¡ï¼Ÿ"></a>Q2ï¼šå¯¹æ—¶é›¨çš„åˆå°è±¡ï¼Ÿ</h3><ul><li>å¯çˆ±æ¸©æŸ” <strong>(<em>â‰§ï¸¶â‰¦))(ï¿£â–½ï¿£</em> )ã‚</strong>ï¼š</li></ul><p>å’±ç¬¬ä¸€æ¬¡è®¿é—®æ—¶é›¨çš„åšå®¢æ˜¯æ±åœ¨å’±é‚£ç¯‡<a href="https://blog.k8s.li/Kindle-Oasis2-vs-Paperwhite3.html">ã€ŠKindle Oasis å’Œ Kindle Paperwhite3 ä½¿ç”¨ä½“éªŒã€‹</a> å®¢ç•™è¨€ä¹‹åï¼Œå’±æ‰æ³¨æ„åˆ°æ—¶é›¨ï¼Œå› ä¸ºä¹‹å‰å¾ˆå°‘ä¼šæœ‰äººåœ¨å’±åšå®¢å¤šæ¬¡ç•™è¨€ã€‚äºæ˜¯å’±å¥½å¥‡åœ°ç‚¹å¼€äº†æ—¶é›¨çš„åšå®¢ï¼Œç¬¬ä¸€çœ¼å°±æƒŠå‘†äº†<strong>w(ï¾ŸĞ”ï¾Ÿ)w</strong>ã€‚è¿™ä¹Ÿæ˜¯å’±è§è¿‡çš„æœ€æœ‰å¿ƒçš„åšå®¢ï¼Œè¢«æ—¶é›¨çš„æ‰èƒ½æ·±æ·±æŠ˜æœï¼ˆå•†ä¸šèƒ¡å¹ğŸ˜‚ã€‚ç„¶åå’±å°±ç¿»éäº†æ—¶é›¨çš„åšå®¢å’Œ dispus ä¸Šçš„è¯„è®ºï¼Œæƒ³è¦è®¤è¯†ä¸€ä¸‹æ—¶é›¨ã€‚ä¸ä»…ä»…æ˜¯åšå®¢çš„è®¾è®¡å’Œä¸»é¢˜ï¼Œè¿æ–‡å­—éƒ½ä¼šå¸¦ç€å¯çˆ±çš„<code>å£°éŸ³</code>ã€‚æ¯”å¦‚ <code>ï½</code> å’Œ <code>â€—ã€‚â€—</code> ç­‰æ ‡ç‚¹ç¬¦å·ï¼Œä»¿ä½›å°±åƒæ–‡ç« çš„æŒ‡çº¹ï¼Œè¯»èµ·æ¥å°±åƒæœ‰äº†å£°éŸ³ä¸€æ ·ç¥å¥‡ã€‚å’±å¥½åƒä¹Ÿå—æ±çš„å½±å“è€¶ï¼Œæ…¢æ…¢åœ°åœ°å–œæ¬¢åŠ ä¸€äº›æ ‡ç‚¹ç¬¦å·ğŸ˜‚ã€‚</p><ul><li>è¯—æ„å°‘å¹´ï¼š</li></ul><blockquote><p>å¤æ—¥ä¼—è‰é¸£å«æ­¤èµ·å½¼ä¼å¥½ä¼¼è½é›¨ï¼Œè‰å„¿ä»¬ä¼¼è¦å°†ä»…å­˜çš„çš„ç”Ÿå‘½ç‡ƒçƒ§å¥å‡ºæœ€åçš„éŸ³ç¬¦ï¼Œç»šçƒ‚ä¸å£®ç¾ä¸­æ°¤æ°²ç€æ²‰å¯‚ä¸æ— å¸¸ï¼Œæ˜¯æ—¥æœ¬å¤å¤©æœ€å…·ä»£è¡¨æ€§çš„å­£èŠ‚ç‰©è¯­ä¹‹ä¸€ã€‚</p></blockquote><ul><li><p>å–„è‰¯çƒ­å¿ƒï¼šå°†è‡ªå·±å†™çš„åšå®¢ä¸»é¢˜å¼€æºåˆ†äº«å‡ºæ¥ï¼Œè€Œä¸”çƒ­å¿ƒå¸®åŠ©ä»–äººæ€ä¹ˆå»é£Ÿç”¨ ğŸ˜‹</p></li><li><p>å¿ƒæ€ç»†è…»ï¼šé€šè¿‡æ±çš„æ–‡ç« å’Œæµè¨€å¯ä»¥çŒœæµ‹å‡ºï¼Œç°å®ä¸­æ¯”è¾ƒå†…å‘ä¸å–„è¡¨è¾¾ï¼Œä½†å¿ƒé‡Œæ´»åŠ¨ä¸°å¯Œï¼Œæƒ³äº¤æµçš„è¯ä¹Ÿå¾ˆå¤šçš„æ ·å­è€¶ã€‚</p></li></ul><p>ä»¥ä¸Šå°±æ˜¯å’±å¯¹æ—¶é›¨çš„åˆå°è±¡å•¦ğŸ˜Š</p><h3 id="Q3ï¼šå–œæ¬¢ä»€ä¹ˆç±»å‹çš„éŸ³ä¹ï¼Ÿæ¨èä¸€é¦–å•æ›²å¾ªç¯çš„æ­Œï¼Ÿ"><a href="#Q3ï¼šå–œæ¬¢ä»€ä¹ˆç±»å‹çš„éŸ³ä¹ï¼Ÿæ¨èä¸€é¦–å•æ›²å¾ªç¯çš„æ­Œï¼Ÿ" class="headerlink" title="Q3ï¼šå–œæ¬¢ä»€ä¹ˆç±»å‹çš„éŸ³ä¹ï¼Ÿæ¨èä¸€é¦–å•æ›²å¾ªç¯çš„æ­Œï¼Ÿ"></a>Q3ï¼šå–œæ¬¢ä»€ä¹ˆç±»å‹çš„éŸ³ä¹ï¼Ÿæ¨èä¸€é¦–å•æ›²å¾ªç¯çš„æ­Œï¼Ÿ</h3><ul><li><p>ä¸€äº›åŠ¨ç”»çš„ OP/ED/ç‰¹å…¸/BGM ï¼Œæ¯”å¦‚ï¼š å››æœˆã¯å›ã®å˜˜ã€ ãƒªã‚ºã¨é’ã„é³¥ã€ NARUTO -ãƒŠãƒ«ãƒˆ-ã€ã€Œæ—¥å¸¸ã€ã®åˆå”±æ›²</p></li><li><p>å•æ›²å¾ªç¯çš„ï¼šå½“ç„¶æ˜¯å’±æœ€å–œæ¬¢çš„ã€Œå››æœˆã¯å›ã®å˜˜ã€ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°ãƒ†ãƒ¼ãƒã€å…‰ã‚‹ãªã‚‰ã€å•¦ğŸ˜‹</p></li></ul><h3 id="Q4ï¼šå–œæ¬¢ä»€ä¹ˆç±»å‹çš„ä¹¦ç±ï¼Ÿå¯¹çº¸è´¨ä¹¦å’Œç”µå­ä¹¦ä¸¤ç§é˜…è¯»æ–¹å¼çš„çœ‹æ³•ï¼Ÿ"><a href="#Q4ï¼šå–œæ¬¢ä»€ä¹ˆç±»å‹çš„ä¹¦ç±ï¼Ÿå¯¹çº¸è´¨ä¹¦å’Œç”µå­ä¹¦ä¸¤ç§é˜…è¯»æ–¹å¼çš„çœ‹æ³•ï¼Ÿ" class="headerlink" title="Q4ï¼šå–œæ¬¢ä»€ä¹ˆç±»å‹çš„ä¹¦ç±ï¼Ÿå¯¹çº¸è´¨ä¹¦å’Œç”µå­ä¹¦ä¸¤ç§é˜…è¯»æ–¹å¼çš„çœ‹æ³•ï¼Ÿ"></a>Q4ï¼šå–œæ¬¢ä»€ä¹ˆç±»å‹çš„ä¹¦ç±ï¼Ÿå¯¹çº¸è´¨ä¹¦å’Œç”µå­ä¹¦ä¸¤ç§é˜…è¯»æ–¹å¼çš„çœ‹æ³•ï¼Ÿ</h3><p>è™½ç„¶å„æ–¹é¢çš„ä¹¦éƒ½æœ‰æ‰€æ¶‰çŒï¼Œä½†æ›´åå‘äºè‡ªç„¶ç§‘å­¦ä¹‹ç±»çš„ä¹¦ç±ã€‚å› ä¸ºè¿™äº›ä¹¦å…±åŒç‚¹å°±æ˜¯æ»¡è¶³è‡ªå·±çš„å¥½å¥‡å¿ƒå’Œæ±‚çŸ¥æ¬²ï¼Œä½¿è‡ªå·±æ›´åŠ æ¸…æ¥šä¸‡äº‹ä¸‡ç‰©èƒŒåçš„è‡ªç„¶çœŸç†ï¼Œä»è€Œå¯¹å¤§è‡ªç„¶ä»¥åŠç”Ÿå‘½æ€€æœ‰å´‡é«˜çš„æ•¬æ„ï¼Œè¿™æ ·æ‰èƒ½æ˜ç™½äººç±»çš„æ¸ºå°å’Œæ— çŸ¥ã€‚</p><p>æ¯”å¦‚å’±æƒ³çŸ¥é“æœ¨æ˜Ÿä¸Šçš„é‚£å—èƒ½åä¸‹åœ°çƒçš„å¤§çº¢æ–‘ï¼›å’±æƒ³çŸ¥é“åœ°çƒçš„å†…æ ¸æ—¶å›ºæ€çš„è¿˜æ˜¯æ¶²æ€çš„ï¼Ÿåœ°ç£åœºå¦‚ä½•å½¢æˆï¼Œä¸ºä»€ä¹ˆåœ°ç£åœºä¼šå€’è½¬ï¼Ÿåœ°çƒçš„ç”Ÿå‘½èµ·æºä»¥åŠå‡ åäº¿å¹´çš„ç”Ÿå‘½è¿›åŒ–å†ç¨‹ï¼›å’±ä»¬äººç±»çš„ç¥–å…ˆæ™ºäººä»ä¸œéå¤§è£‚è°·èµ°å‡ºåå†ç»ä¸‡å¹´çš„è¿ç§»è¿›åŒ–ä¹‹æ—…ï¼Ÿå’±æƒ³çŸ¥é“ç»†èƒä¸­çš„ç»†èƒå™¨æ˜¯å¦‚ä½•è¿›åŒ–è€Œæ¥çš„ï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´å¦‚ä½•åˆ†å·¥åˆä½œçš„ï¼›DNA å¦‚ä½•æ§åˆ¶åŸºå› è¡¨è¾¾ä»¥åˆ›é€ å‡ºä¸ä¼—ä¸åŒçš„ä¸‡ç‰©ç”Ÿçµã€‚è¿˜æœ‰å’±æƒ³çŸ¥é“å¤å¸Œè…ŠåŸé‚¦é›…å…¸æ–‡æ˜ï¼›æƒ³çŸ¥é“é‡‘å­—å¡”å¦‚ä½•å»ºé€ ä»¥åŠå¤åŸƒåŠæ³•è€è¿½æ±‚æ°¸ç”Ÿèµ‹äºˆçš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿæƒ³çŸ¥é“ NASA æ¢ç´¢å¤ªç©ºçš„è‰°è¾›å†ç¨‹ï¼Ÿæƒ³çŸ¥é“é£å‡ºæ˜Ÿé™…ç©ºé—´çš„æ—…è¡Œè€… 1 å·ç°åœ¨è¿˜å¥½å—ï¼Ÿ</p><p><img src="img/image-20200404190616475.png" alt="image-20200404190616475"></p><p>æ€»ä¹‹è™½ç„¶å’±éƒ½å·²ç»æ˜¯äºŒåæœ‰äº”çš„äººæˆå¹´äººäº†ï¼Œä½†å’±çš„å¿ƒæ™ºè¿˜æ˜¯å’Œä¸­å°å­¦ç”Ÿä¸€æ ·ï¼Œé•¿ä¸å¤§çš„å¥½å¥‡å®å®ï¼Œæƒ³çŸ¥é“çš„äº‹æƒ…è¿˜æœ‰å¾ˆå¤šå¾ˆå¤šã€‚è¿™ä¸€ç‚¹å’±å’Œ <a href="https://twitter.com/Philo2018" target="_blank" rel="noopener">Philo</a> æœ‰ç‚¹åƒ ğŸ˜‚ï¼Œæ±å¯ä»¥çœ‹çœ‹å¥¹å†™çš„ <a href="http://lulalap.com/2020/01/02/collection-of-interesting-ideas-2019/" target="_blank" rel="noopener">Philoçš„è„‘æ´åˆé›†ï¼ˆ2019ï¼‰</a> ã€‚è€Œè¯»è¿™ç±»ä¹¦ç±æ­£æ˜¯æ»¡è¶³å’±å¥½å¥‡å¿ƒï¼Œæ±²å–çŸ¥è¯†çš„æµ·æ´‹ï¼Œè¿™ä¹Ÿæ˜¯å’±è¯»ä¹¦çš„åŸå› ã€‚æƒ³èµ·äº†æ³•å›½åšç‰©å­¦å®¶ <a href="https://zh.wikipedia.org/wiki/%E5%B8%83%E4%B8%B0" target="_blank" rel="noopener">å¸ƒä¸°</a> åœ¨ã€Šè‡ªç„¶å²ã€‹ä¹¦ä¸­çš„è¯—å¥ï¼š</p><blockquote><p>ä¸–ç•Œä¸‡ç‰©è¿è½¬æ— æ­¢æ¯ï¼Œä¸‡ç‰©éƒ½åœ¨çš„ä¸–é—´æ´ªæµä¸­ç›¸é‡ï¼Œåœ¨å¹¿è¢¤æ— å°½çš„ç©ºé—´ä¸­ï¼Œä»¥åŠç‰©æ¢æ˜Ÿç§»çš„æ¥è½¨ç¬é—´ï¼Œä¸‡ç‰©æ··æˆå†¥æ²³ï¼Œä¸æ‹˜ä»»ä½•å½¢ä½“ï¼Œä¸æ‹˜ä»»ä½•è¢«èµ‹äºˆçš„å½¢è±¡ã€‚å› æ­¤ï¼Œä¸‡äº‹ä¸‡ç‰©æˆ–ç›¸è¿‘ï¼Œæˆ–è¿œç¦»ï¼Œæˆ–åˆä¸€ï¼Œæˆ–åˆ†ç¦»æˆ–ç›¸å®¹ï¼Œæˆ–ç›¸æ–¥ï¼Œæˆ–ç”Ÿï¼Œæˆ–ç­ï¼Œæ’ä¹…ä¸å˜çš„ï¼Œåªæœ‰äº¤äº’ä½œç”¨çš„åŠ›ã€‚æ£æ„æ¨ªè¡Œï¼Œå´çµå·§è€Œä¸è‡ªä¼ï¼Œä¸ºå®‡å®™ç‡ƒèµ·ç”Ÿå‘½æ°”æ¯ï¼Œè®©ç”Ÿå‘½èˆå°ä¸Šï¼Œæ— æ—¶æ— åˆ»ä¸Šæ¼”ç€æ–°çš„æˆç ï¼Œå†™ä¸‹ç”Ÿç”Ÿä¸æ¯ï¼Œæ°¸æ— æ­¢å¢ƒçš„è¯—ç¯‡ã€‚</p></blockquote><p>é€šè¿‡é˜…è¯»è¿™ç±»ä¹¦ç±å»å’Œå…ˆè´¤å“²äººä»¬äº¤æµï¼Œæ€€æ£ç€æ‡µæ‡‚çš„å¥½å¥‡å¿ƒå»æ„Ÿæ‚Ÿå¤§è‡ªç„¶çš„ç¥å¥‡å’Œå¥¥ç§˜ã€‚</p><p>å…³äºçº¸è´¨ä¹¦ï¼šå’±å–œæ¬¢çš„è¯»ä¹¦æ–¹å¼è¿˜æ˜¯å€¾å‘äºçº¸è´¨ä¹¦ï¼Œå› ä¸ºä¹¦è¿™ç§ä¸œè¥¿ä¸ä»…ä»…æ˜¯ç”¨æ¥çœ‹ä¸Šé¢çš„æ–‡å­—ï¼Œä¹Ÿæ˜¯ç”¨æ¥è°ƒæ•´è‡ªå·±æ„Ÿè§‰å¾—å·¥å…·ã€‚å½“æ‰‹æŒ‡è§¦ç¢°ä¹¦é¡µæ—¶çš„æ„Ÿè§‰å’Œå“—å•¦å•¦ç¿»ä¹¦çš„ç¬é—´ç»™ç¥ç»çš„åˆºæ¿€æ˜¯ç”µå­ä¹¦æ— æ³•æ›¿ä»£çš„ã€‚è€Œä¸”å’±è¯»ä¹¦çš„æ—¶å€™å–œæ¬¢æ‹¿ä¸€æ”¯ç¬”åœ¨ä¹¦ä¸­æœ‰è¶£çš„åœ°æ–¹ä¹±æ¶‚ä¹±ç”»ğŸ˜‚ï¼Œå†™ä¸‹è‡ªå·±çš„æ„Ÿæ‚Ÿå’Œæ€è€ƒã€‚å–œæ¬¢æŠŠä¸€äº›ç²¾ç¾çš„ç‰‡æ®µæ‘˜æŠ„åœ¨çº¸è´¨æ‘˜æŠ„æœ¬ä¸Šï¼Œè¯»ä¹¦çš„æ€è€ƒç¬”è®°å†™åœ¨æ—¥è®°æœ¬ä¸Šã€‚å¤§å­¦çš„æ—¶å€™å†™äº†å¾ˆå¤šçš„æ‘˜æŠ„æœ¬å’Œæ—¥è®°ï¼Œç°åœ¨ç¿»æ¥çœ‹çœ‹æœ‰æ—¶è§‰ç€å½“åˆå¥½å¹¼ç¨šğŸ˜‚ã€‚è¿™ä¸ªä¹ æƒ¯è‡ªä»æ¯•ä¸šä¹‹åå°±åºŸå¼ƒäº†ï¼Œå› ä¸ºæ…¢æ…¢åœ°ä¹ æƒ¯ä¸Šåœ¨ kindle ä¸Šè¯»ä¹¦ï¼Œæ‘˜æŠ„å’Œç¬”è®°ä¹Ÿéƒ½æ˜¯æ ‡æ³¨å’Œæ‰“å­—çš„æ–¹å¼ï¼Œä»¿ä½›å¤±å»äº†å½“åˆåœ¨å¤§å­¦æ—¶è¯»ä¹¦çš„é‚£ç§çº¯çœŸï¼Œæœ‰ç‚¹é—æ†¾ï¼Œæœ‰æ—¶åˆæƒ³æ¡èµ·è¿™ä¸ªä¹ æƒ¯ã€‚</p><p>å¤§å­¦çš„æ—¶å€™å’±è¯»çš„åŸºæœ¬ä¸Šå…¨æ˜¯çº¸è´¨ä¹¦ï¼Œæ•´å¤©æ³¡å›¾ä¹¦é¦†é‡Œæ‘¸é±¼ğŸ˜‚ã€‚å››å¹´é—´ä¹°äº†ä¸å°‘ä¹¦ï¼Œæ¯•ä¸šå‰æèµ ç»™å›¾ä¹¦é¦†å¾ˆå¤§ä¸€éƒ¨åˆ†ï¼Œé€ç»™å­¦å¼Ÿå­¦å¦¹ä»¬ä¸€äº›ï¼Œåˆ°æœ€åè¿˜å‰©ä¸¤éº»è¢‹çš„ä¹¦ä¸èˆå¾—ä»å°±é‚®å¯„å›å®¶äº†ã€‚å½“æ—¶å¯„å¿«é€’çš„æ—¶å€™è´¹äº†å¾ˆå¤§çš„åŠŸå¤«ï¼Œè¦é€åˆ°ä¸‰åå…¬é‡Œå¤–çš„ç‰©æµå›­åŒºï¼Œå¯æŠŠå’±ç´¯åäº†ğŸ˜‘ã€‚ä»æ¯•ä¸šä¹‹åå°±å¾ˆå°‘å†ä¹°çº¸è´¨ä¹¦äº†ï¼Œæ¬å®¶çš„æ—¶å€™å¤ªä¸æ–¹ä¾¿äº†ï¼Œä¸æƒ³å†ä½“éªŒç¬¬äºŒæ¬¡äº†ğŸ˜‚ï¼Œæ‰€ä»¥åæ¥å°±æ…¢æ…¢ä¹ æƒ¯ç”¨ kindle çœ‹ä¹¦äº†ã€‚</p><p>kindle ç”µå­ä¹¦ä¹Ÿæ˜¯å¿«è¦å¤§å››çš„æ—¶å€™æ‰ä¹°çš„ã€‚å†åˆ°å»å¹´çš„æ—¶å€™åˆæ¢äº† kindle oasisï¼Œå¸¦æœ‰ç‰©ç†ç¿»é¡µé”®ï¼Œæœ‰äº†ä¸€ç§è¯»çº¸è´¨ä¹¦æ—¶ç¿»é¡µçš„æ„Ÿè§‰ï¼Œç›´åˆ°ç°åœ¨ä¸€ç›´æ˜¯å’±æ¯å¤©å¿…é¡»è¦ç”¨åˆ°çš„ç¡å‰è¯»ç‰© + å‚¬çœ ç¥å™¨ğŸ˜‚</p><p>ç”µå­ä¹¦å’Œçº¸è´¨ä¹¦åªæ˜¯æ–‡å­—çš„æ‰¿è½½æ–¹å¼å˜äº†ï¼Œåªè¦æˆ‘ä»¬ä¸“å¿ƒè®¤çœŸåœ°å»è¯»ä¼šå°±ä¼šç¼©å°ä¸¤ç§é˜…è¯»æ–¹å¼ä¹‹é—´çš„å·®è·ï¼Œæˆ‘ç›¸ä¿¡å³ä¾¿è¯»ç”µå­ä¹¦ä¹Ÿæ˜¯èƒ½å’Œçº¸è´¨ä¹¦é‚£æ ·æœ‰åŒæ ·çš„æ•ˆæœå’Œä½“éªŒã€‚çŠ¶æ€ä¸å¥½æ—¶ï¼Œæœ‰æ—¶å€™ä¼šè¯»ä¸ä¸‹å»ï¼Œè¿™æ—¶å€™å°±è¦æ€è€ƒæ˜¯ä»€ä¹ˆå¹²æ‰°äº†è¯»ä¹¦ï¼Œæœ‰äº›ä¹¦å³ä½¿åœ¨çŠ¶æ€ä¸å¥½æ—¶ä¹Ÿèƒ½é¡ºåˆ©çš„çœ‹ä¸‹å»ï¼Œè¿™æ—¶å€™å°±æƒ³æƒ³ä¸ºä»€ä¹ˆä¼šè¿™æ ·ã€‚</p><p>ç”µå­ä¹¦å’±è¿˜æ˜¯å–œæ¬¢ kindle è¿™ç§ç®€å•çš„è¯»ä¹¦å·¥å…·ï¼Œæ²¡æœ‰æ‚ä¸ƒæ‚å…«çš„èŠ±æ¶å­ã€‚è€Œæ‰‹æœºä¸Šçš„ app å…¶å®å¹¶ä¸é€‚åˆè¯»ä¹¦ï¼Œæ¯”å¦‚å¾®ä¿¡è¯»ä¹¦ç­‰è½¯ä»¶ï¼Œä»–ä»¬é™¤äº†è¯»ä¹¦åŠŸèƒ½ä»¥å¤–è¿˜å¤¹å¸¦ç¤¾äº¤åŠŸèƒ½ï¼Œå¹¿å‘Šæµé‡å•†ä¸šåŒ–ä¹Ÿå¾ˆä»¤äººä½œå‘•ã€‚æˆ‘ä»…ä»…æ˜¯çº¯ç²¹åœ°è¯»ä¸ªä¹¦è€Œå·²ï¼Œè€Œè¿™äº›è½¯ä»¶å´åœ¨ç¤¾äº¤å’Œæ”€æ¯”è™šè£ã€‚</p><p>è€Œä¸”å’±ç”¨ kindle è¯»ä¹¦ï¼Œé‡åˆ°å–œæ¬¢çš„ä¹¦ä¸€å£æ°”è¯»ä¸€ä¸¤ä¸ªå°æ—¶ä¸ä¸­æ–­å¯ä»¥è½»è½»æ¾æ¾åœ°åšåˆ°ï¼Œè€Œæ‰‹æœºä¸Šå’Œé˜…è¯»æ— å…³çš„ä¿¡æ¯æµå¤ªå¤šï¼Œæå®¹æ˜“è¢«æ³›æ»¥çš„ä¿¡æ¯æ‰€æŸç¼šä½è€Œç”¨å®é™…é˜…è¯»ï¼Œæˆ‘ç›¸ä¿¡å¾ˆå¤šäººéƒ½æ— æ³•åšåˆ°åšæŒä¸‰ååˆ†é’Ÿä¸ä¸­æ–­ã€‚è¿™ä¹Ÿæ˜¯å’±å…‹åˆ¶æ¯å¤©ä½¿ç”¨æ‰‹æœºæ—¶é•¿ä¸è¶…è¿‡ä¸€ä¸ªå°æ—¶çš„åŸå› ï¼Œå’±ä½¿ç”¨ kindle çš„æ—¶é—´æ˜¯æ‰‹æœºäº†ä¸¤å€ğŸ˜‚ã€‚æœ‰æ—¶å€™æ¥å—çš„ä¿¡æ¯å¤ªå¤šä¹Ÿæ˜¯ä¸€ç§æŸç¼šï¼Œä½¿è‡ªå·±æ— æ³•é›†ä¸­ç²¾åŠ›åœ¨é‡è¦çš„é˜…è¯»ä¸Šã€‚</p><h3 id="Q5ï¼šå¯¹å½“ä»Šæ—¶ä»£ç‹¬ç«‹åšå®¢çš„å‘å±•ä¸å±•æœ›ï¼Ÿ"><a href="#Q5ï¼šå¯¹å½“ä»Šæ—¶ä»£ç‹¬ç«‹åšå®¢çš„å‘å±•ä¸å±•æœ›ï¼Ÿ" class="headerlink" title="Q5ï¼šå¯¹å½“ä»Šæ—¶ä»£ç‹¬ç«‹åšå®¢çš„å‘å±•ä¸å±•æœ›ï¼Ÿ"></a>Q5ï¼šå¯¹å½“ä»Šæ—¶ä»£ç‹¬ç«‹åšå®¢çš„å‘å±•ä¸å±•æœ›ï¼Ÿ</h3><p>æœ¨å­ä¸ºä»€ä¹ˆè¦å†™ä¸ªäººç‹¬ç«‹åšå®¢å‘ï¼Œæˆ‘æƒ³å½“ä»Šå›½å†…å±€åŸŸç½‘å¤§è§„æ¨¡åˆ å¸–å°å·ã€ä¿¡æ¯å°é”ã€æ„šæ°‘æ´—è„‘ã€å…¬æƒé€ è°£å¼è¾Ÿè°£çš„äº‹æƒ…å·²ç»ç»™å‡ºå¾ˆæ˜ç¡®çš„ç­”æ¡ˆã€‚</p><p>è™½è¯´å„å›½éƒ½ä¼šæœ‰å®¡æŸ¥åˆ¶åº¦çš„å­˜åœ¨ï¼Œä½†å¤©æœè¿™ç§å®¡æŸ¥åˆ¶åº¦ï¼Œæ˜¯ä»¥äººæ€§æ”¹é€ ä¸ºç›®çš„æ€æƒ³é’³åˆ¶ï¼Œæ˜¯ä½œä¸ºæ¬ºéª—æ‰‹æ®µçš„è°è¨€å®£ä¼ ï¼›æ˜¯ææƒç»Ÿæ²»è€…å°†äººæ°‘é©¯æœä¸ºå›½å®¶æœºå™¨å¥´éš¶çš„å·¥å…·ã€‚æ­¦æ±‰è‚ºç‚ç—…æ¯’ç–«æƒ…å·²ç»è¿‡å»ä¸€ç™¾å¤šå¤©ï¼Œå†çœ‹çœ‹ç°åœ¨çš„å›½å†…åª’ä½“èˆ†è®ºã€‚æ—©å·²ç»æ²¡äº†å½“åˆå¯¹è°æŠ¥å»¶è¯¯ç–«æƒ…çš„è¿½ç©¶é—®è´£ï¼›æ—©å·²ç»æ²¡äº†å¯¹ææ–‡äº®åŒ»ç”Ÿè¢«è®­è¯«èƒŒåè¨€è®ºè‡ªç”±å’Œæ–°é—»è‡ªç”±çš„è¯‰æ±‚ï¼›æ—©å·²ç»æ²¡æœ‰äº†å¯¹çº¢åå­—ä¼šçš„æ¸èŒçš„è¿½è´£ã€‚ç°åœ¨ä¸»æµçš„å£°éŸ³è€Œæ˜¯å¯¹ç¾å¸å›½ä¸»ä¹‰çš„å¹¸ç¾ä¹ç¥¸ï¼›å¯¹å®˜åƒšä½“åˆ¶æ— èƒ½è…è´¥çš„æ©é¥°ï¼›å¯¹æƒè´µä»¬ä¸çŸ¥ç¾è€»çš„æ­ŒåŠŸèµå¾·ã€‚æ›´å¯æ€•çš„æ˜¯ï¼Œè¿™å°ææƒç»Ÿæ²»çš„æœºå™¨ç°åœ¨åœ¨è¯•å›¾ç¯¡æ”¹è¿™æ®µè®°å¿†ï¼Œå»æŠ¹å»ä»–å½“åˆç’æŠ¥ç–«æƒ…çš„ç½ªè´£ï¼Œå°†ç—…æ¯’çš„æºå¤´è½¬å«åˆ°å›½å¤–ã€‚è€Œåœ¨è¿™ä¸€åˆ‡çš„èƒŒåï¼Œéƒ½æ˜¯äº’è”ç½‘è¿™ä¸ªå·¥å…·åœ¨å¸®åŠ©ææƒç»Ÿæ²»è€…ä¸ºè™ä½œä¼¥ï¼Œåªå­˜åœ¨å¯¹ä»–æœ‰åˆ©çš„å£°éŸ³è€Œè¾¾åˆ°é›†ä½“æ´—è„‘æ§åˆ¶ã€‚ä¹Ÿæ°æ°éªŒè¯äº†â€œå½“åª’ä½“éƒ½å§“å…šâ€æ—¶ï¼Œâ€œäººæ°‘å°±è¢«æŠ›å¼ƒâ€äº†çš„ç°å®ã€‚æ²¡æœ‰äº†åª’ä½“ä»£è¡¨äººæ°‘åˆ©ç›Šå»å…¬å‘Šäº‹å®çš„çœŸç›¸ï¼Œå‰©ä¸‹çš„å°±æ˜¯äººæ°‘çš„ç”Ÿå‘½è¢«ç—…æ¯’å’Œä½“åˆ¶çš„é‡ç—…å…±åŒä¼¤å®³çš„ç»“æœã€‚</p><p>æˆ‘ä¸è®¤ä¸ºäº’è”ç½‘å°é”ã€æµé‡å„æ–­ã€è¨€è®ºå®¡æŸ¥æ˜¯äº’è”ç½‘è¯¥æœ‰çš„æ ·å­ï¼Œäº’è”ç½‘çš„åˆ›é€ å’Œæ™®åŠæ˜¯æˆ‘å¿ƒç›®ä¸­äººç±»æœ‰å²ä»¥æ¥æœ€ä¼Ÿå¤§çš„å…¬ç›Šäº‹ä¸šã€‚ç»´åŸºç™¾ç§‘å’Œäº’è”ç½‘æ¡£æ¡ˆé¦†ä»¥åŠçŸ¥è¯†å…±äº«ç¤¾åŒºä»–ä»¬å€ŸåŠ©äº’è”ç½‘ä¸ºå…¨ä¸–ç•Œæ¯ä¸€ä¸ªäººæä¾›å¹³ç­‰è·å–çŸ¥è¯†çš„æƒåˆ©ï¼Œè¿™äº›çŸ¥è¯†æ˜¯æˆ‘ä»¬å…¨äººç±»æ™ºæ…§æ–‡æ˜çš„ç»“æ™¶ï¼Œè€Œåœ¨æœ‰äº›å›½å®¶å´åœ¨å°é”ç»´åŸºç™¾ç§‘ï¼Œä¸ºä»€ä¹ˆè¦å°æ€ç»´åŸºç™¾ç§‘ï¼Œå› ä¸ºç»´åŸºç™¾ç§‘ä¸Šå®¢è§‚å­˜åœ¨çš„å†å²äº‹å®è®©ç»Ÿæ²»è€…æ‹…æƒŠå—æ€•ã€‚æˆ‘æ— æ³•ç°è±¡æˆé•¿åœ¨ GFW ä¸‹çš„åè¾ˆä»¬ä»–ä»¬è®¤ä¸ºçš„äº’è”ç½‘æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿæ˜¯åƒç™¾åº¦é‚£æ ·ä¸ç¾è€»åœ°ä½œæ¶ï¼Œåˆ å¸–å°å·æ˜¯å¯¹çš„ï¼Œè¨€è®ºå®¡æŸ¥æ˜¯æ­£å½“çš„ï¼Ÿ</p><p>å¥½åƒæœ‰ç‚¹è·‘é¢˜äº†ğŸ˜‚å¯¹äºï¼ˆä¸­æ–‡ï¼‰ç‹¬ç«‹åšå®¢çš„å‘å±•å’Œæœªæ¥ï¼Œæˆ‘æ˜¯æŒºæ‚²è§‚çš„ã€‚å› ä¸ºå¢™è¶Šæ¥è¶Šé«˜äº†ï¼Œè€Œä¼šç¿»å¢™çš„ä¸­å­¦ç”Ÿæˆ–å¤§å­¦ç”Ÿåˆæ˜¯æå°‘æ•°ï¼Œå‰©ä¸‹çš„éƒ½æ˜¯äº›å°ç²‰çº¢ä»¬ï¼Œåœ¨ GFW ä¸‹æˆé•¿èµ·æ¥çš„ä¸€ä»£è¿˜æ˜ç™½è‡ªç”±äº’è”ç½‘çš„ç²¾ç¥å—ï¼Ÿéšç€ GFW çš„ä¸æ–­å‡çº§ã€GitHub ä¸€æ¬¡æ¬¡é­å—å±è”½ã€RSSHUB ä¹Ÿè¢«å°æ€ã€å›½å†…çš„åŸŸåå¤‡æ¡ˆåˆè¿›ä¸€æ­¥åŠ å¼ºã€‚è¿™ä¼šé€¼é€€é‚£äº›æƒ³è¦æ‹¥æœ‰ç‹¬ç«‹åšå®¢çš„äººå¼€å€’è½¦å›å¢™å†…ï¼Œä¹Ÿè®¸å¤§å¤šæ•°æƒ³å†™åšå®¢çš„äººéƒ½ä¼šæ”¾å¼ƒç‹¬ç«‹åšå®¢ï¼Œè½¬è€ŒæŠ•æŠ¥å¾®ä¿¡å…¬ä¼—å·ã€çŸ¥ä¹ä¸“æ ã€ç®€ä¹¦æ˜é‡‘ã€CSDN åšå®¢å›­è¿™ç±»åšå®¢å¹³å°ã€‚æ¯•ç«Ÿä»–ä»¬å„æ–­ç€å›½å†…ä¿¡æ¯è·å–çš„æµé‡ã€‚åœ¨è¿™äº›å¹³å°ä¸Šç”˜æ„¿è‡ªæˆ‘å®¡æŸ¥å’Œè‡ªæˆ‘é˜‰å‰²ï¼Œåœ¨è‡ªæˆ‘å¿ƒä¸­æ ‘ç«‹ä¸€é“å¢™ã€‚è€Œæœ€å¯æ€•çš„åæœå°±æ˜¯è¿™ç±»å¹³å°<strong>è®©èƒ½å†™æ–‡ç« çš„äººå¥½åƒæˆä¸ºäº†è¿™ä¸ªå¹³å°çš„ä¸€ä¸ªå†™ä½œçš„å¥´éš¶ï¼Œè€Œä¸æ˜¯è®©ä»–ä»¬çš„æ–‡ç« ä¸­çš„å†…å®¹å’Œè§‚ç‚¹å¯ä»¥æœ‰é•¿æ—¶é—´çš„å½±å“åŠ›ã€‚æ¢è¨€ä¹‹ï¼Œåœ¨ç¤¾äº¤ç½‘ç»œä¸Šï¼Œå¦‚æœä½ è¦æœ‰å½±å“åŠ›ï¼Œä½ å°±è¦ä½¿åŠ²å†™ï¼Œéœ€è¦æ›´å¤šçš„ç²‰ä¸å’Œè®¢é˜…è€…ã€‚æˆ‘ä¸ªäººè®¤ä¸ºè¿™æ˜¯è¿åäº†ä¿¡æ¯ä¼ æ’­è§„å¾‹çš„ã€‚</strong></p><p>å¯¹äºç‹¬ç«‹åšå®¢ï¼Œå’±æ¯”è¾ƒå–œæ¬¢ <a href="https://coolshell.cn/haoel" target="_blank" rel="noopener">é™ˆçš“</a> å‰è¾ˆå†™è¿‡çš„ä¸€ç¯‡æ–‡ç«  <a href="https://coolshell.cn/articles/17391.html" target="_blank" rel="noopener">ã€Šæˆ‘ä¸ºä»€ä¹ˆä¸åœ¨å¾®ä¿¡å…¬ä¼—å·å†™æ–‡ç« ã€‹</a></p><blockquote class="twitter-tweet"><p lang="zh" dir="ltr">åŒäº‹å¼€äº†å¾®ä¿¡å…¬ä¼—å·ï¼Œå‘æˆ‘äºŒç»´ğŸè®©æˆ‘å»å…³æ³¨ä¸€æ³¢ã€‚æˆ‘ç›´æ¥ä¸€ç¯‡ <a href="https://twitter.com/haoel?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@haoel</a> çš„ã€Šä¸ºä»€ä¹ˆæˆ‘ä¸åœ¨å¾®ä¿¡å…¬ä¼—å·ä¸Šå†™æ–‡ç« ã€‹å›ç»äº†è¿‡å» ğŸ˜‚ï¼Œåƒè¾›ä¸‡è‹¦ç¿»å‡ºæ¥äº†å¹²å˜›è¿˜è¦å¼€å€’è½¦å›å¢™å†…ğŸ¤”ã€‚<a href="https://t.co/NEyO9RucrV" target="_blank" rel="noopener">https://t.co/NEyO9RucrV</a></p>&mdash; HTTP 502 (@muzi_ii) <a href="https://twitter.com/muzi_ii/status/1238335413799890944?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">March 13, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>æˆ‘å¸Œæœ›äº’è”ç½‘èƒ½å¤ŸæŒç»­å…¬å¼€é€æ˜å¯æ£€ç´¢ï¼Œæ‰€æœ‰äººéƒ½å¯ä»¥åœ¨ç½‘ç»œä¸–ç•Œé‡Œè‡ªç”±å’Œç‹¬ç«‹åœ°è¡¨è¾¾è‡ªæˆ‘ã€‚è€Œè¨€è®ºå®¡æŸ¥ã€äº’è”ç½‘å°é”ã€æµé‡å„æ–­ç­‰ç­‰è¿™ä¸æ˜¯ä¸‡ç»´ç½‘ä¹‹çˆ¶ <a href="https://zh.wikipedia.org/zh-cn/%E8%92%82%E5%A7%86%C2%B7%E4%BC%AF%E7%BA%B3%E6%96%AF-%E6%9D%8E" target="_blank" rel="noopener">è’‚å§†Â·ä¼¯çº³æ–¯-æ</a> å‰è¾ˆå½“åˆæ‰€åˆ›é€ çš„ç½‘ç»œä¸–ç•Œï¼Œä¹Ÿä¸æ˜¯äº’è”ç½‘ä¹‹å­ <a href="https://coolshell.cn/articles/11928.html" target="_blank" rel="noopener">äºšä¼¦Â·æ–¯æ²ƒèŒ¨</a> ç”¨ç”Ÿå‘½å»æå«çš„èµ›åšç©ºé—´ã€‚</p><p>å‡è‹¥æœ‰äººçœ‹åˆ°å’±çš„åšå®¢ï¼Œæˆ–è®¸èƒ½æ”¹å˜ä»–ä»¬ï¼Œè®©ä»–ä»¬ä¹Ÿèƒ½åŠ å…¥åˆ°å’±ä»¬ä¸­æ¥ã€‚è¿™ä¹Ÿæ˜¯å’±å†™è¿™ä¸ªåšå®¢ç°åœ¨çš„åŠ¨åŠ›å§ã€‚å…¶å®å’±å¹¶ä¸æ˜¯å¾ˆå–œæ¬¢å†™æŠ€æœ¯ç›¸å…³çš„å†…å®¹ï¼Œå°±å¦‚é²è¿…å…ˆç”Ÿæ‰€è¨€ï¼šå­¦åŒ»æ•‘ä¸äº†ä¸­å›½äººä¸€æ ·ğŸ˜‚ã€‚å’±è§‰ç€å’±å†™æŠ€æœ¯æ–‡ç« ä¹Ÿæ•‘ä¸äº†èº«è¾¹è¢«çœŸç†éƒ¨æ„šæ°‘æ´—è„‘çš„ç²‰çº¢ä»¬ã€‚æ‰€ä»¥å’±è§‰ç€åœ¨è¯»ä¹¦å’Œå†™åšå®¢çš„åŒæ—¶ï¼Œå’±æ›´åº”è¯¥è‚©è´Ÿèµ·çŸ¥è¯†ä»½å­æœ€åº”æœ‰çš„è´£ä»»ï¼š<strong>ä¼ æ’­å¸¸è¯†è®©äººæ‘†è„±æ— çŸ¥ï¼Œå¯äººæ€è€ƒè®©äººèµ°å‡ºæ„šæ˜§ï¼Œæ­éœ²çœŸç›¸è®©äººè¿œç¦»è°è¨€ã€‚</strong></p><p>å’±çš„åšå®¢å°±æ˜¯å’±çš„â€œå¦ä¸€åŠâ€ï¼Œæ°¸è¿œä¼šå®ˆæŠ¤ç€ä»–ã€‚ä¸è¿‡å’±ä¹Ÿåœ¨å¼•å¯¼ä¸€äº›æ–°äººåŠ å…¥åˆ°ç‹¬ç«‹åšå®¢ä¸­æ¥ï¼Œæ¯”å¦‚å»å¹´æš‘å‡çš„æ—¶å€™è®¤è¯†çš„ä¸€ä¸ªå°å­¦å¼Ÿï¼Œå’±å°±æ•™ä»–ä¸€äº›æ­å»ºåšå®¢ã€ä¹°æœåŠ¡å™¨ã€æ³¨å†ŒåŸŸåçš„æ–¹æ³•ï¼Œå¼•å¯¼ä»–ä¹Ÿæ¥å†™åšå®¢ğŸ¤£ã€‚æ‰€ä»¥å’±çš„åšå®¢å†™å¥½äº†ï¼Œä¹Ÿæ˜¯å¯¹åè¾ˆä»¬çš„ä¸€ç§æŒ‡å¼•ï¼Œå»æŒ‡å¼•ä»–ä»¬åœ¨è‡ªç”±çš„äº’è”ç½‘å‹‡äºä¼ æ’­è‡ªå·±çš„æ€æƒ³ã€‚</p><p>æ€»ä¹‹ç‹¬ç«‹åšå®¢çš„å‰é€”è¿˜è¦æˆ‘ä»¬å…±åŒåŠªåŠ›ï¼Œç‹¬ç«‹åšå®¢æ˜¯å’±ä»¬è‡ªå·±çš„å°ä¸–ç•Œï¼Œå°±åƒæ—¶é›¨è‡ªå·±å†™çš„åšå®¢ä¸€æ ·ã€‚ç²¾å¿ƒæ‰“ç†å‘µæŠ¤ï¼Œåƒä¸€ä»¶è‰ºæœ¯å“ä¸€æ ·å»é›•ç¢å®ƒï¼Œè¿™ä¹Ÿæ˜¯ç‹¬ç«‹åšå®¢è¿·äººä¹‹å¤„ï¼Œä¹Ÿæ­£æ˜¯åƒæ—¶é›¨è¿™æ ·å¼€æºåˆ†äº«çš„ç²¾ç¥ï¼Œä¼šå¸å¼•æ›´å¤šçš„äººåŠ å…¥åˆ°ç‹¬ç«‹åšå®¢ä¸­æ¥ã€‚ç‹¬ç«‹åšå®¢ä¸Šçš„æ–‡ç« åªè¦åŸŸåå’ŒæœåŠ¡å™¨è¿˜åœ¨ï¼Œå°±ä¼šè¢«æœç´¢å¼•æ“æ£€ç´¢åˆ°ï¼Œä¸ç®¡å¤šä¹…å®ƒéƒ½ä¼šè¢«éœ€è¦å®ƒçš„äººå‘æ˜åˆ°ã€‚</p><p><img src="img/image-20200404190715388.png" alt="image-20200404190715388"></p><p><img src="img/image-20200404190726626.png" alt="image-20200404190726626"></p><p>æœ€åè¿˜æƒ³è¯´çš„æ˜¯ï¼Œé˜¿æˆ¿å®«çš„æ¥¼å®‡å®«é˜æ—©å·²è¡ç„¶æ— å­˜ï¼Œä½†æœç‰§çš„é˜¿æˆ¿å®«èµ‹å´èƒ½æµèŠ³ç™¾ä¸–ã€‚ä¹¦å†™èƒ½è®°è½½ç€æˆ‘ä»¬çš„æ€æƒ³ï¼Œå¹¶è·¨è¶Šæ—¶é—´å’Œç©ºå‰ä¼ æ’­å®ƒä»¬ï¼Œä½†æ„¿åƒç™¾å¹´åçš„äº’è”ç½‘è¿˜èƒ½æ£€ç´¢åˆ°å’±æ›¾ç»ç•™ä¸‹çš„é—²è¨€ç¢è¯­ã€‚ç‹¬ç«‹åšå®¢å°±åƒä¸€è‰˜å°èˆ¹ï¼Œåœ¨è‡ªç”±çš„äº’è”ç½‘èˆªè¡Œï¼Œè€Œæˆ‘ä»¬å½¼æ­¤ä¹‹é—´çš„è¿æ¥ï¼Œæ„ç­‘æˆäº†ä¸€ä¸ªç‹¬ç«‹çš„ä¸–ç•Œï¼Œè¿™ä¸ªä¸–ç•Œé‡Œæ²¡æœ‰åˆ å¸–å°å·ï¼Œæ²¡æœ‰è¨€è®ºå®¡æŸ¥ã€æ²¡æœ‰äº’è”ç½‘å°é”ï¼Œæœ‰çš„æ˜¯ä¸åŒçš„å£°éŸ³ï¼›æœ‰çš„æ˜¯æ€æƒ³ç¢°æ’çš„ç«èŠ±ï¼›æœ‰çš„æ˜¯è‡ªç”±çš„ç²¾ç¥å’Œç‹¬ç«‹çš„æ€æƒ³ï¼</p><h3 id="Q6ï¼šæœ¨å­æœ€æƒ³è·å¾—çš„ä¸€ä»½èƒ½åŠ›ï¼Ÿ"><a href="#Q6ï¼šæœ¨å­æœ€æƒ³è·å¾—çš„ä¸€ä»½èƒ½åŠ›ï¼Ÿ" class="headerlink" title="Q6ï¼šæœ¨å­æœ€æƒ³è·å¾—çš„ä¸€ä»½èƒ½åŠ›ï¼Ÿ"></a>Q6ï¼šæœ¨å­æœ€æƒ³è·å¾—çš„ä¸€ä»½èƒ½åŠ›ï¼Ÿ</h3><p>ç›®å‰æ¥è®²ç°å®ä¸­æœ€éœ€è¦çš„æ˜¯æ¬ç –èƒ½åŠ›ï¼Œæ¯”å¦‚ï¼šç²¾é€š K8s ã€ç²¾é€š Golang ç¼–ç¨‹ ã€ç²¾é€š LinuxğŸ˜‚ ï¼Œç„¶åä¹Ÿèƒ½åƒæ—¶é›¨çš„ <a href="https://github.com/chanshiyucx/aurora" target="_blank" rel="noopener">Aurora</a> é‚£æ ·ï¼Œæœ‰ä¸ªå¯ä»¥æ‹¿çš„å‡ºæ‰‹çš„å¼€æºé¡¹ç›®åˆ†äº«ç»™å¤§å®¶ã€‚å› ä¸ºæ¬ç –æŠ€æœ¯å¤ªèœäº†ï¼Œé¢è¯•äº†å¥½å‡ å®¶å…¬å¸éƒ½ä¸è¦å’±ï¼ˆå¤§å“­ã€‚å’±ä¸æ”¾å¼ƒï¼Œå’±è€¶åœ¨åŠªåŠ›å­¦ä¹ ingï¼Œäº‰å–æ—©ä¸€å¤©ç¦»å¼€è¿™é‡Œï¼ŒæˆåŠŸæ‹¿åˆ°å¿ƒæ»¡æ„è¶³çš„ offer ï¼</p><h3 id="Q7ï¼šå¯¹äº-ACGN-çš„çœ‹æ³•ï¼Ÿ"><a href="#Q7ï¼šå¯¹äº-ACGN-çš„çœ‹æ³•ï¼Ÿ" class="headerlink" title="Q7ï¼šå¯¹äº ACGN çš„çœ‹æ³•ï¼Ÿ"></a>Q7ï¼šå¯¹äº ACGN çš„çœ‹æ³•ï¼Ÿ</h3><p><code>æ­¤ç”Ÿæ— æ‚”å…¥ä¸œæ–¹ï¼Œæ¥ä¸–æ„¿ç”Ÿå¹»æƒ³ä¹¡ğŸ˜‚</code></p><p>é¦–å…ˆæƒ³åˆ°çš„ä¸€ä¸ªè¯æ—¶ <strong>çº¯ç²¹</strong> ï¼ŒACGN é‡Œé¢çš„ä½œå“å’Œäººç‰©å¾ˆå°‘æœ‰ä¸‰æ¬¡å…ƒæ˜æ˜Ÿæ­Œæ˜Ÿé‚£æ ·çš„å…‰ç¯æ•ˆåº”ï¼Œä¸€éƒ¨ä½œå“å£ç¢‘å’Œä¸€ä¸ªäººç‰©è§’è‰²å¡‘é€ ï¼Œéƒ½æ˜¯å…¨å‡­å®åŠ›ï¼Œæ²¡æœ‰æ‚ä¸ƒæ‚å…«çš„èŠ±æ¶å­ã€‚</p><p>ä¸­å­¦æ—¶ä»£æ›¾è¿½è¿‡ç«å½±å¿è€…ï¼Œç›´åˆ°é«˜ä¸­æ¯•ä¸šåçš„ä¸ä¹…ç«å½±å®Œç»“ã€‚è¿™éƒ¨åŠ¨æ¼«ä¸ºé«˜ä¸‰æ¯ç‡¥çš„è‹¦é€¼å­¦ä¹ ç”Ÿæ´»å¢æ·»äº†ä¸€æŠ¹è‰²å½©ï¼Œæ¯å‘¨çš„å‘¨å››æ™šè‡ªä¹ åï¼Œå’±å°±å¸¦å¤´åœ¨ç­é‡Œå…¬å¼€æ”¾æ˜ ï¼Œéš”å£ç­é‡Œä¹Ÿä¼šæ¥å¾ˆå¤šäººï¼Œå‡‘åœ¨ä¸€èµ·åæ¥ä¸ªäººã€‚ææ€•å½“æ—¶ä¹Ÿæ˜¯å…¨æ ¡å”¯ä¸€ä¸€ä¸ªæ•¢å¦‚æ­¤èƒ†å¤§å¦„ä¸ºçš„ç­çº§äº†ğŸ˜‚ã€‚é‚£æ—¶ï¼Œç«å½±ç¡®å®æ˜¯å’±æ¯å‘¨çš„å¿«ä¹è°ƒå‰‚ï¼Œæ²¡æœ‰å®ƒçš„é«˜ä¸‰æ˜¯å¤šä¹ˆåœ°æ— å‘³ã€‚</p><p>å†åˆ°åæ¥ä¸Šå¤§å­¦åï¼Œç»ˆäºæœ‰äº†å……è¶³çš„æ—¶é—´æ¥è¿½ç•ªã€‚è¿™æ‰çœŸæ­£æ„ä¹‰ä¸Šå¼€å§‹äº†è§£ ACGN ï¼Œå¤§ä¸€å¤§äºŒçš„æ—¶å€™å¼€å§‹å…¥å®…ï¼Œæ¯å¤©ä¸‹è¯¾åéƒ½èº²åˆ°å®¿èˆè¿½ç•ªï¼Œæ­»è‚¥å®…ä¸€ä¸ªğŸ˜‚ã€‚å†åˆ°ç°åœ¨ä¹Ÿä¼šçœ‹ä¸€äº›æ¼«ç”»å’Œè½»å°è¯´ï¼Œæ¯å­£åº¦è¿½ 1~2 éƒ¨åŠ¨ç”»ã€‚æ¯•ç«Ÿæ¯å‘¨æœ‰ç‚¹ç›¼å¤´ä¹Ÿæ˜¯å’±ç”Ÿæ´»çš„ä¹è¶£å‘€ã€‚</p><p>è‡³äºæ¸¸æˆï¼Œå’±ä¸å¤ªä¼šç©å„¿ï¼Œæ‰‹æ®‹å…šğŸ˜‚ï¼Œè™½ç„¶ä¹Ÿæƒ³ä»ä¸­æ”¶è·å¿«ä¹ï¼Œä½†æ˜¯å°±æ˜¯è§‰ç€æ¸¸æˆå’Œå’±è¿˜æ˜¯ä¸å¤ªèˆ¬é…ã€‚å»å¹´çš„æ—¶å€™ç©è¿‡ä¸€ç‚¹ <code>å´©å 3rd</code> åæ¥å°±å¼ƒå‘äº†ï¼Œå› ä¸ºä»ä¸­æ‰¾ä¸åˆ°å¿«ä¹ï¼ä¸å¦‚åƒçœ‹ä¹¦å’Œçœ‹æ¼«ç”»å»æ€è€ƒè¿™éƒ¨ä½œå“è¡¨è¾¾ä¿¡å¿µé‚£æ ·æœ‰è¶£ï¼Œæ€»ä¹‹æ¸¸æˆæ˜¯å¥½ç©çš„ä¸€ç‚¹ï¼Œä½†å´ä¸åƒå…¶ä»–æ–‡åŒ–ä½œå“ä¸€æ ·èƒ½å¤Ÿå¯å‘äººä»¬å»æ€è€ƒä¸€äº›äº‹æƒ…ã€‚</p><p>æ€»ä¹‹ ACNG ä¹Ÿæ˜¯æˆ‘ä»¬æˆé•¿ä¸­çš„è€å¸ˆï¼Œå®ƒä»¬ä¼šä¼´éšç€æˆ‘èµ°å®Œè¿™ä¸€ç”Ÿï¼Œæ— è®ºå¤šä¹…éƒ½ä¸ä¼šå¿˜è®°è¿™ä»½åˆå¿ƒã€‚</p><h3 id="Q8ï¼šå¯¹å¯„æ‰˜äºå†…å¿ƒå¹»æƒ³ä¸–ç•Œçš„ç”Ÿæ´»æ€åº¦çš„çœ‹æ³•ï¼Ÿ"><a href="#Q8ï¼šå¯¹å¯„æ‰˜äºå†…å¿ƒå¹»æƒ³ä¸–ç•Œçš„ç”Ÿæ´»æ€åº¦çš„çœ‹æ³•ï¼Ÿ" class="headerlink" title="Q8ï¼šå¯¹å¯„æ‰˜äºå†…å¿ƒå¹»æƒ³ä¸–ç•Œçš„ç”Ÿæ´»æ€åº¦çš„çœ‹æ³•ï¼Ÿ"></a>Q8ï¼šå¯¹å¯„æ‰˜äºå†…å¿ƒå¹»æƒ³ä¸–ç•Œçš„ç”Ÿæ´»æ€åº¦çš„çœ‹æ³•ï¼Ÿ</h3><p>å†…å¿ƒå¹»æƒ³ä¸–ç•Œ?è«éè¯´çš„æ˜¯å’±ğŸ˜‚(å¤§é›¾ã€‚å¹»æƒ³ã€æƒ³æƒ³ã€æ€è€ƒï¼Œè¿™ä¸‰è€…å æ®äº†å’±ä¸€å¤©ä¸­é™¤äº†å·¥ä½œæ—¶é—´ä»¥å¤–çš„ç»å¤§å¤šæ•°çš„æ—¶é—´ï¼Œåªæ˜¯æ¯”ä¾‹ä¸åŒè€Œå·²ã€‚åªè¦ä¸å½±å“æ­£å¸¸çš„å·¥ä½œå’Œå­¦ä¹ ï¼Œéƒ½å¯ä»¥å‘€ï¼Œåæ­£å’±å–œæ¬¢è¿™æ ·çš„ç”Ÿæ´»æ€åº¦ï¼Œæ€»æ¯”é‚£äº›ä¸€å¤©åˆ°æ™šåªé¡¾çš„æé’±ï¼Œå¨±ä¹è‡³æ­»åœ°åˆ·çŸ­è§†é¢‘çš„ç”Ÿæ´»æ€åº¦è¦å¥½å‘€ã€‚</p><p>å’±ä¸­å­¦æ—¶æœ‰è¿‡ä¸€æ®µæ—¶é—´æ´»åœ¨çº¯ç²¹å¹»æƒ³çš„ä¸–ç•Œä¸­(ä¸­äºŒç—…ï¼Œç»å¯¹çš„é»‘å†å²ï¼Œä»æ¥æ²¡å’Œä»–äººæè¿‡ğŸ˜‚ã€‚é‚£æ—¶å’±çœ‹äº†å¾ˆå¤šå¾ˆå¤šçš„ç„å¹»/ç©¿è¶Š/ä¿®çœŸå°è¯´ï¼ŒåŠ èµ·æ¥è‡³å°‘è¦ 1000 ä¸‡å­—å§(æƒŠï¼ä¸»è¦æ˜¯å› ä¸ºè®¨åŒå­¦ä¹ ä¸æƒ³ä¸Šå­¦ï¼Œä¸Šè¯¾æ—¶å°±å¹»æƒ³è€…å’Œå°è¯´ä¸­çš„ä¸»äººå…¬ä¸€æ ·åœ¨å¼‚ä¸–ç•Œä¿®çœŸæ‰“æ€ªå‡çº§ï¼Œå¹»æƒ³ç€å¥³ä¸»è§’å°±æ˜¯ç­é‡Œå–œæ¬¢çš„é‚£ä¸ªå¥³ç”ŸğŸ˜‚ã€‚æ€»ä¹‹æˆ‘æ„Ÿè§‰é‚£æ®µæ—¶é—´æ˜¯æ´»åœ¨ç™½æ—¥æ¢¦ä¸­ï¼Œä¸ºäº†é€ƒé¿æ¯ç‡¥çš„å­¦ä¹ è€Œæ´»åœ¨å¹»æƒ³çš„ä¸–ç•Œä¸­ã€‚åæ¥ç›´åˆ°é«˜ä¸­æ—¶ä¹Ÿä¼šåœ¨è¯¾ä¸Šå¬ä¸ä¸‹å»çš„æ—¶å€™å¹»æƒ³äº›åˆ«çš„ã€‚ä¸Šå¤§å­¦ä¹‹åå°±å¾ˆå°‘å†å¹»æƒ³äº†ï¼Œå› ä¸ºç°å®ä¸–ç•Œå……å®èµ·æ¥å¾ˆå°‘æœ‰æ—¶é—´å¹»æƒ³è¿™äº›äº‹å„¿äº†ã€‚</p><p>ç°åœ¨å‘¢ï¼Ÿæœ‰æ—¶ä¹Ÿä¼šå¹»æƒ³ç€ä»¥åçš„ç”Ÿæ´»ï¼Œå¹»æƒ³ç€å°†æ¥å¦‚ä½•æ•´ç†è‡ªå·±çš„å°çªå’Œä¹¦æˆ¿ï¼›å¹»æƒ³ç€å’Œæƒ³è§çš„äººé¢å¯¹é¢è®¨è®ºæœ¨æ˜Ÿä¸Šçš„é‚£å—å¤§çº¢æ–‘ï¼Ÿå¹»æƒ³ç€åƒè‹¹æœä¹‹çˆ¶ <a href="https://zh.wikipedia.org/wiki/%E6%96%AF%E8%92%82%E5%A4%AB%C2%B7%E6%B2%83%E5%85%B9%E5%B0%BC%E4%BA%9A%E5%85%8B" target="_blank" rel="noopener">æ²ƒå…¹</a> çš„çˆ¶äº²é‚£æ ·æ•™æœªæ¥çš„å„¿å­æœ‰å…³ç”µå­ç”µé˜»çš„çŸ¥è¯†ï¼ˆå› ä¸ºçœ‹äº† <a href="https://m.douban.com/book/subject/21966356/" target="_blank" rel="noopener">ã€Šæ²ƒå…¹ä¼ :ä¸è‹¹æœä¸€èµ·ç–¯ç‹‚ã€‹</a> ,çˆ¶ä¸å­ç»“å¯¹ç¼–ç¨‹å¤šå¥½ç©å‘€(å¤§é›¾ ã€‚å¹»æƒ³ç€é€æœªæ¥çš„å„¿å­å»ä¸Šå­¦â€¦â€¦ å¹»æƒ³ç€å¾ˆå¤šæœªæ¥çš„ç”Ÿæ´»ã€‚ä¸åŒäºä¸­å­¦ä¸­äºŒç—…æ—¶æœŸçš„é‚£æ ·ï¼Œç°åœ¨çš„å¹»æƒ³å¤šå°‘ç»™äº†ç‚¹è‡ªå·±æ´»ä¸‹å»çš„åŠ¨åŠ›å’Œå¸Œæœ›å§ï¼Œä¹Ÿè®¸æœ‰äº›äº‹æƒ…æ°¸è¿œä¸ä¼šå®ç°ï¼Œä½†ä¿æŒå¯¹æœªæ¥çš„æœŸå¾…å’Œå¹»æƒ³æ‰è®©å½“ä¸‹çš„ç”Ÿæ´»æ‰æœ‰æ„ä¹‰å‘€ã€‚</p><p>æ€è€ƒå’Œæƒ³è±¡åˆ™èµ‹äºˆå’±æ›´å¤šç°å®æ„ä¹‰ï¼Œä¹¦ç±å°±å¦‚å’±æ€è€ƒçš„æºæ³‰ï¼Œè€Œæƒ³è±¡åˆ™æ˜¯æ€æƒ³ç¢°æ’ğŸ’¥åçš„æ¶Ÿæ¼ªï¼Œå°±å¦‚ <a href="https://zh.wikipedia.org/zh-cn/%E5%AE%87%E5%AE%99%E6%97%B6%E7%A9%BA%E4%B9%8B%E6%97%85" target="_blank" rel="noopener">ã€Šå®‡å®™æ—¶ç©ºä¹‹æ—…ã€‹</a> é‡Œçš„æƒ³è±¡ä¹‹èˆŸï¼Œå¸¦ç€å’±ä»å¤©æ–‡å­¦çŸ¥è¯†åˆ°ç”Ÿå‘½èµ·æºã€æ°”å€™å˜åŒ–ã€ç§‘å­¦ç²¾ç¥éƒ½ä¸€ä¸€æ¢è®¨ï¼Œè¶³ä»¥æ”¹å˜äººç”Ÿè§‚ï¼Œè®©äººåœ¨æŠ¬å¤´ä»°æœ›æ˜Ÿç©ºæ—¶ï¼Œå°‘ä¸€ç‚¹è¿·ä¿¡å’Œæ— çŸ¥ï¼Œå¤šä¸€ä»½å¥½å¥‡ä¸å…³çˆ±ã€‚</p><p><img src="img/image-20200404190442465.png" alt="image-20200404190442465"></p><p>ä½†å‰ææ˜¯ä¸è¦å½±å“åˆ°ç°å®ä¸­çš„å·¥ä½œå’Œå­¦ä¹ å“¦ï¼Œæ¯•ç«Ÿç°å®ä¸–ç•Œä¹Ÿå¾ˆé‡è¦å‘€ã€‚è‡ªå·±çš„å°ä¸–ç•Œè¦é åœ¨ç°å®ä¸–ç•Œé‡Œçš„ä»˜å‡ºæ‰èƒ½ç»´æŒä½çš„ï¼Œå½“å®Œæˆç°å®ä¸–ç•Œé‡Œçš„ä»»åŠ¡å°±èº²åˆ°è‡ªå·±çš„å°ä¸–ç•Œé‡Œå¤©é©¬è¡Œç©ºé¨æ¸¸æ˜Ÿé™…ã€‚è¿™æ‰æ˜¯æˆ‘ä»¬ä½œä¸ºäººåŸæœ¬çš„ç”Ÿæ´»æ€åº¦å‘€ï¼Œæ¯›èŒ¹é¥®è¡€çš„å¤äººä»¬æ™šä¸Šä»°æœ›æ˜Ÿç©ºæ—¶ä¸æ­£ä¹Ÿåœ¨å¹»æƒ³æˆ‘ä»¬æ­£åœ¨å¹»æƒ³çš„å®‡å®™å˜›~</p><p>ç¡è§‰å§ï¼Œæ¢¦é‡Œå•¥éƒ½æœ‰ï¼ˆå·ç¬‘</p><h3 id="Q9ï¼šæœ¨å­å¦‚ä½•åœ¨ä¸€ä¸ªäººçš„è‡ªç”±ç”Ÿæ´»å¦‚ä½•è·å¾—å¿«ä¹è°ƒå‰‚ï¼Ÿ"><a href="#Q9ï¼šæœ¨å­å¦‚ä½•åœ¨ä¸€ä¸ªäººçš„è‡ªç”±ç”Ÿæ´»å¦‚ä½•è·å¾—å¿«ä¹è°ƒå‰‚ï¼Ÿ" class="headerlink" title="Q9ï¼šæœ¨å­å¦‚ä½•åœ¨ä¸€ä¸ªäººçš„è‡ªç”±ç”Ÿæ´»å¦‚ä½•è·å¾—å¿«ä¹è°ƒå‰‚ï¼Ÿ"></a>Q9ï¼šæœ¨å­å¦‚ä½•åœ¨ä¸€ä¸ªäººçš„è‡ªç”±ç”Ÿæ´»å¦‚ä½•è·å¾—å¿«ä¹è°ƒå‰‚ï¼Ÿ</h3><p>ä¸»è¦æ˜¯é€šè¿‡å­¦ä¹ æ–°çŸ¥è¯†å’ŒçæŠ˜è…¾æ¥æ»¡è¶³å¥½å¥‡å¿ƒå’Œæ±‚çŸ¥æ¬²ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­æ”¶è·çš„çŸ¥è¯†æ˜¯æœ€ç¾å‘³çš„å¿«ä¹è°ƒå‰‚ã€‚</p><p>æ¯”å¦‚ä¹‹å‰å’±åœ¨å»å¹´çš„æ—¶å€™æŠ˜è…¾è¿‡ <a href="https://blog.k8s.li/esp8266-pc-switch.html">ã€Šä½¿ç”¨ ESP8266 NodeMCU æ‰“é€  WiFi å¼€å…³ã€‹</a>ï¼Œå½“æ—¶å’±å¯¹åµŒå…¥å¼å¼€å‘ä¸€ç‚¹éƒ½ä¸ç†Ÿæ‚‰ï¼Œå¯¹é€»è¾‘ç”µè·¯ä¹Ÿä¸å¤ªæ‡‚ã€‚è‡ªå·±å°±ä»é›¶å¼€å§‹å­¦ä¹ å„ç§æ¦‚å¿µå’ŒåŸç†ï¼Œçœ‹äº†ä¸€äº›ç§‘æ™®è§†é¢‘ï¼Œé‚£æœŸå’±ç»ˆäºç†è§£äº†åœºæ•ˆåº”ç®¡ã€æ”¾å¤§å™¨ã€ä¸‰ææ™¶ä½“ç®¡ã€è§¦å‘å™¨ã€æ™¶ä½“ç®¡ç­‰åŸç†ï¼Œæ‰ä½“ä¼šåˆ°ç”± 0 å’Œ 1 æ§åˆ¶çš„ç”µå­ä¸–ç•Œçš„ç¥å¥‡ï¼</p><blockquote class="twitter-tweet"><p lang="zh" dir="ltr">ä»Šå¤©èŠ±äº†ä¸€æ•´å¤©ï¼Œä»é›¶å¼€å§‹å­¦ä¹ äº† Arduino ç¼–ç¨‹ï¼Œåˆ¶ä½œå¥½äº†ä¸€ä¸ª WiFi æ§åˆ¶çš„ç»§ç”µå™¨å¼€å…³ï¼Œè¿™æ ·åœ¨å…¬å¸ä¹Ÿèƒ½é€šè¿‡ä¸€ä¸ª curl å‘½ä»¤æ§åˆ¶å®¶é‡Œçš„ä¸»æœºå¼€å…³å•¦ï¼<br>ç”± 0å’Œ1 æ§åˆ¶çš„ä¸–ç•ŒçœŸç¥å¥‡ï¼ <a href="https://t.co/ubt8ncbK1z" target="_blank" rel="noopener">pic.twitter.com/ubt8ncbK1z</a></p>&mdash; HTTP 502 (@muzi_ii) <a href="https://twitter.com/muzi_ii/status/1175408986557779968?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">September 21, 2019</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><blockquote><p>ã€æˆ‘ä¸€ç›´è§‰å¾—ï¼Œè´¹é©¬ã€æ¬§æ‹‰ã€å“¥å¾·å·´èµ«ç­‰äººä¸ç°ä»£äººç›¸æ¯”ï¼Œä»–ä»¬å…·æœ‰æ ¼å¤–æ—ºç››çš„å¥½å¥‡å¿ƒå’Œä¸°å¯Œçš„æƒ³è±¡åŠ›ï¼Œå¹¶ä¸”å……æ»¡äº†ç”Ÿæœºä¸æ´»åŠ›ã€‚éšç€ç¤¾ä¼šå‘å±•çš„æ—¥ç›Šæˆç†Ÿï¼Œå¥½å¥‡å¿ƒå’Œæƒ³è±¡åŠ›ä¸å¯é¿å…åœ°ä¸æ–­é™ä½ï¼Œä½†å¹¶ä¸ä»£è¡¨ç°ä»£ç¤¾ä¼šä¸å†éœ€è¦å¥½å¥‡å¿ƒå’Œæƒ³è±¡åŠ›ã€‚ã€</p></blockquote><blockquote class="twitter-tweet"><p lang="zh" dir="ltr">ä½œä¸ºä¸€ä¸ªåƒåœ¾ä½¬ï¼Œå½“ç„¶è¦è‡ªå·± xjb æ£é¼“å•¦ï¼ŒæŠ˜è…¾èµ·æ¥å¾ˆæœ‰æˆå°±æ„ŸğŸ˜‚<br>æœŸé—´å­¦åˆ°ä¸å°‘ä¸œè¥¿ï¼ŒGPIO å¼•è„šå®šä¹‰ã€ä¸‰æç®¡çš„åŸç†ã€ç»§ç”µå™¨ã€ESP8266 ç”µè·¯å›¾ã€é€šè¿‡å‘½ä»¤è¡Œæ§åˆ¶ USB ç”µæºã€Arduino IDE ã€è®¾å¤‡æ ‘ã€å…‰è€¦éš”ç¦»ã€AT æŒ‡ä»¤ ã€TCP/IP ã€ä¸²å£é€šä¿¡ã€æ³¢ç‰¹ç‡ç­‰<br>æŠ˜è…¾çš„æ„ä¹‰ä¹Ÿå°±åœ¨äºæ­¤å§ï¼Œå»æ¢ç©¶ç”µå­ä¸–ç•Œå¦‚ä½•è¿è¡Œçš„ã€‚</p>&mdash; HTTP 502 (@muzi_ii) <a href="https://twitter.com/muzi_ii/status/1175445308681015298?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">September 21, 2019</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>å’±åˆšæ¯•ä¸šé‚£ä¼šï¼Œè‡ªå·±ä¸€ä¸ªäººç”Ÿæ´»äº†ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿæ˜¯ä¸çŸ¥é“æ€ä¹ˆç»™è‡ªå·±æ‰¾ä¹è¶£å„¿ï¼Œæ•´å¤©ä¹Ÿæ˜¯å¾ˆæŠ‘éƒçš„ã€‚ä¸è¿‡åæ¥çœ‹äº† <a href="https://twitter.com/Philo2018" target="_blank" rel="noopener">Philo</a> åˆ†äº«çš„ <a href="https://twitter.com/Philo2018/status/1160151987654025218" target="_blank" rel="noopener">å¼€ä¸€ä¸ª thread åˆ†äº« #å¦‚ä½•å˜å¿«ä¹</a> tweet ä¹‹åå’±ä¹Ÿè¯•ç€æ”¹å˜è‡ªå·±çš„ç”Ÿæ´»æ€åº¦ã€‚ä¹Ÿå¼€å§‹ç»™è‡ªå·±æ‰¾å¿«ä¹ï¼Œä»¥å‰è¿½ä¸åˆ°è‡ªå·±å–œæ¬¢çš„å¥³ç”Ÿä¼šé—·é—·ä¸ä¹ï¼Œä½†æ…¢æ…¢åœ°è½¬å˜äº†è¿‡æ¥ã€‚è‡ªå·±æƒ³è¦å¿«ä¹è¿˜æ˜¯è¦è‡ªå·±åˆ¶é€ ï¼Œä¸èƒ½ä¾èµ–äºä»–äººï¼Œæ²¡æœ‰å¿…é¡»è¦å¾—åˆ°çš„ä¸œè¥¿ï¼Œä¹Ÿæ²¡æœ‰ä¸èƒ½æ— æ³•å¤±å»çš„ä¸œè¥¿ã€‚åªæœ‰è‡ªå·±ä¸ä¼šæŠ›å¼ƒè‡ªå·±ï¼Œæ‰€ä»¥ä¸€ä¸ªäººçš„å¿«ä¹è¦å­¦ä¼šä»è‡ªå·±èº«ä¸Šå‘æ˜ã€‚å¥½å¥‡å¿ƒä¿ƒä½¿ç€å’±å»å‘æ˜æ–°é²œäº‹ç‰©ï¼Œå»æ¢ç´¢æœªçŸ¥ä¸–ç•Œã€‚</p><p>ä»¥ä¸Šå°±æ˜¯å’±è‡ªå·±ä¸€ä¸ªäºº<code>ç©æ³¥å·´</code>æ—¶å€™çš„å¿«ä¹è°ƒå‰‚ï¼š<strong>å¥½å¥‡å¿ƒå’Œæ±‚çŸ¥æ¬²ï¼</strong></p><h3 id="Q10ï¼šæœ¨å­ã®å¿ƒæ„¿å•ï¼Ÿæœ€æƒ³æ”¶åˆ°çš„ä¸€ä»½ç¤¼ç‰©ï¼Ÿ"><a href="#Q10ï¼šæœ¨å­ã®å¿ƒæ„¿å•ï¼Ÿæœ€æƒ³æ”¶åˆ°çš„ä¸€ä»½ç¤¼ç‰©ï¼Ÿ" class="headerlink" title="Q10ï¼šæœ¨å­ã®å¿ƒæ„¿å•ï¼Ÿæœ€æƒ³æ”¶åˆ°çš„ä¸€ä»½ç¤¼ç‰©ï¼Ÿ"></a>Q10ï¼šæœ¨å­ã®å¿ƒæ„¿å•ï¼Ÿæœ€æƒ³æ”¶åˆ°çš„ä¸€ä»½ç¤¼ç‰©ï¼Ÿ</h3><ul><li><p>æœªæ¥èƒ½æ‹¥æœ‰å±äºè‡ªå·±çš„å°çªå’Œä¹¦æˆ¿ğŸ˜</p></li><li><p>ã€Šæ•°å­¦å¥³å­©4ï¼šéšæœºç®—æ³•ã€‹</p></li><li><p>ã€Šæ³•å¾‹ç«‹æ³•ä¸è‡ªç”±ã€‹</p></li><li><p>ã€Šæœ«æ—¥ä¸‰é—®ã€‹</p><p><code>åšä¸€ç”Ÿçš„æœ‹å‹åˆ¸</code> å‡ºè‡ªåŠ¨ç”» <a href="https://bgm.tv/subject/9912" target="_blank" rel="noopener">æ—¥å¸¸ nichijou</a> 25 è¯ğŸ˜„</p></li></ul><p><img src="img/nichijo.png" alt="img"></p><h2 id="end"><a href="#end" class="headerlink" title="end"></a>end</h2><p>å»æ‰äº†ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œå†…å®¹å°‘æœ‰ä¿®æ”¹~~</p><blockquote><p>  æ¯ä¸€ä¸ªå¹³å‡¡çš„æ—¥å¸¸éƒ½æ˜¯è¿ç»­å‘ç”Ÿä¸­çš„å¥‡è¿¹</p><p>  åƒè¿™æ ·ç§ç§å¾®å°çš„äº‹æƒ…åŠ èµ·æ¥ï¼Œæ‰å½¢æˆäº†ã€å½“ä¸‹ã€çš„æˆ‘ä»¬å•Š</p></blockquote><p>æ±æƒ³å’Œå’±ä»¥ç¬”è°ˆçš„æ–¹å¼äº¤æ¢é—®é¢˜ï¼Œæ¬¢è¿å•¦ğŸ˜‚ï¼Œå’±ä¼šè®¤çœŸå›å¤çš„ï¼‰å…¶å®ä¸‹ä¸€ä¸ªäººå’±å·²ç»æƒ³å¥½å•¦ğŸ˜‚</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;ç”±æ¥&quot;&gt;&lt;a href=&quot;#ç”±æ¥&quot;
        
      
    
    </summary>
    
    
      <category term="ç”Ÿæ´»" scheme="https://blog.k8s.li/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
      <category term="ç¬”è°ˆ" scheme="https://blog.k8s.li/tags/%E7%AC%94%E8%B0%88/"/>
    
  </entry>
  
  <entry>
    <title>æ˜¥å­£è¯»ä¹¦ç¬”è®°</title>
    <link href="https://blog.k8s.li/spring-reading-note.html"/>
    <id>https://blog.k8s.li/spring-reading-note.html</id>
    <published>2020-03-27T16:00:00.000Z</published>
    <updated>2020-03-29T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>äººä¸æ”¿æƒçš„æ–—äº‰ï¼Œå°±æ˜¯è®°å¿†ä¸é—å¿˜çš„æ–—äº‰ã€‚</p></blockquote><p>è½¬çœ¼é—´ä¸‰æœˆå°±ç»“æŸäº†ï¼Œä¸€å¹´èµ°å®Œäº†å››åˆ†ä¹‹ä¸€ã€‚å› ä¸ºç–«æƒ…çš„å½±å“ï¼Œè‡ªå·±ç‹¬è‡ªä¸€äººå®…åœ¨ä½çš„åœ°æ–¹ä¸€ä¸ªå¤šæœˆï¼ŒåŠ ä¸Šä¸¤å‘¨çš„æ˜¥èŠ‚å‡æœŸï¼Œè¿™æœŸé—´ç©ºé—²çš„æ—¶é—´ç‰¹åˆ«å¤šï¼Œæ‰€ä»¥é˜…è¯»çš„æ—¶é—´ä¹Ÿæ¯”è¾ƒå¤šï¼Œä¹Ÿæ­£å¥½å‘¨æœ«æœ‰ç©ºå°±æ›´æ–°ä¸€ä¸‹åšå®¢ï¼Œè®°å½•ä¸€ä¸‹ã€‚</p><h2 id="é˜…è¯»è®°å½•"><a href="#é˜…è¯»è®°å½•" class="headerlink" title="é˜…è¯»è®°å½•"></a>é˜…è¯»è®°å½•</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€debian@debian ~/Kindle</span><br><span class="line">â•°â”€$ tree -d</span><br><span class="line">â”œâ”€â”€ 2020-01-01-ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ</span><br><span class="line">â”œâ”€â”€ 2020-01-01-è‡ªç”±ä¸ç¹è£çš„å›½åº¦</span><br><span class="line">â”œâ”€â”€ 2020-01-01-è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€</span><br><span class="line">â”œâ”€â”€ 2020-01-02-å¨±ä¹è‡³æ­»</span><br><span class="line">â”œâ”€â”€ 2020-01-02-æŠ€æœ¯å„æ–­ï¼šæ–‡åŒ–å‘æŠ€æœ¯æŠ•é™</span><br><span class="line">â”œâ”€â”€ 2020-01-02-ç«¥å¹´çš„æ¶ˆé€</span><br><span class="line">â”œâ”€â”€ 2020-01-03-å¿ƒé‡Œæµ‹é‡è€…</span><br><span class="line">â”œâ”€â”€ 2020-01-04-è®ºé©å‘½</span><br><span class="line">â”œâ”€â”€ 2020-01-06-æ¶ˆé€çš„å¾®ç”Ÿç‰©</span><br><span class="line">â”œâ”€â”€ 2020-01-07-é£é™©ç¤¾ä¼šï¼šæ–°çš„ç°ä»£æ€§ä¹‹è·¯</span><br><span class="line">â”œâ”€â”€ 2020-01-10-äººçš„å¢ƒå†µ</span><br><span class="line">â”œâ”€â”€ 2020-01-10-åº·å¾·çš„æ”¿æ²»å“²å­¦</span><br><span class="line">â”œâ”€â”€ 2020-01-10-è‡ªç„¶å²</span><br><span class="line">â”œâ”€â”€ 2020-01-11-Booklist</span><br><span class="line">â”œâ”€â”€ 2020-01-12-å“ˆè€¶å…‹æ³•å¾‹å“²å­¦</span><br><span class="line">â”œâ”€â”€ 2020-01-12-æš—æ€æ•™å®¤</span><br><span class="line">â”œâ”€â”€ 2020-01-12-è®ºæ³•çš„ç²¾ç¥</span><br><span class="line">â”œâ”€â”€ 2020-01-15-å¤§å›½å´›èµ·</span><br><span class="line">â”œâ”€â”€ 2020-01-15-æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨ä¸åæœ</span><br><span class="line">â”œâ”€â”€ 2020-01-17-Happy-Suger-Life</span><br><span class="line">â”œâ”€â”€ 2020-01-17-å“ˆè€¶å…‹ç¤¾ä¼šç†è®º</span><br><span class="line">â”œâ”€â”€ 2020-01-17-åœ°çƒè„‰åŠ¨ï¼šå‰æ‰€æœªè§çš„è‡ªç„¶ä¹‹ç¾</span><br><span class="line">â”œâ”€â”€ 2020-01-17-å¤§å›½çš„å´©æºƒï¼šè‹è”è§£ä½“çš„å°å‰å¹•å</span><br><span class="line">â”œâ”€â”€ 2020-01-18-é€šå¾€å¥´å½¹ä¹‹è·¯</span><br><span class="line">â”œâ”€â”€ 2020-01-19-è®ºå›½å®¶çš„ä½œç”¨</span><br><span class="line">â”œâ”€â”€ 2020-01-23-å¢æ¢­</span><br><span class="line">â”œâ”€â”€ 2020-01-27-ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶</span><br><span class="line">â”œâ”€â”€ 2020-01-27-ç›—ç«è€…ï¼šä¸­å›½æ•™è‚²ä½“åˆ¶æ”¹é©è°ƒæŸ¥</span><br><span class="line">â”œâ”€â”€ 2020-01-28-ç—…æ¯’æ˜Ÿçƒ</span><br><span class="line">â”œâ”€â”€ 2020-01-28-ç—…æ¯’æ¥è¢­</span><br><span class="line">â”œâ”€â”€ 2020-01-28-è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹</span><br><span class="line">â”œâ”€â”€ 2020-01-30-å“ˆè€¶å…‹ä¼ </span><br><span class="line">â”œâ”€â”€ 2020-02-05-è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½</span><br><span class="line">â”œâ”€â”€ 2020-02-06-Carton</span><br><span class="line">â”œâ”€â”€ 2020-02-06-å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹</span><br><span class="line">â”œâ”€â”€ 2020-02-06-æ”¿æ²»ç§©åºçš„èµ·æº</span><br><span class="line">â”œâ”€â”€ 2020-02-06-æœ±é’¦å£«çš„ä¸ªäººåšå®¢</span><br><span class="line">â”œâ”€â”€ 2020-02-07-ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥</span><br><span class="line">â”œâ”€â”€ 2020-02-08-æˆ‘çš„é’æ˜¥æ‹çˆ±ç‰©è¯­</span><br><span class="line">â”œâ”€â”€ 2020-02-09-å¤æ‹‰æ ¼ä¹‹æ‹ï¼šä¸€ä¸ªçˆ±æƒ…ä¸æ±‚ç”Ÿçš„çœŸæ˜¯æ•…äº‹</span><br><span class="line">â”œâ”€â”€ 2020-02-09-å¤æ‹‰æ ¼ç¾¤å²›</span><br><span class="line">â”œâ”€â”€ 2020-02-09-è‘›å‰‘é›„æ–‡é›†å…­ï¼šå²è¿¹è®°è¸ª</span><br><span class="line">â”œâ”€â”€ 2020-02-10-é²è¿…å…¨é›†</span><br><span class="line">â”œâ”€â”€ 2020-02-12-æ°¸ä¹…è®°å½•</span><br><span class="line">â”œâ”€â”€ 2020-02-12-å¤§ç­ç»æ—¶ä»£ï¼šä¸€éƒ¨åå¸¸çš„è‡ªç„¶å²</span><br><span class="line">â”œâ”€â”€ 2020-02-13-ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ</span><br><span class="line">â”œâ”€â”€ 2020-02-13-è¿œå¤çš„è¾‰ç…Œï¼šç”Ÿç‰©å¤§å¹…å°„</span><br><span class="line">â”œâ”€â”€ 2020-02-14-å›½å®¶å»ºè®¾ä¸æ”¿åºœè¡Œä¸º</span><br><span class="line">â”œâ”€â”€ 2020-02-14-åœ°çƒçš„æ•…äº‹</span><br><span class="line">â”œâ”€â”€ 2020-02-16-ç”Ÿå‘½æ´»åŠ¨çš„æ‘‡ç¯®ï¼šç»†èƒ</span><br><span class="line">â”œâ”€â”€ 2020-02-19-åšå®¢æ–‡ç« </span><br><span class="line">â”œâ”€â”€ 2020-02-20-è‡ªç§çš„åŸºå› </span><br><span class="line">â”œâ”€â”€ 2020-02-21-çº¢å¤ªé˜³</span><br><span class="line">â”œâ”€â”€ 2020-02-24-åœ°çƒè„‰åŠ¨2ï¼šå¥‡è¿¹ä¸–ç•Œ</span><br><span class="line">â”œâ”€â”€ 2020-02-26-ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šç¦æŸ¯</span><br><span class="line">â”œâ”€â”€ 2020-02-29-J</span><br><span class="line">â”œâ”€â”€ 2020-03-03-å†å²çš„ç»ˆç»“</span><br><span class="line">â”œâ”€â”€ 2020-03-04-ææƒä¸»ä¹‰çš„èµ·æº</span><br><span class="line">â”œâ”€â”€ 2020-03-06-ä¸­å›½å®˜åƒšæ”¿æ²»ç ”ç©¶</span><br><span class="line">â”œâ”€â”€ 2020-03-07-ä¸€æƒ³åˆ°è¿˜æœ‰~</span><br><span class="line">â”œâ”€â”€ 2020-03-07-åæ°451</span><br><span class="line">â”œâ”€â”€ 2020-03-11-è¿™æ‰æ˜¯å¥½è¯»çš„æ•°å­¦å²</span><br><span class="line">â”œâ”€â”€ 2020-03-12-å¯¹æœ¬æ¬¡ç–«æƒ…çš„åæ€</span><br><span class="line">â”œâ”€â”€ 2020-03-12-å¼ åƒå¸†ï¼šææƒä¸»ä¹‰çš„æ„å»º</span><br><span class="line">â”œâ”€â”€ 2020-03-12-å¾è´²ï¼šä¸­å›½çš„â€œæ–°ææƒä¸»ä¹‰â€åŠå…¶æœ«ä¸–æ™¯è±¡</span><br><span class="line">â”œâ”€â”€ 2020-03-13-æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³</span><br><span class="line">â”œâ”€â”€ 2020-03-13-æ—æ„ˆéœ</span><br><span class="line">â”œâ”€â”€ 2020-03-14-Age of Ambition</span><br><span class="line">â”œâ”€â”€ 2020-03-14-Amusing Ourselves to Death</span><br><span class="line">â”œâ”€â”€ 2020-03-14-Permanent Record</span><br><span class="line">â”œâ”€â”€ 2020-03-15-ä¸èƒ½æ‰¿å—çš„ç”Ÿå‘½ä¹‹è½»</span><br><span class="line">â”œâ”€â”€ 2020-03-20-è€é’±æ–‡é›†ï¼šç¡…è°·ä¼ å¥‡</span><br><span class="line">â”œâ”€â”€ 2020-03-22-ç¬‘å¿˜ä¹¦</span><br><span class="line">â”œâ”€â”€ 2020-03-25-ç¥å¥‡çš„ç”Ÿç‰©åŒ–å­¦</span><br><span class="line">â”œâ”€â”€ 2020-03-26-è´¹é©¬æœ€ç»ˆå®šç†</span><br><span class="line">â”œâ”€â”€ 2020-03-28-è¢«è®¨åŒçš„å‹‡æ°”</span><br><span class="line">â”œâ”€â”€ 2020-03-29-è‰¾å¸Œæ›¼åœ¨è€¶è·¯æ’’å†·</span><br><span class="line">â”œâ”€â”€ 2020-03-30-ä»ä¸€åˆ°æ— ç©·å¤§</span><br><span class="line">â””â”€â”€ 2020-03-30-å¦‚æœå†å²æ˜¯ä¸€ç¾¤è‚¥å–µ</span><br><span class="line"></span><br><span class="line">79 directories, 1181 files</span><br></pre></td></tr></table></figure><p>è‡ªä»å…ƒæ—¦çš„æ—¶å€™çŸ¥é“äº† kindle çš„æˆªå±æ–¹æ³•ä¹‹åå°±ä¸€ç›´å°†é˜…è¯»è¿‡ç¨‹ä¸­ä¸€äº›ç²¾å½©çš„ç‰‡æ®µæˆªå±ä¸‹æ¥ï¼Œç„¶åå†ç§»åŠ¨åˆ°æœ¬åœ°ç£ç›˜è¿›è¡Œåˆ†ç±»å’Œæ•´ç†ã€‚æ¯ä¸€ä¸ªæ–‡ä»¶å¯¹åº”ä¸€æœ¬ä¹¦ï¼Œå‰é¢åœ¨åŠ ä¸Šæˆªå±æ—¶çš„æ—¶é—´ï¼Œè¿™æ ·å°±èƒ½è®°å½•ä¸‹æ•´ä¸ªé˜…è¯»çš„æ—¶é—´çº¿ã€‚åŸæœ¬åªæ˜¯å°†æˆªå±çš„å›¾ç‰‡æŒ‰ç…§ä¹¦ååˆ†ç±»å¥½ï¼Œå¹¶æ²¡æœ‰åŠ ä¸Šæ—¥æœŸã€‚åæ¥å°±å†™äº†ä¸ªè„šæœ¬è‡ªåŠ¨åŠ ä¸Šäº†æ—¥æœŸğŸ˜‚ã€‚è¿™æ ·è¿˜å¥½ï¼Œæœ‰ä¸ªæ—¶é—´çº¿æ¥åšå‚è€ƒ~</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">set -xue</span><br><span class="line">for dir in $(ls | grep -v "\." | grep -Ev  "2019|2020")</span><br><span class="line">do</span><br><span class="line">    date=$(ls $&#123;dir&#125;/*.png |grep -Eo "[0-9][0-9][0-9][0-9]_[0-9][0-9]_[0-9][0-9]" | sed 's/_/-/g' | head -n1)</span><br><span class="line">    title=$(echo $&#123;dir&#125; | sed 's/ /-/g')</span><br><span class="line">    dir_name=$&#123;date&#125;-$&#123;title&#125;</span><br><span class="line">    mv $&#123;dir&#125; $&#123;dir_name&#125;</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h2 id="è¯»ä¹¦è¿›åº¦"><a href="#è¯»ä¹¦è¿›åº¦" class="headerlink" title="è¯»ä¹¦è¿›åº¦"></a>è¯»ä¹¦è¿›åº¦</h2><h3 id="è¯»å®Œ"><a href="#è¯»å®Œ" class="headerlink" title="è¯»å®Œ"></a>è¯»å®Œ</h3><table><thead><tr><th align="center">ä¹¦å</th><th align="center">ä½œè€…</th><th align="center">æ—¥æœŸ</th><th align="center">æ—¶é•¿</th><th align="center">è¿›åº¦</th></tr></thead><tbody><tr><td align="center">ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ</td><td align="center">[å¥¥] è·¯å¾·ç»´å¸ŒÂ·å†¯Â·ç±³ç‘Ÿæ–¯</td><td align="center">01-01</td><td align="center">10h</td><td align="center">100%</td></tr><tr><td align="center">è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€</td><td align="center">[æ³•]è®©-é›…å…‹Â·å¢æ¢­</td><td align="center">01-01</td><td align="center">5h</td><td align="center">100%</td></tr><tr><td align="center">å¿ƒç†æµ‹é‡è€…</td><td align="center">[æ—¥]æ·±çœŸè§</td><td align="center">01-03</td><td align="center">6h</td><td align="center">100%</td></tr><tr><td align="center">æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨å’Œåæœ</td><td align="center">å¼ é›ªå¿ </td><td align="center">01-15</td><td align="center">4h</td><td align="center">100%</td></tr><tr><td align="center">åœ°çƒè„‰åŠ¨ï¼šå‰æ‰€æœªè§çš„è‡ªç„¶ä¹‹ç¾</td><td align="center">[è‹±]é˜¿æ‹‰æ–¯æ³°å°”Â·ç¦ç‘Ÿå‰å°”</td><td align="center">01-22</td><td align="center">4h</td><td align="center">100%</td></tr><tr><td align="center">è®ºç§‘å­¦ä¸è‰ºæœ¯</td><td align="center">è®©-é›…å…‹Â·å¢æ¢­</td><td align="center">01-21</td><td align="center">2h</td><td align="center">100%</td></tr><tr><td align="center">ç¤¾ä¼šå¥‘çº¦è®º (è¯‘æ—äººæ–‡ç²¾é€‰)</td><td align="center">è®©-é›…å…‹Â·å¢æ¢­</td><td align="center">01-23</td><td align="center">4h</td><td align="center">100%</td></tr><tr><td align="center">ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶</td><td align="center">å‘¨é›ªå…‰</td><td align="center">01-28</td><td align="center">8h</td><td align="center">100%</td></tr><tr><td align="center">ç—…æ¯’æ˜Ÿçƒ</td><td align="center">[ç¾]å¡å°”Â·é½é»˜</td><td align="center">01-28</td><td align="center">4h</td><td align="center">100%</td></tr><tr><td align="center">ç—…æ¯’æ¥è¢­</td><td align="center">[ç¾]å†…æ£®â€¢æ²ƒå°”å¤«</td><td align="center">01-29</td><td align="center">2h</td><td align="center">100%</td></tr><tr><td align="center">è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½</td><td align="center">å‘¨å¿—ç‚</td><td align="center">02-05</td><td align="center">4h</td><td align="center">100%</td></tr><tr><td align="center">å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹</td><td align="center">æœ±æ‰ä¼</td><td align="center">02-06</td><td align="center">3h</td><td align="center">100%</td></tr><tr><td align="center">ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥</td><td align="center">æœ±é’¦å£«</td><td align="center">02-07</td><td align="center">6h</td><td align="center">100%</td></tr><tr><td align="center">æœ±é’¦å£«çš„ä¸ªäººåšå®¢</td><td align="center">æœ±é’¦å£«</td><td align="center">02-08</td><td align="center">8h</td><td align="center">100%</td></tr><tr><td align="center">è¿œå¤çš„è¾‰ç…Œï¼šç”Ÿç‰©å¤§å¹…å°„</td><td align="center">æˆå˜‰ä½™</td><td align="center">02-13</td><td align="center">6h</td><td align="center">100%</td></tr><tr><td align="center">ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ</td><td align="center">[è‹±]é©¬ä¸Â·é›·å¾·èŠ¬</td><td align="center">02-13</td><td align="center">6h</td><td align="center">100%</td></tr><tr><td align="center">ç”Ÿå‘½æ´»åŠ¨çš„æ‘‡ç¯®ï¼šç»†èƒ</td><td align="center">ç‹è€€å‘</td><td align="center">02-16</td><td align="center">4h</td><td align="center">100%</td></tr><tr><td align="center">åœ°çƒè„‰åŠ¨2ï¼šå¥‡è¿¹ä¸–ç•Œ</td><td align="center">èƒ¡Â·ç§‘é‡Œ</td><td align="center">02-24</td><td align="center">3h</td><td align="center">100%</td></tr><tr><td align="center">ä¸€æƒ³åˆ°è¿˜æœ‰ç™¾åˆ†ä¹‹ä¹åäº”çš„é—®é¢˜~</td><td align="center">è±ªå°”èµ«â€¢é™ˆ</td><td align="center">03-07</td><td align="center">4h</td><td align="center">100%</td></tr><tr><td align="center">å†å²çš„ç»ˆç»“åŠæœ€åä¹‹äºº</td><td align="center">[ç¾]å¼—æœ—è¥¿æ–¯Â·ç¦å±±</td><td align="center">03-03</td><td align="center">10h</td><td align="center">100%</td></tr><tr><td align="center">æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³</td><td align="center">ä½™æ°</td><td align="center">03-13</td><td align="center">8h</td><td align="center">100%</td></tr><tr><td align="center">ç¥å¥‡çš„ç”Ÿç‰©åŒ–å­¦</td><td align="center">ç¥å¥‡çš„ç”Ÿç‰©åŒ–å­¦</td><td align="center">03-23</td><td align="center">4h</td><td align="center">100%</td></tr><tr><td align="center">è´¹é©¬æœ€ç»ˆå®šç†</td><td align="center">[æ—¥]æ—¥å†²æ¨±çš®</td><td align="center">03-26</td><td align="center">3h</td><td align="center">100%</td></tr><tr><td align="center">è¢«è®¨åŒçš„å‹‡æ°”</td><td align="center">å²¸è¦‹ä¸€éƒ</td><td align="center">03-28</td><td align="center">4h</td><td align="center">100%</td></tr></tbody></table><h3 id="åœ¨è¯»"><a href="#åœ¨è¯»" class="headerlink" title="åœ¨è¯»"></a>åœ¨è¯»</h3><table><thead><tr><th align="center">ä¹¦å</th><th align="center">ä½œè€…</th><th align="center">æ—¥æœŸ</th><th align="center">æ—¶é•¿</th><th align="center">è¿›åº¦</th></tr></thead><tbody><tr><td align="center">Age of Ambition</td><td align="center">Evan Osnos</td><td align="center">03-13</td><td align="center">4h</td><td align="center">8%</td></tr><tr><td align="center">ä»ä¸€åˆ°æ— ç©·å¤§</td><td align="center">ä¹”æ²»Â·ä¼½è«å¤«</td><td align="center">03-30</td><td align="center">-</td><td align="center">-</td></tr><tr><td align="center">ææƒä¸»ä¹‰çš„èµ·æº</td><td align="center">[å¾·] æ±‰å¨œÂ·é˜¿ä¼¦ç‰¹</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="center">è‡ªç”±ç§©åºåŸç†</td><td align="center">å¼—é‡Œå¾·é‡Œå¸ŒÂ·å“ˆè€¶å…‹</td><td align="center"></td><td align="center"></td><td align="center"></td></tr></tbody></table><h3 id="æš‚æ—¶å¼ƒå‘"><a href="#æš‚æ—¶å¼ƒå‘" class="headerlink" title="æš‚æ—¶å¼ƒå‘"></a>æš‚æ—¶å¼ƒå‘</h3><table><thead><tr><th align="center">ä¹¦å</th><th align="center">ä½œè€…</th><th align="center">æ—¥æœŸ</th><th align="center">è¿›åº¦</th><th></th></tr></thead><tbody><tr><td align="center">ç”Ÿå‘½ä¸­ä¸èƒ½æ‰¿å—ä¹‹è¼•</td><td align="center">ç±³è˜­Â·æ˜†å¾·æ‹‰</td><td align="center">03-15</td><td align="center">40%</td><td></td></tr><tr><td align="center">ç¬‘å¿˜ä¹¦</td><td align="center">ç±³è˜­Â·æ˜†å¾·æ‹‰</td><td align="center">03-22</td><td align="center">40%</td><td></td></tr><tr><td align="center">è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹</td><td align="center">ç†æŸ¥å¾·Â·æ™®é›·æ–¯é¡¿</td><td align="center">02-01</td><td align="center">20%</td><td></td></tr><tr><td align="center">åæ°451</td><td align="center">é›·Â·å¸ƒé›·å¾·ä¼¯é‡Œ</td><td align="center">04-07</td><td align="center">30%</td><td></td></tr><tr><td align="center">æ¶ˆå¤±çš„å¾®ç”Ÿç‰©ï¼šæ»¥ç”¨æŠ—ç”Ÿç´ å¼•å‘çš„å±æœº</td><td align="center">ï¼»ç¾ï¼½é©¬ä¸â€¢å¸ƒè±æ³½</td><td align="center">01-06</td><td align="center">10%</td><td></td></tr><tr><td align="center">å¤æ‹‰æ ¼ä¹‹æ‹</td><td align="center">å¥¥å…°å¤šÂ·è´¹å‰æ–¯</td><td align="center">02-09</td><td align="center">10%</td><td></td></tr><tr><td align="center">è®ºå›½å®¶çš„ä½œç”¨</td><td align="center">æ´ªå ¡</td><td align="center">01-19</td><td align="center">30%</td><td></td></tr><tr><td align="center">é²è¿…å…¨é›†</td><td align="center">é²è¿…</td><td align="center">02-10</td><td align="center">5%</td><td></td></tr><tr><td align="center">è‡ªç§çš„åŸºå› </td><td align="center">ç†æŸ¥å¾·Â·é“é‡‘æ–¯</td><td align="center">02-20</td><td align="center">30%</td><td></td></tr><tr><td align="center">å›½å®¶å»ºè®¾ä¸æ”¿åºœè¡Œä¸º</td><td align="center">å‘¨é›ªå…‰</td><td align="center">02-14</td><td align="center">40%</td><td></td></tr><tr><td align="center">ç›—ç«è€…ï¼šä¸­å›½æ•™è‚²é©å‘½é™æ‚„æ‚„</td><td align="center">é‚“åº·å»¶ æ¢ç½—å…´</td><td align="center">01-23</td><td align="center">20%</td><td></td></tr><tr><td align="center">å¤§å›½å´›èµ·</td><td align="center">å”æ™‹</td><td align="center">01-16</td><td align="center">50%</td><td></td></tr></tbody></table><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><h3 id="ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ"><a href="#ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ" class="headerlink" title="ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ"></a>ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_01_01T12_33_41+0800.png" alt="img"></p><p>è¿™æœ¬ä¹¦æ˜¯ä»Šå¹´è¯»çš„ç¬¬ä¸€æœ¬ä¹¦ï¼Œè¿™æœ¬ä¹¦å¯ä»¥å’Œå“ˆè€¶å…‹çš„ã€Šé€šå¾€å¥´å½¹ä¹‹è·¯ã€‹ç»“åˆç€è¯»ã€‚æœ¬ä¹¦å‡ºç‰ˆäº 1922 å¹´ï¼Œåˆ†åˆ«ä»å¤šä¸ªé¢†åŸŸï¼ˆæ”¿æ²»ã€ç»æµã€æ–‡åŒ–ã€ä¼¦ç†ã€å®—æ•™â€¦ï¼‰è®ºè¿°äº†ç¤¾ä¼šä¸»ä¹‰å¿…å®šå¤±è´¥çš„æ‚²æƒ¨ç»“å±€ï¼Œå¯¹å½“æ—¶çš„ç¤¾ä¼šå°¤å…¶é’å¹´å­¦ç”Ÿæ¥è®²å†²å‡»ç›¸å½“çš„å¤§ï¼Œé‚£æ—¶å€™ CCP åˆšåˆšæˆç«‹æ‰ 1 å¹´å“¦ã€‚</p><p>å…ˆè¯´ä¸€ä¸‹ä½œè€…ï¼Œè·¯å¾·ç»´å¸ŒÂ·å†¯Â·ç±³å¡æ–¯ä½œä¸ºâ€œ<a href="https://zh.wikipedia.org/wiki/å¥§åœ°åˆ©ç¶“æ¿Ÿå­¸æ´¾" target="_blank" rel="noopener">å¥¥åœ°åˆ©ç»æµå­¦æ´¾</a>çš„é™¢é•¿â€ï¼Œç°ä»£<a href="https://zh.wikipedia.org/wiki/è‡ªç”±æ„å¿—ä¸»ç¾©" target="_blank" rel="noopener">è‡ªç”±æ„å¿—ä¸»ä¹‰</a>è¿åŠ¨çš„ä¸»è¦é¢†å¯¼äººï¼Œä¹Ÿæ˜¯<a href="https://zh.wikipedia.org/wiki/å¤å…¸è‡ªç”±ä¸»ç¾©" target="_blank" rel="noopener">å¤å…¸è‡ªç”±ä¸»ä¹‰</a>ç¬¬ä¸€æŠŠäº¤æ¤…ï¼Œå…¶å½±å“åŠ›ä¸è¨€è€Œå–»ã€‚ä»–çš„å­¦ç”Ÿæ›´æ˜¯é’å‡ºäºè“èƒœäºè“ï¼šå¼—é‡Œå¾·é‡Œå¸ŒÂ·å†¯Â·å“ˆè€¶å…‹ã€å¼—é‡ŒèŒ¨Â·é©¬å…‹å¢æ™®ã€æˆˆç‰¹å¼—é‡Œå¾·Â·å†¯Â·å“ˆä¼¯å‹’ã€å¥¥æ–¯å¡Â·æ‘©æ ¹æ–¯å¦ã€å¨å»‰Â·å‹’æ™®å…‹ã€ç†æŸ¥å¾·Â·å†¯Â·æ–½ç‰¹é‡Œæˆˆå°”ã€è‰¾å°”å¼—é›·å¾·Â·èˆ’èŒ¨ã€è´¹é‡Œå…‹æ–¯Â·è€ƒå¤«æ›¼ã€åŸƒé‡Œå…‹Â·æ²ƒæ ¼æ—ã€æ ¼å¥¥å°”æ ¼Â·å“ˆå°”å§†ã€ä¿ç½—Â·ç½—æ£®æ–¯å¦-ç½—ä¸¹ã€è±æ˜‚å†…å°”Â·ç½—å®¾æ–¯ã€‚åœ¨ä»–çš„å­¦ç”Ÿå½“ä¸­ï¼Œå“ˆè€¶å…‹è·è¯ºè´å°”ç»æµå­¦å¥–ï¼Œå¼—é‡ŒèŒ¨Â·é©¬å…‹å¢æ™®ã€æˆˆç‰¹å¼—é‡Œå¾·Â·å†¯Â·å“ˆä¼¯å‹’æ›¾å…ˆåä»»ç¾å›½ç»æµå­¦ä¼šä¼šé•¿ã€‚</p><blockquote><p>æˆ‘ä»¬æ„Ÿåˆ°ï¼Œæˆ‘ä»¬æˆé•¿äºå…¶ä¸­çš„é‚£ä¸ªæ–‡æ˜å·²ç»å´©æºƒã€‚æˆ‘ä»¬ç«‹å¿—å»ºè®¾ä¸€ä¸ªæ›´ç¾å¥½çš„ä¸–ç•Œï¼Œè€Œæ­£æ˜¯è¿™ç§å†é€ ç¤¾ä¼šçš„æ¸´æœ›ï¼Œé­ç­–æˆ‘ä»¬æŠ•èº«ç»æµå­¦ç ”ç©¶ã€‚ç¤¾ä¼šä¸»ä¹‰è®¸è¯ºç»™æˆ‘ä»¬ä¸€ä¸ªæ›´åŠ ç†æ€§ã€æ›´åŠ å…¬æ­£çš„ä¸–ç•Œã€‚æ­¤æ—¶ï¼Œã€Šç¤¾ä¼šä¸»ä¹‰ã€‹é—®ä¸–äº†ï¼Œæˆ‘ä»¬çš„ä¿¡å¿µåå¡Œäº†ã€‚ã€Šç¤¾ä¼šä¸»ä¹‰ã€‹å¯¹æˆ‘ä»¬è¯´ï¼Œæˆ‘ä»¬çš„æ–¹å‘é”™äº†ã€‚</p></blockquote><p>å¯ä»¥ç»“åˆç€å“ˆè€¶å…‹çš„ä¹¦æ¥è¯»ï¼Œè¿™æœ¬ä¹¦å‘Šè¯‰æˆ‘ä»¬çš„æ˜¯ï¼š<strong>ç¤¾ä¼šä¸»ä¹‰æ˜¯é€šå¾€å¥´å½¹ä¹‹è·¯</strong> ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/mSj0qay7jW" target="_blank" rel="noopener">ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ</a></p><blockquote><p>ç±³å¡æ–¯åœ¨ä¹¦ä¸­åˆ†åˆ«ä»å¤šä¸ªé¢†åŸŸï¼ˆæ”¿æ²»ã€ç»æµã€æ–‡åŒ–ã€ä¼¦ç†ã€å®—æ•™â€¦ï¼‰å¯¹ã€å„ç§æµæ´¾ã€‘çš„ç¤¾ä¼šä¸»ä¹‰è¿›è¡ŒçŒ›çƒˆæ‰¹åˆ¤ã€‚å…¶æŠ¨å‡»çš„ç«åŠ›ä¹‹çŒ›ï¼Œå®å±ç½•è§ã€‚</p></blockquote><p>å¦å¤–æ¨èè¯»ä¸€ä¸‹ <a href="https://program-think.blogspot.com/2018/09/Book-Review-The-Errors-of-Marxism-Leninism.html" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆé©¬å…‹æ€æ˜¯é”™çš„ï¼Ÿâ€”â€”å…¨é¢æ‰¹åˆ¤é©¬åˆ—ä¸»ä¹‰çš„çŸ¥åè‘—ä½œå¯¼è¯»</a> ã€‚</p><blockquote><p>ä½œè€…<a href="https://zh.wikipedia.org/wiki/è·¯å¾·ç¶­å¸ŒÂ·é¦®Â·ç±³å¡æ–¯" target="_blank" rel="noopener">è·¯å¾·ç»´å¸ŒÂ·å†¯Â·ç±³å¡æ–¯</a>æ˜¯å¥¥åœ°åˆ©å­¦æ´¾çš„å¹²å°†ï¼Œå¹¶å¯¹åŒä¸€å­¦æ´¾çš„å“ˆè€¶å…‹æœ‰é‡å¤§å½±å“ã€‚åœ¨å“ˆè€¶å…‹çš„å¾ˆå¤šè‘—ä½œå’Œç†è®ºä¸­ï¼Œéƒ½å¯ä»¥çœ‹åˆ°ç±³å¡æ–¯çš„å½±å­ã€‚<br>ã€€ã€€ç±³å¡æ–¯çš„æˆå°±é•¿æœŸè¢«å­¦æœ¯ç•Œå¿½è§†ï¼ˆç”šè‡³æ˜¯æ’æ–¥ï¼‰ã€‚ä¸€æ–¹é¢æ˜¯ä»–çš„ç†è®ºå¤ªè¶…å‰ï¼Œå¦ä¸€æ–¹é¢æ˜¯ä»–çš„æ€§æ ¼å¤ªæ¿€çƒˆâ€”â€”ä¸äººäº¤æµæ—¶æ€»æ˜¯ä¸€é’ˆè§è¡€ï¼Œä¸ç•™æƒ…é¢ï¼Œæ¯«ä¸é¡¾å¿Œä»–äººæ„Ÿå—ã€‚<br>ã€€ã€€è¯´åˆ°ã€è¶…å‰æ€§ã€‘ï¼Œä»–å¯èƒ½æ˜¯ç»æµå­¦ç•Œæœ€æ—©æ„è¯†åˆ°â€œã€åšå¼ˆè®ºã€‘é‡è¦æ€§â€çš„é‚£ä¸ªäººï¼ˆæ—¶é—´æ˜¯20ä¸–çºªåˆæœŸï¼‰ã€‚å‡ åå¹´åï¼Œä¸å†¯Â·è¯ºä¾æ›¼å…±åŒå‘è¡¨åˆ’æ—¶ä»£è®ºæ–‡ã€Šåšå¼ˆè®ºä¸ç»æµè¡Œä¸ºã€‹çš„é‚£ä¸ªæ‘©æ ¹æ–¯å¦ï¼ˆå‰é¢ä¿ºæè¿‡æ­¤äººï¼‰ï¼Œå°±æ˜¯ç±³å¡æ–¯çš„å­¦ç”Ÿã€‚</p></blockquote><h3 id="è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€"><a href="#è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€" class="headerlink" title="è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€"></a>è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_01_01T18_23_18+0800.png" alt="img"></p><p>è¿™æœ¬ä¹¦æ˜¯æˆ‘åœ¨çœ‹å¿ƒç†æµ‹é‡è€…åŠ¨ç”»çš„æ—¶å€™æåˆ°çš„ï¼Œåœ¨çœ‹å°è¯´çš„æ—¶å€™ä¹Ÿè§åˆ°è¿‡ã€‚äºæ˜¯å°±æ‹¿æ¥è¯»äº†ä¸€ä¸‹ï¼Œ<code>Kindle Unlimited</code>  çš„ä¼šå‘˜å¯ä»¥åœ¨ Amazon å•†åº—å…è´¹å€Ÿé˜…åˆ°ã€‚ã€Šè®ºäººç±»ä¸å¹³ç­‰èµ·æºå’ŒåŸºç¡€ã€‹æ˜¯å¢æ¢­åº”æ³•å›½ç¬¬æˆç§‘å­¦é™¢çš„å¾æ–‡è€Œæ’°å†™çš„ç¬¬äºŒè®ºæ–‡ï¼Œç¬¬ä¸€ç¯‡è®ºæ–‡æ˜¯ã€Šè®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´ã€‹ã€‚</p><p>åœ¨ä¹¦ä¸­ï¼Œå¢æ¢­é˜å‘äº†è‡ªèº«çš„æ”¿æ²»å“²å­¦ï¼Œä¸ºã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹çš„å†™ä½œå¥ å®šäº†åŸºç¡€ã€‚å¢æ¢­å°†äººç±»å†å²çš„å‘å±•è¿‡ç¨‹è§†ä½œè¿›æ­¥ä¸é€€åŒ–çš„çŸ›ç›¾ç»Ÿä¸€ä½“ã€‚ä»–ä¸€æ–¹é¢å€ŸåŠ©å½“æ—¶æœ‰å…³è‡ªç„¶çŠ¶æ€ä¸‹äººçš„äººç±»å­¦ææ–™ï¼Œä¸€æ–¹é¢å±•å¼€è¾©è¯çš„æƒ³è±¡ï¼Œå›é¡¾äº†äººç±»ç”±è‡ªç„¶çŠ¶æ€å‘ç¤¾ä¼šçŠ¶æ€è¿‡æ¸¡çš„å†å²è¿›ç¨‹ï¼ŒæŒ‡å‡ºäººç±»çš„è¿›æ­¥å²åŒæ—¶ä¹Ÿæ˜¯äººç±»çš„å •è½å²ï¼Œå› ä¸ºäººç±»æ¯å‘å‰å‘å±•ä¸€æ­¥ï¼Œä¸å¹³ç­‰çš„ç¨‹åº¦å³åŠ æ·±ä¸€æ­¥ã€‚è€Œç§æœ‰åˆ¶çš„ç¡®ç«‹ï¼Œæ˜¯é€ æˆäººç±»ä¸å¹³ç­‰åŠå…¶åæœçš„å…³é”®ç¯èŠ‚ã€‚</p><p>æ­£æ˜¯è¿™æ ·çš„å‡è®¾ï¼Œä½¿äººä»¬å¾—ä»¥æ˜ç™½â€œæˆ‘ä»¬å¹¶éç”Ÿæ¥å¦‚æ­¤â€ï¼Œåªæ˜¯â€œå·²ç„¶å¦‚æ­¤â€ã€‚æ—¢ç„¶å¤„äºè‡ªç„¶çŠ¶æ€ä¸‹çš„äººç±»åªæ˜¯ä¸€ä¸ªæŠ½è±¡åŒ–çš„å½¢è±¡ï¼Œå³ä¸€ç§â€œæ— â€çš„å¢ƒç•Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å½“ç„¶ä¸èƒ½è¯´å¢æ¢­çš„ç›®çš„æ˜¯è®©äººç±»å›åˆ°è¿™ä¸ªæœ¬å°±ä¸å­˜åœ¨çš„å½¢è±¡äº†ã€‚ä»–åªæ˜¯ä¼å›¾ä»¥è¿™ä¸ªâ€œæ— â€çš„å¢ƒç•Œä¸ºèµ·ç‚¹ï¼Œå‘äººä»¬å±•ç¤ºå‡ºäººç±»æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥å˜æˆç°åœ¨çš„æ ·å­ï¼Œä»è€Œè¿›ä¸€æ­¥æ€è€ƒï¼Œè¦æƒ³æ‘†è„±ç°åœ¨çš„å›°å¢ƒï¼Œæˆ‘ä»¬æ‰€éœ€è¦åšå‡ºçš„åŠªåŠ›ã€‚æœ¬æ–‡ä¸ºæˆ‘ä»¬æä¾›çš„åæ€å°±åƒé‚£é«˜é€Ÿè·¯ä¸Šçš„ç¼“å†²å¸¦ï¼Œåªæœ‰åœç•™åœ¨ç¼“å†²å¸¦ä¸Šçš„é‚£ä¸€ç§’é’Ÿï¼Œäººç±»æ‰ç»ˆäºçœŸæ­£åœ°æ€è€ƒã€‚</p><p><img src="https://blog.k8s.lhttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200106182021903.png" alt="image-20200106182021903"></p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/oTmpnrHLKS" target="_blank" rel="noopener">è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€</a></p><h3 id="å¿ƒé‡Œæµ‹é‡è€…"><a href="#å¿ƒé‡Œæµ‹é‡è€…" class="headerlink" title="å¿ƒé‡Œæµ‹é‡è€…"></a>å¿ƒé‡Œæµ‹é‡è€…</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_01_03T10_49_43+0800.png" alt="img"></p><p>è¯»åæ„Ÿå¯ä»¥å‚è§ <a href="https://blog.k8s.li/PSYCHO-PASS-booklist.html">PSYCHO-PASS å¿ƒç†æµ‹é‡è€…å°è¯´è¯»åæ„Ÿ</a>ï¼Œå¼ƒå‘ä¸¤ä¸ªæœˆäº†æ‰å†™äº†ä¸€ç‚¹ğŸ˜ã€‚</p><p>è¿™éƒ¨æ”¹ç¼–è‡ªåŠ¨æ¼«çš„å°è¯´åŸºæœ¬ä¸Šè¿˜åŸäº†æ•´ä¸ªç¬¬ä¸€éƒ¨åŠ¨ç”»å®Œæ•´çš„å‰§æƒ…ï¼Œæ€»ä¹‹ä¹Ÿæ˜¯å…³äºä¸€ä¸ªå¦‚ä½•æ„å»ºäººç±»ç¤¾ä¼šé¢˜æçš„å°è¯´ã€‚å°è¯´ä¸­ä¹Ÿæåˆ°äº†å¾ˆå¤šä¹¦ç±ï¼Œä¹Ÿæœ‰ç½‘å‹æ€»ç»“äº†ä¸€ä»½å¿ƒç†æµ‹é‡è€…ä¸­æåˆ°çš„ä¹¦ç±ï¼Œä¹¦å•å¦‚ä¸‹:</p><p><strong>æ”¿æ²»/å“²å­¦/å¿ƒç†å­¦/ç¤¾ä¼šå­¦</strong></p><table><thead><tr><th>ä¹¦å</th><th>ä½œè€…</th></tr></thead><tbody><tr><td>ã€Šè®ºé“å¾·çš„è°±ç³» å–„æ¶ä¹‹å½¼å²¸ã€‹</td><td>å¼—é‡Œå¾·é‡Œå¸ŒÂ·å°¼é‡‡</td></tr><tr><td>ã€Šæ‚²å‰§çš„è¯ç”Ÿã€‹</td><td>å¼—é‡Œå¾·é‡Œå¸ŒÂ·å°¼é‡‡</td></tr><tr><td>ã€ŠæŸ¥æ‹‰å›¾æ–¯ç‰¹æ‹‰å¦‚æ˜¯è¯´ã€‹</td><td>å¼—é‡Œå¾·é‡Œå¸ŒÂ·å°¼é‡‡</td></tr><tr><td>ã€Šè®ºäººä¸äººä¹‹é—´ä¸å¹³ç­‰çš„èµ·å› å’ŒåŸºç¡€ã€‹</td><td>è®©Â·é›…å…‹Â·å¢æ¢­</td></tr><tr><td>ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹</td><td>è®©Â·é›…å…‹Â·å¢æ¢­</td></tr><tr><td>ã€Šæ€æƒ³å½•ã€‹</td><td>å¸ƒè±å…¹Â·å¸•æ–¯å¡å°”</td></tr><tr><td>ã€Šå¤§ä¼—çš„åå›ã€‹</td><td>å¥¥å°”ç‰¹åŠ Â·åŠ å¡ç‰¹</td></tr><tr><td>ã€Šç»æµä¸ç¤¾ä¼šã€‹</td><td>é©¬å…‹æ€Â·éŸ¦ä¼¯</td></tr><tr><td>ã€Šé“å¾·ä¸ç«‹æ³•åŸç†å¯¼è®ºã€‹</td><td>æ°é‡Œç±³Â·è¾¹æ²</td></tr><tr><td>ã€Šæ¢æ±‚çœŸç†çš„æŒ‡å¯¼åŸåˆ™ã€‹</td><td>å‹’å†…Â·ç¬›å¡å°”</td></tr><tr><td>ã€Šå“²å­¦åŸç†ã€‹</td><td>å‹’å†…Â·ç¬›å¡å°”</td></tr><tr><td>ã€Šè‡´æ­»çš„ç–¾ç—…ã€‹</td><td>ç´¢ä¼¦Â·å…‹å°”å‡¯éƒ­å°”</td></tr><tr><td>ã€Šéæ­¤å³å½¼ã€‹</td><td>ç´¢ä¼¦Â·å…‹å°”å‡¯éƒ­å°”</td></tr><tr><td>ã€Šè¢«èƒŒå›çš„é©å‘½ã€‹</td><td>æ‰˜æ´›èŒ¨åŸº</td></tr><tr><td>ã€Šä¹Œåˆä¹‹ä¼—ã€‹</td><td>å¤æ–¯å¡”å¤«Â·å‹’åº</td></tr><tr><td>ã€Šçº¯ç²¹ç†æ€§æ‰¹åˆ¤ã€‹</td><td>ä¼Šæ›¼åŠªå°”Â·åº·å¾·</td></tr><tr><td>ã€Šè®ºæ³•çš„ç²¾ç¥ã€‹</td><td>å­Ÿå¾·æ–¯é¸ </td></tr><tr><td>ã€Šå½¢è€Œä¸Šå­¦ä¼¦ã€‹</td><td>ä¼å°”æ³°</td></tr><tr><td>ã€Šæ‹¿ç ´ä»‘æ³•å…¸ã€‹</td><td></td></tr><tr><td>ã€Šèµ„æœ¬è®ºã€‹</td><td>å¡å°”Â·é©¬å…‹æ€</td></tr><tr><td>ã€Šè§„è®­ä¸æƒ©ç½šï¼šç›‘ç‹±çš„è¯ç”Ÿã€‹</td><td>ç¦æŸ¯</td></tr><tr><td>ã€Šå½“å°¼é‡‡åœ¨å“­æ³£ã€‹</td><td>æ¬§æ–‡Â·äºšéš†</td></tr><tr><td>ã€Šæˆ˜äº‰è®ºã€‹</td><td>å¡å°”Â·å†¯Â·å…‹åŠ³å¡ç»´èŒ¨</td></tr><tr><td>ã€Šé»‘çš®è‚¤ï¼Œç™½é¢å…·ã€‹</td><td>å¼—æœ—èŒ¨Â·æ³•å†œ</td></tr><tr><td>ã€Šè¿½å¯»ç”Ÿå‘½çš„æ„ä¹‰ã€‹</td><td>ç»´å…‹å¤šÂ·EÂ·å¼—å…°å…‹å°”</td></tr></tbody></table><p><strong>åä¹Œæ‰˜é‚¦æ–‡å­¦</strong></p><table><thead><tr><th>ä¹¦å</th><th>ä½œè€…</th></tr></thead><tbody><tr><td>ã€Šä¸€ä¹å…«å››ã€‹</td><td>ä¹”æ²»Â·å¥¥å¨å°”</td></tr><tr><td>ã€ŠåŠ¨ç‰©å†œåœºã€‹</td><td>ä¹”æ²»Â·å¥¥å¨å°”</td></tr><tr><td>ã€Šç¾ä¸½æ–°ä¸–ç•Œã€‹</td><td>èµ«èƒ¥é»</td></tr><tr><td>ã€Šæˆ‘ä»¬ã€‹</td><td>æ‰ç±³äºšäº¬</td></tr><tr><td>ã€Šè¿™å®Œç¾çš„ä¸€å¤©ã€‹</td><td>è‰¾æ‹‰Â·è±æ–‡</td></tr></tbody></table><p><strong>æˆå‰§æ–‡å­¦</strong></p><table><thead><tr><th>ã€Šç¬¬åäºŒå¤œã€‹</th><th>èå£«æ¯”äºš</th></tr></thead><tbody><tr><td>ã€Šæ³°ç‰¹æ–¯Â·å®‰å¾·æ´›å°¼å…‹æ–¯ã€‹</td><td>èå£«æ¯”äºš</td></tr><tr><td>ã€Šéº¦å…‹ç™½ã€‹</td><td>èå£«æ¯”äºš</td></tr><tr><td>ã€Šæ–å¤šç¯‡ã€‹</td><td>æŸæ‹‰å›¾</td></tr><tr><td>ã€Šé»‘æš—çš„å¿ƒã€‹</td><td>åº·æ‹‰å¾·</td></tr><tr><td>ã€Šé¢„å…ˆè¢«èƒŒå›çš„é©å‘½ã€‹</td><td>å²©ä¸Šå®‰èº« ï¼ˆæ— ä¸­æ–‡ç‰ˆï¼‰</td></tr><tr><td>ã€Šå°‘æ•°æ´¾æŠ¥å‘Šã€‹</td><td>è²åˆ©æ™®Â·è¿ªå…‹</td></tr><tr><td>ã€Šæœºå™¨äººä¼šæ¢¦è§ç”µå­ç¾Šå—ã€‹</td><td>è²åˆ©æ™®Â·è¿ªå…‹</td></tr><tr><td>ã€Šç¥ç»æ¼«æ¸¸è€…ã€‹</td><td>å¨å»‰Â·å‰å¸ƒæ£®</td></tr><tr><td>ã€Šæå«æœºå¯†ã€‹</td><td>å¨å»‰Â·å‰å¸ƒæ£®</td></tr><tr><td>ã€Šæ ¼åˆ—ä½›æ¸¸è®°ã€‹</td><td>ä¹”çº³æ£®Â·æ–¯å¨å¤«ç‰¹</td></tr><tr><td>ã€Šè¿½å¿†ä¼¼æ°´å¹´åã€‹</td><td>é©¬å¡å°”Â·æ™®é²æ–¯ç‰¹</td></tr><tr><td>ã€Šå…‹è‹é²ç¥è¯ã€‹</td><td>æ´›å¤«å…‹æ‹‰å¤«ç‰¹</td></tr><tr><td>ã€Šå…‹è‹é²ç¥è¯IIã€‹</td><td>æ´›å¤«å…‹æ‹‰å¤«ç‰¹</td></tr><tr><td>ã€Šå†è§äº†ï¼Œç”µå½±ã€‹</td><td>å¯ºå±±ä¿®å¸</td></tr><tr><td>ã€Šå¹»æƒ³å›¾ä¹¦é¦†ã€‹</td><td>å¯ºå±±ä¿®å¸</td></tr><tr><td>ã€Šé“æ—æ ¼é›·çš„ç”»åƒã€‹</td><td>å¥¥æ–¯å¡Â·ç‹å°”å¾·</td></tr><tr><td>ã€Šé’¢çªŸã€‹</td><td>è‰¾è¨å…‹Â·é˜¿è¥¿è«å¤«</td></tr><tr><td>ã€Šå¯‚é™çš„æ˜¥å¤©ã€‹</td><td>è•¾åˆ‡å°”Â·å¡æ£®</td></tr><tr><td>ã€Šå¿æ‚”å½•ã€‹</td><td>è®©Â·é›…å…‹Â·å¢æ¢­</td></tr><tr><td>ã€Šç†æƒ³å›½ã€‹</td><td>æŸæ‹‰å›¾</td></tr><tr><td>ã€Šå’Œè°ã€‹</td><td>ä¼Šè—¤è®¡åˆ’</td></tr></tbody></table><p>å…¶ä¸­å¢æ¢­çš„ä¹¦ä¹Ÿæ˜¯æˆ‘çœ‹äº†è¿™éƒ¨å°è¯´ä¹‹åæ‰å¼€å§‹è¯»çš„ï¼Œè¿˜æœ‰ä¸€æœ¬æ˜¯ç¦æŸ¯çš„ã€Šè§„è®­ä¸æƒ©ç½šï¼šç›‘ç‹±çš„è¯ç”Ÿã€‹ï¼Œå‰©ä½™ä»·å€¼é‚£æœŸè¢«å°æ€çš„èŠ‚ç›®é‡Œç½—æ–°è€å¸ˆä¹Ÿæåˆ°è¿‡è¿™æœ¬ä¹¦ã€‚é©¬å…‹æ€Â·éŸ¦ä¼¯çš„ä¹¦åœ¨ã€Šä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶ã€‹ä¸­æåˆ°ä¸å°‘ï¼Œå°¤å…¶æ˜¯å…³äºå®˜åƒšæ”¿æ²»çš„ï¼Œè€Œä¸”é©¬å…‹æ€Â·éŸ¦ä¼¯è¿˜å’Œå‰æ–‡æåˆ°çš„è·¯å¾·ç»´å¸ŒÂ·å†¯Â·ç±³å¡æ–¯ä¹Ÿæ˜¯ä¸€å¯¹å­¦æœ¯ä¸Šçš„å¥½åŸºå‹ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/gp1upTv3IK" target="_blank" rel="noopener">å¿ƒé‡Œæµ‹é‡è€…</a></p><h3 id="æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨ä¸åæœ"><a href="#æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨ä¸åæœ" class="headerlink" title="æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨ä¸åæœ"></a>æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨ä¸åæœ</h3><p>è¿™æœ¬ä¹¦æ˜¯å¼ é›ªå¿ æ•™æˆå†™çš„ï¼Œå†™ä½œé£æ ¼å’Œå¼ åƒå¸†ã€è®¸ç« æ¶¦ã€å¼ ç»´è¿ä»–ä»¬ä¸€æ ·ã€‚æ¯”è¾ƒå–œæ¬¢è¿™æ ·çš„è€å¸ˆï¼Œå…³äºå¼ é›ªå¿ æ•™æˆï¼Œç»´åŸºç™¾ç§‘ä¸Šæœ‰ä¸€æ®µï¼š</p><blockquote><p>2013å¹´5æœˆï¼Œå¼ é›ªå¿ é¦–å…ˆåœ¨ç½‘ç»œå…¬å¼€ä¸€ä»½ä¸­å›½å®˜æ–¹çš„â€œ<a href="https://zh.wikipedia.org/wiki/ä¸ƒä¸è®²" target="_blank" rel="noopener">ä¸ƒä¸è®²</a>â€çš„å†…éƒ¨ææ–™çš„å†…å®¹ã€‚å…¶åå¾—åˆ°å…¶ä»–å­¦è€…å’Œæ•™æˆçš„è¯å®ã€‚â€œä¸ƒä¸è®²â€æ˜¯ä¸­å…±ä¸­å¤®åœ¨2013å¹´åœ¨æ„è¯†å½¢æ€é¢†åŸŸçš„æŒ‡ä»¤ï¼Œç¡®å®šä¸ƒä¸ªé¢†åŸŸä¸ºç¦åŒºï¼š<a href="https://zh.wikipedia.org/wiki/æ™®ä¸–ä»·å€¼" target="_blank" rel="noopener">æ™®ä¸–ä»·å€¼</a>ã€<a href="https://zh.wikipedia.org/wiki/æ–°é—»è‡ªç”±" target="_blank" rel="noopener">æ–°é—»è‡ªç”±</a>ã€<a href="https://zh.wikipedia.org/wiki/å…¬æ°‘ç¤¾ä¼š" target="_blank" rel="noopener">å…¬æ°‘ç¤¾ä¼š</a>ã€<a href="https://zh.wikipedia.org/wiki/å…¬æ°‘æƒåˆ©" target="_blank" rel="noopener">å…¬æ°‘æƒåˆ©</a>ã€ä¸­å›½å…±äº§å…šçš„å†å²é”™è¯¯ã€<a href="https://zh.wikipedia.org/wiki/æƒè´µèµ„äº§é˜¶çº§" target="_blank" rel="noopener">æƒè´µèµ„äº§é˜¶çº§</a>ã€<a href="https://zh.wikipedia.org/wiki/å¸æ³•ç¨ç«‹" target="_blank" rel="noopener">å¸æ³•ç‹¬ç«‹</a>ã€‚éšåâ€œä¸ƒä¸è®²â€æˆä¸ºç½‘ç»œç¦è¯ï¼Œå¼ çš„æ–°æµªå¾®åšå†æ¬¡è¢«åˆ å·ã€‚<a href="https://zh.wikipedia.org/wiki/å¼ é›ªå¿ #cite_note-rfa2-6" target="_blank" rel="noopener">[6]</a></p></blockquote><p>è¿™ä¸€ä»¶äº‹ä¸å¾—æŠ¥é“ã€é‚£ä¸€æœ¬ä¹¦ä¸å¾—å‡ºç‰ˆã€è¿™å¥è¯ä¸èƒ½è®²ï¼Œåˆ è´´å°å·ç­‰ï¼Œè¡¨é¢ä¸Šè¨€è®ºå®¡æŸ¥æ˜¯åœ¨ä¾µçŠ¯è¨€è®ºè‡ªç”±ï¼Œä½†å®è´¨ä¸Šå´æ˜¯åœ¨è´¬ä½å…¨ä½“å›½æ°‘çš„äººæ ¼å’Œå°Šä¸¥ã€‚è¨€è®ºå®¡æŸ¥å®Œå…¨æ˜¯åœ¨å‘å…¨ä½“å›½æ°‘å®£å‘Šï¼šâ€œä½ ä»¬è¿™å¸®å±æ°‘æ ¹æœ¬å°±æ²¡æœ‰èµ„æ ¼äº†è§£è¿™ä»¶äº‹æƒ…çš„çœŸç›¸ï¼Œä¹Ÿæ²¡æœ‰èµ„æ ¼å»æ€è€ƒå’Œè¾¨åˆ«ä¿¡æ¯çš„çœŸå‡ã€‚â€ï¼Œä»·å€¼åˆ¤æ–­çš„æ ‡å‡†ç”±çœŸç†éƒ¨è¯´äº†ç®—ã€‚ä¸€ä¸ªäººä¸ä¸€å¤´çŒªçš„æœ€å¤§åŒºåˆ«ï¼Œå°±åœ¨äºäººå…·æœ‰çŒªæ‰€æ²¡æœ‰çš„ç†æ™ºï¼Œè€Œè¨€è®ºå®¡æŸ¥æ°æ°æ˜¯åœ¨å‰¥å¤ºäººä»¬è‡ªç”±è¿ç”¨ç†æ™ºçš„èµ„æ ¼ï¼Œä¹Ÿå°±æ˜¯å°½é‡ç¼©å°äººä¸çŒªä¹‹é—´çš„å·®åˆ«ã€‚ä¸“åˆ¶ç»Ÿæ²»è€…ç¡®å®å¸Œæœ›å›½æ°‘å¿˜è®°è‡ªå·±æ˜¯æœ‰ç†æ™ºçš„åŠ¨ç‰©ï¼Œå¹¶èƒ½åƒçŒªä¸€æ ·å®¹æ˜“æ»¡è¶³ï¼Œåªéœ€æœ‰è¶³ä»¥æœè…¹çš„é£Ÿç‰©ï¼Œå°±ä¼šå¯¹ç»Ÿæ²»è€…æ„Ÿæ©æˆ´å¾·ã€‚</p><blockquote><p>å…¨ä½“å›½æ°‘ä½œä¸ºä¸»æƒè€…ç»„å»ºæ”¿åºœå¹¶é€‰ä»»æ‰§æ”¿è€…ï¼Œæœ¬æ˜¯ä¸ºäº†æ›´å¥½åœ°ä¿æŠ¤è‡ªå·±çš„ç”Ÿå‘½ã€è´¢äº§å’Œè‡ªç”±ã€‚æ”¿åºœçš„ç›®çš„å’Œæ‰§æ”¿è€…çš„ä½¿å‘½ï¼Œæ˜¯ä¿æŠ¤ä¸»æƒè€…æœ¬æ¥å°±äº«æœ‰çš„æƒåˆ©å’Œè‡ªç”±ï¼Œè€Œä¸æ˜¯èµäºˆä¸»æƒè€…æœ¬æ¥ä¸äº«æœ‰çš„æƒåˆ©å’Œè‡ªç”±ã€‚æ‰§æ”¿è€…è®¤ä¸ºå›½æ°‘çš„æƒåˆ©å’Œè¿½æ±‚å¹¸ç¦çš„æœºä¼šï¼Œæ˜¯æºäºè‡ªå·±çš„èµèµï¼Œå°±åƒå­å¥³è®¤ä¸ºçˆ¶æ¯çš„å­˜åœ¨æ˜¯å‡ºäºè‡ªå·±çš„æ„å¿—ä¸€æ ·è’è°¬å’Œæ‚–ç†ã€‚</p></blockquote><p>æ­¤æ¬¡ç–«æƒ…è¿˜å°šæœªç»“æŸï¼Œæ­ŒåŠŸèµå¾·çš„å·è§’å·²ç»å¹å“äº†ï¼Œå‘µå‘µï¼ŒçœŸä»–å¦ˆå¯ç¬‘ã€‚æ‰€ä»¥ï¼Œä¸ºä»€ä¹ˆæœ‰ä¸ªå°å­¦ç”Ÿåœ¨ç»™æ–¹èˆ±åŒ»é™¢å”±èµæ­Œï¼Œä¹Ÿå°±ä¸éš¾ç†è§£äº†ğŸ˜‚</p><blockquote><p><strong>å‰©ä½™ä»·å€¼ï¼š</strong> ææµ·é¹ä¹‹å‰å‘äº†ä¸€æ¡å¾®åšï¼Œå¤§æ¦‚æ˜¯è¯´ï¼Œä¸€ä¸ªä¸¾å›½ä½“åˆ¶çš„éšæ‚£åˆ°æœ€åå¯èƒ½åˆä¼šå˜æˆä¸€ä¸ªä¸¾å›½ä½“åˆ¶çš„èƒœåˆ©ã€‚<br><strong>ç½—æ–°ï¼š</strong>å†å²å­¦è€…è®¤ä¸ºï¼Œåœ¨è¥¿æ–¹ï¼Œä½ çœ‹åˆ°æ‰€æœ‰çš„æˆ˜äº‰ã€ç¾éš¾æ€§çš„é©å‘½æˆ–è€…æ˜¯ä½“åˆ¶æ€§çš„å´©æºƒï¼Œå…¶åæœå¯èƒ½æ˜¯å¼•èµ·äº†ä¸€æ³¢æ–°çš„å†å²ä¸Šå‡æœŸã€‚æ¯”å¦‚ç¾å›½åœ¨ç»æµå¤§è§æ¡ä¹‹åï¼Œç»æµåè€Œæœ‰æ‰€å›å‡ï¼Œåè€Œå¼€é€šäº†ä¸€æ¡å‘ä¸Šçˆ¬çš„æ–°çš„é“è·¯ã€‚ä½†æ˜¯ç ”ç©¶è€…ä¹Ÿå‘ç°ï¼Œåœ¨ä¸œæ–¹ä¸ä¸€å®šæ˜¯è¿™æ ·ï¼Œç¾éš¾ä¹‹åå¯èƒ½æ˜¯æ›´å¤§çš„ç¾éš¾ï¼Œæ›´å¤§çš„ç¾éš¾åé¢è¿˜æœ‰æ›´å¤§çš„ç¾éš¾ï¼Œå¼•å‘ç¾éš¾çš„é‚£äº›å› ç´ ä¸ä»…å¾—ä¸åˆ°ä¿®æ­£ï¼Œè¿˜å¾—åˆ°äº†åŠ å¼ºåŒ–ã€‚è¿™æ˜¯æˆ‘ä»¬è¦æ³¨æ„çš„ã€‚äººä»¬è¯´ï¼Œéƒ½å‘ç”Ÿäº†è¿™ä¹ˆå¤§çš„äº‹ï¼Œæˆ‘ä»¬è¯¥ä¸è¯¥åæ€äº†ï¼Ÿè¦å°å¿ƒï¼Œå¯èƒ½æ²¡æœ‰åæ€ï¼Œå¯èƒ½æ˜¯å¼ºåŒ–ã€‚</p></blockquote><p>åˆ°ç°åœ¨æ²¡æœ‰äº†è¿½ç©¶é—®è´£ï¼Œå°±è¿è¿›é©»æ­¦æ±‰å¯¹ææ–‡äº®åŒ»ç”Ÿäº‹ä»¶çš„è°ƒæŸ¥ç»“æœä¹Ÿæ˜¯ä¸€çº¸ç©ºæ–‡è‹ç™½æ— åŠ›ï¼Œç”šè‡³é‚£äº›çºªå¿µææ–‡äº®åŒ»ç”Ÿçš„äººä¹Ÿè¢«å–èŒ¶é—®å€™ã€‚ç›®å‰å­˜åœ¨çš„ä¹Ÿåªæœ‰åƒã€Šå¤§å›½æˆ˜ç–«ã€‹è¿™æ ·å¯¹æƒè´µæ­ŒåŠŸèµå¾·çš„å£°éŸ³ï¼Œå¯¹ç¾å¸å›½ä¸»ä¹‰çš„æ•Œå¿¾åŒä»‡â€¦â€¦å”‰ï¼Œä¸€åœºç¾éš¾å˜æˆäº†ä¸€åœºä¸¾å›½ä½“åˆ¶çš„èƒœåˆ©ï¼Œæ˜¯æˆ‘ä»¬çš„æ‚²å“€ä¹Ÿæ˜¯å…¨ä¸–ç•Œçš„æ‚²å“€ã€‚</p><p>æƒ³èµ·äº† ã€Š1984ã€‹ é‡Œçš„ä¸€æ®µè¯ï¼Œæˆ–è®¸ç”¨ææƒä¸»ä¹‰æ¥è§£é‡Šå½“ä¸‹æœ€é€‚åˆä¸è¿‡äº†ï¼š<strong>ææƒæœ€æœ‰æ•ˆçš„ç»Ÿæ²»æœ¯æ˜¯ä»‡æ¨æ•™è‚²ï¼Œå¡‘é€ ä¸€ä¸ªè¿œåœ¨å¤©è¾¹çš„å¤–åœ¨æ•Œäººï¼Œäººä»¬å°±ä¼šå¿˜è®°èº«è¾¹çš„ç—›è‹¦ã€‚</strong></p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/1vyK1t0NMr" target="_blank" rel="noopener">æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨ä¸åæœ</a></p><h3 id="åœ°çƒè„‰åŠ¨ï¼šå‰æ‰€æœªè§çš„è‡ªç„¶ä¹‹ç¾"><a href="#åœ°çƒè„‰åŠ¨ï¼šå‰æ‰€æœªè§çš„è‡ªç„¶ä¹‹ç¾" class="headerlink" title="åœ°çƒè„‰åŠ¨ï¼šå‰æ‰€æœªè§çš„è‡ªç„¶ä¹‹ç¾"></a>åœ°çƒè„‰åŠ¨ï¼šå‰æ‰€æœªè§çš„è‡ªç„¶ä¹‹ç¾</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_01_17T08_00_05+0800.png" alt="img"></p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/gjRzZG1OqC" target="_blank" rel="noopener">åœ°çƒè„‰åŠ¨ï¼šå‰æ‰€æœªè§çš„è‡ªç„¶ä¹‹ç¾</a></p><h3 id="ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹"><a href="#ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹" class="headerlink" title="ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹"></a>ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_01_23T08_56_10+0800.png" alt="img"></p><p>æŒ‰ç…§å¢æ¢­çš„ç¬¬ä¸€ç¯‡è®ºæ–‡ã€Šè®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´ã€‹å’Œç¬¬äºŒç¯‡è®ºæ–‡ã€Šè®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€ ã€‹çš„åˆ†æï¼Œäººæœ¬æ¥æ˜¯çº¯æœ´å–„è‰¯çš„ï¼Œç”±äºæœ‰ç¼ºé™·çš„ç¤¾ä¼šåˆ¶åº¦ï¼Œç”Ÿæ´»äºç¤¾ä¼šä¸­çš„äººæ‰å˜åï¼Œå¹¶å •å…¥ç½ªæ¶çš„æ·±æ¸Šã€‚ç”±æ–‡æ˜å¼•å‘çš„é—®é¢˜å¿…é¡»é€šè¿‡æ–°çš„æ”¿æ²»ç»„ç»‡å½¢å¼æ¥åŠ ä»¥å…‹æœã€‚ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹è¦åšçš„å·¥ä½œæ˜¯ï¼Œé€šè¿‡å»ºç«‹ä¸€ä¸ªå¥å…¨çš„ç¤¾ä¼šæ”¿æ²»åˆ¶åº¦ï¼Œå¸®åŠ©äººä»¬æ¢å¤è‡ªç„¶è‰¯å–„ï¼ˆnatural goodnessï¼‰ã€‚</p><p>ä»€ä¹ˆæ ·çš„ç¤¾ä¼šæ”¿æ²»åˆ¶åº¦æ‰æ˜¯å¥å…¨çš„å‘¢ï¼Ÿè¿™å°±è¦è¿½é—®ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜ï¼šæ­£ä¹‰ä¸åˆæ³•çš„æ”¿æ²»ç§©åºåŠå…¶åŸºç¡€æ˜¯ä»€ä¹ˆï¼Ÿã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹æ‰€æœ‰å…¶ä»–çš„é—®é¢˜å‡æ˜¯ä»è¿™é‡Œç”Ÿå‘å‡ºæ¥ï¼Œå¹¶ä¸ä¹‹å…³è”åœ¨ä¸€èµ·çš„ã€‚ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹å…±æœ‰å››å·ï¼Œç¬¬ä¸€å·è®¨è®ºçš„æ˜¯åˆæ³•çš„æ”¿æ²»ç§©åºçš„åŸºç¡€ï¼›ç¬¬äºŒå·è®¨è®ºçš„ä¸»é¢˜æ˜¯æ³•å¾‹å’Œç«‹æ³•ï¼›ç¬¬ä¸‰å·çš„ä¸»é¢˜æ˜¯æ™®éæ„å¿—è¿ç”¨äºç‰¹å®šæƒ…å½¢å³æ”¿åºœçš„æœºåˆ¶ï¼›ç¬¬å››å·ï¼Œè¿™ä¸€å·ä»¥å¯¹ç½—é©¬çš„æ”¿æ²»åˆ¶åº¦çš„æè¿°ä¸ºæ ¸å¿ƒå†…å®¹ï¼Œä»¥æ­¤æ¥æ¢è®¨æ”¿æ²»å…±åŒä½“çš„å‡èšåŠ›é—®é¢˜ï¼Œæœ€åä»¥å…¬æ°‘å®—æ•™ç»“æŸå…¨ä¹¦ã€‚</p><p>ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯<strong>åˆæ³•çš„å›½å®¶å¿…é¡»æ ¹æ®æ™®éæ„å¿—æ¥è¿›è¡Œç®¡ç†ï¼Œå³å·²æå‡º</strong>ã€‚ã€Šçˆ±å¼¥å„¿ã€‹èƒŒåçš„ä¸€ä¸ªåŸºæœ¬é¢„è®¾æ˜¯ï¼šæ²¡æœ‰æ–‡åŒ–åšæ”¯æ’‘ï¼Œåˆ¶åº¦æ˜¯æ²¡æœ‰åŠæ³•æœ‰æ•ˆè¿è¡Œçš„ã€‚å› æ­¤ï¼Œæœ€é‡è¦çš„ä»»åŠ¡æ˜¯ï¼šé€šè¿‡æ•™è‚²ï¼Œå°†â€œäººâ€è½¬å˜ä¸ºâ€œå…¬æ°‘â€ï¼Œåƒçˆ±å¼¥å„¿ä¸€æ ·çš„å…¬æ°‘ã€‚å”¯å…¶å¦‚æ­¤ï¼Œæ™®éæ„å¿—æ‰æœ‰å¯èƒ½ï¼Œæ­£ä¹‰è€Œåˆæ³•çš„æ”¿æ²»ç§©åºæ‰æœ‰å¯èƒ½ã€‚</p><p>æ‰€ä»¥å¢æ¢­çš„è¿™å‡ æœ¬ä¹¦è¿è´¯æ€§å¾ˆå¼ºï¼Œæ¨èéƒ½è¯»å®Œæ‰èƒ½ç†è§£å¢æ¢­çš„æ”¿æ²»å“²å­¦æ€æƒ³ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://kindle.502.li/" target="_blank" rel="noopener">ç¤¾ä¼šå¥‘çº¦è®º</a></p><h3 id="ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶"><a href="#ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶" class="headerlink" title="ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶"></a>ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_01_27T22_54_06+0800.png" alt="img"></p><p>è¿™æœ¬ä¹¦æ˜¯æ˜¥èŠ‚çš„æ—¶å€™åœ¨å®¶è¯»å®Œçš„ï¼Œè¾ƒä¹‹äºå¼ é›ªå¿ æ•™æˆçš„ã€Šæ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨å’Œåæœã€‹ï¼Œå‘¨é›ªå…‰ä»ç»„ç»‡å­¦è§’åº¦æ¥è¿›è¡Œåˆ†æä¸­å…±å›½å®¶æ²»ç†å¾—é€»è¾‘ã€‚å¯¹äºè¿™æ¬¡å¾—ç–«æƒ…æ¥è®²ï¼Œå†ä¸€æ¬¡å°è¯äº†ä¹¦ä¸­æ‰€é˜é‡Šçš„å†…å®¹ã€‚<strong>å³ä¸€ç»Ÿä½“åˆ¶ä¸æœ‰æ•ˆæ²»ç†ï¼šä¸­å›½å›½å®¶æ²»ç†çš„ä¸€ä¸ªæ·±åˆ»çŸ›ç›¾</strong>ã€‚ä¸åšè¿‡å¤šè¯„è®ºï¼Œæ­¤ä¹¦å¦‚åŒæ¨ç‰¹ä¸Šçš„ä¸€äº›äººæ¨èä¸€æ ·ï¼Œå¾ˆé€‚åˆå½“ä¸‹å»çœ‹çœ‹ï¼Œå»åˆ†æä¸€ä¸‹è¿™ä¸ªå®˜åƒšä½“åˆ¶æ˜¯å¤šä¹ˆåœ°è…è´¥å’Œæ— èƒ½ã€‚å°±å¦‚ã€Šå¿ƒç†æµ‹é‡è€…ã€‹ä¸­æ‰€è¯´çš„ï¼Œ<strong>æˆ‘ä»¬å§‹ç»ˆæ‰¿æ‹…ç€æ”¿åºœå¼ºåŠ ç»™æˆ‘ä»¬çš„é£é™©</strong>ï¼Œè¿™æ˜¯æƒåŠ›é›†ä¸­åŒ–çš„å¿…ç„¶ç»“æœã€‚é‚£äº›å·²ç»é›†ä¸­èµ·æ¥çš„æƒåŠ›ç»å¯¹ä¸ä¼šå› ä¸ºä»–ç¾å¥½çš„æ„¿æ™¯è€Œå˜å¾—æ— å®³ã€‚é‚£äº›æ­»åœ¨æ­¦æ±‰è‚ºç‚ç—…æ¯’ä¹‹å¤–çš„äººä¸æ­£æ˜¯æˆ‘ä»¬æ¯ä¸ªäººéƒ½è¦æ‰¿æ‹…çš„é£é™©å—ï¼Ÿ</p><p>åœ¨ä¸“åˆ¶å›½å®¶ï¼ŒæƒåŠ›ä¸å—çº¦æŸçš„ç»Ÿæ²»è€…ï¼Œæ˜¯æ™®éçš„æ”¿åºœè…è´¥å’Œå„ç§ç¤¾ä¼šé—®é¢˜çš„æ ¹ç”±ï¼Œä¹Ÿæ˜¯äººç±»æ–‡æ˜ç¤¾ä¼šæœ€å¤§çš„<code>ç—…æ¯’</code> ã€‚ä¹Ÿæ­£æ˜¯æ­£æ˜¯è¿™ä¸ªè…è´¥æ— èƒ½çš„å®˜åƒšä½“åˆ¶æ¬ºä¸Šç’ä¸‹ã€åˆ å¸–å°å·ã€ç»´ç¨³æŠ“äººã€å°æ€è¨€è®ºã€æ‹˜ç•™è®°è€…ã€æŠ“æ•å¾‹å¸ˆã€é€ è°£å¼è¾Ÿè°£ç­‰ç­‰ä½œæ¶è¡Œä¸ºæ‰å¯¼è‡´çš„å…¨çƒç–«æƒ…å¤§çˆ†å‘ã€‚å…¶å®è¿™äº›æ—¶åˆ»ä¼´éšç€æˆ‘ä»¬ï¼Œåªä¸è¿‡æ˜¯è¿™æ¬¡çš„ç—…æ¯’å°†è¿™ä¸ªä½“åˆ¶çš„ä¸€ä¸ªé˜´æš—é¢æ­éœ²äº†å‡ºæ¥è€Œå·²ï¼Œå®ƒè…çƒ‚åˆ°æ ¹é‡Œå·²ç»å¾ˆä¹…å¾ˆä¹…â€¦â€¦</p><p>åœ¨ææƒä¸»ä¹‰ä½“åˆ¶ä¸‹ï¼Œå›½å®¶ä¸€æ–¹é¢ç”¨æ„è¯†å½¢æ€è›Šæƒ‘å’Œéº»é†‰äººæ°‘ï¼Œå¦ä¸€æ–¹é¢åˆç”¨åˆ©ç”¨å›½å®¶æœºå™¨é™åˆ¶ç¤¾ä¼šå†…éƒ¨çš„ç›´æ¥äº¤å¾€ï¼Œä½¿ä¹‹ä¿æŒæœ‰åˆ©äºå›½å®¶æ§åˆ¶çš„â€œåŸå­åŒ–â€çŠ¶æ€ã€‚åŸºäºå›½å®¶çš„ç»å¯¹æƒåŠ›å’Œæ•´ä¸ªç¤¾ä¼šçš„éç»“æ„åŒ–ï¼Œå›½å®¶èƒ½å¤Ÿæ ¹æ®è‡ªå·±çš„æ„å¿—å‘èµ·ä»»ä½•è¡ŒåŠ¨ï¼ŒåŒ…æ‹¬æ”¿æ²»æˆ–ç¤¾ä¼šè¿åŠ¨ã€‚è¿™æ¬¡çš„<code>ç–«æƒ…é˜²å«æˆ˜ç–«</code>ä¸å°±æ˜¯è¿™ä¸ªå®˜åƒšä½“åˆ¶å‘èµ·çš„æ”¿æ²»è¿åŠ¨å˜›ï¼Ÿæ„ŸæŸ“æ­»äº¡äººæ•°ä½œå‡ï¼Œå…¬ä¿¡åŠ›ä¸æ–­åœ°ä¸§å¤±ã€‚ä½ èƒ½åœ¨è¿™æœ¬ä¹¦é‡Œæ‰¾åˆ°å¾ˆå¥½çš„è§£é‡Šï¼Œä¹¦ä¸­ä¹Ÿæåˆ°è¿‡ä¸Šçº§æ¥è§†å¯Ÿçš„æ—¶å€™ï¼Œåœ°æ–¹æ”¿åºœå¦‚ä½•å¿½æ‚ ä¸­å¤®ï¼Œä»¥åŠå„ç§æƒåˆ©å…³ç³»ä¹‹é—´å¦‚ä½•å…±è°‹è¾¾åˆ°<strong>ä¸Šæœ‰æ”¿ç­–ä¸‹æœ‰å¯¹ç­–çš„</strong>ã€‚</p><p>ã€å¡ç†æ–¯ç›æƒå¨çš„æ ¸å¿ƒæ˜¯ï¼Œé¢†è¢–ä»¥å…¶è¶…å‡¡ç¦€èµ‹è€Œå¾—åˆ°è¿½éšè€…çš„æ‹¥æˆ´å’Œæœä»ï¼›è€Œé¢†è¢–åˆ™é€šè¿‡ä¸æ–­åœ°åˆ›é€ â€œå¥‡è¿¹â€æ¥æ˜¾ç¤ºå…¶è¶…å‡¡ç¦€èµ‹ï¼Œä»¥å»¶ç»­å’Œå¼ºåŒ–è¿™ä¸€åˆæ³•æ€§åŸºç¡€ã€‚ åœ¨ç»è¿‡äº†æˆ˜äº‰åŠ¨è¡ï¼Œæ°‘ç”Ÿå‡‹æ•ï¼Œä¸§æƒè¾±å›½çš„æ°‘æ—å±æœºä¹‹åï¼Œä¸­å›½å¤§åœ°æœ‰æœŸå†€å¥‡è¿¹ã€å´‡å°šä¼Ÿäººçš„å¡ç†æ–¯ç›æƒå¨çš„è‚¥æ²ƒåœŸå£¤ã€‚ã€</p><p>ã€ä»»ä½•æŒ‘æˆ˜å¡ç†æ–¯ç›æƒå¨çš„è¯è¯­éƒ½ä¼šå¼±åŒ–ç”šè‡³ç“¦è§£å…¶åˆæ³•æ€§åŸºç¡€ï¼Œå› æ­¤è¯è¯­å„æ–­æƒæ˜¯ç»´ç³»å¡ç†æ–¯ç›æƒå¨çš„å…³é”®æ‰€åœ¨ã€‚å»ºå›½ä»¥åï¼Œå›½å®¶é€æ­¥é€šè¿‡å®˜åƒšä½“åˆ¶ä»‹å…¥ã€æ§åˆ¶ä»¥è‡³å„æ–­æ„è¯†å½¢æ€ç›¸å…³çš„é¢†åŸŸï¼Œæœ‰æ•ˆåœ°æœç»äº†è´¨ç–‘æˆ–æŒ‘æˆ˜å¡ç†æ–¯ç›æƒå¨çš„æ½œåœ¨å¯èƒ½æ€§ã€ è¿™ä¹Ÿæ˜¯è¨€è®ºå®¡æŸ¥çš„æ ¹æœ¬åŸå› å§ï¼Œç»´æŠ¤ç»Ÿæ²»è€…çš„æƒåŠ›åˆæ³•æ€§ã€‚</p><p>åœ¨æ”¿æ²»è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸éš¾çœ‹åˆ°åœ°æ–¹æ”¿åºœçš„å„ç§åšæ³•ï¼ˆå¦‚åœ¨æ‹†è¿ã€ä¸¥æ‰“ã€åŸç®¡ã€ä¿¡è®¿ç­‰ç­‰è¿‡ç¨‹ä¸­çš„å…·ä½“æ‰€ä¸ºï¼‰å¸¸å¸¸ä¸æ³•å¾‹æ¡æ–‡ç›¸æ‚–ã€‚åœ°æ–¹æ”¿åºœçš„è¿™äº›åšæ³•åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå¢å¼ºäº†åŸºå±‚æ”¿åºœè§£å†³å®é™…é—®é¢˜çš„èƒ½åŠ›ï¼Œä½†ä¸æ­¤åŒæ—¶ï¼Œå®ƒä»¬ä¸æ–­åœ°ä¾µèš€å¼±åŒ–æ³•æ²»åŸºç¡€å’Œæ³•ç†è§‚å¿µã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/tl1mmh7z3t" target="_blank" rel="noopener">ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶</a></p><h3 id="ç—…æ¯’æ˜Ÿçƒ"><a href="#ç—…æ¯’æ˜Ÿçƒ" class="headerlink" title="ç—…æ¯’æ˜Ÿçƒ"></a>ç—…æ¯’æ˜Ÿçƒ</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_01_28T22_03_02+0800.png" alt="img"></p><p>æä¸ºç®€çŸ­çš„ä¸€æœ¬ç§‘æ™®ï¼Œå¤§æ¦‚ç”¨äº†ä¸¤ä¸ªå°æ—¶çš„æ—¶é—´å°±è¯»å®Œäº†ã€‚ä¸»è¦ç§‘æ™®äº†ä¸€ä¸‹ç—…çš„æ€§è´¨ä»¥åŠå…¥ä¾µäººä½“ç»†èƒçš„æœºç†ç­‰ã€‚æ„Ÿè§‰è¯»èµ·æ¥æµ·æ˜Ÿå§ï¼Œæ²¡æœ‰å¤ªå¤šç²¾å½©çš„åœ°æ–¹ï¼Œå°±åƒå›é¡¾äº†ä¸€ä¸‹é«˜ä¸­ç”Ÿç‰©å­¦ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/Op5GTfaOch" target="_blank" rel="noopener">ç—…æ¯’æ˜Ÿçƒ</a></p><h3 id="ç—…æ¯’æ¥è¢­"><a href="#ç—…æ¯’æ¥è¢­" class="headerlink" title="ç—…æ¯’æ¥è¢­"></a>ç—…æ¯’æ¥è¢­</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_01_28T22_03_47+0800.png" alt="img"></p><p>æ„Ÿè§‰æ²¡ã€Šç—…æ¯’æ˜Ÿçƒã€‹è¦å¥½ä¸€äº›ï¼Œæ€»ä¹‹æ¨èå‰ä¸€æœ¬ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/kfTZIY7Zt0" target="_blank" rel="noopener">ç—…æ¯’æ¥è¢­</a></p><h3 id="è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹"><a href="#è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹" class="headerlink" title="è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹"></a>è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_01_28T22_02_45+0800.png" alt="img"></p><p>çœ‹å®Œäº†çºªå½•ç‰‡ï¼Œä¹¦ç±å°±çœ‹äº† 20% ï¼Œæ¨èå…ˆçœ‹å®Œä¹¦å†å»çœ‹çºªå½•ç‰‡ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://kindle.502.li/" target="_blank" rel="noopener">è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹</a></p><h3 id="è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½"><a href="#è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½" class="headerlink" title="è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½"></a>è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_02_05T20_28_57+0800.png" alt="img"></p><p>è¿™æœ¬ä¹¦ä¸»è¦è®²äº†æ¤ç‰©çš„èµ·æºã€å…‰åˆä½œç”¨ã€å¶ç»¿ä½“ã€å­¢å­ç”Ÿæ®–ä»¥åŠä¸€äº›è¿œå¤æ—¶æœŸçš„ç”Ÿæ€ç¯å¢ƒç­‰ã€‚æ€»ä¹‹å¯¹äºå’±è¿™ç§å¯¹å¤ç”Ÿç‰©å­¦æ„Ÿå…´è¶£çš„æ¥è¯´ç®—æ˜¯ä¸€é¡¿ç§‘æ™®ç››å®´ï¼Œå­¦åˆ°å¾ˆå¤šçŸ¥è¯†è€¶ï¼Œæå¤§å¾—æ»¡è¶³äº†å’±çš„å¥½å¥‡å¿ƒğŸ˜‚ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/5KOfa96qlr" target="_blank" rel="noopener">è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½</a></p><h3 id="å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹"><a href="#å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹" class="headerlink" title="å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹"></a>å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_02_06T13_52_57+0800.png" alt="img"></p><p>è¯¾æœ¬æ•™æï¼Œæ¯ç‡¥ã€åªæ˜¯äº†è§£äº†ä¸€ä¸‹åŸºæœ¬çš„æ¦‚å¿µï¼Œæ„Ÿè§‰æˆ‘ä¸é€‚åˆè¯»è¿™ç§æ¯ç‡¥çš„è¯¾æœ¬(ï¿£â–½ï¿£)â€</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/G6oMMnAAji" target="_blank" rel="noopener">å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹</a></p><h3 id="æœ±é’¦å£«çš„ä¸ªäººåšå®¢"><a href="#æœ±é’¦å£«çš„ä¸ªäººåšå®¢" class="headerlink" title="æœ±é’¦å£«çš„ä¸ªäººåšå®¢"></a>æœ±é’¦å£«çš„ä¸ªäººåšå®¢</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_02_17T23_10_27+0800.png" alt="img"></p><p>è¿™å¹¶ä¸æ˜¯ä¸€æœ¬ä¹¦ï¼Œè€Œæ˜¯æˆ‘åœ¨ <a href="http://blog.sciencenet.cn/home.php?mod=space&uid=582158" target="_blank" rel="noopener">æœ±é’¦å£« </a>åšå£«çš„ä¸ªäººåšå®¢ä¸Šå¤åˆ¶ä¸‹æ¥æ•´ç†æˆçš„ç”µå­ä¹¦ï¼Œåœ¨ kindle ä¸Šè¯»èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ã€‚å¯¹äºåªå…·å¤‡é«˜ä¸­ç”Ÿç‰©çŸ¥è¯†å¾—å’±æ¥è¯´ï¼Œè¯»èµ·æœ±é™¢å£«å†™çš„æ–‡ç« è¿˜æ˜¯æœ‰äº›åƒåŠ›çš„ï¼Œæ„Ÿè§‰è¿™åŸºæœ¬ä¸Šå°±æ˜¯è®ºæ–‡çš„æ³¨é‡Šç‰ˆã€‚é‡Œé¢çš„ä¸€äº›å­¦æœ¯ç”¨è¯­æœ‰å¾ˆå¤šéƒ½ä¸æ‡‚ï¼Œåªèƒ½è‡ªå·±æœç´¢äº†è§£ä¸€ä¸‹ã€‚è®²åˆ°äº†çœŸæ ¸ç”Ÿç‰©çš„èµ·æºï¼Œä»¥åŠåŠ¨ç‰©ç»†èƒå’Œæ¤ç‰©ç»†èƒçš„èµ·æºã€‚å’±ä»¬äººç±»ï¼ˆåŠ¨ç‰©ï¼‰æ˜¯ä»å•é­æ¯›çš„åŸç”Ÿç”Ÿç‰©é¢†é­æ¯›è™«ï¼ˆChoanoflagellateï¼‰æ¼”åŒ–è€Œæ¥ï¼Œè€Œæ¤ç‰©åˆ™ç”±åŒé­æ¯›åŸç”Ÿç”Ÿç‰©ä¸­çš„åŒæ˜Ÿè—»ï¼ˆZygmematalesï¼‰æ¼”åŒ–è€Œæ¥ï¼ŒåŸæ¥å’±çš„ç¥–å…ˆæ˜¯åªé­æ¯›è™«ğŸ˜‚ï¼Ÿ</p><p>çœŸæ ¸ç»†èƒæ˜¯æ€æ ·å½¢æˆçš„å‘¢ï¼Œæœ±é™¢å£«è§£é‡Šä¸ºï¼šçœŸæ ¸ç»†èƒæ˜¯å…ˆè·å¾—çº¿ç²’ä½“ï¼Œå†å‘å±•å‡ºç»†èƒæ ¸ã€‚çº¿ç²’ä½“çš„å‡ºç°ç»™çœŸæ ¸ç”Ÿç‰©å¸¦æ¥å……è¶³èƒ½æºçš„åŒæ—¶ï¼Œä¹Ÿå¸¦æ¥äº†å†…å«å­çš„å…¥ä¾µã€‚ä¸ºè›‹ç™½è´¨ç¼–ç çš„åŸºå› ä¸­å†…å«å­çš„å‡ºç°ï¼Œåˆè¿«ä½¿ç»†èƒå½¢æˆç»†èƒæ ¸ä»¥æŠŠDNAå’Œæ ¸ç³–ä½“åˆ†éš”å¼€æ¥ã€‚è¿™å¤§æ¦‚å°±æ˜¯çœŸæ ¸ç»†èƒå‡ºç°çš„æ ¹æœ¬åŸå› ã€‚å…¶å®ƒçš„æ”¹å˜éƒ½æ˜¯åœ¨è¿™ä¸ªåŸºç¡€ä¸Šè¿›è¡Œçš„ã€‚è½¬å½•å’Œè›‹ç™½è´¨åˆæˆå¿…é¡»åœ¨ç©ºé—´ä¸Šåˆ†å¼€ï¼Œè€Œè¿™æ­£æ˜¯ç»†èƒæ ¸çš„ä½œç”¨ã€‚ç»†èƒæ ¸çš„è†œèƒ½å¤Ÿé˜²æ­¢å®Œæ•´çš„æ ¸ç³–ä½“è¿›å…¥ç»†èƒï¼Œè€ŒmRNAåœ¨å‰ªæ¥å®Œæˆå‰ï¼Œåˆä¸ä¼šç¦»å¼€ç»†èƒæ ¸ï¼Œè¿™æ ·æ ¸ç³–ä½“èƒ½å¤Ÿæ¥è§¦çš„ï¼Œå°±åªèƒ½æ˜¯åŠ å·¥å®Œæ¯•çš„ mRNAã€‚</p><p>æ€»ä¹‹å¯¹äºç”Ÿå‘½ç§‘å­¦æ„Ÿå…´è¶£çš„å¯ä»¥å»è¯»è¯»æœ±é™¢å£«çš„åšå®¢ï¼Œå¦‚æœæ±æƒ³è¦å’±åˆ¶ä½œå¥½çš„ç”µå­ä¹¦ç§ä¿¡å’±å³å¯ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/50HX5FvBPk" target="_blank" rel="noopener">æœ±é’¦å£«çš„ä¸ªäººåšå®¢</a></p><h3 id="ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥"><a href="#ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥" class="headerlink" title="ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥"></a>ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_02_07T11_54_34+0800.png" alt="img"></p><p>è¯»å®Œäº†æœ±é™¢å£«çš„åšå®¢ä¸Šçš„æ–‡ç« ï¼Œå°±åƒæ‰“å¼€äº†æˆ‘çš„å¥½å¥‡å¿ƒæ½˜å¤šæ‹‰é­”ç›’ï¼Œè¶Šæ¥è¶ŠåƒçŸ¥é“å…³äºç”Ÿå‘½ç§‘å­¦çš„çŸ¥è¯†ï¼Œå°±åœ¨ Amazon ä¸Šæœäº†ä¸€ä¸‹ä»–çš„ä¹¦ï¼Œè¿˜çœŸçš„æœ‰ä¸€æœ¬ï¼Œå°± get åˆ°å•¦ã€‚</p><blockquote><p>è¿™æ˜¯ä¸€æœ¬ä»åˆ†å­ç»†èƒå°ºåº¦ä¸Šè®²è§£ç”Ÿå‘½å¥¥ç§˜çš„ç§‘æ™®å°ä¹¦ã€‚ç”¨å¹³å®æµ…æ˜¾çš„è¯­è¨€è§£é‡Šäº†å¤æ‚ç”Ÿå‘½ç³»ç»Ÿçš„ä¸€äº›åŸºæœ¬çŸ¥è¯†ã€‚ è®©æˆ‘äº†è§£äº†äººä½“æ˜¯ç”±60ä¸‡äº¿ä¸ªç»†èƒç»„æˆçš„å¤æ‚ç³»ç»Ÿï¼Œè›‹ç™½è´¨å¯¹ç”Ÿå‘½ä½“çš„é‡è¦æ„ä¹‰ï¼Œäº†è§£äº†æ‰€æœ‰ç”Ÿç‰©ä»åˆ†å­å±‚é¢ä¸Šæ˜¯åŸºæœ¬ä¸€è‡´çš„ã€å…·æœ‰å…±åŒçš„ç¥–å…ˆã€‚ä¹¦ä¸­è§£é‡Šäº†å…ˆæœ‰è›‹å†æœ‰é¸¡çš„ç»“è®ºï¼Œè§£é‡Šäº†å¯¹ç‰›å¼¹ç´çš„ç§‘å­¦ä¾æ®ã€‚ç»™è¿™äº›â€œåƒå¤å¥‡æ¡ˆâ€ä»¥â€œç§‘å­¦å®šè®ºâ€ã€‚è¿˜æœ‰å¾ˆå¤šå¹³æ—¶æˆ‘ä»¬ä½“ä¼šåˆ°äº†ä½†æ˜¯æ²¡æœ‰æ·±æƒ³çš„ç”Ÿå‘½ç°è±¡ï¼Œä½œè€…éƒ½ç»™å‡ºäº†æœ‰æ„æ€çš„æè¿°å’Œè§£é‡Šã€‚ æœ€åä¸€ç« è§£é‡Šäº†ç¥ç»ç³»ç»Ÿçš„å¤æ‚ç¨‹åº¦ï¼Œè®©æˆ‘ä»ç”Ÿç‰©å­¦æ„ä¹‰ä¸Šäº†è§£äº†æ—¶ä¸‹å¤§çƒ­çš„äººå·¥æ™ºèƒ½æ·±åº¦å­¦ä¹ æŠ€æœ¯çš„ç”Ÿç‰©å­¦åŸºç¡€ã€‚ ä¸è¿‡ï¼Œæœ€åä¸€ç« åœ¨å…¨ä¹¦ä¸­å äº†å¤§çº¦å››åˆ†ä¹‹ä¸€çš„ç¯‡å¹…ï¼Œä¸ªäººæ„Ÿè§‰ç”¨åŠ›ä¸å‡ã€‚æˆ‘æ˜¯è·³ç€çœ‹äº†äº›ç‰‡æ®µã€‚ ç„¶è€Œç‘•ä¸æ©ç‘œï¼Œå¯¹äºç”Ÿç‰©å­¦å°ç™½æ¥è¯´ï¼Œä¼šè®©ä½ å…¥è¿·çš„ã€‚æ„Ÿè°¢ä½œè€…ï¼</p></blockquote><p>çœ‹è¿™æœ¬ä¹¦å’Œä»–çš„åšå®¢ä¸€æ ·ç²¾å½©ï¼Œå¦å¤–è¿˜å‡ºäº†å¦ä¸€æœ¬ä¹¦ã€Šç”Ÿå‘½é€šå²ã€‹ï¼Œçœ‹äº†ä¸€ä¸‹ç›®å½•å’Œä»–åšå®¢é‡Œå†™çš„å†…å®¹åŠå…¶ç›¸ä¼¼ï¼Œç­‰åˆ°ä»¥åå†ä¹°æœ¬çº¸è´¨ç‰ˆçš„çœ‹ã€‚æƒ³èµ·æ¥äº†å¤§å­¦æ—¶æ›¾è¯»è¿‡çš„ä¸€æœ¬ä¹¦ã€Šç”Ÿå‘½çš„è·ƒå‡ã€‹ï¼Œæˆ‘è§‰ç€äºŒè€…ä¹‹é—´æ¯”è¾ƒç›¸ä¼¼ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/tjOSuGPhu7" target="_blank" rel="noopener">ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥</a></p><h3 id="ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ"><a href="#ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ" class="headerlink" title="ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ"></a>ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_02_13T16_03_07+0800.png" alt="img"></p><p>ç‰›æ´¥é€šè¯†è¯»æœ¬ç³»åˆ—çš„ä¹¦ç±å¤§æ¦‚æœ‰ä¸‰åå‡ æœ¬ï¼Œåœ¨ Amazon ä¸Š Kindle Unlimited ä¼šå‘˜æ˜¯å¯ä»¥å…è´¹å€Ÿé˜…ã€‚åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸€äº›ä¸€ä¸¤ç™¾é¡µå­ã€‚è¿™æœ¬å…³äºåœ°çƒç§‘æ™®å°å†Œå­ç®€å•åœ°ä»‹ç»äº†ä¸€ä¸‹åœ°çƒçš„åœ°çƒçš„å½¢æˆã€å†…æ ¸ã€åœ°ç£åœºã€ç«å±±è¿åŠ¨ç­‰çŸ¥è¯†ã€‚æ€»ä¹‹è¯»èµ·æ¥å¯ä»¥æ»¡è¶³ä¸€ä¸‹è‡ªå·±çš„å¥½å¥‡å¿ƒå•¦ğŸ˜‹</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/ExJxAKtv8d" target="_blank" rel="noopener">ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ</a></p><h3 id="è¿œå¤çš„è¾‰ç…Œï¼šç”Ÿç‰©å¤§å¹…å°„"><a href="#è¿œå¤çš„è¾‰ç…Œï¼šç”Ÿç‰©å¤§å¹…å°„" class="headerlink" title="è¿œå¤çš„è¾‰ç…Œï¼šç”Ÿç‰©å¤§å¹…å°„"></a>è¿œå¤çš„è¾‰ç…Œï¼šç”Ÿç‰©å¤§å¹…å°„</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_02_13T16_02_25+0800.png" alt="img"></p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/zU8WXIDMKJ" target="_blank" rel="noopener">è¿œå¤çš„è¾‰ç…Œï¼šç”Ÿç‰©å¤§å¹…å°„</a></p><h3 id="å›½å®¶å»ºè®¾ä¸æ”¿åºœè¡Œä¸º"><a href="#å›½å®¶å»ºè®¾ä¸æ”¿åºœè¡Œä¸º" class="headerlink" title="å›½å®¶å»ºè®¾ä¸æ”¿åºœè¡Œä¸º"></a>å›½å®¶å»ºè®¾ä¸æ”¿åºœè¡Œä¸º</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_02_14T23_23_38+0800.png" alt="img"></p><p>è¯»å®Œã€Šä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶ã€‹ååœ¨ Amazon ä¸Šæœç´¢å‘¨é›ªå…‰ä½œè€…æ‰¾åˆ°çš„ä¹¦ã€‚ä¸å…¶è¯´æ˜¯ä¸€æœ¬ä¹¦ï¼Œå…¶å®æ›´åƒæ˜¯ä¸€å†Œç ”ç©¶ä¸­å›½å®˜åƒšä½“åˆ¶çš„è®ºæ–‡é›†ï¼Œä»å­¦æœ¯è§’åº¦æ¥åˆ†æä¸€äº›ä½“åˆ¶é—®é¢˜ã€‚</p><blockquote><p>ä½œä¸ºæ‰€æœ‰æƒåŠ›é›†äºä¸€èº«çš„ä¸­å¤®æ”¿åºœï¼Œä¸»è¦éœ€è¦å®Œæˆä¸¤é¡¹åŸºæœ¬ä»»åŠ¡ï¼šä¸€æ˜¯ä¸ºå¹¿å¤§ç™¾å§“æä¾›åŸºæœ¬çš„å…¬å…±æœåŠ¡ï¼Œç»´æŒæ”¿æƒçš„é•¿æœŸç¨³å®šï¼›äºŒæ˜¯ä¿è¯ä¸‹æ”¾ç»™è¡Œæ”¿ä»£ç†äººçš„æƒåŠ›ä¸è¢«æ»¥ç”¨ï¼Œä¸­å¤®çš„æ”¿ä»¤èƒ½å¤Ÿç•…é€šæ— é˜»ã€‚è¿™ä¸¤é¡¹ä»»åŠ¡æœ¬è´¨ä¸Šæ˜¯å†²çªçš„ï¼šä¸€æ–¹é¢ï¼Œä¸ºäº†ç»™å¹¿å¤§ç™¾å§“æ›´å¥½åœ°æä¾›å…¬å…±æœåŠ¡ï¼Œå°±å¿…é¡»å°½å¯èƒ½æŠŠæƒåŠ›ä¸‹æ”¾ç»™åŸºå±‚æ”¿åºœï¼Œå› ä¸ºåŸºå±‚æ”¿åºœç›¸å¯¹æ¥è¯´æ›´äº†è§£å½“åœ°æ°‘ä¼—å¯¹å…¬å…±æœåŠ¡çš„åå¥½ï¼Œæ›´äº†è§£å½“åœ°çš„å…·ä½“æ¡ä»¶ï¼›ä»å…¬å…±æœåŠ¡çš„è§’åº¦ï¼Œé›†æƒè€…åº”è¯¥å°½å¯èƒ½é€‰æ‹©åˆ†æƒã€‚å¦ä¸€æ–¹é¢ï¼Œç»™å®šä¸‹çº§æ”¿åºœçš„å®˜å‘˜ç›®æ ‡å’Œåˆ©ç›Šä¸åŒäºä¸­å¤®æ”¿åºœï¼Œä¸‹çº§å®˜å‘˜çš„è¡Œä¸ºä¸æ˜“ç›‘ç£ï¼ŒæƒåŠ›ä¸‹æ”¾å°±æ„å‘³ç€æƒåŠ›è¢«æ»¥ç”¨çš„å±é™©ï¼Œç”šè‡³è¢«æ¶ç©ºï¼Œè€Œä¸”æƒåŠ›ä¸‹æ”¾è¶Šæ˜¯åˆ°åŸºå±‚ï¼Œç›‘ç£å°±è¶Šå›°éš¾ï¼ŒæƒåŠ›è¢«æ»¥ç”¨çš„å¨èƒä¹Ÿå°±è¶Šå¤§ã€‚</p><p>å½“æ”¿åºœé»˜è®¸æˆ–é¼“åŠ±ä¸‹çº§æ”¿åºœå› åœ°åˆ¶å®œæ—¶ï¼Œåè€…å¯èƒ½æŒ‰è‡ªå·±æ„å›¾è§£è¯»å®æ–½æ”¿ç­–ï¼Œéšç€æ”¿ç­–å®æ–½è¿‡ç¨‹çš„å±•å¼€ï¼Œæ‰§è¡Œçµæ´»æ€§è¶Šæ¥è¶Šå¤§ï¼Œä¸è¿™ä¸€ä¸»çº¿çš„åå·®è·ç¦»è¶Šæ¥è¶Šå¤§ï¼Œå¯¼è‡´ä¸åŸæ”¿ç­–ç›¸å»ç”šè¿œçš„ç»“æœã€‚</p></blockquote><p>ç»“åˆè¿™æ¬¡ç–«æƒ…ï¼Œä¸éš¾ç†è§£ä¸ºä»€ä¹ˆåœ°æ–¹æ”¿åºœæ“…è‡ªå°è·¯å°åŸçš„ä¸¾æªï¼Œå³ä¾¿è¿™äº›ä¸¾æªå·²ç»æ˜æ˜¾åœ°è¿åäº†æ³•å¾‹ï¼ˆå›½åŠ¡é™¢é¢å¸ƒçš„è§„å®šï¼‰ï¼Œå³ä¾¿æ˜¯å› ä¸ºå°è·¯è€Œé€ æˆäººå‘˜æ„å¤–èº«äº¡ï¼Œå³ä¾¿æ˜¯ä¸€å®¶å››å£åœ¨å®¶æ‰“éº»å°†ä¹Ÿè¦è¢«æ‹‰ä¸Šè¡—è¢«<code>æ‰¹æ–—</code>â€¦â€¦ä¸­å¤®æ”¿åºœä¹Ÿä¸ä¼šå¤„ç½šåœ°æ–¹æ”¿åºœã€‚åœ¨è¿™æ¬¡ç–«æƒ…ä¸­ï¼Œåœ°æ–¹æ”¿åºœçš„ä¸€äº›è¡Œä¸ºå·²ç»è¿åäº†å®ªæ³•ï¼Œç®€ç§°è¿å®ªè¡Œä¸ºï¼Œè€Œæ‰€è°“çš„<code>çº¢è¢–ç« </code>ä»—ç€ç‚¹æ‰‹ä¸­çš„ç‰¹æƒè‚†æ„ä¾µçŠ¯ç€å…¬æ°‘çš„æƒåŠ›ã€‚å°±å¦‚å‰©ä½™ä»·å€¼è¢«å°æ€çš„é‚£æœŸä¸­ç½—æ–°è€å¸ˆæåˆ°çš„ï¼š</p><blockquote><p>æˆ‘ä»¬ç°åœ¨å¬å¾ˆå¤šäººå¤§è°ˆ<strong>æˆ˜æ—¶çŠ¶æ€</strong>ï¼Œä½†éšä¾¿ä¸€ä¸ªè¡Œæ”¿å®˜å‘˜å°±èƒ½å¤Ÿå®£å¸ƒâ€æˆ˜æ—¶çŠ¶æ€â€å—ï¼Ÿè¿™å¿…é¡»æ˜¯è¦ç»è¿‡æœ€é«˜ç«‹æ³•æœºæ„å†³å®šçš„ã€‚å°åŸæˆ–è€…è¯¸å¦‚æ­¤ç±»çš„æç«¯æªæ–½å¸¦æ¥çš„ä¼¤å®³ï¼Œä¸€å®šä¼šæ¯”ç—…æ¯’æœ¬èº«è¿˜è¦å¤§ã€‚</p></blockquote><p><code>æ‘˜æŠ„</code> <a href="https://t.co/7oYY1ZTdAL" target="_blank" rel="noopener">å›½å®¶å»ºè®¾ä¸æ”¿åºœè¡Œä¸º</a></p><h3 id="åœ°çƒè„‰åŠ¨2ï¼šå¥‡è¿¹ä¸–ç•Œ"><a href="#åœ°çƒè„‰åŠ¨2ï¼šå¥‡è¿¹ä¸–ç•Œ" class="headerlink" title="åœ°çƒè„‰åŠ¨2ï¼šå¥‡è¿¹ä¸–ç•Œ"></a>åœ°çƒè„‰åŠ¨2ï¼šå¥‡è¿¹ä¸–ç•Œ</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_02_24T14_42_00+0800.png" alt="img"></p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/qlnVJv7trg" target="_blank" rel="noopener">åœ°çƒè„‰åŠ¨2ï¼šå¥‡è¿¹ä¸–ç•Œ</a></p><h3 id="å†å²çš„ç»ˆç»“"><a href="#å†å²çš„ç»ˆç»“" class="headerlink" title="å†å²çš„ç»ˆç»“"></a>å†å²çš„ç»ˆç»“</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_02_25T19_30_49+0800.png" alt="img"></p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/OQfS3drfyk" target="_blank" rel="noopener">å†å²çš„ç»ˆç»“</a></p><h3 id="ä¸€æƒ³åˆ°è¿˜æœ‰ç™¾åˆ†ä¹‹ä¹åäº”çš„é—®é¢˜ç•™ç»™äººç±»-æˆ‘å°±æ”¾å¿ƒäº†"><a href="#ä¸€æƒ³åˆ°è¿˜æœ‰ç™¾åˆ†ä¹‹ä¹åäº”çš„é—®é¢˜ç•™ç»™äººç±»-æˆ‘å°±æ”¾å¿ƒäº†" class="headerlink" title="ä¸€æƒ³åˆ°è¿˜æœ‰ç™¾åˆ†ä¹‹ä¹åäº”çš„é—®é¢˜ç•™ç»™äººç±»,æˆ‘å°±æ”¾å¿ƒäº†"></a>ä¸€æƒ³åˆ°è¿˜æœ‰ç™¾åˆ†ä¹‹ä¹åäº”çš„é—®é¢˜ç•™ç»™äººç±»,æˆ‘å°±æ”¾å¿ƒäº†</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_03_07T00_11_25+0800.png" alt="img"></p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/HX1EXtz2oZ" target="_blank" rel="noopener">ä¸€æƒ³åˆ°è¿˜æœ‰ç™¾åˆ†ä¹‹ä¹åäº”çš„é—®é¢˜ç•™ç»™äººç±»,æˆ‘å°±æ”¾å¿ƒäº†</a></p><h3 id="æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³"><a href="#æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³" class="headerlink" title="æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³"></a>æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³</h3><p>è¿™æœ¬ä¹¦æ˜¯æˆ‘åœ¨ <a href="https://twitter.com/linyujing" target="_blank" rel="noopener">æ—æ„ˆéœ</a> ç«‹åœºæ–°é—»çš„æ–‡ç« é‡Œä¸Šå‘ç°çš„ã€‚ä¹‹å‰æˆ‘æ˜¯çŸ¥é“åˆ˜æ™“æ³¢æ˜¯è¯ºè´å°”å’Œå¹³å¥–å¾—ä¸»ï¼Œä¹ŸçŸ¥é“ä»–çš„ä¸€äº›äº‹è¿¹ï¼Œä½†é€šè¿‡è¿™æœ¬ä¼ è®°æ‰çœŸçœŸåˆ‡åˆ‡åœ°äº†è§£åˆ°åˆ˜æ™“æ³¢æ˜¯ä¸€ä½å¤šä¹ˆä¼Ÿå¤§è€Œåšå¼ºçš„çŸ¥è¯†ä»½å­ã€‚åŒ…æ‹¬ç‹¬ç«‹ä¸­æ–‡ç¬”ä¼šçš„å‘å±•ï¼Œéƒ½ç¦»ä¸å¼€åˆ˜æ™“æ³¢å…ˆç”Ÿçš„ä»˜å‡ºã€‚å‡„å‡„æƒ¨æƒ¨çš„åŠç”Ÿï¼Œåˆ«æ— å¯è¨€â€¦â€¦</p><blockquote><p>åŠ‰æ›‰æ³¢æ‰¿èªï¼šã€Œé¡ä¼¼çš„æ®˜å¿è¡Œç‚ºä»¥åŠå°æ®˜å¿çš„è‡ªå¾—å…¶æ¨‚ï¼Œæˆ‘å°æ™‚å€™æ²’å°‘å¹¹ã€‚é€™ç¨®è¡Œç‚ºèˆ‡å°ˆé–€æ‰“ç ¸æ¶ã€æªé¬¥åˆ¥äººçš„ç´…è¡›å…µæ²’æœ‰ä»€éº¼å¯¦è³ªçš„å€åˆ¥ã€‚æˆ‘å€‘é€™äº›äººï¼Œåœ¨ä¸€ç¨®é‡è »çš„åˆ¶åº¦å’Œæ•™è‚²ä¹‹ä¸‹é•·å¤§ï¼Œå®ƒå´‡å°šæš´åŠ›ã€åŸ¹é¤Šä»‡æ¨ã€é¼“å‹µæ®˜å¿ã€ç¸±å®¹ç„¡æƒ…ï¼Œæ•™çµ¦å­©å­å€‘ä¸€ç¨®å¾å¨˜èƒè£¡å¸¶å‡ºä¾†çš„ä¸æ‹¿äººç•¶äººçš„æ®˜æš´å…‡ç‹ ã€‚åœ¨è¦–ç”Ÿå‘½å¦‚è‰èŠ¥çš„å¹´ä»£ï¼Œæˆ‘å€‘éƒ½åœ¨ä¸åŒçš„ç¨‹åº¦ä¸Šå……ç•¶éåŠŠå­æ‰‹å’Œå¹«å…‡ï¼Œèª°ä¹Ÿè„«ä¸æ‰è²¬ä»»ï¼Œæ´—ä¸æ¸…è‡ªå·±ï¼ã€</p></blockquote><blockquote><p>æˆ‘çš„æ•´å€‹é’æ˜¥æœŸç”Ÿé•·æ–¼æ–‡åŒ–æ²™æ¼ ä¹‹ä¸­ï¼Œæˆ‘æ‰€è³´ä»¥å¯«ä½œçš„æ–‡åŒ–æ»‹é¤Šï¼Œé™¤äº†ä»‡æ¨ã€æš´åŠ›ã€ç‹‚å¦„ï¼Œå°±æ˜¯èªªè¬Šã€ç„¡è³´ã€çŠ¬å„’ï¼Œé€™äº›é»¨æ–‡åŒ–çš„æ¯’ç´ é¤µé¤Šäº†æ•´æ•´å¹¾ä»£äººï¼Œæˆ‘ä¾¿æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œå³ä¾¿åœ¨æ€æƒ³è§£æ”¾çš„å…«â—‹å¹´ä»£ï¼Œä¹Ÿä¸¦æ²’æœ‰å®Œå…¨æ“ºè„«é»¨æ–‡åŒ–ã€‚</p></blockquote><p>è‡ªå…«ä¹å…­å››ä¹‹ååˆ° 2009 å¹´æœ«ï¼ŒäºŒåå¹´é—´ï¼Œåˆ˜æ™“æ³¢å…ˆç”Ÿå†™çš„æ–‡ç« åœ¨ <a href="http://www.liu-xiaobo.org" target="_blank" rel="noopener">åˆ˜æ™“æ³¢åˆ˜éœç½‘ç«™</a> ä¸Šï¼Œå¯ä»¥æ‰¾åˆ°ã€‚æˆ‘ç”¨è„šæœ¬çˆ¬äº†ä¸€ä¸‹ï¼Œåœ¨è¿™äºŒåå¹´é—´åˆ˜æ™“æ³¢å…ˆç”Ÿå†™ä¸‹äº†ä¸ä¸‹äº 1500 ç¯‡æ–‡ç« ï¼Œå¹³å‡æ¯å‘¨è‡³å°‘å†™ä¸€ç¯‡ã€‚äºŒåå¹´æ¥ï¼Œè¿˜æœ‰å“ªä¸ªçŸ¥è¯†ä»½å­è°èƒ½åšåˆ°ï¼Ÿ</p><blockquote><p><strong>æˆ‘å …å®ˆè‘—äºŒåå¹´å‰æˆ‘åœ¨ã€ˆã€Œå…­äºŒã€çµ•é£Ÿå®£è¨€ã€‰ä¸­æ‰€è¡¨é”çš„ä¿¡å¿µâ”€â”€æˆ‘æ²’æœ‰æ•µäººï¼Œä¹Ÿæ²’æœ‰ä»‡æ¨ã€‚</strong></p></blockquote><p>æˆ‘æƒ³è¯ºè´å°”å’Œå¹³å¥–æ˜¯å¯¹è¿™å¥è¯æœ€å®Œç¾çš„è¯ é‡Š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">http://www.liu-xiaobo.org/blog/archives/8696</span><br><span class="line">http://www.liu-xiaobo.org/blog/archives/8620</span><br><span class="line">http://www.liu-xiaobo.org/blog/archives/8091</span><br><span class="line">http://www.liu-xiaobo.org/blog/archives/8093</span><br><span class="line">http://www.liu-xiaobo.org/blog/archives/8625</span><br><span class="line">http://www.liu-xiaobo.org/blog/archives/8096</span><br><span class="line">http://www.liu-xiaobo.org/blog/archives/8098</span><br><span class="line">â•­â”€root@blog /home/ubuntu/page</span><br><span class="line">â•°â”€# cat url.log | wc</span><br><span class="line">   1502    1502   67907</span><br></pre></td></tr></table></figure><blockquote><p>åŠ‰æ›‰æ³¢å¼·èª¿äº†è¨€è«–è‡ªç”±çš„é‡è¦æ€§ï¼šã€Œä¸€å€‹æ”¿æ¬Šä¸å¯èƒ½é å£“æŠ‘ä¸åŒæ”¿è¦‹ä¾†å»ºç«‹åˆæ³•æ€§ï¼Œä¹Ÿä¸å¯èƒ½é æ–‡å­—ç„ä¾†é”æˆé•·æ²»ä¹…å®‰ã€‚ã€ä»–å‘¼ç±²ä¸­åœ‹æ—©æ—¥å‘Šåˆ¥æ–‡å­—ç„ï¼šã€Œåªæœ‰å¾åˆ¶åº¦ä¸Šæ ¹çµ•æ–‡å­—ç„ï¼Œæ†²æ³•æ‰€è¦å®šçš„è¨€è«–è‡ªç”±æ¬Šåˆ©æ‰èƒ½è½å¯¦åˆ°æ¯ä¸€ä½åœ‹æ°‘èº«ä¸Šï¼›åªæœ‰ç•¶åœ‹æ°‘çš„è¨€è«–è‡ªç”±æ¬Šåˆ©å¾—åˆ°åˆ¶åº¦åŒ–çš„ç¾å¯¦ä¿éšœï¼Œæ–‡å­—ç„æ‰æœƒåœ¨ä¸­åœ‹å¤§åœ°ä¸Šæ»…çµ•ã€‚ã€</p></blockquote><p><code>æ‘˜æŠ„</code> <a href="https://t.co/eefs4gZspV" target="_blank" rel="noopener">æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³</a></p><h3 id="Age-of-Ambition"><a href="#Age-of-Ambition" class="headerlink" title="Age of Ambition"></a>Age of Ambition</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_03_14T22_17_43+0800.png" alt="img"></p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/uvCqxbUb0i" target="_blank" rel="noopener">Age of Ambition</a></p><h3 id="è´¹é©¬æœ€ç»ˆå®šç†"><a href="#è´¹é©¬æœ€ç»ˆå®šç†" class="headerlink" title="è´¹é©¬æœ€ç»ˆå®šç†"></a>è´¹é©¬æœ€ç»ˆå®šç†</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_03_26T23_45_47+0800.png" alt="img"></p><p>æ—¥ç³»ç‹—ç²®å°è¯´ğŸ•ï¼Œç¬¬ä¸€æ¬¡è¯»è¿™æœ¬ä¹¦è¿˜æ˜¯å¤§ä¸‰çš„æ—¶å€™ï¼Œ<del>é‚£æ—¶å€™å’±åˆšåˆšå¼€å§‹äº†äººç”Ÿçš„ç¬¬ä¸€æ¬¡åˆæ‹ï¼Œå¹¶æŠŠè¿™æœ¬ä¹¦é€ç»™äº†å‰å¥³å‹</del>ğŸ¤£ã€‚åŒæ ·çš„å°è¯´è¿˜æœ‰ã€Šæ•°å­¦å¥³å­©ã€‹ï¼Œåè€…çš„è¯„ä»·å¾ˆé«˜ï¼Œä½†æƒ³è¦é€šè¿‡å°è¯´æ¥å­¦ä¹ æ•°å­¦æ˜¯ç—´å¿ƒå¦„æƒ³å•¦ã€‚å˜›ï¼Œå°è¯´å°±æ˜¯å…´è¶£è¯»ç‰©ï¼Œç»™è¿™äº›æ¯ç‡¥ä¼šè‰²çš„æ•°å­¦å…¬å¼å¢åŠ ä¸€ç‚¹è‰²å½©~~</p><p>è™½ç„¶å¯¹äºæ•°å­¦æ¥è®²ï¼Œå’±æœ¨å­ç®€ç›´æ˜¯ä¸ªå­¦è„†ğŸ˜­ï¼Œé«˜è€ƒæ•°å­¦è€ƒäº† 60 å‡ åˆ†ï¼Œè¿™ä¹Ÿè®©å’±ä¸åç‰Œå¤§å­¦å¤±ä¹‹äº¤è‡‚ï¼Œåªèƒ½å»è¯»ç¬¬å…­çº§æœ¬ç§‘é™¢æ ¡ğŸ˜‘ï¼Œå¤šå°‘æœ‰ç‚¹é—æ†¾å§ã€‚ä¸è¿‡çº³ï¼Œå¯¹äºé‚£äº›æ¯ç‡¥æ— æ¯”çš„è®¡ç®—å…¬å¼æ±‚ç§¯åˆ†è§£å¾®åˆ†æ–¹ç¨‹ç­‰ï¼Œå’±æ›´å–œæ¬¢çŸ¥é“æ•°å­¦è¿™æœ¬å­¦ç§‘èƒŒåçš„å†å²ï¼šæƒ³çŸ¥é“ç‰›é¡¿å’Œè±å¸ƒå°¼èŒ¨ä¹‹é—´çš„æ’•é€¼å¤§æˆ˜ï¼Œæƒ³çŸ¥é“ä¼¯åŠªåŠ›å®¶æ—çš„æ©ä»‡æ€¨æ¨ï¼Œæƒ³çŸ¥é“ç¬›å¡å°”ä¸å…¬ä¸»çš„çˆ±æƒ…æ•…äº‹ï¼Œæƒ³çŸ¥é“æ¬§æ‹‰å¥‹ç¬”ç–¾ä¹¦éå‡¡çš„ä¸€ç”Ÿï¼Œæƒ³çŸ¥é“åºåŠ è±çŒœæƒ³ä¸<code>å®‡å®™çš„å½¢çŠ¶</code>ç­‰ç­‰ã€‚è¿™ä¹Ÿæ˜¯å’±å³ä¾¿æ¯•ä¸šç¦»å¼€å¤§å­¦ä¹‹åï¼Œä¸å†æ˜¯ä¸€åå­¦ç”Ÿä½†ä¹Ÿæ˜¯åƒå­¦ç”Ÿæ—¶ä»£çš„è‡ªå·±é‚£æ ·å¥½å¥‡å¿ƒå¦‚æ­¤åœ°æ—ºç››ğŸ˜‚</p><blockquote><p>ã€æˆ‘ä¸€ç›´è§‰å¾—ï¼Œè´¹é©¬ã€æ¬§æ‹‰ã€å“¥å¾·å·´èµ«ç­‰äººä¸ç°ä»£äººç›¸æ¯”ï¼Œä»–ä»¬å…·æœ‰æ ¼å¤–æ—ºç››çš„å¥½å¥‡å¿ƒå’Œä¸°å¯Œçš„æƒ³è±¡åŠ›ï¼Œå¹¶ä¸”å……æ»¡äº†ç”Ÿæœºä¸æ´»åŠ›ã€‚éšç€ç¤¾ä¼šå‘å±•çš„æ—¥ç›Šæˆç†Ÿï¼Œå¥½å¥‡å¿ƒå’Œæƒ³è±¡åŠ›ä¸å¯é¿å…åœ°ä¸æ–­é™ä½ï¼Œä½†å¹¶ä¸ä»£è¡¨ç°ä»£ç¤¾ä¼šä¸å†éœ€è¦å¥½å¥‡å¿ƒå’Œæƒ³è±¡åŠ›ã€‚ã€</p></blockquote><p><code>æ‘˜æŠ„</code> <a href="https://t.co/UqDfbYRjs7" target="_blank" rel="noopener">è´¹é©¬æœ€ç»ˆå®šç†</a></p><h3 id="è¢«è®¨åŒçš„å‹‡æ°”"><a href="#è¢«è®¨åŒçš„å‹‡æ°”" class="headerlink" title="è¢«è®¨åŒçš„å‹‡æ°”"></a>è¢«è®¨åŒçš„å‹‡æ°”</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/screenshot_2020_03_28T01_28_04+0800.png" alt="img"></p><p>æ— æ„é—´åœ¨ <a href="https://sanshiliuxiao.top/talkSelf/20191212/" target="_blank" rel="noopener">æ¤å’²è‰¯ç”°|æƒ³ä¸åˆ°å•¥æ ‡é¢˜</a> å‘ç°äº†è¿™æœ¬ä¹¦ã€‚</p><blockquote><p>ä¹¦é‡Œé¢æœ‰å¾ˆå¤šçš„è§‚ç‚¹ä¸€å¼€å§‹éƒ½æŒºè®©äººéš¾ä»¥æ¥å—çš„ï¼Œå°±åƒé‚£ä½å»å¯»æ±‚å“²äººå¸®åŠ©çš„é’å¹´ï¼Œä¸å»æ¥å—å“²äººçš„è§‚ç‚¹ï¼Œå¿ƒé‡Œæƒ³ç€æ ¹æœ¬å°±ä¸æ˜¯å“²äººè¯´çš„é‚£æ ·ï¼Œå†³å®šè¦å»å¥½å¥½åé©³ä»–ã€‚å¯æ˜¯ä»”ç»†æƒ³æƒ³ï¼Œå“²äººè¯´çš„è¯ä¹Ÿç®—æ˜¯è›®æœ‰é“ç†çš„ã€‚æ•´æœ¬ä¹¦ä¸­å“²äººè¯´çš„ä¸€äº›è¨€è®ºï¼Œå¦‚æœå•å•åªæ‹†å‡ºä¸€æ®µæˆ–ä¸€å¥ï¼Œå°±ä¼šè§‰å¾—è¿™ä¸ªå“²äººæ˜¯åœ¨å¼ºè¯å¤ºç†ï¼Œå¯æ˜¯ä»–çš„è¯é‡Œé¢æœ‰ç€æ˜¯æœ‰å¾ˆå¤šçš„å‰ç½®æ¡ä»¶ï¼Œå¦‚ä½•ç»“åˆç€ä¸€èµ·çœ‹ï¼Œé‚£å°±ä¼šæ„Ÿè§‰ä¸ä¸€æ ·ã€‚</p></blockquote><p>å…ˆè¯´ä¸€ä¸‹æˆ‘è‡ªå·±çš„æ„Ÿå—å§ï¼Œè¯»å®Œè¿™æœ¬ä¹¦ç¡®å®æ”¹å˜äº†æˆ‘ä¸€äº›æ ¹æ·±è’‚å›ºçš„è§‚å¿µã€‚æˆ‘æ‰¿è®¤æˆ‘æœ‰ç‚¹æç«¯å¿ƒç†ï¼Œå¹¶ä¸”æˆ‘å¾ˆé•¿æ—¶é—´æŠŠå®ƒå½’å› äºç«¥å¹´æ—¶æœŸçš„å®¶åº­æš´åŠ›ï¼Œæˆ‘è§‰ç€æ˜¯è€çˆ¸çš„æš´è„¾æ°”å½±å“äº†æˆ‘çš„æ€§æ ¼ï¼Œä»¥è‡³äºæ€§æ ¼åæ¿€ã€å¯¡è¨€å°‘è¯­ã€ä¸å–„ç¤¾äº¤ã€è‡ªå‘å†…å‘ç­‰ã€‚å¾ˆé•¿å¾ˆé•¿ä¸€æ®µæ—¶é—´æˆ‘éƒ½æŠŠè¿™ä¸€åˆ‡å½’è´£äºè€çˆ¸å¯¹æˆ‘çš„å®¶åº­æš´åŠ›ï¼Œé•¿ä¹…ä¸èƒ½é‡Šæ€€ã€‚å°±åœ¨ä»Šå¹´è¿‡å¹´æ—¶åœ¨å®¶è¿˜å’Œè€çˆ¸äº‰åµæ€ªä»–å°æ—¶å€™æ‰“æˆ‘æ‰å¯¼è‡´æˆ‘æ€§æ ¼åæ¿€ã€‚</p><p>ç›´åˆ°è¯»å®Œè¿™æœ¬ä¹¦ï¼Œæˆ‘æ‰æ”¹å˜äº†è¿™ç§å¹¼ç¨šçš„æƒ³æ³•ã€‚<strong>æˆ‘ä»¬å¹¶éå› ä¸ºè‡ªèº«ç»å†ä¸­çš„åˆºæ¿€â€”â€”æ‰€è°“çš„å¿ƒç†åˆ›ä¼¤â€”â€”è€Œç—›è‹¦ï¼Œäº‹å®ä¸Šæˆ‘ä»¬ä¼šä»ç»å†ä¸­å‘ç°ç¬¦åˆè‡ªå·±ç›®çš„çš„å› ç´ ã€‚å†³å®šæˆ‘ä»¬è‡ªèº«çš„ä¸æ˜¯è¿‡å»çš„ç»å†ï¼Œè€Œæ˜¯æˆ‘ä»¬è‡ªå·±èµ‹äºˆç»å†çš„æ„ä¹‰ã€‚</strong>ç»å†æœ¬èº«ä¸ä¼šå†³å®šä»€ä¹ˆã€‚æˆ‘ä»¬ç»™è¿‡å»çš„ç»å†â€œèµ‹äºˆäº†ä»€ä¹ˆæ ·çš„æ„ä¹‰â€ï¼Œè¿™ç›´æ¥å†³å®šäº†æˆ‘ä»¬çš„ç”Ÿæ´»ã€‚ä¸å¯ä»¥ä»è¿‡å»ä¸­æ‰¾åŸå› ï¼›è¦å¦å®šç²¾ç¥åˆ›ä¼¤ï¼›äººä¸æ˜¯å—è¿‡å»åŸå› æ”¯é…çš„å­˜åœ¨ï¼Œäººæ˜¯ä¸ºäº†è¾¾æˆæŸç§ç›®çš„è€Œé‡‡å–è¡ŒåŠ¨çš„ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/o6cc1csJI2" target="_blank" rel="noopener">è¢«è®¨åŒçš„å‹‡æ°”</a></p><h2 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h2><blockquote><p>æ­£å¦‚é–‹ç¯‡æ˜†å¾·æ‹‰å°±ä¸€èªé©šäººçš„å¯«é“ï¼šäººèˆ‡æ”¿æ¬Šçš„é¬¥çˆ­ï¼Œå°±æ˜¯è¨˜æ†¶èˆ‡éºå¿˜çš„é¬¥çˆ­ ã€‚é€™å€‹è«–æ–·æ˜¯å¦‚æ­¤æº–ç¢ºåˆå¦‚æ­¤ä»¤äººçµ•æœ›ï¼Œå°±ç›®å‰ä¾†çœ‹ï¼Œæ­·å²è»Šè¼ªæ»¾æ»¾å‘å‰ï¼Œæˆ‘å€‘å¿˜è¨˜äº†å¾ˆå¤šäººï¼Œå¾ˆå¤šäº‹ï¼Œåœ¨è¨˜æ†¶èˆ‡éºå¿˜çš„é¬¥çˆ­ä¸­ï¼Œäººé¡å¾¹åº•å¤±æ•—äº†ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;blockquote&gt;
&lt;p&gt;äººä¸æ”¿æƒçš„æ–—äº‰ï¼Œå°±æ˜¯è®°å¿†ä¸é—å¿˜çš„
        
      
    
    </summary>
    
    
      <category term="é˜…è¯»" scheme="https://blog.k8s.li/categories/%E9%98%85%E8%AF%BB/"/>
    
    
      <category term="è¯»ä¹¦ç¬”è®°" scheme="https://blog.k8s.li/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
      <category term="ä¹¦å•" scheme="https://blog.k8s.li/tags/%E4%B9%A6%E5%8D%95/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ CloudFlare WorkersÂ æ­å»º telegram é¢‘é“é•œåƒç«™</title>
    <link href="https://blog.k8s.li/cloudflare-worker-build-mirror-website.html"/>
    <id>https://blog.k8s.li/cloudflare-worker-build-mirror-website.html</id>
    <published>2020-03-25T16:00:00.000Z</published>
    <updated>2020-03-26T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€æ¬¡å¶é‡"><a href="#ä¸€æ¬¡å¶é‡" class="headerlink" title="ä¸€æ¬¡å¶é‡"></a>ä¸€æ¬¡å¶é‡</h2><p>æ˜¨å¤©åœ¨å’±çš„ <a href="https://blog.k8s.li/oh-my-webpsh.html">è®©å›¾ç‰‡é£èµ·æ¥ oh-my-webp.sh ï¼</a> æ”¶åˆ°äº† <a href="https://ichr.me/" target="_blank" rel="noopener">ChrAlpha</a> å¤§ä½¬çš„å›å¤ï¼Œå’±å°±æ‹œè®¿äº†ä¸€ä¸‹å¤§ä½¬çš„åšå®¢ğŸ˜‚ï¼Œæ— æ„é—´å‘ç° <a href="https://blog.ichr.me/post/cloudflare-worker-build-mirror-website/" target="_blank" rel="noopener">Cloudflare Worder å…è´¹æ­å»ºé•œåƒç«™</a> è¿™ç¯‡åšå®¢ã€‚äºæ˜¯å‘ï¼Œå’±ä¹Ÿæƒ³ç€èƒ½ä¸èƒ½ç©ä¸€ç©è¿™ä¸ª Workers ã€‚è™½ç„¶ä¹‹å‰å¬è¯´è¿‡æœ‰ç”¨ Workers åšå¾ˆå¤šå¥½ç©çš„äº‹å„¿ï¼Œæ¯”å¦‚åŠ é€Ÿç½‘ç«™ã€ä»£ç† Google é•œåƒç«™ä»€ä¹ˆçš„ã€‚ä¸è¿‡è¿™äº›å¯¹äºå’±æ¥è¯´ä¸æ˜¯å¾ˆåˆšéœ€å°±æ²¡æœ‰æŠ˜è…¾ã€‚åˆšå¥½å’±çš„ telegram ç”µæŠ¥é¢‘é“ <a href="https://t.me/rss_kubernetes" target="_blank" rel="noopener">RSS Kubernetes</a> äººä¹Ÿæ¯”è¾ƒå¤šäº†ï¼Œä¸ºäº†æé«˜ä¸€ç‚¹å½±å“åŠ›ï¼Œå’±å°±æƒ³ç€èƒ½ä¸èƒ½æŠŠé¢‘é“çš„é¢„è§ˆç•Œé¢ <a href="https://t.me/s/rss_kubernetes" target="_blank" rel="noopener">t.me/s/rss_kubernetes</a> åä»£åˆ°å’±åŸŸåä¸Šã€‚è™½ç„¶ä¹‹å‰å°è¯•ä½¿ç”¨ nginx è¿›è¡Œåä»£ï¼Œä½†æ˜¯æ•ˆæœä¸å°½äººæ„ï¼Œäºæ˜¯å½“æ—¶å°±å¼ƒå‘äº†ã€‚åœ¨æ˜¥èŠ‚çš„æ—¶å€™å’±ä¹Ÿçœ‹åˆ°è¿‡æœ‰äººåä»£ <a href="https://t.me/nCoV2019" target="_blank" rel="noopener">2019-nCoVç–«æƒ…å®æ—¶æ’­æŠ¥ğŸ…¥</a> ï¼Œæ¯”å¦‚ <a href="https://2019ncov.ga/" target="_blank" rel="noopener">2019ncov.ga</a>ï¼Œä¸è¿‡å½“æ—¶é‚£ä¸ªé¡¹ç›®æŠ˜è…¾èµ·æ¥ä¹Ÿæ˜¯å¾ˆéº»çƒ¦ï¼Œå’±è¿™ç§èœé¸¡è¿˜æ˜¯æºœäº†æºœäº†ğŸ˜‚ã€‚ç›´åˆ°ä»Šå¤©çœ‹åˆ° <a href="https://blog.ichr.me/post/cloudflare-worker-build-mirror-website/" target="_blank" rel="noopener">Cloudflare Worder å…è´¹æ­å»ºé•œåƒç«™</a> è¿™ç¯‡åšå®¢åå°±å¿ƒè¡€æ¥æ½®ï¼Œå°±æä¸€æå§ğŸ˜‚</p><h2 id="åŠé€€ä¸‰ä¸€è¿"><a href="#åŠé€€ä¸‰ä¸€è¿" class="headerlink" title="åŠé€€ä¸‰ä¸€è¿"></a>åŠé€€<del>ä¸‰</del>ä¸€è¿</h2><p>é¦–å…ˆä½ è¦æœ‰ä¸ª Cloudflare è´¦æˆ·ï¼Œè¿™æ˜¯å¿…é¡»çš„ã€‚å…³äº Cloudflare çš„æ³¨å†Œå’±å°±ä¸å¤šè¯´å•¦ï¼Œä¸è¿‡å’±å€’æ˜¯å»ºè®®å¤§å®¶ä¼™æŠŠåŸŸåçš„ DNS è§£ææ”¾åˆ° Cloudflare ä¸Šæ¥ï¼Œå¥½å¤„å¤šå¤šï¼šæœ‰æŠŠ https å°ç»¿é”ã€å…è´¹çš„ <del>åŠ é€Ÿ</del> å‡é€Ÿ CDN ï¼ˆå¢™å†…ï¼‰ã€åŸŸåè®¿é—®ç»Ÿè®¡ç­‰ç­‰å¯ç©æ€§æ¯”è¾ƒé«˜ğŸ˜‹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ Cloudflare çš„ Worker ä¸€å¤© 10 ä¸‡æ¬¡å…è´¹é¢åº¦ï¼Œä¹Ÿå¤Ÿå’±å–ä¸€å£¶çš„å•¦ï¼Œä¸ç”¨æ‹…å¿ƒä¸å¤Ÿç”¨ã€‚</p><h2 id="æ–°å»º-Worker"><a href="#æ–°å»º-Worker" class="headerlink" title="æ–°å»º Worker"></a>æ–°å»º Worker</h2><p>ç™»å½•åˆ° <a href="https://dash.cloudflare.com" target="_blank" rel="noopener">Cloudflare</a>çš„<del>å¤§ç›˜</del>é¢æ¿ï¼Œç‚¹å‡»å·¦ä¸Šè§’çš„ <code>Menu</code> â€”-&gt; <code>Workers</code> è¿›å…¥åˆ° Workers é¡µé¢ã€‚æ–°æ³¨å†Œçš„ç”¨æˆ·ä¼šæç¤ºè®¾ç½®ä¸€ä¸ª <code>workers.dev</code> é¡¶çº§åŸŸåä¸‹çš„äºŒçº§å­åŸŸåï¼Œè¿™ä¸ªå­åŸŸåè®¾ç½®å¥½ä¹‹åæ˜¯ä¸å¯æ›´æ”¹çš„ï¼Œä¹‹åä½ æ–°åˆ›å»ºçš„ Worker å°±ä¼šä½¿ä»¥è¿™ä¸ªåŸŸåè€ŒäºŒçº§å­åŸŸåå¼€å§‹çš„ï¼Œç±»ä¼¼äº  <code>WorkerName.yousetdomain.workers.dev</code> ã€‚<code>yousetdomain</code> å°±æ˜¯ä½ è¦è®¾ç½®çš„äºŒçº§å­åŸŸåï¼Œ<code>WorkerName</code> å¯ä»¥è‡ªå®šä¹‰ï¼Œé»˜è®¤æ˜¯éšæœºç”Ÿæˆçš„ã€‚ä¹Ÿå¯ä»¥ç»™è‡ªå·±çš„åŸŸåæ·»åŠ ä¸€æ¡ CNAME åˆ° <code>WorkerName.yousetdomain.workers.dev</code> ï¼Œè¿™æ ·ä½¿ç”¨è‡ªå·±çš„åŸŸåå°±å¯ä»¥è®¿é—®åˆ° <code>Worker</code> äº†ã€‚</p><p>è®¾ç½®å¥½äºŒçº§å­åŸŸåä¹‹åé€‰æ‹© free å¥—é¤è®¡åˆ’ï¼Œç„¶åè¿›å…¥åˆ° Worker ç®¡ç†ç•Œé¢ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Worker</code>  ç„¶ååœ¨ <code>Script</code> è¾“å…¥æ¡†é‡Œå¡«å…¥ä»¥ä¸‹ä»£ç ã€‚<strong>ä¿—è¯è¯´ä»£ç å†™å¾—å¥½ï¼ŒåŒè¡ŒæŠ„åˆ°è€</strong>ï¼Œå’±çš„ <code>worker.js</code> ä»£ç æ˜¯å‚è€ƒè‡ª <a href="https://github.com/Siujoeng-Lau/Workers-Proxy" target="_blank" rel="noopener">Workers-Proxy</a> ï¼Œä¸è¿‡å’±å»æ‰äº†ä¸€äº›æ— å…³ç´§è¦çš„ä»£ç ï¼ŒåŸä»£ç æ˜¯åŠ å…¥äº†è¾¨åˆ«ç§»åŠ¨è®¾å¤‡é€‚é…åŸŸåã€å±è”½æŸäº› IP å’Œå›½å®¶çš„åŠŸèƒ½ã€‚å¯¹äºå’±çš„ telegram é¢‘é“é•œåƒç«™æ¥è¯´ï¼Œè¿™éƒ½æ˜¯å¤šä½™çš„ï¼Œäºæ˜¯å°±å»æ‰äº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200326184802562.png" alt="image-20200326184802562"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Website you intended to retrieve for users.</span></span><br><span class="line"><span class="keyword">const</span> upstream = <span class="string">'t.me'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Custom pathname for the upstream website.</span></span><br><span class="line"><span class="keyword">const</span> upstream_path = <span class="string">'/s/rss_kubernetes'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Whether to use HTTPS protocol for upstream address.</span></span><br><span class="line"><span class="keyword">const</span> https = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">addEventListener(<span class="string">'fetch'</span>, event =&gt; &#123;</span><br><span class="line">    event.respondWith(fetchAndApply(event.request));</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchAndApply</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> response = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="keyword">new</span> URL(request.url);</span><br><span class="line">    <span class="keyword">let</span> url_hostname = url.hostname;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (https == <span class="literal">true</span>) &#123;</span><br><span class="line">        url.protocol = <span class="string">'https:'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        url.protocol = <span class="string">'http:'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> upstream_domain = upstream;</span><br><span class="line">    url.host = upstream_domain;</span><br><span class="line">    <span class="keyword">if</span> (url.pathname == <span class="string">'/'</span>) &#123;</span><br><span class="line">        url.pathname = upstream_path;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        url.pathname = upstream_path + url.pathname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> method = request.method;</span><br><span class="line">    <span class="keyword">let</span> request_headers = request.headers;</span><br><span class="line">    <span class="keyword">let</span> new_request_headers = <span class="keyword">new</span> Headers(request_headers);</span><br><span class="line"></span><br><span class="line">    new_request_headers.set(<span class="string">'Host'</span>, url.hostname);</span><br><span class="line">    new_request_headers.set(<span class="string">'Referer'</span>, url.hostname);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> original_response = <span class="keyword">await</span> fetch(url.href, &#123;</span><br><span class="line">        method: method,</span><br><span class="line">        headers: new_request_headers</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> original_response_clone = original_response.clone();</span><br><span class="line">    <span class="keyword">let</span> original_text = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">let</span> response_headers = original_response.headers;</span><br><span class="line">    <span class="keyword">let</span> new_response_headers = <span class="keyword">new</span> Headers(response_headers);</span><br><span class="line">    <span class="keyword">let</span> status = original_response.status;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> content_type = new_response_headers.get(<span class="string">'content-type'</span>);</span><br><span class="line">    <span class="keyword">if</span> (content_type.includes(<span class="string">'text/html'</span>) &amp;&amp; content_type.includes(<span class="string">'UTF-8'</span>)) &#123;</span><br><span class="line">        original_text = <span class="keyword">await</span> replace_response_text(original_response_clone, upstream_domain, url_hostname);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        original_text = original_response_clone.body</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    response = <span class="keyword">new</span> Response(original_text, &#123;</span><br><span class="line">        status,</span><br><span class="line">        headers: new_response_headers</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> text = <span class="keyword">await</span> response.text()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> modified = text.replace(<span class="regexp">/telegram.org/g</span>, <span class="string">"telegram.k8srss.workers.dev"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Response(modified, &#123;</span><br><span class="line">        status: response.status,</span><br><span class="line">        statusText: response.statusText,</span><br><span class="line">        headers: response.headers</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåƒ <code>t.me</code> åŸŸåä¸‹çš„ç«™ç‚¹ï¼Œæ¯”å¦‚æˆ‘çš„ <code>https://t.me/s/rss_kubernetes</code> ï¼Œå®ƒçš„ js å’Œ css æ ·å¼æ–‡ä»¶æ˜¯ä½¿ç”¨çš„ telegram.org åŸŸåã€‚<del>æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ <code>replace_dict</code> é‚£é‡Œå®šä¹‰å¥½æ›¿æ¢çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œ</del>å°†  <code>https://t.me/s/rss_kubernetes</code>é¡µé¢é‡Œçš„  <code>telegram.org</code> åŒæ ·è¿›è¡Œåä»£æ‰è¡Œï¼Œè¿™éœ€è¦ä¸º telegram å»ºä¸€ä¸ªå•ç‹¬çš„ Worker ğŸ˜‘ã€‚è¿™ä¹Ÿæ˜¯è¯„è®ºåŒº  <a href="https://ichr.me/" target="_blank" rel="noopener">ChrAlpha</a> å°ä¼™ä¼´æåˆ°çš„åŠæ³•ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@blog:~$ curl https://t.me/s/rss_kubernetes | grep "<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span></span><br><span class="line"><span class="tag"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span></span><br><span class="line"><span class="tag"><span class="string">100  141k  100  141k    0     0  85287      0  0:00:01  0:00:01 --:--:-- 85237</span></span></span><br><span class="line"><span class="tag"><span class="string">    &lt;script src="</span>//<span class="attr">telegram.org</span>/<span class="attr">js</span>/<span class="attr">jquery.min.js</span>"&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//telegram.org/js/jquery-ui.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//telegram.org/js/widget-frame.js?29"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//telegram.org/js/telegram-web.js?8"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸‹å¤„ä»£ç ä¸ºï¼Œå°†<code>https://t.me/s/rss_kubernetes</code>é¡µé¢é‡Œçš„  <code>telegram.org</code> åŒæ ·è¿›è¡Œä¸€æ¬¡åä»£ã€‚è¿™æ ·è®¿é—®åˆ° <code>https://t.me/s/rss_kubernetes</code>é¡µé¢æ—¶ï¼ŒæŠŠçš„ telegram.org æ›¿æ¢ä¸ºå¦ä¸€ä¸ª Worker çš„åŸŸåï¼Œæ¯”å¦‚æˆ‘çš„ <code>telegram.k8srss.workers.dev</code>  ã€‚ä¸è¿‡åƒé¢‘é“é‡Œçš„å›¾ç‰‡ã€æ–‡ä»¶ã€è§†é¢‘ç­‰èµ„æº telegram æ˜¯ä½¿ç”¨çš„ CDN ï¼Œè€Œä¸”æœ‰å¥½å‡ ä¸ªåŸŸåâ€¦â€¦è¿™ç‚¹å¾ˆåƒµç¡¬ï¼Œæš‚æ—¶æ‰¾ä¸åˆ°åˆé€‚çš„åŠæ³•ã€‚è²Œä¼¼ä¸€ä¸ª Worker åªèƒ½åä»£ä¸€ä¸ªåŸŸåï¼Ÿå¦‚æœæ±æœ‰åˆé€‚çš„åŠæ³•ï¼Œæ¬¢è¿ä¸å’±äº¤æµï¼Œå’±æ„Ÿæ¿€ä¸å°½ğŸ˜‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> modified = text.replace(<span class="regexp">/telegram.org/g</span>, <span class="string">"telegram.k8srss.workers.dev"</span>)</span><br></pre></td></tr></table></figure><p>è¿™æ ·å†ä½¿ç”¨ curl è®¿é—®æµ‹è¯•ä¸€ä¸‹ï¼ŒåŸæ¥çš„ telegram.org å·²ç»å…¨éƒ¨æ›¿æ¢æˆ telegram.k8srss.workers.dev äº†ğŸ˜‚ã€‚ç°åœ¨å¢™å†…ç”¨æˆ·ä¹Ÿå¯ä»¥æ— ç—›è®¿é—®å•¦ã€‚åœ¨æ­¤æ„Ÿè°¢  <a href="https://ichr.me/" target="_blank" rel="noopener">ChrAlpha</a>  å°ä¼™ä¼´ğŸ˜‚æå‡ºå®è´µçš„å»ºè®®ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//telegram.k8srss.workers.dev/js/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//telegram.k8srss.workers.dev/js/jquery-ui.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//telegram.k8srss.workers.dev/js/widget-frame.js?29"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//telegram.k8srss.workers.dev/js/telegram-web.js?8"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="comment">&lt;!-- page generated in 121.26ms --&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–‡æœ¬æ›¿æ¢åŠŸèƒ½å¾ˆå¥½ç©å„¿ï¼Œåœ¨ Cloudflare å®˜æ–¹çš„åšå®¢é‡Œè¿˜æœ‰ä¸ª demo <a href="https://cloudflareworkers.com/#c62c6c0002cb236166b794c440870cca:https://blog.cloudflare.com/introducing-cloudflare-workers" target="_blank" rel="noopener">introducing-cloudflare-workers</a> ã€‚ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½å’±æœ‰è§£é”äº†ä¸€ä¸ªç©å…·ï¼Œç¨åå†è®²ğŸ˜‚ã€‚</p><blockquote><p>Here is a worker which performs a site-wide search-and-replace, replacing the word â€œWorkerâ€ with â€œMinionâ€. <a href="https://cloudflareworkers.com/#c62c6c0002cb236166b794c440870cca:https://blog.cloudflare.com/introducing-cloudflare-workers" target="_blank" rel="noopener">Try it out on this blog post.</a></p></blockquote><p><del>å‰½çªƒ</del>ä¿®æ”¹å¥½ä»£ç ä¹‹åç‚¹å‡»å·¦ä¸‹è§’çš„ <code>Save and Deploy</code> ç„¶å Preview çœ‹çœ‹é¡µé¢æ˜¯å¦æ˜¾ç¤ºæ­£å¸¸ï¼Œå¦‚æœæ˜¾ç¤ºæ­£å¸¸æ­å–œä½ æˆåŠŸå•¦ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200326190914520.png" alt="image-20200326190914520"></p><p>å¦‚æœä½ æƒ³ä½¿ç”¨è¿™ç§åŠæ³•åä»£å…¶ä»–é¢‘é“ï¼Œåªéœ€è¦æŠŠ <code>const upstream_path = &#39;/s/rss_kubernetes&#39;</code> åçš„  rss_kubernetes æ›¿æ¢ä¸ºä½ æƒ³è¦ä»£ç†çš„ telegram é¢‘é“ username å³å¯ã€‚ä¹‹æ‰€ä»¥åŠ ä¸Š <code>upstream_path</code>  è€Œä¸åä»£æ•´ä¸ª <code>t.me</code> æ˜¯ä¸ºäº†é˜²æ­¢åˆ«äººæ»¥ç”¨ï¼Œæ¯•ç«Ÿ 10W æ¬¡ä¸ç»è–…ğŸ˜‚</p><h3 id="æ”¹è¿›"><a href="#æ”¹è¿›" class="headerlink" title="æ”¹è¿›"></a>æ”¹è¿›</h3><p>å‘¨å››æ™šä¸Šç¡è§‰å‰åœ¨æ¨ç‰¹ä¸Šå‘äº†ä¸ªæ¨æ–‡ï¼Œå‘å¤§å®¶è¯·æ•™äº†ä¸€ä¸‹ä¹‹å‰ä¸€ä¸ª Worker é‡Œåªèƒ½åä»£ä¸€ä¸ªåŸŸåçš„é—®é¢˜ã€‚ç¬¬äºŒå¤© <a href="https://twitter.com/Echowxsy" target="_blank" rel="noopener">@Echowxsy</a> å°±å›å¤å’±äº†ï¼Œè€Œä¸”è¿˜ç‰¹æ„æ³¨å†Œäº† CouldFare è´¦å·ä½¿ç”¨ Workers å¸®å’±æµ‹è¯•äº†ä¸€ä¸‹ã€‚åœ¨æ­¤éå¸¸æ„Ÿè°¢ <a href="https://twitter.com/Echowxsy" target="_blank" rel="noopener">@Echowxsy</a>  å¸®å’±ã€‚æŒ‰ç…§  <a href="https://twitter.com/Echowxsy" target="_blank" rel="noopener">@Echowxsy</a> å°ä¼™ä¼´æ‰€è¯´çš„ï¼š</p><blockquote><p>æˆ‘æ²¡ç”¨è¿‡ CloudFlareï¼Œä¸è¿‡æˆ‘çœ‹äº†ä¸€ä¸‹ä½ çš„blogï¼Œè²Œä¼¼å¯ä»¥ç”¨ä¸¤ä¸ªupstreamå®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ åœ¨modifiedé‚£é‡Œæ›¿æ¢ä¸ºå½“å‰workerçš„åœ°å€ï¼Œç„¶ååœ¨åé¢åŠ ä¸Šä¸€ä¸ªä¸ä¼šé‡å¤çš„è·¯å¾„ï¼Œä¾‹å¦‚xxxã€‚ ç„¶ååœ¨fetchAndApplyé‡Œé¢åˆ¤æ–­ï¼Œå¦‚æœå½“å‰è¯·æ±‚çš„pathname=/xxxï¼Œä½¿ç”¨upstream2ï¼Œå¦åˆ™ä½¿ç”¨upstream1ã€‚ ç†è®ºä¸Šæ˜¯å¯ä»¥å®ç°çš„ã€‚</p><p>å°±æ˜¯ä¸€ä¸ª Workers å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œä»–å®é™…ä¸Šå°±æ˜¯ Node.js ä»£ç ã€‚ ç„¶åè¿™é‡Œæ˜¯å°† <a href="https://t.co/wTGzY4U6sD?amp=1" target="_blank" rel="noopener">http://telegram.org/xxxx</a> æ˜ å°„åˆ° <a href="https://t.co/yQwEY2mzCP?amp=1" target="_blank" rel="noopener">http://tg.k8s.li/static/xxxx</a> ã€‚ ç„¶ååœ¨ Workers é‡Œé¢åˆ¤æ–­ï¼Œå¦‚æœæœ‰ <code>/static</code> åˆ™ä» <a href="https://t.co/VYm4zCfwPr?amp=1" target="_blank" rel="noopener">http://telegram.org</a> è·å–ï¼Œå¦åˆ™ä» <a href="https://t.co/N4Ahg0VLN1?amp=1" target="_blank" rel="noopener">http://t.me</a> è·å–ã€‚</p></blockquote><p><code>æ­¤å¤„å¼•ç”¨</code> <a href="https://twitter.com/Echowxsy" target="_blank" rel="noopener">@Echowxsy</a> çš„ <a href="https://twitter.com/Echowxsy/status/1243407321989967874" target="_blank" rel="noopener">æ¨æ–‡</a></p><p>Woerker é¦–å…ˆæˆ‘ä»¬è·å–å®Œè¦åä»£çš„ <code>https://t.me/s/rss_kubernetes</code> é¡µé¢ html æºç ï¼Œç„¶åä½¿ç”¨ replace å‡½æ•°æŠŠ telegram.org ä»¥åŠcdn[1-5].telesco.pe ç­‰åŸŸåè¿›è¡Œæ›¿æ¢ï¼Œæ›¿æ¢ä¸º /static ã€/cdn[1-5] ç­‰ä¸åŒçš„ url è·¯å¾„ã€‚ç„¶åå°†ä¿®æ”¹åçš„ html é¡µé¢è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å®¢æˆ·ç«¯åœ¨è¯·æ±‚ <code>/static</code>  æ—¶ Worker å°±ä¼šå» <a href="https://t.co/VYm4zCfwPr?amp=1" target="_blank" rel="noopener">http://telegram.org</a> è·å–ç›¸åº”çš„èµ„æºè¿”å›ç»™ç”¨æˆ·ã€‚è¿™æ ·å°±å®ç°äº†ä¸€ä¸ª Worker åä»£å¤šä¸ªåŸŸåéªšæ“ä½œã€‚ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> upstream_me = <span class="string">'t.me'</span>;</span><br><span class="line"><span class="keyword">const</span> upstream_org = <span class="string">'telegram.org'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Custom pathname for the upstream website.</span></span><br><span class="line"><span class="keyword">const</span> upstream_path = <span class="string">'/s/rss_kubernetes'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Whether to use HTTPS protocol for upstream address.</span></span><br><span class="line"><span class="keyword">const</span> https = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Replace texts.</span></span><br><span class="line"><span class="keyword">const</span> replace_dict = &#123;</span><br><span class="line">  $upstream: <span class="string">'$custom_domain'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">addEventListener(<span class="string">'fetch'</span>, event =&gt; &#123;</span><br><span class="line">  event.respondWith(fetchAndApply(event.request));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchAndApply</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> response = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">let</span> url = <span class="keyword">new</span> URL(request.url);</span><br><span class="line">  <span class="keyword">let</span> url_hostname = url.hostname;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (https == <span class="literal">true</span>) &#123;</span><br><span class="line">    url.protocol = <span class="string">'https:'</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    url.protocol = <span class="string">'http:'</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> upstream_domain = upstream_me;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Check telegram.org</span></span><br><span class="line">  <span class="keyword">let</span> pathname = url.pathname;</span><br><span class="line">  <span class="built_in">console</span>.log(pathname);</span><br><span class="line">  <span class="keyword">if</span> (pathname.startsWith(<span class="string">'/static'</span>)) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'here'</span>);</span><br><span class="line">    upstream_domain = upstream_org;</span><br><span class="line">    url.pathname = pathname.replace(<span class="string">'/static'</span>, <span class="string">''</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (pathname == <span class="string">'/'</span>) &#123;</span><br><span class="line">      url.pathname = upstream_path;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      url.pathname = upstream_path + url.pathname;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  url.host = upstream_domain;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> method = request.method;</span><br><span class="line">  <span class="keyword">let</span> request_headers = request.headers;</span><br><span class="line">  <span class="keyword">let</span> new_request_headers = <span class="keyword">new</span> Headers(request_headers);</span><br><span class="line"></span><br><span class="line">  new_request_headers.set(<span class="string">'Host'</span>, url.hostname);</span><br><span class="line">  new_request_headers.set(<span class="string">'Referer'</span>, url.hostname);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> original_response = <span class="keyword">await</span> fetch(url.href, &#123;</span><br><span class="line">    method: method,</span><br><span class="line">    headers: new_request_headers</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> original_response_clone = original_response.clone();</span><br><span class="line">  <span class="keyword">let</span> original_text = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">let</span> response_headers = original_response.headers;</span><br><span class="line">  <span class="keyword">let</span> new_response_headers = <span class="keyword">new</span> Headers(response_headers);</span><br><span class="line">  <span class="keyword">let</span> status = original_response.status;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> content_type = new_response_headers.get(<span class="string">'content-type'</span>);</span><br><span class="line">  <span class="keyword">if</span> (content_type.includes(<span class="string">'text/html'</span>) &amp;&amp; content_type.includes(<span class="string">'UTF-8'</span>)) &#123;</span><br><span class="line">    original_text = <span class="keyword">await</span> replace_response_text(</span><br><span class="line">      original_response_clone,</span><br><span class="line">      upstream_domain,</span><br><span class="line">      url_hostname</span><br><span class="line">    );</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    original_text = original_response_clone.body;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  response = <span class="keyword">new</span> Response(original_text, &#123;</span><br><span class="line">    status,</span><br><span class="line">    headers: new_response_headers</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">let</span> text = <span class="keyword">await</span> response.text();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Modify it.</span></span><br><span class="line">  <span class="keyword">let</span> modified = text.replace(<span class="regexp">/telegram.org/g</span>,<span class="string">'tg.k8s.li/static'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Return modified response.</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Response(modified, &#123;</span><br><span class="line">    status: response.status,</span><br><span class="line">    statusText: response.statusText,</span><br><span class="line">    headers: response.headers</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰åŸŸå"><a href="#è‡ªå®šä¹‰åŸŸå" class="headerlink" title="è‡ªå®šä¹‰åŸŸå"></a>è‡ªå®šä¹‰åŸŸå</h2><p>å›åˆ° Workers çš„ç®¡ç†é¡µé¢ï¼Œç‚¹å‡» <code>rename</code> å³å¯ä¿®æ”¹ Worker çš„ä¸‰çº§å­åŸŸåã€‚ä¸è¿‡å’±è¿˜æ˜¯ä¸å¤ªå–œæ¬¢ <code>WorkerName.yousetdomain.workers.dev</code> è¿™ä¹ˆé•¿çš„åŸŸåï¼Œæƒ³ä½¿ç”¨å’±è‡ªå·±çš„äºŒçº§å­åŸŸåè®¿é—®ã€‚</p><p>é¦–å…ˆå›åˆ°åŸŸåç®¡ç†çš„é¡µé¢ï¼Œè¿›å…¥åˆ°è‡ªå·±åŸŸåé¡¶éƒ¨é‚£ä¸€æ é‡Œçš„ <code>Workers</code> ï¼Œåœ¨é‚£é‡Œæ·»åŠ ç›¸åº”çš„è·¯ç”±å³å¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200326191340166.png" alt="image-20200326191340166"></p><p>ç‚¹å‡» <code>Add Route</code> ï¼Œåœ¨ Route é‚£ä¸€æ è¾“å…¥å¥½è‡ªå·±çš„åŸŸåï¼Œæ³¨æ„æœ€åçš„ <code>/*</code> ä¹Ÿè¦åŠ ä¸Šï¼Œç„¶å Worker é€‰æ‹©åˆšåˆšåˆ›å»ºçš„é‚£ä¸ªå³å¯ã€‚æ¥ç€å†æ·»åŠ  <code>CNAME</code> è®°å½•åˆ°è‡ªå·±çš„ <code>WorkerName.yousetdomain.workers.dev</code> ï¼Œè¿™æ ·å°±èƒ½ä½¿ç”¨è‡ªå·±çš„åŸŸåè®¿é—®å•¦ğŸ˜‹</p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200326191435923.png" alt="image-20200326191435923"></p><h2 id="æ–‡æœ¬æ›¿æ¢"><a href="#æ–‡æœ¬æ›¿æ¢" class="headerlink" title="æ–‡æœ¬æ›¿æ¢"></a>æ–‡æœ¬æ›¿æ¢</h2><p>å‰æ–‡æåˆ°çš„æ–‡æœ¬æ›¿æ¢åŠŸèƒ½å¸®å’±è§£å†³äº†ä¸€ä¸ªå°é—®é¢˜ã€‚å’±å‹é“¾å…³æ³¨çš„ä¸€ä¸ªåšå®¢ <a href="https://chanshiyu.com/#/" target="_blank" rel="noopener">chanshiyu.com</a> æ²¡æœ‰æä¾› RSS ï¼Œä»–æ˜¯å°†åšå®¢å†…å®¹æ”¾åœ¨ GitHub issue ä¸Šï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡ RSSHUB æ¥è®¢é˜… GitHub çš„ issue æ¥è·å–åšå®¢çš„æ›´æ–°ã€‚ä½† RSSHUB è·å–çš„æ˜¯ GitHub issue çš„é“¾æ¥è€ŒéåŸåšå®¢çš„é“¾æ¥ï¼Œäºæ˜¯å’±æƒ³äº†æƒ³å°±ç”¨ <code>Worker</code> è¿›è¡Œæ›¿æ¢ä¸å¾—äº†ã€‚</p><p>é€šè¿‡ RSSHUB è·å–åˆ°çš„ RSS æ•°æ®å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">rss</span> <span class="attr">xmlns:atom</span>=<span class="string">"http://www.w3.org/2005/Atom"</span> <span class="attr">version</span>=<span class="string">"2.0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">channel</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span></span><br><span class="line">&lt;![CDATA[ chanshiyucx/blog Issues ]]&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span>&gt;</span>https://github.com/chanshiyucx/blog/issues<span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">atom:link</span> <span class="attr">href</span>=<span class="string">"http://rsshub.app/github/issue/chanshiyucx/blog"</span> <span class="attr">rel</span>=<span class="string">"self"</span> <span class="attr">type</span>=<span class="string">"application/rss+xml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">&lt;![CDATA[</span><br><span class="line">chanshiyucx/blog Issues - Made with love by RSSHub(https://github.com/DIYgod/RSSHub)</span><br><span class="line">]]&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span>&gt;</span>RSSHub<span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">webMaster</span>&gt;</span>i@diygod.me (DIYgod)<span class="tag">&lt;/<span class="name">webMaster</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">language</span>&gt;</span>zh-cn<span class="tag">&lt;/<span class="name">language</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">lastBuildDate</span>&gt;</span>Thu, 26 Mar 2020 11:00:06 GMT<span class="tag">&lt;/<span class="name">lastBuildDate</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ttl</span>&gt;</span>60<span class="tag">&lt;/<span class="name">ttl</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span></span><br><span class="line">&lt;![CDATA[ Telegram ç”µæŠ¥æœºå™¨äºº ]]&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">&lt;![CDATA[</span><br><span class="line">]]&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pubDate</span>&gt;</span>Wed, 25 Mar 2020 03:54:04 GMT<span class="tag">&lt;/<span class="name">pubDate</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">guid</span> <span class="attr">isPermaLink</span>=<span class="string">"false"</span>&gt;</span>https://github.com/chanshiyucx/blog/issues/108<span class="tag">&lt;/<span class="name">guid</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span>&gt;</span>https://github.com/chanshiyucx/blog/issues/108<span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„ <code>&lt;guid isPermaLink=&quot;false&quot;&gt;</code> å’Œ <code>&lt;link&gt;</code> ä¸­çš„é“¾æ¥ github.com/chanshiyucx/blog/issues/ æ›¿æ¢ä¸º chanshiyu.com/#/post/ å³å¯ã€‚äºæ˜¯è¿˜æ˜¯åŒæ ·çš„æ–¹æ³•æ–°å»ºä¸€ä¸ª Workerï¼Œç„¶åä¿®æ”¹ä¸€ä¸‹ <code>worker.js</code> çš„ä»£ç å°±å¯ä»¥å•¦ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Website you intended to retrieve for users.</span></span><br><span class="line"><span class="keyword">const</span> upstream = <span class="string">'rsshub.app'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Custom pathname for the upstream website.</span></span><br><span class="line"><span class="keyword">const</span> upstream_path = <span class="string">'/github/issue/chanshiyucx/blog'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Whether to use HTTPS protocol for upstream address.</span></span><br><span class="line"><span class="keyword">const</span> https = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">addEventListener(<span class="string">'fetch'</span>, event =&gt; &#123;</span><br><span class="line">    event.respondWith(fetchAndApply(event.request));</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchAndApply</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> response = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="keyword">new</span> URL(request.url);</span><br><span class="line">    <span class="keyword">let</span> url_hostname = url.hostname;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (https == <span class="literal">true</span>) &#123;</span><br><span class="line">        url.protocol = <span class="string">'https:'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        url.protocol = <span class="string">'http:'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> upstream_domain = upstream;</span><br><span class="line">    url.host = upstream_domain;</span><br><span class="line">    <span class="keyword">if</span> (url.pathname == <span class="string">'/'</span>) &#123;</span><br><span class="line">        url.pathname = upstream_path;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        url.pathname = upstream_path + url.pathname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> method = request.method;</span><br><span class="line">    <span class="keyword">let</span> request_headers = request.headers;</span><br><span class="line">    <span class="keyword">let</span> new_request_headers = <span class="keyword">new</span> Headers(request_headers);</span><br><span class="line"></span><br><span class="line">    new_request_headers.set(<span class="string">'Host'</span>, url.hostname);</span><br><span class="line">    new_request_headers.set(<span class="string">'Referer'</span>, url.hostname);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> original_response = <span class="keyword">await</span> fetch(url.href, &#123;</span><br><span class="line">        method: method,</span><br><span class="line">        headers: new_request_headers</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> original_response_clone = original_response.clone();</span><br><span class="line">    <span class="keyword">let</span> original_text = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">let</span> response_headers = original_response.headers;</span><br><span class="line">    <span class="keyword">let</span> new_response_headers = <span class="keyword">new</span> Headers(response_headers);</span><br><span class="line">    <span class="keyword">let</span> status = original_response.status;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> content_type = new_response_headers.get(<span class="string">'content-type'</span>);</span><br><span class="line">    <span class="keyword">if</span> (content_type.includes(<span class="string">'text/html'</span>) &amp;&amp; content_type.includes(<span class="string">'UTF-8'</span>)) &#123;</span><br><span class="line">        original_text = <span class="keyword">await</span> replace_response_text(original_response_clone, upstream_domain, url_hostname);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        original_text = original_response_clone.body</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    response = <span class="keyword">new</span> Response(original_text, &#123;</span><br><span class="line">        status,</span><br><span class="line">        headers: new_response_headers</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> text = <span class="keyword">await</span> response.text()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Modify it.</span></span><br><span class="line">    <span class="keyword">let</span> modified = text.replace(<span class="regexp">/github.com\/chanshiyucx\/blog\/issues\//g</span>, <span class="string">"chanshiyu.com\/#\/post\/"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Return modified response.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Response(modified, &#123;</span><br><span class="line">        status: response.status,</span><br><span class="line">        statusText: response.statusText,</span><br><span class="line">        headers: response.headers</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éƒ¨ç½²å¥½ Worker ä¹‹åå°±å¯ä»¥ä½¿ç”¨ RSS æ¥è®¢é˜…å•¦ğŸ˜‹</p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200326193643610.png" alt="image-20200326193643610"></p><h2 id="è§£é”æ›´å¤šå¥½ç©å„¿çš„ğŸ˜‹"><a href="#è§£é”æ›´å¤šå¥½ç©å„¿çš„ğŸ˜‹" class="headerlink" title="è§£é”æ›´å¤šå¥½ç©å„¿çš„ğŸ˜‹"></a>è§£é”æ›´å¤šå¥½ç©å„¿çš„ğŸ˜‹</h2><p>å…³äº Cloudflare çš„ Workers è¿˜æœ‰æ›´å¤šå¥½ç©çš„ç­‰å¾…ä½ å»å‘ç°ï¼Œå’±å°±æ¨èä¸€ä¸‹å•¦ï¼š</p><ul><li><a href="https://blog.ichr.me/post/cloudflare-worker-build-mirror-website/" target="_blank" rel="noopener">Cloudflare Worker å…è´¹æ­å»ºé•œåƒç«™</a></li><li><a href="https://blog.cloudflare.com/zh/cloudflare-workers-unleashed-zh/" target="_blank" rel="noopener">ä»ç°åœ¨èµ·ï¼Œä»»ä½•äººéƒ½å¯ä»¥åœ¨Cloudflareä¸Šä½¿ç”¨Workersè¿è¡ŒJavaScriptï¼</a></li><li><a href="https://blog.cloudflare.com/zh/just-write-code-improving-developer-experience-for-cloudflare-workers-zh/" target="_blank" rel="noopener">å°½æƒ…ç¼–å†™ä»£ç å§ï¼šæ”¹å–„å¼€å‘äººå‘˜ä½¿ç”¨Cloudflare Workersçš„ä½“éªŒ</a></li><li><a href="https://blog.skk.moe/post/cloudflare-workers-cfga" target="_blank" rel="noopener">ä½¿ç”¨ Cloudflare Workers åŠ é€Ÿ Google Analytics</a></li><li><a href="https://blog.meow.page/2019/09/24/free-personal-image-hosting-with-backblaze-b2-and-cloudflare-workers" target="_blank" rel="noopener">ä½¿ç”¨ Backblaze B2 å’Œ Cloudflare Workers æ­å»ºå¯ä»¥è‡ªå®šä¹‰åŸŸåçš„å…è´¹å›¾åºŠ</a></li><li><a href="https://free.com.tw/cloudflare-workers-wordpress/" target="_blank" rel="noopener">ä½¿ç”¨ Cloudflare Workers æé«˜ WordPress é€Ÿåº¦å’Œæ•ˆèƒ½æ•™å­¸</a></li><li><a href="https://yojigen.tech/archives/post19/" target="_blank" rel="noopener">ä½¿ç”¨Cloudflare Workersåå¸¦Pç«™å›¾ç‰‡</a></li></ul><p>æœ€åå®£ä¼ ä¸€ä¸‹å’±çš„<a href="https://t.me/rss_kubernetes" target="_blank" rel="noopener">@rss_kubernetes</a> é¢‘é“ï¼Œå›½å†…ç”¨æˆ·å¯ä»¥è®¿é—® <a href="https://tg.k8s.li" target="_blank" rel="noopener">tg.k8s.li</a>ï¼Œå¦‚æœä½ å¯¹ docker ã€K8sã€äº‘åŸç”Ÿç­‰æ„Ÿå…´è¶£ï¼Œå°±åˆ°å’±ç¢—é‡Œæ¥å§ğŸ˜‚ã€‚ä¸è®¢é˜…å’±çš„é¢‘é“ä¹Ÿå¯ä»¥é€šè¿‡å’±çš„ <a href="https://tg.k8s.li" target="_blank" rel="noopener">tg.k8s.li</a> é•œåƒç«™æ¥æŸ¥çœ‹ RSS æ¨é€ä¿¡æ¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200327003346742.png" alt="image-20200327003346742"></p><p>GitHub page åˆè¢«å¢™ä¸€æ³¢ï¼Œrsshub.app ä¹Ÿè¢«å¢™æ‰äº†ã€‚å¢™è¶Šæ¥è¶Šé«˜äº†ï¼Œè¿™ä¸ªç¤¾ä¼šä¹Ÿæ¥è¶Šå¯ç¬‘äº†â€¦â€¦ä¸çŸ¥é“æœªæ¥çš„äº’è”ç½‘ä¼šå˜æˆä»€ä¹ˆæ ·å­ï¼Œä½†æˆ‘ä»¬ä½œä¸ºä¸€åªå±æ°‘èƒ½åšçš„å°±æ˜¯<strong>ä¸ä¸ºå¢™æ·»ç –åŠ ç“¦ï¼Œä¸ä¸ºææƒä¸“åˆ¶ç‹¬è£æš´æ”¿å”±èµæ­Œ</strong>ã€‚æœ€åä¸€å¼ è‡ªå·±åˆ¶ä½œ kindle ç”µå­ä¹¦æ—¶å–œæ¬¢ä½¿ç”¨çš„å°é¢å›¾ç‰‡é€ç»™å¤§å®¶ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200326200247868.png" alt="image-20200326200247868"></p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;ä¸€æ¬¡å¶é‡&quot;&gt;&lt;a href=&quot;#ä¸€æ¬¡å¶é‡&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="telegram" scheme="https://blog.k8s.li/tags/telegram/"/>
    
      <category term="GFW" scheme="https://blog.k8s.li/tags/GFW/"/>
    
      <category term="CloudFlare" scheme="https://blog.k8s.li/tags/CloudFlare/"/>
    
  </entry>
  
  <entry>
    <title>Linux çš„å°ä¼™ä¼´ systemd è¯¦è§£</title>
    <link href="https://blog.k8s.li/systemd.html"/>
    <id>https://blog.k8s.li/systemd.html</id>
    <published>2020-03-18T16:00:00.000Z</published>
    <updated>2020-03-18T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å°æ’æ›²"><a href="#å°æ’æ›²" class="headerlink" title="å°æ’æ›²"></a>å°æ’æ›²</h2><p>æœ€è¿‘ <a href="https://www.bennythink.com/" target="_blank" rel="noopener">åœŸè±†å“¥</a> åœ¨æ£é¼“ <a href="https://github.com/webp-sh/webp_server_go" target="_blank" rel="noopener">Webp Server Go</a> çš„æ—¶å€™å‘å’±ä¸€å¼  <code>systemctl status webp</code> çš„ä¿¡æ¯ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200318080736564.png" alt="image-20200318080736564"></p><p>å’¦ï¼Ÿå’±çš„ <code>systemctl status webp</code> ä¸ºå•¥å­æ²¡å¾— CPU å’Œ Memory ä¿¡æ¯å‘ï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200318080903595.png" alt="image-20200318080903595"></p><p>ç„¶åå’ŒåœŸè±†å“¥è¯·æ•™äº†ä¸€ä¸‹ï¼Œå’±ä¹Ÿæƒ³è¦ã€‚äºæ˜¯åœŸè±†å“¥å‘å’±ä¸€ç¯‡ <a href="https://www.bennythink.com/systemd-accounting.html" target="_blank" rel="noopener">systemd â€“ systemctl ä¸æ˜¾ç¤ºå†…å­˜ CPU ä¿¡æ¯</a> åšå®¢ï¼Œäºæ˜¯æ‹œå¸ˆå­¦è‰ºå°± get åˆ°å•¦ğŸ˜‹ã€‚åªéœ€è¦åœ¨ systemd çš„é…ç½®æ–‡ä»¶ä¸­ <code>/etc/systemd/system.conf</code> è¿½åŠ </p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">DefaultCPUAccounting</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">DefaultMemoryAccounting</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">DefaultTasksAccounting</span>=<span class="literal">yes</span></span><br></pre></td></tr></table></figure><p>ç„¶åå† <code>systemctl daemon-reload</code> ä¸€æŠŠæ¢­å°±å¯ä»¥å•¦ğŸ˜‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@blog /home/ubuntu</span><br><span class="line">â•°â”€# systemctl status webps</span><br><span class="line">â— webps.service - WebP Server</span><br><span class="line">   Loaded: loaded (/opt/webps/webps.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Sat 2020-03-14 10:32:31 UTC; 4 days ago</span><br><span class="line">     Docs: https://github.com/n0vad3v/webp_server_go</span><br><span class="line"> Main PID: 20691 (webp-server)</span><br><span class="line">    Tasks: 36 (limit: 684)</span><br><span class="line">   Memory: 9.1M</span><br><span class="line">      CPU: 20.421s</span><br><span class="line">   CGroup: /system.slice/webps.service</span><br><span class="line">           â””â”€20691 /opt/webps/webp-server --config /opt/webps/config.json</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200318211715509.png" alt="image-20200318211715509"></p><p>ä¸è¿‡ï¼Œå’±è¿˜æ˜¯è¦æ·±å…¥åœ°å­¦ä¹ ä¸€ä¸‹ <code>systemd</code> ï¼Œäºæ˜¯å°±æ°´äº†è¿™ç¯‡åšå®¢ğŸ˜‚</p><h2 id="Linux-å¯åŠ¨æµç¨‹"><a href="#Linux-å¯åŠ¨æµç¨‹" class="headerlink" title="Linux å¯åŠ¨æµç¨‹"></a>Linux å¯åŠ¨æµç¨‹</h2><p>æåˆ° systemd ä¸å¾—ä¸æä¸€ä¸‹ Linux çš„å¯åŠ¨æµç¨‹ï¼Œè¿™æ ·æ‰èƒ½æ¸…æ¥š  systemd åœ¨ Linux ç³»ç»Ÿä¸­çš„åœ°ä½å’Œä½œç”¨ğŸ˜‹ã€‚æ‰€ä»¥å°±ç®€æ˜æ‰¼è¦ç¬¬ä»‹ç»ä¸€ä¸‹ Linux å¯åŠ¨çš„æµç¨‹ã€‚</p><p>Linux ä»æŒ‰ä¸‹ç”µæºé”®åˆ°è¿›å…¥ç”¨æˆ·äº¤äº’ç•Œé¢æ•´ä¸ªå¯åŠ¨æµç¨‹å¤§è‡´å¯ä»¥åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼š</p><ul><li><p>BIOS é˜¶æ®µ</p></li><li><p>BootLoader é˜¶æ®µ</p></li><li><p>kernel åŠ è½½é˜¶æ®µ</p></li><li><p>initï¼šsystemd/sysvinit åˆå§‹åŒ–é˜¶æ®µ</p></li></ul><h3 id="BIOS-EFI-é˜¶æ®µ"><a href="#BIOS-EFI-é˜¶æ®µ" class="headerlink" title="BIOS/EFI é˜¶æ®µ"></a>BIOS/EFI é˜¶æ®µ</h3><p>BIOS æƒ³å¿…å¤§å®¶éƒ½ç†Ÿæ‚‰ï¼Œä¹Ÿå°±æ˜¯åšä¸€äº›åŸºæœ¬çš„ç¡¬ä»¶è‡ªæ£€å‡†å¤‡ä»¥åŠåŠ è½½ bootloader ç¨‹åºã€‚åœ¨æŒ‰ä¸‹ç”µæºç”µæºé”®ï¼ˆå†·å¯åŠ¨ï¼‰åï¼Œ CPU çš„ç¨‹åºè®¡æ•°å™¨è¢«åˆå§‹åŒ–ä¸ºä¸€ä¸ªç‰¹å®šçš„å…§å­˜åœ°å€ï¼Œå­˜å‚¨åœ¨åªè¯»å­˜å‚¨å™¨ï¼ˆROMï¼‰ä¸­çš„ BIOS å°±æ˜¯ä»è¿™ä¸ªç‰¹å®šçš„å…§å­˜åœ°å€å¼€å§‹æ‰§è¡Œã€‚<strong>æ‰€ä»¥æ²¡æœ‰ CPU æ˜¯æ— æ³•å¯åŠ¨ä¸»æ¿ä¸Šçš„ BIOS çš„</strong> ï¼Œåº”è¯¥ï¼ˆå°å£°ã€‚æ³¨æ„ï¼šå¯¹äºåµŒå…¥å¼ç³»ç»Ÿä¸­çš„ CPU ï¼Œå°†ä¼šåŠ è½½å¼•å¯¼åŒºå»å¯åŠ¨ flash/ROM ä¸­å·²çŸ¥åœ°å€çš„ç¨‹åºã€‚</p><p>BIOS å¯åŠ¨åå°±å¼€å§‹æ‰§è¡Œç¡¬ä»¶çš„åŸºæœ¬åˆå§‹åŒ–ä¹Ÿç§°ä¹‹ä¸ºï¼ˆPOST: ä¸Šç”µè‡ªæ£€ï¼‰ï¼Œå¹¶æ ¹æ®å¼•å¯¼è®¾å¤‡çš„ä¼˜å…ˆçº§å°†ç³»ç»Ÿæ§åˆ¶æƒäº¤ç»™ç¡¬ä»¶å¯åŠ¨é¡¹ï¼ˆæ¯”å¦‚ç¡¬ç›˜/ç½‘ç»œ/Uç›˜ç­‰ï¼‰ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬ BIOS ä¸Šçš„å¯åŠ¨èœå•ï¼Œè¿™ä¸€æ­¥æ˜¯å¯ä»¥è¢«æ‰“æ–­çš„ã€‚å½“æˆ‘ä»¬æŒ‰ä¸‹ F12 æˆ–è€… ESC é”®ï¼ˆæ ¹æ®ä¸»æ¿èŠ¯ç‰‡ç»„è€Œå¼‚ï¼‰å°±ä¼šå¼¹å‡ºé€‰æ‹©å¯åŠ¨é¡¹çš„ç•Œé¢ï¼Œè€Œä¸”è¿™äº›æŒ‰é”®é«˜åº¦ä¾èµ–ç¡¬ä»¶ã€‚</p><p>BIOS é€‰æ‹©å¥½ç¡¬ä»¶å¯åŠ¨é¡¹ä¹‹åå°±å¼€å§‹æ‰§è¡Œç¡¬ä»¶è®¾å¤‡ä¸Šçš„åˆçº§å¼•å¯¼ç¨‹åºä»£ç ï¼Œå¯¹äº MBR ç¡¬ç›˜æ¥è®²æ˜¯æœ€å¼€å§‹çš„ä¸€ä¸ªæ‰‡åŒºï¼ˆ512å­—èŠ‚ï¼‰å°‡è¢«åŠ è½½åˆ°å…§å­˜ï¼Œä¸¦æ‰§è¡Œè¡Œå…¶ä¸­çš„åˆå§‹åŒ–ä»£ç æ¥åŠ è½½ä¸‹ä¸€é˜¶æ®µçš„ Bootloader ã€‚</p><p>PSï¼šMBR <strong>ä¸»å¼•å¯¼è®°å½•</strong>æ˜¯ä¸€ä¸ª 512 å­—èŠ‚çš„æ‰‡åŒºï¼Œä½äºç¡¬ç›˜çš„ç¬¬ä¸€æ‰‡åŒºï¼ˆ0é“0æŸ±1æ‰‡åŒºï¼‰ã€‚å¯¹äº GPT/EFI æ¥è®²~~ï¼Œæœ‰ç‚¹å¤´å¤§ï¼Œæš‚ä¸”å…ˆä¸è°ˆğŸ˜‚ã€‚</p><p>å¯ä»¥ä½¿ç”¨ dd å‘½ä»¤è¯»å– MBR é‡Œçš„å†…å®¹ <code>dd if=/dev/sda of=mbr.bin bs=512 count=1</code></p><p>ä½¿ç”¨ od å‘½ä»¤æ¥æŸ¥çœ‹ <code>od -xa mbr.bin</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> od -xa mbr.bin</span></span><br><span class="line">0000000    63eb    0090    0000    0000    0000    0000    0000    0000</span><br><span class="line">          k   c dle nul nul nul nul nul nul nul nul nul nul nul nul nul</span><br><span class="line">0000020    0000    0000    0000    0000    0000    0000    0000    0000</span><br><span class="line">        nul nul nul nul nul nul nul nul nul nul nul nul nul nul nul nul</span><br><span class="line">*</span><br><span class="line">0000120    0000    0000    0000    0000    0000    8000    0800    0000</span><br><span class="line">        nul nul nul nul nul nul nul nul nul nul nul nul nul  bs nul nul</span><br><span class="line">0000140    0000    0000    faff    9090    c2f6    7480    f605    70c2</span><br><span class="line">        nul nul nul nul del   z dle dle   v   B nul   t enq   v   B   p</span><br><span class="line">0000160    0274    80b2    79ea    007c    3100    8ec0    8ed8    bcd0</span><br><span class="line">          t stx   2 nul   j   y   | nul nul   1   @  so   X  so   P   &lt;</span><br><span class="line">0000200    2000    a0fb    7c64    ff3c    0274    c288    bb52    0417</span><br><span class="line">        nul  sp   &#123;  sp   d   |   &lt; del   t stx  bs   B   R   ; etb eot</span><br><span class="line">0000220    07f6    7403    be06    7d88    17e8    be01    7c05    41b4</span><br><span class="line">          v bel etx   t ack   &gt;  bs   &#125;   h etb soh   &gt; enq   |   4   A</span><br><span class="line">0000240    aabb    cd55    5a13    7252    813d    55fb    75aa    8337</span><br><span class="line">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br></pre></td></tr></table></figure><h3 id="BootLoader-é˜¶æ®µ"><a href="#BootLoader-é˜¶æ®µ" class="headerlink" title="BootLoader é˜¶æ®µ"></a>BootLoader é˜¶æ®µ</h3><p>ä¸»å¼•å¯¼è®°å½•åŠ è½½å®Œ Bootloaderï¼ˆä¸»è¦ä¸ºGRUBï¼‰åˆ° RAM ä¸­ä¹‹åï¼ŒGRUB ä¼šæ ¹æ®éœ€æ±‚æ˜¾ç¤ºä¸€ä¸ªå¯ç”¨çš„å†…æ ¸åˆ—è¡¨ï¼ˆå®šä¹‰åœ¨/etc/grub.confï¼Œä»¥åŠ/etc/grub/menu.lstå’Œ/etc/grub.confçš„è½¯è¿æ¥ï¼‰ã€‚æ ¹æ® GRUB çš„é…ç½®åŠ è½½é»˜è®¤å†…æ ¸é•œåƒå’Œ initrd é•œåƒåˆ°å†…å­˜ä¸­ï¼Œå½“æ‰€æœ‰é•œåƒå‡†å¤‡å¥½åï¼Œå³è·³è½¬åˆ°å†…æ ¸é•œåƒã€‚</p><h3 id="kernel-é˜¶æ®µ"><a href="#kernel-é˜¶æ®µ" class="headerlink" title="kernel é˜¶æ®µ"></a>kernel é˜¶æ®µ</h3><p>BootLoader é˜¶æ®µå®Œæˆä¹‹åå†…æ ¸é•œåƒåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç³»ç»Ÿçš„æ§åˆ¶æƒå°±äº¤ç»™å†…æ ¸é•œåƒï¼Œç”±æ­¤å†…æ ¸é˜¶æ®µå¼€å§‹äº†ã€‚å†…æ ¸é•œåƒä¸æ˜¯ä¸€ä¸ªå¯ä»¥æ‰§è¡Œçš„å†…æ ¸ï¼Œè€Œæ˜¯ä¸€ä¸ªè¢«å‹ç¼©çš„å†…æ ¸é•œåƒ ï¼ˆzImage æˆ– bzImageï¼‰ã€‚åœ¨å†…æ ¸é•œåƒçš„å¤´éƒ¨æœ‰ä¸€ä¸ªå°å‹ç¨‹åº routine ï¼Œå…¶åšå°‘é‡çš„ç¡¬ä»¶è®¾ç½®ï¼Œç„¶åè‡ªè§£å‹å‹ç¼©çš„å†…æ ¸é•œåƒå¹¶æ”¾åˆ°é«˜ç«¯å†…å­˜ã€‚å¦‚æœå­˜åœ¨åˆå§‹ç£ç›˜é•œåƒï¼ˆinitrdï¼‰ï¼Œroutine å°†æ‹·è´ initrd ä»¥ä¾›ç¨åå®‰è£…ä½¿ç”¨ï¼Œç„¶å routine å°†è°ƒç”¨å†…æ ¸å¼€å§‹å†…æ ¸å¯åŠ¨ã€‚</p><blockquote><p>åœ¨å†…æ ¸å¼•å¯¼è¿‡ç¨‹ä¸­ï¼Œåˆå§‹ RAM ç£ç›˜ï¼ˆinitrdï¼‰æ˜¯ç”± BootLoader åŠ è½½åˆ°å†…å­˜ä¸­çš„ï¼Œå®ƒä¼šè¢«å¤åˆ¶åˆ° RAM ä¸­å¹¶æŒ‚è½½åˆ°ç³»ç»Ÿä¸Šã€‚è¿™ä¸ª initrd ä½œä¸º RAM ä¸­çš„ä¸´æ—¶æ ¹æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ï¼Œå¹¶å…è®¸å†…æ ¸åœ¨æ²¡æœ‰æŒ‚è½½ä»»ä½•ç‰©ç†ç£ç›˜çš„æƒ…å†µä¸‹å®Œæ•´åœ°å®ç°å¼•å¯¼ã€‚ç”±äºä¸å¤–å›´è®¾å¤‡è¿›è¡Œäº¤äº’æ‰€éœ€è¦çš„æ¨¡å—å¯æ˜¯ initrd çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤å†…æ ¸å¯ä»¥éå¸¸å°ï¼Œä½†æ˜¯ä»ç„¶æ”¯æŒå¤§é‡å¯èƒ½çš„ç¡¬ä»¶é…ç½®ã€‚åœ¨å†…æ ¸å¯åŠ¨åï¼Œå°±å¯ä»¥æ­£å¼è£…å¤‡æ ¹æ–‡ä»¶ç³»ç»Ÿäº†ï¼ˆé€šè¿‡ pivot_rootï¼‰ï¼Œæ­¤æ—¶ä¼šå°† initrd æ ¹æ–‡ä»¶ç³»ç»Ÿå¸è½½æ‰ï¼Œå¹¶æŒ‚è½½çœŸæ­£çš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚<br>initrd å‡½æ•°è®©æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå°å‹çš„ Linux å†…æ ¸ï¼Œå…¶ä¸­åŒ…æ‹¬ä½œä¸ºå¯åŠ è½½æ¨¡å—ç¼–è¯‘çš„é©±åŠ¨ç¨‹åºã€‚è¿™äº›å¯åŠ è½½çš„æ¨¡å—ä¸ºå†…æ ¸æä¾›äº†è®¿é—®ç£ç›˜å’Œç£ç›˜ä¸Šçš„æ–‡ä»¶ç³»ç»Ÿçš„æ–¹æ³•ï¼Œå¹¶ä¸ºå…¶ä»–ç¡¬ä»¶æä¾›äº†é©±åŠ¨ç¨‹åºã€‚ç”±äºæ ¹æ–‡ä»¶ç³»ç»Ÿæ˜¯ç£ç›˜ä¸Šçš„ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤ initrd å‡½æ•°ä¼šæä¾›ä¸€ç§å¯åŠ¨æ–¹æ³•æ¥è·å¾—å¯¹ç£ç›˜çš„è®¿é—®ï¼Œå¹¶æŒ‚è½½çœŸæ­£çš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚åœ¨æ²¡æœ‰ç¡¬ç›˜çš„åµŒå…¥å¼ç›®æ ‡ä¸­ï¼Œinitrd å¯ä»¥æ˜¯æœ€ç»ˆçš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œæˆ–è€…ä¹Ÿå¯ä»¥é€šè¿‡ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆNFSï¼‰æ¥æŒ‚è½½æœ€ç»ˆçš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚</p></blockquote><p>å¯ä»¥ä½¿ç”¨ dmesg æ¥æŸ¥çœ‹ä»åŠ è½½å†…æ ¸åçš„æµç¨‹ï¼Œä¸‹ä¸€ç¯‡åšå®¢ä¼šå†™ä» dmesg æ—¥å¿—åˆ†æ Linux å†…æ ¸å¯åŠ¨æµç¨‹ï¼ˆæŒ–å‘</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@blog /home/ubuntu</span><br><span class="line">â•°â”€# dmesg</span><br><span class="line">[    0.000000] Linux version 5.0.0-1031-gcp (buildd@lcy01-amd64-020) (gcc version 7.4.0 (Ubuntu 7.4.0-1ubuntu1~18.04.1)) #32-Ubuntu SMP Tue Feb 11 03:55:48 UTC 2020 (Ubuntu 5.0.0-1031.32-gcp 5.0.21)</span><br><span class="line">[    0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-5.0.0-1031-gcp root=PARTUUID=9b22aacc-c8b9-497a-9583-a20c1be968c4 ro scsi_mod.use_blk_mq=Y console=ttyS0</span><br><span class="line">[    0.000000] KERNEL supported cpus:</span><br><span class="line">[    0.000000]   Intel GenuineIntel</span><br><span class="line">[    0.000000]   AMD AuthenticAMD</span><br><span class="line">[    0.000000]   Hygon HygonGenuine</span><br><span class="line">[    0.000000]   Centaur CentaurHauls</span><br><span class="line">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class="line">[    2.486896] Write protecting the kernel read-only data: 22528k</span><br><span class="line">[    2.489395] Freeing unused kernel image memory: 2016K</span><br><span class="line">[    2.490937] Freeing unused kernel image memory: 1708K</span><br><span class="line">[    2.500867] x86/mm: Checked W+X mappings: passed, no W+X pages found.</span><br><span class="line">[    2.503126] x86/mm: Checking user space page tables</span><br><span class="line">[    2.513767] x86/mm: Checked W+X mappings: passed, no W+X pages found.</span><br><span class="line">[    2.516258] Run /sbin/init as init process</span><br><span class="line">[    3.992535] systemd[1]: systemd 237 running in system mode. (+PAM +AUDIT +SELINUX +IMA +APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 +SECCOMP +BLKID +ELFUTILS +KMOD -IDN2 +IDN -PCRE2 default-hierarchy=hybrid)</span><br><span class="line">[    4.002297] systemd[1]: Detected virtualization kvm.</span><br><span class="line">[    4.004593] systemd[1]: Detected architecture x86-64.</span><br><span class="line">[    4.031531] systemd[1]: Set hostname to &lt;blog&gt;.</span><br><span class="line">[    5.343604] systemd[1]: Reached target Swap.</span><br><span class="line">[    5.355156] systemd[1]: Started Dispatch Password Requests to Console Directory Watch.</span><br><span class="line">[    5.367360] systemd[1]: Created slice User and Session Slice.</span><br><span class="line">[    5.379321] systemd[1]: Set up automount Arbitrary Executable File Formats File System Automount Point.</span><br><span class="line">[    5.395189] systemd[1]: Started Forward Password Requests to Wall Directory Watch.</span><br><span class="line">[    5.411078] systemd[1]: Reached target Local Encrypted Volumes.</span><br><span class="line">[    5.644759] EXT4-fs (sda1): re-mounted. Opts: (null)</span><br><span class="line">[   11.663490] bpfilter: Loaded bpfilter_umh pid 456</span><br></pre></td></tr></table></figure><h3 id="init-åˆå§‹åŒ–é˜¶æ®µ"><a href="#init-åˆå§‹åŒ–é˜¶æ®µ" class="headerlink" title="init åˆå§‹åŒ–é˜¶æ®µ"></a>init åˆå§‹åŒ–é˜¶æ®µ</h3><p>ä¸€æ—¦å†…æ ¸è‡ªè§£å‹å®Œæˆï¼Œå¯åŠ¨å¹¶åˆå§‹åŒ–åï¼Œå†…æ ¸å¯åŠ¨ç¬¬ä¸€ä¸ª<strong>ç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åº</strong>ï¼Œå³ systemd è¿›ç¨‹ï¼ˆå…¶æ˜¯è€å¼ System V ç³»ç»Ÿçš„ init ç¨‹åºçš„æ›¿ä»£å“)ï¼Œå¹¶è½¬ç§»æ§åˆ¶æƒåˆ° systemdã€‚è¿™æ˜¯è°ƒç”¨çš„ç¬¬ä¸€ä¸ªä½¿ç”¨æ ‡å‡† C åº“ç¼–è¯‘çš„ç¨‹åºï¼Œåœ¨æ­¤è¿›ç¨‹ä¹‹å‰ï¼Œè¿˜æ²¡æœ‰æ‰§è¡Œä»»ä½•æ ‡å‡†çš„ C åº”ç”¨ç¨‹åºã€‚è‡³æ­¤æ•´ä¸ªç³»ç»Ÿå¼•å¯¼è¿‡ç¨‹çš„ç»“æŸï¼Œkernelå’Œ systemd å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œæ¥ä¸‹æ¥å°±ç”± systemd æ¥å¯åŠ¨å„é¡¹ç¨‹åºã€‚</p><p>ä» dmesg çš„è¾“å‡ºæ—¥å¿—æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç›´åˆ° 2.516258 ç§’æ‰å¼€å§‹æ‰§è¡Œ <code>/sbin/init</code> å‘½ä»¤ï¼Œè€Œå¯¹äºé‡‡ç”¨ systemd çš„å‘è¡Œç‰ˆæ¥è¯´ï¼Œ<code>/sbin/init</code> æ˜¯æŒ‡å‘ <code>/sbin/init -&gt; /lib/systemd/systemd</code> ï¼Œçš„é“¾æ¥æ–‡ä»¶ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨å¯åŠ¨ systemd ğŸ˜‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[    2.516258] Run /sbin/init as init process</span><br><span class="line">[    3.992535] systemd[1]: systemd 237 running in system mode. (+PAM +AUDIT +SELINUX +IMA +APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 +SECCOMP +BLKID +ELFUTILS +KMOD -IDN2 +IDN -PCRE2 default-hierarchy=hybrid)</span><br></pre></td></tr></table></figure><h2 id="ä¸»è§’-systemd"><a href="#ä¸»è§’-systemd" class="headerlink" title="ä¸»è§’ systemd"></a>ä¸»è§’ systemd</h2><p>ä¸ºä»€ä¹ˆæ–‡ç« é¢˜åä¸º <strong>Linux çš„å°ä¼™ä¼´ systemd</strong> å‘ï¼Œå…¶å®å¹¿ä¹‰ä¸Šæ¥è®² Linux æ˜¯ä¼—å¤š Linux ç³»ç»Ÿå‘è¡Œç‰ˆçš„é›†åˆï¼Œä½†ä¸¥æ ¼æ¥è®² Linux ä»…ä»…æ˜¯ä¸€ä¸ª OS çš„ kernel è€Œå·²ï¼Œä»…ä»…æœ‰ä¸€ä¸ªå†…æ ¸æ˜¯æ— æ³•ç»„æˆä¸€ä¸ªç³»ç»Ÿçš„ï¼Œæ‰€ä»¥ Linux kernel è¿˜éœ€è¦ä»–çš„å‡ ä¸ªå…„å¼Ÿæ¯”å¦‚ GNU ã€ systemd ã€X Window ã€GNOME ã€ KDE ã€Xfce ç­‰ç­‰å…¶ä»–ç”¨æˆ·å±‚é¢çš„ç¨‹åºæ¥æ„å»ºå‡ºä¸€å¥—å®Œæ•´çš„æ“ä½œç³»ç»Ÿå‡ºæ¥ã€‚</p><p>è¿˜æœ‰å¦‚æœä½ è¦æ˜¯å½“ç€è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šä¸»å¸­ RMS <a href="https://zh.wikipedia.org/wiki/%E7%90%86%E6%9F%A5%E5%BE%B7%C2%B7%E6%96%AF%E6%89%98%E6%9B%BC" target="_blank" rel="noopener">ç†æŸ¥å¾·Â·æ–¯æ‰˜æ›¼</a> è¯´ Linux çš„è¯ï¼Œä»–ä¼šç»™ä½ å‘ç«å“¦ï¼Œä½ è¦è¯´ GNU/Linux æ‰è¡ŒğŸ˜‚ã€‚</p><p>å°† Debian å“²å­¦ä¸æ–¹æ³•è®ºï¼ŒGNU å·¥å…·é›†ã€Linux å†…æ ¸ï¼Œä»¥åŠå…¶ä»–é‡è¦çš„è‡ªç”±è½¯ä»¶ç»“åˆåœ¨ä¸€èµ·æ‰€æ„æˆçš„ç‹¬ç‰¹çš„è½¯ä»¶å‘è¡Œç‰ˆç§°ä¸º Debian GNU/Linuxã€‚å½“ä½ å°† Debian çš„å®‰è£…é•œåƒåˆ»å½•åˆ° U ç›˜ä¹‹åæ˜¾ç¤ºçš„åç§°å°±æ˜¯ <code>Debian GNU/Linux</code> ã€‚å…³äº GNU å’Œ Linux çš„æ•…äº‹å¯ä»¥å»çœ‹ä¸€å“ˆ <a href="https://zh.wikipedia.org/zh-cn/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%9D%A9%E5%91%BD" target="_blank" rel="noopener">æ“ä½œç³»ç»Ÿé©å‘½</a> çºªå½•ç‰‡ï¼Œä»¥åŠ RMS çš„è‡ªä¼ ã€Šè‹¥ä¸ºè‡ªç”±æ•…ï¼šè‡ªç”±è½¯ä»¶ä¹‹çˆ¶ç†æŸ¥å¾·Â·æ–¯æ‰˜æ›¼ä¼ ã€‹ä»¥åŠ Linus çš„è‡ªä¼ ã€Šåªæ˜¯ä¸ºäº†å¥½ç©å„¿ã€‹ã€‚</p><h3 id="systemd-ç®€ä»‹"><a href="#systemd-ç®€ä»‹" class="headerlink" title="systemd ç®€ä»‹"></a>systemd ç®€ä»‹</h3><p>è®²å®Œäº† Linux ç³»ç»Ÿå¯åŠ¨çš„æµç¨‹ï¼Œæ¥ä¸‹æ¥å°±åˆ°äº†æœ¬æ–‡çš„ä¸»è§’ <code>systemd</code> ä¸Šåœºå•¦ã€‚å‰½çªƒä¸€æ®µ archlinux.org ä¸Šçš„æ–‡æ¡£æ¥ä»‹ç»ä¸€ä¸‹ systemd ã€‚ï¼ˆarchlinux çš„æ–‡æ¡£æ˜¯åšçš„æœ€å¥½çš„å“¦ï¼</p><blockquote><p><em>systemd</em> æ˜¯ä¸€ä¸ª Linux ç³»ç»ŸåŸºç¡€ç»„ä»¶çš„é›†åˆï¼Œæä¾›äº†ä¸€ä¸ªç³»ç»Ÿå’ŒæœåŠ¡ç®¡ç†å™¨ï¼Œè¿è¡Œä¸º PID 1 å¹¶è´Ÿè´£å¯åŠ¨å…¶å®ƒç¨‹åºã€‚åŠŸèƒ½åŒ…æ‹¬ï¼š</p><ul><li>æ”¯æŒå¹¶è¡ŒåŒ–ä»»åŠ¡ï¼›</li><li>åŒæ—¶é‡‡ç”¨ socket å¼ä¸ <a href="https://wiki.archlinux.org/index.php/D-Bus_(ç®€ä½“ä¸­æ–‡)" target="_blank" rel="noopener">D-Bus</a> æ€»çº¿å¼æ¿€æ´»æœåŠ¡ï¼›</li><li>æŒ‰éœ€å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰ï¼›</li><li>åˆ©ç”¨ Linux çš„ <a href="https://wiki.archlinux.org/index.php/Cgroups" target="_blank" rel="noopener">cgroups</a> ç›‘è§†è¿›ç¨‹ï¼› # æœ¬æ–‡å¼€ç¯‡è®²åˆ°çš„ systemctl æ˜¾ç¤º CPU å’Œ  Mem ä¿¡æ¯å°±æ˜¯åŸºäºæ­¤å“¦ã€‚</li><li>æ”¯æŒå¿«ç…§å’Œç³»ç»Ÿæ¢å¤ï¼›</li><li>ç»´æŠ¤æŒ‚è½½ç‚¹å’Œè‡ªåŠ¨æŒ‚è½½ç‚¹ï¼›</li><li>å„æœåŠ¡é—´åŸºäºä¾èµ–å…³ç³»è¿›è¡Œç²¾å¯†æ§åˆ¶ã€‚</li><li>systemd* æ”¯æŒ SysV å’Œ LSB åˆå§‹è„šæœ¬ï¼Œå¯ä»¥æ›¿ä»£ sysvinitã€‚</li><li>é™¤æ­¤ä¹‹å¤–ï¼ŒåŠŸèƒ½è¿˜åŒ…æ‹¬æ—¥å¿—è¿›ç¨‹ã€æ§åˆ¶åŸºç¡€ç³»ç»Ÿé…ç½®ï¼Œç»´æŠ¤ç™»é™†ç”¨æˆ·åˆ—è¡¨ä»¥åŠç³»ç»Ÿè´¦æˆ·ã€è¿è¡Œæ—¶ç›®å½•å’Œè®¾ç½®ï¼Œå¯ä»¥è¿è¡Œå®¹å™¨å’Œè™šæ‹Ÿæœºï¼Œå¯ä»¥ç®€å•çš„ç®¡ç†ç½‘ç»œé…ç½®ã€ç½‘ç»œæ—¶é—´åŒæ­¥ã€æ—¥å¿—è½¬å‘å’Œåç§°è§£æç­‰ã€‚</li></ul></blockquote><p>è¿˜æœ‰ä¸€æ®µæ‘˜è‡ª <a href="https://systemd.io/" target="_blank" rel="noopener">systemd.io</a></p><blockquote><p>systemd is a suite of basic building blocks for a Linux system. It provides a system and service manager that runs as PID 1 and starts the rest of the system.</p><p>systemd provides aggressive parallelization capabilities, uses socket and D-Bus activation for starting services, offers on-demand starting of daemons, keeps track of processes using Linux control groups, maintains mount and automount points, and implements an elaborate transactional dependency-based service control logic. systemd supports SysV and LSB init scripts and works as a replacement for sysvinit.</p><p>Other parts include a logging daemon, utilities to control basic system configuration like the hostname, date, locale, maintain a list of logged-in users and running containers and virtual machines, system accounts, runtime directories and settings, and daemons to manage simple network configuration, network time synchronization, log forwarding, and name resolution.</p></blockquote><h3 id="systemd-è®¾è®¡ç›®æ ‡"><a href="#systemd-è®¾è®¡ç›®æ ‡" class="headerlink" title="systemd è®¾è®¡ç›®æ ‡"></a>systemd è®¾è®¡ç›®æ ‡</h3><ul><li>æ”¹è¿›æ•ˆèƒ½ã€‚ä½¿ç”¨äºŒè¿›åˆ¶ä»£ç æ›¿æ¢æ¾æ•£çš„SYSVå¯åŠ¨è„šæœ¬ï¼Œå‡å°‘é¢‘ç¹çš„è¿›ç¨‹åˆ›å»ºï¼Œåº“åŠ è½½ï¼Œå†…æ ¸/ç”¨æˆ·åˆ‡æ¢ã€‚</li><li>åˆ©ç”¨ Dbus è¿›ç¨‹é—´é€šè®¯ä¸ socket æ¿€æ´»æœºåˆ¶ï¼Œè§£å†³ä»»åŠ¡å¯åŠ¨æ—¶çš„ä¾èµ–é—®é¢˜ï¼Œå®ç°å¯åŠ¨å¹¶è¡ŒåŒ–ã€‚</li><li>å®ç°ä»»åŠ¡ï¼ˆdaemonsï¼‰çš„ç²¾ç¡®æ§åˆ¶ã€‚ä½¿ç”¨å†…æ ¸çš„ cgroup æœºåˆ¶ï¼Œä¸ä¾èµ– pid æ¥è¿½è¸ªè¿›ç¨‹ï¼Œå³ä½¿æ˜¯ä¸¤æ¬¡ forkä¹‹åç”Ÿæˆçš„å®ˆæŠ¤è¿›ç¨‹ä¹Ÿä¸ä¼šè„±ç¦» systemd çš„æ§åˆ¶ã€‚</li><li>ç»Ÿä¸€ä»»åŠ¡å®šä¹‰ã€‚ç”¨æˆ·ä¸éœ€è¦è‡ªè¡Œç¼–å†™ shell è„šæœ¬ï¼Œè€Œä»…ä¾æ® systemd åˆ¶å®šçš„ unit è§„åˆ™ã€‚</li></ul><h3 id="systemd-ä½“ç³»æ¶æ„"><a href="#systemd-ä½“ç³»æ¶æ„" class="headerlink" title="systemd ä½“ç³»æ¶æ„"></a>systemd ä½“ç³»æ¶æ„</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/systemd_components-svg.png" alt="img"></p><ul><li>æœ€åº•å±‚ï¼šsystemd å†…æ ¸å±‚é¢ä¾èµ– cgroupã€autofsã€kdbus</li><li>ç¬¬äºŒå±‚ï¼šsystemd libraries æ˜¯ systemd ä¾èµ–åº“</li><li>ç¬¬ä¸‰å±‚ï¼šsystemd Core æ˜¯ systemd è‡ªå·±çš„åº“</li><li>ç¬¬å››å±‚ï¼šsystemd daemons ä»¥åŠ targets æ˜¯è‡ªå¸¦çš„ä¸€äº›åŸºæœ¬ unitã€targetï¼Œç±»ä¼¼äº sysvinit ä¸­è‡ªå¸¦çš„è„šæœ¬</li><li>æœ€ä¸Šå±‚å°±æ˜¯å’Œ  systemd äº¤äº’çš„ä¸€äº›å·¥å…·</li></ul><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/linux_kernel_unified_hierarchy_cgroups_and_systemd-svg.png" alt="img"></p><h3 id="systemd-unit"><a href="#systemd-unit" class="headerlink" title="systemd unit"></a>systemd unit</h3><p>systemd å°†å„ç§ç³»ç»Ÿå¯åŠ¨å’Œè¿è¡Œç›¸å…³çš„å¯¹è±¡ï¼Œ è¡¨ç¤ºä¸ºå„ç§ä¸åŒç±»å‹çš„å•å…ƒ<code>unit</code>ï¼Œ å¹¶æä¾›äº† å¤„ç†ä¸åŒå•å…ƒä¹‹é—´ä¾èµ–å…³ç³»çš„èƒ½åŠ›ã€‚</p><table><thead><tr><th align="center">type</th><th align="center">name</th><th align="left">ä½œç”¨</th></tr></thead><tbody><tr><td align="center">Service unit</td><td align="center">.service</td><td align="left">ç”¨äºå°è£…ä¸€ä¸ªåå°æœåŠ¡è¿›ç¨‹</td></tr><tr><td align="center">Target unit</td><td align="center">.target</td><td align="left">ç”¨äºå°†å¤šä¸ªå•å…ƒåœ¨é€»è¾‘ä¸Šç»„åˆåœ¨ä¸€èµ·ã€‚</td></tr><tr><td align="center">Device unit</td><td align="center">.device</td><td align="left">ç”¨äºå®šä¹‰å†…æ ¸è¯†åˆ«çš„è®¾å¤‡ï¼Œåœ¨ sysfs(5) é‡Œé¢ä½œä¸º udev(7) è®¾å¤‡æ ‘å±•ç¤º</td></tr><tr><td align="center">Socket unit</td><td align="center">.socket</td><td align="left">ç”¨äºæ ‡è¯†è¿›ç¨‹é—´é€šä¿¡ç”¨åˆ°çš„socketæ–‡ä»¶</td></tr><tr><td align="center">Snapshot unit</td><td align="center">.snapshot</td><td align="left">ç®¡ç†ç³»ç»Ÿå¿«ç…§</td></tr><tr><td align="center">Swap unit</td><td align="center">.swap</td><td align="left">ç”¨äºæ ‡è¯†swap æ–‡ä»¶æˆ–è®¾å¤‡</td></tr><tr><td align="center">Mount unit</td><td align="center">.mount</td><td align="left">ç”¨äºå°è£…ä¸€ä¸ªæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹(ä¹Ÿå‘åå…¼å®¹ä¼ ç»Ÿçš„ /etc/fstab æ–‡ä»¶)</td></tr><tr><td align="center">Automount unit</td><td align="center">.automount</td><td align="left">ç”¨äºå°è£…ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿè‡ªåŠ¨æŒ‚è½½ç‚¹</td></tr><tr><td align="center">Path unit</td><td align="center">.path</td><td align="left">ç”¨äºæ ¹æ®æ–‡ä»¶ç³»ç»Ÿä¸Šç‰¹å®šå¯¹è±¡çš„å˜åŒ–æ¥å¯åŠ¨å…¶ä»–æœåŠ¡ã€‚</td></tr><tr><td align="center">Time unit</td><td align="center">.timer</td><td align="left">ç”¨äºå°è£…ä¸€ä¸ªåŸºäºæ—¶é—´è§¦å‘çš„åŠ¨ä½œã€‚å–ä»£ä¼ ç»Ÿçš„ crond ç­‰ä»»åŠ¡è®¡åˆ’æœåŠ¡</td></tr><tr><td align="center">Slice unit</td><td align="center">*.slice</td><td align="left">ç”¨äºæ§åˆ¶ç‰¹å®š CGroup å†…æ‰€æœ‰è¿›ç¨‹çš„æ€»ä½“èµ„æºå ç”¨ã€‚</td></tr></tbody></table><p>éœ€è¦æ³¨æ„çš„æ˜¯ systemd åªåœ¨å†…å­˜ä¸­åŠ è½½æœ€å°åŒ–çš„ä¸€ç»„å•å…ƒã€‚ åªæœ‰è‡³å°‘æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ä¹‹ä¸€çš„å•å…ƒï¼Œæ‰ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼š</p><ul><li><p>å¤„äº æ´»åŠ¨(active)ã€å¯åŠ¨ä¸­(activating)ã€åœæ­¢ä¸­(deactivating)ã€å¤±è´¥(failed) çŠ¶æ€ä¹‹ä¸€(ä¹Ÿå°±æ˜¯åœæ­¢(inactive)ä¹‹å¤–çš„çŠ¶æ€)</p></li><li><p>è‡³å°‘æœ‰ä¸€ä¸ªä½œä¸šæ­£åœ¨ä½œä¸šé˜Ÿåˆ—ä¸­</p></li><li><p>è‡³å°‘æœ‰ä¸€ä¸ªå…¶ä»–å·²ç»åŠ è½½åˆ°å†…å­˜ä¸­çš„å•å…ƒä¾èµ–äºå®ƒ</p></li><li><p>ä»ç„¶å æœ‰æŸäº›èµ„æº (ä¾‹å¦‚ä¸€ä¸ªå·²åœæ­¢çš„æœåŠ¡å•å…ƒçš„è¿›ç¨‹å¿½ç•¥äº†ç»ˆæ­¢è¯·æ±‚ï¼Œä»åœ¨é€—ç•™)</p></li><li><p>è¢« D-Bus è°ƒç”¨ä»¥ç¨‹åºåŒ–çš„æ–¹å¼å›ºå®šåˆ°äº†å†…å­˜ä¸­</p></li></ul><blockquote><p>åªè¦æœ‰éœ€è¦ï¼Œsystemd å°±ä¼šè‡ªåŠ¨ä»ç£ç›˜åŠ è½½æ‰€éœ€çš„å•å…ƒã€‚ å› æ­¤å®é™…ä¸Šç”¨æˆ·å¹¶ä¸èƒ½æ˜¾è€Œæ˜“è§çš„çœ‹åˆ°æŸä¸ªå•å…ƒæ˜¯å¦å·²è¢«åŠ è½½åˆ°å†…å­˜ã€‚ ä½¿ç”¨ <strong>systemctl list-units â€“all</strong> å‘½ä»¤å¯ä»¥æ˜¾ç¤ºå½“å‰å·²åŠ è½½åˆ°å†…å­˜ä¸­çš„æ‰€æœ‰å•å…ƒã€‚ ä¸æ»¡è¶³åŠ è½½æ¡ä»¶(è§ä¸Šæ–‡)çš„å•å…ƒä¼šè¢«ç«‹å³ä»å†…å­˜ä¸­å¸è½½ï¼Œå¹¶ä¸”å®ƒçš„è®°å¸æ•°æ®(accounting data)ä¹Ÿä¼šè¢«æ¸…ç©ºã€‚ ä¸è¿‡ï¼Œå› ä¸ºæ¯å½“ä¸€ä¸ªå•å…ƒå…³é—­æ—¶ï¼Œéƒ½ä¼šç”Ÿæˆä¸€æ¡æ—¥å¿—è®°å½•å£°æ˜è¯¥å•å…ƒæ‰€æ¶ˆè€—çš„èµ„æºï¼Œ æ‰€ä»¥è¿™äº›æ•°æ®é€šå¸¸ä¸ä¼šå½»åº•æ¶ˆå¤±ã€‚</p></blockquote><h3 id="systemd-unit-é…ç½®æ–‡ä»¶"><a href="#systemd-unit-é…ç½®æ–‡ä»¶" class="headerlink" title="systemd unit é…ç½®æ–‡ä»¶"></a>systemd unit é…ç½®æ–‡ä»¶</h3><ul><li>åœ¨ CentOS/RedHat å‘è¡Œç‰ˆä¸­ <code>man systemd.unit</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Table 1.  Load path when running in system mode (--system).</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚Path                    â”‚ Description                 â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚&#x2F;etc&#x2F;systemd&#x2F;system     â”‚ Local configuration         â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚&#x2F;run&#x2F;systemd&#x2F;system     â”‚ Runtime units               â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system â”‚ Units of installed packages â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><ul><li>åœ¨ Ubuntu/Debian å‘è¡Œç‰ˆä¸­ <code>man systemd.unit</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Table 1.  Load path when running in system mode (--system).</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚Path                â”‚ Description                 â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚&#x2F;etc&#x2F;systemd&#x2F;system â”‚ Local configuration         â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚&#x2F;run&#x2F;systemd&#x2F;system â”‚ Runtime units               â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚&#x2F;lib&#x2F;systemd&#x2F;system â”‚ Units of installed packages â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><p>ä¸åŒçš„å‘è¡Œç‰ˆ systemd unit çš„ path ä¸ä¸€æ ·å“¦ï¼Œä¸è¿‡ systemd çš„é…ç½®æ–‡ä»¶ä¸»è¦ä½äºä»¥ä¸‹ä¸‰ä¸ªç›®å½•ä¸­</p><ul><li><p><code>/usr/lib/systemd/system</code> æˆ– <code>/lib/systemd</code> : ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…çš„è½¯ä»¶çš„ systemd unit ä»¶å®é™…é…ç½®æ–‡ä»¶çš„å­˜æ”¾ä½ç½®</p></li><li><p><code>/run/systemd/system</code>ï¼šåœ¨è¿è¡Œæ—¶åˆ›å»ºçš„s ystemd unit æ–‡ä»¶ã€‚è¯¥ç›®å½•ä¼˜å…ˆäºå·²å®‰è£…æœåŠ¡å•å…ƒæ–‡ä»¶çš„ç›®å½•ã€‚</p><p>  <code>/etc/systemd/system</code>:  ä¼˜å…ˆçº§æœ€é«˜ï¼Œç”± systemctl å‘½ä»¤åˆ›å»ºçš„ systemd unit æ–‡ä»¶ä»¥åŠä¸ºæ‰©å±•æœåŠ¡è€Œæ·»åŠ çš„ unit æ–‡ä»¶éƒ½å°†å¯ç”¨ã€‚</p></li></ul><p>åœ¨ä½¿ç”¨ yum/apt æˆ–å…¶ä»–åŒ…ç®¡ç†å™¨ï¼Œä»¥åŠ rpm/deb ç­‰è½¯ä»¶åŒ…å®‰è£…è½¯ä»¶çš„æ—¶å€™ï¼Œå¦‚æœè¯¥è½¯ä»¶æ”¯æŒ systemd ç®¡ç†çš„è¯ï¼Œå°±ä¼šè‡ªåŠ¨åœ¨<code>/usr/lib/systemd/system</code>ç›®å½•æ·»åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚å¯ä»¥ç”¨è¿‡  systemctl cat name æ¥æŸ¥çœ‹è¯¥è½¯ä»¶çš„  systemd å•å…ƒæ–‡ä»¶ï¼Œæ¯”å¦‚æŸ¥çœ‹ä¸€ä¸‹ nginx çš„ <code>nginx.service</code> æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~</span><br><span class="line">â•°â”€# systemctl cat nginx                                                                                         1 â†µ</span><br><span class="line"><span class="meta">#</span><span class="bash"> /lib/systemd/system/nginx.service</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Stop dance <span class="keyword">for</span> nginx</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> =======================</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ExecStop sends SIGSTOP (graceful stop) to the nginx process.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If, after 5s (--retry QUIT/5) nginx is still running, systemd takes control</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and sends SIGTERM (fast shutdown) to the main process.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> After another 5s (TimeoutStopSec=5), and <span class="keyword">if</span> nginx is alive, systemd sends</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> SIGKILL to all the remaining processes <span class="keyword">in</span> the process group (KillMode=mixed).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> nginx signals reference doc:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> http://nginx.org/en/docs/control.html</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=A high performance web server and a reverse proxy server</span><br><span class="line">Documentation=man:nginx(8)</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/run/nginx.pid</span><br><span class="line">ExecStartPre=/usr/sbin/nginx -t -q -g 'daemon on; master_process on;'</span><br><span class="line">ExecStart=/usr/sbin/nginx -g 'daemon on; master_process on;'</span><br><span class="line">ExecReload=/usr/sbin/nginx -g 'daemon on; master_process on;' -s reload</span><br><span class="line">ExecStop=-/sbin/start-stop-daemon --quiet --stop --retry QUIT/5 --pidfile /run/nginx.pid</span><br><span class="line">TimeoutStopSec=5</span><br><span class="line">KillMode=mixed</span><br><span class="line"></span><br><span class="line">[Install]</span><br></pre></td></tr></table></figure><p>å¦‚æœè½¯ä»¶æ²¡æœ‰è‡ªå¸¦ systemd é…ç½®æ–‡ä»¶çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±æ“ä¸€ä¸ªé…ç½®æ–‡ä»¶å‡ºæ¥ï¼Œå¹¶å¤åˆ¶åˆ°ç›¸åº”çš„ç›®å½•ä¸‹å³å¯ã€‚æ¯”æˆ‘æˆ‘ä»¬çš„ <a href="https://github.com/webp-sh/webp_server_go" target="_blank" rel="noopener">Webp Server Go</a> çš„ <code>webps.service</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=WebP Server Go</span><br><span class="line"><span class="attr">Documentation</span>=https://github.com/webp-sh/webp_server_go</span><br><span class="line"><span class="attr">After</span>=nginx.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">StandardError</span>=journal</span><br><span class="line"><span class="attr">WorkingDirectory</span>=/opt/webps</span><br><span class="line"><span class="attr">ExecStart</span>=/opt/webps/webp-server --config /opt/webps/config.json</span><br><span class="line"><span class="attr">Restart</span>=always</span><br><span class="line"><span class="attr">RestartSec</span>=<span class="number">3</span>s</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><p>å…³äº systemd çš„å•å…ƒé…ç½®æ–‡ä»¶å¦‚ä½•ä¹¦å†™ï¼Œå› ä¸ºæ ¹æ®ä¸åŒçš„å•å…ƒç±»å‹åŒ…å«çš„é…ç½®é¡¹å®åœ¨æ˜¯å·¨å¤šã€‚ä¸æ˜¯ä¸‰è¨€ä¸¤è¯­å°±èƒ½è®²æ¸…çš„ï¼Œæ‰€ä»¥å¤§å®¶è¿˜æ˜¯å‚è€ƒä¸€ä¸‹ systemd çš„å®˜æ–¹æ–‡æ¡£/ç¤¾åŒºç¿»è¯‘æ–‡æ¡£ã€‚æ¯”å¦‚ <a href="http://www.jinbuguo.com/systemd/systemd.index.html" target="_blank" rel="noopener">systemd (ç®€ä½“ä¸­æ–‡)</a>ã€‚</p><h3 id="é“¾æ¥æ–‡ä»¶"><a href="#é“¾æ¥æ–‡ä»¶" class="headerlink" title="é“¾æ¥æ–‡ä»¶"></a>é“¾æ¥æ–‡ä»¶</h3><p>å½“æˆ‘ä»¬ä½¿ç”¨ reboot ã€poweroff ã€shutdown ç­‰å‘½ä»¤çš„æ—¶å€™ï¼Œå…¶å®å¹¶ä¸æ˜¯æ‰§è¡Œè¯¥å‘½ä»¤æœ¬èº«ï¼ŒèƒŒåæ˜¯è°ƒç”¨çš„ systemctl å‘½ä»¤ã€‚systemctl å‘½ä»¤ä¼šå°† reboot è¿™äº›å‘½ä»¤ä½œä¸º $1 å‚æ•°ä¼ é€’è¿›å»ã€‚æ‰€ä»¥æ‰§è¡Œ reboot å’Œ systemctl reboot æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /sbin</span><br><span class="line">â•°â”€# ls -alh /usr/bin /sbin /bin /usr/local/bin  | grep systemctl</span><br><span class="line">-rwxr-xr-x  1 root root 179K Feb  5 01:07 systemctl</span><br><span class="line">lrwxrwxrwx  1 root root      14 Feb  5 01:07 halt -&gt; /bin/systemctl</span><br><span class="line">lrwxrwxrwx  1 root root      14 Feb  5 01:07 poweroff -&gt; /bin/systemctl</span><br><span class="line">lrwxrwxrwx  1 root root      14 Feb  5 01:07 reboot -&gt; /bin/systemctl</span><br><span class="line">lrwxrwxrwx  1 root root      14 Feb  5 01:07 runlevel -&gt; /bin/systemctl</span><br><span class="line">lrwxrwxrwx  1 root root      14 Feb  5 01:07 shutdown -&gt; /bin/systemctl</span><br><span class="line">lrwxrwxrwx  1 root root      14 Feb  5 01:07 telinit -&gt; /bin/systemctl</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰å‰æ–‡æåˆ°çš„æœ‰ä¸€ç‚¹å°±æ˜¯ç»å¤§å¤šæ•°ä½¿ç”¨ systemd çš„å‘è¡Œç‰ˆéƒ½è®¾ç½®äº†ä¸€ä¸ªè½¯è¿æ¥ï¼Œç”± <code>/sbin/init -&gt; /lib/systemd/systemd</code>ã€‚å¦å¤–åœ¨ <code>/etc/systemd</code> ä¸‹ä¹Ÿæœ‰å¾ˆå¤šé“¾æ¥æ–‡ä»¶ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»åˆ†æä¸€ä¸‹ã€‚</p><h3 id="systemd-å¯åŠ¨æµç¨‹"><a href="#systemd-å¯åŠ¨æµç¨‹" class="headerlink" title="systemd å¯åŠ¨æµç¨‹"></a>systemd å¯åŠ¨æµç¨‹</h3><p>å›åˆ° Linux å¯åŠ¨æµç¨‹ï¼Œå½“å†…æ ¸åŠ è½½åˆ°å†…å­˜ä¸­åå¼€å§‹æ‰§è¡Œ systemd ã€‚æ ¹æ® dmesg çš„æ—¥å¿—æˆ‘ä»¬å¯ä»¥äº†è§£åˆ° systemd å¯åŠ¨åæ‰§è¡Œäº†å“ªä¸€äº›æ“ä½œã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[    <span class="number">2</span><span class="variable">.516258</span>] Run /sbin/init as init process</span><br><span class="line">[    <span class="number">3</span><span class="variable">.992535</span>] systemd[<span class="number">1</span>]: systemd <span class="number">237</span> running in system mode. (+PAM +AUDIT +SELINUX +IMA +APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 +SECCOMP +BLKID +ELFUTILS +KMOD -IDN2 +IDN -PCRE2 <span class="keyword">default</span>-hierarchy=hybrid)</span><br><span class="line">[    <span class="number">4</span><span class="variable">.002297</span>] systemd[<span class="number">1</span>]: Detected virtualization kvm.</span><br><span class="line">[    <span class="number">4</span><span class="variable">.004593</span>] systemd[<span class="number">1</span>]: Detected architecture x86-<span class="number">64</span>.</span><br><span class="line">[    <span class="number">4</span><span class="variable">.031531</span>] systemd[<span class="number">1</span>]: Set hostname to &lt;blog&gt;.</span><br><span class="line">[    <span class="number">5</span><span class="variable">.343604</span>] systemd[<span class="number">1</span>]: Reached target Swap.</span><br><span class="line">[    <span class="number">5</span><span class="variable">.355156</span>] systemd[<span class="number">1</span>]: Started Dispatch Password Requests to Console Directory Watch.</span><br><span class="line">[    <span class="number">5</span><span class="variable">.367360</span>] systemd[<span class="number">1</span>]: Created slice User <span class="keyword">and</span> Session Slice.</span><br><span class="line">[    <span class="number">5</span><span class="variable">.379321</span>] systemd[<span class="number">1</span>]: Set up automount Arbitrary Executable File Formats File System Automount Point.</span><br><span class="line">[    <span class="number">5</span><span class="variable">.395189</span>] systemd[<span class="number">1</span>]: Started Forward Password Requests to Wall Directory Watch.</span><br><span class="line">[    <span class="number">5</span><span class="variable">.411078</span>] systemd[<span class="number">1</span>]: Reached target Local Encrypted Volumes.</span><br><span class="line">[    <span class="number">5</span><span class="variable">.644759</span>] EXT4-fs (sda1): re-mounted. Opts: (<span class="literal">null</span>)</span><br><span class="line">[    <span class="number">5</span><span class="variable">.702603</span>] RPC: Registered named UNIX socket transport <span class="keyword">module</span>.</span><br><span class="line">[    <span class="number">5</span><span class="variable">.704115</span>] RPC: Registered udp transport <span class="keyword">module</span>.</span><br><span class="line">[    <span class="number">5</span><span class="variable">.705318</span>] RPC: Registered tcp transport <span class="keyword">module</span>.</span><br><span class="line">[    <span class="number">5</span><span class="variable">.706573</span>] RPC: Registered tcp NFSv4<span class="variable">.1</span> backchannel transport <span class="keyword">module</span>.</span><br><span class="line">[    <span class="number">5</span><span class="variable">.825727</span>] Loading iSCSI transport <span class="keyword">class</span> v2<span class="variable">.0</span>-<span class="number">870</span>.</span><br><span class="line">[    <span class="number">5</span><span class="variable">.912079</span>] iscsi: registered transport (tcp)</span><br><span class="line">[    <span class="number">5</span><span class="variable">.942499</span>] systemd-journald[<span class="number">196</span>]: Received request to flush runtime journal from PID <span class="number">1</span></span><br><span class="line">[    <span class="number">5</span><span class="variable">.973269</span>] systemd-journald[<span class="number">196</span>]: File /<span class="keyword">var</span>/log/journal/<span class="number">7</span>bc72ce3e0aa559e38159aa4fa0547f9/system<span class="variable">.journal</span> corrupted <span class="keyword">or</span> uncleanly shut down, renaming <span class="keyword">and</span> replacing.</span><br></pre></td></tr></table></figure><blockquote><p>ä¸‹é¢çš„å›¾è¡¨è§£é‡Šäº† è¿™äº›å…·æœ‰ç‰¹å®šå«ä¹‰çš„ target å•å…ƒä¹‹é—´çš„ä¾èµ–å…³ç³» ä»¥åŠå„è‡ªåœ¨å¯åŠ¨æµç¨‹ä¸­çš„ä½ç½®ã€‚å›¾ä¸­çš„ç®­å¤´è¡¨ç¤ºäº†å•å…ƒä¹‹é—´çš„ä¾èµ–å…³ç³»ä¸å…ˆåé¡ºåºï¼Œ æ•´ä¸ªå›¾è¡¨æŒ‰ç…§è‡ªä¸Šè€Œä¸‹çš„æ—¶é—´é¡ºåºæ‰§è¡Œã€‚</p></blockquote><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span>-fs-pre<span class="variable">.target</span></span><br><span class="line">            |</span><br><span class="line">            v</span><br><span class="line">   (various mounts <span class="keyword">and</span>   (various swap   (various cryptsetup</span><br><span class="line">    fsck services...)     devices...)        devices...)       (various low-level   (various low-level</span><br><span class="line">            |                  |                  |             services: udevd,     API VFS mounts:</span><br><span class="line">            v                  v                  v             tmpfiles, random     mqueue, configfs,</span><br><span class="line">     <span class="keyword">local</span>-fs<span class="variable">.target</span>      swap<span class="variable">.target</span>     cryptsetup<span class="variable">.target</span>    seed, sysctl, ...)      debugfs, ...)</span><br><span class="line">            |                  |                  |                    |                    |</span><br><span class="line">            \<span class="number">__________________</span>|<span class="number">_________________</span> | <span class="meta">`_______________` |____________________/</span></span><br><span class="line">                                                 \|/</span><br><span class="line">                                                  v</span><br><span class="line">                                           sysinit<span class="variable">.target</span></span><br><span class="line">                                                  |</span><br><span class="line">             <span class="meta">`________________________________` /|\________________________________________</span></span><br><span class="line">            /                  |                  |                    |                    \</span><br><span class="line">            |                  |                  |                    |                    |</span><br><span class="line">            v                  v                  |                    v                    v</span><br><span class="line">        (various           (various               |                (various          rescue<span class="variable">.service</span></span><br><span class="line">       timers...)          paths...)              |               sockets...)               |</span><br><span class="line">            |                  |                  |                    |                    v</span><br><span class="line">            v                  v                  |                    v             *rescue<span class="variable">.target</span></span><br><span class="line">      timers<span class="variable">.target</span>      paths<span class="variable">.target</span>             |             sockets<span class="variable">.target</span></span><br><span class="line">            |                  |                  |                    |</span><br><span class="line">            v                  \<span class="number">_________________</span> | <span class="meta">`_______________` /</span></span><br><span class="line">                                                 \|/</span><br><span class="line">                                                  v</span><br><span class="line">                                            basic<span class="variable">.target</span></span><br><span class="line">                                                  |</span><br><span class="line">             <span class="meta">`________________________________` /|                                 emergency.service</span></span><br><span class="line">            /                  |                  |                                         |</span><br><span class="line">            |                  |                  |                                         v</span><br><span class="line">            v                  v                  v                                *emergency<span class="variable">.target</span></span><br><span class="line">        display-        (various system    (various system</span><br><span class="line">    manager<span class="variable">.service</span>         services           services)</span><br><span class="line">            |             required <span class="keyword">for</span>            |</span><br><span class="line">            |            graphical UIs)           v</span><br><span class="line">            |                  |          *multi-user<span class="variable">.target</span></span><br><span class="line">            |                  |                  |</span><br><span class="line">            \<span class="number">_________________</span> | <span class="meta">`_____________` /</span></span><br><span class="line">                              \|/</span><br><span class="line">                               v</span><br><span class="line">                  *graphical<span class="variable">.target</span></span><br></pre></td></tr></table></figure><ul><li>systemd æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªç›®æ ‡æ˜¯ <strong>default.target</strong>ã€‚ä½†å®é™…ä¸Š default.target æ˜¯æŒ‡å‘ <strong>graphical.target</strong> çš„è½¯é“¾æ¥ã€‚Graphical.target çš„å®é™…ä½ç½®æ˜¯<code>/usr/lib/systemd/system/graphical.target</code>ã€‚</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@ ~</span><br><span class="line">â•°â”€# cat /usr/lib/systemd/system/graphical.target</span><br><span class="line"><span class="comment">#  This file is part of systemd.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  systemd is free software; you can redistribute it and/or modify it</span></span><br><span class="line"><span class="comment">#  under the terms of the GNU Lesser General Public License as published by</span></span><br><span class="line"><span class="comment">#  the Free Software Foundation; either version 2.1 of the License, or</span></span><br><span class="line"><span class="comment">#  (at your option) any later version.</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Graphical Interface</span><br><span class="line"><span class="attr">Documentation</span>=man:systemd.special(<span class="number">7</span>)</span><br><span class="line"><span class="attr">Requires</span>=multi-user.target</span><br><span class="line"><span class="attr">Wants</span>=display-manager.service</span><br><span class="line"><span class="attr">Conflicts</span>=rescue.service rescue.target</span><br><span class="line"><span class="attr">After</span>=multi-user.target rescue.service rescue.target display-manager.service</span><br><span class="line"><span class="attr">AllowIsolate</span>=<span class="literal">yes</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨<strong>default.target</strong>è¿™ä¸ªé˜¶æ®µï¼Œä¼šå¯åŠ¨<strong>multi-user.target</strong>è€Œè¿™ä¸ª target å°†è‡ªå·±çš„å­å•å…ƒæ”¾åœ¨ç›®å½•<code>/etc/systemd/system/multi-user.target.wants</code>é‡Œã€‚è¿™ä¸ª target ä¸ºå¤šç”¨æˆ·æ”¯æŒè®¾å®šç³»ç»Ÿç¯å¢ƒã€‚é rootç”¨æˆ·ä¼šåœ¨è¿™ä¸ªé˜¶æ®µçš„å¼•å¯¼è¿‡ç¨‹ä¸­å¯ç”¨ã€‚é˜²ç«å¢™ç›¸å…³çš„æœåŠ¡ä¹Ÿä¼šåœ¨è¿™ä¸ªé˜¶æ®µå¯åŠ¨ã€‚<strong>multi-user.target</strong>ä¼šå°†æ§åˆ¶æƒäº¤ç»™å¦ä¸€å±‚<strong>basic.target</strong>ã€‚</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@docker-230 ~</span><br><span class="line">â•°â”€# cat /usr/lib/systemd/system/multi-user.target</span><br><span class="line"><span class="comment">#  This file is part of systemd.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  systemd is free software; you can redistribute it and/or modify it</span></span><br><span class="line"><span class="comment">#  under the terms of the GNU Lesser General Public License as published by</span></span><br><span class="line"><span class="comment">#  the Free Software Foundation; either version 2.1 of the License, or</span></span><br><span class="line"><span class="comment">#  (at your option) any later version.</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Multi-User System</span><br><span class="line"><span class="attr">Documentation</span>=man:systemd.special(<span class="number">7</span>)</span><br><span class="line"><span class="attr">Requires</span>=basic.target</span><br><span class="line"><span class="attr">Conflicts</span>=rescue.service rescue.target</span><br><span class="line"><span class="attr">After</span>=basic.target rescue.service rescue.target</span><br><span class="line"><span class="attr">AllowIsolate</span>=<span class="literal">yes</span></span><br></pre></td></tr></table></figure><ul><li><strong>basic.target</strong>å•å…ƒç”¨äºå¯åŠ¨æ™®é€šæœåŠ¡ç‰¹åˆ«æ˜¯å›¾å½¢ç®¡ç†æœåŠ¡ã€‚å®ƒé€šè¿‡<code>/etc/systemd/system/basic.target.wants</code>ç›®å½•æ¥å†³å®šå“ªäº›æœåŠ¡ä¼šè¢«å¯åŠ¨ï¼Œ<strong>basic.target</strong> ä¹‹åå°†æ§åˆ¶æƒäº¤ç»™ <strong>sysinit.target</strong>.</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@docker-230 ~</span><br><span class="line">â•°â”€# tree /etc/systemd/system/multi-user.target.wants</span><br><span class="line">/etc/systemd/system/multi-user.target.wants</span><br><span class="line">â”œâ”€â”€ auditd.service -&gt; /usr/lib/systemd/system/auditd.service</span><br><span class="line">â”œâ”€â”€ chronyd.service -&gt; /usr/lib/systemd/system/chronyd.service</span><br><span class="line">â”œâ”€â”€ crond.service -&gt; /usr/lib/systemd/system/crond.service</span><br><span class="line">â”œâ”€â”€ docker.service -&gt; /usr/lib/systemd/system/docker.service</span><br><span class="line">â”œâ”€â”€ firewalld.service -&gt; /usr/lib/systemd/system/firewalld.service</span><br><span class="line">â”œâ”€â”€ gitlab-runsvdir.service -&gt; /usr/lib/systemd/system/gitlab-runsvdir.service</span><br><span class="line">â”œâ”€â”€ irqbalance.service -&gt; /usr/lib/systemd/system/irqbalance.service</span><br><span class="line">â”œâ”€â”€ kdump.service -&gt; /usr/lib/systemd/system/kdump.service</span><br><span class="line">â”œâ”€â”€ NetworkManager.service -&gt; /usr/lib/systemd/system/NetworkManager.service</span><br><span class="line">â”œâ”€â”€ remote-fs.target -&gt; /usr/lib/systemd/system/remote-fs.target</span><br><span class="line">â”œâ”€â”€ rhel-configure.service -&gt; /usr/lib/systemd/system/rhel-configure.service</span><br><span class="line">â”œâ”€â”€ rsyslog.service -&gt; /usr/lib/systemd/system/rsyslog.service</span><br><span class="line">â”œâ”€â”€ sshd.service -&gt; /usr/lib/systemd/system/sshd.service</span><br><span class="line">â””â”€â”€ tuned.service -&gt; /usr/lib/systemd/system/tuned.service</span><br></pre></td></tr></table></figure><ul><li><strong>sysinit.target</strong>ä¼šå¯åŠ¨é‡è¦çš„ç³»ç»ŸæœåŠ¡ä¾‹å¦‚ç³»ç»ŸæŒ‚è½½ï¼Œå†…å­˜äº¤æ¢ç©ºé—´å’Œè®¾å¤‡ï¼Œå†…æ ¸è¡¥å……é€‰é¡¹ç­‰ç­‰ã€‚sysinit.target åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ä¼šä¼ é€’ç»™<strong>local-fs.target</strong>ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@docker-230 ~</span><br><span class="line">â•°â”€<span class="comment"># tree /etc/systemd/system/basic.target.wants</span></span><br><span class="line">/etc/systemd/system/basic.target.wants</span><br><span class="line">â”œâ”€â”€ microcode.service -&gt; /usr/lib/systemd/system/microcode.service</span><br><span class="line">â””â”€â”€ rhel-dmesg.service -&gt; /usr/lib/systemd/system/rhel-dmesg.service</span><br><span class="line"></span><br><span class="line">0 directories, 2 files</span><br></pre></td></tr></table></figure><ul><li><code>local-fs.target</code>ï¼Œè¿™ä¸ª target å•å…ƒä¸ä¼šå¯åŠ¨ç”¨æˆ·ç›¸å…³çš„æœåŠ¡ï¼Œå®ƒåªå¤„ç†åº•å±‚æ ¸å¿ƒæœåŠ¡ã€‚è¿™ä¸ª target ä¼šæ ¹æ® /etc/fstab å’Œ /etc/inittab æ¥æ‰§è¡Œç›¸å…³æ“ä½œã€‚</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@docker-230 ~</span><br><span class="line">â•°â”€# cat /usr/lib/systemd/system/sysinit.target</span><br><span class="line"><span class="comment">#  This file is part of systemd.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  systemd is free software; you can redistribute it and/or modify it</span></span><br><span class="line"><span class="comment">#  under the terms of the GNU Lesser General Public License as published by</span></span><br><span class="line"><span class="comment">#  the Free Software Foundation; either version 2.1 of the License, or</span></span><br><span class="line"><span class="comment">#  (at your option) any later version.</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=System Initialization</span><br><span class="line"><span class="attr">Documentation</span>=man:systemd.special(<span class="number">7</span>)</span><br><span class="line"><span class="attr">Conflicts</span>=emergency.service emergency.target</span><br><span class="line"><span class="attr">Wants</span>=local-fs.target swap.target</span><br><span class="line"><span class="attr">After</span>=local-fs.target swap.target emergency.service emergency.target</span><br></pre></td></tr></table></figure><h3 id="è¿›ç¨‹æ ‘"><a href="#è¿›ç¨‹æ ‘" class="headerlink" title="è¿›ç¨‹æ ‘"></a>è¿›ç¨‹æ ‘</h3><p>æˆ‘ä»¬ä½¿ç”¨ pstree å‘½ä»¤æ¥çœ‹ä¸€å“ˆè¿›ç¨‹æ ‘çš„çŠ¶æ€ï¼Œç”¨æˆ·ç©ºé—´çš„è¿›ç¨‹éƒ½æŒ‚åœ¨  PID ä¸º 1 çš„ systemd ä¸‹ã€‚ç”± systemd æ¥ç®¡ç†è¿›ç¨‹ä¼˜ç‚¹å¤šå¤š ğŸ˜‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~</span><br><span class="line">â•°â”€# pstree -p</span><br><span class="line">systemd(1)â”€â”¬â”€accounts-daemon(661)â”€â”¬â”€&#123;accounts-daemon&#125;(689)</span><br><span class="line">           â”‚                      â””â”€&#123;accounts-daemon&#125;(729)</span><br><span class="line">           â”œâ”€agetty(971)</span><br><span class="line">           â”œâ”€agetty(992)</span><br><span class="line">           â”œâ”€aria2c(1010)</span><br><span class="line">           â”œâ”€atd(653)</span><br><span class="line">           â”œâ”€containerd(2915)â”€â”¬â”€&#123;containerd&#125;(2928)</span><br><span class="line">           â”‚                  â”œâ”€&#123;containerd&#125;(2929)</span><br><span class="line">           â”‚                  â”œâ”€&#123;containerd&#125;(2930)</span><br><span class="line">           â”‚                  â”œâ”€&#123;containerd&#125;(2934)</span><br><span class="line">           â”‚                  â”œâ”€&#123;containerd&#125;(2935)</span><br><span class="line">           â”‚                  â”œâ”€&#123;containerd&#125;(2950)</span><br><span class="line">           â”‚                  â”œâ”€&#123;containerd&#125;(2951)</span><br><span class="line">           â”‚                  â”œâ”€&#123;containerd&#125;(2978)</span><br><span class="line">           â”‚                  â”œâ”€&#123;containerd&#125;(5360)</span><br><span class="line">           â”‚                  â””â”€&#123;containerd&#125;(8299)</span><br><span class="line">           â”œâ”€cron(639)â”€â”€â”€cron(20506)â”€â”€â”€sh(20507)â”€â”€â”€monitor.sh(20509)â”€â”€â”€ffmpeg(20514)</span><br><span class="line">           â”œâ”€dbus-daemon(664)</span><br><span class="line">           â”œâ”€dockerd(17771)â”€â”¬â”€&#123;dockerd&#125;(17783)</span><br><span class="line">           â”‚                â”œâ”€&#123;dockerd&#125;(17784)</span><br><span class="line">           â”‚                â”œâ”€&#123;dockerd&#125;(17785)</span><br><span class="line">           â”‚                â”œâ”€&#123;dockerd&#125;(17791)</span><br><span class="line">           â”‚                â”œâ”€&#123;dockerd&#125;(17793)</span><br><span class="line">           â”‚                â”œâ”€&#123;dockerd&#125;(17800)</span><br><span class="line">           â”‚                â”œâ”€&#123;dockerd&#125;(17803)</span><br><span class="line">           â”‚                â”œâ”€&#123;dockerd&#125;(3030)</span><br><span class="line">           â”‚                â””â”€&#123;dockerd&#125;(3031)</span><br><span class="line">           â”œâ”€fail2ban-server(755)â”€â”¬â”€&#123;fail2ban-server&#125;(1059)</span><br><span class="line">           â”‚                      â””â”€&#123;fail2ban-server&#125;(1060)</span><br><span class="line">           â”œâ”€iscsid(896)</span><br><span class="line">           â”œâ”€iscsid(897)</span><br><span class="line">           â”œâ”€lvmetad(392)</span><br><span class="line">           â”œâ”€networkd-dispat(622)â”€â”€â”€&#123;networkd-dispat&#125;(982)</span><br><span class="line">           â”œâ”€nginx(3305)â”€â”€â”€nginx(17700)</span><br><span class="line">           â”œâ”€php-fpm7.2(7497)â”€â”¬â”€php-fpm7.2(1295)</span><br><span class="line">           â”‚                  â”œâ”€php-fpm7.2(1296)</span><br><span class="line">           â”‚                  â””â”€php-fpm7.2(5611)</span><br><span class="line">           â”œâ”€polkitd(808)â”€â”¬â”€&#123;polkitd&#125;(820)</span><br><span class="line">           â”‚              â””â”€&#123;polkitd&#125;(822)</span><br><span class="line">           â”œâ”€rngd(981)</span><br><span class="line">           â”œâ”€rpcbind(7125)</span><br><span class="line">           â”œâ”€rsyslogd(11567)â”€â”¬â”€&#123;rsyslogd&#125;(11598)</span><br><span class="line">           â”‚                 â”œâ”€&#123;rsyslogd&#125;(11599)</span><br><span class="line">           â”‚                 â””â”€&#123;rsyslogd&#125;(11600)</span><br><span class="line">           â”œâ”€ss-server(17126)â”€â”€â”€obfs-server(17138)</span><br><span class="line">             â”œâ”€sshd(5357)â”€â”¬â”€sshd(15490)â”€â”€â”€sshd(15598)â”€â”€â”€zsh(15619)â”€â”€â”€pstree(20539)</span><br><span class="line">           â”‚            â”œâ”€sshd(20413)â”€â”€â”€sshd(20414)</span><br><span class="line">           â”‚            â””â”€sshd(20517)</span><br><span class="line">           â”œâ”€systemd(5715)â”€â”€â”€(sd-pam)(5718)</span><br><span class="line">           â”œâ”€systemd-journal(12866)</span><br><span class="line">           â”œâ”€systemd-logind(652)</span><br><span class="line">           â”œâ”€systemd-network(12827)</span><br><span class="line">           â”œâ”€systemd-resolve(12839)</span><br><span class="line">           â”œâ”€systemd-timesyn(12852)â”€â”€â”€&#123;systemd-timesyn&#125;(12861)</span><br><span class="line">           â””â”€systemd-udevd(8171)</span><br></pre></td></tr></table></figure><h2 id="ç®¡ç†-systemd"><a href="#ç®¡ç†-systemd" class="headerlink" title="ç®¡ç† systemd"></a>ç®¡ç† systemd</h2><p>è®²å®Œäº† systemd çš„åŸºç¡€çŸ¥è¯†ï¼Œæ¥ä¸‹æ¥å°±å¼€å§‹åŠ¨æ‰‹å®è·µï¼Œæ§åˆ¶ systemd çš„ä¸»è¦å‘½ä»¤ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>systemctl å‘½ä»¤æ§åˆ¶ <code>systemd</code> çš„ç®¡ç†ç³»ç»Ÿå’ŒæœåŠ¡çš„å‘½ä»¤è¡Œå·¥å…·</li><li>systemsdm å‘½ä»¤æ§åˆ¶ <code>systemd</code> çš„ç®¡ç†å’ŒæœåŠ¡çš„å›¾å½¢åŒ–å·¥å…·</li><li>journalctl å‘½ä»¤æŸ¥è©¢ <code>systemd</code> æ—¥å¿—ç³»ç»Ÿ</li><li>loginctl å‘½ä»¤æ§åˆ¶ <code>systemd</code> ç™»å…¥ç®¡ç†å™¨</li><li>systemd-analyze åˆ†æç³»ç»Ÿå¯åŠ¨æ•ˆèƒ½ï¼ˆç±»ä¼¼å¼€æœºæ—¶é—´ï¼Ÿ</li></ul><h3 id="systemctl-åŸºæœ¬ç”¨æ³•"><a href="#systemctl-åŸºæœ¬ç”¨æ³•" class="headerlink" title="systemctl åŸºæœ¬ç”¨æ³•"></a>systemctl åŸºæœ¬ç”¨æ³•</h3><h4 id="å¯åŠ¨-é‡å¯-åœæ­¢æœåŠ¡"><a href="#å¯åŠ¨-é‡å¯-åœæ­¢æœåŠ¡" class="headerlink" title="å¯åŠ¨/é‡å¯/åœæ­¢æœåŠ¡"></a>å¯åŠ¨/é‡å¯/åœæ­¢æœåŠ¡</h4><ul><li><code>systemctl start NAME</code></li><li><code>systemctl restart NAME</code></li><li><code>systemctl stop NAME</code></li></ul><h4 id="æŸ¥çœ‹æœåŠ¡çŠ¶æ€"><a href="#æŸ¥çœ‹æœåŠ¡çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹æœåŠ¡çŠ¶æ€"></a>æŸ¥çœ‹æœåŠ¡çŠ¶æ€</h4><p>å°±å¦‚æ–‡ç« å¼€å¤´æ‰€æåˆ°çš„ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æœ€ä¸‹é¢é‚£ç§å¸¦æ—¶é—´æˆ³çš„æ˜¯è¾“å‡ºçš„æ—¥å¿—</p><ul><li><code>systemctl status NAME</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@blog /home/ubuntu</span><br><span class="line">â•°â”€# systemctl status webps                                                                                    130 â†µ</span><br><span class="line">â— webps.service - WebP Server</span><br><span class="line">   Loaded: loaded (/opt/webps/webps.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Wed 2020-03-18 13:58:00 UTC; 22h ago</span><br><span class="line">     Docs: https://github.com/n0vad3v/webp_server_go</span><br><span class="line"> Main PID: 5732 (webp-server)</span><br><span class="line">    Tasks: 52 (limit: 684)</span><br><span class="line">   Memory: 185.2M</span><br><span class="line">      CPU: 1min 30.092s</span><br><span class="line">   CGroup: /system.slice/webps.service</span><br><span class="line">           â””â”€5732 /opt/webps/webp-server --config /opt/webps/config.json</span><br><span class="line"></span><br><span class="line">Mar 19 05:23:20 blog webp-server[5732]: Save to exhaushttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200109192923891.png.1584538399.webp ok</span><br></pre></td></tr></table></figure><h4 id="åˆ—å‡ºæ‰€æœ‰å•å…ƒï¼š"><a href="#åˆ—å‡ºæ‰€æœ‰å•å…ƒï¼š" class="headerlink" title="åˆ—å‡ºæ‰€æœ‰å•å…ƒï¼š"></a>åˆ—å‡ºæ‰€æœ‰å•å…ƒï¼š</h4><ul><li><code>systemctl list-unit-files</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@docker-230 ~</span><br><span class="line">â•°â”€<span class="comment"># systemctl list-unit-files</span></span><br><span class="line">UNIT FILE                                     STATE</span><br><span class="line">proc-sys-fs-binfmt_misc.automount             static</span><br><span class="line">dev-hugepages.mount                           static</span><br><span class="line">dev-mqueue.mount                              static</span><br></pre></td></tr></table></figure><h4 id="åˆ—å‡ºæ¿€æ´»çš„å•å…ƒ"><a href="#åˆ—å‡ºæ¿€æ´»çš„å•å…ƒ" class="headerlink" title="åˆ—å‡ºæ¿€æ´»çš„å•å…ƒ"></a>åˆ—å‡ºæ¿€æ´»çš„å•å…ƒ</h4><ul><li><code>systemctl list-units</code> ç­‰åŒäº <code>systemctl</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@docker-230 ~</span><br><span class="line">â•°â”€# systemctl list-units                                                                                      127 â†µ</span><br><span class="line">  UNIT                                         LOAD   ACTIVE SUB       DESCRIPTION</span><br><span class="line">  proc-sys-fs-binfmt_misc.automount            loaded active waiting   Arbitrary Executable File Formats File System</span><br><span class="line">  sys-devices-pci0000:00-0000:00:15.0-0000:03:00.0-host2-target2:0:0-2:0:0:0-block-sda-sda1.device loaded active plu</span><br><span class="line">  sys-devices-pci0000:00-0000:00:15.0-0000:03:00.0-host2-target2:0:0-2:0:0:0-block-sda-sda2.device loaded active plu</span><br></pre></td></tr></table></figure><h4 id="é‡æ–°è½½å…¥-systemdï¼Œæ‰«ææ–°çš„æˆ–æœ‰å˜åŠ¨çš„å•å…ƒï¼š"><a href="#é‡æ–°è½½å…¥-systemdï¼Œæ‰«ææ–°çš„æˆ–æœ‰å˜åŠ¨çš„å•å…ƒï¼š" class="headerlink" title="é‡æ–°è½½å…¥ systemdï¼Œæ‰«ææ–°çš„æˆ–æœ‰å˜åŠ¨çš„å•å…ƒï¼š"></a>é‡æ–°è½½å…¥ systemdï¼Œæ‰«ææ–°çš„æˆ–æœ‰å˜åŠ¨çš„å•å…ƒï¼š</h4><p>å½“å‘ systemd çš„ç›®å½•ä¸­æ·»åŠ æ˜¾å¾— unit æ–‡ä»¶åéœ€è¦ reload ä¸€ä¸‹æ‰èƒ½ç”Ÿæ•ˆ</p><ul><li><code>systemctl daemon-reload</code></li></ul><h4 id="æŸ¥è¯¢æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨"><a href="#æŸ¥è¯¢æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨" class="headerlink" title="æŸ¥è¯¢æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨"></a>æŸ¥è¯¢æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨</h4><ul><li><code>systemctl is-enabled crond</code></li></ul><h4 id="è®¾ç½®-å–æ¶ˆæœåŠ¡å¼€æœºè‡ªå¯"><a href="#è®¾ç½®-å–æ¶ˆæœåŠ¡å¼€æœºè‡ªå¯" class="headerlink" title="è®¾ç½®/å–æ¶ˆæœåŠ¡å¼€æœºè‡ªå¯"></a>è®¾ç½®/å–æ¶ˆæœåŠ¡å¼€æœºè‡ªå¯</h4><ul><li><code>systemctl enable NAME</code></li><li><code>systemctl disable NAME</code></li></ul><h4 id="è¿œç¨‹æ§åˆ¶å…¶ä»–æœåŠ¡å™¨çš„-systemd"><a href="#è¿œç¨‹æ§åˆ¶å…¶ä»–æœåŠ¡å™¨çš„-systemd" class="headerlink" title="è¿œç¨‹æ§åˆ¶å…¶ä»–æœåŠ¡å™¨çš„ systemd"></a>è¿œç¨‹æ§åˆ¶å…¶ä»–æœåŠ¡å™¨çš„ systemd</h4><p> <code>systemctl</code> å‚æ•°ä¸­æ·»åŠ  <code>-H &lt;ç”¨æˆ·å&gt;@&lt;ä¸»æœºå&gt;</code> å¯ä»¥å®ç°å¯¹å…¶ä»–æœºå™¨çš„è¿œç¨‹æ§åˆ¶ï¼Œè¯¥åŠŸèƒ½ä½¿ç”¨ <a href="https://wiki.archlinux.org/index.php/SSH_(ç®€ä½“ä¸­æ–‡)" target="_blank" rel="noopener">SSH</a> è¿æ¥ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@blog /home/ubuntu</span><br><span class="line">â•°â”€# systemctl status nginx -H sg2</span><br><span class="line">â— nginx.service - A high performance web server and a reverse proxy server</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Mon 2020-02-17 08:41:11 UTC; 1 months 0 days ago</span><br><span class="line">     Docs: man:nginx(8)</span><br><span class="line"> Main PID: 3305</span><br><span class="line">    Tasks: 2 (limit: 1152)</span><br><span class="line">   CGroup: /system.slice/nginx.service</span><br><span class="line">           â”œâ”€ 3305 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;</span><br><span class="line">           â””â”€17700 nginx: worker process</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨systemctlå‘½ä»¤æ€æ­»æœåŠ¡"><a href="#ä½¿ç”¨systemctlå‘½ä»¤æ€æ­»æœåŠ¡" class="headerlink" title="ä½¿ç”¨systemctlå‘½ä»¤æ€æ­»æœåŠ¡"></a>ä½¿ç”¨systemctlå‘½ä»¤æ€æ­»æœåŠ¡</h4><ul><li><code>systemctl kill NAME</code></li></ul><h3 id="journal"><a href="#journal" class="headerlink" title="journal"></a>journal</h3><p>systemd çš„ç¬¬äºŒä¸ªä¸»è¦éƒ¨åˆ†æ˜¯ journal æ—¥å¿—ç³»ç»Ÿï¼Œç±»ä¼¼äº syslog ä½†ä¹Ÿæœ‰äº›æ˜¾è‘—åŒºåˆ«ã€‚å¦‚æœä½ å–œæ¬¢ç”¨ <code>sed ã€grep ã€awk</code> ä¸‰å‰‘å®¢æ¥å¤„ç†æ—¥å¿—ï¼Œé‚£ä¹ˆå½“ä½ é¢å¯¹ journal æ—¥å¿—ç³»ç»Ÿçš„æ—¶å€™ä½ å°±å‡†å¤‡<strong>æ€æ¡Œå„¿</strong>å§ï¼å› ä¸ºè¿™æ˜¯ä¸ªäºŒè¿›åˆ¶æ—¥å¿—ï¼Œæ— æ³•ä½¿ç”¨å¸¸è§„çš„å‘½ä»¤è¡Œæ–‡æœ¬å¤„ç†å·¥å…·æ¥è§£æå®ƒğŸ˜‚</p><h3 id="systemd-analyze"><a href="#systemd-analyze" class="headerlink" title="systemd-analyze"></a>systemd-analyze</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@docker-230 ~</span><br><span class="line">â•°â”€<span class="comment"># systemd-analyze</span></span><br><span class="line">Startup finished <span class="keyword">in</span> 489ms (kernel) + 1.547s (initrd) + 10.333s (userspace) = 12.369s</span><br></pre></td></tr></table></figure><h2 id="æ¨è-å‚è€ƒ"><a href="#æ¨è-å‚è€ƒ" class="headerlink" title="æ¨è/å‚è€ƒ"></a>æ¨è/å‚è€ƒ</h2><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><ul><li><a href="https://github.com/systemd/systemd" target="_blank" rel="noopener">github.com/systemd/systemd</a></li><li><a href="https://systemd.io/" target="_blank" rel="noopener">systemd.io</a></li></ul><h3 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h3><ul><li><p><a href="http://www.jinbuguo.com/systemd/systemd.exec.html" target="_blank" rel="noopener">systemd.exec ä¸­æ–‡æ‰‹å†Œ</a></p></li><li><p><a href="https://wiki.archlinux.org/index.php/systemd_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" target="_blank" rel="noopener">systemd (ç®€ä½“ä¸­æ–‡)</a></p></li><li><p><a href="https://wiki.debian.org/systemd" target="_blank" rel="noopener">wiki.debian.org/systemd</a></p></li><li><p><a href="https://www.debian.org/doc/manuals/debian-reference/ch03.zh-tw.html" target="_blank" rel="noopener">ç¬¬ 3 ç«  ç³»çµ±åˆå§‹åŒ–</a></p></li><li><p><a href="https://openwrt.org/docs/techref/architecture" target="_blank" rel="noopener">OpenWrt â€“ operating system architecture</a></p></li><li><p><a href="http://manpages.ubuntu.com/manpages/cosmic/zh_CN/man7/bootup.7.html" target="_blank" rel="noopener">bootup - ç³»ç»Ÿå¯åŠ¨æµç¨‹</a></p></li><li><p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/chap-managing_services_with_systemd" target="_blank" rel="noopener">CHAPTER 10. MANAGING SERVICES WITH SYSTEMD</a></p></li></ul><h3 id="åšå®¢"><a href="#åšå®¢" class="headerlink" title="åšå®¢"></a>åšå®¢</h3><ul><li><p><a href="https://coolshell.cn/articles/17998.html" target="_blank" rel="noopener">LINUX PID 1 å’Œ SYSTEMD</a> è€—å­çš„åšå®¢ï¼Œå¿…é¡»å¢™è£‚æ¨èé˜…è¯»å“ˆï¼Œå…¶ä»–çš„å¯ä»¥ä¸è¯»ï¼Œä½†è¿™ä¸€ç¯‡åšå®¢å¿…é¡»è¦è¯»å“¦ ï¼šï¼‰</p></li><li><p><a href="https://lp007819.wordpress.com/2015/01/11/systemd%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93/" target="_blank" rel="noopener">systemdçš„ä¸€äº›æ€»ç»“</a></p></li><li><p><a href="https://linux.cn/article-5457-1.html" target="_blank" rel="noopener">èµ°è¿›Linuxä¹‹systemdå¯åŠ¨è¿‡ç¨‹</a></p></li><li><p><a href="https://hotttao.github.io/2018/08/03/linux_mt/14-Linux%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E5%8F%8A%E5%86%85%E6%A0%B8%E6%A8%A1%E5%9D%97%E7%AE%A1%E7%90%86/CentOS7-Systemd%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/" target="_blank" rel="noopener">13.3 Centos7 Systemd å¯åŠ¨æµç¨‹</a></p></li><li><p><a href="https://www.itwire.com/business-it-news/open-source/65402-torvalds-says-he-has-no-strong-opinions-on-systemd" target="_blank" rel="noopener">Torvalds says he has no strong opinions on systemd</a></p></li><li><p><a href="http://0pointer.de/blog/projects/systemd.html" target="_blank" rel="noopener">Rethinking PID 1</a></p></li><li><p><a href="http://0pointer.de/blog/projects/the-biggest-myths.html" target="_blank" rel="noopener">The Biggest Myths</a></p></li><li><p><a href="https://www.bennythink.com/linux-keep-running.html" target="_blank" rel="noopener">Linux æ€ä¹ˆè®©ç¨‹åºæŒç»­è¿è¡Œï¼šç®€å•è¯´è¯´å‡ ç§å¥½ç©çš„åŠæ³•</a></p></li><li><p><a href="https://www.bennythink.com/systemd-accounting.html" target="_blank" rel="noopener">systemd â€“ systemctl ä¸æ˜¾ç¤ºå†…å­˜ CPU ä¿¡æ¯</a></p></li><li><p><a href="https://lp007819.wordpress.com/2015/01/17/systemd-journal-%e4%bb%8b%e7%bb%8d/" target="_blank" rel="noopener">systemd journal ä»‹ç»</a></p></li><li><p><a href="http://blog.lujun9972.win/blog/2018/08/08/%E4%BD%BF%E7%94%A8journalctl%E6%9F%A5%E7%9C%8Bsystemd%E6%97%A5%E5%BF%97/index.html" target="_blank" rel="noopener">ä½¿ç”¨journalctlæŸ¥çœ‹systemdæ—¥å¿—</a></p></li><li><p><a href="http://blog.lujun9972.win/blog/2019/11/30/%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E6%84%8F%E5%A4%96%E9%87%8D%E5%90%AFlinux(%E5%9F%BA%E4%BA%8Esystemd)/index.html" target="_blank" rel="noopener">å¦‚ä½•é˜²æ­¢æ„å¤–é‡å¯Linux(åŸºäºsystemd)</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;å°æ’æ›²&quot;&gt;&lt;a href=&quot;#å°æ’æ›²&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="blog" scheme="https://blog.k8s.li/tags/blog/"/>
    
      <category term="Linux" scheme="https://blog.k8s.li/tags/Linux/"/>
    
      <category term="ç¬”è®°" scheme="https://blog.k8s.li/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>N1 ç›’å­åˆ·å…¥ OpenWrt å¹¶éƒ¨ç½² K3s</title>
    <link href="https://blog.k8s.li/N1-openwrt.html"/>
    <id>https://blog.k8s.li/N1-openwrt.html</id>
    <published>2020-03-07T16:00:00.000Z</published>
    <updated>2020-03-07T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="K3s"><a href="#K3s" class="headerlink" title="K3s"></a>K3s</h2><p>å»å¹´çš„æ—¶å€™å¬äº† Rancher çš„ç›´æ’­åˆ†äº«è®²  <a href="http://dockone.io/article/9384" target="_blank" rel="noopener">k3såœ¨è¾¹ç¼˜è®¡ç®—ä¸­çš„åº”ç”¨å®è·µ</a>ï¼Œå°±æ„Ÿè§‰å¾ˆå¥½ç©å„¿ï¼Œå½“æ—¶å¯¹ K3s è¿˜æ˜¯å¾ˆæ„Ÿå…´è¶£ï¼Œæ— å¥ˆå½“æ—¶æ‰‹å¤´æ²¡æœ‰åˆé€‚çš„å¼€å‘æ¿å¯ç©ï¼Œå°±æ²¡æ„¿æ„èŠ±é’±å†ä¹°å—æ ‘è“æ´¾åƒç°ğŸ˜‚ã€‚ç›´åˆ°ä¸Šå‘¨æœ«çš„æ—¶å€™ä¸€æ¬¡æœºä¼šå¾—ä»¥é‡æ–°è®¤è¯†äº†ä¸€ä¸‹ <a href="https://github.com/rancher/k3s" target="_blank" rel="noopener">K3s</a> æ‰€ä»¥å°±æƒ³æ‰¾ä¸ªè®¾å¤‡æ¥ç©ç© K3sã€‚äºæ˜¯ä¸œæŒ‘è¥¿é€‰å°±é€‰å®šäº†æ–è®¯ N1 ï¼Œä¼˜ç‚¹å¤šå¤šï¼Œä¸ä»…å¯ä»¥åšè·¯ç”±å™¨è¿˜èƒ½è·‘ docker ã€è¿˜èƒ½åš NAS ç­‰ç­‰ï¼Œä¸¤ä¸ªå­—çœŸé¦™ğŸ˜‚ã€‚ä¹‹å‰æˆ‘ä¸€ç›´ä½¿ç”¨ <code>R6300V2</code> åˆ·äº†æ¢…æ—ä»¥åŠå¦ä¸€å° <code>WNDR3700V4</code> åˆ·äº† <code>OpenWrt</code> åšé€æ˜ä»£ç†ï¼Œåœ¨ <code>ESXi</code> ä¸Šä¹Ÿè£…äº†ä¸ª <code>OpenWrt</code> è½¯è·¯ç”±ç»™å†…ç½‘çš„è™šæ‹Ÿæœºåšé€æ˜ä»£ç†ï¼Œä½†è¿˜æ˜¯å¿ƒæœ‰ä¸ç”˜æƒ³æ‰¾ä¸€å°æ€§èƒ½æ›´å¥½ä¸€ç‚¹çš„è®¾å¤‡æ¥åšæ—è·¯ç½‘å…³ã€‚ç»¼ä¸Šå°±ç§è‰ä¹°äº†æ—©å·²ç»è¢«å¤§å®¶ç©çƒ‚äº†çš„ <a href="https://pockies.github.io/2019/03/07/phicomm-n1/" target="_blank" rel="noopener">N1ç›’å­</a>ã€‚</p><h2 id="å¼€ç®±"><a href="#å¼€ç®±" class="headerlink" title="å¼€ç®±"></a>å¼€ç®±</h2><h3 id="å¤–åŒ…è£…"><a href="#å¤–åŒ…è£…" class="headerlink" title="å¤–åŒ…è£…"></a>å¤–åŒ…è£…</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200308170852893.png" alt="image-20200308170852893"></p><h3 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200308170909549.png" alt="image-20200308170909549"></p><h3 id="å¼€æœºç”»é¢"><a href="#å¼€æœºç”»é¢" class="headerlink" title="å¼€æœºç”»é¢"></a>å¼€æœºç”»é¢</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200308170935704.png" alt="image-20200308170935704"></p><h3 id="ç”µè§†ç³»ç»Ÿ"><a href="#ç”µè§†ç³»ç»Ÿ" class="headerlink" title="ç”µè§†ç³»ç»Ÿ"></a>ç”µè§†ç³»ç»Ÿ</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200308171000114.png" alt="image-20200308171000114"></p><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><h4 id="æ‹†æœº"><a href="#æ‹†æœº" class="headerlink" title="æ‹†æœº"></a>æ‹†æœº</h4><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200309141919253.png" alt="image-20200309141919253"></p><h4 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h4><ul><li>Amlogic S905ï¼ŒARM Cortex-A53ï¼Œå››æ ¸ 2GHzï¼ŒGPU æ˜¯ ARM Maliâ„¢-450ï¼Œæ”¯æŒ 4K@60fps ç¡¬ä»¶è§£ç ï¼ŒHDMI 2.0ã€‚</li><li>å¦å¤–æ”¯æŒ AES åŠ å¯†è§£å¯†ï¼Œæ‰€ä»¥åœ¨ä¸Šé¢è·‘çš„ SS/SSR çš„åŠ å¯†ç®—æ³•é€‚åˆé€‰æ‹© AES å–½ã€‚</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@OpenWrt ~</span><br><span class="line">â•°â”€# cat /proc/cpuinfo</span><br><span class="line">processor       : 0</span><br><span class="line">model name      : ARMv8 Processor rev 4 (v8l)</span><br><span class="line">BogoMIPS        : 48.00</span><br><span class="line">Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 cpuid</span><br><span class="line">CPU implementer : 0x41</span><br><span class="line">CPU architecture: 8</span><br><span class="line">CPU variant     : 0x0</span><br><span class="line">CPU part        : 0xd03</span><br><span class="line">CPU revision    : 4</span><br><span class="line"></span><br><span class="line">processor       : 1</span><br><span class="line">model name      : ARMv8 Processor rev 4 (v8l)</span><br><span class="line">BogoMIPS        : 48.00</span><br><span class="line">Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 cpuid</span><br><span class="line">CPU implementer : 0x41</span><br><span class="line">CPU architecture: 8</span><br><span class="line">CPU variant     : 0x0</span><br><span class="line">CPU part        : 0xd03</span><br><span class="line">CPU revision    : 4</span><br><span class="line"></span><br><span class="line">processor       : 2</span><br><span class="line">model name      : ARMv8 Processor rev 4 (v8l)</span><br><span class="line">BogoMIPS        : 48.00</span><br><span class="line">Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 cpuid</span><br><span class="line">CPU implementer : 0x41</span><br><span class="line">CPU architecture: 8</span><br><span class="line">CPU variant     : 0x0</span><br><span class="line">CPU part        : 0xd03</span><br><span class="line">CPU revision    : 4</span><br><span class="line"></span><br><span class="line">processor       : 3</span><br><span class="line">model name      : ARMv8 Processor rev 4 (v8l)</span><br><span class="line">BogoMIPS        : 48.00</span><br><span class="line">Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 cpuid</span><br><span class="line">CPU implementer : 0x41</span><br><span class="line">CPU architecture: 8</span><br><span class="line">CPU variant     : 0x0</span><br><span class="line">CPU part        : 0xd03</span><br><span class="line">CPU revision    : 4</span><br></pre></td></tr></table></figure><h4 id="RAM"><a href="#RAM" class="headerlink" title="RAM"></a>RAM</h4><ul><li>å†…å­˜èŠ¯ç‰‡ RAMï¼šK4B4G1646E ï¼ŒDDR3-1866MHzï¼Œå†…å­˜å®¹é‡ 512MBï¼›å‰åä¸€å…±æœ‰ 4 é¢—ï¼Œæ€»å†…å­˜ 2GBã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@OpenWrt ~</span><br><span class="line">â•°â”€<span class="comment"># cat /proc/meminfo</span></span><br><span class="line">MemTotal:        1851688 kB</span><br><span class="line">MemFree:         1278128 kB</span><br><span class="line">MemAvailable:    1639036 kB</span><br><span class="line">â•­â”€root@OpenWrt ~</span><br><span class="line">â•°â”€<span class="comment"># dmesg | grep Memory</span></span><br><span class="line">[    0.000000] Memory: 924744K/1911808K available (12926K kernel code, 1108K rwdata, 5116K rodata, 640K init, 748K bss, 69560K reserved, 917504K cma-reserved)</span><br></pre></td></tr></table></figure><h4 id="ROM"><a href="#ROM" class="headerlink" title="ROM"></a>ROM</h4><ul><li>KLM8G1GEMEï¼Œ8GB eMMCã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@OpenWrt ~</span><br><span class="line">â•°â”€<span class="comment"># fdisk -l /dev/mmcblk1</span></span><br><span class="line">Disk /dev/mmcblk1: 7.3 GiB, 7818182656 bytes, 15269888 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0x7db7c786</span><br><span class="line"></span><br><span class="line">Device         Boot   Start      End  Sectors  Size Id Type</span><br><span class="line">/dev/mmcblk1p1      1433600  1695743   262144  128M  c W95 FAT32 (LBA)</span><br><span class="line">/dev/mmcblk1p2      1695744  2744319  1048576  512M 83 Linux</span><br><span class="line">/dev/mmcblk1p3      2744320 15269887 12525568    6G 83 Linux</span><br><span class="line">â•­â”€root@OpenWrt ~</span><br><span class="line">â•°â”€<span class="comment"># lsblk</span></span><br><span class="line">NAME         MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">mmcblk1      179:0    0  7.3G  0 disk</span><br><span class="line">â”œâ”€mmcblk1p1  179:1    0  128M  0 part /boot</span><br><span class="line">â”œâ”€mmcblk1p2  179:2    0  512M  0 part /</span><br><span class="line">â””â”€mmcblk1p3  179:3    0    6G  0 part /mnt/mmcblk1p3</span><br><span class="line">mmcblk1boot0 179:32   0    4M  1 disk</span><br><span class="line">mmcblk1boot1 179:64   0    4M  1 disk</span><br></pre></td></tr></table></figure><h4 id="net"><a href="#net" class="headerlink" title="net"></a>net</h4><ul><li>åƒå…† <code>1Gbps/Full</code> ç½‘å¡ä»¥åŠ 2.4GHz/5GHz çš„æ— çº¿ç½‘å¡</li><li>çœ‹åˆ° <code>RTL8211F</code> æˆ‘å“­äº†ï¼Œç«Ÿç„¶æ˜¯èƒèŸ¹å¡ï¼Œæ€æ¡Œå„¿ğŸ˜¡</li><li>WIFI èŠ¯ç‰‡ï¼šå±è”½ç½©æ˜¯ç„Šæ­»çš„ï¼Œæ‰€ä»¥ä¸æ¸…æ¥šã€‚åªçŸ¥é“æ˜¯åŒé¢‘ 1x1mimo ç”¨æ”¯æŒ 5G acï¼Œ2.4G è¿æ¥é€Ÿç‡ 65Mbpsï¼Œ5G è¿æ¥é€Ÿç‡ 390Mbpsã€‚ä¸ºä»€ä¹ˆä¸æ˜¯ 72m å’Œ 433mï¼Œå› ä¸º No SGIã€‚</li></ul><blockquote><p>ï¼ˆN1ä¸æ”¯æŒ RTL8153ï¼Œæ˜¯å› ä¸ºç¡¬ä»¶ä¾›ç”µçš„åŸå› ï¼Œä¸æ˜¯é©±åŠ¨çš„åŸå› ï¼Œä¹Ÿæœ‰ä¸ªåˆ«ç½‘å‹è¯´èƒ½æ”¯æŒçš„ï¼Œå¯èƒ½å› ä¸º rtl8153 ä¹Ÿæœ‰ä¸åŒç‰ˆæœ¬ï¼Œä½†æ”¯ æŒAX88179ï¼Œé€Ÿç‡ 200m å·¦å³, å› æ­¤ä»æ€§èƒ½ä¸Šè€ƒè™‘ï¼ŒN1ä¸å»ºè®®å¤–æ¥ä»»ä½•ç½‘å¡ï¼Œç›´æ¥ç”¨å•ç½‘å¡åšæ—è·¯ç”±ä¹Ÿèƒ½è¾¾åˆ° 750m å·¦å³ï¼‰</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@OpenWrt ~</span><br><span class="line">â•°â”€# dmesg | grep net</span><br><span class="line">[    0.000000] Kernel command line: root=UUID=69fd696a-85a4-4ec8-b604-4cefd053cbc1 rootfstype=btrfs rootflags=compress=zstd console=ttyAML0,115200n8 console=tty0 no_console_suspend consoleblank=0 fsck.fix=yes fsck.repair=yes net.ifnames=0 cgroup_enable=cpuset cgroup_memory=1 cgroup_enable=memory swapaccount=1</span><br><span class="line">[    0.691325] audit: initializing netlink subsys (disabled)</span><br><span class="line">[    5.131043] meson8b-dwmac c9410000.ethernet: IRQ eth_wake_irq not found</span><br><span class="line">[    5.136694] meson8b-dwmac c9410000.ethernet: IRQ eth_lpi not found</span><br><span class="line">[    5.142854] meson8b-dwmac c9410000.ethernet: PTP uses main clock</span><br><span class="line">[    5.148731] meson8b-dwmac c9410000.ethernet: no reset control found</span><br><span class="line">[    5.155366] meson8b-dwmac c9410000.ethernet: User ID: 0x11, Synopsys ID: 0x37</span><br><span class="line">[    5.162029] meson8b-dwmac c9410000.ethernet:         DWMAC1000</span><br><span class="line">[    5.167192] meson8b-dwmac c9410000.ethernet: DMA HW capability register supported</span><br><span class="line">[    5.174594] meson8b-dwmac c9410000.ethernet: RX Checksum Offload Engine supported</span><br><span class="line">[    5.182017] meson8b-dwmac c9410000.ethernet: COE Type 2</span><br><span class="line">[    5.187192] meson8b-dwmac c9410000.ethernet: TX Checksum insertion supported</span><br><span class="line">[    5.194171] meson8b-dwmac c9410000.ethernet: Wake-Up On Lan supported</span><br><span class="line">[    5.200586] meson8b-dwmac c9410000.ethernet: Normal descriptors</span><br><span class="line">[    5.206426] meson8b-dwmac c9410000.ethernet: Ring mode enabled</span><br><span class="line">[    5.212198] meson8b-dwmac c9410000.ethernet: Enable RX Mitigation via HW Watchdog Timer</span><br><span class="line">[    5.428271] Initializing XFRM netlink socket</span><br><span class="line">[    5.521946] bridge: filtering via arp/ip/ip6tables is no longer available by default. Update your scripts to load br_netfilter if you need this.</span><br><span class="line">[   11.076508] meson8b-dwmac c9410000.ethernet eth0: PHY [0.2009087f:00] driver [RTL8211F Gigabit Ethernet]</span><br><span class="line">[   11.083720] meson8b-dwmac c9410000.ethernet eth0: No Safety Features support found</span><br><span class="line">[   11.088006] meson8b-dwmac c9410000.ethernet eth0: PTP not supported by HW</span><br><span class="line">[   11.094588] meson8b-dwmac c9410000.ethernet eth0: configuring for phy/rgmii link mode</span><br><span class="line">[   19.250095] meson8b-dwmac c9410000.ethernet eth0: PHY [0.2009087f:00] driver [RTL8211F Gigabit Ethernet]</span><br><span class="line">[   19.265579] meson8b-dwmac c9410000.ethernet eth0: No Safety Features support found</span><br><span class="line">[   19.267519] meson8b-dwmac c9410000.ethernet eth0: PTP not supported by HW</span><br><span class="line">[   19.274244] meson8b-dwmac c9410000.ethernet eth0: configuring for phy/rgmii link mode</span><br><span class="line">[   19.411257] netlink: 4 bytes leftover after parsing attributes in process `iw'.</span><br><span class="line">[   19.595853] ieee80211 phy0: brcmf_net_attach: couldn't register the net device</span><br><span class="line">[   19.597447] ieee80211 phy0: brcmf_ap_add_vif: Registering netdevice failed</span><br><span class="line">[   21.019546] meson8b-dwmac c9410000.ethernet eth0: Link is Up - 1Gbps/Full - flow control rx/tx</span><br><span class="line">[ 1047.556475] meson8b-dwmac c9410000.ethernet eth0: Link is Down</span><br><span class="line">[ 1047.772626] meson8b-dwmac c9410000.ethernet eth0: PHY [0.2009087f:00] driver [RTL8211F Gigabit Ethernet]</span><br><span class="line">[ 1047.785569] meson8b-dwmac c9410000.ethernet eth0: No Safety Features support found</span><br><span class="line">[ 1047.787510] meson8b-dwmac c9410000.ethernet eth0: PTP not supported by HW</span><br><span class="line">[ 1047.794242] meson8b-dwmac c9410000.ethernet eth0: configuring for phy/rgmii link mode</span><br><span class="line">[ 1051.459018] meson8b-dwmac c9410000.ethernet eth0: Link is Up - 1Gbps/Full - flow control rx/tx</span><br><span class="line">[ 1241.984013] netlink: 4 bytes leftover after parsing attributes in process `iw'.</span><br><span class="line">[ 1346.112897] meson8b-dwmac c9410000.ethernet eth0: Link is Down</span><br><span class="line">[ 1346.295582] meson8b-dwmac c9410000.ethernet eth0: PHY [0.2009087f:00] driver [RTL8211F Gigabit Ethernet]</span><br><span class="line">[ 1346.312202] meson8b-dwmac c9410000.ethernet eth0: No Safety Features support found</span><br><span class="line">[ 1346.314172] meson8b-dwmac c9410000.ethernet eth0: PTP not supported by HW</span><br><span class="line">[ 1346.320888] meson8b-dwmac c9410000.ethernet eth0: configuring for phy/rgmii link mode</span><br><span class="line">[ 1349.769672] meson8b-dwmac c9410000.ethernet eth0: Link is Up - 1Gbps/Full - flow control rx/tx</span><br></pre></td></tr></table></figure><h4 id="htop"><a href="#htop" class="headerlink" title="htop"></a>htop</h4><p>å¼å¼å¼ï¼Œå±…ç„¶è¿˜èƒ½è·‘ Docker ï¼Œé‚£ K3s ä¹Ÿè‚¯å®šæ²¡é—®é¢˜å•¦ï¼ˆ</p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200308180733757.png" alt="image-20200308180733757"></p><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><p>é¦–å…ˆå‡†å¤‡ä¸ªåˆ·æœºè¿‡ç¨‹ä¸­éœ€è¦çš„æ¸…å• <del>åˆ«çœ‹ä½ ä»Šå¤©é—¹å¾—æ¬¢ï¼Œå°å¿ƒä»Šåæ‹‰æ¸…å•</del></p><ul><li>USB å…¬å¯¹å…¬æ•°æ®çº¿ï¼ˆå–å®¶èµ é€äº†çº¿</li><li>ç½‘çº¿æˆ– WiFiï¼Œç½‘çº¿æœ‰æ—¶è·å–ä¸åˆ°æ­£ç¡®çš„ IP ï¼Œå¯ä»¥å€ŸåŠ© WiFi</li><li>HDMI çº¿ä»¥åŠæ˜¾ç¤ºå™¨ï¼Œéœ€è¦è¿›å…¥ç›’å­ç³»ç»Ÿæ‰‹åŠ¨å¼€å¯ adb</li><li>Android SDK å¹³å°å·¥å…· <a href="https://developer.android.com/studio/releases/platform-tools" target="_blank" rel="noopener">Platform-tools</a></li><li>é•œåƒå†™å…¥å·¥å…· <a href="https://github.com/pbatard/rufus" target="_blank" rel="noopener">Rufus</a> æˆ– <a href="https://www.roadkil.net/program.php?ProgramID=12" target="_blank" rel="noopener">Roadkils DiskImage</a></li><li>OpenWrt é•œåƒ <a href="https://disk.longe.xyz/N1/Openwrt/28%2Bo%E7%89%88N1_OP_U%E7%9B%98%E7%9B%B4%E5%88%B7%E5%8C%85/N1_Openwrt_R20.2.15_k5.4.23-amlogic-flippy-28%2Bo.7z" target="_blank" rel="noopener">N1_Openwrt_R20.2.15_k5.4.23-amlogic-flippy-28+o.7z</a></li></ul><blockquote><p>Openwrt_U ç›˜ç›´åˆ·åŒ…ï¼šé“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1K0bNItsY1-Br4o1EsRokkg" target="_blank" rel="noopener">https://pan.baidu.com/s/1K0bNItsY1-Br4o1EsRokkg</a> æå–ç ï¼šlidf</p></blockquote><h3 id="æ¨èèµ„æº"><a href="#æ¨èèµ„æº" class="headerlink" title="æ¨èèµ„æº"></a>æ¨èèµ„æº</h3><p>åˆ·æœºè¿‡ç¨‹ä¸­çš„èµ„æºæ¥è‡ªä»¥ä¸‹ï¼Œå¯ä»¥å»è¿™é‡Œæ‰¾æ›´å¤šä½ æƒ³è¦çš„ï¼Œä»–ä»¬çš„æ•™ç¨‹ä¹Ÿä¼šæ¯”æˆ‘æ›´ä¼˜ç§€ä¸€äº›ï¼Œè€Œä¸” B ç«™ä¸Šä¹Ÿæœ‰è§†é¢‘ï¼Œè§†é¢‘è®²è§£çš„è¦æ›´å¥½ã€‚å†™è¿™ç¯‡åšå®¢ä¹Ÿåªæ˜¯ä¸ºäº†è®°å½•ä¸€ä¸‹ğŸ˜‚</p><ul><li><a href="https://drive.google.com/drive/folders/1XvhPCwodZzCfV83oW3DXegAvDOrHW7iV" target="_blank" rel="noopener">Pi&amp;N1 Google Drive</a></li><li><a href="https://github.com/real-pin1group/3000web/wiki" target="_blank" rel="noopener">ä¸‰åƒé—®</a></li><li><a href="https://t.me/PIN1Group" target="_blank" rel="noopener">t.me/PIN1Group</a></li><li><a href="https://t.me/NewPiN1Channel" target="_blank" rel="noopener">Pi&amp;N1äº¤æµç¾¤é€šçŸ¥é¢‘é“</a></li><li><a href="https://disk.longe.xyz/" target="_blank" rel="noopener">å±±å°ç‚®ç½‘ç›˜</a></li><li><a href="https://disk.longe.xyz/N1/OpenWrt/%E3%80%902019-6-20%E3%80%91Phicomm%20N1%E5%88%B7openwrt%E8%B7%AF%E7%94%B1%E5%9B%BA%E4%BB%B6%E8%AF%A6%E7%BB%86%E7%AC%94%E8%AE%B0.pdf" target="_blank" rel="noopener">Phicomm N1åˆ·openwrtè·¯ç”±å›ºä»¶è¯¦ç»†ç¬”è®°.pdf</a></li><li><a href="https://disk.longe.xyz/N1/OpenWrt/28%2Boç‰ˆN1_OP_Uç›˜ç›´åˆ·åŒ…/" target="_blank" rel="noopener">28+oç‰ˆN1_OP_Uç›˜ç›´åˆ·åŒ…</a></li><li><a href="https://www.right.com.cn/forum/thread-981406-1-1.html" target="_blank" rel="noopener">[2020-3-8]â˜…29+ç‰ˆN1_OP_Uç›˜ç›´åˆ·åŒ…ï¼ŒåŠè´å£³äº‘_OP_çº¿åˆ·åŒ…ï¼Œå†…æ ¸5.4</a></li></ul><h2 id="åˆ·æœº"><a href="#åˆ·æœº" class="headerlink" title="åˆ·æœº"></a>åˆ·æœº</h2><h3 id="å¼€å¯-ADB"><a href="#å¼€å¯-ADB" class="headerlink" title="å¼€å¯ ADB"></a>å¼€å¯ ADB</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200309085941030.png" alt="image-20200309085941030"></p><p>å°† HDMI çº¿è¿æ¥åˆ°ç›’å­çš„ HDMI å£ï¼Œå°† USB å…¬å¯¹å…¬çš„æ•°æ®çº¿åˆ†åˆ«æ’åœ¨ç›’å­çš„é è¿‘ HDMI å£çš„ USB ï¼Œå¦ä¸€å¤´æ’åœ¨ PC çš„ USB å£ï¼Œå†å°†é¼ æ ‡è¿æ¥åˆ°ç›’å­çš„å¦ä¸€ä¸ª USB å£ã€‚æ’å¥½ä¸Šè¿°çš„çº¿ç¼†ä¹‹åæ’ä¸Šç”µæºå¼€æœºï¼Œç”±äºç›’å­æ²¡æœ‰ç”µæºå¼€å…³æ‰€ä»¥åªèƒ½é€šè¿‡æ’æ‹”ç”µæºçš„æ–¹å¼å¼€å…³æœºã€‚å¼€æœºä¹‹åä¼šè‡ªåŠ¨è¿›å…¥åˆ°ç”µè§†ç›’å­ç³»ç»Ÿçš„é¡µé¢ï¼Œç„¶åæŒªåŠ¨é¼ æ ‡ï¼Œåœ¨ <code>å›ºä»¶ç‰ˆæœ¬</code>  é‚£é‡Œç‹‚ç‚¹é¼ æ ‡å››ä¸‹å¼€å¯ <code>ADB</code> è°ƒè¯•æ¨¡å¼ã€‚å±å¹•ä¸­é—´ä¼šå¼¹å‡ºä¸ªç°è‰²çš„æ–¹æ¡†æç¤º<code>æ‰“å¼€ adb</code></p><blockquote><p>PSï¼šæåˆ° adb å’±å°±ä¸ç”±è‡ªä¸»åœ°æƒ³èµ·äº†å»å¹´ä¸–ç•Œäº”ç™¾å¼ºä»–å®¶çš„å·ç§°è¦å–ä»£ Android ã€è‡ªä¸»ç ”å‘ã€å¾®å†…æ ¸ã€é¢å‘ç¡®å®š<a href="https://zh.wikipedia.org/wiki/æ—¶å»¶" target="_blank" rel="noopener">æ—¶å»¶</a>ã€åˆ†å¸ƒå¼ã€å½¢å¼åŒ–éªŒè¯ã€å¤šåœºæ™¯ï¼›å¤§åé¼é¼çš„å“„æ‡µï¼ˆPPTï¼‰æ“ä½œç³»ç»Ÿç«Ÿç„¶ä¹Ÿæœ‰ ADB ï¼ˆå·ç¬‘</p></blockquote><p>åœ¨è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä½¿ç”¨ç½‘çº¿è¿æ¥ç›’å­å’Œè·¯ç”±å™¨åï¼Œå±å¹•ä¸Šæ˜¾ç¤ºçš„ IP å¹¶ä¸æ˜¯æˆ‘æœ¬åœ°å†…ç½‘çš„ IP ï¼Œè¿™ä¸€ç‚¹å¾ˆå¥‡æ€ªï¼Œè€Œä½¿ç”¨æ— çº¿è¿æ¥åˆ°æˆ‘çš„æ— çº¿è·¯ç”±å™¨åå»èƒ½è·å–åˆ°æ­£å¸¸çš„å†…ç½‘ IP ï¼Œæ‰€ä»¥å¦‚æœä½ ä½¿ç”¨ç½‘çº¿è¿æ¥æ—¶ä¹Ÿé‡åˆ°è¿™æ ·çš„æƒ…å†µï¼Œä¸å¦¨å°è¯•ä¸€ä¸‹ä½¿ç”¨æ— çº¿è¿æ¥ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200308171341327.png" alt="image-20200308171341327"></p><h3 id="PC-ä¸Šè¿æ¥-ADB-è¿›å…¥-fastboot-æ¨¡å¼"><a href="#PC-ä¸Šè¿æ¥-ADB-è¿›å…¥-fastboot-æ¨¡å¼" class="headerlink" title="PC ä¸Šè¿æ¥ ADB è¿›å…¥ fastboot æ¨¡å¼"></a>PC ä¸Šè¿æ¥ ADB è¿›å…¥ fastboot æ¨¡å¼</h3><p>ä¸Šè¿°è¦å°†ç›’å­çš„ HMDI æ¥å…¥æ˜¾ç¤ºå™¨å¹¶æ’ä¸Šé¼ æ ‡ï¼Œå°±æ˜¯ä¸ºäº†åœ¨ ADB æ¨¡å¼ä¸‹è¿›å…¥ fastboot æ¨¡å¼ï¼Œè€Œ fastboot æ¨¡å¼å’Œæˆ‘ä»¬æ™®é€šçš„ Android åˆ·æœºæ—¶çš„ fastboot ä¸€æ ·ï¼Œä½•å†µè¿™ä¸ªç›’å­ä¹Ÿæ˜¯åŸºäº Android çš„ï¼Œæ‰€ä»¥å˜›ï¼Œå’Œ Android åˆ·æœºå¤§åŒå°å¼‚ã€‚ç„¶åä¸‹è½½å¥½ Android SDK å¹³å°å·¥å…· <a href="https://developer.android.com/studio/releases/platform-tools" target="_blank" rel="noopener">Platform-tools</a> å¹¶è§£å‹åˆ°åˆé€‚çš„ä½ç½®ï¼ŒæŒ‰ä½ <code>shift</code> é”®ä¹‹åé¼ æ ‡å³é”®ç‚¹å‡»<code>åœ¨æ­¤å¤„æ‰“å¼€ Powershell çª—å£</code> ï¼Œæ¥ç€åœ¨è¯¥å‘½ä»¤è¡Œä¸‹è¾“å…¥ <code>adb.exe connect IP</code> ï¼Œè¿™é‡Œçš„ IP å³ä¸ºå±å¹•ä¸Šæ˜¾ç¤ºçš„ IP ï¼Œè¿æ¥æˆåŠŸä¹‹åä¼šæœ‰æç¤ºå·²ç»è¿æ¥ã€‚ç„¶åå†è¿è¡Œ <code>adb.exe shell reboot fastboot</code> è¿›å…¥ fastboot æ¨¡å¼ã€‚è¿™ä¸€æ­¥å’Œæˆ‘ä»¬ç»™ Android æ‰‹æœºåˆ·æœºæ—¶ä¿ºç”µæºé”®+éŸ³é‡é”®ï¼Œè¿›å…¥ fastboot æ¨¡å¼ä¸€æ ·çš„é“ç†ï¼Œåªä¸è¿‡ç›’å­æ²¡æœ‰éŸ³é‡é”®å’Œå¼€æœºé”®ï¼Œæ‰€ä»¥è¦ä½¿ç”¨ adb çš„æ–¹å¼è¿›å…¥åˆ° fastboot ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PS D:\Desktop&gt; adb.exe connect <span class="number">192.168</span>.<span class="number">0.105</span></span><br><span class="line">connected to <span class="number">192.168</span>.<span class="number">0.105</span>:<span class="number">5555</span></span><br><span class="line">PS D:\Desktop\N1&gt; adb.exe shell reboot fastboot</span><br></pre></td></tr></table></figure><h3 id="åˆ·å…¥é™çº§é•œåƒ"><a href="#åˆ·å…¥é™çº§é•œåƒ" class="headerlink" title="åˆ·å…¥é™çº§é•œåƒ"></a>åˆ·å…¥é™çº§é•œåƒ</h3><p>ç›’å­é‡å¯è¿›å…¥ fastboot æ¨¡å¼ä¹‹åï¼ŒPC ä¸Šä¼šæç¤ºæ’å…¥æ–°è®¾å¤‡ï¼Œå¹¶å®å’šå“ä¸€ä¸‹ï¼Œä¹‹åä¼šè‡ªåŠ¨å®‰è£…ä¸Šé©±åŠ¨ç¨‹åºã€‚</p><p>å³é”®è®¡ç®—æœºâ€“&gt;ç®¡ç†â€“&gt; è®¾å¤‡ç®¡ç†å™¨ <code>LeMobile Android Device</code> ä¸‹çš„ <code>Android ADB Interface</code> ã€‚å¦‚æœæ²¡æœ‰å‡ºç°è¯¥è®¾å¤‡çš„è¯ï¼Œå¯ä»¥ä¸‹è½½ä¸ªé©±åŠ¨å®‰è£…ç¨‹åºæ¥ç»™ä½ è£…ä¸Šè¯¥è®¾å¤‡çš„é©±åŠ¨ã€‚ä½¿ç”¨ <code>fastboot devices -l</code> å‘½ä»¤æ¥æŸ¥çœ‹è¯¥è®¾å¤‡æ˜¯å¦æ­£å¸¸è¿æ¥ä¸Šã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200308152333262.png" alt="image-20200308152333262"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS D:\Desktop\N1&gt; fastboot devices <span class="literal">-l</span></span><br><span class="line"><span class="number">1234567890</span>             fastboot</span><br></pre></td></tr></table></figure><h4 id="æ ¡éªŒé•œåƒ"><a href="#æ ¡éªŒé•œåƒ" class="headerlink" title="æ ¡éªŒé•œåƒ"></a>æ ¡éªŒé•œåƒ</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----          -------------   ------ ----</span><br><span class="line">-a----   2020/3/7     17:53       14191104 boot.img</span><br><span class="line">-a----   2020/3/7     17:53         672256 bootloader.img</span><br><span class="line">-a----   2020/3/7     17:53            605 hash.txt</span><br><span class="line">-a----   2020/3/7     17:53       18295296 recovery.img</span><br><span class="line"><span class="comment"># åˆ·æœºä¹‹å‰è¦å…ˆæ ¡éªŒé•œåƒæ˜¯å¦å®Œæ•´æˆ–è€…è¢«ç¯¡æ”¹ï¼Œå…»æˆå¥½ä¹ æƒ¯ğŸ˜‹</span></span><br><span class="line">PS D:\Desktop\N1&gt; cat .\hash.txt</span><br><span class="line">æ–‡ä»¶: N1_V2.19_imgs\bootloader.img</span><br><span class="line">å¤§å°: 672256 å­—èŠ‚</span><br><span class="line">ä¿®æ”¹æ—¶é—´: 2018å¹´5æœˆ25æ—¥ æ˜ŸæœŸäº”, 23:09:08</span><br><span class="line">MD5: 80BD2EFED2F76B6ECA56F7E026549E1A</span><br><span class="line">SHA1: 3A1FFCADF062748CA1D00EB80E73F2175B160A0D</span><br><span class="line">CRC32: 34BA154A</span><br><span class="line"></span><br><span class="line">æ–‡ä»¶: N1_V2.19_imgs\recovery.img</span><br><span class="line">å¤§å°: 18295296 å­—èŠ‚</span><br><span class="line">ä¿®æ”¹æ—¶é—´: 2018å¹´5æœˆ25æ—¥ æ˜ŸæœŸäº”, 23:09:19</span><br><span class="line">MD5: CAC6ED1DED5BB1D9CFAD39B2B1C6CD8A</span><br><span class="line">SHA1: B468A3134B376A5295C1FD5857343128D0AC056C</span><br><span class="line">CRC32: AA11C424</span><br><span class="line"></span><br><span class="line">æ–‡ä»¶: N1_V2.19_imgs\boot.img</span><br><span class="line">å¤§å°: 14191104 å­—èŠ‚</span><br><span class="line">ä¿®æ”¹æ—¶é—´: 2018å¹´5æœˆ25æ—¥ æ˜ŸæœŸäº”, 23:09:46</span><br><span class="line">MD5: 75DA954D0C4CBCD4A86CEE501B40C5AA</span><br><span class="line">SHA1: 1A0D04DB8FB57F252C72C909A3268B6B2C3BD241</span><br><span class="line">CRC32: 547D7823</span><br><span class="line"></span><br><span class="line"><span class="comment"># Windows CMD ä¸‹å¯ä½¿ç”¨ certUtil æ¥è®¡ç®—æ–‡ä»¶çš„ HASH å€¼</span></span><br><span class="line">PS D:\Desktop\N1&gt; certUtil -hashfile .\recovery.img</span><br><span class="line">SHA1 hash of .\recovery.img:</span><br><span class="line">b468a3134b376a5295c1fd5857343128d0ac056c</span><br><span class="line">CertUtil: -hashfile command completed successfully.</span><br><span class="line">PS D:\Desktop\N1&gt; certUtil -hashfile .\boot.img</span><br><span class="line">SHA1 hash of .\boot.img:</span><br><span class="line">1a0d04db8fb57f252c72c909a3268b6b2c3bd241</span><br><span class="line">CertUtil: -hashfile command completed successfully.</span><br><span class="line">PS D:\Desktop\N1&gt; certUtil -hashfile .\bootloader.img</span><br><span class="line">SHA1 hash of .\bootloader.img:</span><br><span class="line">3a1ffcadf062748ca1d00eb80e73f2175b160a0d</span><br><span class="line">CertUtil: -hashfile command completed successfully.</span><br></pre></td></tr></table></figure><h4 id="è¾“å…¥é™çº§åŒ…é•œåƒ"><a href="#è¾“å…¥é™çº§åŒ…é•œåƒ" class="headerlink" title="è¾“å…¥é™çº§åŒ…é•œåƒ"></a>è¾“å…¥é™çº§åŒ…é•œåƒ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç„¶åæ ¹æ®å¯¹åº”çš„åˆ†åŒºåˆ·å…¥å¯¹åº”çš„é•œåƒï¼Œè¿™ç‚¹ä¸è¦ææ··ï¼Œä¸ç„¶ä¼šå˜ç –çš„</span></span><br><span class="line">PS D:\Desktop\N1&gt; fastboot flash bootloader bootloader.img</span><br><span class="line">Sending <span class="string">'bootloader'</span> (656 KB)                      OKAY [  0.037s]</span><br><span class="line">Writing <span class="string">'bootloader'</span>                               OKAY [  0.075s]</span><br><span class="line">Finished. Total time: 0.118s</span><br><span class="line">PS D:\Desktop\N1&gt; fastboot flash boot boot.img</span><br><span class="line">Sending <span class="string">'boot'</span> (13858 KB)                          OKAY [  0.620s]</span><br><span class="line">Writing <span class="string">'boot'</span>                                     OKAY [  0.666s]</span><br><span class="line">Finished. Total time: 1.290s</span><br><span class="line">PS D:\Desktop\N1&gt; fastboot flash recovery recovery.img</span><br><span class="line">Sending <span class="string">'recovery'</span> (17866 KB)                      OKAY [  0.802s]</span><br><span class="line">Writing <span class="string">'recovery'</span>                                 OKAY [  0.869s]</span><br><span class="line">Finished. Total time: 1.684s</span><br><span class="line">PS D:\Desktop\N1&gt;</span><br></pre></td></tr></table></figure><h3 id="å°†-OpenWrt-åˆ·å…¥-EMMC"><a href="#å°†-OpenWrt-åˆ·å…¥-EMMC" class="headerlink" title="å°† OpenWrt åˆ·å…¥ EMMC"></a>å°† OpenWrt åˆ·å…¥ EMMC</h3><p>é™çº§æˆåŠŸä¹‹åæˆ‘ä»¬å°±å¯ä»¥å¼€æœºè¿›å…¥çº¿åˆ·æ¨¡å¼ï¼Œä»è€Œå¯ä»¥é€‰æ‹©ä» U ç›˜è®¾å¤‡å¯åŠ¨ï¼Œä¹‹æ‰€ä»¥é™çº§ä¹Ÿæ˜¯å› ä¸ºè¿™ï¼Œé«˜ç‰ˆæœ¬çš„å›ºä»¶å±è”½äº†è¿™ä¸€åŠŸèƒ½ã€‚æˆ‘ä»¬æ— æ³•ç›´æ¥å°† OpenWrt çš„é•œåƒå†™å…¥åˆ°ç›’å­çš„ EMMC å­˜å‚¨ä¸­ï¼Œè¦è¿›å…¥åˆ°ä¸€ä¸ªå« Armbian çš„åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œåœ¨ Armbian ç³»ç»Ÿé‡Œå°† OpenWrt é•œåƒå†™å…¥åˆ° EMMC å­˜å‚¨è®¾å¤‡ä¸­ã€‚è€Œä¹Ÿæœ‰ä¸€äº›å¤§ä½¬å°†äºŒè€…çš„é•œåƒç»“åˆåœ¨ä¸€èµ·ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ä½¿ç”¨è¯¥é•œåƒåœ¨ U ç›˜æ¨¡å¼ä¸‹å°† OpenWrt é•œåƒå†™å…¥åˆ° EMMC ä¸­ï¼Œå¹¶ä¸”å‡†å¤‡å¥½äº†è‡ªåŠ¨å†™å…¥çš„è„šæœ¬ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚è¯¥é•œåƒå¯ä»¥ä» <a href="https://www.right.com.cn/forum/thread-981406-1-1.html" target="_blank" rel="noopener">29+ç‰ˆN1_OP_Uç›˜ç›´åˆ·åŒ…ï¼ŒåŠè´å£³äº‘_OP_çº¿åˆ·åŒ…ï¼Œå†…æ ¸5.4</a> æ‰¾åˆ°ã€‚</p><h4 id="å†™å…¥-U-ç›˜é•œåƒ"><a href="#å†™å…¥-U-ç›˜é•œåƒ" class="headerlink" title="å†™å…¥ U ç›˜é•œåƒ"></a>å†™å…¥ U ç›˜é•œåƒ</h4><p>æˆ‘å†™å…¥ U ç›˜çš„é•œåƒæ˜¯ N1_<strong>Openwrt_R20.2.15_k5.4.23-amlogic-flippy-28+.img</strong> ä¹Ÿå°±æ˜¯ <code>N1-Openwrt_Uç›˜ç›´åˆ·åŒ…</code> ï¼Œå†™å…¥å·¥å…·ä½¿ç”¨  <a href="https://github.com/pbatard/rufus" target="_blank" rel="noopener">Rufus</a> æˆ– <a href="https://www.roadkil.net/program.php?ProgramID=12" target="_blank" rel="noopener">Roadkils DiskImage</a> éƒ½å¯ä»¥ï¼Œå°±å’Œæˆ‘ä»¬å¹³æ—¶åˆ¶ä½œå¯åŠ¨ç›˜ä¸€æ ·ã€‚</p><h4 id="ä»-update-æ¨¡å¼å¯åŠ¨-Armbian"><a href="#ä»-update-æ¨¡å¼å¯åŠ¨-Armbian" class="headerlink" title="ä» update æ¨¡å¼å¯åŠ¨ Armbian"></a>ä» update æ¨¡å¼å¯åŠ¨ Armbian</h4><p>è¦æ‹”æ‰ USB å…¬å¯¹å…¬çš„çº¿ï¼Œç›’å­å¼€æœºåä½¿ç”¨ bat è„šæœ¬è¿›å…¥çº¿åˆ·æ¨¡å¼ï¼Œåœ¨ update æ¨¡å¼ä¸‹æ‰å¯ä»¥ä»æˆ‘ä»¬åˆšåˆšå†™å…¥çš„é•œåƒ U ç›˜ä¸­å¯åŠ¨ã€‚å¦‚æœä½ ä¸‹è½½å¥½ Google Drive ä¸Šçš„èµ„æºçš„è¯ï¼Œå·¥å…·åœ¨ <code>/ç©æ³•0--å„ç§ç©æ³•å¿…å¤‡å·¥å…·/2---è¿›çº¿åˆ·æ¨¡å¼å·¥å…·---å¯åŠ¨Uç›˜ç³»ç»Ÿå‰è¦å…ˆè¿›çº¿åˆ·æ¨¡å¼/è¿›çº¿åˆ·æ¨¡å¼å·¥å…·</code> ä¸‹çš„</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line">echo æœ¬å·¥å…·é€šè¿‡adbè¿æ¥ä½¿N1é‡å¯è¿›å…¥çº¿åˆ·æ¨¡å¼!</span><br><span class="line">echo è¯·å…ˆç”¨usbåŒå…¬å¤´çº¿è¿æ¥ç›’å­å’Œç”µè„‘!</span><br><span class="line">echo made by webpad</span><br><span class="line">set /p ip=è¯·è¾“å…¥ç›’å­çš„å†…ç½‘IPåœ°å€ï¼š</span><br><span class="line">adb kill<span class="literal">-server</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">"%ip%"</span> == <span class="string">""</span> echo æç¤ºï¼šè¯·è¾“å…¥æ­£ç¡®çš„IPåœ°å€ &amp;&amp; goto <span class="keyword">end</span></span><br><span class="line">echo å¼€å§‹é€šè¿‡ç½‘ç»œè¿›è¡ŒADBè¿æ¥â€¦â€¦</span><br><span class="line">adb connect %ip%</span><br><span class="line">adb devices <span class="literal">-l</span> | findstr <span class="string">"p230"</span></span><br><span class="line"><span class="keyword">if</span> %ERRORLEVEL% NEQ <span class="number">0</span> echo è¿æ¥æµ‹è¯•å¤±è´¥ï¼è¯·ç¡®ä¿å·²å¼€å¯è¿œç¨‹è°ƒè¯•ï¼&amp;&amp;goto <span class="keyword">end</span></span><br><span class="line">echo *</span><br><span class="line">echo *</span><br><span class="line">echo *</span><br><span class="line">echo ç›’å­å·²é‡å¯è¿›å…¥çº¿åˆ·æ¨¡å¼ï¼Œè‹¥windowså‘ç°äº†æ–°è®¾å¤‡ï¼Œè¯·åœ¨è®¾å¤‡ç®¡ç†å™¨ä¸­æ‰‹åŠ¨å®‰è£…é©±åŠ¨ï¼Œæ­¤çª—å£å¯ä»¥å…³é—­...</span><br><span class="line">adb shell reboot update</span><br><span class="line">del adbshell.txt &gt;nul <span class="number">2</span>&gt;nul</span><br><span class="line"></span><br><span class="line">:<span class="keyword">end</span></span><br><span class="line">echo æŒ‰ä»»æ„é”®é€€å‡º...</span><br><span class="line">pause &gt; nul</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œè¯¥è„šæœ¬å<strong>æç¤ºæˆåŠŸè¿›å…¥çº¿åˆ·æ¨¡å¼æ—¶å°±é©¬ä¸Šæ’åˆ·å¥½é•œåƒçš„ U ç›˜</strong> ä¸è¦é”™è¿‡æ—¶æœº(ã€‚ãƒ»âˆ€ãƒ»)ãƒ</p><p>å…¶å®è¿™ä¸ªå·¥å…·ä¹Ÿå°±æ˜¯ä¸€æ¡ <code>adb shell reboot update</code> æŒ‡ä»¤è€Œå·²ï¼Œ<code>abd connect  IP</code> è¿æ¥åˆ°ç›’å­ä¹‹åï¼Œç„¶åå†æ‰§è¡Œ <code>adb shell reboot update</code> ï¼Œç„¶åå†æ’å…¥åˆšåˆšå†™å¥½é•œåƒçš„ U ç›˜ã€‚æ’ä¸Š HMDI çº¿è¿æ¥æ˜¾ç¤ºå™¨å°±ä¼šçœ‹åˆ°æ§åˆ¶ç»ˆç«¯è¾“å‡ºç€å¯åŠ¨æµç¨‹çš„ç”»é¢ï¼Œä¸Šé¢è¿˜æœ‰å››åªå°ä¼é¹…ï¼Œè¿™å°±è¯´æ˜æˆ‘ä»¬æˆåŠŸè¿›å…¥äº† Armbian ç³»ç»Ÿ</p><h4 id="å°†-OpenWrt-å†™å…¥åˆ°-EMMC-å­˜å‚¨ä¸­"><a href="#å°†-OpenWrt-å†™å…¥åˆ°-EMMC-å­˜å‚¨ä¸­" class="headerlink" title="å°† OpenWrt å†™å…¥åˆ° EMMC å­˜å‚¨ä¸­"></a>å°† OpenWrt å†™å…¥åˆ° EMMC å­˜å‚¨ä¸­</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line">./inst-to-emmc.sh</span><br></pre></td></tr></table></figure><p>è¯¥è„šæœ¬æˆåŠŸæ‰§è¡Œåï¼Œé‡å¯æ‹”æ‰ U ç›˜å°±å¯ä»¥ç›´æ¥è¿›å…¥åˆ° OpenWrt ç³»ç»Ÿä¸­äº†ï¼šï¼‰</p><h2 id="OpenWrt-ä¸Šçš„ä¸€äº›å°ä¼˜åŒ–"><a href="#OpenWrt-ä¸Šçš„ä¸€äº›å°ä¼˜åŒ–" class="headerlink" title="OpenWrt ä¸Šçš„ä¸€äº›å°ä¼˜åŒ–"></a>OpenWrt ä¸Šçš„ä¸€äº›å°ä¼˜åŒ–</h2><p>ä½¿ç”¨  <code>ifconfig eth0 192.168.0.211 netmask 255.255.255.0</code> ä¿®æ”¹ eth0 çš„ IP ï¼Œä½†ä¾æ—§æ— æ³• ping é€š 192.168.0.1 ç½‘å…³ï¼Œè¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹ LAN å£çš„é…ç½®ã€‚</p><h3 id="ä¿®æ”¹-IP"><a href="#ä¿®æ”¹-IP" class="headerlink" title="ä¿®æ”¹ IP"></a>ä¿®æ”¹ IP</h3><p>ç”±äº LAN å£é»˜è®¤çš„æ˜¯ <code>192.168.1.1</code> ï¼Œå¦‚æœä½ çš„ç½‘ç»œä¸æ˜¯åœ¨è¯¥ç½‘æ®µä¸‹çš„è¯å°±è¿ä¸ä¸Šè¯¥è®¾å¤‡ï¼Œæ‰€ä»¥å¦‚æœä¸æ˜¯é‡‡ç”¨ç›´è¿ç½‘çº¿çš„è¯ï¼Œè€Œæ˜¯å°†ç›’å­è¿æ¥åœ¨è·¯ç”±å™¨ï¼Œè¿™æ—¶å°±éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹é»˜è®¤çš„é…ç½®æ‰èƒ½è¿æ¥åˆ°ç›’å­ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">config</span> <span class="string">interface</span> <span class="string">'lan'</span></span><br><span class="line">        <span class="string">option</span> <span class="string">type</span> <span class="string">'bridge'</span></span><br><span class="line">        <span class="string">option</span> <span class="string">ifname</span> <span class="string">'eth0'</span></span><br><span class="line">        <span class="string">option</span> <span class="string">proto</span> <span class="string">'static'</span></span><br><span class="line">        <span class="string">option</span> <span class="string">netmask</span> <span class="string">'255.255.255.0'</span></span><br><span class="line">        <span class="string">option</span> <span class="string">dns</span> <span class="string">'119.29.29.29'</span></span><br><span class="line">        <span class="string">option</span> <span class="string">gateway</span> <span class="string">'192.168.0.1'</span></span><br><span class="line">        <span class="string">option</span> <span class="string">delegate</span> <span class="string">'0'</span></span><br><span class="line">        <span class="string">option</span> <span class="string">ipaddr</span> <span class="string">'192.168.0.211'</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸€ä¸‹ lan ç½‘å£çš„ IP ä¸ºä½ å†…ç½‘å¯è®¿é—®åˆ°çš„ IP å³å¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¯¥ IP è®¿é—® OpenWrt ç³»ç»Ÿäº†</p><h3 id="å®‰è£…å¿…å¤‡å·¥å…·"><a href="#å®‰è£…å¿…å¤‡å·¥å…·" class="headerlink" title="å®‰è£…å¿…å¤‡å·¥å…·"></a>å®‰è£…å¿…å¤‡å·¥å…·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆä¿®æ”¹ä¸€ä¸‹ opkg æºï¼Œé»˜è®¤ç»™ä¿®æ”¹ä¸ºä¸­ç§‘å¤§çš„ä»£ç†é•œåƒç«™äº†ï¼Œè¿™ç‚¹ä¸é”™</span></span><br><span class="line">â•­â”€root@OpenWrt /mnt</span><br><span class="line">â•°â”€<span class="comment"># opkg update</span></span><br><span class="line">Downloading https://openwrt.proxy.ustclug.org/snapshots/targets/armvirt/64/packages/Packages.gz</span><br><span class="line">Updated list of available packages <span class="keyword">in</span> /var/opkg-lists/openwrt_core</span><br><span class="line">Downloading</span><br></pre></td></tr></table></figure><ul><li>git  è¿™æ˜¯å¿…é¡»çš„å‘€</li><li>ca-bundle å’Œ ca-certificatesï¼Œhttps å¿…é¡»è¦ç”¨åˆ°çš„</li><li>git-http å¦‚æœä¸è£…çš„è¯åœ¨ git clone https çš„ repo æ—¶ä¼šæç¤º <a href="https://stackoverflow.com/questions/8329485/unable-to-find-remote-helper-for-https-during-git-clone" target="_blank" rel="noopener">â€œUnable to find remote helper for â€˜httpsâ€™â€ during git clone</a></li><li>zsh å’Œ oh-my-zshï¼Œå¼ºå¤§çš„ shell ä¸ç”¨åºŸè¯ğŸ˜‹</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@OpenWrt /mnt</span><br><span class="line">â•°â”€<span class="comment"># opkg install git zsh git-http ca-bundle ca-certificates wget curl</span></span><br><span class="line">Package git (2.25.1-1) installed <span class="keyword">in</span> root is up to date.</span><br><span class="line">Package zsh (5.7.1-1) installed <span class="keyword">in</span> root is up to date.</span><br><span class="line">Package git-http (2.25.1-1) installed <span class="keyword">in</span> root is up to date.</span><br><span class="line">Package ca-bundle (20190110-2) installed <span class="keyword">in</span> root is up to date.</span><br><span class="line">Package ca-certificates (20190110-2) installed <span class="keyword">in</span> root is up to date.</span><br><span class="line">Upgrading wget on root from 1.20.3-2 to 1.20.3-3...</span><br><span class="line">Downloading https://openwrt.proxy.ustclug.org/snapshots/packages/aarch64_generic/packages/wget_1.20.3-3_aarch64_generic.ipk</span><br><span class="line">Multiple packages (librt and librt) providing same name marked HOLD or PREFER. Using latest.</span><br><span class="line">Upgrading curl on root from 7.66.0-1 to 7.68.0-1...</span><br><span class="line">Downloading https://openwrt.proxy.ustclug.org/snapshots/packages/aarch64_generic/base/curl_7.68.0-1_aarch64_generic.ipk</span><br><span class="line">Configuring curl.</span><br><span class="line">Configuring wget.</span><br></pre></td></tr></table></figure><h4 id="zsh-è¸©å‘"><a href="#zsh-è¸©å‘" class="headerlink" title="zsh è¸©å‘"></a>zsh è¸©å‘</h4><p>å®‰è£…å®Œ oh-my-zsh ä¹‹åï¼Œä¸ä¼šå¸®ä½ ä¿®æ”¹ <code>/etc/passwd</code> ä¸­çš„é…ç½®ï¼Œéœ€è¦æ‰‹åŠ¨ä¿®æ”¹ï¼Œç„¶åæˆ‘è¿˜æ˜¯æŒ‰ç…§å¾€å¸¸çš„ä¿®æ”¹æ–¹æ³•ï¼š</p><p><code>root:x:0:0:root:/root:/bin/zsh</code></p><p>ç¬¬äºŒå¤©æˆ‘å¼€å¼€å¿ƒå¿ƒåœ° ssh ç™»å½•æ—¶ï¼Œå½“åœºç¿»è½¦äº†ï¼Œå®ƒä¼šæç¤º<code>Permission denied, please try again.</code> ï¼Œå’¦æˆ‘å¯†ç å°±æ˜¯è¿™ä¸ªå‘€ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">debug1: Next authentication method: password</span><br><span class="line">root@192.168.0.211<span class="string">'s password:</span></span><br><span class="line"><span class="string">debug1: Authentications that can continue: publickey,password,keyboard-interactive</span></span><br><span class="line"><span class="string">Permission denied, please try again.</span></span><br><span class="line"><span class="string">root@192.168.0.211'</span>s password:</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘é€šè¿‡ OpenWrt çš„ web ç®¡ç†é¡µé¢èƒ½æ­£å¸¸ç™»å½•ï¼Œåœ¨ web ç®¡ç†ä¸­çš„ <code>TTYD ç»ˆç«¯</code>ä¸­å°è¯•ç™»å½•ï¼Œç„¶åå°±ä¼šæç¤ºä½  <code>connection closed</code> ï¼Œçœ‹æ¥æ‰¾åˆ°é—®é¢˜çš„åŸå› äº†ï¼Œç”¨æˆ·ç™»å½•æ—¶æ— æ³•æ‰§è¡Œå®ƒçš„ shell æ‰€è‡´ã€‚æ¯”è¾ƒå¥½çš„è§£å†³åŠæ³•å°±æ˜¯åœ¨ web ç®¡ç†é¡µé¢ <code>ç³»ç»Ÿ â€“&gt; å¤‡ä»½/å‡çº§</code>é‚£é‡Œå¤‡ä»½é…ç½®æ–‡ä»¶ â€“&gt;æŠŠå¤‡ä»½ä¸‹è½½ä¸‹æ¥ â€“&gt; <del>ç„¶åè§£åŒ…åä¿®æ”¹é…ç½®æ–‡ä»¶å†æ‰“åŒ…</del> ç›´æ¥ä½¿ç”¨ vim æ‰“å¼€ tar åŒ…ä¿®æ”¹ <code>/etc/passwd</code> â€“&gt; å†ä¸Šä¼ æ¢å¤é…ç½®æ–‡ä»¶å³å¯ã€‚æ›²çº¿æ•‘å›½ ã¤ï¹âŠ‚ ä¸è¿‡åœ¨æ­¤éœ€è¦æ³¨æ„ä¸€ä¸‹å¤‡ä»½æ–‡ä»¶çš„ç›®å½•ç»“æ„ï¼Œè§£åŒ…å‰ç›®å½•ç»“æ„æ˜¯ä»€ä¹ˆæ ·ï¼Œé‡æ–°æ‰“åŒ…ä¹‹åçš„ç›®å½•ç»“æ„ä¹Ÿæ˜¯ä»€ä¹ˆæ ·ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">OpenWrt login: root</span><br><span class="line">Password:</span><br><span class="line">login: can<span class="string">'t execute '</span>/bin/zsh<span class="string">': No such file or directory</span></span><br></pre></td></tr></table></figure><p>åœ¨ Debian å’Œ Ubuntu å‘è¡Œç‰ˆä¸­ zsh ä¼šé»˜è®¤å®‰è£…åœ¨ <code>/bin/zsh</code> ä¸‹ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª <code>/usr/bin/zsh</code> çš„ä¸€ä¸ªè½¯é“¾æ¥ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€debian@debian /mnt/d/Desktop</span><br><span class="line">â•°â”€$ ls -alh /bin/zsh</span><br><span class="line">-rwxr-xr-x 1 root root 842K Feb  5  2019 /bin/zsh</span><br><span class="line">â•­â”€debian@debian /mnt/d/Desktop</span><br><span class="line">â•°â”€$ ls -alh /usr/bin/zsh</span><br><span class="line">lrwxrwxrwx 1 root root 8 Aug 31  2019 /usr/bin/zsh -&gt; /bin/zsh</span><br></pre></td></tr></table></figure><p>è€Œåœ¨ OpenWrt ä¸­å´é»˜è®¤å®‰è£…åœ¨äº† <code>/usr/bin/zsh</code> ä¸‹ï¼Œä¹Ÿæ²¡æœ‰ä¸º <code>/bin/zsh</code> åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥ï¼Œä¹Ÿå°è¯•è¿‡ä½¿ç”¨scp çš„æ–¹å¼å°† <code>/usr/bin/zsh</code> å¤åˆ¶åˆ° <code>/bin/zsh</code> ï¼Œæ²¡æƒ³åˆ° scp ä¹Ÿéœ€è¦ç”¨æˆ·çš„ shell ç¨‹åºæ¥æ‰§è¡ŒğŸ˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># OpenWrt ä¸‹ zsh çš„å®‰è£…è·¯å¾„ä¸º /usr/bin/zsh è€Œä¸æ˜¯ä¼ ç»Ÿå‘ç›¸ç‰ˆä¸­çš„ /bin/zsh</span></span><br><span class="line">â•­â”€root@OpenWrt ~</span><br><span class="line">â•°â”€<span class="comment"># where zsh</span></span><br><span class="line">/usr/bin/zsh</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°è¯•ä½¿ç”¨ scp å¤åˆ¶ä¸€ä»½ zsh åˆ° /bin/zsh ï¼Œä¸å¾—è¡Œï¼ğŸ˜‚</span></span><br><span class="line">â•­â”€debian@debian ~</span><br><span class="line">â•°â”€$ scp root@192.168.0.211:/usr/bin/zsh root@192.168.0.211:/bin/zsh</span><br><span class="line">root@192.168.0.211<span class="string">'s password:</span></span><br><span class="line"><span class="string">Permission denied, please try again.</span></span><br></pre></td></tr></table></figure><h3 id="éƒ¨ç½²ä¸€ä¸‹-K3s"><a href="#éƒ¨ç½²ä¸€ä¸‹-K3s" class="headerlink" title="éƒ¨ç½²ä¸€ä¸‹ K3s"></a>éƒ¨ç½²ä¸€ä¸‹ K3s</h3><p>è¿™é‡Œåªæ˜¯ç®€å•çš„éƒ¨ç½²è¯•ç”¨ä¸€ä¸‹ï¼ŒåæœŸæˆ‘ä¼šè¯¦ç»†è®²ä¸€ä¸‹å…³äº K3s çš„å†…å®¹ã€‚</p><h4 id="å®˜æ–¹è„šæœ¬"><a href="#å®˜æ–¹è„šæœ¬" class="headerlink" title="å®˜æ–¹è„šæœ¬"></a>å®˜æ–¹è„šæœ¬</h4><p>æ ¹æ®å®˜æ–¹çš„è„šæœ¬ä¸€å¥å‘½ä»¤è¡Œ<code>curl -sfL https://get.k3s.io | sh -</code>å°±èƒ½è·‘èµ· K3s å‡ºæ¥ï¼Œæ¯”èµ·éš”å£çš„ K8s è¦ç®€å•å¾ˆå¤šå¾ˆå¤šã€‚ä½†æ˜¯è„šæœ¬ä¸€æ‰§è¡Œå°±ç¿»è½¦äº†ğŸ˜‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@OpenWrt ~</span><br><span class="line">â•°â”€<span class="comment"># curl -sfL https://get.k3s.io | sh -</span></span><br><span class="line">[ERROR]  Can not find systemd or openrc to use as a process supervisor <span class="keyword">for</span> k3s</span><br></pre></td></tr></table></figure><p>ç”±äº OpenWrt æ²¡æœ‰ systemd å’Œ OpenRC æ¥ç®¡ç†è¿›ç¨‹ï¼Œæ‰€ä»¥æ— æ³•é€šè¿‡è„šæœ¬çš„æ–¹å¼ä¸€é”®éƒ¨ç½²ï¼Œåªèƒ½äºŒè¿›åˆ¶éƒ¨ç½²å•¦ã€‚å› ä¸º systemd å¯¹äº OpenWrt æ¥è®²è¿‡äºå¤æ‚è‡ƒè‚¿ï¼Œå¯¹äºå‡ å MB ç”šè‡³å‡  MB å­˜å‚¨ç©ºé—´çš„è·¯ç”±å™¨æ¥è¯´å®åœ¨æ˜¯è£…ä¸ä¸‹ã€‚æ‰€ä»¥ OpenWrt ä½¿ç”¨çš„ init ç³»ç»Ÿæ˜¯ <code>procd</code></p><blockquote><p>Whereas desktop distributions use <a href="https://en.wikipedia.org/wiki/GLib" target="_blank" rel="noopener">glib</a>+<a href="https://en.wikipedia.org/wiki/D-Bus" target="_blank" rel="noopener">dbus</a>+<a href="https://en.wikipedia.org/wiki/udev" target="_blank" rel="noopener">udev(part of systemd)</a>, OpenWrt uses <a href="https://openwrt.org/docs/techref/libubox" target="_blank" rel="noopener">libubox</a>+<a href="https://openwrt.org/docs/techref/ubus" target="_blank" rel="noopener">ubus</a>+<a href="https://openwrt.org/docs/techref/hotplug_legacy" target="_blank" rel="noopener">hotplug2</a>. This provides some pretty awesome functionality without requiring huge libraries with huge dependencies (<em>cough</em> glib).</p></blockquote><h4 id="äºŒè¿›åˆ¶éƒ¨ç½²"><a href="#äºŒè¿›åˆ¶éƒ¨ç½²" class="headerlink" title="äºŒè¿›åˆ¶éƒ¨ç½²"></a>äºŒè¿›åˆ¶éƒ¨ç½²</h4><p>åœ¨ K3s çš„ release é¡µé¢ä¸‹è½½åˆ° <a href="https://github.com/rancher/k3s/releases/download/v1.17.3%2Bk3s1/k3s-arm64" target="_blank" rel="noopener">k3s-arm64</a> äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æˆ‘æ”¾åœ¨äº† <code>/opt/bin/</code> ç›®å½•ä¸‹ï¼Œå¹¶åœ¨ <code>.zshrc</code> è¿½åŠ  <code>export PATH=/opt/bin:$PATH</code> ç¯å¢ƒå˜é‡ã€‚</p><h4 id="usage"><a href="#usage" class="headerlink" title="usage"></a>usage</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@OpenWrt ~</span><br><span class="line">â•°â”€<span class="comment"># k3s</span></span><br><span class="line">NAME:</span><br><span class="line">   k3s - Kubernetes, but small and simple</span><br><span class="line"></span><br><span class="line">USAGE:</span><br><span class="line">   k3s [global options] <span class="built_in">command</span> [<span class="built_in">command</span> options] [arguments...]</span><br><span class="line"></span><br><span class="line">VERSION:</span><br><span class="line">   v1.17.3+k3s1 (5b17a175)</span><br><span class="line"></span><br><span class="line">COMMANDS:</span><br><span class="line">   server        Run management server</span><br><span class="line">   agent         Run node agent</span><br><span class="line">   kubectl       Run kubectl</span><br><span class="line">   crictl        Run crictl</span><br><span class="line">   ctr           Run ctr</span><br><span class="line">   check-config  Run config check</span><br><span class="line">   <span class="built_in">help</span>, h       Shows a list of commands or <span class="built_in">help</span> <span class="keyword">for</span> one <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line">GLOBAL OPTIONS:</span><br><span class="line">   --debug        Turn on debug logs [<span class="variable">$K3S_DEBUG</span>]</span><br><span class="line">   --<span class="built_in">help</span>, -h     show <span class="built_in">help</span></span><br><span class="line">   --version, -v  <span class="built_in">print</span> the version</span><br></pre></td></tr></table></figure><h4 id="check-config"><a href="#check-config" class="headerlink" title="check-config"></a>check-config</h4><p>å¯åŠ¨ä¸€ä¸ª K3s é›†ç¾¤ä¹‹å‰çº¿ check config ä¸€ä¸‹ä¸‹ğŸ˜‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">â•­â”€root@OpenWrt</span> <span class="string">~</span></span><br><span class="line"><span class="string">â•°â”€#</span> <span class="string">k3s</span> <span class="string">check-config</span></span><br><span class="line"><span class="string">INFO[0000]</span> <span class="string">Preparing</span> <span class="string">data</span> <span class="string">dir</span> <span class="string">/var/lib/rancher/k3s/data/a61d93bc56bb3dd34b5ca93517164f5b503e16b6c7414e87b11cf336eeb8ebd7</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Verifying binaries in /var/lib/rancher/k3s/data/a61d93bc56bb3dd34b5ca93517164f5b503e16b6c7414e87b11cf336eeb8ebd7/bin:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">sha256sum:</span> <span class="string">good</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">links:</span> <span class="string">good</span></span><br><span class="line"></span><br><span class="line"><span class="attr">System:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">/usr/sbin</span> <span class="string">iptables</span> <span class="string">v1.8.3</span> <span class="string">(legacy):</span> <span class="string">ok</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">swap:</span> <span class="string">disabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">routes:</span> <span class="string">ok</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Limits:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">/proc/sys/kernel/keys/root_maxkeys:</span> <span class="number">1000000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">modprobe:</span> <span class="string">module</span> <span class="string">configs</span> <span class="string">not</span> <span class="string">found</span> <span class="string">in</span> <span class="string">modules.dep</span></span><br><span class="line"><span class="attr">info:</span> <span class="string">reading</span> <span class="string">kernel</span> <span class="string">config</span> <span class="string">from</span> <span class="string">/proc/config.gz</span> <span class="string">...</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Generally Necessary:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">cgroup hierarchy:</span> <span class="string">properly</span> <span class="string">mounted</span> <span class="string">[/sys/fs/cgroup]</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_NAMESPACES:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_NET_NS:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_PID_NS:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_IPC_NS:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_UTS_NS:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_CGROUPS:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_CGROUP_CPUACCT:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_CGROUP_DEVICE:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_CGROUP_FREEZER:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_CGROUP_SCHED:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_CPUSETS:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_MEMCG:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_KEYS:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_VETH:</span> <span class="string">enabled</span> <span class="string">(as</span> <span class="string">module)</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_BRIDGE:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_BRIDGE_NETFILTER:</span> <span class="string">enabled</span> <span class="string">(as</span> <span class="string">module)</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_NF_NAT_IPV4:</span> <span class="string">missing</span> <span class="string">(fail)</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_IP_NF_FILTER:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_IP_NF_TARGET_MASQUERADE:</span> <span class="string">enabled</span> <span class="string">(as</span> <span class="string">module)</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_NETFILTER_XT_MATCH_ADDRTYPE:</span> <span class="string">enabled</span> <span class="string">(as</span> <span class="string">module)</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_NETFILTER_XT_MATCH_CONNTRACK:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_NETFILTER_XT_MATCH_IPVS:</span> <span class="string">enabled</span> <span class="string">(as</span> <span class="string">module)</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_IP_NF_NAT:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_NF_NAT:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_NF_NAT_NEEDED:</span> <span class="string">missing</span> <span class="string">(fail)</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_POSIX_MQUEUE:</span> <span class="string">enabled</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Optional Features:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_USER_NS:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_SECCOMP:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_CGROUP_PIDS:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_BLK_CGROUP:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_BLK_DEV_THROTTLING:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_CGROUP_PERF:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_CGROUP_HUGETLB:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_NET_CLS_CGROUP:</span> <span class="string">enabled</span> <span class="string">(as</span> <span class="string">module)</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_CGROUP_NET_PRIO:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_CFS_BANDWIDTH:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_FAIR_GROUP_SCHED:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_RT_GROUP_SCHED:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_IP_NF_TARGET_REDIRECT:</span> <span class="string">enabled</span> <span class="string">(as</span> <span class="string">module)</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_IP_SET:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_IP_VS:</span> <span class="string">enabled</span> <span class="string">(as</span> <span class="string">module)</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_IP_VS_NFCT:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_IP_VS_PROTO_TCP:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_IP_VS_PROTO_UDP:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_IP_VS_RR:</span> <span class="string">enabled</span> <span class="string">(as</span> <span class="string">module)</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_EXT4_FS:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_EXT4_FS_POSIX_ACL:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">CONFIG_EXT4_FS_SECURITY:</span> <span class="string">enabled</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Network Drivers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">"overlay":</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">CONFIG_VXLAN:</span> <span class="string">enabled</span> <span class="string">(as</span> <span class="string">module)</span></span><br><span class="line">      <span class="string">Optional</span> <span class="string">(for</span> <span class="string">encrypted</span> <span class="string">networks):</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">CONFIG_CRYPTO:</span> <span class="string">enabled</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">CONFIG_CRYPTO_AEAD:</span> <span class="string">enabled</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">CONFIG_CRYPTO_GCM:</span> <span class="string">enabled</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">CONFIG_CRYPTO_SEQIV:</span> <span class="string">enabled</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">CONFIG_CRYPTO_GHASH:</span> <span class="string">enabled</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">CONFIG_XFRM:</span> <span class="string">enabled</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">CONFIG_XFRM_USER:</span> <span class="string">enabled</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">CONFIG_XFRM_ALGO:</span> <span class="string">enabled</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">CONFIG_INET_ESP:</span> <span class="string">enabled</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">CONFIG_INET_XFRM_MODE_TRANSPORT:</span> <span class="string">missing</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Storage Drivers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">"overlay":</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">CONFIG_OVERLAY_FS:</span> <span class="string">enabled</span></span><br><span class="line"></span><br><span class="line"><span class="attr">STATUS:</span> <span class="number">2</span> <span class="string">(fail)</span></span><br></pre></td></tr></table></figure><p>å‘ç° <code>ONFIG_NF_NAT_IPV4: missing (fail)</code> å’Œ <code>CONFIG_NF_NAT_NEEDED: missing (fail)</code> å¤±è´¥äº†ğŸ™ƒï¼Œå…ˆä¸ç®¡çœ‹çœ‹èƒ½ä¸èƒ½è·‘èµ·æ¥å†è¯´ã€‚</p><h4 id="åˆ›å»º-K3s-é›†ç¾¤"><a href="#åˆ›å»º-K3s-é›†ç¾¤" class="headerlink" title="åˆ›å»º K3s é›†ç¾¤"></a>åˆ›å»º K3s é›†ç¾¤</h4><p>æ ¹æ® K3s çš„æ–‡æ¡£ï¼Œä½¿ç”¨ <code>k3s server</code>  é€‰é¡¹å°±èƒ½åˆ›å»ºä¸€ä¸ª K3s é›†ç¾¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@OpenWrt ~</span><br><span class="line">â•°â”€<span class="comment"># k3s server</span></span><br><span class="line">INFO[2020-03-08T20:17:00.103499172+08:00] Starting k3s v1.17.3+k3s1 (5b17a175)</span><br><span class="line">INFO[2020-03-08T20:17:00.112443368+08:00] Kine listening on unix://kine.sock</span><br><span class="line">INFO[2020-03-08T20:17:01.572347551+08:00] Active TLS secret  (ver=) (count 7): map[listener.cattle.io/cn-10.43.0.1:10.43.0.1 listener.cattle.io/cn-127.0.0.1:127.0.0.1 listener.cattle.io/cn-192.168.0.212:192.168.0.212 listener.cattle.io/cn-kubernetes:kubernetes listener.cattle.io/cn-kubernetes.default:kubernetes.default listener.cattle.io/cn-kubernetes.default.svc.cluster.local:kubernetes.default.svc.cluster.local listener.cattle.io/cn-localhost:localhost listener.cattle.io/<span class="built_in">hash</span>:089b0c6a0b78e5f9d3a33b154e97185f644ed693bee80d4559c47e00f19af2f8]</span><br><span class="line">INFO[2020-03-08T20:17:01.591244044+08:00] Running kube-apiserver --advertise-port=6443 --allow-privileged=<span class="literal">true</span> --anonymous-auth=<span class="literal">false</span> --api-audiences=unknown --authorization-mode=Node,RBAC --basic-auth-file=/var/lib/rancher/k3s/server/cred/passwd --<span class="built_in">bind</span>-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --<span class="built_in">enable</span>-admission-plugins=NodeRestriction --etcd-servers=unix://kine.sock --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=k3s --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key</span><br><span class="line">Flag --basic-auth-file has been deprecated, Basic authentication mode is deprecated and will be removed <span class="keyword">in</span> a future release. It is not recommended <span class="keyword">for</span> production environments.</span><br><span class="line">I0308 20:17:01.593861    9319 server.go:622] external host was not specified, using 192.168.0.212</span><br><span class="line">I0308 20:17:01.594884    9319 server.go:163] Version: v1.17.3+k3s1</span><br><span class="line">I0308 20:17:04.485872    9319 plugins.go:158] Loaded 11 mutating admission controller(s) successfully <span class="keyword">in</span> the following order: NamespaceLifecycle,LimitRanger,ServiceAccount,NodeRestriction,TaintNodesByCondition,Priority,DefaultTolerationSeconds,DefaultStorageClass,StorageObjectInUseProtection,MutatingAdmissionWebhook,RuntimeClass.</span><br><span class="line">I0308 20:17:04.485954    9319 plugins.go:161] Loaded 7 validating admission controller(s) successfully <span class="keyword">in</span> the following order: LimitRanger,ServiceAccount,Priority,PersistentVolumeClaimResize,ValidatingAdmissionWebhook,RuntimeClass,ResourceQuota.</span><br><span class="line">I0308 20:17:04.491004    9319 plugins.go:158] Loaded 11 mutating admission controller(s) successfully <span class="keyword">in</span> the following order: NamespaceLifecycle,LimitRanger,ServiceAccount,NodeRestriction,TaintNodesByCondition,Priority,DefaultTolerationSeconds,DefaultStorageClass,StorageObjectInUseProtection,MutatingAdmissionWebhook,RuntimeClass.</span><br><span class="line">I0308 20:17:04.491084    9319 plugins.go:161] Loaded 7 validating admission controller(s) successfully <span class="keyword">in</span> the following order: LimitRanger,ServiceAccount,Priority,PersistentVolumeClaimResize,ValidatingAdmissionWebhook,RuntimeClass,ResourceQuota.</span><br><span class="line">I0308 20:17:04.592193    9319 master.go:267] Using reconciler: lease</span><br><span class="line">I0308 20:17:04.699310    9319 rest.go:115] the default service ipfamily <span class="keyword">for</span> this cluster is: IPv4</span><br><span class="line">W0308 20:17:06.161374    9319 genericapiserver.go:404] Skipping API batch/v2alpha1 because it has no resources.</span><br><span class="line">W0308 20:17:06.212135    9319 genericapiserver.go:404] Skipping API discovery.k8s.io/v1alpha1 because it has no resources.</span><br><span class="line">W0308 20:17:06.264606    9319 genericapiserver.go:404] Skipping API node.k8s.io/v1alpha1 because it has no resources.</span><br><span class="line">W0308 20:17:06.361403    9319 genericapiserver.go:404] Skipping API rbac.authorization.k8s.io/v1alpha1 because it has no resources.</span><br><span class="line">W0308 20:17:06.379432    9319 genericapiserver.go:404] Skipping API scheduling.k8s.io/v1alpha1 because it has no resources.</span><br><span class="line">W0308 20:17:06.447661    9319 genericapiserver.go:404] Skipping API storage.k8s.io/v1alpha1 because it has no resources.</span><br><span class="line">W0308 20:17:06.550084    9319 genericapiserver.go:404] Skipping API apps/v1beta2 because it has no resources.</span><br><span class="line">W0308 20:17:06.550168    9319 genericapiserver.go:404] Skipping API apps/v1beta1 because it has no resources.</span><br><span class="line">I0308 20:17:06.599929    9319 plugins.go:158] Loaded 11 mutating admission controller(s) successfully <span class="keyword">in</span> the following order: NamespaceLifecycle,LimitRanger,ServiceAccount,NodeRestriction,TaintNodesByCondition,Priority,DefaultTolerationSeconds,DefaultStorageClass,StorageObjectInUseProtection,MutatingAdmissionWebhook,RuntimeClass.</span><br><span class="line">I0308 20:17:06.600017    9319 plugins.go:161] Loaded 7 validating admission controller(s) successfully <span class="keyword">in</span> the following order: LimitRanger,ServiceAccount,Priority,PersistentVolumeClaimResize,ValidatingAdmissionWebhook,RuntimeClass,ResourceQuota.</span><br><span class="line">I0308 20:17:16.394308    9319 dynamic_cafile_content.go:166] Starting client-ca-bundle::/var/lib/rancher/k3s/server/tls/client-ca.crt</span><br><span class="line">I0308 20:17:16.394308    9319 dynamic_cafile_content.go:166] Starting request-header::/var/lib/rancher/k3s/server/tls/request-header-ca.crt</span><br><span class="line">I0308 20:17:16.395251    9319 dynamic_serving_content.go:129] Starting serving-cert::/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt::/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key</span><br><span class="line">I0308 20:17:16.397910    9319 secure_serving.go:178] Serving securely on 127.0.0.1:6444</span><br><span class="line">I0308 20:17:16.398017    9319 tlsconfig.go:219] Starting DynamicServingCertificateController</span><br><span class="line">I0308 20:17:16.398379    9319 autoregister_controller.go:140] Starting autoregister controller</span><br><span class="line">I0308 20:17:16.398459    9319 cache.go:32] Waiting <span class="keyword">for</span> caches to sync <span class="keyword">for</span> autoregister controller</span><br><span class="line">I0308 20:17:16.398723    9319 available_controller.go:386] Starting AvailableConditionController</span><br><span class="line">I0308 20:17:16.398794    9319 cache.go:32] Waiting <span class="keyword">for</span> caches to sync <span class="keyword">for</span> AvailableConditionController controller</span><br><span class="line">I0308 20:17:16.399089    9319 crdregistration_controller.go:111] Starting crd-autoregister controller</span><br><span class="line">I0308 20:17:16.399288    9319 shared_informer.go:197] Waiting <span class="keyword">for</span> caches to sync <span class="keyword">for</span> crd-autoregister</span><br><span class="line">I0308 20:17:16.399546    9319 crd_finalizer.go:263] Starting CRDFinalizer</span><br><span class="line">I0308 20:17:16.399790    9319 controller.go:85] Starting OpenAPI controller</span><br><span class="line">I0308 20:17:16.400002    9319 customresource_discovery_controller.go:208] Starting DiscoveryController</span><br><span class="line">I0308 20:17:16.400341    9319 naming_controller.go:288] Starting NamingConditionController</span><br><span class="line">I0308 20:17:16.400638    9319 establishing_controller.go:73] Starting EstablishingController</span><br><span class="line">I0308 20:17:16.400854    9319 nonstructuralschema_controller.go:191] Starting NonStructuralSchemaConditionController</span><br><span class="line">I0308 20:17:16.401201    9319 apiapproval_controller.go:185] Starting KubernetesAPIApprovalPolicyConformantConditionController</span><br><span class="line">I0308 20:17:16.402017    9319 cluster_authentication_trust_controller.go:440] Starting cluster_authentication_trust_controller controller</span><br><span class="line">I0308 20:17:16.402094    9319 shared_informer.go:197] Waiting <span class="keyword">for</span> caches to sync <span class="keyword">for</span> cluster_authentication_trust_controller</span><br><span class="line">I0308 20:17:16.403447    9319 apiservice_controller.go:94] Starting APIServiceRegistrationController</span><br><span class="line">I0308 20:17:16.403537    9319 cache.go:32] Waiting <span class="keyword">for</span> caches to sync <span class="keyword">for</span> APIServiceRegistrationController controller</span><br><span class="line">I0308 20:17:16.403681    9319 controller.go:81] Starting OpenAPI AggregationController</span><br><span class="line">I0308 20:17:16.418176    9319 dynamic_cafile_content.go:166] Starting client-ca-bundle::/var/lib/rancher/k3s/server/tls/client-ca.crt</span><br><span class="line">I0308 20:17:16.419045    9319 dynamic_cafile_content.go:166] Starting request-header::/var/lib/rancher/k3s/server/tls/request-header-ca.crt</span><br><span class="line">I0308 20:17:16.606683    9319 shared_informer.go:204] Caches are synced <span class="keyword">for</span> cluster_authentication_trust_controller</span><br><span class="line">I0308 20:17:16.613199    9319 cache.go:39] Caches are synced <span class="keyword">for</span> autoregister controller</span><br><span class="line">I0308 20:17:16.614373    9319 cache.go:39] Caches are synced <span class="keyword">for</span> AvailableConditionController controller</span><br><span class="line">I0308 20:17:16.614504    9319 shared_informer.go:204] Caches are synced <span class="keyword">for</span> crd-autoregister</span><br><span class="line">I0308 20:17:16.616912    9319 cache.go:39] Caches are synced <span class="keyword">for</span> APIServiceRegistrationController controller</span><br><span class="line">E0308 20:17:16.633217    9319 controller.go:150] Unable to perform initial Kubernetes service initialization: Service <span class="string">"kubernetes"</span> is invalid: spec.clusterIP: Invalid value: <span class="string">"10.43.0.1"</span>: cannot allocate resources of <span class="built_in">type</span> serviceipallocations at this time</span><br><span class="line">E0308 20:17:16.639707    9319 controller.go:155] Unable to remove old endpoints from kubernetes service: StorageError: key not found, Code: 1, Key: /registry/masterleases/192.168.0.212, ResourceVersion: 0, AdditionalErrorMsg:</span><br><span class="line">I0308 20:17:17.394171    9319 controller.go:107] OpenAPI AggregationController: Processing item</span><br><span class="line">I0308 20:17:17.394300    9319 controller.go:130] OpenAPI AggregationController: action <span class="keyword">for</span> item : Nothing (removed from the queue).</span><br><span class="line">I0308 20:17:17.394391    9319 controller.go:130] OpenAPI AggregationController: action <span class="keyword">for</span> item k8s_internal_local_delegation_chain_0000000000: Nothing (removed from the queue).</span><br><span class="line">I0308 20:17:17.431078    9319 storage_scheduling.go:133] created PriorityClass system-node-critical with value 2000001000</span><br><span class="line">I0308 20:17:17.445315    9319 storage_scheduling.go:133] created PriorityClass system-cluster-critical with value 2000000000</span><br><span class="line">I0308 20:17:17.445429    9319 storage_scheduling.go:142] all system priority classes are created successfully or already exist.</span><br><span class="line">I0308 20:17:18.939225    9319 controller.go:606] quota admission added evaluator <span class="keyword">for</span>: roles.rbac.authorization.k8s.io</span><br><span class="line">I0308 20:17:19.103599    9319 controller.go:606] quota admission added evaluator <span class="keyword">for</span>: rolebindings.rbac.authorization.k8s.io</span><br><span class="line">W0308 20:17:19.434785    9319 lease.go:224] Resetting endpoints <span class="keyword">for</span> master service <span class="string">"kubernetes"</span> to [192.168.0.212]</span><br><span class="line">I0308 20:17:19.438264    9319 controller.go:606] quota admission added evaluator <span class="keyword">for</span>: endpoints</span><br><span class="line">INFO[2020-03-08T20:17:19.626006745+08:00] Running kube-scheduler --<span class="built_in">bind</span>-address=127.0.0.1 --kubeconfig=/var/lib/rancher/k3s/server/cred/scheduler.kubeconfig --leader-elect=<span class="literal">false</span> --port=10251 --secure-port=0</span><br><span class="line">INFO[2020-03-08T20:17:19.629360634+08:00] Running kube-controller-manager --allocate-node-cidrs=<span class="literal">true</span> --<span class="built_in">bind</span>-address=127.0.0.1 --cluster-cidr=10.42.0.0/16 --cluster-signing-cert-file=/var/lib/rancher/k3s/server/tls/server-ca.crt --cluster-signing-key-file=/var/lib/rancher/k3s/server/tls/server-ca.key --kubeconfig=/var/lib/rancher/k3s/server/cred/controller.kubeconfig --leader-elect=<span class="literal">false</span> --port=10252 --root-ca-file=/var/lib/rancher/k3s/server/tls/server-ca.crt --secure-port=0 --service-account-private-key-file=/var/lib/rancher/k3s/server/tls/service.key --use-service-account-credentials=<span class="literal">true</span></span><br><span class="line">I0308 20:17:19.655674    9319 controllermanager.go:161] Version: v1.17.3+k3s1</span><br><span class="line">I0308 20:17:19.657868    9319 deprecated_insecure_serving.go:53] Serving insecurely on [::]:10252</span><br><span class="line">INFO[2020-03-08T20:17:19.658915754+08:00] Waiting <span class="keyword">for</span> cloudcontroller rbac role to be created</span><br><span class="line">INFO[2020-03-08T20:17:19.664219593+08:00] Creating CRD addons.k3s.cattle.io</span><br><span class="line">INFO[2020-03-08T20:17:19.686759095+08:00] Creating CRD helmcharts.helm.cattle.io</span><br><span class="line">W0308 20:17:19.691464    9319 authorization.go:47] Authorization is disabled</span><br><span class="line">W0308 20:17:19.691548    9319 authentication.go:92] Authentication is disabled</span><br><span class="line">I0308 20:17:19.691602    9319 deprecated_insecure_serving.go:51] Serving healthz insecurely on [::]:10251</span><br><span class="line">INFO[2020-03-08T20:17:19.762954369+08:00] Waiting <span class="keyword">for</span> CRD helmcharts.helm.cattle.io to become available</span><br><span class="line">INFO[2020-03-08T20:17:20.280122513+08:00] Done waiting <span class="keyword">for</span> CRD helmcharts.helm.cattle.io to become available</span><br><span class="line">INFO[2020-03-08T20:17:20.320314726+08:00] Writing static file: /var/lib/rancher/k3s/server/static/charts/traefik-1.81.0.tgz</span><br><span class="line">INFO[2020-03-08T20:17:20.321243908+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/coredns.yaml</span><br><span class="line">INFO[2020-03-08T20:17:20.321700333+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/metrics-server/aggregated-metrics-reader.yaml</span><br><span class="line">INFO[2020-03-08T20:17:20.322113756+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/metrics-server/metrics-apiservice.yaml</span><br><span class="line">INFO[2020-03-08T20:17:20.322546305+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/metrics-server/metrics-server-deployment.yaml</span><br><span class="line">INFO[2020-03-08T20:17:20.322947895+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/metrics-server/metrics-server-service.yaml</span><br><span class="line">INFO[2020-03-08T20:17:20.323365277+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/metrics-server/resource-reader.yaml</span><br><span class="line">INFO[2020-03-08T20:17:20.323768992+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/traefik.yaml</span><br><span class="line">INFO[2020-03-08T20:17:20.324187832+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/ccm.yaml</span><br><span class="line">INFO[2020-03-08T20:17:20.324764300+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/<span class="built_in">local</span>-storage.yaml</span><br><span class="line">INFO[2020-03-08T20:17:20.325164932+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/metrics-server/auth-delegator.yaml</span><br><span class="line">INFO[2020-03-08T20:17:20.325563897+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/metrics-server/auth-reader.yaml</span><br><span class="line">INFO[2020-03-08T20:17:20.325996113+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/rolebindings.yaml</span><br><span class="line">INFO[2020-03-08T20:17:20.527152139+08:00] Starting k3s.cattle.io/v1, Kind=Addon controller</span><br><span class="line">INFO[2020-03-08T20:17:20.529057920+08:00] Node token is available at /var/lib/rancher/k3s/server/token</span><br><span class="line">INFO[2020-03-08T20:17:20.529286008+08:00] To join node to cluster: k3s agent -s https://192.168.0.212:6443 -t <span class="variable">$&#123;NODE_TOKEN&#125;</span></span><br><span class="line">INFO[2020-03-08T20:17:20.527299933+08:00] Waiting <span class="keyword">for</span> master node  startup: resource name may not be empty</span><br><span class="line">INFO[2020-03-08T20:17:20.725057527+08:00] Waiting <span class="keyword">for</span> cloudcontroller rbac role to be created</span><br><span class="line">I0308 20:17:20.810135    9319 controller.go:606] quota admission added evaluator <span class="keyword">for</span>: addons.k3s.cattle.io</span><br><span class="line">INFO[2020-03-08T20:17:20.830872877+08:00] Starting helm.cattle.io/v1, Kind=HelmChart controller</span><br><span class="line">INFO[2020-03-08T20:17:20.831652182+08:00] Starting batch/v1, Kind=Job controller</span><br><span class="line">INFO[2020-03-08T20:17:20.832798326+08:00] Starting /v1, Kind=Service controller</span><br><span class="line">INFO[2020-03-08T20:17:20.833998971+08:00] Starting /v1, Kind=Pod controller</span><br><span class="line">INFO[2020-03-08T20:17:20.835217450+08:00] Starting /v1, Kind=Endpoints controller</span><br><span class="line">INFO[2020-03-08T20:17:20.836690891+08:00] Starting /v1, Kind=Secret controller</span><br><span class="line">INFO[2020-03-08T20:17:20.838569298+08:00] Starting /v1, Kind=Node controller</span><br></pre></td></tr></table></figure><h4 id="é›†ç¾¤çŠ¶æ€"><a href="#é›†ç¾¤çŠ¶æ€" class="headerlink" title="é›†ç¾¤çŠ¶æ€"></a>é›†ç¾¤çŠ¶æ€</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@OpenWrt ~</span><br><span class="line">â•°â”€<span class="comment"># ks cluster-info</span></span><br><span class="line">Kubernetes master is running at https://127.0.0.1:6443</span><br><span class="line">CoreDNS is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span><br><span class="line">Metrics-server is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/https:metrics-server:/proxy</span><br><span class="line"></span><br><span class="line">To further debug and diagnose cluster problems, use <span class="string">'kubectl cluster-info dump'</span>.</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@OpenWrt ~</span><br><span class="line">â•°â”€<span class="comment"># ks get node</span></span><br><span class="line">NAME      STATUS   ROLES    AGE     VERSION</span><br><span class="line">openwrt   Ready    master   5m26s   v1.17.3+k3s1</span><br><span class="line">â•­â”€root@OpenWrt ~</span><br><span class="line">â•°â”€<span class="comment"># ks get pod -n kube-system</span></span><br><span class="line">NAME                                      READY   STATUS              RESTARTS   AGE</span><br><span class="line">metrics-server-6d684c7b5-8gv8j            1/1     Running             0          5m20s</span><br><span class="line"><span class="built_in">local</span>-path-provisioner-58fb86bdfd-h8jkk   1/1     Running             0          5m20s</span><br><span class="line">svclb-traefik-9kwxx                       0/2     ContainerCreating   0          3m29s</span><br><span class="line">helm-install-traefik-nw9td                0/1     Completed           2          5m20s</span><br><span class="line">coredns-d798c9dd-62sb9                    1/1     Running             0          5m20s</span><br><span class="line">traefik-6787cddb4b-p6hs9                  1/1     Running             0          3m30s</span><br><span class="line">â•­â”€root@OpenWrt ~</span><br><span class="line">â•°â”€<span class="comment"># ks describe node</span></span><br><span class="line">Name:               openwrt</span><br><span class="line">Roles:              master</span><br><span class="line">Labels:             beta.kubernetes.io/arch=arm64</span><br><span class="line">                    beta.kubernetes.io/instance-type=k3s</span><br><span class="line">                    beta.kubernetes.io/os=linux</span><br><span class="line">                    k3s.io/hostname=openwrt</span><br><span class="line">                    k3s.io/internal-ip=192.168.0.212</span><br><span class="line">                    kubernetes.io/arch=arm64</span><br><span class="line">                    kubernetes.io/hostname=openwrt</span><br><span class="line">                    kubernetes.io/os=linux</span><br><span class="line">                    node-role.kubernetes.io/master=<span class="literal">true</span></span><br><span class="line">                    node.kubernetes.io/instance-type=k3s</span><br><span class="line">Annotations:        flannel.alpha.coreos.com/backend-data: &#123;<span class="string">"VtepMAC"</span>:<span class="string">"ca:8f:da:03:f3:e5"</span>&#125;</span><br><span class="line">                    flannel.alpha.coreos.com/backend-type: vxlan</span><br><span class="line">                    flannel.alpha.coreos.com/kube-subnet-manager: <span class="literal">true</span></span><br><span class="line">                    flannel.alpha.coreos.com/public-ip: 192.168.0.212</span><br><span class="line">                    node.alpha.kubernetes.io/ttl: 0</span><br><span class="line">                    volumes.kubernetes.io/controller-managed-attach-detach: <span class="literal">true</span></span><br><span class="line">CreationTimestamp:  Sun, 08 Mar 2020 20:17:23 +0800</span><br><span class="line">Taints:             &lt;none&gt;</span><br><span class="line">Unschedulable:      <span class="literal">false</span></span><br><span class="line">Lease:</span><br><span class="line">  HolderIdentity:  openwrt</span><br><span class="line">  AcquireTime:     &lt;<span class="built_in">unset</span>&gt;</span><br><span class="line">  RenewTime:       Sun, 08 Mar 2020 20:23:44 +0800</span><br><span class="line">Conditions:</span><br><span class="line">  Type                 Status  LastHeartbeatTime                 LastTransitionTime                Reason                       Message</span><br><span class="line">  ----               ------  -----------------               ------------------              ------                     -------</span><br><span class="line">  NetworkUnavailable   False   Sun, 08 Mar 2020 20:17:38 +0800   Sun, 08 Mar 2020 20:17:38 +0800   FlannelIsUp                  Flannel is running on this node</span><br><span class="line">  MemoryPressure       False   Sun, 08 Mar 2020 20:19:54 +0800   Sun, 08 Mar 2020 20:17:23 +0800   KubeletHasSufficientMemory   kubelet has sufficient memory available</span><br><span class="line">  DiskPressure         False   Sun, 08 Mar 2020 20:19:54 +0800   Sun, 08 Mar 2020 20:17:23 +0800   KubeletHasNoDiskPressure     kubelet has no disk pressure</span><br><span class="line">  PIDPressure          False   Sun, 08 Mar 2020 20:19:54 +0800   Sun, 08 Mar 2020 20:17:23 +0800   KubeletHasSufficientPID      kubelet has sufficient PID available</span><br><span class="line">  Ready                True    Sun, 08 Mar 2020 20:19:54 +0800   Sun, 08 Mar 2020 20:17:34 +0800   KubeletReady                 kubelet is posting ready status</span><br><span class="line">Addresses:</span><br><span class="line">  InternalIP:  192.168.0.212</span><br><span class="line">  Hostname:    openwrt</span><br><span class="line">Capacity:</span><br><span class="line">  cpu:                4</span><br><span class="line">  ephemeral-storage:  925844Ki</span><br><span class="line">  hugepages-1Gi:      0</span><br><span class="line">  hugepages-2Mi:      0</span><br><span class="line">  hugepages-32Mi:     0</span><br><span class="line">  hugepages-64Ki:     0</span><br><span class="line">  memory:             1851688Ki</span><br><span class="line">  pods:               110</span><br><span class="line">Allocatable:</span><br><span class="line">  cpu:                4</span><br><span class="line">  ephemeral-storage:  900661043</span><br><span class="line">  hugepages-1Gi:      0</span><br><span class="line">  hugepages-2Mi:      0</span><br><span class="line">  hugepages-32Mi:     0</span><br><span class="line">  hugepages-64Ki:     0</span><br><span class="line">  memory:             1851688Ki</span><br><span class="line">  pods:               110</span><br><span class="line">System Info:</span><br><span class="line">  Machine ID:                 96581db4e82a9fb36b0553115e64de1a</span><br><span class="line">  System UUID:</span><br><span class="line">  Boot ID:                    87856a60-0482-4ca3-a144-2ec073e1d2c7</span><br><span class="line">  Kernel Version:             5.4.23-amlogic-flippy-28+</span><br><span class="line">  OS Image:                   OpenWrt SNAPSHOT</span><br><span class="line">  Operating System:           linux</span><br><span class="line">  Architecture:               arm64</span><br><span class="line">  Container Runtime Version:  containerd://1.3.3-k3s1</span><br><span class="line">  Kubelet Version:            v1.17.3+k3s1</span><br><span class="line">  Kube-Proxy Version:         v1.17.3+k3s1</span><br><span class="line">PodCIDR:                      10.42.0.0/24</span><br><span class="line">PodCIDRs:                     10.42.0.0/24</span><br><span class="line">ProviderID:                   k3s://openwrt</span><br><span class="line">Non-terminated Pods:          (5 <span class="keyword">in</span> total)</span><br><span class="line">  Namespace                   Name                                       CPU Requests  CPU Limits  Memory Requests  Memory Limits  AGE</span><br><span class="line">  ---------                 ----                                     ------------  ----------  ---------------  -------------  ---</span><br><span class="line">  kube-system                 metrics-server-6d684c7b5-8gv8j             0 (0%)        0 (0%)      0 (0%)           0 (0%)         6m10s</span><br><span class="line">  kube-system                 <span class="built_in">local</span>-path-provisioner-58fb86bdfd-h8jkk    0 (0%)        0 (0%)      0 (0%)           0 (0%)         6m10s</span><br><span class="line">  kube-system                 svclb-traefik-9kwxx                        0 (0%)        0 (0%)      0 (0%)           0 (0%)         4m19s</span><br><span class="line">  kube-system                 coredns-d798c9dd-62sb9                     100m (2%)     0 (0%)      70Mi (3%)        170Mi (9%)     6m10s</span><br><span class="line">  kube-system                 traefik-6787cddb4b-p6hs9                   0 (0%)        0 (0%)      0 (0%)           0 (0%)         4m20s</span><br><span class="line">Allocated resources:</span><br><span class="line">  (Total limits may be over 100 percent, i.e., overcommitted.)</span><br><span class="line">  Resource           Requests   Limits</span><br><span class="line">  --------         -------- ------</span><br><span class="line">  cpu                100m (2%)  0 (0%)</span><br><span class="line">  memory             70Mi (3%)  170Mi (9%)</span><br><span class="line">  ephemeral-storage  0 (0%)     0 (0%)</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason                   Age                    From                 Message</span><br><span class="line">  ----   ------                 ----                 ----               -------</span><br><span class="line">  Normal   Starting                 6m24s                  kubelet, openwrt     Starting kubelet.</span><br><span class="line">  Warning  InvalidDiskCapacity      6m24s                  kubelet, openwrt     invalid capacity 0 on image filesystem</span><br><span class="line">  Normal   NodeHasSufficientPID     6m23s (x2 over 6m24s)  kubelet, openwrt     Node openwrt status is now: NodeHasSufficientPID</span><br><span class="line">  Normal   NodeHasSufficientMemory  6m23s (x2 over 6m24s)  kubelet, openwrt     Node openwrt status is now: NodeHasSufficientMemory</span><br><span class="line">  Normal   NodeHasNoDiskPressure    6m23s (x2 over 6m24s)  kubelet, openwrt     Node openwrt status is now: NodeHasNoDiskPressure</span><br><span class="line">  Normal   NodeAllocatableEnforced  6m23s                  kubelet, openwrt     Updated Node Allocatable <span class="built_in">limit</span> across pods</span><br><span class="line">  Normal   Starting                 6m23s                  kube-proxy, openwrt  Starting kube-proxy.</span><br><span class="line">  Normal   NodeReady                6m13s                  kubelet, openwrt     Node openwrt status is now: NodeReady</span><br></pre></td></tr></table></figure><h2 id="ç»“æŸå•¦"><a href="#ç»“æŸå•¦" class="headerlink" title="ç»“æŸå•¦"></a>ç»“æŸå•¦</h2><p>å…³äº OpenWrt æœ€é‡è¦çš„<code>é€æ˜ä»£ç†æ—è·¯ç½‘å…³</code> è¿˜æ²¡æœ‰è®²åˆ°ï¼Œç¨åå†æ›´æ–°ä¸€ä¸‹ï¼Œæ¯•ç«Ÿæˆ‘ä¹°äº†æ˜¯ç©å„¿ K3s çš„ğŸ˜‚ã€‚æ€»ä¹‹è¿™ä¸ªåƒåœ¾è¿˜æ˜¯å€¼å¾—æ¡çš„ï¼Œå‡†å¤‡å†æ¡å‡ å°ï¼Ÿéƒ¨ç½²ä¸ª K3s é›†ç¾¤ï¼Ÿé«˜å¯ç”¨ï¼Ÿäº”èŠ‚ç‚¹ï¼Ÿä»¨ master ä¿© nodeï¼Ÿï¼ˆé€ƒ</p><p>ä¸è¿‡æ„å¤–å‘ç°è¯¥ç›’å­çš„ USB å£ç«Ÿç„¶æ”¯æŒä½¿ç”¨ echo å‘½ä»¤æ¥ä¿®æ”¹ <code>/sys/bus/usb/devices/usb1/power/level</code> çš„å€¼æ¥æ§åˆ¶ USB çš„ç”µæºçŠ¶æ€ï¼Œè¿™æ ·ä»USB å£å¼•å‡ºæ­£è´Ÿææ¥åœ¨ç»§ç”µå™¨ä¸Šï¼Œè¿™å°±æ˜¯ä¸€ä¸ªé€šè¿‡ç½‘ç»œæ§åˆ¶çš„å¼€å…³ã€‚æˆ‘åœ¨ <code>R6300V2</code> å’Œ <code>WNDR3700V4</code> ä¸Šæ¢¦å¯ä»¥æ±‚æ²¡æœ‰çš„åŠŸèƒ½å±…ç„¶åœ¨è¿™ä¸ªç ´ç›’å­ä¸Šæœ‰ã€‚æ„å¤–æ”¶è·ï¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@OpenWrt ~</span><br><span class="line">â•°â”€<span class="comment"># tree /sys/bus/usb/devices/usb1/power/</span></span><br><span class="line">/sys/bus/usb/devices/usb1/power/</span><br><span class="line">â”œâ”€â”€ active_duration</span><br><span class="line">â”œâ”€â”€ autosuspend</span><br><span class="line">â”œâ”€â”€ autosuspend_delay_ms</span><br><span class="line">â”œâ”€â”€ connected_duration</span><br><span class="line">â”œâ”€â”€ control</span><br><span class="line">â”œâ”€â”€ level</span><br><span class="line">â”œâ”€â”€ runtime_active_time</span><br><span class="line">â”œâ”€â”€ runtime_status</span><br><span class="line">â”œâ”€â”€ runtime_suspended_time</span><br><span class="line">â”œâ”€â”€ wakeup</span><br><span class="line">â”œâ”€â”€ wakeup_abort_count</span><br><span class="line">â”œâ”€â”€ wakeup_active</span><br><span class="line">â”œâ”€â”€ wakeup_active_count</span><br><span class="line">â”œâ”€â”€ wakeup_count</span><br><span class="line">â”œâ”€â”€ wakeup_expire_count</span><br><span class="line">â”œâ”€â”€ wakeup_last_time_ms</span><br><span class="line">â”œâ”€â”€ wakeup_max_time_ms</span><br><span class="line">â””â”€â”€ wakeup_total_time_ms</span><br></pre></td></tr></table></figure><p>æœ€åç¥å¤§å®¶ <strong>Happy Hacking</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;K3s&quot;&gt;&lt;a href=&quot;#K3s&quot;
        
      
    
    </summary>
    
    
      <category term="åˆ·æœº" scheme="https://blog.k8s.li/categories/%E5%88%B7%E6%9C%BA/"/>
    
    
      <category term="è½¯è·¯ç”±" scheme="https://blog.k8s.li/tags/%E8%BD%AF%E8%B7%AF%E7%94%B1/"/>
    
      <category term="OpenWrt" scheme="https://blog.k8s.li/tags/OpenWrt/"/>
    
      <category term="K3s" scheme="https://blog.k8s.li/tags/K3s/"/>
    
  </entry>
  
  <entry>
    <title>è®©å›¾ç‰‡é£èµ·æ¥ oh-my-webp.sh ï¼</title>
    <link href="https://blog.k8s.li/oh-my-webpsh.html"/>
    <id>https://blog.k8s.li/oh-my-webpsh.html</id>
    <published>2020-03-04T16:00:00.000Z</published>
    <updated>2020-03-05T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å’±æ¥æ¨é”€ webp server go å•¦ ï¼ˆxå°å£°</p></blockquote><h2 id="åŠé€€ä¸‰è¿ğŸ˜‚"><a href="#åŠé€€ä¸‰è¿ğŸ˜‚" class="headerlink" title="åŠé€€ä¸‰è¿ğŸ˜‚"></a>åŠé€€ä¸‰è¿ğŸ˜‚</h2><ul><li>éœ€è¦é…ç½® nginx åå‘ä»£ç†ï¼ˆï¼ï¹ï¼œï¼‰</li><li>å›¾ç‰‡å¿…é¡»æ”¾åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œå›¾åºŠä¸å¾—è¡Œ (ï¾‰*ï½¥Ï‰ï½¥)ï¾‰</li><li>éœ€è¦ç‹¬ç«‹çš„æœåŠ¡å™¨ï¼ŒGitHub page ä¹‹ç±»çš„ä¸å¾—è¡Œï¼ˆâ•¯ï¸¿â•°ï¼‰</li></ul><p>ä¸è¿‡ï¼Œå¯¹äºå·²ç»ä¼šè‡ªç”±è®¿é—®äº’è”ç½‘çš„äººæ¥è¯´è¿™éƒ½ä¸éš¾ (â—Ë‡âˆ€Ë‡â—) ï¼Œé£Ÿç”¨è¿‡ç¨‹ä¸­æœ‰ä»€ä¹ˆç–‘é—®çš„è¯ä¹Ÿå¯ä»¥è”ç³»å’±ï¼Œå’±ä¼šå°½è‡ªå·±æ‰€èƒ½æä¾›ä¸€äº›å¸®åŠ©ğŸ˜˜ï¼Œä¸€èµ·æ¥å®Œå–„è¿™ä¸ªå¼€æºé¡¹ç›®ã€‚</p><h2 id="WebP"><a href="#WebP" class="headerlink" title="WebP"></a>WebP</h2><blockquote><p>WebPçš„æœ‰æŸå‹ç¼©ç®—æ³•æ˜¯åŸºäºVP8è§†é¢‘æ ¼å¼çš„å¸§å†…ç¼–ç [17]ï¼Œå¹¶ä»¥RIFFä½œä¸ºå®¹å™¨æ ¼å¼ã€‚[2] å› æ­¤ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…·æœ‰å…«ä½è‰²å½©æ·±åº¦å’Œä»¥1:2çš„æ¯”ä¾‹è¿›è¡Œè‰²åº¦å­é‡‡æ ·çš„äº®åº¦-è‰²åº¦æ¨¡å‹ï¼ˆYCbCr 4:2:0ï¼‰çš„åŸºäºå—çš„è½¬æ¢æ–¹æ¡ˆã€‚[18] ä¸å«å†…å®¹çš„æƒ…å†µä¸‹ï¼ŒRIFFå®¹å™¨è¦æ±‚åªéœ€20å­—èŠ‚çš„å¼€é”€ï¼Œä¾ç„¶èƒ½ä¿å­˜é¢å¤–çš„ å…ƒæ•°æ®(metadata)ã€‚[2] WebPå›¾åƒçš„è¾¹é•¿é™åˆ¶ä¸º16383åƒç´ ã€‚</p></blockquote><p>WebP æ˜¯ä¸€ç§è¡ç”Ÿè‡ª Google VP8 çš„å›¾åƒæ ¼å¼ï¼ŒåŒæ—¶æ”¯æŒæœ‰æŸå’Œæ— æŸç¼–ç ã€‚å½“ä½¿ç”¨æœ‰æŸæ¨¡å¼ï¼Œå®ƒåœ¨ç›¸åŒä½“ç§¯æä¾›æ¯” JPG å›¾åƒæ›´å¥½çš„è´¨é‡ï¼›å½“ä½¿ç”¨æ— æŸæ¨¡å¼ï¼Œå®ƒæä¾›æ¯”æœ€ä½³å‹ç¼©çš„ PNG å›¾åƒæ›´å°çš„ä½“ç§¯ã€‚ç®€å•æ¥è¯´ï¼ŒWebP å›¾ç‰‡æ ¼å¼çš„å­˜åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨ WebP ä¸Šå±•ç¤ºçš„å›¾ç‰‡ä½“ç§¯å¯ä»¥æœ‰è¾ƒå¤§å¹…åº¦çš„ç¼©å°ã€‚ç½‘ç«™ä¸Šçš„å›¾ç‰‡èµ„æºå¦‚æœä½¿ç”¨ WebPï¼Œé‚£ä¹ˆè‡ªç„¶ä¹Ÿä¼šå‡å°‘è¿™äº›å›¾ç‰‡æ–‡ä»¶çš„åŠ è½½æ—¶é—´ï¼Œä¹Ÿå°±å¸¦æ¥äº†ç½‘ç«™åŠ è½½æ€§èƒ½çš„æå‡ã€‚å…³äº webp å›¾åƒæ ¼å¼çš„å…·ä½“å®ç°ç»†èŠ‚å¯ä»¥å»ç»´åŸºç™¾ç§‘æˆ–è€…æ–‡æœ«æˆ‘æåˆ°çš„æ¨èé˜…è¯»çœ‹ä¸€ä¸‹ï¼Œæ€»ä¹‹ webp å¾ˆé¦™å°±æ˜¯å•¦ (â—â€™â—¡â€™â—)</p><h3 id="æ”¯æŒæƒ…å†µ"><a href="#æ”¯æŒæƒ…å†µ" class="headerlink" title="æ”¯æŒæƒ…å†µ"></a>æ”¯æŒæƒ…å†µ</h3><p>æ ¹æ® <a href="https://caniuse.com/#search=webp" target="_blank" rel="noopener">caniuse</a> çš„ç»Ÿè®¡æƒ…å†µï¼Œä¸»æµæµè§ˆå™¨ï¼ˆæ¥è¿‘80%ï¼‰éƒ½æ”¯æŒ webp äº†ï¼Œå¦‚æœé‡åˆ° Safari è¿™æ ·çš„å¥‡è‘©ï¼Œå’±ç›´æ¥è¿”å›åŸå›¾ã€‚IE æµè§ˆå™¨ï¼Ÿï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200306094307271.png" alt="image-20200306094307271"></p><h2 id="webp-sh"><a href="#webp-sh" class="headerlink" title="webp-sh"></a>webp-sh</h2><ul><li>å®˜ç½‘ <a href="https://webp.sh" target="_blank" rel="noopener">webp.sh</a></li><li>GitHub <a href="https://github.com/webp-sh" target="_blank" rel="noopener">webp-sh</a></li></ul><p>webp server é¡¾åæ€ä¹‰å°±æ˜¯ webp æœåŠ¡å™¨å•¦ï¼Œç”¨äºå°†ç½‘ç«™é‡Œçš„å›¾ç‰‡ï¼ˆjpgã€pngã€jpegç­‰ï¼‰è½¬æ¢æˆ webp å›¾åƒç¼–ç æ ¼å¼ï¼Œè€Œä¸”æ— é¡»ä¿®æ”¹åšå®¢ç«™ç‚¹å†…å›¾ç‰‡çš„ url ï¼Œå› æ­¤å¯¹äºè®¿é—®å›¾ç‰‡èµ„æºçš„å®¢æˆ·ç«¯æ¥è®²æ˜¯é€æ˜çš„ã€‚ä¸»æµçš„ CDN ä¹Ÿæ”¯æŒè¿™æ ·ç±»ä¼¼çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ Cloudflare çš„ <a href="">Polish</a> ï¼Œå¯ä»¥å‚è€ƒ <a href="https://support.cloudflare.com/hc/en-us/articles/360000607372-Using-Cloudflare-Polish-to-compress-images">Using Cloudflare Polish to compress images</a> ã€‚ä½†æ˜¯å¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤ï¼Œå›¾ç‰‡è½¬ç ä¸ç¼–ç è¿™éƒ½æ˜¯è¦ç®—åŠ›çš„ï¼Œéƒ½æ˜¯è¦è®¡ç®—èµ„æºçš„ï¼Œéƒ½æ˜¯è¦ CPU çš„ï¼Œéƒ½æ˜¯è¦èŠ±é’±çš„ğŸ˜‚ã€‚è¯´åˆ°åº•è¿˜æ˜¯ç©·å•Šï¼ˆå’± webp server æ˜¯å¼€æºå…è´¹çš„ã€‚</p><blockquote><p>æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯â€”â€”æˆ‘ä»¬è®¿é—®çš„ URL å¯ä»¥å®Œå…¨ä¸ç”¨æ”¹å˜ï¼Œè®¿å®¢è®¿é—®çš„ä¾ç„¶æ˜¯ <code>https://image.nova.moe/tsuki/tsuki.jpg</code> ï¼Œä½†æ˜¯å¾—åˆ°çš„å›¾ç‰‡æ ¼å¼ä¸ºï¼š<code>image/webp</code>ï¼Œè€Œä¸”ä½“ç§¯å‡å°‘äº†ä¸å°‘ã€‚</p></blockquote><p>å…¶å® webp server æœ‰å¤šç§è¯­è¨€éƒ½å®ç°äº†ï¼Œå¹¶ä¸”è¿™äº›ä»“åº“è¿˜éƒ½æ”¾åœ¨äº† <a href="https://github.com/webp-sh" target="_blank" rel="noopener">webp-sh</a> è¯¥ Organizations ä¸‹ã€‚ä¸è¿‡å’±æ¯”è¾ƒå–œæ¬¢ golang æ‰€ä»¥å°±æ¨è webp server go å•¦ğŸ˜‚ï¼Œéš”å£çš„ webp server rust åˆ«æ‰“æˆ‘å•Šï¼ˆé€ƒ</p><blockquote><p>è¿™ä¸ªå·¥å…·å°±æ˜¯ç”± <a href="https://nova.moe/" target="_blank" rel="noopener">Nova ç«¥é‹</a>ã€ <a href="https://www.bennythink.com" target="_blank" rel="noopener">Benny</a> ã€<a href="https://blog.0xbbc.com/" target="_blank" rel="noopener">cocoa</a> ä»¥åŠ <a href="https://blog.k8s.li/">muzi</a> å°ç›†å‹ä¸€èµ·é¼“æ£çš„ webp_server_go å•¦ï¼</p></blockquote><ul><li><a href="https://github.com/webp-sh/webp_server_go" target="_blank" rel="noopener">webp_server_go</a></li><li><a href="https://github.com/webp-sh/webp_server_rs" target="_blank" rel="noopener">webp_server_rs</a></li><li><a href="https://github.com/webp-sh/webp_server_node" target="_blank" rel="noopener">webp_server_node</a></li><li><a href="https://github.com/webp-sh/webp_server_java" target="_blank" rel="noopener">webp_server_java</a></li><li><a href="https://github.com/webp-sh/webp_server_python" target="_blank" rel="noopener">webp_server_python</a></li></ul><h2 id="é£Ÿç”¨æŒ‡å—"><a href="#é£Ÿç”¨æŒ‡å—" class="headerlink" title="é£Ÿç”¨æŒ‡å—"></a>é£Ÿç”¨æŒ‡å—</h2><h3 id="1-ä¸‹è½½"><a href="#1-ä¸‹è½½" class="headerlink" title="1. ä¸‹è½½"></a>1. ä¸‹è½½</h3><p>é¦–å…ˆåˆ° <a href="https://github.com/webp-sh/webp_server_go/releases" target="_blank" rel="noopener">release</a> é¡µé¢ä¸‹è½½å·²ç»ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶æˆ–è€…æ ¹æ®è‡ªå·±çš„å‘è¡Œç‰ˆé€‰æ‹©ä¸‹è½½ rpm æˆ– deb åŒ…ï¼Œåœ¨æ­¤è¦æ³¨æ„é€‰æ‹©ä¸‹è½½ç¬¦åˆè‡ªå·±çš„ arch å’Œ OSã€‚</p><p>è‡³äºå®‰è£…è·¯å¾„ï¼Œæˆ‘ä¸ªäººæ›´å€¾å‘äºæ”¾åœ¨ <code>/opt/</code> ç›®å½•ä¸‹ï¼Œå› ä¸ºè¿™ä¸ªç›®å½•ä¸‹çš„ä¸œè¥¿éƒ½æ˜¯è‡ªå·±å®‰è£…çš„ï¼Œè€Œä¸”ä¹Ÿä¸ä¾èµ–äºç‰¹å®šçš„å‘è¡Œç‰ˆï¼Œæ–¹ä¾¿åšå®¢è¿ç§»ï¼ˆæ¬å®¶ï¼‰ï¼Œæ¬å®¶çš„æ—¶å€™ç›´æ¥æ‰“åŒ… <code>/opt</code> ç›®å½•ï¼Œç„¶å scp ä¸€ä¸‹å°±å·é“ºç›–èµ°äººï¼Œå¤šæ–¹ä¾¿å‘€ğŸ˜‚ã€‚</p><h3 id="2-é…ç½®"><a href="#2-é…ç½®" class="headerlink" title="2. é…ç½®"></a>2. é…ç½®</h3><p>é£Ÿç”¨ webp-server-go ä¹‹å‰é€‰å‡†å¤‡å¥½ä¸€ä¸ª <code>config.json</code> é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"HOST"</span>: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">  <span class="attr">"PORT"</span>: <span class="string">"3333"</span>,</span><br><span class="line">  <span class="attr">"QUALITY"</span>: <span class="string">"80"</span>,</span><br><span class="line">  <span class="attr">"IMG_PATH"</span>: <span class="string">"/var/www/hexo"</span>,</span><br><span class="line">  <span class="attr">"EXHAUST_PATH"</span>: <span class="string">"./dist"</span>,</span><br><span class="line">  <span class="attr">"ALLOWED_TYPES"</span>: [<span class="string">"jpg"</span>,<span class="string">"png"</span>,<span class="string">"jpeg"</span>,<span class="string">"bmp"</span>,<span class="string">"gif"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>HOSTï¼šå¯¹äº webp server æœåŠ¡æ¥è®²åªéœ€è¦ç›‘å¬ 127.0.0.1 è¿™ä¸ªæœ¬æœºåœ°å€å°±å¯ä»¥äº†ï¼Œç¨åä½¿ç”¨ nginx åå‘ä»£ç†ä¸€ä¸‹ã€‚</li><li>PORTï¼šå°±æ˜¯ webp server æœåŠ¡ç›‘å¬çš„çš„ç«¯å£å·ï¼Œæ ¹æ®è‡ªå·±éœ€æ±‚ä¿®æ”¹</li><li>QUALITYï¼šç¼–ç çš„è´¨é‡ï¼Œä¸€èˆ¬æ¨è 75 ï¼Œä¸è¿‡ä½¿ç”¨ 80 ä¹Ÿæ˜¯ä¸é”™çš„ã€‚</li><li>IMG_PATHï¼šç½‘ç«™çš„æ ¹ç›®å½•ï¼Œæ ¹ç›®å½•ï¼Œæ ¹ç›®å½•ï¼Œä¸€å®šè¦é…ç½®ä½ å›¾ç‰‡ url çš„æ ¹ç›®å½•ã€‚</li><li>EXHAUST_PATHï¼šè½¬æ¢åçš„ webp å›¾ç‰‡æ–‡ä»¶å­˜æ”¾ä½ç½®ï¼Œæå‰åˆ›å»ºå¥½ã€‚</li><li>ALLOWED_TYPESï¼šå…è®¸è½¬ç çš„å›¾ç‰‡æ ¼å¼ï¼Œç›®å‰æ”¯æŒè¿™å‡ ç§ã€‚</li></ul><p>æ¥ä¸‹æ¥å†é…ç½®ä»¥ä¸‹ nginx ï¼Œä¸‹é¢ä»¥æˆ‘çš„ hexo åšå®¢ä¸ºä¾‹ï¼Œhugo ä¹ŸåŒæ ·å¦‚æ­¤ã€‚å†æ·»åŠ ä¸€å— localtion å­—æ®µå³å¯ï¼Œå¦‚æœä½ ä¿®æ”¹äº†é»˜è®¤ç«¯å£å·çš„è¯ä¸è¦å¿˜è®°ä¿®æ”¹ä¸ºä½ æ”¹ä¹‹åçš„ç«¯å£å·ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~* \.(png|jpg|jpeg)$</span> &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://127.0.0.1:3333;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>/etc/nginx/conf.d/blog.conf</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  blog.<span class="number">502</span>.li;</span><br><span class="line">        <span class="attribute">set</span> <span class="variable">$base</span> /var/www/hexo/public;</span><br><span class="line">        <span class="attribute">root</span> <span class="variable">$base</span>/;</span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">index</span>  index.html;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attribute">location</span> <span class="regexp">~* \.(png|jpg|jpeg)$</span> &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://127.0.0.1:3333;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">            <span class="attribute">proxy_hide_header</span> X-Powered-By;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> HOST <span class="variable">$http_host</span>;</span><br><span class="line">            <span class="attribute">add_header</span> Cache-Control <span class="string">'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è¿‡åœ¨æ­¤éœ€è¦æ³¨æ„ï¼Œnginx çš„ location å­—æ®µçš„è·¯å¾„ä¸€å®šè¦å’Œ webp server <code>config.json</code> é‡Œçš„ <code>IMG_PATH</code> ç›¸å¯¹åº”ï¼Œä¸ç„¶ä¼šå¯¼è‡´è¯·æ±‚èµ„æºçš„ uri ä¸ webp server è½¬æ¢åçš„æ–‡ä»¶è·¯å¾„ä¸ä¸€è‡´è€Œå¯¼è‡´èµ„æº 404 ã€‚è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ location é‚£é‡Œä¸èƒ½ä»…ä»…æ·»åŠ  <code>proxy_pass http://127.0.0.1:3333;</code> ï¼Œè¿™æ ·æµè§ˆå™¨çš„ UA ä¼šè¢« nginx ç»™åƒæ‰ğŸ˜„ï¼Œnginx å°†è¯·æ±‚ proxy ç»™ webp server åæ— æ³•ä» headers é‚£é‡Œè·å–åˆ° UA ï¼Œè€Œå¯¼è‡´ <code>Safari</code> æµè§ˆå™¨æ— æ³•æ­£å¸¸è¾“å‡ºåŸå›¾ã€‚æ‰€ä»¥ä»¥ä¸‹å‡ è¡Œæ·»åŠ åœ¨ <code>proxy_pass</code> ä¸‹é¢æ˜¯å¿…é¡»çš„ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_set_header</span> HOST <span class="variable">$http_host</span>;</span><br><span class="line"><span class="attribute">add_header</span> Cache-Control <span class="string">'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0'</span>;</span><br></pre></td></tr></table></figure><p>æ­¤å¤–æ„Ÿè°¢å¥½å¿ƒè¯»è€…çš„æé†’æ‰å‘ç°è¿™ä¸ª bug ğŸ˜˜</p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200307102856702.png" alt="image-20200307102856702"></p><h3 id="3-å¯åŠ¨"><a href="#3-å¯åŠ¨" class="headerlink" title="3.å¯åŠ¨"></a>3.å¯åŠ¨</h3><p>æ‰‹åŠ¨è¿è¡Œèµ·æ¥å¾ˆç®€å•ï¼Œ<code>./webp-server -config /path/to/config.json</code> ï¼Œå¦‚æœè¯¥æœåŠ¡æŒ‚æ‰äº†èµ„æºå°± gg äº†ï¼Œæ‰€ä»¥è¿˜æ˜¯é€‰ç”¨ä¸€ç§ç¨³å®šæŒä¹…åŒ–çš„è¿è¡Œæ–¹å¼ã€‚å’±æ¨èä½¿ç”¨ systemd æ¥å¯åŠ¨ï¼Œè¿™æ · webp server æœåŠ¡æŒ‚æ‰äº†ä¹Ÿä¼šè‡ªåŠ¨æ‹‰èµ·é‡å¯ä¸€ä¸‹ã€‚é¦–å…ˆè¦åˆ›å»ºæˆ–ä¿®æ”¹ä¸€ä¸‹ <code>webps.service</code> é…ç½®æ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=WebP Server</span><br><span class="line">Documentation=https://github.com/webp-sh/webp_server_go</span><br><span class="line">After=nginx.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">StandardError=journal</span><br><span class="line">AmbientCapabilities=CAP_NET_BIND_SERVICE</span><br><span class="line">WorkingDirectory=/opt/webps</span><br><span class="line">ExecStart=/opt/webps/webp-server --config /opt/webps/config.json</span><br><span class="line">ExecReload=/bin/<span class="built_in">kill</span> -HUP <span class="variable">$MAINPID</span></span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=3s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸€ä¸‹ <code>ExecStart=/opt/webps/webp-server --config /opt/webps/config.json</code> å’Œ <code>WorkingDirectory=/opt/webps</code> å¯¹åº”çš„è·¯å¾„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp webps.service /lib/systemd/system/</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> webps.service</span><br><span class="line">systemctl start webps.service</span><br></pre></td></tr></table></figure><h3 id="4-é¢„åŠ è½½"><a href="#4-é¢„åŠ è½½" class="headerlink" title="4.é¢„åŠ è½½"></a>4.é¢„åŠ è½½</h3><p>webp-server-go æœ‰ä¸ªé¢„åŠ è½½çš„åŠŸèƒ½ï¼Œå°±æ˜¯æå‰å°†å…¨éƒ¨çš„å›¾ç‰‡èµ„æºè¿›è¡Œä¸€æ¬¡è½¬æ¢ï¼Œè¿™æ ·å†æ¬¡è®¿é—®å›¾ç‰‡èµ„æºçš„æ—¶å€™å°±ä¸å¿…å†è¿›è¡Œè½¬æ¢ï¼Œè€Œç›´æ¥ä½¿ç”¨å·²ç»è½¬æ¢åçš„ webp æ–‡ä»¶å³å¯ã€‚è¿™ç›¸å½“äºä¸€æ¬¡ â€œç¼“å­˜â€ ã€‚</p><p>ä½¿ç”¨ <code>./webp-server -jobs 1 -config config.json -prefetch</code> æ¥è¿›è¡Œä¸€æ¬¡é¢„åŠ è½½ï¼Œå…¶ä¸­ jobs åé¢çš„æ•°å­—ä¸ºä½  CPU çš„æ ¸å¿ƒæ•°ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨åŠ é»˜è®¤ä½¿ç”¨å…¨éƒ¨æ ¸å¿ƒã€‚</p><h2 id="benchmark"><a href="#benchmark" class="headerlink" title="benchmark"></a>benchmark</h2><p>è¯´åˆ°æ€§èƒ½ï¼Œå’±å¿…é¡»å¾—è¿›è¡Œä¸€æ¬¡å‹æµ‹æ‰èƒ½æ”¾å¿ƒå¤§èƒ†åœ°æ¨èå„ä½é£Ÿç”¨ webp server go å•¦ï¼Œä¸‹é¢å¾—å°±æ˜¯å’±çš„æµ‹è¯•æ•°æ®æ ·ä¾‹ã€‚å›¾ç‰‡çš„æµ‹è¯•æ ·æœ¬æ˜¯å’±ä½¿ç”¨ <a href="https://github.com/Tsuk1ko/pxder" target="_blank" rel="noopener">pxder</a> çˆ¬ä¸‹æ¥çš„ï¼Œæ€»å…± 10600 å¼ å›¾ç‰‡ï¼Œæ€»å¤§å° 11.1 GBã€‚å¦‚æœä½ ä¹Ÿéœ€è¦è¿™äº›æµ‹è¯•æ ·æœ¬çš„è¯å¯ä»¥ç§èŠå’±å‘ç»™ä½ ã€‚ä¸‹é¢å°±æ˜¯çœŸå®çš„æµ‹è¯•æ•°æ®ã€‚æµ‹è¯•ç¯å¢ƒæ˜¯ 8 core Ã—3.4G Hzï¼Œæµ‹è¯•ç‰ˆæœ¬ä¸º <a href="https://github.com/webp-sh/webp_server_go/releases/tag/0.1.0" target="_blank" rel="noopener">v0.1.0</a> ï¼Œä½¿ç”¨çš„æ˜¯é»˜è®¤å‚æ•°é…ç½®ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"HOST"</span>: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">  <span class="attr">"PORT"</span>: <span class="string">"3333"</span>,</span><br><span class="line">  <span class="attr">"QUALITY"</span>: <span class="string">"80"</span>,</span><br><span class="line">  <span class="attr">"IMG_PATH"</span>: <span class="string">"./src"</span>,</span><br><span class="line">  <span class="attr">"EXHAUST_PATH"</span>: <span class="string">"./dist"</span>,</span><br><span class="line">  <span class="attr">"ALLOWED_TYPES"</span>: [<span class="string">"jpg"</span>,<span class="string">"png"</span>,<span class="string">"jpeg"</span>,<span class="string">"bmp"</span>,<span class="string">"gif"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200304191400500.png" alt="image-20200304191400500"></p><h3 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h3><table><thead><tr><th align="center">file_size_range</th><th align="center">file_num</th><th align="center">src_size</th><th align="center">dist_size</th><th align="center">total</th><th align="center">user</th><th align="center">system</th><th align="center">cpu</th><th align="center">core</th></tr></thead><tbody><tr><td align="center">(10KB,500KB)</td><td align="center">4600</td><td align="center">1.3G</td><td align="center">310M</td><td align="center">1:44.49</td><td align="center">905.41s</td><td align="center">9.55s</td><td align="center">875%</td><td align="center">8</td></tr><tr><td align="center">(500KB,1MB)</td><td align="center">3500</td><td align="center">2.4G</td><td align="center">361M</td><td align="center">2:04.81</td><td align="center">1092.50s</td><td align="center">7.98s</td><td align="center">881%</td><td align="center">8</td></tr><tr><td align="center">(1MB,4MB)</td><td align="center">2000</td><td align="center">3.8G</td><td align="center">342M</td><td align="center">2:32.64</td><td align="center">1345.73s</td><td align="center">10.84s</td><td align="center">888%</td><td align="center">8</td></tr><tr><td align="center">(4MB,32MB)</td><td align="center">500</td><td align="center">3.6G</td><td align="center">246M</td><td align="center">1:44.53</td><td align="center">916.91s</td><td align="center">12.03s</td><td align="center">888%</td><td align="center">8</td></tr></tbody></table><h4 id="ä¸åŒæ ¸å¿ƒ-total-å¯¹æ¯”"><a href="#ä¸åŒæ ¸å¿ƒ-total-å¯¹æ¯”" class="headerlink" title="ä¸åŒæ ¸å¿ƒ total å¯¹æ¯”"></a>ä¸åŒæ ¸å¿ƒ total å¯¹æ¯”</h4><table><thead><tr><th align="center">file_size_range</th><th align="center">file_num</th><th align="center">src_size</th><th align="center">dist_size</th><th align="center">8</th><th align="center">4</th><th align="center">2</th><th align="center">1</th></tr></thead><tbody><tr><td align="center">(10KB,500KB)</td><td align="center">4600</td><td align="center">1.3G</td><td align="center">310M</td><td align="center">1:44.49</td><td align="center">2:18.49</td><td align="center">3:36.05</td><td align="center">5:20.88</td></tr><tr><td align="center">(500KB,1MB)</td><td align="center">3500</td><td align="center">2.4G</td><td align="center">361M</td><td align="center">2:04.81</td><td align="center">2:49.46</td><td align="center">4:16.41</td><td align="center">6:28.97</td></tr><tr><td align="center">(1MB,4MB)</td><td align="center">2000</td><td align="center">3.8G</td><td align="center">342M</td><td align="center">2:32.64</td><td align="center">3:26.18</td><td align="center">5:22.15</td><td align="center">7:53.45</td></tr><tr><td align="center">(4MB,32MB)</td><td align="center">500</td><td align="center">3.6G</td><td align="center">246M</td><td align="center">1:44.53</td><td align="center">2:21.22</td><td align="center">3:39.16</td><td align="center">5:28.65</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 10KB-500KB</span></span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 1 -config config.json -prefetch  632.77s user 11.23s system 200% cpu 5:20.88 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 2 -config config.json -prefetch  639.31s user 8.77s system 299% cpu 3:36.05 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 4 -config config.json -prefetch  676.17s user 8.12s system 494% cpu 2:18.49 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 8 -config config.json -prefetch  905.41s user 9.55s system 875% cpu 1:44.49 total</span><br><span class="line"></span><br><span class="line"><span class="comment">### 500KB-1MB</span></span><br><span class="line"></span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 1 -config config.json -prefetch  767.45s user 10.14s system 199% cpu 6:28.97 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 2 -config config.json -prefetch  778.00s user 8.62s system 295% cpu 4:16.41 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 4 -config config.json -prefetch  831.38s user 7.62s system 495% cpu 2:49.46 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 8 -config config.json -prefetch  1092.50s user 7.98s system 881% cpu 2:04.81 total</span><br><span class="line"></span><br><span class="line"><span class="comment">### 1MB-4MB</span></span><br><span class="line"></span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 1 -config config.json -prefetch  934.22s user 12.45s system 199% cpu 7:53.45 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 2 -config config.json -prefetch  958.41s user 9.41s system 300% cpu 5:22.15 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 4 -config config.json -prefetch  1010.56s user 8.05s system 494% cpu 3:26.18 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 8 -config config.json -prefetch  1345.73s user 10.84s system 888% cpu 2:32.64 total</span><br><span class="line"></span><br><span class="line"><span class="comment">### 4MB-32MB</span></span><br><span class="line"></span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 1 -config config.json -prefetch  641.78s user 10.77s system 187% cpu 5:28.65 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 2 -config config.json -prefetch  643.19s user 9.73s system 297% cpu 3:39.16 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 4 -config config.json -prefetch  688.05s user 9.91s system 494% cpu 2:21.22 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 8 -config config.json -prefetch  916.91s user 12.03s system 888% cpu 1:44.53 total</span><br></pre></td></tr></table></figure><h3 id="è½¬æ¢å‰åå¤§å°å¯¹æ¯”"><a href="#è½¬æ¢å‰åå¤§å°å¯¹æ¯”" class="headerlink" title="è½¬æ¢å‰åå¤§å°å¯¹æ¯”"></a>è½¬æ¢å‰åå¤§å°å¯¹æ¯”</h3><p>ä»¥ä¸‹å’±å°±æˆªå–ä¸€å°éƒ¨åˆ†çš„æµ‹è¯•ç»“æœï¼Œå®Œæ•´çš„æ—¥å¿—æ”¾åœ¨äº†æˆ‘çš„ gist ä¸Š <strong><a href="https://gist.github.com/muzi502/4f7c4128895ac3f438e7a183df219661" target="_blank" rel="noopener">webp-server-go_test.log</a></strong> ã€‚å›¾ç‰‡éƒ½æ˜¯çœŸæ˜¯çš„æ•°æ®ï¼Œæ ¹æ®æ–‡ä»¶åçš„ ID å¯ä»¥åœ¨ pixiv.net ä¸Šæ‰¾åˆ°æºæ–‡ä»¶ï¼Œç›¸ä¿¡è€å¸æœºä»¬éƒ½æ‡‚å¾—ğŸ˜‚ã€‚</p><h4 id="10KB-500KB"><a href="#10KB-500KB" class="headerlink" title="(10KB,500KB)"></a>(10KB,500KB)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">./webp-server -<span class="built_in">jobs</span> 8 -config config.json -prefetch</span><br><span class="line">905.41s user 9.55s system 875% cpu 1:44.49 total</span><br><span class="line"></span><br><span class="line">src    distnum</span><br><span class="line">1.3G310M4600</span><br><span class="line">63304866.png495K40K</span><br><span class="line">40881097.jpg495K118K</span><br><span class="line">21045662.jpg495K94K</span><br><span class="line">67888534.png495K73K</span><br><span class="line">50136421.jpg495K62K</span><br><span class="line">72636668.png495K113K</span><br><span class="line">55156014.jpg495K78K</span><br><span class="line">76671894.png495K59K</span><br><span class="line">64709121.png495K67K</span><br><span class="line">78336881.jpg495K77K</span><br><span class="line">57090512.png494K35K</span><br><span class="line">72153105.jpg494K64K</span><br><span class="line">62457185.png494K39K</span><br><span class="line">44892218.png494K96K</span><br><span class="line">39599640.jpg494K39K</span><br><span class="line">21428544.jpg493K76K</span><br><span class="line">65293876.jpg493K68K</span><br><span class="line">76098632.png493K80K</span><br><span class="line">65418239.jpg493K119K</span><br><span class="line">17900553.jpg493K51K</span><br><span class="line">61511853.jpg493K123K</span><br><span class="line">77984504.png493K56K</span><br><span class="line">54667116.jpg493K56K</span><br><span class="line">75357235.jpg493K67K</span><br><span class="line">21085426.jpg492K55K</span><br></pre></td></tr></table></figure><h4 id="500KB-1MB"><a href="#500KB-1MB" class="headerlink" title="(500KB,1MB)"></a>(500KB,1MB)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">./webp-server -<span class="built_in">jobs</span> 8 -config config.json -prefetch</span><br><span class="line">1092.50s user 7.98s system 881% cpu 2:04.81 total</span><br><span class="line"></span><br><span class="line">srcdistnum</span><br><span class="line">2.4G361M3500</span><br><span class="line"></span><br><span class="line">44937735.png974K74K</span><br><span class="line">56343106.png974K49K</span><br><span class="line">51320479.png974K73K</span><br><span class="line">68346957.jpg974K112K</span><br><span class="line">74882964.png974K150K</span><br><span class="line">76640395.jpg974K75K</span><br><span class="line">62034004.jpg974K110K</span><br><span class="line">59897148.jpg974K147K</span><br><span class="line">46287856.jpg973K68K</span><br><span class="line">54674488.jpg973K111K</span><br><span class="line">42265521.png973K51K</span><br><span class="line">40261146.jpg973K135K</span><br><span class="line">76815098.png973K77K</span><br><span class="line">57095484.png973K99K</span><br><span class="line">65354070.jpg973K206K</span><br><span class="line">24130390.jpg973K121K</span><br><span class="line">73753170.jpg972K106K</span><br><span class="line">64066680.jpg972K92K</span><br><span class="line">72175991.png972K49K</span><br><span class="line">53402985.png972K114K</span><br><span class="line">70710923.png971K63K</span><br><span class="line">76242996.png971K63K</span><br><span class="line">65736419.jpg971K728K</span><br><span class="line">70095856.png971K91K</span><br><span class="line">64284761.png971K53K</span><br><span class="line">73907152.jpg971K101K</span><br><span class="line">62120962.png970K85K</span><br><span class="line">22003560.png970K76K</span><br><span class="line">77293789.jpg970K116K</span><br><span class="line">68647243.png970K46K</span><br><span class="line">54618347.png970K59K</span><br><span class="line">79602155.jpg969K120K</span><br><span class="line">55491641.jpg968K119K</span><br><span class="line">53473372.png968K45K</span><br><span class="line">77569729.jpg968K69K</span><br><span class="line">57420240.png968K61K</span><br><span class="line">69798500.png968K74K</span><br><span class="line">63487148.png968K47K</span><br><span class="line">79687107.jpg967K164K</span><br><span class="line">70081772.jpg966K129K</span><br><span class="line">79623240.jpg966K133K</span><br><span class="line">72535236.jpg966K160K</span><br><span class="line">47680545.png966K162K</span><br></pre></td></tr></table></figure><h4 id="1MB-4MB"><a href="#1MB-4MB" class="headerlink" title="(1MB,4MB)"></a>(1MB,4MB)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">./webp-server -<span class="built_in">jobs</span> 8 -config config.json -prefetch</span><br><span class="line">1345.73s user 10.84s system 888% cpu 2:32.64 total</span><br><span class="line"></span><br><span class="line">src  distnum</span><br><span class="line">3.8G342M2000</span><br><span class="line"></span><br><span class="line">73839511.png4.1M293K</span><br><span class="line">73839511.png4.1M293K</span><br><span class="line">66504933.png4.1M107K</span><br><span class="line">78316050.png4.1M319K</span><br><span class="line">74264931.png4.1M330K</span><br><span class="line">74412671.png4.1M186K</span><br><span class="line">77414892.png4.1M227K</span><br><span class="line">76442741.png4.0M191K</span><br><span class="line">71330750.png4.0M199K</span><br><span class="line">78361206.png4.0M153K</span><br><span class="line">68763693.png4.0M233K</span><br><span class="line">67222487.png4.0M368K</span><br><span class="line">68560466.png4.0M186K</span><br><span class="line">72437850.png4.0M282K</span><br><span class="line">67767752.png4.0M203K</span><br><span class="line">73597995.png4.0M432K</span><br><span class="line">71506633.png4.0M88K</span><br><span class="line">77601042.png4.0M726K</span><br><span class="line">77033762.png4.0M261K</span><br><span class="line">73436647.jpg4.0M514K</span><br><span class="line">78099751.png4.0M283K</span><br><span class="line">73165937.png4.0M202K</span><br><span class="line">74379006.png4.0M300K</span><br><span class="line">79274246.png4.0M191K</span><br><span class="line">69701132.png4.0M129K</span><br><span class="line">67455430.jpg3.9M397K</span><br><span class="line">73651880.png3.9M183K</span><br><span class="line">79152655.png3.9M298K</span><br><span class="line">73117385.png3.9M258K</span><br><span class="line">70281950.png3.9M314K</span><br><span class="line">68501346.png3.9M203K</span><br><span class="line">78895125.png3.9M310K</span><br><span class="line">70159814.png3.9M156K</span><br><span class="line">70764048.jpg3.9M437K</span><br></pre></td></tr></table></figure><h4 id="4MB-32MB"><a href="#4MB-32MB" class="headerlink" title="(4MB,32MB)"></a>(4MB,32MB)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">./webp-server -<span class="built_in">jobs</span> 8 -config config.json -prefetch</span><br><span class="line">916.91s user 12.03s system 888% cpu 1:44.53 total</span><br><span class="line"></span><br><span class="line">srcdistnum</span><br><span class="line">3.8G3.8G500</span><br><span class="line"></span><br><span class="line">78467499.png32M2.8M</span><br><span class="line">79620324.png32M</span><br><span class="line">74975502.png32M3.0M</span><br><span class="line">74902740.png31M2.6M</span><br><span class="line">77032574.png31M2.5M</span><br><span class="line">77673519.png30M2.3M</span><br><span class="line">77298781.png29M1.4M</span><br><span class="line">77959551.png27M1.5M</span><br><span class="line">69987155.png26M649K</span><br><span class="line">74432253.png25M1.6M</span><br><span class="line">78994948.png25M923K</span><br><span class="line">77218195.png24M1.6M</span><br><span class="line">72379562.png22M251K</span><br><span class="line">77559996.png22M1.9M</span><br><span class="line">71522636.png22M1.3M</span><br><span class="line">78236671.png21M1.7M</span><br><span class="line">78033540.jpg20M2.7M</span><br><span class="line">70906047.png19M677K</span><br><span class="line">72498744.png19M882K</span><br><span class="line">73977640.png19M523K</span><br><span class="line">78757823.png18M1.5M</span><br><span class="line">71588979.png18M1.2M</span><br><span class="line">75747535.png17M1.2M</span><br><span class="line">71504158.png17M1.2M</span><br><span class="line">76969768.png17M1.4M</span><br><span class="line">77995994.png17M568K</span><br><span class="line">75340699.png17M1.4M</span><br><span class="line">69821163.png16M1.1M</span><br><span class="line">70050613.png16M1.1M</span><br><span class="line">76559411.png15M1.7M</span><br><span class="line">76576885.png15M853K</span><br><span class="line">75640746.png15M1.4M</span><br><span class="line">78188732.png15M1.4M</span><br><span class="line">73355141.png15M589K</span><br><span class="line">75977096.png15M1.4M</span><br><span class="line">72840608.jpg15M1.8M</span><br><span class="line">75665779.png14M1.5M</span><br><span class="line">77898275.png14M1.2M</span><br><span class="line">79663534.png13M1.2M</span><br><span class="line">76539246.png13M1.2M</span><br><span class="line">70598104.png13M840K</span><br><span class="line">78348611.jpg13M2.7M</span><br></pre></td></tr></table></figure><h2 id="å®é™…æ•ˆæœ"><a href="#å®é™…æ•ˆæœ" class="headerlink" title="å®é™…æ•ˆæœ"></a>å®é™…æ•ˆæœ</h2><p>ä¸ºäº†åšä¸ªå¯¹æ¯”ï¼Œå’±ä½¿ç”¨  <code>hexo.502.li</code> è¿™ä¸ªåŸŸåä¸ºå¯¹ç…§ç»„ï¼Œå³è¾“å‡ºæºæ–‡ä»¶ï¼Œä½¿ç”¨ <code>blog.502.li</code> è¿™ä¸ªåŸŸåä¸ºå®éªŒç»„åŠ ä¸Š webp server æ¥æµ‹è¯•ï¼Œå„ä½è¯»è€…ä¹Ÿå¯ä»¥åˆ†åˆ«è®¿é—®è¿™ä¸¤ä¸ªåŸŸåæ¥å®é™…ä½“éªŒä¹‹é—´çš„å·®åˆ«ï¼Œè‚‰çœ¼å¯è§ğŸ˜‚ã€‚</p><h3 id="no-webps"><a href="#no-webps" class="headerlink" title="no webps"></a>no webps</h3><p>ä¼˜åŒ–å»ºè®®èƒ½èŠ‚çœ 138s ï¼Œä¹‹å‰ä¹Ÿæœ‰è¯»è€…æ™®éåæ˜ å›¾ç‰‡æ‰“å¼€ææ…¢</p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/no-webp.png" alt="nowebps"></p><h3 id="webps-yes"><a href="#webps-yes" class="headerlink" title="webps yes!"></a>webps yes!</h3><p>ä¼˜åŒ–å»ºè®®èƒ½èŠ‚çœ 19s ï¼Œæ¯”ä¸é€‚ç”¨ webp æ•´æ•´å‡å°‘äº†å°†è¿‘ 2 minğŸ˜‚ï¼Œçœ‹æ¥æ•ˆæœåŠå…¶æ˜æ˜¾å‘€ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/with-webp.png" alt="weith"></p><p>é€‰æ‹©ä¸¤ç¯‡å›¾ç‰‡æ¯”è¾ƒå¤šçš„åšå®¢ï¼Œæµ‹è¯•é“¾æ¥ä¸º ï¼š</p><ul><li><code>https://blog.k8s.li/2020-Lunar-New-Year.html</code></li><li><code>https://blog.k8s.li/wd-hc310-dc-hdd.html</code></li><li><code>https://hexo.502.li/2020-Lunar-New-Year.html</code></li><li><code>https://hexo.502.li/wd-hc310-dc-hdd.html</code></li></ul><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ul><li><a href="https://nova.moe/re-introduce-webp-server/" target="_blank" rel="noopener">è®©ç«™ç‚¹å›¾ç‰‡åŠ è½½é€Ÿåº¦æ›´å¿«â€”â€”å¼•å…¥ WebP Server æ— ç¼è½¬æ¢å›¾ç‰‡ä¸º WebP</a></li><li><a href="https://await.moe/2020/02/note-about-encountered-memory-changes-for-no-reason-in-golang/" target="_blank" rel="noopener">è®° Golang ä¸‹é‡åˆ°çš„ä¸€å›ã€Œæ¯«æ— ç”±å¤´ã€çš„å†…å­˜æ›´æ”¹</a></li><li><a href="https://await.moe/2020/02/webp-server-in-rust/" target="_blank" rel="noopener">WebP Server in Rust</a></li><li><a href="https://www.bennythink.com/flying-webp.html" target="_blank" rel="noopener">ä¸ªäººç½‘ç«™æ— ç¼åˆ‡æ¢å›¾ç‰‡åˆ° webp</a></li><li><a href="https://halo.run/archives/halo-and-webp" target="_blank" rel="noopener">ä¼˜é›…çš„è®© Halo æ”¯æŒ webp å›¾ç‰‡è¾“å‡º</a></li><li><a href="https://vince.xin/2018/09/12/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E2%80%94%E2%80%94%E4%BD%BF%E7%94%A8webp%E6%9D%A5%E4%BC%98%E5%8C%96%E4%BD%A0%E7%9A%84%E5%9B%BE%E7%89%87/" target="_blank" rel="noopener">å‰ç«¯æ€§èƒ½ä¼˜åŒ–â€”â€”ä½¿ç”¨webpæ¥ä¼˜åŒ–ä½ çš„å›¾ç‰‡xx</a></li><li><a href="https://aotu.io/notes/2016/06/23/explore-something-of-webp/index.html" target="_blank" rel="noopener">æ¢ç©¶WebPä¸€äº›äº‹å„¿</a></li><li><a href="https://developers.google.com/speed/webp" target="_blank" rel="noopener">A new image format for the Web</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;blockquote&gt;
&lt;p&gt;å’±æ¥æ¨é”€ webp
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="åšå®¢" scheme="https://blog.k8s.li/tags/%E5%8D%9A%E5%AE%A2/"/>
    
  </entry>
  
  <entry>
    <title>Linux ç½‘ç»œå’Œ iptables è¿è¡ŒåŸç†</title>
    <link href="https://blog.k8s.li/linux-net-and-iptables.html"/>
    <id>https://blog.k8s.li/linux-net-and-iptables.html</id>
    <published>2020-03-01T16:00:00.000Z</published>
    <updated>2020-03-01T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å‚åŠ äº†ä¸€åœºè§†é¢‘ä¼šè®®é¢è¯•ï¼Œè™½ç„¶ç»“æœå¯èƒ½ä¸å¤ªç†æƒ³ï¼Œä½†è¿˜æ˜¯å‘ç°è‡ªå·±å¯¹æŠ€æœ¯ç»†èŠ‚é’»ç ”çš„ä¸å¤Ÿæ·±ï¼Œä¸€äº›å¾ˆåŸºç¡€æ€§çš„çŸ¥è¯†ç‚¹å¹¶æ²¡æœ‰å½¢æˆä¸€ä¸ªç³»ç»Ÿæ€§çš„çŸ¥è¯†æ¶æ„ã€‚æ¯”å¦‚ TCP å’Œ UDP çš„åŒºåˆ«ï¼Œè¿™æ˜¯å†ç®€å•ä¸è¿‡çš„é—®é¢˜ã€‚è™½ç„¶å¹³æ—¶éƒ½çŸ¥é“ TCP åº”ç”¨äºå“ªäº›åœºæ™¯ï¼ŒUDP åº”ç”¨ä¸å“ªäº›åœºæ™¯ï¼Œä½†äºŒè€…ä¹‹é—´çš„ç»†èŠ‚ï¼Œè¿˜æ˜¯æ²¡èƒ½ä»”ç»†åœ°æ·±å…¥ç ”ç©¶ã€‚æ‰€ä»¥ä»ç°åœ¨å¼€å§‹ä»æ–°å­¦ä¹ ä¸€ä¸‹ä¸€äº›åŸºç¡€æ€§çš„ä¸œè¥¿ï¼Œè¡¥è¶³ä¸€ä¸‹æ¬ ä¸‹çš„çŸ¥è¯†ğŸ˜¥ã€‚ä¸è¿‡è¿™æ¬¡é¢è¯•ä¹Ÿè®©æˆ‘æ„è¯†åˆ°ï¼Œæˆ‘æ˜¯è¯¥ç¦»å¼€è¿™ä¸ªå®‰é€¸çš„ç¯å¢ƒäº†ï¼Œå†è¿‡å‡ å¹´å°±è¦ä¸‰åè€Œç«‹äº†ï¼Œè€Œè¿™å‡ å¹´ä¹Ÿæ­£æ˜¯æŠ€æœ¯ç§¯ç´¯æ²‰æ·€çš„é»„é‡‘æ—¶ä»£ï¼Œå¸Œæœ›çæƒœè¿™æ®µæ—¶å…‰è¸è¸å®å®ç ”ç©¶æŠ€æœ¯ã€‚</p><h2 id="Linux-åè®®æ ˆ"><a href="#Linux-åè®®æ ˆ" class="headerlink" title="Linux åè®®æ ˆ"></a>Linux åè®®æ ˆ</h2><p>åœ¨è®²è§£ iptables ä¹‹å‰è¦å›é¡¾ä¸€ä¸‹ Linux æ¥æ”¶æ•°æ®åŒ…å’Œå‘é€æ•°æ®åŒ…çš„æµç¨‹ï¼Œæ‰èƒ½ç†è§£ iptables åœ¨ Linux ç½‘ç»œåè®®æ ˆä¸­çš„ä½ç½®å’Œä½œç”¨ã€‚å»å¹´çš„æ—¶å€™å¬äº† Go å¤œè¯»çš„  <a href="https://github.com/developer-learning/night-reading-go/issues/506" target="_blank" rel="noopener">ã€Go å¤œè¯»ã€‘ ç½‘ç»œçŸ¥è¯†åå…¨å¤§è¡¥ä¸¸</a> ï¼Œæ¨èå»çœ‹ä¸€ä¸‹<a href="https://www.youtube.com/watch?v=30wCahZEjNg" target="_blank" rel="noopener">YouTubeã€Go å¤œè¯»ã€‘#68 ç½‘ç»œçŸ¥è¯†åå…¨å¤§è¡¥ä¸¸</a>ã€‚</p><blockquote><p>åç«¯å·¥ç¨‹å¸ˆåœ¨å·¥ä½œä¸­ç»å¸¸ä¼šé‡åˆ°è®¡ç®—æœºç½‘ç»œæ–¹é¢çš„é—®é¢˜ï¼Œç½‘ç»œå¯¹å¤šæ•°äººæ¥è¯´è¿˜æ˜¯ä¸€ä¸ªé»‘ç›’å­ï¼Œæœ¬æ¬¡æŠ€æœ¯åˆ†äº«ä»å¸¸è§çš„ç½‘ç»œç¡¬ä»¶ã€ä¼ä¸šå’Œæ•°æ®ä¸­å¿ƒçš„ç½‘ç»œæ‹“æ‰‘ã€Linuxåè®®æ ˆå’Œé˜²ç«å¢™ç­‰åŸºç¡€ç½‘ç»œçŸ¥è¯†å¼€å§‹ä»‹ç»ï¼Œä¸€ç›´è®²åˆ°TCPå’ŒHTTPè¿™äº›å¹´çš„æŠ€æœ¯æ¼”è¿›è·¯çº¿å’Œæœªæ¥è¶‹åŠ¿ã€‚</p></blockquote><h3 id="æ”¶åŒ…æµç¨‹"><a href="#æ”¶åŒ…æµç¨‹" class="headerlink" title="æ”¶åŒ…æµç¨‹"></a>æ”¶åŒ…æµç¨‹</h3><h4 id="1-æ•°æ®åŒ…åˆ°è¾¾ç½‘å¡-NIC-Network-Interface-Card"><a href="#1-æ•°æ®åŒ…åˆ°è¾¾ç½‘å¡-NIC-Network-Interface-Card" class="headerlink" title="1. æ•°æ®åŒ…åˆ°è¾¾ç½‘å¡ NIC(Network Interface Card)"></a>1. æ•°æ®åŒ…åˆ°è¾¾ç½‘å¡ NIC(Network Interface Card)</h4><h4 id="2-NIC-æ£€éªŒ-MAC-ç½‘å¡-ç½‘å¡éæ··æ‚æ¨¡å¼-å’Œå¸§çš„æ ¡éªŒå­—æ®µ-FCS"><a href="#2-NIC-æ£€éªŒ-MAC-ç½‘å¡-ç½‘å¡éæ··æ‚æ¨¡å¼-å’Œå¸§çš„æ ¡éªŒå­—æ®µ-FCS" class="headerlink" title="2. NIC æ£€éªŒ MAC ç½‘å¡(ç½‘å¡éæ··æ‚æ¨¡å¼)å’Œå¸§çš„æ ¡éªŒå­—æ®µ FCS"></a>2. NIC æ£€éªŒ MAC ç½‘å¡(ç½‘å¡éæ··æ‚æ¨¡å¼)å’Œå¸§çš„æ ¡éªŒå­—æ®µ FCS</h4><p>NIC ä¼šæ ¡éªŒæ”¶åˆ°æ•°æ®åŒ…çš„ç›®çš„ MAC åœ°å€æ˜¯ä¸æ˜¯è‡ªå·±çš„ MAC åœ°å€ï¼Œåœ¨ç½‘å¡éæ··æ‚æ¨¡å¼ä¸‹ï¼ŒMAC åœ°å€ä¸æ˜¯è‡ªå·±çš„æ•°æ®åŒ…é€šå¸¸å°±ä¼šä¸¢å¼ƒã€‚åœ¨å¼€å¯æ··æ‚æ¨¡å¼ä¹‹åæ‰€æœ‰æ•°æ®åŒ…éƒ½ä¼šæ˜¯æ¥æ”¶å¤„ç†ã€‚</p><p>ä½¿ç”¨éæ··æ‚æ¨¡å¼çš„åœºæ™¯ï¼š</p><ul><li>æŠ“åŒ…</li><li>è™šæ‹Ÿæœº</li><li>æŠ“åŒ…ç¨‹åºä¼šæŠŠç½‘å¡è®¾ç½®ä¸ºéæ··æ‚æ¨¡å¼ï¼Œå› æ­¤æŠ“åŒ…ç¨‹åºéœ€è¦  root æƒé™ï¼Œæ²¡æœ‰ root æƒé™æ— æ³•ä¿®æ”¹ç¡¬ä»¶è®¾å¤‡çš„é…ç½®ã€‚</li></ul><p>æ ¡éªŒå®Œ MAC åœ°å€ä¹‹å NIC è¿˜ä¼šæ ¡éªŒå¸§çš„æ ¡éªŒå­—æ®µ FCSï¼Œä¸€æ¬¡æ¥ç¡®ä¿æ¥æ”¶åˆ°çš„æ•°æ®åŒ…æ˜¯æ­£ç¡®çš„ï¼Œå¦‚æœæ ¡éªŒå¤±è´¥å°±ç›´æ¥ä¸¢å¼ƒæ•°æ®åŒ…</p><h4 id="3-NIC-é€šè¿‡-DMA-å°†æ•°æ®åŒ…æ”¾å…¥æå‰æ˜ å°„å¥½çš„å†…å­˜åŒºåŸŸ"><a href="#3-NIC-é€šè¿‡-DMA-å°†æ•°æ®åŒ…æ”¾å…¥æå‰æ˜ å°„å¥½çš„å†…å­˜åŒºåŸŸ" class="headerlink" title="3. NIC é€šè¿‡ DMA å°†æ•°æ®åŒ…æ”¾å…¥æå‰æ˜ å°„å¥½çš„å†…å­˜åŒºåŸŸ"></a>3. NIC é€šè¿‡ DMA å°†æ•°æ®åŒ…æ”¾å…¥æå‰æ˜ å°„å¥½çš„å†…å­˜åŒºåŸŸ</h4><p>DMAï¼šè‹±æ–‡æ‹¼å†™æ˜¯ â€œDirect Memory Accessâ€ ï¼Œç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯ç›´æ¥å†…å­˜è®¿é—®ã€‚DMA å…è®¸ç½‘ç»œè®¾å¤‡å°†æ•°æ®åŒ…æ•°æ®ç›´æ¥ç§»åŠ¨åˆ°ç³»ç»Ÿå†…å­˜ä¸­, ä»è€Œé™ä½ CPU åˆ©ç”¨ç‡ã€‚</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªç½‘ç»œæ•°æ®åŒ…ä»ç½‘å¡åˆ°åº”ç”¨ç¨‹åºéœ€è¦ç»è¿‡å¦‚ä¸‹çš„è¿‡ç¨‹ï¼šæ•°æ®ä»ç½‘å¡é€šè¿‡ DMA ç­‰æ–¹å¼ä¼ åˆ°å†…æ ¸å¼€è¾Ÿçš„ç¼“å†²åŒºï¼Œç„¶åä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·æ€ç©ºé—´ï¼Œåœ¨ Linux å†…æ ¸åè®®æ ˆä¸­ï¼Œè¿™ä¸ªè€—æ—¶æ“ä½œç”šè‡³å åˆ°äº†æ•°æ®åŒ…æ•´ä¸ªå¤„ç†æµç¨‹çš„ 57.1%ã€‚</p><h4 id="4-NIC-å°†æ•°æ®åŒ…çš„å¼•ç”¨æ”¾å…¥æ¥æ”¶çš„-ring-buffer-ï¼ˆç¯å½¢ç¼“å†²åŒºï¼‰é˜Ÿåˆ—-rx-ä¸­"><a href="#4-NIC-å°†æ•°æ®åŒ…çš„å¼•ç”¨æ”¾å…¥æ¥æ”¶çš„-ring-buffer-ï¼ˆç¯å½¢ç¼“å†²åŒºï¼‰é˜Ÿåˆ—-rx-ä¸­" class="headerlink" title="4. NIC å°†æ•°æ®åŒ…çš„å¼•ç”¨æ”¾å…¥æ¥æ”¶çš„ ring buffer ï¼ˆç¯å½¢ç¼“å†²åŒºï¼‰é˜Ÿåˆ— rx ä¸­"></a>4. NIC å°†æ•°æ®åŒ…çš„å¼•ç”¨æ”¾å…¥æ¥æ”¶çš„ ring buffer ï¼ˆç¯å½¢ç¼“å†²åŒºï¼‰é˜Ÿåˆ— rx ä¸­</h4><h4 id="5-NIC-ç­‰å¾…-rx-usecs-çš„è¶…æ—¶æ—¶é—´æˆ–è€…-rx-é˜Ÿåˆ—é•¿åº¦è¾¾åˆ°-rx-frames-åè§¦å‘ç¡¬ä»¶ä¸­æ–­-IRQï¼Œè¡¨ç¤ºæ•°æ®åŒ…æ”¶åˆ°äº†"><a href="#5-NIC-ç­‰å¾…-rx-usecs-çš„è¶…æ—¶æ—¶é—´æˆ–è€…-rx-é˜Ÿåˆ—é•¿åº¦è¾¾åˆ°-rx-frames-åè§¦å‘ç¡¬ä»¶ä¸­æ–­-IRQï¼Œè¡¨ç¤ºæ•°æ®åŒ…æ”¶åˆ°äº†" class="headerlink" title="5. NIC ç­‰å¾… rx-usecs çš„è¶…æ—¶æ—¶é—´æˆ–è€… rx é˜Ÿåˆ—é•¿åº¦è¾¾åˆ° rx-frames åè§¦å‘ç¡¬ä»¶ä¸­æ–­ IRQï¼Œè¡¨ç¤ºæ•°æ®åŒ…æ”¶åˆ°äº†"></a>5. NIC ç­‰å¾… rx-usecs çš„è¶…æ—¶æ—¶é—´æˆ–è€… rx é˜Ÿåˆ—é•¿åº¦è¾¾åˆ° rx-frames åè§¦å‘ç¡¬ä»¶ä¸­æ–­ IRQï¼Œè¡¨ç¤ºæ•°æ®åŒ…æ”¶åˆ°äº†</h4><ul><li><p>rx-usecs: ç³»ç»Ÿå†…æ ¸å‚æ•°è®¾ç½®çš„è‹¥å¹²å¾®å¦™çš„è¶…æ—¶æ—¶é—´ã€‚</p></li><li><p>rx-frames: å¯¹åº”çš„ rx é˜Ÿåˆ—é•¿åº¦ã€‚</p></li></ul><p>è°ƒæ•´äºŒè€…å‚æ•°å¤§ä¸€ç‚¹ï¼Œä¸­æ–­ä¸é¢‘ç¹ï¼Œååé‡ä¼šé«˜ä¸€äº›ï¼Œä½†å®æ—¶æ€§ä¼šå·®ä¸€äº›ã€‚äºŒè€…å‚æ•°è°ƒå°ä¸€äº›ï¼ŒNIC ä¸­æ–­é¢‘ç¹ä¸€äº›ï¼Œå®æ—¶æ€§ä¼šé«˜ä¸€äº›ï¼Œä½†ååé‡ä¼šå°ä¸€äº›ã€‚</p><h4 id="6-CPU-æ‰§è¡Œç¡¬ä»¶ä¸­æ–­å’Œç½‘å¡çš„é©±åŠ¨ç¨‹åº"><a href="#6-CPU-æ‰§è¡Œç¡¬ä»¶ä¸­æ–­å’Œç½‘å¡çš„é©±åŠ¨ç¨‹åº" class="headerlink" title="6. CPU æ‰§è¡Œç¡¬ä»¶ä¸­æ–­å’Œç½‘å¡çš„é©±åŠ¨ç¨‹åº"></a>6. CPU æ‰§è¡Œç¡¬ä»¶ä¸­æ–­å’Œç½‘å¡çš„é©±åŠ¨ç¨‹åº</h4><p>CPU æ¥æ”¶ç¡¬ä»¶ä¸­æ–­ä¿¡å·åå°±åœæ­¢æ‰‹é‡Œçš„æ´»ï¼Œä¿å­˜ä¸Šä¸‹æ–‡ï¼Œæ¥ç€å»æ‰§è¡Œç½‘å¡çš„ä¸­æ–­ç¨‹åºï¼Œç½‘å¡çš„ä¸­æ–­ç¨‹åºæ˜¯ç½‘å¡çš„é©±åŠ¨ç¨‹åºæå‰æ³¨å†Œå¥½çš„ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥ä¼šè°ƒç”¨ç½‘å¡çš„é©±åŠ¨ç¨‹åºã€‚</p><h4 id="7-é©±åŠ¨ç¨‹åºæ¸…ç†ç¡¬ä¸­æ–­å¹¶è§¦å‘è½¯ä¸­æ–­-NET-RX-SOFTIRQ"><a href="#7-é©±åŠ¨ç¨‹åºæ¸…ç†ç¡¬ä¸­æ–­å¹¶è§¦å‘è½¯ä¸­æ–­-NET-RX-SOFTIRQ" class="headerlink" title="7. é©±åŠ¨ç¨‹åºæ¸…ç†ç¡¬ä¸­æ–­å¹¶è§¦å‘è½¯ä¸­æ–­ NET_RX_SOFTIRQ"></a>7. é©±åŠ¨ç¨‹åºæ¸…ç†ç¡¬ä¸­æ–­å¹¶è§¦å‘è½¯ä¸­æ–­ NET_RX_SOFTIRQ</h4><p>åœ¨æ­¤ç¡¬ä»¶ä¸­æ–­å°±å¤„ç†å®Œäº†ã€‚åœ¨æ­¤æ¢³ç†ä¸€äº›æ•´ä¸ªä¸­æ–­å¤„ç†çš„è¿‡ç¨‹ï¼šNIC å¼•èµ·ç¡¬ä»¶ä¸­æ–­ â€“&gt; ç¡¬ä»¶ä¸­æ–­çš„ handler å°†å¼•èµ·è½¯ä»¶ä¸­æ–­ â€“&gt; é©±åŠ¨å°†å¤„ç†è¿™ä¸ªä¸­æ–­ï¼Œå®ƒå°†æŠ¥æ–‡ä»ç¯å½¢ç¼“å†²åŒºæº¢å‡ºï¼Œåœ¨å†…å­˜ä¸­åˆ†é…ä¸€ä¸ª skb â€“&gt; è°ƒç”¨ netif_rx(skb) â€“&gt; æ­¤ skb å°†æ”¾å…¥ cpu å¤„ç†æŠ¥æ–‡çš„é˜Ÿåˆ—ä¸­ã€‚å¦‚æœé˜Ÿåˆ—æ»¡äº†æ­¤åŒ…å°†ä¸¢æ‰ã€‚åˆ°è¿™ä¸ºæ­¢ä¸­æ–­å°±å¤„ç†ç»“æŸã€‚</p><ul><li><strong>linux kernel åœ¨æŠ¥æ–‡å¤„ç†ä¸Šçš„ä¸è¶³</strong></li></ul><blockquote><p>1.<strong>ä¸­æ–­å¤„ç†ï¼š</strong>å½“ç½‘ç»œä¸­å¤§é‡æ•°æ®åŒ…åˆ°æ¥æ—¶ï¼Œä¼šäº§ç”Ÿé¢‘ç¹çš„ç¡¬ä»¶ä¸­æ–­è¯·æ±‚ï¼Œè¿™äº›ç¡¬ä»¶ä¸­æ–­å¯ä»¥æ‰“æ–­ä¹‹å‰è¾ƒä½ä¼˜å…ˆçº§çš„è½¯ä¸­æ–­æˆ–è€…ç³»ç»Ÿè°ƒç”¨çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå¦‚æœè¿™ç§æ‰“æ–­é¢‘ç¹çš„è¯ï¼Œå°†ä¼šäº§ç”Ÿè¾ƒé«˜çš„æ€§èƒ½å¼€é”€ã€‚<br>2.<strong>å†…å­˜æ‹·è´</strong>ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªç½‘ç»œæ•°æ®åŒ…ä»ç½‘å¡åˆ°åº”ç”¨ç¨‹åºéœ€è¦ç»è¿‡å¦‚ä¸‹çš„è¿‡ç¨‹ï¼šæ•°æ®ä»ç½‘å¡é€šè¿‡ DMA ç­‰æ–¹å¼ä¼ åˆ°å†…æ ¸å¼€è¾Ÿçš„ç¼“å†²åŒºï¼Œç„¶åä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·æ€ç©ºé—´ï¼Œåœ¨ Linux å†…æ ¸åè®®æ ˆä¸­ï¼Œè¿™ä¸ªè€—æ—¶æ“ä½œç”šè‡³å åˆ°äº†æ•°æ®åŒ…æ•´ä¸ªå¤„ç†æµç¨‹çš„ 57.1%ã€‚<br>3.<strong>ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼š</strong>é¢‘ç¹åˆ°è¾¾çš„ç¡¬ä»¶ä¸­æ–­å’Œè½¯ä¸­æ–­éƒ½å¯èƒ½éšæ—¶æŠ¢å ç³»ç»Ÿè°ƒç”¨çš„è¿è¡Œï¼Œè¿™ä¼šäº§ç”Ÿå¤§é‡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚å¦å¤–ï¼Œåœ¨åŸºäºå¤šçº¿ç¨‹çš„æœåŠ¡å™¨è®¾è®¡æ¡†æ¶ä¸­ï¼Œçº¿ç¨‹é—´çš„è°ƒåº¦ä¹Ÿä¼šäº§ç”Ÿé¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼ŒåŒæ ·ï¼Œé”ç«äº‰çš„è€—èƒ½ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸ä¸¥é‡çš„é—®é¢˜ã€‚<br>4.<strong>å±€éƒ¨æ€§å¤±æ•ˆï¼š</strong>å¦‚ä»Šä¸»æµçš„å¤„ç†å™¨éƒ½æ˜¯å¤šä¸ªæ ¸å¿ƒçš„ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªæ•°æ®åŒ…çš„å¤„ç†å¯èƒ½è·¨å¤šä¸ª CPU æ ¸å¿ƒï¼Œæ¯”å¦‚ä¸€ä¸ªæ•°æ®åŒ…å¯èƒ½ä¸­æ–­åœ¨ cpu0ï¼Œå†…æ ¸æ€å¤„ç†åœ¨ cpu1ï¼Œç”¨æˆ·æ€å¤„ç†åœ¨ cpu2ï¼Œè¿™æ ·è·¨å¤šä¸ªæ ¸å¿ƒï¼Œå®¹æ˜“é€ æˆ CPU ç¼“å­˜å¤±æ•ˆï¼Œé€ æˆå±€éƒ¨æ€§å¤±æ•ˆã€‚å¦‚æœæ˜¯ NUMA æ¶æ„ï¼Œæ›´ä¼šé€ æˆè·¨ NUMA è®¿é—®å†…å­˜ï¼Œæ€§èƒ½å—åˆ°å¾ˆå¤§å½±å“ã€‚<br>5.<strong>å†…å­˜ç®¡ç†ï¼š</strong>ä¼ ç»ŸæœåŠ¡å™¨å†…å­˜é¡µä¸º 4Kï¼Œä¸ºäº†æé«˜å†…å­˜çš„è®¿é—®é€Ÿåº¦ï¼Œé¿å… cache missï¼Œå¯ä»¥å¢åŠ  cache ä¸­æ˜ å°„è¡¨çš„æ¡ç›®ï¼Œä½†è¿™åˆä¼šå½±å“ CPU çš„æ£€ç´¢æ•ˆç‡ã€‚</p></blockquote><p><code>æ­¤å¤„å¼•ç”¨</code> <a href="https://github.com/OSH-2019/x-xdp-on-android/blob/master/docs/research.md" target="_blank" rel="noopener">1</a></p><h4 id="8-è½¯ä¸­æ–­å¯¹ç½‘å¡è¿›è¡Œè½®è®­æ”¶åŒ…"><a href="#8-è½¯ä¸­æ–­å¯¹ç½‘å¡è¿›è¡Œè½®è®­æ”¶åŒ…" class="headerlink" title="8. è½¯ä¸­æ–­å¯¹ç½‘å¡è¿›è¡Œè½®è®­æ”¶åŒ…"></a>8. è½¯ä¸­æ–­å¯¹ç½‘å¡è¿›è¡Œè½®è®­æ”¶åŒ…</h4><ul><li><strong>è¡¥å……</strong></li></ul><p>å› ä¸ºç¡¬ä»¶ä¸­æ–­ä¸èƒ½è¢«åµŒå¥—å³ä¸èƒ½è¢«æ‰“æ–­ï¼Œæ‰€ä»¥ NIC ä¼šå°†ç¡¬ä¸­æ–­ä¿¡å·æ¸…ç†æ‰å»è§¦å‘ä¸€ä¸ªè½¯ä¸­æ–­ï¼Œè€Œè½¯ä¸­æ–­åªéœ€è¦æŒ‡ä»¤å³å¯è§¦å‘ã€‚</p><ul><li><p>ç¡¬ä¸­æ–­ï¼šç¡¬ä»¶ä¿¡å·è§¦å‘çš„ï¼Œæ¯”å¦‚é”®ç›˜æŒ‰é”®ã€‚</p></li><li><p>è½¯ä¸­æ–­ï¼šCPU è‡ªèº«æŒ‡ä»¤è§¦å‘çš„ä¸­æ–­ï¼Œå¯ä»¥è¢«ç¡¬ä»¶ä¸­æ–­æ‰“æ–­ã€‚æ¯”å¦‚ç³»ç»Ÿè°ƒç”¨ã€‚</p></li></ul><p>ä¸­æ–­æ•°é‡å¤ªå¤šçš„æ—¶å€™ï¼ŒCPU ä¸æ–­åœ°ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½å°†ä¼šæœ‰æ‰€æŸè€—ã€‚</p><p>åŠä¸­æ–­åŠè½®è¯¢æ¨¡å¼ï¼šåœ¨è½¯ä¸­æ–­é‡Œè½®è¯¢æ”¶åŒ…ã€‚</p><h4 id="9-æ•°æ®åŒ…è¢«æ”¾å…¥-qdisc-é˜Ÿåˆ—"><a href="#9-æ•°æ®åŒ…è¢«æ”¾å…¥-qdisc-é˜Ÿåˆ—" class="headerlink" title="9. æ•°æ®åŒ…è¢«æ”¾å…¥ qdisc é˜Ÿåˆ—"></a>9. æ•°æ®åŒ…è¢«æ”¾å…¥ qdisc é˜Ÿåˆ—</h4><p>ä»¥å‰æ¯ä¸€ä¸ª NIC ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ‰€æœ‰çš„ä¸­æ–­éƒ½è¢«ä¸€ä¸ª CPU å¤„ç†ï¼Œç›´åˆ°åæ¥æ”¹è¿›è®¾è®¡å‡ºç½‘å¡å¤šé˜Ÿåˆ—çš„æ¨¡å‹ã€‚</p><p>ç½‘å¡å¤šé˜Ÿåˆ—ï¼šä¸€ä¸ªç½‘å¡å¯¹åº”å¤šä¸ªæ¥æ”¶é˜Ÿåˆ—ï¼Œåœ¨æ”¶åˆ°æ•°æ®åŒ…åä¼šå¯¹æºåœ°å€å’Œç›®çš„åœ°å€åšä¸€ä¸ª HASH åˆ†é…åˆ°å¯¹å„ä¸ªé˜Ÿåˆ—å½“ä¸­å»ï¼Œæ¯ä¸€ä¸ªé˜Ÿåˆ—éƒ½ä¼šæœ‰ä¸ªå­ä¸­æ–­å·ï¼Œè¿™ä¸ªå­ä¸­æ–­å·å¯ä»¥åˆ†é…åˆ°ä¸åŒçš„ CPU ä¸­å»å¤„ç†ã€‚è¿™æ ·å¯ä»¥è®© NIC æ”¶åˆ°çš„æ•°æ®åŒ…è®©å¤šä¸ª CPU æ¥å¤„ç†ã€‚</p><p>CPU ç»‘å®šï¼šä¸€ä¸ª NIC äº§ç”Ÿå¤šä¸ªä¸­æ–­ï¼Œè®©å¤šä¸ª CPU å»åˆ†æ‹…ä¸­æ–­çš„è´Ÿè½½ã€‚</p><h4 id="10-å°†æ•°æ®åŒ…é€å…¥åè®®æ ˆï¼Œè°ƒç”¨-ip-recv"><a href="#10-å°†æ•°æ®åŒ…é€å…¥åè®®æ ˆï¼Œè°ƒç”¨-ip-recv" class="headerlink" title="10. å°†æ•°æ®åŒ…é€å…¥åè®®æ ˆï¼Œè°ƒç”¨ ip_recv"></a>10. å°†æ•°æ®åŒ…é€å…¥åè®®æ ˆï¼Œè°ƒç”¨ ip_recv</h4><p>åœ¨æ­¤æ•°æ®åŒ…å°±è¿›å…¥äº†åè®®æ ˆï¼Œè°ƒç”¨ ip_recv è¿›å…¥ä¸‰å±‚åè®®æ ˆã€‚</p><p>ip_recvå‡½æ•° <a href="http://abcdxyzk.github.io/blog/2015/03/04/kernel-net-ip/" target="_blank" rel="noopener">linux TCP/IPåè®®æ ˆ-IPå±‚</a></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ä¸»è¦åŠŸèƒ½ï¼šå¯¹IPå¤´éƒ¨åˆæ³•æ€§è¿›è¡Œä¸¥æ ¼æ£€æŸ¥ï¼Œç„¶åæŠŠå…·ä½“åŠŸèƒ½äº¤ç»™ip_rcv_finishã€‚*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ip_rcv</span><span class="params">(struct sk_buff *skb, struct net_device *dev, struct packet_type *pt, struct net_device *orig_dev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">iphdr</span> *<span class="title">iph</span>;</span></span><br><span class="line">u32 len;</span><br><span class="line"><span class="comment">/* ç½‘ç»œåå­—ç©ºé—´ï¼Œå¿½ç•¥ */</span></span><br><span class="line"><span class="keyword">if</span> (dev-&gt;nd_net != &amp;init_net)</span><br><span class="line"><span class="keyword">goto</span> drop;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *å½“ç½‘å¡å¤„äºæ··æ‚æ¨¡å¼æ—¶ï¼Œæ”¶åˆ°ä¸æ˜¯å‘å¾€è¯¥ä¸»æœºçš„æ•°æ®åŒ…ï¼Œç”±net_rx_action()è®¾ç½®ã€‚</span></span><br><span class="line"><span class="comment"> *åœ¨è°ƒç”¨ip_rcvä¹‹å‰ï¼Œå†…æ ¸ä¼šå°†è¯¥æ•°æ®åŒ…äº¤ç»™å—…æ¢å™¨ï¼Œæ‰€ä»¥è¯¥å‡½æ•°ä»…ä¸¢å¼ƒè¯¥åŒ…ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">if</span> (skb-&gt;pkt_type == PACKET_OTHERHOST)</span><br><span class="line"><span class="keyword">goto</span> drop;</span><br><span class="line"><span class="comment">/* SNMPæ‰€éœ€è¦çš„ç»Ÿè®¡æ•°æ®ï¼Œå¿½ç•¥ */</span></span><br><span class="line">IP_INC_STATS_BH(IPSTATS_MIB_INRECEIVES);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *ip_rcvæ˜¯ç”±netif_receive_skbå‡½æ•°è°ƒç”¨ï¼Œå¦‚æœå—…æ¢å™¨æˆ–è€…å…¶ä»–çš„ç”¨æˆ·å¯¹æ•°æ®åŒ…éœ€è¦è¿›</span></span><br><span class="line"><span class="comment"> *è¿›è¡Œå¤„ç†ï¼Œåˆ™åœ¨è°ƒç”¨ip_rcvä¹‹å‰ï¼Œnetif_receive_skbä¼šå¢åŠ skbçš„å¼•ç”¨è®¡æ•°ï¼Œæ—¢è¯¥å¼•</span></span><br><span class="line"><span class="comment"> *ç”¨è®¡æ•°ä¼šå¤§äº1ã€‚è‹¥å¦‚æ­¤æ¬¡ï¼Œåˆ™skb_share_checkä¼šåˆ›å»ºsk_buffçš„ä¸€ä»½æ‹·è´ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">if</span> ((skb = skb_share_check(skb, GFP_ATOMIC)) == <span class="literal">NULL</span>) &#123;</span><br><span class="line">IP_INC_STATS_BH(IPSTATS_MIB_INDISCARDS);</span><br><span class="line"><span class="keyword">goto</span> out;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *pskb_may_pullç¡®ä¿skb-&gt;dataæŒ‡å‘çš„å†…å­˜åŒ…å«çš„æ•°æ®è‡³å°‘ä¸ºIPå¤´éƒ¨å¤§å°ï¼Œç”±äºæ¯ä¸ª</span></span><br><span class="line"><span class="comment"> *IPæ•°æ®åŒ…åŒ…æ‹¬IPåˆ†ç‰‡å¿…é¡»åŒ…å«ä¸€ä¸ªå®Œæ•´çš„IPå¤´éƒ¨ã€‚å¦‚æœå°äºIPå¤´éƒ¨å¤§å°ï¼Œåˆ™ç¼ºå¤±</span></span><br><span class="line"><span class="comment"> *çš„éƒ¨åˆ†å°†ä»æ•°æ®åˆ†ç‰‡ä¸­æ‹·è´ã€‚è¿™äº›åˆ†ç‰‡ä¿å­˜åœ¨skb_shinfo(skb)-&gt;frags[]ä¸­ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">if</span> (!pskb_may_pull(skb, <span class="keyword">sizeof</span>(struct iphdr)))</span><br><span class="line"><span class="keyword">goto</span> inhdr_error;</span><br><span class="line"><span class="comment">/* pskb_may_pullå¯èƒ½ä¼šè°ƒæ•´skbä¸­çš„æŒ‡é’ˆï¼Œæ‰€ä»¥éœ€è¦é‡æ–°å®šä¹‰IPå¤´éƒ¨*/</span></span><br><span class="line">iph = ip_hdr(skb);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    RFC1122: 3.1.2.2 MUST silently discard any IP frame that fails the checksum.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *    Is the datagram acceptable?</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *    1.    Length at least the size of an ip header</span></span><br><span class="line"><span class="comment"> *    2.    Version of 4</span></span><br><span class="line"><span class="comment"> *    3.    Checksums correctly. [Speed optimisation for later, skip loopback checksums]</span></span><br><span class="line"><span class="comment"> *    4.    Doesn't have a bogus length</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/* ä¸Šé¢è¯´çš„å¾ˆæ¸…æ¥šäº† */</span></span><br><span class="line"><span class="keyword">if</span> (iph-&gt;ihl &lt; <span class="number">5</span> || iph-&gt;version != <span class="number">4</span>)</span><br><span class="line"><span class="keyword">goto</span> inhdr_error;</span><br><span class="line"><span class="comment">/* ç¡®ä¿IPå®Œæ•´çš„å¤´éƒ¨åŒ…æ‹¬é€‰é¡¹åœ¨å†…å­˜ä¸­ */</span></span><br><span class="line"><span class="keyword">if</span> (!pskb_may_pull(skb, iph-&gt;ihl*<span class="number">4</span>))</span><br><span class="line"><span class="keyword">goto</span> inhdr_error;</span><br><span class="line"></span><br><span class="line">iph = ip_hdr(skb);</span><br><span class="line"><span class="comment">/* éªŒè¯IPå¤´éƒ¨çš„æ ¡éªŒå’Œ */</span></span><br><span class="line"><span class="keyword">if</span> (unlikely(ip_fast_csum((u8 *)iph, iph-&gt;ihl)))</span><br><span class="line"><span class="keyword">goto</span> inhdr_error;</span><br><span class="line"><span class="comment">/* IPå¤´éƒ¨ä¸­æŒ‡ç¤ºçš„IPæ•°æ®åŒ…æ€»é•¿åº¦ */</span></span><br><span class="line">len = ntohs(iph-&gt;tot_len);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *ç¡®ä¿skbçš„æ•°æ®é•¿åº¦å¤§äºç­‰äºIPå¤´éƒ¨ä¸­æŒ‡ç¤ºçš„IPæ•°æ®åŒ…æ€»é•¿åº¦åŠæ•°æ®åŒ…æ€»é•¿åº¦å¿…é¡»</span></span><br><span class="line"><span class="comment"> *å¤§äºç­‰äºIPå¤´éƒ¨é•¿åº¦ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">if</span> (skb-&gt;len &lt; len) &#123;</span><br><span class="line">IP_INC_STATS_BH(IPSTATS_MIB_INTRUNCATEDPKTS);</span><br><span class="line"><span class="keyword">goto</span> drop;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (len &lt; (iph-&gt;ihl*<span class="number">4</span>))</span><br><span class="line"><span class="keyword">goto</span> inhdr_error;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Our transport medium may have padded the buffer out. Now we know it</span></span><br><span class="line"><span class="comment"> * is IP we can trim to the true length of the frame.</span></span><br><span class="line"><span class="comment"> * Note this now means skb-&gt;len holds ntohs(iph-&gt;tot_len).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/* æ³¨é‡Šè¯´æ˜çš„å¾ˆæ¸…æ¥šï¼Œè¯¥å‡½æ•°æˆåŠŸæ‰§è¡Œå®Œä¹‹åï¼Œskb-&gt;len = ntohs(iph-&gt;tot_len). */</span></span><br><span class="line"><span class="keyword">if</span> (pskb_trim_rcsum(skb, len)) &#123;</span><br><span class="line">IP_INC_STATS_BH(IPSTATS_MIB_INDISCARDS);</span><br><span class="line"><span class="keyword">goto</span> drop;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Remove any debris in the socket control block */</span></span><br><span class="line"><span class="built_in">memset</span>(IPCB(skb), <span class="number">0</span>, <span class="keyword">sizeof</span>(struct inet_skb_parm));</span><br><span class="line"><span class="comment">/* å¿½ç•¥ä¸netfilterå­ç³»ç»Ÿçš„äº¤äº’ï¼Œè°ƒç”¨ä¸ºip_rcv_finish(skb) */</span></span><br><span class="line"><span class="keyword">return</span> NF_HOOK(PF_INET, NF_IP_PRE_ROUTING, skb, dev, <span class="literal">NULL</span>,</span><br><span class="line"> ip_rcv_finish);</span><br><span class="line"></span><br><span class="line">inhdr_error:</span><br><span class="line">IP_INC_STATS_BH(IPSTATS_MIB_INHDRERRORS);</span><br><span class="line">drop:</span><br><span class="line">kfree_skb(skb);</span><br><span class="line">out:</span><br><span class="line"><span class="keyword">return</span> NET_RX_DROP;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="11-è°ƒç”¨-netfilter-çš„-PREROUTING-é“¾"><a href="#11-è°ƒç”¨-netfilter-çš„-PREROUTING-é“¾" class="headerlink" title="11. è°ƒç”¨ netfilter çš„ PREROUTING é“¾"></a>11. è°ƒç”¨ netfilter çš„ PREROUTING é“¾</h4><blockquote><p>netfilterï¼š æ˜¯ Linux å†…æ ¸ä¸­è¿›è¡Œæ•°æ®åŒ…è¿‡æ»¤ï¼Œè¿æ¥è·Ÿè¸ªï¼ˆConnect Trackï¼‰ï¼Œç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰ç­‰åŠŸèƒ½çš„ä¸»è¦å®ç°æ¡†æ¶ï¼›è¯¥æ¡†æ¶åœ¨ç½‘ç»œåè®®æ ˆå¤„ç†æ•°æ®åŒ…çš„å…³é”®æµç¨‹ä¸­å®šä¹‰äº†ä¸€ç³»åˆ—é’©å­ç‚¹ï¼ˆHook ç‚¹ï¼‰ï¼Œå¹¶åœ¨è¿™äº›é’©å­ç‚¹ä¸­æ³¨å†Œä¸€ç³»åˆ—å‡½æ•°å¯¹æ•°æ®åŒ…è¿›è¡Œå¤„ç†ã€‚è¿™äº›æ³¨å†Œåœ¨é’©å­ç‚¹çš„å‡½æ•°å³ä¸ºè®¾ç½®åœ¨ç½‘ç»œåè®®æ ˆå†…çš„æ•°æ®åŒ…é€šè¡Œç­–ç•¥ï¼Œä¹Ÿå°±æ„å‘³ç€ï¼Œè¿™äº›å‡½æ•°å¯ä»¥å†³å®šå†…æ ¸æ˜¯æ¥å—è¿˜æ˜¯ä¸¢å¼ƒæŸä¸ªæ•°æ®åŒ…ï¼Œæ¢å¥è¯è¯´ï¼Œè¿™äº›å‡½æ•°çš„å¤„ç†ç»“æœå†³å®šäº†è¿™äº›ç½‘ç»œæ•°æ®åŒ…çš„â€œå‘½è¿â€ã€‚</p></blockquote><p>åœ¨è¿™é‡Œå°±åˆ°äº†å†…æ ¸é˜²ç«å¢™<em>ip_rcv</em>å‡½æ•°ä¸ºç½‘ç»œå±‚å‘ä¸‹å±‚å¼€æ”¾çš„å…¥å£ï¼Œæ•°æ®åŒ…é€šè¿‡è¯¥å‡½æ•°è¿›å…¥ç½‘ç»œå±‚è¿›è¡Œå¤„ç†ï¼Œè¯¥å‡½æ•°ä¸»è¦å¯¹ä¸Šä¼ åˆ°ç½‘ç»œå±‚çš„æ•°æ®åŒ…è¿›è¡Œå‰æœŸåˆæ³•æ€§æ£€æŸ¥ï¼Œé€šè¿‡åäº¤ç”± Netfilter çš„é’©å­èŠ‚ç‚¹ï¼ˆIP_PRE_ROUTINGï¼‰ï¼› IP_PRE_ROUTING ä¼šæ ¹æ®é¢„è®¾çš„è§„åˆ™å¯¹æ•°æ®åŒ…è¿›è¡Œåˆ¤å†³å¹¶æ ¹æ®åˆ¤å†³ç»“æœåšç›¸å…³çš„å¤„ç†ï¼Œæ¯”å¦‚æ‰§è¡Œ NAT è½¬æ¢ï¼›</p><h4 id="12-æŸ¥æ‰¾è·¯ç”±è¡¨ï¼Œè¿›è¡Œè½¬å‘æˆ–è€…æŠ•é€’åˆ°-local"><a href="#12-æŸ¥æ‰¾è·¯ç”±è¡¨ï¼Œè¿›è¡Œè½¬å‘æˆ–è€…æŠ•é€’åˆ°-local" class="headerlink" title="12. æŸ¥æ‰¾è·¯ç”±è¡¨ï¼Œè¿›è¡Œè½¬å‘æˆ–è€…æŠ•é€’åˆ° local"></a>12. æŸ¥æ‰¾è·¯ç”±è¡¨ï¼Œè¿›è¡Œè½¬å‘æˆ–è€…æŠ•é€’åˆ° local</h4><p>IP_PRE_ROUTING èŠ‚ç‚¹å¤„ç†å®Œæˆåï¼Œæ•°æ®åŒ…å°†äº¤ç”± <code>ip_rcv_finish</code> å¤„ç†ï¼Œè¯¥å‡½æ•°æ ¹æ®è·¯ç”±åˆ¤å†³ç»“æœï¼Œå†³å®šæ•°æ®åŒ…æ˜¯äº¤ç”±æœ¬æœºä¸Šå±‚åº”ç”¨å¤„ç†ï¼Œè¿˜æ˜¯éœ€è¦è¿›è¡Œè½¬å‘ï¼›å¦‚æœæ˜¯äº¤ç”±æœ¬æœºå¤„ç†ï¼Œåˆ™ä¼šäº¤ç”± <code>p_local_deliver</code> æœ¬åœ°ä¸Šäº¤æµç¨‹ï¼›å¦‚æœéœ€è¦è½¬å‘ï¼Œåˆ™äº¤ç”± <code>ip_forward</code> å‡½æ•°èµ°è½¬å‘æµç¨‹ï¼ŒIP_FORWARD èŠ‚ç‚¹ä¼šå¯¹è½¬å‘æ•°æ®åŒ…è¿›è¡Œæ£€æŸ¥è¿‡æ»¤ï¼›</p><h4 id="13-å¯¹æŠ•é€’åˆ°-local-çš„æ•°æ®åŒ…è°ƒç”¨-netfilter-çš„-LOCAL-IN-é“¾"><a href="#13-å¯¹æŠ•é€’åˆ°-local-çš„æ•°æ®åŒ…è°ƒç”¨-netfilter-çš„-LOCAL-IN-é“¾" class="headerlink" title="13. å¯¹æŠ•é€’åˆ° local çš„æ•°æ®åŒ…è°ƒç”¨ netfilter çš„ LOCAL_IN é“¾"></a>13. å¯¹æŠ•é€’åˆ° local çš„æ•°æ®åŒ…è°ƒç”¨ netfilter çš„ LOCAL_IN é“¾</h4><h4 id="14-è°ƒç”¨å››å±‚åè®®æ ˆï¼Œå¦‚-tcp-v4-rcv"><a href="#14-è°ƒç”¨å››å±‚åè®®æ ˆï¼Œå¦‚-tcp-v4-rcv" class="headerlink" title="14. è°ƒç”¨å››å±‚åè®®æ ˆï¼Œå¦‚ tcp_v4_rcv"></a>14. è°ƒç”¨å››å±‚åè®®æ ˆï¼Œå¦‚ tcp_v4_rcv</h4><h4 id="15-æŸ¥æ‰¾åˆ°å¯¹åº”çš„-socketï¼Œè¿è¡Œ-TCP-çš„çŠ¶æ€æœº"><a href="#15-æŸ¥æ‰¾åˆ°å¯¹åº”çš„-socketï¼Œè¿è¡Œ-TCP-çš„çŠ¶æ€æœº" class="headerlink" title="15. æŸ¥æ‰¾åˆ°å¯¹åº”çš„ socketï¼Œè¿è¡Œ TCP çš„çŠ¶æ€æœº"></a>15. æŸ¥æ‰¾åˆ°å¯¹åº”çš„ socketï¼Œè¿è¡Œ TCP çš„çŠ¶æ€æœº</h4><p>å†…æ ¸ä¸­çš„äº”å…ƒç»„ï¼š<code>| åè®®ç±»å‹ | æºåœ°å€ | æºç«¯å£ | ç›®æ ‡åœ°å€ | ç›®çš„ç«¯å£ |</code></p><p>å°†äº”å…ƒç»„è¿›è¡Œ HASH ï¼Œæ ¹æ®å“ˆå¸Œå€¼æ‰¾åˆ°å¯¹åº”çš„ socket â€“&gt; å»è¿è¡Œè¯¥ socket çš„ TCP çŠ¶æ€æœºã€‚</p><h4 id="16-å°†æ•°æ®æ”¾å…¥-TCP-çš„æ¥æ”¶ç¼“å†²åŒºä¸­"><a href="#16-å°†æ•°æ®æ”¾å…¥-TCP-çš„æ¥æ”¶ç¼“å†²åŒºä¸­" class="headerlink" title="16. å°†æ•°æ®æ”¾å…¥ TCP çš„æ¥æ”¶ç¼“å†²åŒºä¸­"></a>16. å°†æ•°æ®æ”¾å…¥ TCP çš„æ¥æ”¶ç¼“å†²åŒºä¸­</h4><h4 id="17-é€šè¿‡-epoll-æˆ–è€…å…¶ä»–è½®è®­æ–¹å¼é€šçŸ¥åº”ç”¨ç¨‹åº"><a href="#17-é€šè¿‡-epoll-æˆ–è€…å…¶ä»–è½®è®­æ–¹å¼é€šçŸ¥åº”ç”¨ç¨‹åº" class="headerlink" title="17. é€šè¿‡ epoll æˆ–è€…å…¶ä»–è½®è®­æ–¹å¼é€šçŸ¥åº”ç”¨ç¨‹åº"></a>17. é€šè¿‡ epoll æˆ–è€…å…¶ä»–è½®è®­æ–¹å¼é€šçŸ¥åº”ç”¨ç¨‹åº</h4><p>epollï¼šé€šè¿‡ epoll ç›‘å¬å¯è¯»äº‹ä»¶ï¼Œæ•°æ®åŒ…ä¸¢åˆ°æ¥æ”¶ç¼“å†²åŒºçš„æ—¶å€™å°±æœ‰ä¸€ä¸ªå¯è¯»çš„äº‹ä»¶ï¼Œepoll å°±ä¼šæŒ‚ä¸€ä¸ªé’©å­ï¼Œå¯è¯»äº‹ä»¶å°±ä¼šè°ƒç”¨ epoll è¿™ä¸ªé’©å­ï¼Œç„¶åå°†å¯è¯»äº‹ä»¶æ”¾å…¥åˆ°å¯è¯»é˜Ÿåˆ—ä¸­ï¼Œæ¥ç€é€šçŸ¥åˆ°åº”ç”¨ç¨‹åºã€‚</p><p>selectï¼š</p><h4 id="18-åº”ç”¨ç¨‹åºè¯»å–ç¨‹åº"><a href="#18-åº”ç”¨ç¨‹åºè¯»å–ç¨‹åº" class="headerlink" title="18. åº”ç”¨ç¨‹åºè¯»å–ç¨‹åº"></a>18. åº”ç”¨ç¨‹åºè¯»å–ç¨‹åº</h4><p>é€šè¿‡ read()å‡½æ•°è¯»å–æ•°æ®ï¼Ÿ</p><h3 id="å‘åŒ…æµç¨‹"><a href="#å‘åŒ…æµç¨‹" class="headerlink" title="å‘åŒ…æµç¨‹"></a>å‘åŒ…æµç¨‹</h3><h4 id="1-åº”ç”¨æ•°æ®å‘é€ç¨‹åº"><a href="#1-åº”ç”¨æ•°æ®å‘é€ç¨‹åº" class="headerlink" title="1. åº”ç”¨æ•°æ®å‘é€ç¨‹åº"></a>1. åº”ç”¨æ•°æ®å‘é€ç¨‹åº</h4><p>è°ƒç”¨ send() å‡½æ•°ï¼Œå°†æ•°æ®ä»åº”ç”¨å±‚æ‹·è´åˆ°å†…æ ¸ä¸­ã€‚</p><h4 id="2-TCP-ä¸ºå‘é€çš„æ•°æ®ç”³è¯·-skb"><a href="#2-TCP-ä¸ºå‘é€çš„æ•°æ®ç”³è¯·-skb" class="headerlink" title="2. TCP ä¸ºå‘é€çš„æ•°æ®ç”³è¯· skb"></a>2. TCP ä¸ºå‘é€çš„æ•°æ®ç”³è¯· skb</h4><p>åœ¨ Linux å†…æ ¸ä¸­ï¼Œç³»ç»Ÿä½¿ç”¨ <code>sk_buff</code> æ•°æ®ç»“æ„å¯¹æ•°æ®åŒ…è¿›è¡Œå­˜å‚¨å’Œç®¡ç†ã€‚åœ¨æ•°æ®åŒ…æ¥æ”¶è¿‡ç¨‹ä¸­ï¼Œè¯¥æ•°æ®ç»“æ„ä»ç½‘å¡é©±åŠ¨æ”¶åŒ…å¼€å§‹ï¼Œä¸€ç›´è´¯ç©¿åˆ°å†…æ ¸ç½‘ç»œåè®®æ ˆçš„é¡¶å±‚ï¼Œç›´åˆ°ç”¨æˆ·æ€ç¨‹åºä»å†…æ ¸è·å–æ•°æ®ã€‚</p><h4 id="3-æ„å»º-TCP-å¤´éƒ¨ï¼Œå¦‚-src-å’Œ-dst-çš„-portï¼Œchecksum"><a href="#3-æ„å»º-TCP-å¤´éƒ¨ï¼Œå¦‚-src-å’Œ-dst-çš„-portï¼Œchecksum" class="headerlink" title="3. æ„å»º TCP å¤´éƒ¨ï¼Œå¦‚ src å’Œ dst çš„ portï¼Œchecksum"></a>3. æ„å»º TCP å¤´éƒ¨ï¼Œå¦‚ src å’Œ dst çš„ portï¼Œchecksum</h4><h4 id="4-è°ƒç”¨ç¬¬ä¸‰å±‚åè®®ï¼Œæ„å»º-IP-å¤´éƒ¨ï¼Œè°ƒç”¨-netfilter-çš„-LOCAL-OUT-é“¾"><a href="#4-è°ƒç”¨ç¬¬ä¸‰å±‚åè®®ï¼Œæ„å»º-IP-å¤´éƒ¨ï¼Œè°ƒç”¨-netfilter-çš„-LOCAL-OUT-é“¾" class="headerlink" title="4. è°ƒç”¨ç¬¬ä¸‰å±‚åè®®ï¼Œæ„å»º IP å¤´éƒ¨ï¼Œè°ƒç”¨ netfilter çš„ LOCAL_OUT é“¾"></a>4. è°ƒç”¨ç¬¬ä¸‰å±‚åè®®ï¼Œæ„å»º IP å¤´éƒ¨ï¼Œè°ƒç”¨ netfilter çš„ LOCAL_OUT é“¾</h4><p>æ­¤å¤„é˜²ç«å¢™ï¼Œä»æœ¬æœºå‡ºå»çš„åŒ…éƒ½è¦è·‘ä¸€ä¸‹ LOCAL_OUT é“¾ï¼Œç½‘ç»œå±‚é€šè¿‡æ³¨å†Œåˆ°ä¸Šå±‚çš„ <code>ip_local_out</code> å‡½æ•°æ¥æ”¶æ•°æ®å¤„ç†ï¼Œå¤„ç† OK è¿›ä¸€æ­¥äº¤ç”± <code>IP_LOCAL_OUT</code> èŠ‚ç‚¹æ£€æµ‹ã€‚</p><h4 id="5-æŸ¥æ‰¾è·¯ç”±è¡¨ï¼Œç¡®å®šä¸‹ä¸€è·³"><a href="#5-æŸ¥æ‰¾è·¯ç”±è¡¨ï¼Œç¡®å®šä¸‹ä¸€è·³" class="headerlink" title="5. æŸ¥æ‰¾è·¯ç”±è¡¨ï¼Œç¡®å®šä¸‹ä¸€è·³"></a>5. æŸ¥æ‰¾è·¯ç”±è¡¨ï¼Œç¡®å®šä¸‹ä¸€è·³</h4><h4 id="6-è°ƒç”¨-netfilter-çš„-POST-ROUTING-é“¾"><a href="#6-è°ƒç”¨-netfilter-çš„-POST-ROUTING-é“¾" class="headerlink" title="6. è°ƒç”¨ netfilter çš„ POST_ROUTING é“¾"></a>6. è°ƒç”¨ netfilter çš„ POST_ROUTING é“¾</h4><p>å¯¹äºå³å°†å‘å¾€ä¸‹å±‚çš„æ•°æ®åŒ…ï¼Œéœ€è¦ç»è¿‡ <code>IP_POST_ROUTING</code> èŠ‚ç‚¹å¤„ç†ï¼›ç½‘ç»œå±‚å¤„ç†ç»“æŸï¼Œé€šè¿‡ <code>dev_queue_xmit</code> å‡½æ•°å°†æ•°æ®åŒ…äº¤ç”± Linux å†…æ ¸ä¸­è™šæ‹Ÿç½‘ç»œè®¾å¤‡åšè¿›ä¸€æ­¥å¤„ç†ï¼Œä»è¿™é‡Œæ•°æ®åŒ…å³ç¦»å¼€ç½‘ç»œå±‚è¿›å…¥åˆ°ä¸‹ä¸€å±‚ã€‚</p><h4 id="7-å¯¹è¶…æ—¶-MTU-çš„æŠ¥æ–‡è¿›è¡Œåˆ†ç‰‡-fragment"><a href="#7-å¯¹è¶…æ—¶-MTU-çš„æŠ¥æ–‡è¿›è¡Œåˆ†ç‰‡-fragment" class="headerlink" title="7. å¯¹è¶…æ—¶ MTU çš„æŠ¥æ–‡è¿›è¡Œåˆ†ç‰‡(fragment)"></a>7. å¯¹è¶…æ—¶ MTU çš„æŠ¥æ–‡è¿›è¡Œåˆ†ç‰‡(fragment)</h4><h4 id="8-è°ƒç”¨äºŒæˆçš„å‘åŒ…å‡½æ•°-dev-queue-xmit"><a href="#8-è°ƒç”¨äºŒæˆçš„å‘åŒ…å‡½æ•°-dev-queue-xmit" class="headerlink" title="8. è°ƒç”¨äºŒæˆçš„å‘åŒ…å‡½æ•° dev_queue_xmit"></a>8. è°ƒç”¨äºŒæˆçš„å‘åŒ…å‡½æ•° dev_queue_xmit</h4><h4 id="9-å°†å¾…å‘æ•°æ®åŒ…æ”¾å…¥è¾“å‡ºçš„-QDisc-é˜Ÿåˆ—"><a href="#9-å°†å¾…å‘æ•°æ®åŒ…æ”¾å…¥è¾“å‡ºçš„-QDisc-é˜Ÿåˆ—" class="headerlink" title="9. å°†å¾…å‘æ•°æ®åŒ…æ”¾å…¥è¾“å‡ºçš„ QDisc é˜Ÿåˆ—"></a>9. å°†å¾…å‘æ•°æ®åŒ…æ”¾å…¥è¾“å‡ºçš„ QDisc é˜Ÿåˆ—</h4><h4 id="10-è°ƒç”¨ç½‘å¡é©±åŠ¨ç¨‹åºï¼Œå°†æ•°æ®åŒ…æ”¾å…¥å¾ªç¯ç¼“å†²é˜Ÿåˆ—-tx"><a href="#10-è°ƒç”¨ç½‘å¡é©±åŠ¨ç¨‹åºï¼Œå°†æ•°æ®åŒ…æ”¾å…¥å¾ªç¯ç¼“å†²é˜Ÿåˆ—-tx" class="headerlink" title="10. è°ƒç”¨ç½‘å¡é©±åŠ¨ç¨‹åºï¼Œå°†æ•°æ®åŒ…æ”¾å…¥å¾ªç¯ç¼“å†²é˜Ÿåˆ— tx"></a>10. è°ƒç”¨ç½‘å¡é©±åŠ¨ç¨‹åºï¼Œå°†æ•°æ®åŒ…æ”¾å…¥å¾ªç¯ç¼“å†²é˜Ÿåˆ— tx</h4><h4 id="11-é©±åŠ¨ç¨‹åºåœ¨-tx-usecs-çš„è¶…æ—¶æ—¶é—´åï¼Œæˆ–è€…ç§¯ç´¯-tx-frames-ä¸ªå¾…å‘æ•°æ®åŒ…åè§¦å‘è½¯ä¸­æ–­"><a href="#11-é©±åŠ¨ç¨‹åºåœ¨-tx-usecs-çš„è¶…æ—¶æ—¶é—´åï¼Œæˆ–è€…ç§¯ç´¯-tx-frames-ä¸ªå¾…å‘æ•°æ®åŒ…åè§¦å‘è½¯ä¸­æ–­" class="headerlink" title="11. é©±åŠ¨ç¨‹åºåœ¨ tx-usecs çš„è¶…æ—¶æ—¶é—´åï¼Œæˆ–è€…ç§¯ç´¯ tx-frames ä¸ªå¾…å‘æ•°æ®åŒ…åè§¦å‘è½¯ä¸­æ–­"></a>11. é©±åŠ¨ç¨‹åºåœ¨ tx-usecs çš„è¶…æ—¶æ—¶é—´åï¼Œæˆ–è€…ç§¯ç´¯ tx-frames ä¸ªå¾…å‘æ•°æ®åŒ…åè§¦å‘è½¯ä¸­æ–­</h4><ul><li><p>tx-usecs</p></li><li><p>tx-frames</p></li></ul><h4 id="12-é©±åŠ¨ç¨‹åºå¯ç”¨ç½‘å¡çš„ç¡¬ä»¶ä¸­æ–­"><a href="#12-é©±åŠ¨ç¨‹åºå¯ç”¨ç½‘å¡çš„ç¡¬ä»¶ä¸­æ–­" class="headerlink" title="12. é©±åŠ¨ç¨‹åºå¯ç”¨ç½‘å¡çš„ç¡¬ä»¶ä¸­æ–­"></a>12. é©±åŠ¨ç¨‹åºå¯ç”¨ç½‘å¡çš„ç¡¬ä»¶ä¸­æ–­</h4><h4 id="13-é©±åŠ¨ç¨‹åºå°†æ•°æ®åŒ…æ˜ å°„åˆ°-DMA-å†…å­˜"><a href="#13-é©±åŠ¨ç¨‹åºå°†æ•°æ®åŒ…æ˜ å°„åˆ°-DMA-å†…å­˜" class="headerlink" title="13. é©±åŠ¨ç¨‹åºå°†æ•°æ®åŒ…æ˜ å°„åˆ° DMA å†…å­˜"></a>13. é©±åŠ¨ç¨‹åºå°†æ•°æ®åŒ…æ˜ å°„åˆ° DMA å†…å­˜</h4><h4 id="14-ç½‘å¡ä»-DMA-ä¸­å–æ•°æ®å¹¶å‘é€"><a href="#14-ç½‘å¡ä»-DMA-ä¸­å–æ•°æ®å¹¶å‘é€" class="headerlink" title="14. ç½‘å¡ä» DMA ä¸­å–æ•°æ®å¹¶å‘é€"></a>14. ç½‘å¡ä» DMA ä¸­å–æ•°æ®å¹¶å‘é€</h4><h4 id="15-ç½‘å¡å‘é€å®Œæ¯•åè§¦å‘ç¡¬ä»¶ä¸­æ–­"><a href="#15-ç½‘å¡å‘é€å®Œæ¯•åè§¦å‘ç¡¬ä»¶ä¸­æ–­" class="headerlink" title="15. ç½‘å¡å‘é€å®Œæ¯•åè§¦å‘ç¡¬ä»¶ä¸­æ–­"></a>15. ç½‘å¡å‘é€å®Œæ¯•åè§¦å‘ç¡¬ä»¶ä¸­æ–­</h4><h4 id="16-ç¡¬ä¸­æ–­æ¸…ç†ä¸­æ–­ä¿¡å·åè§¦å‘è½¯ä¸­æ–­"><a href="#16-ç¡¬ä¸­æ–­æ¸…ç†ä¸­æ–­ä¿¡å·åè§¦å‘è½¯ä¸­æ–­" class="headerlink" title="16. ç¡¬ä¸­æ–­æ¸…ç†ä¸­æ–­ä¿¡å·åè§¦å‘è½¯ä¸­æ–­"></a>16. ç¡¬ä¸­æ–­æ¸…ç†ä¸­æ–­ä¿¡å·åè§¦å‘è½¯ä¸­æ–­</h4><h4 id="17-è½¯ä¸­æ–­é‡Šæ”¾å·²ç»å‘é€å®Œçš„æ•°æ®åŒ…çš„å†…å­˜"><a href="#17-è½¯ä¸­æ–­é‡Šæ”¾å·²ç»å‘é€å®Œçš„æ•°æ®åŒ…çš„å†…å­˜" class="headerlink" title="17. è½¯ä¸­æ–­é‡Šæ”¾å·²ç»å‘é€å®Œçš„æ•°æ®åŒ…çš„å†…å­˜"></a>17. è½¯ä¸­æ–­é‡Šæ”¾å·²ç»å‘é€å®Œçš„æ•°æ®åŒ…çš„å†…å­˜</h4><h2 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h2><p>æåˆ°é˜²ç«å¢™ï¼Œæƒ³å¿…å„ä½éƒ½çŸ¥é“å¤§åé¼é¼çš„æ–¹æ•™æˆå“ˆğŸ˜‚ï¼Œä¸è¿‡å’±ä»Šå¤©ä¸è°ˆè¿™ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»è¯»ä¸€å“ˆ <a href="https://gfw.report/blog/gfw_shadowsocks/zh.html" target="_blank" rel="noopener">Shadowsocksæ˜¯å¦‚ä½•è¢«æ£€æµ‹å’Œå°é”çš„</a> å’Œ <a href="http://www.oneyearago.me/2019/06/14/learn_gwf/" target="_blank" rel="noopener">G.F.Wçš„åŸç†</a></p><p>è®²å®Œäº† Linux å‘åŒ…å’Œæ”¶åŒ…çš„æ•´ä¸ªæµç¨‹æˆ‘ä»¬å°±æ¸…æ¥šäº†é˜²ç«å¢™åœ¨ç½‘ç»œä¸­æ‰€å·¥ä½œçš„åœ°æ–¹ï¼Œä¸‹é¢å°±å°†ä¸€ä¸‹ Linux ä¸Šçš„é˜²ç«å¢™ iptablesã€‚</p><h3 id="iptales"><a href="#iptales" class="headerlink" title="iptales"></a>iptales</h3><p>è‡ªä» Linux å†…æ ¸ 2.4 ä¹‹å iptables å°±é›†æˆè¿›ä¸»çº¿å†…æ ¸ï¼Œä¸è¿‡ iptables åªæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºé…ç½®ç®¡ç†æ•°æ®åŒ…çš„è¿‡æ»¤è§„åˆ™ï¼Œè€ŒçœŸæ­£èµ·åˆ°ä¿¡æ¯åŒ…è¿‡æ»¤ä½œç”¨çš„æ˜¯ netfilter æ¡†æ¶ã€‚å‡†ç¡®æ¥è®² iptables æ˜¯ä¸€ä¸ªé€šè¿‡æ§åˆ¶ Linux å†…æ ¸çš„ netfilter æ¨¡å—æ¥<strong>ç®¡ç†ç½‘ç»œæ•°æ®åŒ…çš„æµåŠ¨ä¸è½¬é€</strong>çš„åº”ç”¨è½¯ä»¶ï¼Œå…¶åŠŸèƒ½åŒ…æ‹¬ä¸ä»…ä»…åŒ…æ‹¬é˜²ç«å¢™çš„æ§åˆ¶å‡ºå…¥æµé‡ï¼Œè¿˜æœ‰ç«¯å£è½¬å‘ç­‰ç­‰ã€‚</p><h3 id="netfilter"><a href="#netfilter" class="headerlink" title="netfilter"></a>netfilter</h3><p>netfilter æ˜¯å†…æ ¸çš„ä¸€ä¸ªå­ç³»ç»Ÿï¼Œå…¶å·¥ä½œåœ¨å†…æ ¸ç©ºé—´ï¼Œæ ¸å¿ƒæ˜¯ä¸€ä¸ªæŠ¥æ–‡è¿‡æ»¤æ¶æ„ï¼Œå®ƒåŒ…å«äº†ä¸€ç»„åˆ†å¸ƒåœ¨æŠ¥æ–‡å¤„ç†å„ä¸ªé˜¶æ®µçš„é’©å­å‡½æ•°ï¼ŒæŠ¥æ–‡ç»è¿‡ç½‘ç»œåè®®æ ˆæ—¶è¿›å…¥ netfilter å¤„ç†æ¶æ„ï¼Œä¼šè°ƒç”¨å…¶ä»–æ¨¡å—åœ¨å„ä¸ªé˜¶æ®µæ³¨å†Œçš„é’©å­å‡½æ•°ï¼Œå¹¶è¿”å›å¤„ç†ç»“æœï¼Œnetfilter æ ¹æ®è¿”å›ç»“æœè¿›è¡Œä¸åŒçš„å¤„ç†ã€‚</p><h4 id="è¡¨-é“¾-è§„åˆ™"><a href="#è¡¨-é“¾-è§„åˆ™" class="headerlink" title="è¡¨/é“¾/è§„åˆ™"></a>è¡¨/é“¾/è§„åˆ™</h4><p>iptables å†…éƒ¨æœ‰è¡¨ tablesã€é“¾ chainsã€è§„åˆ™ rules è¿™ä¸‰ç§æ¦‚å¿µã€‚å…¶ä¸­æ¯ä¸€ä¸ª <code>è¡¨</code> éƒ½å’Œä¸åŒçš„æ•°æ®åŒ…å¤„ç†æœ‰å…³ï¼Œè€Œå†³å®šæ•°æ®åŒ…æ˜¯å¦å¯ä»¥ç©¿è¶Šçš„æ˜¯ <code>é“¾</code>ã€è€Œé“¾ä¸Šçš„ä¸€æ¡æ¡ <code>è§„åˆ™</code> å†³å®šäº†æ˜¯å¦é€å¾€ä¸‹ä¸€æ¡é“¾ï¼ˆæˆ–å…¶å®ƒçš„åŠ¨ä½œï¼‰ã€‚ netfilter/iptables å¯ä»¥ç†è§£æˆæ˜¯ <code>è¡¨</code> çš„å®¹å™¨ï¼›è¡¨åˆ™æ˜¯ <code>é“¾</code> çš„å®¹å™¨ï¼Œå³æ‰€æœ‰çš„<code>é“¾</code>éƒ½å±äºå…¶å¯¹åº”çš„<code>è¡¨</code>ï¼›<code>é“¾</code>æ˜¯ <code>è§„åˆ™</code> çš„å®¹å™¨ï¼Œå…¶é›†åˆä»å±å…³ç³»å¯ä»¥è¡¨è¿°ä¸ºï¼ˆè¡¨ï¼ˆé“¾ï¼ˆè§„åˆ™ï¼‰ï¼‰ï¼‰ã€‚</p><p>å¹¿ä¸ºæµä¼ çš„è¯´æ³•æ˜¯ iptables æœ‰å››è¡¨äº”é“¾ï¼Œå…¶ä¸­å››è¡¨ï¼ˆ rawã€filter, nat, mangle,ï¼‰äº”é“¾ï¼ˆINPUTã€OUTPUTã€FORWARDã€ PREROUTINGã€ POSTROUTINGï¼‰ï¼Œä¸è¿‡ä¹Ÿæœ‰è¯´æ³•ä¸ºäº”è¡¨ï¼ˆ rawã€filterã€natã€mangleã€securityï¼‰äº”é“¾ï¼Œä¸è¿‡ security è¡¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¸ä¼šç”¨åˆ°ï¼Œå¸¸ç”¨çš„æ˜¯  filter å’Œ nat è¡¨ï¼Œmangle è¡¨æ¬¡ä¹‹ã€‚</p><h4 id="äº”è¡¨"><a href="#äº”è¡¨" class="headerlink" title="äº”è¡¨"></a>äº”è¡¨</h4><ul><li><p>raw è¡¨ï¼š ä¼˜å…ˆçº§æœ€é«˜ï¼Œé€šå¸¸ä¸<code>NOTRACK</code>ä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºè·³è¿‡<code>è¿æ¥è·Ÿè¸ªï¼ˆconntrackï¼‰</code>å’Œ nat è¡¨çš„å¤„ç†ç”¨äºé…ç½®æ•°æ®åŒ…ï¼Œraw ä¸­çš„æ•°æ®åŒ…ä¸ä¼šè¢«ç³»ç»Ÿè·Ÿè¸ªã€‚è®¾ç½® raw æ—¶ä¸€èˆ¬æ˜¯ä¸ºäº†ä¸å†è®© iptables åšæ•°æ®åŒ…çš„é“¾æ¥è·Ÿè¸ªå¤„ç†ï¼Œæé«˜æ€§èƒ½ã€‚</p></li><li><p>filter è¡¨ï¼š ä¸º iptables é»˜è®¤çš„è¡¨ï¼Œç”¨äºè¿‡æ»¤æ•°æ®åŒ…ï¼Œæ¯”å¦‚ ACCEPTï¼ˆå…è®¸ï¼‰ï¼ŒDROPï¼ˆä¸¢å¼ƒï¼‰ã€REJECTï¼ˆæ‹’ç»ï¼‰ã€LOGï¼ˆè®°å½•æ—¥å¿—ï¼‰ï¼›åœ¨æ“ä½œæ—¶å¦‚æœæ²¡æœ‰æŒ‡å®šä½¿ç”¨å“ªä¸ªè¡¨ï¼Œiptables é»˜è®¤ä½¿ç”¨ filter è¡¨æ¥æ‰§è¡Œæ‰€æœ‰çš„å‘½ä»¤ã€‚filter è¡¨æ ¹æ®é¢„å®šä¹‰çš„ä¸€ç»„è§„åˆ™è¿‡æ»¤ç¬¦åˆæ¡ä»¶çš„æ•°æ®åŒ…ã€‚åœ¨ filter è¡¨ä¸­åªå…è®¸å¯¹æ•°æ®åŒ…è¿›è¡Œæ¥æ”¶ã€ä¸¢å¼ƒçš„æ“ä½œï¼Œè€Œæ— æ³•å¯¹æ•°æ®åŒ…è¿›è¡Œæ›´æ”¹ã€‚</p></li><li><p>nat è¡¨ï¼š å³ Network Address Translationï¼Œä¸»è¦æ˜¯ç”¨äºç½‘ç»œåœ°å€è½¬æ¢ï¼ˆä¾‹å¦‚ï¼šç«¯å£è½¬å‘ï¼‰ï¼Œè¯¥è¡¨å¯ä»¥å®ç°ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤šç­‰ NAT å·¥ä½œï¼Œå¦‚ SNATï¼ˆä¿®æ”¹æºåœ°å€ï¼‰ã€DNATï¼ˆä¿®æ”¹ç›®çš„åœ°å€ï¼‰ã€REDIRECT é‡å®šå‘ç­‰ï¼›ã€‚</p></li><li><p>mangle è¡¨ï¼š ä¿®æ”¹åŒ…å¤´éƒ¨çš„æŸäº›ç‰¹æ®Šæ¡ç›®ï¼Œä¸»è¦ç”¨äºå¯¹æŒ‡å®šåŒ…çš„ä¼ è¾“ç‰¹æ€§è¿›è¡Œä¿®æ”¹ã€‚æŸäº›ç‰¹æ®Šåº”ç”¨å¯èƒ½éœ€è¦æ”¹å†™æ•°æ®åŒ…çš„ä¸€äº›ä¼ è¾“ç‰¹æ€§ï¼Œå¦‚ TOSã€TTLã€æ‰“ä¸Šç‰¹æ®Šæ ‡è®° MARK ç­‰ï¼Œä»¥å½±å“åé¢çš„è·¯ç”±å†³ç­–ã€‚</p></li><li><p>security è¡¨ï¼š ç”¨äºå¼ºåˆ¶è®¿é—®æ§åˆ¶ç½‘ç»œè§„åˆ™ï¼ˆä¾‹å¦‚ï¼š SELinuxï¼‰ã€‚</p></li></ul><p>è¡¨çš„å¤„ç†ä¼˜å…ˆçº§: raw &gt; mangle &gt; nat &gt; filterã€‚</p><blockquote><p>raw è¡¨é™¤äº† <code>-j NOTRACK</code> å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¸¸ç”¨çš„åŠ¨ä½œï¼Œé‚£å°±æ˜¯ <code>-j TRACE</code>ï¼Œç”¨äºè·Ÿè¸ªæ•°æ®åŒ…ï¼Œè¿›è¡Œè§„åˆ™çš„è°ƒè¯•ï¼Œä½¿ç”¨ dmesg æŸ¥çœ‹ã€‚</p><p><code>è¿æ¥è·Ÿè¸ª</code>ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯è·Ÿè¸ªå¹¶è®°å½•ç½‘ç»œè¿æ¥çš„çŠ¶æ€ï¼ˆä½ å¯èƒ½è®¤ä¸ºåªæœ‰ TCP æ‰æœ‰â€œè¿æ¥â€è¿™ä¸ªæ¦‚å¿µï¼Œä½†æ˜¯åœ¨ netfilter ä¸­ï¼ŒTCPã€UDPã€ICMP ä¸€è§†åŒä»ï¼‰ã€‚netfilter ä¼šä¸ºæ¯ä¸ªç»è¿‡ç½‘ç»œå †æ ˆçš„è¿æ¥ç”Ÿæˆä¸€ä¸ª<strong>è¿æ¥è®°å½•é¡¹ï¼ˆConnection Entryï¼‰</strong>ï¼›æ­¤åæ‰€æœ‰å±äºæ­¤è¿æ¥çš„æ•°æ®åŒ…éƒ½è¢«å”¯ä¸€åœ°åˆ†é…ç»™è¿™ä¸ªè¿æ¥å¹¶æ ‡è¯†è¿æ¥çš„çŠ¶æ€ï¼›ç”±æ‰€æœ‰è¿æ¥è®°å½•é¡¹ç»„æˆçš„è¡¨å…¶å®å°±æ˜¯æ‰€è°“çš„<strong>è¿æ¥è·Ÿè¸ªè¡¨</strong>ã€‚</p><p>ä¸ºä»€ä¹ˆéœ€è¦è¿æ¥è·Ÿè¸ªï¼Ÿå› ä¸ºå®ƒæ˜¯<strong>çŠ¶æ€é˜²ç«å¢™å’Œ NAT çš„å®ç°åŸºç¡€</strong>ï¼</p><ul><li><code>çŠ¶æ€é˜²ç«å¢™</code>ï¼šiptables çš„ conntrack/state æ¨¡å—å…è®¸æˆ‘ä»¬æ ¹æ®è¿æ¥çš„çŠ¶æ€è¿›è¡Œè§„åˆ™é…ç½®ï¼Œå¦‚æœæ²¡æœ‰è¿æ¥è·Ÿè¸ªï¼Œé‚£æ˜¯åšä¸åˆ°çš„ã€‚</li><li><code>NAT</code>ï¼ŒNAT å…¶å®å°±æ˜¯ä¿®æ”¹æ•°æ®åŒ…çš„æºåœ°å€/ç«¯å£ã€ç›®çš„åœ°å€/ç«¯å£ï¼Œå¦‚æœæ²¡æœ‰è¿æ¥è·Ÿè¸ªï¼Œé‚£ä¹ˆä¹Ÿä¸å¯èƒ½å†æ‰¾å›ä¿®æ”¹å‰çš„åœ°å€ä¿¡æ¯ã€‚</li></ul></blockquote><h4 id="äº”é“¾"><a href="#äº”é“¾" class="headerlink" title="äº”é“¾"></a>äº”é“¾</h4><p>é“¾(chains)æ˜¯æ•°æ®åŒ…ä¼ è¾“çš„è·¯å¾„ï¼Œå¯¹åº”ç€æŠ¥æ–‡å¤„ç†çš„äº”ä¸ªä¸åŒé˜¶æ®µï¼š</p><ul><li>INPUTï¼š å¤„ç†å…¥ç«™æ•°æ®åŒ…ï¼Œå½“æ¥æ”¶åˆ°è®¿é—®æœ¬æœºåœ°å€çš„æ•°æ®åŒ…(å…¥ç«™)æ—¶ï¼Œåº”ç”¨æ­¤é“¾ä¸­çš„è§„åˆ™ã€‚</li><li>OUTPUTï¼š å¤„ç†å‡ºç«™æ•°æ®åŒ…ï¼Œå½“æœ¬æœºå‘å¤–å‘é€æ•°æ®åŒ…(å‡ºç«™)æ—¶ï¼Œåº”ç”¨æ­¤é“¾ä¸­çš„è§„åˆ™ã€‚</li><li>FORWARDï¼š å¤„ç†è½¬å‘æ•°æ®åŒ…ï¼Œå½“æ¥æ”¶åˆ°éœ€è¦é€šè¿‡æœ¬æœºå‘é€ç»™å…¶ä»–åœ°å€çš„æ•°æ®åŒ…(è½¬å‘)æ—¶ï¼Œåº”ç”¨æ­¤é“¾ä¸­çš„è§„åˆ™ã€‚ï¼ˆip_forward å’Œè·¯ç”±å™¨ä¼šç”¨åˆ°ï¼‰</li><li>PREROUTINGï¼š åœ¨å¯¹æ•°æ®åŒ…ä½œè·¯ç”±é€‰æ‹©ä¹‹å‰ï¼Œåº”ç”¨æ­¤é“¾ä¸­çš„è§„åˆ™ã€‚</li><li>POSTROUTINGï¼š åœ¨å¯¹æ•°æ®åŒ…ä½œè·¯ç”±é€‰æ‹©ä¹‹åï¼Œåº”ç”¨æ­¤é“¾ä¸­çš„è§„åˆ™ã€‚</li></ul><p>å…¶ä¸­ INPUT å’Œ OUTPUT é“¾ä¸»è¦åº”ç”¨åœ¨æœ¬æœºçš„ç½‘ç»œæ§åˆ¶ä¸­ï¼Œè€Œ FORWARDã€PREROUTINGã€ POSTROUTING é“¾æ›´å¤šåœ°åº”ç”¨åœ¨å¯¹å¤–çš„ç½‘ç»œæ§åˆ¶ä¸­ï¼Œç‰¹åˆ«æ˜¯æœºå™¨ä½œä¸ºç½‘å…³ä½¿ç”¨æ—¶çš„æƒ…å†µã€‚</p><h4 id="è§„åˆ™"><a href="#è§„åˆ™" class="headerlink" title="è§„åˆ™"></a>è§„åˆ™</h4><p>æ•°æ®åŒ…çš„è¿‡æ»¤åŸºäº <strong>è§„åˆ™</strong>ï¼Œè€Œè§„åˆ™æ˜¯ç”±åŒ¹é…æ¡ä»¶å’Œå¤„ç†åŠ¨ä½œç»„æˆã€‚è§„åˆ™åˆ†åˆ«æŒ‡å®šäº†æºåœ°å€ã€ç›®çš„åœ°å€ã€ä¼ è¾“åè®®ï¼ˆå¦‚TCPã€UDPã€ICMPï¼‰å’ŒæœåŠ¡ç±»å‹ï¼ˆå¦‚HTTPã€FTPå’ŒSMTPï¼‰ç­‰ã€‚å½“æ•°æ®åŒ…ä¸è§„åˆ™åŒ¹é…æ—¶ï¼Œiptables å°±æ ¹æ®è§„åˆ™æ‰€å®šä¹‰çš„æ–¹æ³•æ¥å¤„ç†è¿™äº›æ•°æ®åŒ…ï¼Œå¦‚æ”¾è¡Œï¼ˆacceptï¼‰ã€æ‹’ç»ï¼ˆrejectï¼‰å’Œä¸¢å¼ƒï¼ˆdropï¼‰ç­‰ã€‚é…ç½®é˜²ç«å¢™çš„ä¸»è¦å·¥ä½œå°±æ˜¯æ·»åŠ ã€ä¿®æ”¹å’Œåˆ é™¤è¿™äº›è§„åˆ™ã€‚</p><p><strong>å¸¸è§çš„å¤„ç†åŠ¨ä½œï¼š</strong></p><ul><li>ACCEPTï¼š å…è®¸æ•°æ®åŒ…é€šè¿‡ã€‚</li><li>DROPï¼š ç›´æ¥ä¸¢å¼ƒæ•°æ®åŒ…ï¼Œä¸ç»™ä»»ä½•å›åº”ä¿¡æ¯ã€‚</li><li>QUEUEï¼š å°†æ•°æ®åŒ…ç§»äº¤åˆ°ç”¨æˆ·ç©ºé—´ã€‚</li><li>RETURNï¼š åœæ­¢æ‰§è¡Œå½“å‰é“¾ä¸­çš„åç»­è§„åˆ™ï¼Œå¹¶è¿”å›åˆ°è°ƒç”¨é“¾(The Calling Chain)ä¸­ã€‚</li><li>REJECTï¼š æ‹’ç»æ•°æ®åŒ…é€šè¿‡ï¼Œå¿…è¦æ—¶ä¼šç»™æ•°æ®å‘é€ç«¯ä¸€ä¸ªå“åº”çš„ä¿¡æ¯ã€‚</li><li>DNATï¼š ç›®æ ‡åœ°å€è½¬æ¢ï¼ˆdocker ç½‘ç»œä¼šç”¨åˆ°ï¼‰ã€‚</li><li>SNATï¼š æºåœ°å€è½¬æ¢ï¼Œè§£å†³å†…ç½‘ç”¨æˆ·ç”¨åŒä¸€ä¸ªå…¬ç½‘åœ°å€ä¸Šç½‘çš„é—®é¢˜ ï¼ˆdocker ç½‘ç»œä¼šç”¨åˆ°ï¼‰ã€‚</li><li>MASQUERADEï¼š æ˜¯ SNAT çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œé€‚ç”¨äºåŠ¨æ€çš„ã€ä¸´æ—¶ä¼šå˜çš„ ip ä¸Šã€‚</li><li>REDIRECTï¼š åœ¨æœ¬æœºåšç«¯å£æ˜ å°„ï¼ˆé€æ˜ä»£ç†çš„æ—¶å€™ä¼šç”¨åˆ°ï¼‰ã€‚</li><li>LOGï¼š è®°å½•æ—¥å¿—ä¿¡æ¯ï¼Œé™¤è®°å½•å¤–ä¸å¯¹æ•°æ®åŒ…åšä»»ä½•å…¶ä»–æ“ä½œï¼Œä»ç„¶åŒ¹é…ä¸‹ä¸€æ¡è§„åˆ™ã€‚</li></ul><p><strong>æ€»ä½“é¡ºåºå¦‚ä¸‹ï¼š</strong></p><p>1.å½“ä¸€ä¸ªæ•°æ®åŒ…è¿›å…¥æŸä¸ªé“¾æ—¶ï¼Œé¦–å…ˆæŒ‰ç…§è¡¨çš„ä¼˜å…ˆçº§ä¾æ¬¡å¤„ç†ï¼›<br>2.æ¯ä¸ªè¡¨ä¸­çš„è§„åˆ™éƒ½æœ‰åºå·ï¼ˆä» 1 å¼€å§‹ï¼‰ï¼Œæ•°æ®åŒ…ä¼šæ ¹æ®è§„åˆ™åºå·ä¾æ¬¡è¿›è¡ŒåŒ¹é…ï¼›<br>3.å¦‚æœå‘½ä¸­ä¸€æ¡è§„åˆ™ï¼Œåˆ™æ‰§è¡Œç›¸åº”çš„åŠ¨ä½œï¼›å¦‚æœæ‰€æœ‰è¡¨çš„è§„åˆ™éƒ½æœªå‘½ä¸­ï¼Œåˆ™æ‰§è¡Œé»˜è®¤ç­–ç•¥ã€‚</p><h3 id="å…³ç³»"><a href="#å…³ç³»" class="headerlink" title="å…³ç³»"></a>å…³ç³»</h3><p>é“¾æ˜¯è§„åˆ™çš„å®¹å™¨ï¼Œä¸€æ¡é“¾ä¸­å¯èƒ½åŒ…å«ç€ä¼—å¤šçš„è§„åˆ™ï¼Œå½“ä¸€ä¸ªæ•°æ®åŒ…åˆ°è¾¾ä¸€ä¸ªé“¾æ—¶ï¼Œiptables å°±ä¼šä»é“¾ä¸­ç¬¬ä¸€æ¡è§„åˆ™å¼€å§‹åŒ¹é…ï¼Œå¦‚æœæ»¡è¶³è¯¥è§„åˆ™çš„æ¡ä»¶ï¼Œç³»ç»Ÿå°±ä¼šæ ¹æ®è¯¥æ¡è§„åˆ™æ‰€å®šä¹‰çš„æ–¹æ³•å¤„ç†è¯¥æ•°æ®åŒ…ï¼Œå¦åˆ™å°†ç»§ç»­åŒ¹é…ä¸‹ä¸€æ¡è§„åˆ™ï¼Œå¦‚æœè¯¥æ•°æ®åŒ…ä¸ç¬¦åˆé“¾ä¸­ä»»ä¸€æ¡è§„åˆ™ï¼Œiptables å°±ä¼šæ ¹æ®è¯¥é“¾é¢„å…ˆå®šä¹‰çš„é»˜è®¤ç­–ç•¥æ¥å¤„ç†æ•°æ®åŒ…ã€‚å¯ä»¥çœ‹åˆ° iptables éå†é“¾ä¸­çš„è§„åˆ™ç®—æ³•å¤æ‚åº¦ä¸º O(n)ï¼Œå³éšç€é“¾ä¸­çš„è§„åˆ™æ•°é‡å¢å¤§è€Œå¢å¤§ã€‚è€Œä¸”ï¼Œé“¾çš„åŒ¹é…æ˜¯æœ‰é¡ºåºçš„ï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼Œåœ¨æ·»åŠ è§„åˆ™çš„æ—¶å€™ä¹Ÿè¦ä¸»è¦é¡ºåºï¼Œæé”™äº†å°±å¯èƒ½å¯¼è‡´ç³»ç»Ÿæ‰€æœ‰æµé‡éƒ½æ— æ³•è¿›å…¥ã€‚</p><h4 id="Filter-è¡¨"><a href="#Filter-è¡¨" class="headerlink" title="Filter è¡¨"></a>Filter è¡¨</h4><p>Filter è¡¨æ˜¯ iptables çš„é»˜è®¤è¡¨ï¼Œå› æ­¤å¦‚æœæ²¡æœ‰æŒ‡å®šè¡¨ï¼Œé‚£ä¹ˆé»˜è®¤æ“ä½œçš„æ˜¯ filter è¡¨ï¼Œå…¶åŒ…å«ä»¥ä¸‹ä¸‰ç§å†…å»ºé“¾ï¼š</p><ul><li>INPUT é“¾ï¼šå¤„ç†æ¥è‡ªå¤–éƒ¨çš„æ•°æ®</li><li>OUTPUT é“¾ï¼šå¤„ç†å‘å¤–å‘é€çš„æ•°æ®</li><li>FORWARD é“¾ï¼šå°†æ•°æ®è½¬å‘åˆ°æœ¬æœºçš„å…¶ä»–ç½‘å¡è®¾å¤‡ä¸Š</li></ul><h4 id="NAT-è¡¨"><a href="#NAT-è¡¨" class="headerlink" title="NAT è¡¨"></a>NAT è¡¨</h4><ul><li><p>PREROUTING é“¾ï¼šå¤„ç†åˆšåˆ°è¾¾æœ¬æœºå¹¶åœ¨è·¯ç”±è½¬å‘å‰çš„æ•°æ®åŒ…ã€‚å®ƒä¼šè½¬æ¢æ•°æ®åŒ…ä¸­çš„ç›®æ ‡ IP åœ°å€ï¼ˆdestination ip addressï¼‰ï¼Œé€šå¸¸ç”¨äº DNAT(destination NAT)</p></li><li><p>POSTROUTING é“¾ï¼šå¤„ç†å³å°†ç¦»å¼€æœ¬æœºçš„æ•°æ®åŒ…ã€‚å®ƒä¼šè½¬æ¢æ•°æ®åŒ…ä¸­çš„æº IP åœ°å€ï¼ˆsource ip addressï¼‰ï¼Œé€šå¸¸ç”¨äº SNATï¼ˆsource NATï¼‰</p></li><li><p>OUTPUT é“¾ï¼šå¤„ç†æœ¬æœºå‘å‡ºçš„æ•°æ®åŒ…</p></li></ul><h4 id="Mangle-è¡¨"><a href="#Mangle-è¡¨" class="headerlink" title="Mangle è¡¨"></a>Mangle è¡¨</h4><p>Mangle è¡¨åŒ…å«äº”ç§å†…å»ºé“¾ï¼šPREROUTINGã€OUTPUTã€FORWARDã€INPUTã€POSTROUTINGã€‚</p><h4 id="Raw-è¡¨"><a href="#Raw-è¡¨" class="headerlink" title="Raw è¡¨"></a>Raw è¡¨</h4><p>å«ä¸¤ä¸ªå†…å»ºé“¾ï¼šPREROUTING, OUTPUT.</p><h3 id="æ•°æ®åŒ…æµç¨‹"><a href="#æ•°æ®åŒ…æµç¨‹" class="headerlink" title="æ•°æ®åŒ…æµç¨‹"></a>æ•°æ®åŒ…æµç¨‹</h3><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/sourchttps://cdn.jsdelivr.net/gh/muzi502/blog/source/img/iptables.png" alt="img"></p><p>åœ¨ Linux ä¸‹ï¼Œä»ä»»ä½•ç½‘ç»œç«¯å£è¿›æ¥çš„æ¯ä¸€ä¸ª IP æ•°æ®åŒ…éƒ½è¦ä»ä¸Šåˆ°ä¸‹çš„ç©¿è¿‡è¿™å¼ å›¾ï¼Œiptabales å¯¹ä»ä»»ä½•ç«¯å£è¿›å…¥çš„æ•°æ®åŒ…éƒ½ä¼šé‡‡å–ç›¸åŒçš„å¤„ç†æ–¹å¼ã€‚</p><p>æ­¤å›¾æ‘˜è‡ª <a href="https://wiki.archlinux.org/index.php/Iptables" target="_blank" rel="noopener">Archlinux æ–‡æ¡£</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">                               XXXXXXXXXXXXXXXXXX</span><br><span class="line">                             XXX     Network    XXX</span><br><span class="line">                               XXXXXXXXXXXXXXXXXX</span><br><span class="line">                                       +</span><br><span class="line">                                       |</span><br><span class="line">                                       v</span><br><span class="line"> +-------------+              +------------------+</span><br><span class="line"> |table: filter| &lt;---+        | table: nat       |</span><br><span class="line"> |chain: INPUT |     |        | chain: PREROUTING|</span><br><span class="line"> +-----+-------+     |        +--------+---------+</span><br><span class="line">       |             |                 |</span><br><span class="line">       v             |                 v</span><br><span class="line"> [local process]     |           ****************          +--------------+</span><br><span class="line">       |             +---------+ Routing decision +------&gt; |table: filter |</span><br><span class="line">       v                         ****************          |chain: FORWARD|</span><br><span class="line">****************                                           +------+-------+</span><br><span class="line">Routing decision                                                  |</span><br><span class="line">****************                                                  |</span><br><span class="line">       |                                                          |</span><br><span class="line">       v                        ****************                  |</span><br><span class="line">+-------------+       +------&gt;  Routing decision  &lt;---------------+</span><br><span class="line">|table: nat   |       |         ****************</span><br><span class="line">|chain: OUTPUT|       |               +</span><br><span class="line">+-----+-------+       |               |</span><br><span class="line">      |               |               v</span><br><span class="line">      v               |      +-------------------+</span><br><span class="line">+--------------+      |      | table: nat        |</span><br><span class="line">|table: filter | +----+      | chain: POSTROUTING|</span><br><span class="line">|chain: OUTPUT |             +--------+----------+</span><br><span class="line">+--------------+                      |</span><br><span class="line">                                      v</span><br><span class="line">                               XXXXXXXXXXXXXXXXXX</span><br><span class="line">                             XXX    Network     XXX</span><br><span class="line">                               XXXXXXXXXXXXXXXXXX</span><br></pre></td></tr></table></figure><h3 id="éå†é“¾æµç¨‹å›¾"><a href="#éå†é“¾æµç¨‹å›¾" class="headerlink" title="éå†é“¾æµç¨‹å›¾"></a>éå†é“¾æµç¨‹å›¾</h3><p>è¯¥æµç¨‹å›¾æè¿°é“¾äº†åœ¨ä»»ä½•æ¥å£ä¸Šæ”¶åˆ°çš„ç½‘ç»œæ•°æ®åŒ…æ˜¯æŒ‰ç…§æ€æ ·çš„é¡ºåºç©¿è¿‡è¡¨çš„äº¤é€šç®¡åˆ¶é“¾ã€‚</p><p><img src="https://www.frozentux.net/iptables-tutorial/chunkyhtml/images/tables_traverse.jpg" alt="tables_traverse"></p><ul><li><p>ç¬¬ä¸€ä¸ªè·¯ç”±ç­–ç•¥åŒ…æ‹¬å†³å®šæ•°æ®åŒ…çš„ç›®çš„åœ°æ˜¯æœ¬åœ°ä¸»æœºï¼ˆè¿™ç§æƒ…å†µä¸‹ï¼Œæ•°æ®åŒ…ç©¿è¿‡ INPUT é“¾ï¼‰ï¼Œè¿˜æ˜¯å…¶ä»–ä¸»æœºï¼ˆæ•°æ®åŒ…ç©¿è¿‡ FORWARD é“¾ï¼‰ï¼›</p></li><li><p>ä¸­é—´çš„è·¯ç”±ç­–ç•¥åŒ…æ‹¬å†³å®šç»™ä¼ å‡ºçš„æ•°æ®åŒ…ä½¿ç”¨é‚£ä¸ªæºåœ°å€ã€åˆ†é…å“ªä¸ªæ¥å£ï¼›</p></li><li><p>æœ€åä¸€ä¸ªè·¯ç”±ç­–ç•¥å­˜åœ¨æ˜¯å› ä¸ºå…ˆå‰çš„ mangle ä¸ nat é“¾å¯èƒ½ä¼šæ”¹å˜æ•°æ®åŒ…çš„è·¯ç”±ä¿¡æ¯ã€‚</p></li></ul><p>æ•°æ®åŒ…é€šè¿‡è·¯å¾„ä¸Šçš„æ¯ä¸€æ¡é“¾æ—¶ï¼Œé“¾ä¸­çš„æ¯ä¸€æ¡è§„åˆ™æŒ‰é¡ºåºåŒ¹é…ï¼›æ— è®ºä½•æ—¶åŒ¹é…äº†ä¸€æ¡è§„åˆ™ï¼Œç›¸åº”çš„ target/jump åŠ¨ä½œå°†ä¼šæ‰§è¡Œã€‚æœ€å¸¸ç”¨çš„3ä¸ª target æ˜¯ ACCEPT, DROP ,æˆ–è€… jump åˆ°ç”¨æˆ·è‡ªå®šä¹‰çš„é“¾ã€‚å†…ç½®çš„é“¾æœ‰é»˜è®¤çš„ç­–ç•¥ï¼Œä½†æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„é“¾æ²¡æœ‰é»˜è®¤çš„ç­–ç•¥ã€‚åœ¨ jump åˆ°çš„é“¾ä¸­ï¼Œè‹¥æ¯ä¸€æ¡è§„åˆ™éƒ½ä¸èƒ½æä¾›å®Œå…¨åŒ¹é…ï¼Œé‚£ä¹ˆæ•°æ®åŒ…åƒè¿™å¼ å›¾ç‰‡æè¿°çš„ä¸€æ ·è¿”å›åˆ°è°ƒç”¨é“¾ã€‚åœ¨ä»»ä½•æ—¶å€™ï¼Œè‹¥ DROP target çš„è§„åˆ™å®ç°å®Œå…¨åŒ¹é…ï¼Œé‚£ä¹ˆè¢«åŒ¹é…çš„æ•°æ®åŒ…ä¼šè¢«ä¸¢å¼ƒï¼Œä¸ä¼šè¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚å¦‚æœä¸€ä¸ªæ•°æ®åŒ…åœ¨é“¾ä¸­è¢« ACCEPTï¼Œé‚£ä¹ˆå®ƒä¹Ÿä¼šè¢«æ‰€æœ‰çš„çˆ¶é“¾ ACCEPTï¼Œå¹¶ä¸”ä¸å†éå†å…¶ä»–çˆ¶é“¾ã€‚ç„¶è€Œï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œæ•°æ®åŒ…è¿˜ä¼šä»¥æ­£å¸¸çš„æ–¹å¼ç»§ç»­éå†å…¶ä»–è¡¨ä¸­çš„å…¶ä»–é“¾ã€‚</p><h4 id="æœ¬æœºå‘å‡ºçš„åŒ…"><a href="#æœ¬æœºå‘å‡ºçš„åŒ…" class="headerlink" title="æœ¬æœºå‘å‡ºçš„åŒ…"></a>æœ¬æœºå‘å‡ºçš„åŒ…</h4><p>æœ¬æœºè¿›ç¨‹ -&gt; OUTPUT é“¾ -&gt; è·¯ç”±é€‰æ‹© -&gt; POSTROUTING é“¾ -&gt; å‡ºå£ç½‘å¡</p><h4 id="æœ¬æœºæ”¶åˆ°çš„åŒ…"><a href="#æœ¬æœºæ”¶åˆ°çš„åŒ…" class="headerlink" title="æœ¬æœºæ”¶åˆ°çš„åŒ…"></a>æœ¬æœºæ”¶åˆ°çš„åŒ…</h4><p>å…¥å£ç½‘å¡ -&gt; PREROUTING é“¾ -&gt; è·¯ç”±é€‰æ‹© -&gt; æ­¤æ—¶æœ‰ä¸¤ç§å¯èƒ½çš„æƒ…å†µï¼š</p><ul><li>ç›®çš„åœ°å€ä¸ºæœ¬æœºï¼šINPUT é“¾ -&gt; æœ¬æœºè¿›ç¨‹</li><li>ç›®çš„åœ°å€ä¸ä¸ºæœ¬æœºï¼šFORWARD é“¾ -&gt; POSTROUTING é“¾ -&gt; ç½‘å¡å‡ºå£ï¼ˆå†…æ ¸å…è®¸ç½‘å¡è½¬å‘çš„æƒ…å†µä¸‹ï¼‰</li></ul><h2 id="iptables-å®æˆ˜"><a href="#iptables-å®æˆ˜" class="headerlink" title="iptables å®æˆ˜"></a>iptables å®æˆ˜</h2><p>iptables [-t è¡¨] å‘½ä»¤é€‰é¡¹ [é“¾] [åŒ¹é…é€‰é¡¹] [æ“ä½œé€‰é¡¹]</p><h3 id="å‘½ä»¤é€‰é¡¹"><a href="#å‘½ä»¤é€‰é¡¹" class="headerlink" title="å‘½ä»¤é€‰é¡¹"></a>å‘½ä»¤é€‰é¡¹</h3><table><thead><tr><th align="left">é€‰é¡¹å</th><th align="left">åŠŸèƒ½åŠç‰¹ç‚¹</th></tr></thead><tbody><tr><td align="left">-A â€“append</td><td align="left">åœ¨æŒ‡å®šé“¾çš„æœ«å°¾æ·»åŠ ä¸€æ¡æ–°çš„è§„åˆ™</td></tr><tr><td align="left">-D â€“delete</td><td align="left">åˆ é™¤æŒ‡å®šé“¾ä¸­çš„æŸä¸€æ¡è§„åˆ™ï¼ŒæŒ‰è§„åˆ™åºå·æˆ–å†…å®¹ç¡®å®šè¦åˆ é™¤çš„è§„åˆ™</td></tr><tr><td align="left">-I â€“insert</td><td align="left">åœ¨æŒ‡å®šé“¾ä¸­æ’å…¥ä¸€æ¡æ–°çš„è§„åˆ™ï¼Œé»˜è®¤åœ¨é“¾çš„å¼€å¤´æ’å…¥</td></tr><tr><td align="left">-R â€“replace</td><td align="left">ä¿®æ”¹ã€æ›¿æ¢æŒ‡å®šé“¾ä¸­çš„ä¸€æ¡è§„åˆ™ï¼ŒæŒ‰è§„åˆ™åºå·æˆ–å†…å®¹ç¡®å®š</td></tr><tr><td align="left">-F â€“flush</td><td align="left">æ¸…ç©ºæŒ‡å®šé“¾ä¸­çš„æ‰€æœ‰è§„åˆ™ï¼Œé»˜è®¤æ¸…ç©ºè¡¨ä¸­æ‰€æœ‰é“¾çš„å†…å®¹</td></tr><tr><td align="left">-N â€“new</td><td align="left">æ–°å»ºä¸€æ¡ç”¨æˆ·è‡ªå·±å®šä¹‰çš„è§„åˆ™é“¾</td></tr><tr><td align="left">-X â€“delete-chain</td><td align="left">åˆ é™¤æŒ‡å®šè¡¨ä¸­ç”¨æˆ·è‡ªå®šä¹‰çš„è§„åˆ™é“¾</td></tr><tr><td align="left">-P â€“policy</td><td align="left">è®¾ç½®æŒ‡å®šé“¾çš„é»˜è®¤ç­–ç•¥</td></tr><tr><td align="left">-F, â€“flush</td><td align="left">æ¸…ç©ºæŒ‡å®šé“¾ä¸Šé¢çš„æ‰€æœ‰è§„åˆ™ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šé“¾ï¼Œæ¸…ç©ºè¡¨ä¸Šæ‰€æœ‰é“¾çš„æ‰€æœ‰è§„åˆ™</td></tr><tr><td align="left">-Z, â€“zero</td><td align="left">æŠŠæŒ‡å®šé“¾æˆ–è¡¨ä¸­çš„æ‰€æœ‰é“¾ä¸Šçš„æ‰€æœ‰è®¡æ•°å™¨æ¸…é›¶</td></tr><tr><td align="left">-L â€“list</td><td align="left">åˆ—å‡ºæŒ‡å®šé“¾ä¸­çš„æ‰€æœ‰çš„è§„åˆ™è¿›è¡ŒæŸ¥çœ‹ï¼Œé»˜è®¤åˆ—å‡ºè¡¨ä¸­æ‰€æœ‰é“¾çš„å†…å®¹</td></tr><tr><td align="left">-S â€“list-rules</td><td align="left">ä»¥åŸå§‹æ ¼å¼åˆ—å‡ºé“¾ä¸­æ‰€æœ‰è§„åˆ™</td></tr><tr><td align="left">-v â€“verbose</td><td align="left">æŸ¥çœ‹è§„åˆ™åˆ—è¡¨æ—¶æ˜¾ç¤ºè¯¦ç»†çš„ä¿¡æ¯</td></tr><tr><td align="left">-n â€“numeric</td><td align="left">ç”¨æ•°å­—å½¢å¼æ˜¾ç¤ºè¾“å‡ºç»“æœï¼Œå¦‚æ˜¾ç¤ºä¸»æœºçš„ IP åœ°å€è€Œä¸æ˜¯ä¸»æœºå</td></tr><tr><td align="left">â€“line-number</td><td align="left">æŸ¥çœ‹è§„åˆ™åˆ—è¡¨æ—¶ï¼ŒåŒæ—¶æ˜¾ç¤ºè§„åˆ™åœ¨é“¾ä¸­çš„é¡ºåºå·</td></tr></tbody></table><h3 id="åŒ¹é…é€‰é¡¹"><a href="#åŒ¹é…é€‰é¡¹" class="headerlink" title="åŒ¹é…é€‰é¡¹"></a>åŒ¹é…é€‰é¡¹</h3><table><thead><tr><th align="left">é€‰é¡¹å</th><th align="left">åŠŸèƒ½åŠç‰¹ç‚¹</th></tr></thead><tbody><tr><td align="left">-i â€“in-interface</td><td align="left">åŒ¹é…è¾“å…¥æ¥å£ï¼Œå¦‚ eth0ï¼Œeth1</td></tr><tr><td align="left">-o â€“out-interface</td><td align="left">åŒ¹é…è¾“å‡ºæ¥å£</td></tr><tr><td align="left">-p â€“proto</td><td align="left">åŒ¹é…åè®®ç±»å‹ï¼Œå¦‚ TCPã€UDP å’Œ ICMPç­‰</td></tr><tr><td align="left">-s â€“source</td><td align="left">åŒ¹é…çš„æºåœ°å€</td></tr><tr><td align="left">â€“sport</td><td align="left">åŒ¹é…çš„æºç«¯å£å·</td></tr><tr><td align="left">-d â€“destination</td><td align="left">åŒ¹é…çš„ç›®çš„åœ°å€</td></tr><tr><td align="left">â€“dport</td><td align="left">åŒ¹é…çš„ç›®çš„ç«¯å£å·</td></tr><tr><td align="left">-m â€“match</td><td align="left">åŒ¹é…è§„åˆ™æ‰€ä½¿ç”¨çš„è¿‡æ»¤æ¨¡å—</td></tr></tbody></table><h3 id="æ“ä½œé€‰é¡¹"><a href="#æ“ä½œé€‰é¡¹" class="headerlink" title="æ“ä½œé€‰é¡¹"></a>æ“ä½œé€‰é¡¹</h3><p> ä¸€èˆ¬ä¸º <code>-j å¤„ç†åŠ¨ä½œ</code> çš„å½¢å¼ï¼Œå¤„ç†åŠ¨ä½œåŒ…æ‹¬ ACCEPTã€DROPã€RETURNã€REJECTã€DNATã€SNAT ç­‰ã€‚ä¸åŒçš„å¤„ç†åŠ¨ä½œå¯èƒ½è¿˜æœ‰é¢å¤–çš„é€‰é¡¹å‚æ•°ï¼Œå¦‚æŒ‡å®š DNATã€SNAT åŠ¨ä½œåˆ™è¿˜éœ€æŒ‡å®š <code>--to</code> å‚æ•°ç”¨ä»¥è¯´æ˜è¦è£…æ¢çš„åœ°å€ï¼ŒæŒ‡å®š REDIRECT åŠ¨ä½œåˆ™éœ€æŒ‡å®š â€“to-ports å‚æ•°ç”¨äºè¯´æ˜è¦è·³è½¬çš„ç«¯å£ã€‚</p><table><thead><tr><th>æ“ä½œå</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>ACCEPT</td><td>å…è®¸æ•°æ®åŒ…é€šè¿‡</td></tr><tr><td>DROP</td><td>ç›´æ¥ä¸¢å¼ƒæ•°æ®åŒ…ï¼Œä¸ç»™ä»»ä½•å›åº”ä¿¡æ¯</td></tr><tr><td>QUEUE</td><td>å°†æ•°æ®åŒ…ç§»äº¤åˆ°ç”¨æˆ·ç©ºé—´</td></tr><tr><td>RETURN</td><td>åœæ­¢æ‰§è¡Œå½“å‰é“¾ä¸­çš„åç»­è§„åˆ™ï¼Œå¹¶è¿”å›åˆ°è°ƒç”¨é“¾(The Calling Chain)ä¸­</td></tr><tr><td>REJECT</td><td>æ‹’ç»æ•°æ®åŒ…é€šè¿‡ï¼Œå¿…è¦æ—¶ä¼šç»™æ•°æ®å‘é€ç«¯ä¸€ä¸ªå“åº”çš„ä¿¡æ¯</td></tr><tr><td>DNAT</td><td>è¿›è¡Œç›®æ ‡åœ°å€è½¬æ¢</td></tr><tr><td>SNAT</td><td>æºåœ°å€è½¬æ¢ï¼Œè§£å†³å†…ç½‘ç”¨æˆ·ç”¨åŒä¸€ä¸ªå…¬ç½‘åœ°å€ä¸Šç½‘çš„é—®é¢˜</td></tr><tr><td>MASQUERADE</td><td>æ˜¯ SNAT çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œé€‚ç”¨äºåŠ¨æ€çš„ã€ä¸´æ—¶ä¼šå˜çš„ ip ä¸Š</td></tr><tr><td>REDIRECT</td><td>åœ¨æœ¬æœºåšç«¯å£æ˜ å°„</td></tr><tr><td>LOG</td><td>è®°å½•æ—¥å¿—ä¿¡æ¯ï¼Œé™¤è®°å½•å¤–ä¸å¯¹æ•°æ®åŒ…åšä»»ä½•å…¶ä»–æ“ä½œï¼Œä»ç„¶åŒ¹é…ä¸‹ä¸€æ¡è§„åˆ™</td></tr></tbody></table><h3 id="å‘½ä»¤è¯¦è§£"><a href="#å‘½ä»¤è¯¦è§£" class="headerlink" title="å‘½ä»¤è¯¦è§£"></a>å‘½ä»¤è¯¦è§£</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### å‘½ä»¤ç”¨æ³• (man æ–‡æ¡£)</span></span><br><span class="line">iptables [-t table] &#123;-A|-C|-D&#125; chain rule-specification         <span class="comment"># (ipv4) è¿½åŠ |æ£€æŸ¥|åˆ é™¤ è§„åˆ™</span></span><br><span class="line">ip6tables [-t table] &#123;-A|-C|-D&#125; chain rule-specification        <span class="comment"># (ipv6) è¿½åŠ |æ£€æŸ¥|åˆ é™¤ è§„åˆ™</span></span><br><span class="line">iptables [-t table] -I chain [rulenum] rule-specification       <span class="comment"># åœ¨ rulenum å¤„æ’å…¥è§„åˆ™ (é»˜è®¤ä¸º 1)</span></span><br><span class="line">iptables [-t table] -R chain rulenum rule-specification         <span class="comment"># æ›¿æ¢ç¬¬ rulenum æ¡è§„åˆ™</span></span><br><span class="line">iptables [-t table] -D chain rulenum                            <span class="comment"># åˆ é™¤ç¬¬ rulenum æ¡è§„åˆ™</span></span><br><span class="line">iptables [-t table] -S [chain [rulenum]]                        <span class="comment"># æ‰“å°æŒ‡å®š table çš„è§„åˆ™</span></span><br><span class="line">iptables [-t table] &#123;-F|-L|-Z&#125; [chain [rulenum]] [options...]   <span class="comment"># æ¸…ç©º|åˆ—å‡º|ç½®é›¶ é“¾/è§„åˆ™</span></span><br><span class="line">iptables [-t table] -P chain target                             <span class="comment"># è®¾ç½®é»˜è®¤ç­–ç•¥</span></span><br><span class="line">iptables [-t table] -N chain                                    <span class="comment"># æ–°å»ºè‡ªå®šä¹‰é“¾</span></span><br><span class="line">iptables [-t table] -X [chain]                                  <span class="comment"># åˆ é™¤è‡ªå®šä¹‰é“¾</span></span><br><span class="line">iptables [-t table] -E old-chain-name new-chain-name            <span class="comment"># é‡å‘½åè‡ªå®šä¹‰é“¾</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### ä¸€èˆ¬å½¢å¼</span></span><br><span class="line">iptables [-t è¡¨å] &#123;-A|I|D|R&#125; é“¾å [è§„åˆ™å·] åŒ¹é…è§„åˆ™ -j åŠ¨ä½œ</span><br><span class="line"></span><br><span class="line"><span class="comment">### æŸ¥çœ‹å¸®åŠ©</span></span><br><span class="line">iptables --<span class="built_in">help</span>             <span class="comment"># æŸ¥çœ‹ iptables çš„å¸®åŠ©</span></span><br><span class="line">iptables -m æ¨¡å—å --<span class="built_in">help</span>   <span class="comment"># æŸ¥çœ‹æŒ‡å®šæ¨¡å—çš„å¯ç”¨å‚æ•°</span></span><br><span class="line">iptables -j åŠ¨ä½œå --<span class="built_in">help</span>   <span class="comment"># æŸ¥çœ‹æŒ‡å®šåŠ¨ä½œçš„å¯ç”¨å‚æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### æŒä¹…åŒ–è§„åˆ™</span></span><br><span class="line"><span class="comment"># åœ¨ RHEL/CentOS ä¸­ï¼Œé»˜è®¤è§„åˆ™æ–‡ä»¶ä¸º /etc/sysconfig/iptables</span></span><br><span class="line"><span class="comment"># åœ¨ iptables æœåŠ¡å¯åŠ¨æ—¶ï¼Œé»˜è®¤ä¼šåŠ è½½è¯¥é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„è§„åˆ™</span></span><br><span class="line"><span class="comment"># å¦‚æœæƒ³è¦è®¾ç½®çš„è§„åˆ™åœ¨é‡å¯åæœ‰æ•ˆï¼Œå°±éœ€è¦ä¿å­˜è§„åˆ™åˆ°è¿™ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨è¿™ä¸¤ä¸ªå·¥å…·ï¼šiptables-saveã€iptables-restore é‡å®šå‘å³å¯</span></span><br><span class="line"><span class="comment">## ä¿å­˜å½“å‰è§„åˆ™</span></span><br><span class="line">iptables-save &gt;/etc/sysconfig/iptables</span><br><span class="line">iptables-save &gt;/etc/sysconfig/iptables.20171125</span><br><span class="line"><span class="comment">## æ¢å¤å½“å‰è§„åˆ™</span></span><br><span class="line">iptables-restore &lt;/etc/sysconfig/iptables</span><br><span class="line">iptables-restore &lt;/etc/sysconfig/iptables.20171125</span><br><span class="line"></span><br><span class="line"><span class="comment">### å‘½ä»¤å’Œé€‰é¡¹</span></span><br><span class="line">-t              <span class="comment"># æŒ‡å®šè¦æ“ä½œçš„è¡¨ï¼Œå¦‚æœçœç•¥åˆ™é»˜è®¤ä¸º filter è¡¨</span></span><br><span class="line">-A              <span class="comment"># "è¿½åŠ " ä¸€æ¡è§„åˆ™ï¼Œåªèƒ½è¿½åŠ åˆ°æœ«å°¾</span></span><br><span class="line">-I              <span class="comment"># "æ’å…¥" ä¸€æ¡è§„åˆ™ï¼Œå¦‚æœçœç•¥åºå·åˆ™é»˜è®¤ä¸º 1</span></span><br><span class="line">-R              <span class="comment"># "æ›¿æ¢" ä¸€æ¡è§„åˆ™ï¼Œå¿…é¡»æŒ‡å®šåºå·</span></span><br><span class="line">-D              <span class="comment"># "åˆ é™¤" ä¸€æ¡è§„åˆ™ï¼Œå¿…é¡»æŒ‡å®šåºå·</span></span><br><span class="line">-C              <span class="comment"># "æ£€æŸ¥" è§„åˆ™æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å› 0</span></span><br><span class="line">-P              <span class="comment"># è®¾ç½®é“¾çš„ "é»˜è®¤ç­–ç•¥"ï¼Œnat è¡¨ä¸å…è®¸ä¿®æ”¹é»˜è®¤ç­–ç•¥</span></span><br><span class="line">-S              <span class="comment"># "æŸ¥çœ‹" è§„åˆ™ï¼ˆåŸå§‹æ ¼å¼ï¼‰</span></span><br><span class="line">-L              <span class="comment"># "æ‰“å°" è§„åˆ™ï¼ˆå‹å¥½æ ¼å¼ï¼‰</span></span><br><span class="line">-F              <span class="comment"># æ¸…ç©ºè¡¨ä¸­çš„è§„åˆ™å¹¶å°†åŒ…è®¡æ•°å™¨ã€å­—èŠ‚è®¡æ•°å™¨ç½®é›¶</span></span><br><span class="line">-Z              <span class="comment"># å°†æŸä¸ªé“¾æˆ–æŸæ¡è§„åˆ™çš„åŒ…è®¡æ•°å™¨ã€å­—èŠ‚è®¡æ•°å™¨ç½®é›¶</span></span><br><span class="line">-N              <span class="comment"># æ–°å»ºè‡ªå®šä¹‰é“¾</span></span><br><span class="line">-X              <span class="comment"># åˆ é™¤è‡ªå®šä¹‰é“¾</span></span><br><span class="line">-E              <span class="comment"># é‡å‘½åè‡ªå®šä¹‰é“¾</span></span><br><span class="line">-n              <span class="comment"># ä»¥æ•°å­—å½¢å¼æ˜¾ç¤ºåœ°å€å’Œç«¯å£</span></span><br><span class="line">-v              <span class="comment"># åœ¨æ‰“å°è§„åˆ™æ—¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">--line-numbers  <span class="comment"># åœ¨æ‰“å°è§„åˆ™æ—¶æ˜¾ç¤ºè§„åˆ™åºå·</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### åå‘åŒ¹é…</span></span><br><span class="line"><span class="comment"># åªéœ€åœ¨é€‰é¡¹å‰é¢ä½¿ç”¨ ! å³å¯ï¼Œå¦‚: ! -s 192.168.0.0/16 è¡¨ç¤ºé™¤ 192.168/16 å¤–çš„æº IP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### é€šç”¨åŒ¹é…</span></span><br><span class="line">-s addr[/mask][...] <span class="comment"># æº IPï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œä½¿ç”¨é€—å·éš”å¼€ï¼Œæœ‰å¤šå°‘ä¸ªåœ°å€å°±æœ‰å¤šå°‘æ¡è§„åˆ™</span></span><br><span class="line">-d addr[/mask][...] <span class="comment"># ç›®çš„ IPï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œä½¿ç”¨é€—å·éš”å¼€ï¼Œæœ‰å¤šå°‘ä¸ªåœ°å€å°±æœ‰å¤šå°‘æ¡è§„åˆ™</span></span><br><span class="line">-i input-nic[+]     <span class="comment"># æ•°æ®åŒ…æ¥è‡ªå“ªä¸ªç½‘å¡ï¼Œ+ è¡¨ç¤ºé€šé…ç¬¦</span></span><br><span class="line">-o output-nic[+]    <span class="comment"># æ•°æ®åŒ…é€å¾€å“ªä¸ªç½‘å¡ï¼Œ+ è¡¨ç¤ºé€šé…ç¬¦</span></span><br><span class="line">-p &#123;tcp|udp|udplite|icmp|icmpv6|esp|ah|sctp|mh|all&#125;</span><br><span class="line">                    <span class="comment"># æŒ‡å®šåŒ¹é…çš„åè®®ï¼Œall è¡¨ç¤ºæ‰€æœ‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### éšå¼æ‰©å±•åŒ¹é… (tcp/udp/icmp)</span></span><br><span class="line"><span class="comment">## tcp æ‰©å±•</span></span><br><span class="line">--sport port[:port]     <span class="comment"># æºç«¯å£å·ï¼Œ100:200 è¡¨ç¤ºç«¯å£èŒƒå›´</span></span><br><span class="line">--dport port[:port]     <span class="comment"># ç›®çš„ç«¯å£å·ï¼Œ100:200 è¡¨ç¤ºç«¯å£èŒƒå›´</span></span><br><span class="line">--tcp-flags mask comp   <span class="comment"># TCP æ ‡å¿—ä½ï¼Œflags=&#123;SYN|ACK|FIN|RST|URG|PSH|ALL|NONE&#125;</span></span><br><span class="line">--syn                   <span class="comment"># SYN æ ‡å¿—ä½ï¼Œç­‰åŒäº --tcp-flags SYN,RST,ACK,FIN SYN</span></span><br><span class="line">--tcp-option number     <span class="comment"># TCP é€‰é¡¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## udp æ‰©å±•</span></span><br><span class="line">--sport port[:port]     <span class="comment"># æºç«¯å£å·</span></span><br><span class="line">--dport port[:port]     <span class="comment"># ç›®çš„ç«¯å£å·</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## icmp æ‰©å±•</span></span><br><span class="line">--icmp-type name[/code] <span class="comment"># icmp ç±»å‹ï¼Œå¸¸ç”¨çš„ä¸¤ä¸ª: pingã€pongï¼Œè¯·æ±‚å’Œåº”ç­”</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### æ˜¾å¼æ‰©å±•åŒ¹é… (-m module-name)</span></span><br><span class="line"><span class="comment">## multiport å¤šç«¯å£</span></span><br><span class="line">--sports port[,port:port,port...]   <span class="comment"># åŒ¹é…å¤šä¸ªæºç«¯å£[èŒƒå›´]</span></span><br><span class="line">--dports port[,port:port,port...]   <span class="comment"># åŒ¹é…å¤šä¸ªç›®çš„ç«¯å£[èŒƒå›´]</span></span><br><span class="line">--ports port[,port:port,port...]    <span class="comment"># åŒ¹é…å¤šä¸ªæºå’Œç›®çš„ç«¯å£[èŒƒå›´]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## owner æ‰€å±ç”¨æˆ·(ç»„)</span></span><br><span class="line">--uid-owner userid[-userid]     <span class="comment"># åŒ¹é… UID[èŒƒå›´]/username</span></span><br><span class="line">--gid-owner groupid[-groupid]   <span class="comment"># åŒ¹é… GID[èŒƒå›´]/groupname</span></span><br><span class="line">--socket-exists                 <span class="comment"># åŒ¹é…ä¸å¥—æ¥å­—ç›¸å…³è”çš„æ•°æ®åŒ…</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## state è¿æ¥çŠ¶æ€(åŸºæœ¬)</span></span><br><span class="line">--state [INVALID|ESTABLISHED|NEW|RELATED|UNTRACKED][,...]</span><br><span class="line"><span class="comment"># NEW           æ–°è¿æ¥</span></span><br><span class="line"><span class="comment"># ESTABLISHED   å·²å»ºç«‹çš„è¿æ¥</span></span><br><span class="line"><span class="comment"># RELATED       å…³è”çš„è¿æ¥ï¼Œå¦‚ ftp</span></span><br><span class="line"><span class="comment"># INVALID       æ— æ•ˆ/éæ³•çš„è¿æ¥</span></span><br><span class="line"><span class="comment"># UNTRACKED     æœªå¯ç”¨è¿æ¥è·Ÿè¸ªçš„è¿æ¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## conntrack è¿æ¥çŠ¶æ€</span></span><br><span class="line">--ctstate &#123;INVALID|ESTABLISHED|NEW|RELATED|UNTRACKED|SNAT|DNAT&#125;[,...]</span><br><span class="line"></span><br><span class="line"><span class="comment">## iprange IPèŒƒå›´</span></span><br><span class="line">--src-range ip[-ip]     <span class="comment"># åŒ¹é…æŒ‡å®šçš„æº IP èŒƒå›´</span></span><br><span class="line">--dst-range ip[-ip]     <span class="comment"># åŒ¹é…æŒ‡å®šçš„ç›®çš„ IP èŒƒå›´</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## mac æºMACåœ°å€</span></span><br><span class="line">--mac-source XX:XX:XX:XX:XX:XX  <span class="comment"># åŒ¹é…æº MAC åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## addrtype åœ°å€ç±»å‹</span></span><br><span class="line">--src-type <span class="built_in">type</span>[,...]   <span class="comment"># åŒ¹é… source ip åœ°å€çš„ç±»å‹</span></span><br><span class="line">--dst-type <span class="built_in">type</span>[,...]   <span class="comment"># åŒ¹é… destination ip åœ°å€çš„ç±»å‹</span></span><br><span class="line"><span class="comment"># UNSPEC       æœªæŒ‡å®šçš„åœ°å€ï¼Œå¦‚ 0.0.0.0</span></span><br><span class="line"><span class="comment"># UNICAST      å•æ’­åœ°å€</span></span><br><span class="line"><span class="comment"># LOCAL        æœ¬æœºåœ°å€</span></span><br><span class="line"><span class="comment"># BROADCAST    å¹¿æ’­åœ°å€</span></span><br><span class="line"><span class="comment"># ANYCAST      ä»»æ’­åœ°å€</span></span><br><span class="line"><span class="comment"># MULTICAST    å¤šæ’­åœ°å€</span></span><br><span class="line"><span class="comment"># BLACKHOLE    é»‘æ´åœ°å€</span></span><br><span class="line"><span class="comment"># UNREACHABLE  ä¸å¯è¾¾åœ°å€</span></span><br><span class="line"><span class="comment"># PROHIBIT     ç¦æ­¢è®¿é—®çš„åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## time æ—¶é—´</span></span><br><span class="line">--datestart time     <span class="comment"># èµ·å§‹æ—¥æœŸ YYYY[-MM[-DD[Thh[:mm[:ss]]]]]</span></span><br><span class="line">--datestop time      <span class="comment"># ç»“æŸæ—¥æœŸ YYYY[-MM[-DD[Thh[:mm[:ss]]]]]</span></span><br><span class="line">--timestart time     <span class="comment"># èµ·å§‹æ—¶é—´ hh:mm[:ss]</span></span><br><span class="line">--timestop time      <span class="comment"># ç»“æŸæ—¶é—´ hh:mm[:ss]</span></span><br><span class="line">--monthdays value    <span class="comment"># å‡ å·ï¼Œ1 è‡³ 31ï¼Œé»˜è®¤ä¸º all</span></span><br><span class="line">--weekdays value     <span class="comment"># æ˜ŸæœŸå‡ ï¼Œ1 è‡³ 7ï¼Œé»˜è®¤ä¸º all</span></span><br><span class="line">--kerneltz           <span class="comment"># ä½¿ç”¨å†…æ ¸æ—¶åŒºè€Œé UTC</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## string å…³é”®å­—åŒ¹é…</span></span><br><span class="line">--from offset       <span class="comment"># è®¾ç½®èµ·å§‹åç§»é‡</span></span><br><span class="line">--to offset         <span class="comment"># è®¾ç½®ç»“æŸåç§»é‡</span></span><br><span class="line">--algo &#123;bm|kmp&#125;     <span class="comment"># æŒ‡å®šä½¿ç”¨çš„ç®—æ³•</span></span><br><span class="line">--icase             <span class="comment"># å¿½ç•¥å¤§å°å†™åŒ¹é…</span></span><br><span class="line">--string string     <span class="comment"># è¦åŒ¹é…çš„å­—ç¬¦ä¸²</span></span><br><span class="line">--hex-string string <span class="comment"># è¦åŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œåå…­è¿›åˆ¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## length æ•°æ®åŒ…å¤§å°</span></span><br><span class="line">--length length[:length]    <span class="comment"># åŒ¹é…æ•°æ®åŒ…å¤§å°[èŒƒå›´]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## mark é˜²ç«å¢™æ ‡è®°</span></span><br><span class="line">--mark value[/mask]     <span class="comment"># åŒ¹é…æœ‰æŒ‡å®šé˜²ç«å¢™æ ‡è®°çš„æ•°æ®åŒ…</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## connmark "è¿æ¥"æ ‡è®°</span></span><br><span class="line">--mark value[/mask]     <span class="comment"># å¦‚æœå½“å‰æ•°æ®åŒ…æ‰€å±çš„"è¿æ¥"æ‰“äº†ç»™å®šçš„æ ‡è®°ï¼Œåˆ™åŒ¹é…æˆåŠŸ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## limit é€Ÿç‡é™åˆ¶</span></span><br><span class="line">--<span class="built_in">limit</span> avg             <span class="comment"># å¹³å‡é€Ÿç‡é™åˆ¶ï¼Œå¦‚ 3/hourï¼Œå•ä½: sec|minute|hour|day</span></span><br><span class="line">--<span class="built_in">limit</span>-burst number    <span class="comment"># å°é¡¶é€Ÿç‡é™åˆ¶ï¼Œé»˜è®¤ä¸º 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## connlimit å¹¶å‘è¿æ¥æ•°</span></span><br><span class="line">--connlimit-upto n      <span class="comment"># 0..n</span></span><br><span class="line">--connlimit-above n     <span class="comment"># &gt; n</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### -j target åŠ¨ä½œ</span></span><br><span class="line"><span class="comment">## æ— å‚æ•°ç³»åˆ—</span></span><br><span class="line">ACCEPT      <span class="comment"># æ¥æ”¶æ•°æ®åŒ…</span></span><br><span class="line">DROP        <span class="comment"># ä¸¢å¼ƒæ•°æ®åŒ…</span></span><br><span class="line">CUST-CHAIN  <span class="comment"># è¿›å…¥è‡ªå®šä¹‰é“¾</span></span><br><span class="line">RETURN      <span class="comment"># é€€å‡ºå½“å‰é“¾ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼š</span></span><br><span class="line">            <span class="comment"># å¦‚æœå½“å‰é“¾æ˜¯è‡ªå®šä¹‰é“¾ï¼Œåˆ™è¿”å›è°ƒç”¨é“¾ï¼Œç»§ç»­åŒ¹é…è°ƒç”¨ç‚¹çš„ä¸‹ä¸€æ¡è§„åˆ™</span></span><br><span class="line">            <span class="comment"># å¦‚æœå½“å‰é“¾ä¸æ˜¯è‡ªå®šä¹‰é“¾ï¼Œåˆ™æ‰§è¡Œå½“å‰é“¾çš„é»˜è®¤ç­–ç•¥ï¼Œå¦‚ ACCEPTã€DROP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## å¸¦å‚æ•°ç³»åˆ—</span></span><br><span class="line"><span class="comment"># REJECT æ‹’ç»ï¼ˆå¸¦åŸå› ï¼‰</span></span><br><span class="line">--reject-with <span class="built_in">type</span>              <span class="comment"># ä¸¢å¼ƒæ•°æ®åŒ…ï¼Œå¹¶å›å¤æºä¸»æœºï¼Œå¯ç”¨çš„ type å¦‚ä¸‹ï¼š</span></span><br><span class="line">    icmp-net-unreachable        <span class="comment"># ICMP ç½‘ç»œä¸å¯è¾¾</span></span><br><span class="line">    net-unreach                 <span class="comment"># åŒä¸Šï¼Œåˆ«å</span></span><br><span class="line">    icmp-host-unreachable       <span class="comment"># ICMP ä¸»æœºä¸å¯è¾¾</span></span><br><span class="line">    host-unreach                <span class="comment"># åŒä¸Šï¼Œåˆ«å</span></span><br><span class="line">    icmp-proto-unreachable      <span class="comment"># ICMP åè®®ä¸å¯è¾¾</span></span><br><span class="line">    proto-unreach               <span class="comment"># åŒä¸Šï¼Œåˆ«å</span></span><br><span class="line">    icmp-port-unreachable       <span class="comment"># ICMP ç«¯å£ä¸å¯è¾¾ï¼ˆé»˜è®¤ï¼‰</span></span><br><span class="line">    port-unreach                <span class="comment"># åŒä¸Šï¼Œåˆ«å</span></span><br><span class="line">    icmp-net-prohibited         <span class="comment"># ICMP ç½‘ç»œé™åˆ¶</span></span><br><span class="line">    net-prohib                  <span class="comment"># åŒä¸Šï¼Œåˆ«å</span></span><br><span class="line">    icmp-host-prohibited        <span class="comment"># ICMP ä¸»æœºé™åˆ¶</span></span><br><span class="line">    host-prohib                 <span class="comment"># åŒä¸Šï¼Œåˆ«å</span></span><br><span class="line">    icmp-admin-prohibited       <span class="comment"># ICMP ç®¡ç†å‘˜é™åˆ¶</span></span><br><span class="line">    admin-prohib                <span class="comment"># åŒä¸Šï¼Œåˆ«å</span></span><br><span class="line">    tcp-reset                   <span class="comment"># TCP RST è¿æ¥é‡ç½®</span></span><br><span class="line">    tcp-rst                     <span class="comment"># åŒä¸Šï¼Œåˆ«å</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MARK æ‰“é˜²ç«å¢™æ ‡è®°</span></span><br><span class="line">--<span class="built_in">set</span>-mark value[/mask]   <span class="comment"># è®¾ç½®æ ‡è®°ï¼Œmask OR valueï¼ˆæ¨èï¼‰</span></span><br><span class="line">--<span class="built_in">set</span>-xmark value[/mask]  <span class="comment"># è®¾ç½®æ ‡è®°ï¼Œmask XOR value</span></span><br><span class="line">--and-mark bits           <span class="comment"># è®¾ç½®äºŒè¿›åˆ¶æ ‡è®°ï¼ŒAND</span></span><br><span class="line">--or-mark bits            <span class="comment"># è®¾ç½®äºŒè¿›åˆ¶æ ‡è®°ï¼ŒOR</span></span><br><span class="line">--xor-mask bits           <span class="comment"># è®¾ç½®äºŒè¿›åˆ¶æ ‡è®°ï¼ŒXOR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CONNMARK æ‰“"è¿æ¥"æ ‡è®°</span></span><br><span class="line">--<span class="built_in">set</span>-mark value[/mask]       <span class="comment"># è®¾ç½®å½“å‰æ•°æ®åŒ…æ‰€å±è¿æ¥çš„è¿æ¥æ ‡è®°</span></span><br><span class="line">--save-mark [--mask mask]     <span class="comment"># å°†å½“å‰æ•°æ®åŒ…çš„æ ‡è®°ä½œä¸ºå…¶æ‰€å±è¿æ¥çš„æ ‡è®°</span></span><br><span class="line">--restore-mark [--mask mask]  <span class="comment"># å°†å½“å‰æ•°æ®åŒ…æ‰€å±è¿æ¥çš„æ ‡è®°ä½œä¸ºè¯¥æ•°æ®åŒ…çš„æ ‡è®°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># LOG é˜²ç«å¢™æ—¥å¿—ï¼Œdmesg å¯æŸ¥çœ‹</span></span><br><span class="line">--<span class="built_in">log</span>-level level       <span class="comment"># æ—¥å¿—çº§åˆ«ï¼ˆsyslog.confï¼‰</span></span><br><span class="line">--<span class="built_in">log</span>-prefix prefix     <span class="comment"># æ—¥å¿—å‰ç¼€å­—ç¬¦ä¸²</span></span><br><span class="line">--<span class="built_in">log</span>-tcp-sequence      <span class="comment"># è®°å½• TCP seq åºåˆ—å·</span></span><br><span class="line">--<span class="built_in">log</span>-tcp-options       <span class="comment"># è®°å½• TCP options é€‰é¡¹</span></span><br><span class="line">--<span class="built_in">log</span>-ip-options        <span class="comment"># è®°å½• IP options é€‰é¡¹</span></span><br><span class="line">--<span class="built_in">log</span>-uid               <span class="comment"># è®°å½•å¥—æ¥å­—ç›¸å…³è”çš„ UID</span></span><br><span class="line">--<span class="built_in">log</span>-macdecode         <span class="comment"># è§£æ MAC åœ°å€å’Œåè®®</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ULOG é˜²ç«å¢™æ—¥å¿—ï¼Œkernel 2.4+</span></span><br><span class="line">--ulog-nlgroup nlgroup  <span class="comment"># è®°å½•çš„ NETLINK ç»„</span></span><br><span class="line">--ulog-cprange size     <span class="comment"># è¦å¤åˆ¶çš„å­—èŠ‚æ•°</span></span><br><span class="line">--ulog-qthreshold       <span class="comment"># å†…æ ¸é˜Ÿåˆ—çš„æ¶ˆæ¯é˜ˆå€¼</span></span><br><span class="line">--ulog-prefix prefix    <span class="comment"># æ—¥å¿—å‰ç¼€å­—ç¬¦ä¸²</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># NFLOG é˜²ç«å¢™æ—¥å¿—ï¼Œkernel 2.6+</span></span><br><span class="line">--nflog-group NUM       <span class="comment"># è®°å½•çš„ NETLINK ç»„</span></span><br><span class="line">--nflog-size NUM        <span class="comment"># è¦å¤åˆ¶çš„å­—èŠ‚æ•°</span></span><br><span class="line">--nflog-threshold NUM   <span class="comment"># å†…æ ¸é˜Ÿåˆ—çš„æ¶ˆæ¯é˜ˆå€¼</span></span><br><span class="line">--nflog-prefix STRING   <span class="comment"># æ—¥å¿—å‰ç¼€å­—ç¬¦ä¸²</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SNAT æºåœ°å€è½¬æ¢ï¼Œç”¨åœ¨ POSTROUTINGã€INPUT é“¾</span></span><br><span class="line">--to-source [&lt;ipaddr&gt;[-&lt;ipaddr&gt;]][:port[-port]]</span><br><span class="line">--random        <span class="comment"># æ˜ å°„åˆ°éšæœºç«¯å£å·</span></span><br><span class="line">--random-fully  <span class="comment"># æ˜ å°„åˆ°éšæœºç«¯å£å·ï¼ˆPRNG å®Œå…¨éšæœºåŒ–ï¼‰</span></span><br><span class="line">--persistent    <span class="comment"># æ˜ å°„åˆ°å›ºå®šåœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># DNAT ç›®çš„åœ°å€è½¬æ¢ï¼Œç”¨åœ¨ PREROUTINGã€OUTPUT é“¾</span></span><br><span class="line">--to-destination [&lt;ipaddr&gt;[-&lt;ipaddr&gt;]][:port[-port]]</span><br><span class="line">--random        <span class="comment"># æ˜ å°„åˆ°éšæœºç«¯å£å·</span></span><br><span class="line">--persistent    <span class="comment"># æ˜ å°„åˆ°å›ºå®šåœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MASQUERADE æºåœ°å€è½¬æ¢ï¼ˆé€‚ç”¨äº DHCP åŠ¨æ€ IPï¼‰ï¼Œç”¨åœ¨ POSTROUTING é“¾</span></span><br><span class="line">--to-ports &lt;port&gt;[-&lt;port&gt;]  <span class="comment"># æ˜ å°„åˆ°æŒ‡å®šç«¯å£å·[èŒƒå›´]</span></span><br><span class="line">--random                    <span class="comment"># æ˜ å°„åˆ°éšæœºç«¯å£å·</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># REDIRECT ç›®çš„åœ°å€è½¬æ¢ï¼ˆé‡å®šå‘è‡³ localhost:ç«¯å£å·ï¼‰ï¼Œç”¨åœ¨ PREROUTINGã€OUTPUT é“¾</span></span><br><span class="line">--to-ports &lt;port&gt;[-&lt;port&gt;]  <span class="comment"># é‡å®šå‘åˆ°æŒ‡å®šç«¯å£å·[èŒƒå›´]</span></span><br><span class="line">--random                    <span class="comment"># é‡å®šå‘åˆ°éšæœºç«¯å£å·</span></span><br></pre></td></tr></table></figure><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><h4 id="æŸ¥çœ‹å¸®åŠ©"><a href="#æŸ¥çœ‹å¸®åŠ©" class="headerlink" title="æŸ¥çœ‹å¸®åŠ©"></a>æŸ¥çœ‹å¸®åŠ©</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables --<span class="built_in">help</span>             <span class="comment"># æŸ¥çœ‹ iptables çš„å¸®åŠ©</span></span><br><span class="line">iptables -m æ¨¡å—å --<span class="built_in">help</span>    <span class="comment"># æŸ¥çœ‹æŒ‡å®šæ¨¡å—çš„å¯ç”¨å‚æ•°</span></span><br><span class="line">iptables -j åŠ¨ä½œå --<span class="built_in">help</span>    <span class="comment"># æŸ¥çœ‹æŒ‡å®šåŠ¨ä½œçš„å¯ç”¨å‚æ•°</span></span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹è§„åˆ™"><a href="#æŸ¥çœ‹è§„åˆ™" class="headerlink" title="æŸ¥çœ‹è§„åˆ™"></a>æŸ¥çœ‹è§„åˆ™</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">iptables -nvL</span><br><span class="line">iptables -t nat -nvL</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºè§„åˆ™åºå·</span></span><br><span class="line">iptables -nvL INPUT --line-numbers</span><br><span class="line">iptables -t nat -nvL --line-numbers</span><br><span class="line">iptables -t nat -nvL PREROUTING --line-numbers</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è§„åˆ™çš„åŸå§‹æ ¼å¼</span></span><br><span class="line">iptables -t filter -S</span><br><span class="line">iptables -t nat -S</span><br><span class="line">iptables -t mangle -S</span><br><span class="line">iptables -t raw -S</span><br></pre></td></tr></table></figure><h4 id="è®¾ç½®é»˜è®¤è§„åˆ™"><a href="#è®¾ç½®é»˜è®¤è§„åˆ™" class="headerlink" title="è®¾ç½®é»˜è®¤è§„åˆ™"></a>è®¾ç½®é»˜è®¤è§„åˆ™</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -P INPUT DROP     <span class="comment"># é…ç½®é»˜è®¤ä¸¢å¼ƒè®¿é—®çš„æ•°æ®è¡¨</span></span><br><span class="line">iptables -P FORWARD DROP   <span class="comment"># é…ç½®é»˜è®¤ç¦æ­¢è½¬å‘</span></span><br><span class="line">iptables -P OUTPUT ACCEPT  <span class="comment"># é…ç½®é»˜è®¤å…è®¸å‘å¤–çš„è¯·æ±‚</span></span><br></pre></td></tr></table></figure><h4 id="æ¸…é™¤æ‰€æœ‰è§„åˆ™"><a href="#æ¸…é™¤æ‰€æœ‰è§„åˆ™" class="headerlink" title="æ¸…é™¤æ‰€æœ‰è§„åˆ™"></a>æ¸…é™¤æ‰€æœ‰è§„åˆ™</h4><p>æ³¨æ„ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">iptables -F  <span class="comment"># æ¸…ç©ºè¡¨ä¸­æ‰€æœ‰çš„è§„åˆ™</span></span><br><span class="line">iptables -X  <span class="comment"># åˆ é™¤è¡¨ä¸­ç”¨æˆ·è‡ªå®šä¹‰çš„é“¾</span></span><br><span class="line">iptables -Z  <span class="comment"># æ¸…ç©ºè®¡æ•°</span></span><br><span class="line"></span><br><span class="line">iptables -t nat -F</span><br><span class="line">iptables -t nat -X</span><br><span class="line">iptables -t mangle -F</span><br><span class="line">iptables -t mangle -X</span><br><span class="line">iptables -t raw -F</span><br><span class="line">iptables -t raw -X</span><br><span class="line">iptables -t security -F</span><br><span class="line">iptables -t security -X</span><br></pre></td></tr></table></figure><h4 id="å¢åŠ è§„åˆ™"><a href="#å¢åŠ è§„åˆ™" class="headerlink" title="å¢åŠ è§„åˆ™"></a>å¢åŠ è§„åˆ™</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¢åŠ ä¸€æ¡è§„åˆ™åˆ°æœ€å</span></span><br><span class="line">iptables -A INPUT -i eth0 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨ï¼šä»¥ä¸‹å‡ æ¡æ“ä½œéƒ½éœ€è¦ä½¿ç”¨è§„åˆ™çš„åºå·ï¼Œéœ€è¦ä½¿ç”¨ -L --line-numbers å‚æ•°å…ˆæŸ¥çœ‹è§„åˆ™çš„é¡ºåºå·</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ ä¸€æ¡è§„åˆ™åˆ°æŒ‡å®šä½ç½®</span></span><br><span class="line">iptables -I INPUT 2 -i eth0 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤è§„åˆ™"><a href="#åˆ é™¤è§„åˆ™" class="headerlink" title="åˆ é™¤è§„åˆ™"></a>åˆ é™¤è§„åˆ™</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†æ‰€æœ‰ iptables ä»¥åºå·æ ‡è®°æ˜¾ç¤º</span></span><br><span class="line">iptables -L -n --line-numbers</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®è§„åˆ™çš„åºå·æ¥åˆ é™¤</span></span><br><span class="line">iptabels -D INPUT <span class="variable">$&#123;line-numbers&#125;</span></span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹è§„åˆ™"><a href="#ä¿®æ”¹è§„åˆ™" class="headerlink" title="ä¿®æ”¹è§„åˆ™"></a>ä¿®æ”¹è§„åˆ™</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -R INPUT 3 -i eth0 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure><h4 id="å¼€æ”¾æŒ‡å®šç«¯å£"><a href="#å¼€æ”¾æŒ‡å®šç«¯å£" class="headerlink" title="å¼€æ”¾æŒ‡å®šç«¯å£"></a>å¼€æ”¾æŒ‡å®šç«¯å£</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…è®¸æœ¬åœ°å›ç¯æ¥å£(å³è¿è¡Œæœ¬æœºè®¿é—®æœ¬æœº)</span></span><br><span class="line">iptables -A INPUT -i lo -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…è®¸å·²å»ºç«‹çš„æˆ–ç›¸å…³è¿æ¥çš„é€šè¡Œ</span></span><br><span class="line">iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…è®¸æ‰€æœ‰æœ¬æœºå‘å¤–çš„è®¿é—®</span></span><br><span class="line">iptables -A OUTPUT -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…è®¸ 22,80,443 ç«¯å£çš„è®¿é—®</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dports 80,443 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…è®¸ ping</span></span><br><span class="line">iptables -A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¦æ­¢ ping</span></span><br><span class="line">iptables -A INPUT -p icmp -m icmp --icmp-type 8 -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¦æ­¢å…¶ä»–æœªå…è®¸çš„è§„åˆ™è®¿é—®</span></span><br><span class="line">iptables -A INPUT -j REJECT</span><br><span class="line">iptables -A FORWARD -j REJECT</span><br></pre></td></tr></table></figure><h4 id="è®¾ç½®ç™½åå•"><a href="#è®¾ç½®ç™½åå•" class="headerlink" title="è®¾ç½®ç™½åå•"></a>è®¾ç½®ç™½åå•</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…è®¸æœºæˆ¿å†…ç½‘æœºå™¨å¯ä»¥è®¿é—®</span></span><br><span class="line">iptables -A INPUT -p all -s 10.10.10.0/24 -j ACCEPT </span><br><span class="line"><span class="comment"># å…è®¸ 10.10.10.22 è®¿é—®æœ¬æœºçš„ 22 ç«¯å£</span></span><br><span class="line">iptables -A INPUT -p tcp -s 10.10.10.22 --dport 22 -j ACCEPT</span><br></pre></td></tr></table></figure><h4 id="å±è”½æŸ-IP"><a href="#å±è”½æŸ-IP" class="headerlink" title="å±è”½æŸ IP"></a>å±è”½æŸ IP</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># å±è”½æ¶æ„ä¸»æœºï¼ˆæ¯”å¦‚ï¼Œ114.114.114.114)</span></span><br><span class="line">iptables -A INPUT -p tcp -m tcp -s 114.114.114.114 -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment"># å±è”½å•ä¸ªIPçš„å‘½ä»¤</span></span><br><span class="line">iptables -I INPUT -s 123.45.6.7 -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">#å°æ•´ä¸ªæ®µå³ä» 10.10.10.1 åˆ° 10.10.10.254çš„å‘½ä»¤</span></span><br><span class="line">iptables -I INPUT -s 10.10.10.0/24 -j DROP</span><br></pre></td></tr></table></figure><h4 id="æŒ‡å®šæ•°æ®åŒ…å‡ºå»çš„ç½‘ç»œæ¥å£"><a href="#æŒ‡å®šæ•°æ®åŒ…å‡ºå»çš„ç½‘ç»œæ¥å£" class="headerlink" title="æŒ‡å®šæ•°æ®åŒ…å‡ºå»çš„ç½‘ç»œæ¥å£"></a>æŒ‡å®šæ•°æ®åŒ…å‡ºå»çš„ç½‘ç»œæ¥å£</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åªå¯¹ OUTPUTï¼ŒFORWARDï¼ŒPOSTROUTING ä¸‰ä¸ªé“¾èµ·ä½œç”¨</span></span><br><span class="line">iptables -A FORWARD -o eth0</span><br></pre></td></tr></table></figure><h4 id="é˜²æ­¢SYNæ´ªæ°´æ”»å‡»"><a href="#é˜²æ­¢SYNæ´ªæ°´æ”»å‡»" class="headerlink" title="é˜²æ­¢SYNæ´ªæ°´æ”»å‡»"></a>é˜²æ­¢SYNæ´ªæ°´æ”»å‡»</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --syn -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 5/second -j ACCEPT</span><br></pre></td></tr></table></figure><h4 id="ç«¯å£æ˜ å°„"><a href="#ç«¯å£æ˜ å°„" class="headerlink" title="ç«¯å£æ˜ å°„"></a>ç«¯å£æ˜ å°„</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ¬æœºçš„ 2222 ç«¯å£æ˜ å°„åˆ°å†…ç½‘è™šæ‹Ÿæœºçš„22 ç«¯å£</span></span><br><span class="line">iptables -t nat -A PREROUTING -d 223.6.6.6 -p tcp --dport 2222  -j DNAT --to-dest 10.10.10.22:22</span><br></pre></td></tr></table></figure><h4 id="æŒä¹…åŒ–è§„åˆ™ï¼š"><a href="#æŒä¹…åŒ–è§„åˆ™ï¼š" class="headerlink" title="æŒä¹…åŒ–è§„åˆ™ï¼š"></a>æŒä¹…åŒ–è§„åˆ™ï¼š</h4><p><strong>RHEL/CentOS</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿ç»´åƒä¸‡æ¡ï¼Œå¤‡ä»½ç¬¬ä¸€æ¡ï¼Œæ“ä½œä¸è§„èŒƒï¼Œæ•°æ®å…¨å®Œè›‹(å¤§é›¾</span></span><br><span class="line">cp /etc/sysconfig/iptables&#123;ï¼Œ.bak&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿å­˜å½“å‰è§„åˆ™</span></span><br><span class="line">iptables-save &gt; /etc/sysconfig/iptables</span><br><span class="line">cat /etc/sysconfig/iptables</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¢å¤å¤‡ä»½è§„åˆ™</span></span><br><span class="line">iptables-restore &lt; iptables</span><br></pre></td></tr></table></figure><p><strong>Debian/Ubuntu</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤‡ä»½å½“å‰è§„åˆ™</span></span><br><span class="line">cp /etc/iptables/rules.v4&#123;,.bak&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒä¹…åŒ–å½“å‰è§„åˆ™</span></span><br><span class="line">iptables-save &gt; /etc/iptables/rules.v4</span><br></pre></td></tr></table></figure><h4 id="åˆ‡è®°"><a href="#åˆ‡è®°" class="headerlink" title="åˆ‡è®°"></a>åˆ‡è®°</h4><p>åœ¨æ“ä½œ iptables è§„åˆ™æ—¶ä¸€å®šè¦ä¸»è¦å…ˆåé¡ºåºï¼Œå› ä¸ºé“¾ä¸Šçš„è§„åˆ™æ˜¯ä¸€æ¡æ¡è§„åˆ™éå†ä¸‹æ¥çš„ï¼Œæ‰€ä»¥é¡ºåºå‡ºé”™çš„è¯ï¼Œiptables ä½œç”¨çš„æ•ˆæœä¹Ÿæœ‰å¯èƒ½ä¸ä¸€æ ·çš„å“¦ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="http://cxd2014.github.io/2017/08/15/connection-tracking-system/" target="_blank" rel="noopener">Linuxåè®®æ ˆâ€“è¿æ¥è·Ÿè¸ªæºç åˆ†æ</a></li><li><a href="https://github.com/OSH-2019/x-xdp-on-android/blob/master/docs/research.md" target="_blank" rel="noopener">x-xdp-on-android</a></li><li><a href="http://abcdxyzk.github.io/blog/2015/03/04/kernel-net-ip/" target="_blank" rel="noopener">linux TCP/IPåè®®æ ˆ-IPå±‚</a></li><li><a href="https://nieyong.github.io/wiki_cpu/CPU%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84-DMA.html" target="_blank" rel="noopener">CPUä½“ç³»æ¶æ„ DMA</a></li><li><a href="http://blog.konghy.cn/2019/07/21/iptables/" target="_blank" rel="noopener">iptables ä½¿ç”¨æ–¹å¼æ•´ç†</a></li><li><a href="https://wiki.archlinux.org/index.php/Iptables_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" target="_blank" rel="noopener">Archlinuxï¼šIptables</a></li><li><a href="https://windard.com/opinion/2016/10/15/About-Iptables" target="_blank" rel="noopener">iptables é˜²ç«å¢™åŸºæœ¬é…ç½®å’Œä½¿ç”¨</a></li><li><a href="http://www.ha97.com/3928.html" target="_blank" rel="noopener">Linuxçš„ iptables å¸¸ç”¨é…ç½®èŒƒä¾‹ï¼ˆ1ï¼‰</a></li><li><a href="https://www.bennythink.com/ufw-iptables.html" target="_blank" rel="noopener">å¼€å¯ ufw å¯¼è‡´æ–­ç½‘ä¸èƒ½ ping? ufw å’Œ iptables çš„é‚£äº›å‘</a></li><li><a href="https://zhuanlan.zhihu.com/p/93630586" target="_blank" rel="noopener">Linux ç½‘ç»œå±‚æ”¶å‘åŒ…æµç¨‹åŠ Netfilter æ¡†æ¶æµ…æ</a></li><li><a href="http://www.mikewootc.com/wiki/linux/usage/linux_firewall_iptables_intro.html" target="_blank" rel="noopener">Linuxé˜²ç«å¢™ä¸iptablesä»‹ç»</a></li><li><a href="https://www.zfl9.com/iptables.html" target="_blank" rel="noopener">iptables è¯¦è§£</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;æœ€è¿‘å‚åŠ äº†ä¸€åœºè§†é¢‘ä¼šè®®é¢è¯•ï¼Œè™½ç„¶ç»“æœå¯èƒ½ä¸å¤ªç†æƒ³ï¼Œä½†è¿˜æ˜¯å‘
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Linux ç½‘ç»œ" scheme="https://blog.k8s.li/tags/Linux-%E7%BD%91%E7%BB%9C/"/>
    
      <category term="é˜²ç«å¢™" scheme="https://blog.k8s.li/tags/%E9%98%B2%E7%81%AB%E5%A2%99/"/>
    
  </entry>
  
</feed>
