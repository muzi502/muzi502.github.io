<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æœ¨å­</title>
  <icon>https://blog.k8s.li/icon.png</icon>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://blog.k8s.li/"/>
  <updated>2021-04-16T16:00:00.000Z</updated>
  <id>https://blog.k8s.li/</id>
  
  <author>
    <name>æœ¨å­</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å¦‚ä½•ä½¿ç”¨ registry å­˜å‚¨çš„ç‰¹æ€§</title>
    <link href="https://blog.k8s.li/skopeo-to-registry.html"/>
    <id>https://blog.k8s.li/skopeo-to-registry.html</id>
    <published>2021-04-16T16:00:00.000Z</published>
    <updated>2021-04-16T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è‹¦å‘½æ‰“åŒ…å·¥å…·äººğŸ˜­"><a href="#è‹¦å‘½æ‰“åŒ…å·¥å…·äººğŸ˜­" class="headerlink" title="è‹¦å‘½æ‰“åŒ…å·¥å…·äººğŸ˜­"></a>è‹¦å‘½æ‰“åŒ…å·¥å…·äººğŸ˜­</h2><p>ç›®å‰åœ¨è´Ÿè´£å…¬å¸ PaaS toB äº§å“çš„æ‰“åŒ…å‘å¸ƒå·¥ä½œï¼ˆè‹¦å‘½å‘ç‰ˆ+æ‰“åŒ…å·¥å…·äººğŸ˜£ï¼‰ã€‚æ—¥å¸¸çš„ä¸€é¡¹å·¥ä½œå°±æ˜¯è·‘å®Œè‡ªåŠ¨åŒ–æ‰“åŒ…æµæ°´çº¿ï¼Œå†å°†æ‰“å‡ºæ¥çš„å®‰è£…åŒ…æ›´æ–°åˆ° QA æµ‹è¯•ç¯å¢ƒä¸­ã€‚å› ä¸ºæ‰“åŒ…ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒåˆ†å¸ƒåœ¨ä¸¤ä¸ªä¸åŒçš„æœºæˆ¿ï¼Œäº§å“çš„å®‰è£…åŒ…éœ€è¦è·¨å…¬ç½‘ä»æ‰“åŒ…æœºå™¨ä¸ŠåŒæ­¥åˆ° QA ç¯å¢ƒä¸­ï¼Œå› æ­¤äº§å“å®‰è£…åŒ…çš„å¤§å°å°±å†³å®šç€ä¸¤è€…é—´åŒæ­¥çš„è€—æ—¶ã€‚ä¼˜åŒ–å’Œå‡å°‘äº§å“å®‰è£…åŒ…çš„å¤§å°å°±æˆä¸ºäº†æå‡æµæ°´çº¿æ•ˆç‡çš„é€”å¾„ä¹‹ä¸€ã€‚æœ€è¿‘åšçš„ä¸€é¡¹å·¥ä½œå°±æ˜¯å°†äº§å“è¡¥ä¸åŒ…çš„å¤§å°å‡å°‘ 30%ï½60%ï¼Œå¤§å¤§èŠ‚çœäº†è¡¥ä¸åŒ…ä¸Šä¼ ä¸‹è½½å’Œå®‰è£…çš„è€—æ—¶ï¼Œæå‡äº†äº§å“æ‰“åŒ…æµæ°´çº¿çš„æ•ˆç‡ã€‚å› æ­¤ä»Šå¤©å°±æ€»ç»“ä¸€ä¸‹ä»ä¸­å­¦åˆ°çš„ä¸€ç‚¹äººç”Ÿç»éªŒ ğŸ‘“ã€‚</p><h2 id="å†æ¬¡ä¼˜åŒ–"><a href="#å†æ¬¡ä¼˜åŒ–" class="headerlink" title="å†æ¬¡ä¼˜åŒ–"></a>å†æ¬¡ä¼˜åŒ–</h2><p>å› ä¸ºäº§å“æ‰€æœ‰çš„ç»„ä»¶éƒ½æ˜¯å®¹å™¨åŒ–çš„å½¢å¼éƒ¨ç½²çš„ï¼Œæ‰€ä»¥äº§å“çš„è¡¥ä¸åŒ…ä¸­æœ€ä¸»è¦çš„å°±æ˜¯é•œåƒæ–‡ä»¶ä»¥åŠä¸€äº›éƒ¨ç½²è„šæœ¬ï¼Œæƒ³è¦ä¼˜åŒ–å’Œè§å‡å°è¡¥ä¸åŒ…åŸºæœ¬ä¸Šç­‰åŒäºå‡å°è¿™äº›é•œåƒçš„å¤§å°ã€‚ä¼—æ‰€å‘¨çŸ¥ docker é•œåƒæ˜¯ç”±ä¸€å±‚ä¸€å±‚çš„ layer + é•œåƒçš„å…ƒæ•°æ®ä¿¡æ¯æ„æˆçš„ï¼Œå…¶ä¸­é•œåƒçš„å…ƒæ•°æ®ä¿¡æ¯å°±æ˜¯é•œåƒçš„ image config + manifestsï¼Œè¿™äº›éƒ½æ˜¯ json æ ¼å¼çš„æ–‡æœ¬å†…å®¹ï¼Œç›¸å¯¹äºé•œåƒçš„ layer çš„å¤§å°ï¼Œè¿™äº›æ–‡æœ¬å†…å®¹å¾€å¾€å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</p><p>å…¶å®å»å¹´çš„æ—¶å€™å·²ç»åšè¿‡äº†ä¸€æ¬¡ä¼˜åŒ–ï¼Œå°†è¡¥ä¸åŒ…é•œåƒæ‰“åŒ…çš„æ–¹å¼ç”±åŸæ¥çš„ docker save çš„æ–¹å¼æ›¿æ¢æˆäº† skopeo copy åˆ°ç›®å½•çš„æ–¹å¼ï¼Œä¼˜åŒ–çš„æ•ˆæœå°±æ˜¯ï¼šå°†è¡¥ä¸åŒ…çš„å¤§å°å‡å°‘äº† 60%ï½80%ï¼›æµæ°´çº¿çš„é€Ÿåº¦æå‡äº† 5 å€ï¼›è¡¥ä¸åŒ…å®‰è£…é€Ÿåº¦ä¹Ÿæå‡äº† 5 å€ã€‚è¿™é¡¹ä¼˜åŒ–çš„åŸç†å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„åšå®¢ <a href="https://blog.k8s.li/Exploring-container-image.html">æ·±å…¥æµ…å‡ºå®¹å™¨é•œåƒçš„ä¸€ç”Ÿ</a>ã€‚è™½ç„¶ç¬¬ä¸€æ¬¡å·²ç»æœ‰äº†è¿™ä¹ˆæ˜æ˜¾çš„ä¼˜åŒ–ï¼Œä½†å’±ä»ç„¶è§‰å¾—è¿˜æœ‰å¯ä»¥ä¼˜åŒ–çš„ç©ºé—´ã€‚</p><p>ç»è¿‡ç¬¬ä¸€æ¬¡ä¼˜åŒ–ä¹‹åï¼Œäº§å“è¡¥ä¸åŒ…ä¸­é•œåƒå­˜åœ¨çš„å½¢å¼å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@debian:/root/kube <span class="comment"># tree images -h</span></span><br><span class="line">images</span><br><span class="line">â”œâ”€â”€ [4.0K]  kube-apiserver:v1.20.5</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ [707K]  742efefc8a44179dcc376b969cb5e3f8afff66f87ab618a15164638ad07bf722</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ [ 28M]  98d681774b176bb2fd6b3499377d63ff4b1b040886dd9d3641bb93840815a1e7</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ [2.6K]  d7e24aeb3b10210bf6a2dc39f77c1ea835b22af06dfd2933c06e0421ed6d35ac</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ [642K]  fefd475334af8255ba693de12951b5176a2853c2f0d5d2b053e188a1f3b611d9</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ [ 949]  manifest.json</span><br><span class="line">â”‚Â Â  â””â”€â”€ [  33]  version</span><br><span class="line">â”œâ”€â”€ [4.0K]  kube-controller-manager:v1.20.5</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ [ 27M]  454a7944c47b608efb657a1bef7f4093f63ceb2db14fd78c5ecd2a08333da7cf</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ [2.6K]  6f0c3da8c99e99bbe82920a35653f286bd8130f0662884e77fa9fcdca079c07f</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ [707K]  742efefc8a44179dcc376b969cb5e3f8afff66f87ab618a15164638ad07bf722</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ [642K]  fefd475334af8255ba693de12951b5176a2853c2f0d5d2b053e188a1f3b611d9</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ [ 949]  manifest.json</span><br><span class="line">â”‚Â Â  â””â”€â”€ [  33]  version</span><br><span class="line">â””â”€â”€ [4.0K]  kube-scheduler:v1.20.5</span><br><span class="line">    â”œâ”€â”€ [ 12M]  565677e452d17c4e2841250bbf0cc010d906fbf7877569bb2d69bfb4e68db1b5</span><br><span class="line">    â”œâ”€â”€ [707K]  742efefc8a44179dcc376b969cb5e3f8afff66f87ab618a15164638ad07bf722</span><br><span class="line">    â”œâ”€â”€ [2.6K]  8d13f1db8bfb498afb0caff6bf3f8c599ecc2ace74275f69886067f6af8ffdf6</span><br><span class="line">    â”œâ”€â”€ [642K]  fefd475334af8255ba693de12951b5176a2853c2f0d5d2b053e188a1f3b611d9</span><br><span class="line">    â”œâ”€â”€ [ 949]  manifest.json</span><br><span class="line">    â””â”€â”€ [  33]  version</span><br></pre></td></tr></table></figure><p>ä»”ç»†åˆ†æå¯ä»¥å‘ç°è¿™æ ·æ‰“åŒ…å‡ºæ¥çš„é•œåƒè¦æ¯”å®ƒä»¬åœ¨ registry ä¸­çš„æ‰€å å­˜å‚¨ç©ºé—´è¦å¤§ä¸€äº›ï¼Œè¿™æ˜¯å› ä¸ºæ¯ä¸€ä¸ªé•œåƒå­˜å‚¨ç›®å½•ä¸‹éƒ½ä¿å­˜åœ¨è¯¥é•œåƒçš„æ‰€æœ‰ layer ï¼Œä¸èƒ½åƒ registry å­˜å‚¨é‚£æ ·å¯ä»¥å¤ç”¨ç›¸åŒçš„ layerã€‚æ¯”å¦‚ <code>kube-apiserver</code>  <code>kube-controller-manager</code> <code>kube-scheduler</code> è¿™ä¸‰ä¸ªé•œåƒéƒ½æ˜¯ä½¿ç”¨çš„ <code>k8s.gcr.io/build-image/go-runner</code> è¿™ä¸ª base é•œåƒã€‚åœ¨ registry ä¸­ï¼Œå®ƒåªéœ€è¦å­˜å‚¨ä¸€ä»½ <code>go-runner</code> base é•œåƒå³å¯ã€‚è€Œä½¿ç”¨ skopeo copy å­˜å‚¨åœ¨ç›®å½•ä¸­æ—¶ï¼Œå°±éœ€è¦åˆ†åˆ«å­˜å‚¨ä¸€ä»½è¿™ä¸ª base é•œåƒäº†ã€‚</p><p>ä»æ–‡ä»¶åå’Œæ–‡ä»¶å¤§å°ä¹Ÿå¯ä»¥å¤§è‡´æ¨æ–­å‡º <code>707K</code> å¤§å°çš„ 742efefc8a å°±æ˜¯ <code>go-runner</code> é•œåƒçš„è·Ÿæ–‡ä»¶ç³»ç»Ÿï¼›<code>642K</code> å¤§å°çš„ fefd47533 å°±æ˜¯ go-runner çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼›<code>2.x</code> å·¦å³å¤§å°çš„åº”è¯¥å°±æ˜¯é•œåƒçš„ image config æ–‡ä»¶ï¼›å‰©ä¸‹é‚£ä¸ªåå‡ äºŒåå‡  M çš„å°±æ˜¯  <code>kube-apiserver</code>  <code>kube-controller-manager</code> <code>kube-scheduler</code>  çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼›manifest.json æ–‡ä»¶å°±æ˜¯é•œåƒåœ¨ registry å­˜å‚¨ä¸­çš„ manifest ã€‚</p><ul><li>ä½¿ç”¨ find æ¥ç»Ÿè®¡è¿™äº›æ–‡ä»¶çš„æ•°é‡ï¼Œç»è¿‡å»é‡ä¹‹åå¯ä»¥å‘ç°é•œåƒçš„ layer æ–‡ä»¶å’Œ config æ–‡ä»¶æ€»æ•°é‡ä»åŸæ¥çš„ 12 ä¸ªå‡å°‘åˆ° 8 ä¸ªã€‚åšä¸€ä¸ªç®€å•çš„åŠ æ³•è®¡ç®—ä¹Ÿå°±æ˜¯ï¼š3 ä¸ª image config æ–‡ä»¶ + 3 ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ + 1 ä¸ª base é•œåƒ layer æ–‡ä»¶ + 1 ä¸ª go-runner äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™ä¸æ­£å¥½å°±æ˜¯ 8 å˜›ğŸ˜‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@debian:/root/kube <span class="comment"># find images -type f | grep -Eo "\b[a-f0-9]&#123;64&#125;\b" | wc</span></span><br><span class="line">12</span><br><span class="line">root@debian:/root/kube <span class="comment"># find images -type f | grep -Eo "\b[a-f0-9]&#123;64&#125;\b" | sort -u | wc -l</span></span><br><span class="line">8</span><br></pre></td></tr></table></figure><p>æ—¢ç„¶è¡¥ä¸åŒ…ä¸­çš„é•œåƒæ–‡ä»¶æœ‰ä¸€äº›ç›¸åŒçš„ layerï¼Œé‚£ä¹ˆå»é‡è¿™äº›ç›¸åŒçš„ layer æ–‡ä»¶å²‚ä¸å°±èƒ½å‡å°‘è¡¥ä¸åŒ…çš„å¤§å°äº†ï¼Ÿäºæ˜¯å°±æ‹¿äº†ä¸€ä¸ªå†å²çš„è¡¥ä¸åŒ…æµ‹è¯•ä¸€ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@debian:/root $ du -sh images</span><br><span class="line">3.3Gimages</span><br><span class="line">root@debian:/root $ find images -<span class="built_in">type</span> f ! -name <span class="string">'version'</span> ! -name <span class="string">'manifest.json'</span> | wc -l</span><br><span class="line">279</span><br><span class="line">root@debian:/root $ mkdir -p images2</span><br><span class="line">root@debian:/root $ find images -<span class="built_in">type</span> f -<span class="built_in">exec</span> mv &#123;&#125; images2 \;</span><br><span class="line">root@debian:/root $ du -sh images2</span><br><span class="line">1.3Gimages2</span><br><span class="line">root@debian:/root $ $ find images2 -<span class="built_in">type</span> f ! -name <span class="string">'version'</span> ! -name <span class="string">'manifest.json'</span> | wc -l</span><br><span class="line">187</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰å¯¹æ¯”å°±æ²¡æœ‰ä¼¤å®³ï¼Œç»è¿‡æµ‹è¯•ä¹‹åå‘ç°ï¼šè¡¥ä¸åŒ…ä¸­é•œåƒæ–‡ä»¶çš„æ€»æ•°é‡ç”±åŸæ¥çš„ 279 ä¸ªå‡å°è‡³ 187 ä¸ªï¼Œæ€»å¤§å°ä»åŸæ¥çš„ 3.3G å‡å°åˆ° 1.3Gï¼Œå‡å°äº† 60%ï¼å½“æ—¶å…´å¥‹å¾—æˆ‘æ‹æ¡ˆå«ç»ï¼Œå¦‚è·çå®ã€‚å…¶å®è¿™å¾—ç›Šäºæˆ‘ä»¬äº§å“ç»„ä»¶ä½¿ç”¨çš„ base é•œåƒåŸºæœ¬ä¸Šæ˜¯ç›¸åŒçš„ï¼Œå› æ­¤å¯ä»¥å»é™¤æ‰å¾ˆå¤šç›¸åŒçš„ base é•œåƒ layer æ–‡ä»¶ã€‚</p><p>æ—¢ç„¶æ‰¾åˆ°äº†å‡å°è¡¥ä¸åŒ…ä¸­é•œåƒå¤§å°çš„æ€è·¯ï¼Œé‚£ä¹ˆåªè¦æ‰¾åˆ°ä¸€ç§æ–¹å¼æ¥å»é‡è¿™äº›é•œåƒ layer å°±å¯ä»¥äº†ã€‚é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯ä½¿ç”¨ registry å­˜å‚¨ï¼šæ ¹æ® registry å­˜å‚¨çš„ç‰¹æ€§ï¼Œé•œåƒåœ¨ registry ä¸­æ˜¯å¯ä»¥å¤ç”¨ç›¸åŒçš„ layer çš„ã€‚æ‰€ä»¥å¤§ä½“çš„æ€è·¯å°±æ˜¯å°†è¿™äº›è¡¥ä¸åŒ…ä¸­çš„é•œåƒè½¬æ¢ä¸º registry å­˜å‚¨çš„æ ¼å¼ï¼Œåœ¨å®‰è£…çš„æ—¶å€™å†å°† registry å­˜å‚¨çš„æ ¼å¼è½¬æ¢ä¸º skopeo copy æ”¯æŒçš„ dir æ ¼å¼ã€‚</p><h2 id="æ„å»º-skopeo-dir-é•œåƒå­˜å‚¨"><a href="#æ„å»º-skopeo-dir-é•œåƒå­˜å‚¨" class="headerlink" title="æ„å»º skopeo dir é•œåƒå­˜å‚¨"></a>æ„å»º skopeo dir é•œåƒå­˜å‚¨</h2><ul><li>ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œéœ€è¦æ‰¾ä¸ªåˆé€‚çš„é•œåƒåˆ—è¡¨ï¼Œçœ‹äº†ä¸€ä¸‹ <a href="https://github.com/kubesphere/ks-installer" target="_blank" rel="noopener">ks-installer</a> é¡¹ç›®ä¸­æœ‰ä¸ªé•œåƒåˆ—è¡¨ï¼Œçœ‹æ ·å­æ¯”è¾ƒåˆé€‚é‚£å°±ç”¨å®ƒå§ğŸ˜ƒ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@debian:/root <span class="comment"># curl -L -O https://github.com/kubesphere/ks-installer/releases/download/v3.0.0/images-list.txt</span></span><br></pre></td></tr></table></figure><ul><li>é¦–å…ˆå°†é•œåƒä½¿ç”¨ skopeo sync åŒæ­¥åˆ°æœ¬åœ°ç›®å½•ï¼Œå¹¶ç»Ÿè®¡ä¸€ä¸‹é•œåƒçš„å¤§å°å’Œæ–‡ä»¶çš„æ•°é‡</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@debian:/root <span class="comment"># for img in $(cat cat images-list.txt | grep -v "#");do skopeo sync --insecure-policy --src docker --dest dir $&#123;img&#125; images; done</span></span><br><span class="line"></span><br><span class="line">root@debian:/root <span class="comment"># tree images -d -L 1</span></span><br><span class="line">images</span><br><span class="line">â”œâ”€â”€ alpine:3.10.4</span><br><span class="line">â”œâ”€â”€ busybox:1.31.1</span><br><span class="line">â”œâ”€â”€ calico</span><br><span class="line">â”œâ”€â”€ coredns</span><br><span class="line">â”œâ”€â”€ csiplugin</span><br><span class="line">â”œâ”€â”€ docker:19.03</span><br><span class="line">â”œâ”€â”€ elastic</span><br><span class="line">â”œâ”€â”€ fluent</span><br><span class="line">â”œâ”€â”€ haproxy:2.0.4</span><br><span class="line">â”œâ”€â”€ istio</span><br><span class="line">â”œâ”€â”€ jaegertracing</span><br><span class="line">â”œâ”€â”€ java:openjdk-8-jre-alpine</span><br><span class="line">â”œâ”€â”€ jenkins</span><br><span class="line">â”œâ”€â”€ jimmidyson</span><br><span class="line">â”œâ”€â”€ joosthofman</span><br><span class="line">â”œâ”€â”€ kubesphere</span><br><span class="line">â”œâ”€â”€ minio</span><br><span class="line">â”œâ”€â”€ mirrorgooglecontainers</span><br><span class="line">â”œâ”€â”€ mysql:8.0.11</span><br><span class="line">â”œâ”€â”€ nginx:1.14-alpine</span><br><span class="line">â”œâ”€â”€ nginxdemos</span><br><span class="line">â”œâ”€â”€ openpitrix</span><br><span class="line">â”œâ”€â”€ osixia</span><br><span class="line">â”œâ”€â”€ perl:latest</span><br><span class="line">â”œâ”€â”€ prom</span><br><span class="line">â”œâ”€â”€ redis:5.0.5-alpine</span><br><span class="line">â””â”€â”€ wordpress:4.8-apache</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ skopeo sync å°†é•œåƒåŒæ­¥åˆ°æœ¬åœ° images ç›®å½•åï¼Œç»Ÿè®¡å¯å¾—æ‰€æœ‰é•œåƒçš„å¤§å°ä¸º 11Gã€æ€»çš„æ–‡ä»¶ä¸º 1264 ä¸ªã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@debian:/root <span class="comment"># du -sh images</span></span><br><span class="line">11Gimages</span><br><span class="line">root@debian:/root <span class="comment"># find images -type f ! -name "version" | wc -l</span></span><br><span class="line">1264</span><br></pre></td></tr></table></figure><h2 id="è½¬æ¢æˆ-registry-å­˜å‚¨ç›®å½•"><a href="#è½¬æ¢æˆ-registry-å­˜å‚¨ç›®å½•" class="headerlink" title="è½¬æ¢æˆ registry å­˜å‚¨ç›®å½•"></a>è½¬æ¢æˆ registry å­˜å‚¨ç›®å½•</h2><p>æ ¹æ®ä¸‹å›¾æ‰€ç¤ºçš„ registry å­˜å‚¨ç»“æ„ï¼Œæˆ‘ä»¬è¦å°†é•œåƒçš„ layerã€image configã€manifests è¿™ä¸‰ç§æ–‡ä»¶æ ¹æ®å®ƒä»¬çš„ sha256 å€¼å­˜æ”¾åˆ° blobs/sha256 ç›®å½•ä¸‹ï¼Œç„¶åå†åœ¨ repositories ç›®å½•ä¸‹åˆ›å»ºç›¸åº”link æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥å°†é•œåƒè½¬æ¢æˆ registry å­˜å‚¨çš„æ ¼å¼äº†ã€‚</p><p><img src="https://p.k8s.li/registry-storage.jpeg" alt=""></p><p>ä¸ºæ–¹ä¾¿æ¼”ç¤ºæˆ‘ä»¬å…ˆä»¥å•ä¸ªé•œåƒä¸ºä¾‹ï¼Œå°† <code>images/alpine:3.10.4</code> è¿™ä¸ªé•œåƒåœ¨è½¬æ¢æˆ docker registry å­˜å‚¨ç›®å½•çš„å½¢å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@debian:/root <span class="comment"># tree -h images/alpine:3.10.4</span></span><br><span class="line">images/alpine:3.10.4</span><br><span class="line">â””â”€â”€ [4.0K]  alpine:3.10.4</span><br><span class="line">    â”œâ”€â”€ [2.7M]  4167d3e149762ea326c26fc2fd4e36fdeb7d4e639408ad30f37b8f25ac285a98</span><br><span class="line">    â”œâ”€â”€ [1.5K]  af341ccd2df8b0e2d67cf8dd32e087bfda4e5756ebd1c76bbf3efa0dc246590e</span><br><span class="line">    â”œâ”€â”€ [ 528]  manifest.json</span><br><span class="line">    â””â”€â”€ [  33]  version</span><br></pre></td></tr></table></figure><p> æ ¹æ®é•œåƒæ–‡ä»¶å¤§å°æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼š <code>2.7M</code> å¤§å°çš„ <code>4167d3e1497â€¦â€¦</code> æ–‡ä»¶å°±æ˜¯é•œåƒçš„ layer æ–‡ä»¶ï¼Œç”±äº alpine æ˜¯ä¸€ä¸ª base é•œåƒï¼Œè¯¥ layer å°±æ˜¯ alpine çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼›<code>1.5K</code> å¤§å°çš„ <code>af341ccd2â€¦â€¦</code> æ˜¾è€Œæ˜“è§å°±æ˜¯é•œåƒçš„ images config æ–‡ä»¶ï¼›<code>manifest.json</code> æ–‡ä»¶åˆ™æ˜¯é•œåƒåœ¨ registry å­˜å‚¨ä¸­çš„ manifest.json æ–‡ä»¶ã€‚</p><ul><li>å…ˆåˆ›å»ºè¯¥é•œåƒåœ¨ registry å­˜å‚¨ä¸­çš„ç›®å½•ç»“æ„</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@debian:/root <span class="comment"># mkdir -p docker/registry/v2/&#123;blobs/sha256,repositories/alpine&#125;</span></span><br><span class="line">root@debian:/root <span class="comment"># tree docker</span></span><br><span class="line">docker</span><br><span class="line">â””â”€â”€ registry</span><br><span class="line">    â””â”€â”€ v2</span><br><span class="line">        â”œâ”€â”€ blobs</span><br><span class="line">        â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">        â””â”€â”€ repositories</span><br><span class="line">            â””â”€â”€ alpine</span><br></pre></td></tr></table></figure><ul><li>æ„å»ºé•œåƒ layer çš„ link æ–‡ä»¶</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grep -Eo <span class="string">"\b[a-f0-9]&#123;64&#125;\b"</span> images/alpine:3.10.4/manifest.json | sort -u | xargs -L1 -I &#123;&#125; mkdir -p docker/registry/v2/repositories/alpine/_layers/sha256/&#123;&#125;</span><br><span class="line"></span><br><span class="line">grep -Eo <span class="string">"\b[a-f0-9]&#123;64&#125;\b"</span> images/alpine:3.10.4/manifest.json | sort -u | xargs -L1 -I &#123;&#125; sh -c <span class="string">"echo -n 'sha256:&#123;&#125;' &gt; docker/registry/v2/repositories/alpine/_layers/sha256/&#123;&#125;/link"</span></span><br></pre></td></tr></table></figure><ul><li>æ„å»ºé•œåƒ tag çš„ link æ–‡ä»¶</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">manifests_sha256=$(sha256sum images/alpine:3.10.4/manifest.json | awk <span class="string">'&#123;print $1&#125;'</span>)</span><br><span class="line">mkdir -p docker/registry/v2/repositories/alpine/_manifests/revisions/sha256/<span class="variable">$&#123;manifests_sha256&#125;</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">"sha256:<span class="variable">$&#123;manifests_sha256&#125;</span>"</span> &gt; docker/registry/v2/repositories/alpine/_manifests/revisions/sha256/<span class="variable">$&#123;manifests_sha256&#125;</span>/link</span><br><span class="line"></span><br><span class="line">mkdir -p docker/registry/v2/repositories/alpine/_manifests/tags/3.10.4/index/sha256/<span class="variable">$&#123;manifests_sha256&#125;</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">"sha256:<span class="variable">$&#123;manifests_sha256&#125;</span>"</span> &gt; docker/registry/v2/repositories/alpine/_manifests/tags/3.10.4/index/sha256/<span class="variable">$&#123;manifests_sha256&#125;</span>/link</span><br><span class="line"></span><br><span class="line">mkdir -p docker/registry/v2/repositories/alpine/_manifests/tags/3.10.4/current</span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">"sha256:<span class="variable">$&#123;manifests_sha256&#125;</span>"</span> &gt; docker/registry/v2/repositories/alpine/_manifests/tags/3.10.4/current/link</span><br></pre></td></tr></table></figure><ul><li>æ„å»ºé•œåƒçš„ blobs ç›®å½•</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p docker/registry/v2/blobs/sha256/<span class="variable">$&#123;manifests_sha256:0:2&#125;</span>/<span class="variable">$&#123;manifests_sha256&#125;</span></span><br><span class="line">ln -f images/alpine:3.10.4/manifest.json docker/registry/v2/blobs/sha256/<span class="variable">$&#123;manifests_sha256:0:2&#125;</span>/<span class="variable">$&#123;manifests_sha256&#125;</span>/data</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> layer <span class="keyword">in</span> $(grep -Eo <span class="string">"\b[a-f0-9]&#123;64&#125;\b"</span> images/alpine:3.10.4/manifest.json); <span class="keyword">do</span></span><br><span class="line">    mkdir -p docker/registry/v2/blobs/sha256/<span class="variable">$&#123;layer:0:2&#125;</span>/<span class="variable">$&#123;layer&#125;</span></span><br><span class="line">    ln -f  images/alpine:3.10.4/<span class="variable">$&#123;layer&#125;</span> docker/registry/v2/blobs/sha256/<span class="variable">$&#123;layer:0:2&#125;</span>/<span class="variable">$&#123;layer&#125;</span>/data</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><ul><li>æœ€ç»ˆå¾—åˆ°çš„ registry å­˜å‚¨ç›®å½•å¦‚ä¸‹</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">docker</span><br><span class="line">â””â”€â”€ registry</span><br><span class="line">    â””â”€â”€ v2</span><br><span class="line">        â”œâ”€â”€ blobs</span><br><span class="line">        â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">        â”‚Â Â      â”œâ”€â”€ 41</span><br><span class="line">        â”‚Â Â      â”‚Â Â  â””â”€â”€ 4167d3e149762ea326c26fc2fd4e36fdeb7d4e639408ad30f37b8f25ac285a98</span><br><span class="line">        â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">        â”‚Â Â      â”œâ”€â”€ af</span><br><span class="line">        â”‚Â Â      â”‚Â Â  â””â”€â”€ af341ccd2df8b0e2d67cf8dd32e087bfda4e5756ebd1c76bbf3efa0dc246590e</span><br><span class="line">        â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">        â”‚Â Â      â””â”€â”€ de</span><br><span class="line">        â”‚Â Â          â””â”€â”€ de78803598bc4c940fc4591d412bffe488205d5d953f94751c6308deeaaa7eb8</span><br><span class="line">        â”‚Â Â              â””â”€â”€ data</span><br><span class="line">        â””â”€â”€ repositories</span><br><span class="line">            â””â”€â”€ alpine</span><br><span class="line">                â”œâ”€â”€ _layers</span><br><span class="line">                â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">                â”‚Â Â      â”œâ”€â”€ 4167d3e149762ea326c26fc2fd4e36fdeb7d4e639408ad30f37b8f25ac285a98</span><br><span class="line">                â”‚Â Â      â”‚Â Â  â””â”€â”€ link</span><br><span class="line">                â”‚Â Â      â””â”€â”€ af341ccd2df8b0e2d67cf8dd32e087bfda4e5756ebd1c76bbf3efa0dc246590e</span><br><span class="line">                â”‚Â Â          â””â”€â”€ link</span><br><span class="line">                â””â”€â”€ _manifests</span><br><span class="line">                    â”œâ”€â”€ revisions</span><br><span class="line">                    â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">                    â”‚Â Â      â””â”€â”€ de78803598bc4c940fc4591d412bffe488205d5d953f94751c6308deeaaa7eb8</span><br><span class="line">                    â”‚Â Â          â””â”€â”€ link</span><br><span class="line">                    â””â”€â”€ tags</span><br><span class="line">                        â””â”€â”€ 3.10.4</span><br><span class="line">                            â”œâ”€â”€ current</span><br><span class="line">                            â”‚Â Â  â””â”€â”€ link</span><br><span class="line">                            â””â”€â”€ index</span><br><span class="line">                                â””â”€â”€ sha256</span><br><span class="line">                                    â””â”€â”€ de78803598bc4c940fc4591d412bffe488205d5d953f94751c6308deeaaa7eb8</span><br><span class="line">                                        â””â”€â”€ link</span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•æ˜¯å¦æ­£å¸¸ï¼Œæœ¬åœ° docker run ä¸€ä¸ª registry å®¹å™¨ï¼Œå°†åˆšåˆšè½¬æ¢çš„ registry å­˜å‚¨ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„ /var/lib/registryï¼Œç„¶åå†ä½¿ç”¨ docker pull çš„æ–¹å¼æ‹‰å–é•œåƒï¼Œåœ¨ä½¿ç”¨ docker run æµ‹è¯•ä¸€ä¸‹èƒ½å¦æ­£å¸¸ä½¿ç”¨ã€‚ç»è¿‡éªŒè¯ä¹‹åç¡®å®å¯ä»¥ä½¿ç”¨ï¼Œé‚£å°±è¯´æ˜è¿™æ ·çš„è½¬æ¢æ˜¯æ²¡æœ‰é—®é¢˜çš„ğŸ˜Šã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@debian:/root <span class="comment"># docker pull localhost/alpine:3.10.4</span></span><br><span class="line">3.10.4: Pulling from alpine</span><br><span class="line">4167d3e14976: Pull complete</span><br><span class="line">Digest: sha256:de78803598bc4c940fc4591d412bffe488205d5d953f94751c6308deeaaa7eb8</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> localhost/alpine:3.10.4</span><br><span class="line">root@debian:/root <span class="comment"># docker run --rm -it localhost/alpine:3.10.4 cat /etc/os-release</span></span><br><span class="line">NAME=<span class="string">"Alpine Linux"</span></span><br><span class="line">ID=alpine</span><br><span class="line">VERSION_ID=3.10.4</span><br><span class="line">PRETTY_NAME=<span class="string">"Alpine Linux v3.10"</span></span><br><span class="line">HOME_URL=<span class="string">"https://alpinelinux.org/"</span></span><br><span class="line">BUG_REPORT_URL=<span class="string">"https://bugs.alpinelinux.org/"</span></span><br></pre></td></tr></table></figure><ul><li>å°†ä¸Šè¿°æ­¥éª¤æ•´åˆæˆä¸€ä¸ª shell è„šæœ¬ï¼Œå†…å®¹å¦‚ä¸‹</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -eo pipefail</span><br><span class="line"></span><br><span class="line">IMAGES_DIR=<span class="string">"images"</span></span><br><span class="line">REGISTRY_DIR=<span class="string">"docker"</span></span><br><span class="line"></span><br><span class="line">rm -rf <span class="variable">$&#123;REGISTRY_DIR&#125;</span></span><br><span class="line">BLOBS_PATH=<span class="string">"<span class="variable">$&#123;REGISTRY_DIR&#125;</span>/registry/v2/blobs"</span></span><br><span class="line">REPO_PATH=<span class="string">"<span class="variable">$&#123;REGISTRY_DIR&#125;</span>/registry/v2/repositories"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> image <span class="keyword">in</span> $(find <span class="variable">$&#123;IMAGES_DIR&#125;</span> -<span class="built_in">type</span> f | sed -n <span class="string">'s|/manifest.json||p'</span> | sort -u); <span class="keyword">do</span></span><br><span class="line">    image_name=$(<span class="built_in">echo</span> <span class="variable">$&#123;image%%:*&#125;</span> | sed <span class="string">"s|<span class="variable">$&#123;IMAGES_DIR&#125;</span>/||g"</span>)</span><br><span class="line">    image_tag=<span class="variable">$&#123;image##*:&#125;</span>; mfs=<span class="string">"<span class="variable">$&#123;image&#125;</span>/manifest.json"</span></span><br><span class="line">    mfs_sha256=$(sha256sum <span class="variable">$&#123;image&#125;</span>/manifest.json | awk <span class="string">'&#123;print $1&#125;'</span>)</span><br><span class="line">    mkdir -p <span class="variable">$&#123;BLOBS_PATH&#125;</span>/sha256/<span class="variable">$&#123;mfs_sha256:0:2&#125;</span>/<span class="variable">$&#123;mfs_sha256&#125;</span></span><br><span class="line">    ln -f <span class="variable">$&#123;mfs&#125;</span> <span class="variable">$&#123;BLOBS_PATH&#125;</span>/sha256/<span class="variable">$&#123;mfs_sha256:0:2&#125;</span>/<span class="variable">$&#123;mfs_sha256&#125;</span>/data</span><br><span class="line"></span><br><span class="line">    <span class="comment"># make image repositories dir</span></span><br><span class="line">    mkdir -p <span class="variable">$&#123;REPO_PATH&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/&#123;_layers,_manifests/revisions&#125;/sha256</span><br><span class="line">    mkdir -p <span class="variable">$&#123;REPO_PATH&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_manifests/revisions/sha256/<span class="variable">$&#123;mfs_sha256&#125;</span></span><br><span class="line">    mkdir -p <span class="variable">$&#123;REPO_PATH&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_manifests/tags/<span class="variable">$&#123;image_tag&#125;</span>/&#123;current,index/sha256&#125;</span><br><span class="line">    mkdir -p <span class="variable">$&#123;REPO_PATH&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_manifests/tags/<span class="variable">$&#123;image_tag&#125;</span>/index/sha256/<span class="variable">$&#123;mfs_sha256&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># create image tag manifest link file</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">"sha256:<span class="variable">$&#123;mfs_sha256&#125;</span>"</span> &gt; <span class="variable">$&#123;REPO_PATH&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_manifests/tags/<span class="variable">$&#123;image_tag&#125;</span>/current/link</span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">"sha256:<span class="variable">$&#123;mfs_sha256&#125;</span>"</span> &gt; <span class="variable">$&#123;REPO_PATH&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_manifests/revisions/sha256/<span class="variable">$&#123;mfs_sha256&#125;</span>/link</span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">"sha256:<span class="variable">$&#123;mfs_sha256&#125;</span>"</span> &gt; <span class="variable">$&#123;REPO_PATH&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_manifests/tags/<span class="variable">$&#123;image_tag&#125;</span>/index/sha256/<span class="variable">$&#123;mfs_sha256&#125;</span>/link</span><br><span class="line"></span><br><span class="line">    <span class="comment"># link image layers file to registry blobs file</span></span><br><span class="line">    <span class="keyword">for</span> layer <span class="keyword">in</span> $(grep -Eo <span class="string">"\b[a-f0-9]&#123;64&#125;\b"</span> <span class="variable">$&#123;mfs&#125;</span>); <span class="keyword">do</span></span><br><span class="line">        mkdir -p <span class="variable">$&#123;BLOBS_PATH&#125;</span>/sha256/<span class="variable">$&#123;layer:0:2&#125;</span>/<span class="variable">$&#123;layer&#125;</span></span><br><span class="line">        mkdir -p <span class="variable">$&#123;REPO_PATH&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_layers/sha256/<span class="variable">$&#123;layer&#125;</span></span><br><span class="line">        <span class="built_in">echo</span> -n <span class="string">"sha256:<span class="variable">$&#123;layer&#125;</span>"</span> &gt; <span class="variable">$&#123;REPO_PATH&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_layers/sha256/<span class="variable">$&#123;layer&#125;</span>/link</span><br><span class="line">        ln -f <span class="variable">$&#123;image&#125;</span>/<span class="variable">$&#123;layer&#125;</span> <span class="variable">$&#123;BLOBS_PATH&#125;</span>/sha256/<span class="variable">$&#123;layer:0:2&#125;</span>/<span class="variable">$&#123;layer&#125;</span>/data</span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨è¯¥è„šæœ¬å¯¹ images ä¸­æ‰€æœ‰é•œåƒè¿›è¡Œä¸€ä¸‹è½¬æ¢ï¼Œæœ€ç»ˆå¾—åˆ°çš„ registry å­˜å‚¨å¤§å°ä¸º 8.3 Gï¼Œæ¯”ä¹‹å‰å‡å°‘äº† 2.7Gã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@debian:/root <span class="comment"># du -sh docker</span></span><br><span class="line">8.3Gdocker</span><br><span class="line">root@debian:/root <span class="comment"># find docker -type f -name "data" | wc -l</span></span><br><span class="line">1046</span><br></pre></td></tr></table></figure><h2 id="å†è¿˜åŸå›-Dir-æ ¼å¼"><a href="#å†è¿˜åŸå›-Dir-æ ¼å¼" class="headerlink" title="å†è¿˜åŸå› Dir æ ¼å¼"></a>å†è¿˜åŸå› Dir æ ¼å¼</h2><p>ç»è¿‡ä¸Šè¿°æ­¥éª¤ä¸€ç•ªæŠ˜è…¾ä¹‹åï¼Œå°†è¡¥ä¸åŒ…ä¸­é•œåƒæ–‡ä»¶çš„æ€»å¤§å°çš„ç¡®å®å‡å°‘äº†å¾ˆå¤šï¼Œä½†åŒæ—¶åˆå¼•å…¥äº†å¦ä¸€ä¸ªé—®é¢˜ï¼šskopeo æ— æ³•ç›´æ¥ä½¿ç”¨ registry å­˜å‚¨çš„æ ¼å¼ã€‚å› æ­¤æˆ‘ä»¬è¿˜éœ€è¦å†åšä¸€æ¬¡è½¬æ¢ï¼Œå°†é•œåƒç”± registry å­˜å‚¨çš„æ ¼å¼è¿˜åŸå› skopeo æ‰€æ”¯æŒçš„ dir æ ¼å¼ã€‚è‡³äºè¿˜åŸçš„åŸç†å’Œæ–¹æ³•æˆ‘åœ¨ <a href="https://blog.k8s.li/docker-registry-to-harbor.html">docker registry è¿ç§»è‡³ harbor</a> ä¸­æœ‰è¯¦ç»†åœ°ä»‹ç»ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å†å»çœ‹ä¸€ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">REGISTRY_DOMAIN=<span class="string">"harbor.k8s.li"</span></span><br><span class="line">REGISTRY_PATH=<span class="string">"/var/lib/registry"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ° registry å­˜å‚¨ä¸»ç›®å½•ä¸‹</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$&#123;REGISTRY_PATH&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">gen_skopeo_dir</span></span>() &#123;</span><br><span class="line">   <span class="comment"># å®šä¹‰ registry å­˜å‚¨çš„ blob ç›®å½• å’Œ repositories ç›®å½•ï¼Œæ–¹ä¾¿åé¢ä½¿ç”¨</span></span><br><span class="line">    BLOB_DIR=<span class="string">"docker/registry/v2/blobs/sha256"</span></span><br><span class="line">    REPO_DIR=<span class="string">"docker/registry/v2/repositories"</span></span><br><span class="line">    <span class="comment"># å®šä¹‰ç”Ÿæˆ skopeo ç›®å½•</span></span><br><span class="line">    SKOPEO_DIR=<span class="string">"docker/skopeo"</span></span><br><span class="line">    <span class="comment"># é€šè¿‡ find å‡º current æ–‡ä»¶å¤¹å¯ä»¥å¾—åˆ°æ‰€æœ‰å¸¦ tag çš„é•œåƒï¼Œå› ä¸ºä¸€ä¸ª tag å¯¹åº”ä¸€ä¸ª current ç›®å½•</span></span><br><span class="line">    <span class="keyword">for</span> image <span class="keyword">in</span> $(find <span class="variable">$&#123;REPO_DIR&#125;</span> -<span class="built_in">type</span> d -name <span class="string">"current"</span>); <span class="keyword">do</span></span><br><span class="line">        <span class="comment"># æ ¹æ®é•œåƒçš„ tag æå–é•œåƒçš„åå­—</span></span><br><span class="line">        name=$(<span class="built_in">echo</span> <span class="variable">$&#123;image&#125;</span> | awk -F <span class="string">'/'</span> <span class="string">'&#123;print $5"/"$6":"$9&#125;'</span>)</span><br><span class="line">        link=$(cat <span class="variable">$&#123;image&#125;</span>/link | sed <span class="string">'s/sha256://'</span>)</span><br><span class="line">        mfs=<span class="string">"<span class="variable">$&#123;BLOB_DIR&#125;</span>/<span class="variable">$&#123;link:0:2&#125;</span>/<span class="variable">$&#123;link&#125;</span>/data"</span></span><br><span class="line">        <span class="comment"># åˆ›å»ºé•œåƒçš„ç¡¬é“¾æ¥éœ€è¦çš„ç›®å½•</span></span><br><span class="line">        mkdir -p <span class="string">"<span class="variable">$&#123;SKOPEO_DIR&#125;</span>/<span class="variable">$&#123;name&#125;</span>"</span></span><br><span class="line">        <span class="comment"># ç¡¬é“¾æ¥é•œåƒçš„ manifests æ–‡ä»¶åˆ°ç›®å½•çš„ manifest æ–‡ä»¶</span></span><br><span class="line">        ln <span class="variable">$&#123;mfs&#125;</span> <span class="variable">$&#123;SKOPEO_DIR&#125;</span>/<span class="variable">$&#123;name&#125;</span>/manifest.json</span><br><span class="line">        <span class="comment"># ä½¿ç”¨æ­£åˆ™åŒ¹é…å‡ºæ‰€æœ‰çš„ sha256 å€¼ï¼Œç„¶åæ’åºå»é‡</span></span><br><span class="line">        layers=$(grep -Eo <span class="string">"\b[a-f0-9]&#123;64&#125;\b"</span> <span class="variable">$&#123;mfs&#125;</span> | sort -u)</span><br><span class="line">        <span class="keyword">for</span> layer <span class="keyword">in</span> <span class="variable">$&#123;layers&#125;</span>; <span class="keyword">do</span></span><br><span class="line">          <span class="comment"># ç¡¬é“¾æ¥ registry å­˜å‚¨ç›®å½•é‡Œçš„é•œåƒ layer å’Œ images config åˆ°é•œåƒçš„ dir ç›®å½•</span></span><br><span class="line">            ln <span class="variable">$&#123;BLOB_DIR&#125;</span>/<span class="variable">$&#123;layer:0:2&#125;</span>/<span class="variable">$&#123;layer&#125;</span>/data <span class="variable">$&#123;SKOPEO_DIR&#125;</span>/<span class="variable">$&#123;name&#125;</span>/<span class="variable">$&#123;layer&#125;</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">sync_image</span></span>() &#123;</span><br><span class="line">    <span class="comment"># ä½¿ç”¨ skopeo sync å°† dir æ ¼å¼çš„é•œåƒåŒæ­¥åˆ° harbor</span></span><br><span class="line">    <span class="keyword">for</span> project <span class="keyword">in</span> $(ls <span class="variable">$&#123;SKOPEO_DIR&#125;</span>); <span class="keyword">do</span></span><br><span class="line">        skopeo sync --insecure-policy --src-tls-verify=<span class="literal">false</span> --dest-tls-verify=<span class="literal">false</span> \</span><br><span class="line">        --src dir --dest docker <span class="variable">$&#123;SKOPEO_DIR&#125;</span>/<span class="variable">$&#123;project&#125;</span> <span class="variable">$&#123;REGISTRY_DOMAIN&#125;</span>/<span class="variable">$&#123;project&#125;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gen_skopeo_dir</span><br><span class="line">sync_image</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;è‹¦å‘½æ‰“åŒ…å·¥å…·äººğŸ˜­&quot;&gt;&lt;a
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="registry" scheme="https://blog.k8s.li/tags/registry/"/>
    
      <category term="image" scheme="https://blog.k8s.li/tags/image/"/>
    
  </entry>
  
  <entry>
    <title>python-gitlab CLI ä½¿ç”¨è®°å½•</title>
    <link href="https://blog.k8s.li/gitlab-cli.html"/>
    <id>https://blog.k8s.li/gitlab-cli.html</id>
    <published>2021-03-22T16:00:00.000Z</published>
    <updated>2021-03-19T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼€å€’è½¦-ğŸš—-ï¼Ÿ"><a href="#å¼€å€’è½¦-ğŸš—-ï¼Ÿ" class="headerlink" title="å¼€å€’è½¦ ğŸš— ï¼Ÿ"></a>å¼€å€’è½¦ ğŸš— ï¼Ÿ</h2><p>å¹´åè¿™å‡ å‘¨èŠ±äº†ä¸¤å‘¨å·¦å³çš„æ—¶é—´å°†æˆ‘å¸çš„ GitHub ä»£ç è¿ç§»åˆ°å†…éƒ¨çš„ Gitlabã€‚å½±å“æœ€å¤§çš„å°±æ˜¯æˆ‘ä»¬äº§å“çš„å‘å¸ƒæµæ°´çº¿ï¼Œéœ€è¦é€‚é… Gitlab å’Œå†…ç½‘ç¯å¢ƒçš„ä¸€äº›æœåŠ¡ã€‚åŸºæœ¬ä¸Šæ•´ä¸ªäº§å“æ‰“åŒ…å‘å¸ƒçš„æµæ°´çº¿ä»£ç å…¨éƒ¨é‡å†™äº†ä¸€éï¼Œå¯ç´¯åå’±äº†ğŸ¥ºã€‚å½“æ—¶å¿ƒé‡Œè¿˜è®¤ä¸ºä»£ç è¿ç§»è‡³ Gitlab çº¯å±å€’è½¦è¡Œä¸ºğŸ˜…ï¼Œä¸è¿‡ç­‰åˆ°æ‰€æœ‰çš„é€‚é…ä¿®æ”¹å®Œæ¯•åå¿½ç„¶å‘ç° Gitlab çœŸé¦™ï¼</p><p>å½’æ ¹ç»“åº•å†…ç½‘çš„ Gitlab ç½‘ç»œçŠ¶å†µåå€ç™¾å€ä¸ GitHub ä¸æ­¢ã€‚ä¼—æ‰€å‘¨çŸ¥åœ¨å­¦ä¹ <strong>å¢™å›½</strong>ï¼ŒGitHub ç›´è¿çš„é€Ÿåº¦å’Œç¨³å®šæ€§å·®çš„ä¸€æ‰¹ã€‚ä¹Ÿæ­£å› æ­¤ä¹‹å‰åœ¨ GitHub ä¸Šçš„æµæ°´çº¿ç»å¸¸ä¼šè¢«ç½‘ç»œæŠ–åŠ¨æ‰€å¹²æ‰°ï¼Œæœ‰æ—¶ä¾¯ fetch ä¸€ä¸ª repo åå‡ äºŒååˆ†é’Ÿï¼è¿ç§»åˆ°å†…ç½‘ Gitlab ä¹‹åï¼Œé‚£é€Ÿåº¦ç®€ç›´é£èµ·ï¼ä»¥å¾€æœ€å°‘åå‡ åˆ†é’Ÿçš„æµæ°´çº¿ç°åœ¨åªéœ€è¦ä¸åˆ°äº”åˆ†é’Ÿå°±èƒ½å®ŒæˆğŸ˜‚ã€‚</p><p>äºæ˜¯ä»Šå¤©å°±å†™ç¯‡åšå®¢è®°å½•ä¸€ä¸‹å½“æ—¶æŠ˜è…¾ Gitlab æ—¶æ”¶è·çš„ä¸€ç‚¹äººç”Ÿç»éªŒğŸ‘“</p><blockquote><p>æˆ‘ä»Šå¤©æ˜¯ä½œä¸ºä¸€ä¸ªé•¿è€…ç»™ä½ ä»¬è®²çš„ï¼Œæˆ‘ä¸æ˜¯æ–°é—»å·¥ä½œè€…ï¼Œä½†æ˜¯æˆ‘è§å¾—å¤ªå¤šäº†ï¼Œæˆ‘æœ‰è¿™ä¸ªå¿…è¦å‘Šè¯‰ä½ ä»¬ä¸€ç‚¹äººç”Ÿçš„ç»éªŒ</p></blockquote><h2 id="Gitlab"><a href="#Gitlab" class="headerlink" title="Gitlab"></a>Gitlab</h2><p>åœ¨æŠ˜è…¾çš„è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°çš„æœ‰å…³ Gitlab çš„æ–‡æ¡£å’Œå·¥å…·ï¼š</p><ul><li><a href="https://about.gitlab.com/topics/version-control/what-is-gitlab-workflow/" target="_blank" rel="noopener">Gitlab workflow</a>ï¼šäº†è§£ä¸€ä¸‹ Gitlab çš„å·¥ä½œæµï¼Œä¸åŒäº GitHub çš„ PRï¼Œåœ¨ Gitlab ä¸­ä½¿ç”¨çš„æ˜¯ MR çš„æ–¹å¼ï¼›</li><li><a href="https://docs.gitlab.com/ee/api/README.html" target="_blank" rel="noopener">Gitlab API</a>ï¼šGitlab API çš„å®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£å®ƒåœ¨ä½¿ç”¨ä¸‹ä¸‹é¢è¿™äº›å·¥å…·æ—¶å€™ä¼šå¾—å¿ƒåº”æ‰‹ã€‚</li><li><a href="https://python-gitlab.readthedocs.io/en/stable/api-objects.html" target="_blank" rel="noopener">python-gitlab</a> API clientï¼šä½¿ç”¨ Python å®ç°çš„ Gitlab API clientï¼Œç”¨å®ƒæ¥å®Œæˆä¸€äº›ç‰¹å®šéœ€æ±‚å·¥å…·çš„å¼€å‘ï¼Œæ¯”å¦‚æ ¹æ® tag æˆ–è€… branchè·å– repo ä¸­æŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•ï¼›</li><li><a href="https://python-gitlab.readthedocs.io/" target="_blank" rel="noopener">python-gitlab</a> CLIï¼šåŸºäº <a href="https://python-gitlab.readthedocs.io/en/stable/api-objects.html" target="_blank" rel="noopener">python-gitlab</a> API client å°è£…æˆçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå› ä¸ºæ˜¯ CLI å·¥å…·æ‰€ä»¥å¯ä»¥å¾ˆæ–¹ä¾¿åœ°é›†æˆåœ¨ä¸€äº›æµæ°´çº¿çš„è„šæœ¬ä¸­ï¼›</li><li><a href="https://github.com/xanzy/go-gitlab" target="_blank" rel="noopener">go-gitlab</a> API clientï¼šä½¿ç”¨ Golang å®ç°çš„ Gitlab API clientã€‚ç”±äºå‘å¸ƒæµæ°´çº¿ä¸­çš„ä¸€ä¸ªé˜¶æ®µå°±æ˜¯æ ¹æ®ä¸€ä¸ª list æ¥æ”¶é›†å…¶ä»– repo ä¸­çš„ç‰¹å®šæ–‡ä»¶å’Œç›®å½•ï¼Œä½¿ç”¨çš„å·¥å…·æ˜¯ golang å†™çš„ï¼Œä¸ºäº†å‡å°‘ä»£ç ä¿®æ”¹é‡å°±ä½¿ç”¨äº† go-gitlab è€Œä¸æ˜¯ python-gitlabã€‚</li></ul><h2 id="Gitlab-workflow"><a href="#Gitlab-workflow" class="headerlink" title="Gitlab workflow"></a><a href="https://about.gitlab.com/topics/version-control/what-is-gitlab-workflow/" target="_blank" rel="noopener">Gitlab workflow</a></h2><h3 id="PR"><a href="#PR" class="headerlink" title="PR"></a>PR</h3><p>åœ¨ GitHub ä¸Šæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ PR çš„æ–¹å¼æ¥å®Œæˆä»£ç åˆå¹¶å·¥ä½œï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æˆå‘˜ Fork åŸå§‹ä»“åº“ï¼Œå°† Fork å‡ºæ¥çš„ä»“åº“ clone åˆ°æœ¬åœ°</li><li>åœ¨æœ¬åœ°åˆ›å»ºæ–°åˆ†æ”¯ï¼Œå¹¶åŸºäºæ–°åˆ†æ”¯è¿›è¡Œä¿®æ”¹å’Œæäº¤ï¼Œæ¨é€æ–°åˆ†æ”¯åˆ° Fork çš„ä»“åº“</li><li>åŸºäº Fork ä»“åº“ä¸­çš„æ–°åˆ†æ”¯å‘åŸå§‹ä»“åº“çš„ç›®æ ‡åˆ†æ”¯å‘èµ· Pull Request</li><li>åœ¨ PR çš„è¯„è®ºä¸­ @ å®¡æŸ¥è€…ï¼Œè¯·æ±‚ review ä¿®æ”¹</li><li>å®¡æŸ¥è€…æ”¶åˆ°è¯·æ±‚é‚®ä»¶ï¼Œå®¡æŸ¥ä»£ç ï¼Œå¹¶åœ¨å»ºè®®å¤„ç›´æ¥åšå‡ºè¯„è®º</li><li>æäº¤è€…æ ¹æ®å»ºè®®ï¼Œç»§ç»­æäº¤æ”¹åŠ¨ï¼Œå¹¶å¯¹æ„è§ä½œå‡ºå›åº”</li><li>å®¡æŸ¥è€…æ— å¼‚è®®åï¼Œåœ¨ PR çš„è¯„è®ºä¸­ @ ç®¡ç†å‘˜ï¼Œè¯·æ±‚åˆå…¥ä»£ç ï¼Œç®¡ç†å‘˜æ¥å— PRï¼Œä»£ç åˆå…¥ä¸»åˆ†æ”¯</li></ul><h3 id="MR"><a href="#MR" class="headerlink" title="MR"></a>MR</h3><p>ä½†æ˜¯åˆ°äº† Gitlab ä¹‹åæˆ‘ä»¬å°±ä½¿ç”¨ MR çš„æ–¹å¼æ¥å®Œæˆä»£ç åˆå¹¶å·¥ä½œï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æˆå‘˜ Clone åŸå§‹ä»“åº“åˆ°æœ¬åœ°ï¼ŒåŸºäºè¦ä¿®æ”¹çš„åˆ†æ”¯ï¼Œåˆ›å»ºæ–°çš„åˆ†æ”¯</li><li>æœ¬åœ°ä¿®æ”¹å’Œæäº¤ï¼Œæ¨é€æ–°åˆ†æ”¯åˆ°åŸå§‹ä»“åº“</li><li>åœ¨åŸå§‹ä»“åº“ä¸­åŸºäºæ–°åˆ†æ”¯å‘ç›®æ ‡ä¿æŠ¤åˆ†æ”¯å‘èµ· Merge Request</li><li>å®¡æ ¸è€… review ä»£ç ï¼Œç®¡ç†å‘˜ Merge ä»£ç </li></ul><p>ç›¸æ¯”æ¥è®² MR å’Œæ–¹å¼æ›´é€‚åˆå›¢é˜Ÿå†…éƒ¨çš„åä½œå¼€å‘ï¼ŒPR çš„æ–¹å¼é€‚åˆå¼€æºé¡¹ç›®çš„åä½œå¼€å‘ã€‚</p><h2 id="Gitlab-API"><a href="#Gitlab-API" class="headerlink" title="Gitlab API"></a><a href="https://docs.gitlab.com/ee/api/README.html" target="_blank" rel="noopener">Gitlab</a> API</h2><blockquote><p>The main GitLab API is a <a href="http://spec.openapis.org/oas/v3.0.3" target="_blank" rel="noopener">REST</a> API. Because of this, the documentation in this section assumes that youâ€™re familiar with REST concepts.</p></blockquote><p>å‚ç…§å®˜æ–¹æ–‡æ¡£ <a href="https://docs.gitlab.com/ee/api/api_resources.html" target="_blank" rel="noopener">API resources</a> å¯çŸ¥ï¼Œå…±æœ‰ Projects ã€Groupsã€Standalone è¿™ä¸‰ç§ API åˆ†ç»„ã€‚</p><ul><li>Projectsï¼š å¯¹åº”çš„å°±æ˜¯ä¸ repo ç›¸å…³çš„ API ï¼Œæ¯”å¦‚ tagã€commitã€branch ã€MRã€Issue è¿™ä¸€ç±»å‹ï¼›</li><li>Groupsï¼š å¯¹åº”ç±»ä¼¼äº GitHub ä¸Šçš„ Organizationsï¼Œä¸€èˆ¬æ¥è®²å…¬å¸é‡Œçš„ repo éƒ½ä¼šæŒ‰ç…§å›¢é˜Ÿæ¥åˆ’åˆ†ç»„ç»‡ï¼ŒåŒä¸€å›¢é˜Ÿé‡Œçš„ repo ä¼šæ”¾åœ¨ gitlab åŒä¸€ä¸ª Groups  ä¸‹ï¼Œè€Œä¸æ˜¯ä»¥ä¸ªäººä¸ºå•ä½å­˜æ”¾ repoï¼›</li><li>Standaloneï¼šåˆ™æ˜¯é™¤äº† Projects å’Œ Groups ä¹‹å¤–çš„ API èµ„æºï¼Œå¦‚ user</li></ul><p>è€Œæˆ‘ä»¬å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨çš„æ˜¯ Projects ç›¸å…³çš„ APIï¼Œé€šè¿‡å®ƒæ¥å¯¹ repo è¿›è¡Œå¢åˆ æ”¹æŸ¥ã€‚ç®€å•ä»‹ç»å®Œ Gitlab API ç±»å‹ä¹‹åï¼Œæœ¬æ–‡ä¼šä»‹ç»å‡ ç§ä½¿ç”¨ Gitlab API çš„å·¥å…·ã€‚åœ¨ä½¿ç”¨è¿™äº›å·¥å…·çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ°ä¸€äº›é”™è¯¯å¯ä»¥é€šè¿‡ <a href="https://docs.gitlab.com/ee/api/README.html#status-codes" target="_blank" rel="noopener">Status codes</a> API è¿”å›çŠ¶æ€ç æ¥æ’æŸ¥é—®é¢˜ã€‚</p><h2 id="python-gitlab-CLI"><a href="#python-gitlab-CLI" class="headerlink" title="python-gitlab CLI"></a><a href="https://python-gitlab.readthedocs.io/" target="_blank" rel="noopener">python-gitlab</a> CLI</h2><p>è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ <a href="https://python-gitlab.readthedocs.io/en/stable/api-objects.html" target="_blank" rel="noopener">python-gitlab</a> API client å°è£…å¥½çš„ gitlab å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥å®Œæˆç»å¤§å¤šæ•° Gitlab API æ‰€æ”¯æŒçš„æ“ä½œã€‚å› ä¸ºä¹‹å‰çš„æµæ°´çº¿ä¸­æœ‰å¾ˆå¤šæ“ä½œæ˜¯è®¿é—®çš„ GitHubï¼Œæ¯”å¦‚æäº¤ PRã€è·å– repo tagã€æŸ¥çœ‹ PR labels ç­‰ï¼Œéƒ½æ˜¯å†™åœ¨ Jenkinsfile è°ƒç”¨å„ç§è„šæœ¬å’Œå·¥å…·æ¥å®Œæˆçš„ã€‚ åˆ‡æ¢åˆ°äº† Gitlabï¼Œè‡ªç„¶ä¹Ÿéœ€è¦ä¸€ä¸ªå·¥å…·æ¥å®Œæˆä¸Šè¿°æ“ä½œäº†ã€‚é‚£ä¹ˆ python-gitlab CLI è¿™ä¸ªå·¥å…·æ— ç–‘æ˜¯ä¸äºŒä¹‹é€‰ï¼Œç”šè‡³æ¯”ä¹‹å‰çš„å·¥å…·æ›´æ–¹ä¾¿ã€‚å› ä¸ºè¿„ä»Šä¸ºæ­¢è¿˜æ²¡æœ‰è§åˆ°è¿‡ GitHub èƒ½æœ‰åƒ python-gitlab è¿™æ ·çš„å·¥å…·ã€‚æ€»ä¹‹ï¼Œå¯¹äºä½¿ç”¨ Gitlab çš„äººæ¥è®²ï¼Œè¦å¯¹ repo å®Œæˆä¸€äº›è‡ªåŠ¨åŒ–å¤„ç†çš„å·¥ä½œï¼Œå¼ºçƒˆæ¨èä½¿ç”¨è¿™ä¸ª CLI å·¥å…·ï¼Œå®ƒå¯ä»¥å¾ˆæ–¹ä¾¿åœ°é›†æˆåœ¨æµæ°´çº¿ä¸­ã€‚</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>python-gitlab CLI ä¾èµ– Python 2.7 æˆ–è€… 3.4+ï¼Œ2021 å¹´å•¦ï¼Œå°±ä¸è¦ä½¿ç”¨ Python2.7 å•¦ğŸ˜Šã€‚æœ¬åœ°å®‰è£…å¥½ python3 å’Œ pip3 åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…å³å¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨è¿™é‡Œä½¿ç”¨æ¸…åçš„ pypi æºæ¥åŠ é€Ÿå®‰è£…ï¼Œæ¯•ç«Ÿæ˜¯å¢™ğŸ§±å›½</span></span><br><span class="line">$ sudo pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple requests PyYAML python-gitlab</span><br></pre></td></tr></table></figure><p>ç”±äºä½¿ç”¨è¿™ä¸ªå·¥å…·çš„åœºæ™¯å¤§å¤šæ•°æ˜¯åœ¨ Jenkins æ‰€åˆ›å»ºçš„ slave pod ä¸­æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥æ„å»ºä¸€ä¸ª docker é•œåƒï¼Œ <code>Dockerfile</code> å¦‚ä¸‹</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:buster</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt update \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt install -y --no-install-recommends \</span></span><br><span class="line"><span class="bash">        git \</span></span><br><span class="line"><span class="bash">        python3 \</span></span><br><span class="line"><span class="bash">        python3-pip \</span></span><br><span class="line"><span class="bash">        jq \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /var/lib/apt/lists/* \</span></span><br><span class="line"><span class="bash">    &amp;&amp; pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple requests PyYAML python-gitlab</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> python-gitlab.cfg /etc/python-gitlab.cfg</span></span><br></pre></td></tr></table></figure><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>Gitlab CLI å·¥å…·éœ€è¦ä½¿ç”¨ä¸€ä¸ª <code>python-gitlab.cfg</code> é…ç½®æ–‡ä»¶ç”¨äºè¿æ¥ Gitlab æœåŠ¡å™¨ä»¥åŠå®Œæˆä¸€äº›é‰´æƒè®¤è¯ï¼Œé…ç½®æ–‡ä»¶æ ¼å¼ä¸º <code>ini</code> å¦‚ä¸‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[global]</span></span><br><span class="line"><span class="attr">default</span> = gitlab.com</span><br><span class="line"><span class="attr">ssl_verify</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">timeout</span> = <span class="number">5</span></span><br><span class="line"><span class="attr">per_page</span> = <span class="number">100</span></span><br><span class="line"><span class="attr">api_version</span> = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="section">[gitlab.com]</span></span><br><span class="line"><span class="attr">url</span> = https://gitlab.com</span><br><span class="line"><span class="attr">private_token</span> = xxxxxxxxx</span><br></pre></td></tr></table></figure><ul><li>å…¨å±€çš„è¿æ¥å‚æ•°</li></ul><table><thead><tr><th>Option</th><th>Possible values</th><th>Description</th></tr></thead><tbody><tr><td><code>ssl_verify</code></td><td><code>True</code> æˆ– <code>False</code></td><td>æ˜¯å¦å¼€å¯ SSL åŠ å¯†éªŒè¯</td></tr><tr><td><code>timeout</code></td><td>è¯ä¹¦</td><td>è¿æ¥è¶…æ—¶æ—¶é—´</td></tr><tr><td><code>api_version</code></td><td><code>4</code></td><td>API çš„ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸º 4 å³å¯ï¼Œå‚è€ƒ <a href="https://docs.gitlab.com/ee/api/v3_to_v4.html" target="_blank" rel="noopener">API V3 to API V4</a></td></tr><tr><td><code>per_page</code></td><td>1 ï½ 100</td><td>æ¯æ¬¡è¿”å›çš„å…ƒç´ æ•°é‡ï¼ŒGitlab çš„æœ€å¤§é™åˆ¶ä¸º 100ã€‚å¯ä»¥é€šè¿‡ <code>--all</code> å‚æ•°è·å–æ‰€æœ‰çš„å…ƒç´ </td></tr></tbody></table><ul><li>è‡ªå®šä¹‰ GitLab server å‚æ•°</li></ul><table><thead><tr><th>Option</th><th>Description</th></tr></thead><tbody><tr><td><code>url</code></td><td>GitLab server çš„ URL</td></tr><tr><td><code>private_token</code></td><td>é€šè¿‡è®¿é—® gitlab æœåŠ¡å™¨çš„ <a href="https://gitlab.com/-/profile/personal_access_tokens" target="_blank" rel="noopener">-/profile/personal_access_tokens</a> æ¥ç”Ÿæˆ token</td></tr><tr><td><code>oauth_token</code></td><td></td></tr><tr><td><code>job_token</code></td><td></td></tr><tr><td><code>api_version</code></td><td>API çš„ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸º 4 å³å¯ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨å®šä¹‰ï¼Œä½¿ç”¨å…¨å±€å‚æ•°</td></tr><tr><td><code>http_username</code></td><td>Gitlab ç”¨æˆ·åï¼Œä¸æ¨èä½¿ç”¨å®ƒæ¥è¿æ¥ Gitlab æœåŠ¡å™¨</td></tr><tr><td><code>http_password</code></td><td>Gitlab å¯†ç ï¼Œä¸æ¨èä½¿ç”¨å®ƒæ¥è¿æ¥ Gitlab æœåŠ¡å™¨</td></tr></tbody></table><p>å°†æ–‡ä»¶ä¿å­˜åœ¨ <code>~/.python-gitlab.cfg</code> æˆ–è€… <code>/etc/python-gitlab.cfg</code> ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡ <code>PYTHON_GITLAB_CFG</code> æˆ–è€… <code>--config-file</code> æ‰§è¡Œé…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œä¸ºäº†çœäº‹å„¿è¿˜æ˜¯å°†å®ƒæ”¾åˆ° <code>~/.python-gitlab.cfg</code> ä¸‹ã€‚</p><p>é…ç½®å®Œæˆä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ <code>gitlab current-user get</code> å‘½ä»¤æµ‹è¯•è¿æ¥æ˜¯å¦æ­£å¸¸ï¼Œå¦‚æœæœ‰è¿”å›å€¼ä¸”æ­£ç¡®çš„ç”¨æˆ·åè¯´æ˜é…ç½®æˆåŠŸäº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab current-user get</span><br><span class="line">username: muzi502</span><br></pre></td></tr></table></figure><h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h3><p>gitlab å‘½ä»¤è¡Œå·¥å…·ä¸»è¦æ˜¯å¯¹ Gitlab æœåŠ¡å™¨ä¸Šçš„å„ç§å¯¹è±¡å¦‚ï¼šuser, project, file, repo, mr, tag, commit ç­‰è¿›è¡Œå¢åˆ æ”¹æŸ¥(getã€listã€createã€deleteã€update)ã€‚ä½¿ç”¨çš„å‘½ä»¤è¡Œæ ¼å¼æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab &lt;option&gt; [object] [action] &lt;option&gt;</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æ¥è®²åªéœ€è¦ 4 ç§å‚æ•°ï¼š</p><ul><li><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç´§æ¥ç€ gitlab å‘½ä»¤åé¢çš„å‚æ•°ï¼Œå®ƒæ˜¯ gitlab å‘½ä»¤è¡Œçš„è¾“å‡ºå‚æ•°å’Œé…ç½®å‚æ•°ï¼Œå¦‚ <code>-o</code>å‚æ•°æŒ‡å®šè¾“å‡ºç»“æœçš„æ ¼å¼ï¼›<code>-f</code> å‚æ•°å°†è¾“å‡ºç»“æœå­˜æ”¾åˆ°æ–‡ä»¶ä¸­; <code>-g</code> å‚æ•°æ‰§è¡Œè¿æ¥å“ªä¸ª Gitlab æœåŠ¡å™¨ã€‚</p></li><li><p>ç¬¬äºŒä¸ªå‚æ•°åˆ™æ˜¯ç”¨æ¥æŒ‡å®šæ‰€è¦æ“ä½œçš„å¯¹è±¡ï¼Œæ¯”å¦‚ project-merge-requestï¼Œproject-tag ç­‰ï¼Œæ‰€æ”¯æŒçš„å¯¹è±¡æœ‰å¾ˆå¤šï¼ŒåŸºæœ¬ä¸Šæ¶µç›–äº†æ‰€æœ‰ Gitlab API æ‰€æ”¯æŒçš„æ“ä½œå¯¹è±¡ï¼Œå¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab -h</span><br><span class="line">usage: gitlab [-h] [--version] [-v] [-d] [-c CONFIG_FILE] [-g GITLAB] [-o &#123;json,legacy,yaml&#125;] [-f FIELDS]</span><br><span class="line">&#123;application,application-appearance,application-settings,audit-event,broadcast-message,current-user,current-user-email,current-user-gp-gkey,current-user-key,current-user-status,deploy-key,deploy-token,dockerfile,event,feature,geo-node,gitignore,gitlabciyml,group,group-access-request,group-badge,group-board,group-board-list,group-cluster,group-custom-attribute,group-deploy-token,group-epic,group-epic-issue,group-epic-resource-label-event,group-export,group-import,group-issue,group-label,group-member,group-merge-request,group-milestone,group-notification-settings,group-package,group-project,group-runner,group-subgroup,group-variable,hook,issue,l-da-pgroup,license,merge-request,namespace,notification-settings,pages-domain,project,project-access-request,project-additional-statistics,project-approval,project-approval-rule,project-badge,project-board,project-board-list,project-branch,project-cluster,project-commit,project-commit-comment,project-commit-discussion,project-commit-discussion-note,project-commit-status,project-custom-attribute,project-deploy-token,project-deployment,project-environment,project-event,project-export,project-file,project-fork,project-hook,project-import,project-issue,project-issue-award-emoji,project-issue-discussion,project-issue-discussion-note,project-issue-link,project-issue-note,project-issue-note-award-emoji,project-issue-resource-label-event,project-issue-resource-milestone-event,project-issues-statistics,project-job,project-key,project-label,project-member,project-merge-request,project-merge-request-approval,project-merge-request-approval-rule,project-merge-request-award-emoji,project-merge-request-diff,project-merge-request-discussion,project-merge-request-discussion-note,project-merge-request-note,project-merge-request-note-award-emoji,project-merge-request-resource-label-event,project-merge-request-resource-milestone-event,project-milestone,project-note,project-notification-settings,project-package,project-pages-domain,project-pipeline,project-pipeline-bridge,project-pipeline-job,project-pipeline-schedule,project-pipeline-schedule-variable,project-pipeline-variable,project-protected-branch,project-protected-tag,project-push-rules,project-registry-repository,project-registry-tag,project-release,project-remote-mirror,project-runner,project-service,project-snippet,project-snippet-award-emoji,project-snippet-discussion,project-snippet-discussion-note,project-snippet-note,project-snippet-note-award-emoji,project-tag,project-trigger,project-user,project-variable,project-wiki,runner,runner-job,snippet,todo,user,user-activities,user-custom-attribute,user-email,user-event,user-gp-gkey,user-impersonation-token,user-key,user-membership,user-project,user-status,variable&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¬¬ä¸‰ä¸ªå‚æ•°åˆ™æ˜¯ action å‚æ•°ï¼Œå³ç”¨äºæŒ‡å®šå¯¹æ‰€æ“ä½œçš„å¯¹è±¡è¿›è¡Œä½•ç§æ“ä½œï¼Œä¸€èˆ¬æ¥è®²éƒ½ä¼šæ”¯æŒå¢åˆ æ”¹æŸ¥æ“ä½œï¼ˆget, list, create, update, deleteï¼‰</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab project-tag</span><br><span class="line">usage: gitlab project-tag [-h] &#123;list,get,create,delete,<span class="built_in">set</span>-release-description&#125; ...</span><br></pre></td></tr></table></figure><ul><li>ç¬¬ä¸‰ä¸ªå‚æ•°åˆ™æ˜¯ object + action æ‰€ä¾èµ–çš„å‚æ•°ï¼Œæ¯”å¦‚æŒ‡å®š project id</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab project-tag list</span><br><span class="line">usage: gitlab project-tag list --project-id PROJECT_ID [--page PAGE] [--per-page PER_PAGE] [--all]</span><br><span class="line">gitlab project-tag list: error: the following arguments are required: --project-id</span><br></pre></td></tr></table></figure><ul><li><p>Project-IDï¼šæ˜¯ gitlab ä¸Šå”¯ä¸€è¡¨ç¤ºè¯¥ repo çš„ IDï¼Œå¯åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯ <code>group/project</code> çš„å½¢å¼ï¼Œå…¶ä¸­ <code>/</code> è¦è½¬è¯‘æˆ <code>%2F</code> å¦‚ï¼š<code>muzi502%2Fkubespray</code>ï¼›å¦ä¸€ç§åˆ™æ˜¯æ•°å­—çš„å½¢å¼ï¼Œåœ¨è¯¥ repo çš„ web é¡µé¢ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œæ¨èä½¿ç”¨ç¬¬äºŒç§ã€‚</p><p><img src="https://p.k8s.li/image-20210319085926423.png" alt="image-20210319085926423"></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ä½¿ç”¨gitlab å‘½ä»¤è·å– repo çš„ id</span></span><br><span class="line">$ gitlab project get --id muzi502%2Fkubespray</span><br><span class="line">id: 25099880</span><br><span class="line">path: kubespray</span><br></pre></td></tr></table></figure><ul><li>åœ¨æµæ°´çº¿ä¸­å¯ä»¥æ ¹æ® token è·å–ç”¨æˆ·çš„ç”¨æˆ·åå’Œé‚®ç®±ï¼Œç”¨äºé…ç½®æµæ°´çº¿ä¸­çš„ repo git ä¿¡æ¯ï¼Œé¿å…å› ä¸º CLA æ— æ³•é€šè¿‡ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gitlab -o json current-user get | jq '.id'</span><br><span class="line">git config --global user.email $(gitlab -o json current-user get | jq -r '.email')</span><br><span class="line">git config --global user.name $(gitlab -o json current-user get | jq -r '.username')</span><br></pre></td></tr></table></figure><h3 id="project"><a href="#project" class="headerlink" title="project"></a>project</h3><ul><li>è·å– repo ssh url  åœ°å€</li></ul><p>ç”±äº Jenkins æµæ°´çº¿ä¸­ clone çš„ repo url æ˜¯ä½¿ç”¨ token+ https çš„æ–¹å¼ï¼Œåœ¨æµæ°´çº¿ä¸­å¦‚æœè¦ push ä»£ç åˆ° repo éœ€è¦ä¿®æ”¹ä¸º ssh çš„æ–¹å¼ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ ¹æ® project id æ¥è·å–è¯¥ repo çš„ ssh urlã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab -o json  project get --id <span class="variable">$&#123;PROJECT_ID&#125;</span> | jq -r <span class="string">'.ssh_url_to_repo'</span></span><br><span class="line">$ git remote remove origin</span><br><span class="line">$ git remote add origin $(gitlab -o json  project get --id <span class="variable">$&#123;PROJECT_ID&#125;</span> | jq -r <span class="string">'.ssh_url_to_repo'</span>)</span><br></pre></td></tr></table></figure><h3 id="file"><a href="#file" class="headerlink" title="file"></a>file</h3><p>å¯¹äº repo ä¸­æ–‡ä»¶çš„æ“ä½œä½¿ç”¨ project-file</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab project-file</span><br><span class="line">usage: gitlab project-file [-h] &#123;get,create,update,delete,raw,blame&#125; ...</span><br></pre></td></tr></table></figure><ul><li>è·å–æ–‡ä»¶ï¼Œé€šè¿‡ <code>project-file</code> å¯¹è±¡çš„ get æ“ä½œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab -o json project-file get --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span> --file-path .gitignore --ref master  | jq <span class="string">'.'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"file_name"</span>: <span class="string">".gitignore"</span>,</span><br><span class="line">  <span class="string">"file_path"</span>: <span class="string">".gitignore"</span>,</span><br><span class="line">  <span class="string">"size"</span>: 1208,</span><br><span class="line">  <span class="string">"encoding"</span>: <span class="string">"base64"</span>,</span><br><span class="line">  <span class="string">"content_sha256"</span>: <span class="string">"91f1d50ba3a4f79f96d9371afc70b389f75dfb2ac5190b8fb01051aa8679fd04"</span>,</span><br><span class="line">  <span class="string">"ref"</span>: <span class="string">"master"</span>,</span><br><span class="line">  <span class="string">"blob_id"</span>: <span class="string">"b09ca9d3b101034c7e34430177c1d64738df5fbb"</span>,</span><br><span class="line">  <span class="string">"commit_id"</span>: <span class="string">"a9c97e5253c455546c2c7fdd794147eeb9b8ab7a"</span>,</span><br><span class="line">  <span class="string">"last_commit_id"</span>: <span class="string">"4ffc106c58fc5865b6d72a52365e25b8c268d4d8"</span>,</span><br><span class="line">  <span class="string">"content"</span>: <span class="string">"LnZhZ3JhbnQKKi5yZXRyeQoqKi92YWdyYW50X2Fuc2libGVfaW52ZW50b3J5CiouaW1sCnRlbXAKLmlkZWEKLnRveAouY2FjaGUKKi5iYWsKKi50ZnN0YXRlCioudGZzdGF0ZS5iYWNrdXAKLnRlcnJhZm9ybS8KY29udHJpYi90ZXJyYWZvcm0vYXdzL2NyZWRlbnRpYWxzLnRmdmFycwovc3NoLWJhc3Rpb24uY29uZgoqKi8qLnN3W3Bvbl0KKn4KdmFncmFudC8KcGx1Z2lucy9taXRvZ2VuCgojIEFuc2libGUgaW52ZW50b3J5CmludmVudG9yeS8qCiFpbnZlbnRvcnkvbG9jYWwKIWludmVudG9yeS9zYW1wbGUKaW52ZW50b3J5LyovYXJ0aWZhY3RzLwoKIyBCeXRlLWNvbXBpbGVkIC8gb3B0aW1pemVkIC8gRExMIGZpbGVzCl9fcHljYWNoZV9fLwoqLnB5W2NvZF0KKiRweS5jbGFzcwoKIyBEaXN0cmlidXRpb24gLyBwYWNrYWdpbmcKLlB5dGhvbgplbnYvCmJ1aWxkLwpjcmVkZW50aWFscy8KZGV2ZWxvcC1lZ2dzLwpkaXN0Lwpkb3dubG9hZHMvCmVnZ3MvCi5lZ2dzLwpwYXJ0cy8Kc2Rpc3QvCnZhci8KKi5lZ2ctaW5mby8KLmluc3RhbGxlZC5jZmcKKi5lZ2cKCiMgUHlJbnN0YWxsZXIKIyAgVXN1YWxseSB0aGVzZSBmaWxlcyBhcmUgd3JpdHRlbiBieSBhIHB5dGhvbiBzY3JpcHQgZnJvbSBhIHRlbXBsYXRlCiMgIGJlZm9yZSBQeUluc3RhbGxlciBidWlsZHMgdGhlIGV4ZSwgc28gYXMgdG8gaW5qZWN0IGRhdGUvb3RoZXIgaW5mb3MgaW50byBpdC4KKi5tYW5pZmVzdAoqLnNwZWMKCiMgSW5zdGFsbGVyIGxvZ3MKcGlwLWxvZy50eHQKcGlwLWRlbGV0ZS10aGlzLWRpcmVjdG9yeS50eHQKCiMgVW5pdCB0ZXN0IC8gY292ZXJhZ2UgcmVwb3J0cwpodG1sY292LwoudG94LwouY292ZXJhZ2UKLmNvdmVyYWdlLioKLmNhY2hlCm5vc2V0ZXN0cy54bWwKY292ZXJhZ2UueG1sCiosY292ZXIKLmh5cG90aGVzaXMvCgojIFRyYW5zbGF0aW9ucwoqLm1vCioucG90CgojIERqYW5nbyBzdHVmZjoKKi5sb2cKbG9jYWxfc2V0dGluZ3MucHkKCiMgRmxhc2sgc3R1ZmY6Cmluc3RhbmNlLwoud2ViYXNzZXRzLWNhY2hlCgojIFNjcmFweSBzdHVmZjoKLnNjcmFweQoKIyBTcGhpbnggZG9jdW1lbnRhdGlvbgpkb2NzL19idWlsZC8KCiMgUHlCdWlsZGVyCnRhcmdldC8KCiMgSVB5dGhvbiBOb3RlYm9vawouaXB5bmJfY2hlY2twb2ludHMKCiMgcHllbnYKLnB5dGhvbi12ZXJzaW9uCgojIGRvdGVudgouZW52CgojIHZpcnR1YWxlbnYKdmVudi8KRU5WLwo="</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡ä»¶å†…å®¹æ˜¯ base64 ç¼–ç çš„ï¼Œéœ€è¦ä½¿ç”¨ base64 è§£ç æ‰èƒ½è·å–åŸå§‹çš„å†…å®¹ã€‚</span></span><br><span class="line">$ gitlab -g gitlab -o json project-file get --project-id 25099880 --file-path .gitignore --ref master  | jq -r <span class="string">'.content'</span> | base64 -d</span><br><span class="line">.vagrant</span><br><span class="line">*.retry</span><br><span class="line">**/vagrant_ansible_inventory</span><br><span class="line">*.iml</span><br><span class="line">temp</span><br><span class="line">.idea</span><br><span class="line">.tox</span><br><span class="line">â€¦â€¦â€¦â€¦</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡ project-file çš„ raw æ–¹æ³•å¯ä»¥è·å–æ–‡ä»¶çš„åŸå§‹å†…å®¹ï¼Œæ— é¡» base64 è§£ç </li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab project-file get --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span> --file-path .gitignore --ref master</span><br></pre></td></tr></table></figure><ul><li><p>åˆ›å»ºæ–‡ä»¶ï¼Œå¯¹æ–‡ä»¶çš„å¢åˆ æ”¹éƒ½æ˜¯é€šè¿‡æäº¤ commit æ¥å®Œæˆçš„ï¼Œå› æ­¤éœ€è¦æŒ‡å®šæ‰€è¦æ“ä½œçš„åˆ†æ”¯ä»¥åŠ commit-message çš„ä¿¡æ¯ã€‚å¦å¤–å¦‚æœæ“ä½œçš„æ–‡ä»¶æ˜¯ master åˆ†æ”¯è·å–å…¶ä»–ä¿æŠ¤åˆ†æ”¯ï¼Œè¦ç¡®ä¿å½“å‰ç”¨æˆ·æœ‰å†™å…¥çš„æƒé™ï¼Œä¸ç„¶ä¼šæç¤ºå¦‚ä¸‹é”™è¯¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gitlab project-file update</span><br><span class="line">Impossible to update object (400: You are not allowed to push into this branch)</span><br></pre></td></tr></table></figure></li></ul><p>ä¹‹å‰åœ¨ GitHub ä¸Šæœ‰ä¸€å¥— CI å¹¶ä¸èƒ½é€‚ç”¨äº Gitlabï¼Œå› æ­¤éœ€è¦ä¸ºæ‰€æœ‰çš„åˆ†æ”¯åˆ›å»º CI æµæ°´çº¿ï¼Œç”¨äºæ£€æŸ¥ä»£ç æ˜¯å¦ç¬¦åˆè§„èŒƒï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•æ‰¹é‡é‡åœ°å‘æ‰€æœ‰åˆ†æ”¯åˆ›å»ºæ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ID=123456</span><br><span class="line">BRANCHS=$(gitlab -o json project-branch list --project-id <span class="variable">$&#123;ID&#125;</span> --all | jq -r <span class="string">".[].name"</span>)</span><br><span class="line"><span class="keyword">for</span> branch <span class="keyword">in</span> <span class="variable">$&#123;BRANCHS&#125;</span>; <span class="keyword">do</span></span><br><span class="line">gitlab project-file create --project-id <span class="variable">$&#123;ID&#125;</span> --file-path .gitlab-ci.yml --branch <span class="variable">$&#123;branch&#125;</span> --content @.gitlab-ci.yml --commit-message <span class="string">"feat(gitlab-ci): add gitlab-ci.yml for ci"</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><ul><li>æ›´æ–°æ–‡ä»¶</li></ul><p>æ¯”å¦‚æ‰¹é‡æ›´æ–°æ‰€æœ‰åˆ†æ”¯çš„ <code>Makefile</code> ä¸­ <code>github.com</code> ä¸º <code>gitlab.com</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ID=123456</span><br><span class="line">BRANCHS=$(gitlab -o json project-branch list --project-id <span class="variable">$&#123;ID&#125;</span> --all | jq -r <span class="string">".[].name"</span>)</span><br><span class="line"><span class="keyword">for</span> branch <span class="keyword">in</span> <span class="variable">$&#123;BRANCHS&#125;</span>; <span class="keyword">do</span></span><br><span class="line">    rm -f Makefile Makefile-</span><br><span class="line">    gitlab project-file raw --project-id <span class="variable">$&#123;ID&#125;</span> --file-path Makefile --ref <span class="variable">$&#123;branch&#125;</span> &gt; Makefile</span><br><span class="line">    sed -i- <span class="string">"s|github.com/muzi502|gitlab.com/muzi502"</span> Makefile</span><br><span class="line">    gitlab project-file update --project-id <span class="variable">$&#123;ID&#125;</span> --file-path Makefile --branch <span class="variable">$&#123;branch&#125;</span> --content @Makefile \</span><br><span class="line">    --commit-message <span class="string">"chore(Makefile): update repo url in Makefile for migrate gitlab"</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><ul><li>åˆ é™¤æ–‡ä»¶</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab project-file delete --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span> --file-path .gitignore --ref master \</span><br><span class="line">--commit-message <span class="string">"test delete file"</span></span><br></pre></td></tr></table></figure><h3 id="MR-1"><a href="#MR-1" class="headerlink" title="MR"></a>MR</h3><ul><li>åˆ›å»º MRï¼ŒæŒ‡å®š source branch å’Œ target branch ä»¥åŠ mr çš„ title è¿™ä¸‰ä¸ªå‚æ•°ã€‚å‰é¢æœ€å¥½åŠ ä¸Š -o json å‚æ•°ç”¨æˆ·è·å– mr çš„ iidï¼Œå¯é€šè¿‡æ­¤ iid æ¥å¯¹è¿™ä¸ª mr è¿›è¡Œå¢åˆ æ”¹æŸ¥ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab -o json project-merge-request create --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span> --<span class="built_in">source</span>-branch --target-branch <span class="variable">$&#123;BASE_BRANCH&#125;</span> --title <span class="string">"<span class="variable">$&#123;MR_TITLE&#125;</span>"</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡ -o json å‚æ•°ä¼šè¿”å›æ­¤ mr çš„ä¿¡æ¯ï¼Œå…¶ä¸­ <code>iid</code> å°±æ˜¯è¯¥ mr åœ¨æ­¤ repo ä¸­çš„å”¯ä¸€æ ‡ç¤º</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab -g gitlab -o json project-merge-request create --project-id 25099880 --source-branch release-2.14 --target-branch  master --title "mr create test"</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"id"</span>: <span class="number">92872102</span>,</span><br><span class="line">  <span class="attr">"iid"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">"project_id"</span>: <span class="number">25099880</span>,</span><br><span class="line">  <span class="attr">"title"</span>: <span class="string">"mr create test"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"state"</span>: <span class="string">"opened"</span>,</span><br><span class="line">  <span class="attr">"created_at"</span>: <span class="string">"2021-03-21T12:42:52.893Z"</span>,</span><br><span class="line">  <span class="attr">"updated_at"</span>: <span class="string">"2021-03-21T12:42:52.893Z"</span>,</span><br><span class="line">  <span class="attr">"merged_by"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"merged_at"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"closed_by"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"closed_at"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"target_branch"</span>: <span class="string">"master"</span>,</span><br><span class="line">  <span class="attr">"source_branch"</span>: <span class="string">"release-2.14"</span>,</span><br><span class="line">  <span class="attr">"user_notes_count"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">"upvotes"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">"downvotes"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">"author"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">5599205</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"muzi502"</span>,</span><br><span class="line">    <span class="attr">"username"</span>: <span class="string">"muzi502"</span>,</span><br><span class="line">    <span class="attr">"state"</span>: <span class="string">"active"</span>,</span><br><span class="line">    <span class="attr">"avatar_url"</span>: <span class="string">"https://secure.gravatar.com/avatar/f91578ffea9a538eedd8fbaf3007289b?s=80&amp;d=identicon"</span>,</span><br><span class="line">    <span class="attr">"web_url"</span>: <span class="string">"https://gitlab.com/muzi502"</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ul><li>åˆå¹¶ MR</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab project-merge-request merge --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span> --iid @mr_iid</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ MR çŠ¶æ€</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab -o json project-merge-request get --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span> --iid @mr_iid | jq -r <span class="string">".state"</span></span><br></pre></td></tr></table></figure><ul><li>é›†æˆåœ¨ Jenkinsfile  ä¸­å®Œæˆåˆ›å»º MRã€åˆå¹¶ MRã€æ£€æŸ¥ MR </li></ul><p>è°ƒç”¨ç”¨å®ƒçš„æ—¶å€™åªéœ€è¦ä¼ å…¥ SOURCE_BRANCH, TARGET_BRANCH, MR_TITLE è¿™ä¸‰ä¸ªå‚æ•°å³å¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">def makeMR(SOURCE_BRANCH, TARGET_BRANCH, MR_TITLE) &#123;</span><br><span class="line">    container(<span class="string">"debian"</span>) &#123;</span><br><span class="line">        sh <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        gitlab -o json project-merge-request create --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span>  --title \"<span class="variable">$&#123;MR_TITLE&#125;</span>\" \</span></span><br><span class="line"><span class="string">        --source-branch <span class="variable">$&#123;SOURCE_BRANCH&#125;</span> --target-branch <span class="variable">$&#123;TARGET_BRANCH&#125;</span> &gt; mr_info.json</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        jq -r '.iid' mr_info.json &gt; mr_iid</span></span><br><span class="line"><span class="string">        jq -r '.web_url' mr_info.json &gt; mr_url</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def <span class="function"><span class="title">checkMR</span></span>() &#123;</span><br><span class="line">    container(<span class="string">"debian"</span>) &#123;</span><br><span class="line">        retry(120) &#123;</span><br><span class="line">        sh <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        if [ ! -s mr_iid ]; then exit 0; else sleep 60s; fi</span></span><br><span class="line"><span class="string">        gitlab -o json project-merge-request get --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span> --iid @mr_iid | jq -r "</span>.labels[]<span class="string">" | grep 'approve'</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def <span class="function"><span class="title">mergeMR</span></span>()&#123;</span><br><span class="line">    container(<span class="string">"debian"</span>) &#123;</span><br><span class="line">        retry(10)&#123;</span><br><span class="line">        sh <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        if [ ! -s mr_iid ]; then exit 0; else sleep 60s; fi</span></span><br><span class="line"><span class="string">        if gitlab project-merge-request merge --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span> --iid @mr_iid; then sleep 10s; fi</span></span><br><span class="line"><span class="string">        gitlab -o json project-merge-request get --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span> --iid @mr_iid | jq -r "</span>.state<span class="string">" | grep 'merged'</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Tag"><a href="#Tag" class="headerlink" title="Tag"></a>Tag</h3><ul><li>åˆ—å‡º repo tag</li></ul><p>åœ¨è¿™é‡Œè¿˜æ˜¯æ¨èä½¿ç”¨ git tag çš„æ–¹å¼è·å– repo tag ï¼Œå› ä¸º Gitlab API çš„é™åˆ¶ï¼Œæ¯æ¬¡è¯·æ±‚æœ€å¤šåªèƒ½è¿”å› 100 ä¸ªå€¼ï¼Œå¯ä»¥åŠ ä¸Š <code>--all</code> å‚æ•°æ¥è¿”å›æ‰€æœ‰çš„å€¼ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab -o json project-tag list --project-id <span class="variable">$&#123;ID&#125;</span> | jq -r <span class="string">'.[].name'</span></span><br><span class="line">$ gitlab -o json project-tag list --project-id <span class="variable">$&#123;ID&#125;</span> --all | jq -r <span class="string">'.[].name'</span></span><br></pre></td></tr></table></figure><ul><li>åˆ›å»º tag</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab project-tag create --project-id <span class="variable">$&#123;ID&#125;</span> --tag-name v1.0.0-rc.2 --ref master</span><br></pre></td></tr></table></figure><ul><li>åˆ é™¤ tag</li></ul><p>upstream ä¸Šçš„ repo tag åªèƒ½é€šè¿‡åœ¨ Gitlab ä¸Šåˆ é™¤ï¼Œåœ¨æœ¬åœ° repo ä¸‹æ˜¯æ— æ³•åˆ é™¤çš„ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ é™¤  Gitlab repo tagï¼Œæ³¨æ„ï¼šå—ä¿æŠ¤çš„ repo tag å¦‚æœæ²¡æœ‰æƒé™çš„è¯æ˜¯æ— æ³•åˆ é™¤çš„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab project-tag delete --project-id <span class="variable">$&#123;ID&#125;</span> --tag-name v1.0.0-rc.2</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºå—ä¿æŠ¤çš„ repo tag</li></ul><p>ç”±äºæˆ‘ä»¬æµæ°´çº¿ä»»åŠ¡ä¾èµ–äº repo tag æ¥åšç‰ˆæœ¬çš„å¯¹äºï¼Œå› æ­¤éœ€è¦ä¿æŠ¤æ¯ä¸€ä¸ª repo tagï¼Œä½†æœ‰ç‰¹æ®Šæƒ…å†µä¸‹åˆè¦è¦†ç›– repo tagï¼Œæ‰€ä»¥å—ä¿æŠ¤çš„ repo tag ç›®å‰è¿˜æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ–¹æ³•ï¼Œåªèƒ½å…ˆæ‰‹åŠ¨åˆ›å»ºäº†ï¼Œç­‰åˆ°éœ€è¦åˆ é™¤çš„æ—¶å€™å†åˆ é™¤å®ƒã€‚å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ‰¹é‡åˆ›å»ºå—ä¿æŠ¤çš„ repo tagã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag | xargs -L1 -I &#123;&#125; gitlab project-protected-tag create --project-id <span class="variable">$&#123;ID&#125;</span> --name &#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="Lint-æµæ°´çº¿"><a href="#Lint-æµæ°´çº¿" class="headerlink" title="Lint æµæ°´çº¿"></a>Lint æµæ°´çº¿</h2><p>è¿ç§»åˆ°äº† Gitlab ä¹‹ååŸæœ‰çš„æµæ°´çº¿åœ¨å†…ç½‘çš„ Gitlab ä¸Šä¹Ÿå°±æ— æ³•ä½¿ç”¨äº†ï¼Œä¸ºäº†å‡å°‘ç»´æŠ¤æˆæœ¬å°±ä½¿ç”¨äº† Gitlab è‡ªå¸¦çš„ CI ã€‚æˆ‘æ‰€ç»´æŠ¤çš„ repo ä½¿ç”¨ Gitlab CI åªæ˜¯åšä¸€äº› lint çš„æ£€æŸ¥å†…å®¹ï¼Œå› æ­¤ CI é…ç½®èµ·æ¥ä¹Ÿç‰¹åˆ«ç®€å•ã€‚å¦‚ kubespray çš„ CI é…ç½®ï¼š</p><ul><li><code>.gitlab-ci.yml</code></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">lint:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">'quay.io/kubespray/kubespray:v2.15.0'</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">chmod</span> <span class="string">-R</span> <span class="string">o-w</span> <span class="string">.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">make</span> <span class="string">lint</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">shared</span></span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ gitlab CLI å·¥å…·ç»™æ‰€æœ‰åˆ†æ”¯æ·»åŠ  <code>.gitlab-ci.yml</code> æ–‡ä»¶</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ID=123456</span><br><span class="line">BRANCHS=$(gitlab -o json project-branch list --project-id <span class="variable">$&#123;ID&#125;</span> --all | jq -r <span class="string">".[].name"</span>)</span><br><span class="line"><span class="keyword">for</span> branch <span class="keyword">in</span> <span class="variable">$&#123;BRANCHS&#125;</span>; <span class="keyword">do</span></span><br><span class="line">gitlab project-file create --project-id <span class="variable">$&#123;ID&#125;</span> --file-path .gitlab-ci.yml --branch <span class="variable">$&#123;branch&#125;</span> --content @.gitlab-ci.yml --commit-message <span class="string">"feat(gitlab-ci): add gitlab-ci.yml for ci"</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><ul><li>repo è¿ç§»</li></ul><p>ç”±äºå†…éƒ¨çš„ Gitlab ä¸æ”¯æŒå¯¼å…¥ git url çš„æ–¹å¼ï¼Œæ‰€ä»¥åªèƒ½æ‰‹åŠ¨åœ°å°† GitHub ä¸Šçš„ repo clone åˆ°æœ¬åœ°å† push åˆ° Gitlab ä¸Šã€‚ä½¿ç”¨ git clone çš„æ–¹å¼æœ¬åœ°åªä¼šæœ‰ä¸€ä¸ª master åˆ†æ”¯ï¼Œè¦æŠŠ GitHub ä¸Š repo çš„æ‰€æœ‰åˆ†æ”¯éƒ½ track ä¸€éï¼Œç„¶åå† push åˆ° Gitlab ä¸Šã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ git clone ä¸‹æ¥çš„ repo é»˜è®¤ä¸º master åˆ†æ”¯</span></span><br><span class="line">$ git <span class="built_in">clone</span> git@gitlab.com/muzi502/kubespray.git</span><br><span class="line"><span class="comment"># track å‡º origin ä¸Šçš„æ‰€æœ‰åˆ†æ”¯</span></span><br><span class="line">$ git branch -r | grep -v <span class="string">'\-&gt;'</span> | <span class="keyword">while</span> <span class="built_in">read</span> remote; <span class="keyword">do</span> git branch --track <span class="string">"<span class="variable">$&#123;remote#origin/&#125;</span>"</span> <span class="string">"<span class="variable">$remote</span>"</span>; <span class="keyword">done</span></span><br><span class="line">$ git fetch --all</span><br><span class="line">$ git pull --all</span><br><span class="line">$ git remote remove origin</span><br><span class="line">$ git remote add origin git@gitlab/gitlab502/kubespray.git</span><br><span class="line">$ git push origin --all</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://stackoverflow.com/questions/10312521/how-to-fetch-all-git-branches" target="_blank" rel="noopener">How to fetch all Git branches</a></li><li><a href="https://yixinglu.gitlab.io/gitlab-workflow.html" target="_blank" rel="noopener">GitLab å·¥ä½œæµ</a></li><li><a href="https://python-gitlab.readthedocs.io/" target="_blank" rel="noopener">python-gitlab</a></li><li><a href="https://docs.gitlab.com/ee/api/README.html" target="_blank" rel="noopener">Gitlab API Docs</a></li><li><a href="https://github.com/xanzy/go-gitlab" target="_blank" rel="noopener">go-gitlab</a></li><li><a href="https://mp.weixin.qq.com/s/x5PHNn87OYCSpYE_hb8I2A" target="_blank" rel="noopener">è°ˆè°ˆ Git å­˜å‚¨åŸç†åŠç›¸å…³å®ç°</a></li><li><a href="https://morningspace.github.io/tech/inside-git-3/" target="_blank" rel="noopener">Gitè§£å¯†â€”â€”è®¤è¯†Gitå¼•ç”¨</a></li><li><a href="https://blinkfox.github.io/2018/11/22/ruan-jian-gong-ju/devops/gitlab-ci-jie-shao-he-shi-yong/" target="_blank" rel="noopener">GitLab CI/CD ä»‹ç»å’Œä½¿ç”¨</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;å¼€å€’è½¦-ğŸš—-ï¼Ÿ&quot;&gt;&lt;a
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="ci" scheme="https://blog.k8s.li/tags/ci/"/>
    
      <category term="gitlab" scheme="https://blog.k8s.li/tags/gitlab/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins å¤§å”ä¸ kubernetes èˆ¹é•¿æ‰‹ç‰µæ‰‹ ğŸ§‘â€ğŸ¤â€ğŸ§‘</title>
    <link href="https://blog.k8s.li/jenkins-with-kubernetes.html"/>
    <id>https://blog.k8s.li/jenkins-with-kubernetes.html</id>
    <published>2021-03-05T16:00:00.000Z</published>
    <updated>2021-03-06T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è™½ç„¶äº‘åŸç”Ÿæ—¶ä»£æœ‰äº† <a href="https://jenkins-x.io/" target="_blank" rel="noopener">JenkinsX</a>ã€<a href="https://www.drone.io/" target="_blank" rel="noopener">Drone</a>ã€<a href="https://tekton.dev" target="_blank" rel="noopener">Tekton</a> è¿™æ ·çš„åèµ·ä¹‹ç§€ï¼Œä½† Jenkins è¿™æ ·ä¸€ä¸ªè€ç‰Œçš„ CI/CD å·¥å…·ä»æ˜¯å„å¤§å…¬å¸ä¸»æµçš„ä½¿ç”¨æ–¹æ¡ˆã€‚æ¯”å¦‚æˆ‘å¸çš„ç§æœ‰äº‘äº§å“æ‰“åŒ…å‘å¸ƒå°±æ˜¯ç”¨è¿™è€å®¶ä¼™å®Œæˆçš„ã€‚ç„¶è€Œä¼ ç»Ÿçš„ Jenkins Slave ä¸€ä¸»å¤šä»æ–¹å¼ä¼šå­˜åœ¨ä¸€äº›ç—›ç‚¹ï¼Œæ¯”å¦‚ï¼š</p><ul><li>æ¯ä¸ª Slave çš„é…ç½®ç¯å¢ƒä¸ä¸€æ ·ï¼Œæ¥å®Œæˆä¸åŒè¯­è¨€çš„ç¼–è¯‘æ‰“åŒ…ç­‰æ“ä½œï¼Œä½†æ˜¯è¿™äº›å·®å¼‚åŒ–çš„é…ç½®å¯¼è‡´ç®¡ç†èµ·æ¥éå¸¸ä¸æ–¹ä¾¿ï¼Œç»´æŠ¤èµ·æ¥ä¹Ÿæ˜¯æ¯”è¾ƒè´¹åŠ²</li><li>èµ„æºåˆ†é…ä¸å‡è¡¡ï¼Œæœ‰çš„ Slave è¦è¿è¡Œçš„ job å‡ºç°æ’é˜Ÿç­‰å¾…ï¼Œè€Œæœ‰çš„ Slave å¤„äºç©ºé—²çŠ¶æ€</li><li>èµ„æºæœ‰æµªè´¹ï¼Œæ¯å° Slave å¯èƒ½æ˜¯ç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœºï¼Œå½“ Slave å¤„äºç©ºé—²çŠ¶æ€æ—¶ï¼Œä¹Ÿä¸ä¼šå®Œå…¨é‡Šæ”¾æ‰èµ„æºã€‚</li></ul><p>æ­£å› ä¸ºä¸Šé¢çš„ Jenkins slave å­˜åœ¨è¿™äº›ç§ç§ç—›ç‚¹ï¼Œæˆ‘ä»¬æ¸´æœ›ä¸€ç§æ›´é«˜æ•ˆæ›´å¯é çš„æ–¹å¼æ¥å®Œæˆè¿™ä¸ª CI/CD æµç¨‹ï¼Œè€Œ Docker è™šæ‹ŸåŒ–å®¹å™¨æŠ€æœ¯èƒ½å¾ˆå¥½çš„è§£å†³è¿™ä¸ªç—›ç‚¹ï¼Œåˆç‰¹åˆ«æ˜¯åœ¨ Kubernetes é›†ç¾¤ç¯å¢ƒä¸‹é¢èƒ½å¤Ÿæ›´å¥½æ¥è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œä¸‹å›¾æ˜¯åŸºäº Kubernetes æ­å»º Jenkins slave é›†ç¾¤çš„ç®€å•ç¤ºæ„å›¾ï¼š</p><p><img src="https://p.k8s.li/k8s-jenkins-slave.png" alt="k8s-jenkins"></p><p>ä»å›¾ä¸Šå¯ä»¥çœ‹åˆ° Jenkins Master æ—¶ä»¥ docker-compose çš„æ–¹å¼è¿è¡Œåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚Jenkins Slave ä»¥ Pod å½¢å¼è¿è¡Œåœ¨ Kubernetes é›†ç¾¤çš„ Node ä¸Šï¼Œå¹¶ä¸”å®ƒä¸æ˜¯ä¸€ç›´å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œå®ƒä¼šæŒ‰ç…§éœ€æ±‚åŠ¨æ€çš„åˆ›å»ºå¹¶è‡ªåŠ¨åˆ é™¤ã€‚è¿™ç§æ–¹å¼çš„å·¥ä½œæµç¨‹å¤§è‡´ä¸ºï¼šå½“ Jenkins Master æ¥å—åˆ° Build è¯·æ±‚æ—¶ï¼Œä¼šæ ¹æ®é…ç½®çš„ Label åŠ¨æ€åˆ›å»ºä¸€ä¸ªè¿è¡Œåœ¨ Pod ä¸­çš„ Jenkins Slave å¹¶æ³¨å†Œåˆ° Master ä¸Šï¼Œå½“è¿è¡Œå®Œ Job åï¼Œè¿™ä¸ª Slave ä¼šè¢«æ³¨é”€å¹¶ä¸”è¿™ä¸ª Pod ä¹Ÿä¼šè‡ªåŠ¨åˆ é™¤ï¼Œæ¢å¤åˆ°æœ€åˆçŠ¶æ€ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨è¿™ç§æ–¹å¼å¸¦æ¥äº†ä»¥ä¸‹å¥½å¤„ï¼š</p><ul><li><strong>åŠ¨æ€ä¼¸ç¼©</strong>ï¼Œåˆç†ä½¿ç”¨èµ„æºï¼Œæ¯æ¬¡è¿è¡Œ Job æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª Jenkins Slaveï¼ŒJob å®Œæˆåï¼ŒSlave è‡ªåŠ¨æ³¨é”€å¹¶åˆ é™¤å®¹å™¨ï¼Œèµ„æºè‡ªåŠ¨é‡Šæ”¾ï¼Œè€Œä¸” Kubernetes ä¼šæ ¹æ®æ¯ä¸ªèµ„æºçš„ä½¿ç”¨æƒ…å†µï¼ŒåŠ¨æ€åˆ†é… Slave åˆ°ç©ºé—²çš„èŠ‚ç‚¹ä¸Šåˆ›å»ºï¼Œé™ä½å‡ºç°å› æŸèŠ‚ç‚¹èµ„æºåˆ©ç”¨ç‡é«˜ï¼Œè¿˜æ’é˜Ÿç­‰å¾…åœ¨è¯¥èŠ‚ç‚¹çš„æƒ…å†µã€‚</li><li><strong>æ‰©å±•æ€§å¥½</strong>ï¼Œå½“ Kubernetes é›†ç¾¤çš„èµ„æºä¸¥é‡ä¸è¶³è€Œå¯¼è‡´ Job æ’é˜Ÿç­‰å¾…æ—¶ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„æ·»åŠ ä¸€ä¸ª Kubernetes Node åˆ°é›†ç¾¤ä¸­ï¼Œä»è€Œå®ç°æ‰©å±•ã€‚</li></ul><p>ä¸Šé¢çš„å¤§åŠæ®µå¤åˆ¶ç²˜è´´è‡ª <a href="https://www.qikqiak.com/k8s-book/docs/36.Jenkins%20Slave.html" target="_blank" rel="noopener">åŸºäº Jenkins çš„ CI/CD (ä¸€)</a> ğŸ¤</p><h2 id="kubernetes-é›†ç¾¤"><a href="#kubernetes-é›†ç¾¤" class="headerlink" title="kubernetes é›†ç¾¤"></a>kubernetes é›†ç¾¤</h2><p>å…³äº kubernetes é›†ç¾¤éƒ¨ç½²ï¼Œä½¿ç”¨ kubeadm éƒ¨ç½²æ˜¯æœ€ä¸ºæ–¹ä¾¿çš„äº†ï¼Œå¯å‚è€ƒæˆ‘å¾ˆæ—©ä¹‹å‰å†™è¿‡çš„æ–‡ç« ã€Š<a href="https://blog.k8s.li/kubeadm-deploy-k8s-v1.17.4.html">ä½¿ç”¨ kubeadm å¿«é€Ÿéƒ¨ç½²ä½“éªŒ K8s</a>ã€‹ï¼Œåœ¨è¿™é‡Œåªæ˜¯ç®€å•ä»‹ç»ä¸€ä¸‹ï¼š</p><ul><li>ä½¿ç”¨ kubeadm æ¥åˆ›å»ºä¸€ä¸ªå• master èŠ‚ç‚¹çš„ kubernets é›†ç¾¤</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@jenkins:~ <span class="comment"># kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=192.168.20.11</span></span><br></pre></td></tr></table></figure><ul><li>é›†ç¾¤æˆåŠŸéƒ¨ç½²å®Œæˆä¹‹åä¼šæœ‰å¦‚ä¸‹æç¤ºï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line">  mkdir -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€å’Œ pod éƒ½å·²ç»æ­£å¸¸</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@jenkins:~ <span class="comment"># kubectl get pod -A</span></span><br><span class="line">NAMESPACE     NAME                              READY   STATUS    RESTARTS   AGE</span><br><span class="line">kube-system   coredns-f9fd979d6-9t6qp           1/1     Running   0          89s</span><br><span class="line">kube-system   coredns-f9fd979d6-hntm8           1/1     Running   0          89s</span><br><span class="line">kube-system   etcd-jenkins                      1/1     Running   0          106s</span><br><span class="line">kube-system   kube-apiserver-jenkins            1/1     Running   0          106s</span><br><span class="line">kube-system   kube-controller-manager-jenkins   1/1     Running   0          106s</span><br><span class="line">kube-system   kube-proxy-8pzkz                  1/1     Running   0          89s</span><br><span class="line">kube-system   kube-scheduler-jenkins            1/1     Running   0          106s</span><br><span class="line">root@jenkins:~ <span class="comment"># kubectl get node</span></span><br><span class="line">NAME      STATUS   ROLES    AGE    VERSION</span><br><span class="line">jenkins   Ready    master   119s   v1.19.8</span><br></pre></td></tr></table></figure><ul><li>å»é™¤ master èŠ‚ç‚¹ä¸Šçš„æ±¡ç‚¹ï¼Œå…è®¸å…¶ä»–çš„ pod è°ƒåº¦åœ¨ master èŠ‚ç‚¹ä¸Šï¼Œä¸ç„¶åé¢ Jenkins æ‰€åˆ›å»ºçš„ pod å°†æ— æ³•è°ƒåº¦åœ¨è¯¥èŠ‚ç‚¹ä¸Šã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl taint nodes $(hostname) node-role.kubernetes.io/master:NoSchedule-</span><br></pre></td></tr></table></figure><h2 id="Jenkins-master"><a href="#Jenkins-master" class="headerlink" title="Jenkins master"></a>Jenkins master</h2><p>è‡³äº  Jenkins master çš„éƒ¨ç½²æ–¹å¼ï¼Œä¸ªäººå»ºè®®ä½¿ç”¨ docker-compose æ¥éƒ¨ç½²ã€‚è¿è¡Œåœ¨ kubernetes é›†ç¾¤é›†ç¾¤ä¸­ä¹Ÿæ²¡ä»€ä¹ˆæ¯›ç—…ï¼Œå¯ä»¥å‚è€ƒ <a href="https://www.qikqiak.com/k8s-book/docs/36.Jenkins%20Slave.html" target="_blank" rel="noopener">åŸºäº Jenkins çš„ CI/CD (ä¸€)</a> è¿™ç¯‡åšå®¢ã€‚ä½†ä»ä¸ªäººè¿ç»´è¸©çš„å‘æ¥è®²ï¼Œè¿˜æ˜¯å°†  Jenkins master ç‹¬ç«‹äº kubernetes é›†ç¾¤éƒ¨ç½²æ¯”è¾ƒæ–¹ä¾¿ğŸ˜‚ã€‚</p><ul><li><code>docker-compose.yaml</code></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.6'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">jenkins:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">jenkins/jenkins:2.263.4-lts-slim</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">jenkins</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./jenkins_home:/var/jenkins_home</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">host</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">JAVA_OPTS=-Duser.timezone=Asia/Shanghai</span></span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ docker-compose up æ¥å¯åŠ¨ï¼ŒæˆåŠŸå¯åŠ¨åä¼šæœ‰å¦‚ä¸‹æç¤ºï¼Œæ—¥å¿—è¾“å‡ºçš„å¯†é’¥å°±æ˜¯ <code>admin</code> ç”¨æˆ·çš„é»˜è®¤å¯†ç ï¼Œä½¿ç”¨å®ƒæ¥ç¬¬ä¸€æ¬¡ç™»å½• Jenkinsã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">jenkins    | 2021-03-06 02:22:31.741+0000 [id=41]INFOjenkins.install.SetupWizard<span class="comment">#init:</span></span><br><span class="line">jenkins    |</span><br><span class="line">jenkins    | *************************************************************</span><br><span class="line">jenkins    | *************************************************************</span><br><span class="line">jenkins    | *************************************************************</span><br><span class="line">jenkins    |</span><br><span class="line">jenkins    | Jenkins initial setup is required. An admin user has been created and a password generated.</span><br><span class="line">jenkins    | Please use the following password to proceed to installation:</span><br><span class="line">jenkins    |</span><br><span class="line">jenkins    | 4c2361968cd94323acdde17f7603d8e1</span><br><span class="line">jenkins    |</span><br><span class="line">jenkins    | This may also be found at: /var/jenkins_home/secrets/initialAdminPassword</span><br><span class="line">jenkins    |</span><br><span class="line">jenkins    | *************************************************************</span><br><span class="line">jenkins    | *************************************************************</span><br><span class="line">jenkins    | *************************************************************</span><br></pre></td></tr></table></figure><ul><li>ç™»å½•ä¸Šå»ä¹‹åï¼Œå»ºè®®é€‰æ‹© <code>é€‰æ‹©æ’ä»¶æ¥å®‰è£…</code>ï¼Œå°½å¯èƒ½å°‘åœ°å®‰è£…æ’ä»¶ï¼ŒæŒ‰éœ€å®‰è£…å³å¯ã€‚</li></ul><p><img src="https://p.k8s.li/image-20210306102735594.png" alt="image-20210306102735594"></p><ul><li>åœ¨ Jenkins çš„æ’ä»¶ç®¡ç†é‚£é‡Œå®‰è£…ä¸Š kubernetes æ’ä»¶</li><li><img src="https://p.k8s.li/image-20210306103352837.png" alt="image-20210306103352837"></li><li>æ¥ä¸‹æ¥å¼€å§‹é…ç½® Jenkins å¤§å”å¦‚ä½•ä¸ kubernetes èˆ¹é•¿æ‰‹ç‰µæ‰‹ğŸ§‘â€ğŸ¤â€ğŸ§‘ :-)ã€‚é…ç½® kubernets çš„åœ°æ–¹æ˜¯åœ¨ <code>ç³»ç»Ÿç®¡ç† &gt; èŠ‚ç‚¹ç®¡ç† &gt; Configure Clouds</code>ã€‚ç‚¹å‡» <code>Add a new cloud</code>ï¼Œæ¥æ·»åŠ ä¸€ä¸ª kubernetes é›†ç¾¤ã€‚</li></ul><p><img src="https://p.k8s.li/image-20210306111626079.png" alt="image-20210306111626079"></p><ul><li>é…ç½®è¿æ¥å‚æ•°</li></ul><table><thead><tr><th>å‚æ•°</th><th>å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>åç§°</td><td>kubernetes</td><td>ä¹Ÿæ˜¯åé¢ pod æ¨¡æ¿ä¸­çš„ <code>cloud</code> çš„å€¼</td></tr><tr><td>å‡­æ®</td><td>kubeconfig å‡­æ® id</td><td>ä½¿ç”¨ kubeconfig æ–‡ä»¶æ¥è¿æ¥é›†ç¾¤</td></tr><tr><td>Kubernetes åœ°å€</td><td>é»˜è®¤å³å¯</td><td></td></tr><tr><td>Use Jenkins Proxy</td><td>é»˜è®¤å³å¯</td><td></td></tr><tr><td>Kubernetes æœåŠ¡è¯ä¹¦ key</td><td>é»˜è®¤å³å¯</td><td></td></tr><tr><td>ç¦ç”¨ HTTPS è¯ä¹¦æ£€æŸ¥</td><td>é»˜è®¤å³å¯</td><td></td></tr><tr><td>Kubernetes å‘½åç©ºé—´</td><td>é»˜è®¤å³å¯</td><td></td></tr><tr><td>WebSocket</td><td>é»˜è®¤å³å¯</td><td></td></tr><tr><td>Direct Connection</td><td>é»˜è®¤å³å¯</td><td></td></tr><tr><td>Jenkins åœ°å€</td><td><a href="http://jenkins.k8s.li:8080" target="_blank" rel="noopener">http://jenkins.k8s.li:8080</a></td><td>Jenkins pod è¿æ¥  Jenkins master çš„  URL</td></tr><tr><td>Jenkins é€šé“</td><td>50000</td><td>Jenkins <code>JNLP</code> çš„ç«¯å£ï¼Œé»˜è®¤ä¸º 50000</td></tr><tr><td>Connection Timeout</td><td>é»˜è®¤å³å¯</td><td>Jenkins è¿æ¥ kubernetes è¶…æ—¶æ—¶é—´</td></tr><tr><td>Read Timeout</td><td>é»˜è®¤å³å¯</td><td></td></tr><tr><td>å®¹å™¨æ•°é‡</td><td>é»˜è®¤å³å¯</td><td>Jenkins pod åˆ›å»ºçš„æœ€å¤§æ•°é‡</td></tr><tr><td>Pod Labels</td><td>é»˜è®¤å³å¯</td><td>Jenkins pod çš„ lables</td></tr><tr><td>è¿æ¥ Kubernetes API çš„æœ€å¤§è¿æ¥æ•°</td><td>é»˜è®¤å³å¯</td><td></td></tr><tr><td>Seconds to wait for pod to be running</td><td>é»˜è®¤å³å¯</td><td>ç­‰å¾… pod æ­£å¸¸ running çš„æ—¶é—´</td></tr></tbody></table><ul><li>åœ¨ Jenkins çš„å‡­æ®é‚£é‡Œæ·»åŠ ä¸Š kubeconfig æ–‡ä»¶ï¼Œå‡­æ®çš„ç±»å‹é€‰æ‹©ä¸º <code>Secret file</code>ï¼Œç„¶åå°†ä¸Šé¢ä½¿ç”¨ kubeadm éƒ¨ç½²ç”Ÿæˆçš„ kubeconfig ä¸Šä¼ åˆ°è¿™é‡Œã€‚</li></ul><p><img src="https://p.k8s.li/image-20210306111037947.png" alt="image-20210306111037947"></p><ul><li>ç‚¹å‡»è¿æ¥æµ‹è¯•ï¼Œå¦‚æœæç¤º <code>Connected to Kubernetes v1.19.8</code> å°±è¯´æ˜å·²ç»æˆåŠŸè¿æ¥ä¸Šäº† kubernetes é›†ç¾¤ã€‚</li></ul><p><img src="https://p.k8s.li/image-20210306111148462.png" alt="image-20210306111148462"></p><ul><li>å…³äº pod æ¨¡æ¿</li></ul><p>å…¶å®å°±æ˜¯é…ç½® Jenkins Slave è¿è¡Œçš„ Pod æ¨¡æ¿ï¼Œä¸ªäººä¸å¤ªå»ºè®®ä½¿ç”¨æ’ä»¶ä¸­çš„æ¨¡æ¿å»é…ç½®ï¼Œæ¨èå°† pod çš„æ¨¡æ¿æ”¾åœ¨ Jenkinsfile ä¸­ï¼Œå› ä¸ºè¿™äº›é…ç½®ä¸æˆ‘ä»¬çš„æµæ°´çº¿ç´§å¯†ç›¸å…³ï¼ŒæŠŠ pod çš„é…ç½®å­˜å‚¨åœ¨ Jenkins çš„æ’ä»¶é‡Œå®åœ¨æ˜¯ä¸å¤ªæ–¹ä¾¿ï¼›ä¸æ–¹ä¾¿åç»­çš„è¿ç§»å¤‡ä»½ä¹‹ç±»çš„å·¥ä½œï¼›åç»­æ’ä»¶å‡çº§åè¿™äº›é…ç½®ä¹Ÿå¯èƒ½ä¼šä¸¢å¤±ã€‚å› æ­¤å»ºè®®å°† pod æ¨¡æ¿çš„é…ç½®ç›´æ¥å®šä¹‰åœ¨ Jenkinsfile ä¸­ï¼Œçµæ´»æ€§æ›´é«˜ä¸€äº›ï¼Œä¸ä¼šå— Jenkins æ’ä»¶å‡çº§çš„å½±å“ã€‚æ€»ä¹‹ç”¨ä»£ç å»ç®¡ç†è¿™äº› pod é…ç½®ç»´æŠ¤æˆæœ¬å°†ä¼šå°‘å¾ˆå¤šã€‚</p><h2 id="Jenkinsfile"><a href="#Jenkinsfile" class="headerlink" title="Jenkinsfile"></a>Jenkinsfile</h2><ul><li>æµæ°´çº¿ <code>Jenkinsfile</code>ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä»»åŠ¡ï¼Œç”¨äºæ„å»º <a href="https://github.com/webp-sh/webp_server_go" target="_blank" rel="noopener">webp-server-go</a> é¡¹ç›®çš„ docker é•œåƒã€‚</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">//</span> <span class="string">Kubernetes</span> <span class="string">pod</span> <span class="string">template</span> <span class="string">to</span> <span class="string">run.</span></span><br><span class="line"><span class="string">def</span> <span class="string">JOB_NAME</span> <span class="string">=</span> <span class="string">"$&#123;env.JOB_NAME&#125;"</span></span><br><span class="line"><span class="string">def</span> <span class="string">BUILD_NUMBER</span> <span class="string">=</span> <span class="string">"$&#123;env.BUILD_NUMBER&#125;"</span></span><br><span class="line"><span class="string">def</span> <span class="string">POD_NAME</span> <span class="string">=</span> <span class="string">"jenkins-$&#123;JOB_NAME&#125;-$&#123;BUILD_NUMBER&#125;"</span></span><br><span class="line"><span class="string">podTemplate(</span></span><br><span class="line"><span class="comment"># è¿™é‡Œå®šä¹‰ pod æ¨¡ç‰ˆ</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">&#123;</span> <span class="string">node(POD_NAME)</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="string">container(JOB_NAME)</span> <span class="string">&#123;</span></span><br><span class="line">      <span class="string">stage("Build</span> <span class="string">image")</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="string">sh</span> <span class="string">""</span><span class="string">"#!/bin/bash</span></span><br><span class="line"><span class="string">          git clone https://github.com/webp-sh/webp_server_go /build</span></span><br><span class="line"><span class="string">          cd /build</span></span><br><span class="line"><span class="string">          docker build -t webps:0.3.2-rc.1 .</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><ul><li>pod æ¨¡ç‰ˆå¦‚ä¸‹ï¼Œå°†æ¨¡æ¿çš„å†…å®¹å¤åˆ¶ç²˜è´´åˆ°ä¸Šé¢çš„ Jenkinsfile ä¸­ã€‚åœ¨å®¹å™¨ä¸­æ„å»ºé•œåƒï¼Œæˆ‘ä»¬ä½¿ç”¨ dind çš„æ–¹æ¡ˆï¼šå°† pod æ‰€åœ¨å®¿ä¸»æœºçš„ docker sock æ–‡ä»¶æŒ‚è½½åˆ° pod çš„å®¹å™¨å†…ï¼Œpod å®¹å™¨å†…åªè¦å®‰è£…å¥½ docker-cli å·¥å…·å°±å¯ä»¥åƒå®¿ä¸»æœºé‚£æ ·ç›´æ¥ä½¿ç”¨ docker äº†ã€‚</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">podTemplate(</span></span><br><span class="line">  <span class="attr">cloud:</span> <span class="string">"kubernetes"</span><span class="string">,</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">"default"</span><span class="string">,</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">POD_NAME,</span></span><br><span class="line">  <span class="attr">label:</span> <span class="string">POD_NAME,</span></span><br><span class="line">  <span class="attr">yaml:</span> <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: Pod</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  containers:</span></span><br><span class="line"><span class="string">  - name: $&#123;JOB_NAME&#125;</span></span><br><span class="line"><span class="string">    image: "</span><span class="string">debian:buster-docker"</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">    <span class="attr">tty:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">dockersock</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/var/run/docker.sock</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jnlp</span></span><br><span class="line">    <span class="attr">args:</span> <span class="string">["\$(JENKINS_SECRET)",</span> <span class="string">"\$(JENKINS_NAME)"</span><span class="string">]</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">"jenkins/inbound-agent:4.3-4-alpine"</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">dockersock</span></span><br><span class="line">    <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/var/run/docker.sock</span></span><br><span class="line"><span class="string">""</span><span class="string">",</span></span><br><span class="line"><span class="string">)</span></span><br></pre></td></tr></table></figure><ul><li>æ„å»º <code>debian:buster-docker</code> é•œåƒï¼Œä½¿ç”¨å®ƒæ¥åœ¨ pod çš„å®¹å™¨å†…æ„å»º docker é•œåƒï¼Œä½¿ç”¨çš„ <code>Dockerfile</code> å¦‚ä¸‹ï¼š</li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:buster</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt update \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt install -y --no-install-recommends \</span></span><br><span class="line"><span class="bash">        vim \</span></span><br><span class="line"><span class="bash">        curl \</span></span><br><span class="line"><span class="bash">        git \</span></span><br><span class="line"><span class="bash">        make \</span></span><br><span class="line"><span class="bash">        ca-certificates \</span></span><br><span class="line"><span class="bash">        gnupg \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> curl -fsSL <span class="string">"https://download.docker.com/linux/debian/gpg"</span> | apt-key add -qq - &gt;/dev/null \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">echo</span> <span class="string">"deb [arch=amd64] https://download.docker.com/linux/debian buster stable"</span> &gt; /etc/apt/sources.list.d/docker.list \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt update -qq \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get install -y -qq --no-install-recommends docker-ce-cli \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span></span><br></pre></td></tr></table></figure><p>å®šä¹‰å¥½ jenkinsfile æ–‡ä»¶å¹¶ä¸”æ„å»ºå¥½ pod æ¨¡æ¿ä¸­çš„é•œåƒåï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹ä½¿ç”¨å®ƒæ¥åˆ›å»ºæµæ°´çº¿ä»»åŠ¡ã€‚</p><h2 id="æµæ°´çº¿"><a href="#æµæ°´çº¿" class="headerlink" title="æµæ°´çº¿"></a>æµæ°´çº¿</h2><ul><li>åœ¨ Jenkins ä¸Šæ–°å»ºä¸€ä¸ªä»»åŠ¡ï¼Œé€‰æ‹©ä»»åŠ¡çš„ç±»å‹ä¸º <code>æµæ°´çº¿</code></li></ul><p><img src="https://p.k8s.li/image-20210306185651025.png" alt="image-20210306185651025"></p><ul><li>å°†å®šä¹‰å¥½çš„ Jenkinsfile å†…å®¹å¤åˆ¶ç²˜è´´åˆ°æµæ°´çº¿å®šä¹‰ <code>Pipeline script</code> ä¸­å¹¶ç‚¹å‡»ä¿å­˜ã€‚åœ¨æ–°å»ºå¥½çš„ Job é¡µé¢ç‚¹å‡» <code>ç«‹å³æ„å»º</code> æ¥è¿è¡Œæµæ°´çº¿ä»»åŠ¡ã€‚</li></ul><p><img src="https://p.k8s.li/image-20210306185838845.png" alt="image-20210306185838845"></p><ul><li>åœ¨ kubernetes é›†ç¾¤çš„æœºå™¨ä¸Šä½¿ç”¨ kubectl å‘½ä»¤æŸ¥çœ‹ pod æ˜¯å¦æ­£å¸¸ Running</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@jenkins:~ <span class="comment"># kubectl get pod</span></span><br><span class="line">NAME                              READY   STATUS    RESTARTS   AGE</span><br><span class="line">jenkins-webps-9-bs78x-5x204   2/2     Running   0          66s</span><br></pre></td></tr></table></figure><ul><li>Job æ­£å¸¸è¿è¡Œå¹¶ä¸”çŠ¶æ€ä¸ºç»¿è‰²è¡¨æ˜è¯¥ job å·²ç»æˆåŠŸæ‰§è¡Œäº†ã€‚</li></ul><p><img src="https://p.k8s.li/image-20210306190124096.png" alt="image-20210306190124096"></p><ul><li>åœ¨ kubernetes é›†ç¾¤æœºå™¨ä¸ŠæŸ¥çœ‹ docker é•œåƒæ˜¯å¦æ„å»ºæˆåŠŸ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@jenkins:~ <span class="comment"># docker images | grep webps</span></span><br><span class="line">webps                                0.3.2-rc.1          f68f496c0444        20 minutes ago      13.7MB</span><br></pre></td></tr></table></figure><h2 id="è¸©å‘"><a href="#è¸©å‘" class="headerlink" title="è¸©å‘"></a>è¸©å‘</h2><ul><li>pod æ— æ³•æ­£å¸¸ Running</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Running <span class="keyword">in</span> Durability level: MAX_SURVIVABILITY</span><br><span class="line">[Pipeline] Start of Pipeline</span><br><span class="line">[Pipeline] podTemplate</span><br><span class="line">[Pipeline] &#123;</span><br><span class="line">[Pipeline] node</span><br><span class="line">Created Pod: kubernetes default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-9wm0r</span><br><span class="line">[Normal][default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-9wm0r][Scheduled] Successfully assigned default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-9wm0r to jenkins</span><br><span class="line">[Normal][default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-9wm0r][Pulling] Pulling image <span class="string">"debian:buster"</span></span><br><span class="line">[Normal][default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-9wm0r][Pulled] Successfully pulled image <span class="string">"debian:buster"</span> <span class="keyword">in</span> 2.210576896s</span><br><span class="line">[Normal][default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-9wm0r][Created] Created container debian</span><br><span class="line">[Normal][default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-9wm0r][Started] Started container debian</span><br><span class="line">[Normal][default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-9wm0r][Pulling] Pulling image <span class="string">"jenkins/inbound-agent:4.3-4-alpine"</span></span><br><span class="line">Still waiting to schedule task</span><br><span class="line">â€˜debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-9wm0râ€™ is offline</span><br><span class="line">[Normal][default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-9wm0r][Pulled] Successfully pulled image <span class="string">"jenkins/inbound-agent:4.3-4-alpine"</span> <span class="keyword">in</span> 3.168311973s</span><br><span class="line">[Normal][default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-9wm0r][Created] Created container jnlp</span><br><span class="line">[Normal][default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-9wm0r][Started] Started container jnlp</span><br><span class="line">Created Pod: kubernetes default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-qdw4m</span><br><span class="line">[Normal][default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-qdw4m][Scheduled] Successfully assigned default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-qdw4m to jenkins</span><br><span class="line">[Normal][default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-qdw4m][Pulled] Container image <span class="string">"debian:buster"</span> already present on machine</span><br><span class="line">[Normal][default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-qdw4m][Created] Created container debian</span><br><span class="line">[Normal][default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-qdw4m][Started] Started container debian</span><br><span class="line">[Normal][default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-qdw4m][Pulled] Container image <span class="string">"jenkins/inbound-agent:4.3-4-alpine"</span> already present on machine</span><br><span class="line">[Normal][default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-qdw4m][Created] Created container jnlp</span><br><span class="line">[Normal][default/debian-35a11b49-087b-4a8c-abac-bd97d7eb5a1f-fkmzq-qdw4m][Started] Started container jnlp</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸º Jenkins pod ä¸­çš„ jnlp å®¹å™¨æ— æ³•è¿æ¥  Jenkins masterã€‚å¯ä»¥æ£€æŸ¥ä¸€ä¸‹ Jenkins master ä¸Š <code>ç³»ç»Ÿç®¡ç† &gt; èŠ‚ç‚¹ç®¡ç† &gt; Configure Clouds</code> ä¸­ <code>Jenkins åœ°å€</code> å’Œ <code>Jenkins é€šé“</code> è¿™ä¸¤ä¸ªå‚æ•°æ˜¯å¦é…ç½®æ­£ç¡®ã€‚</p><h2 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h2><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†è®© Jenkins å¤§å”ä¸ kubernetes èˆ¹é•¿æ‰‹ç‰µæ‰‹ğŸ§‘â€ğŸ¤â€ğŸ§‘å•¦ï¼ä¸Šé¢ä½¿ç”¨äº†ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥å±•ç¤ºäº†å¦‚ä½•å°† Jenkins çš„ Job ä»»åŠ¡è¿è¡Œåœ¨ kubernetes é›†ç¾¤ä¸Šï¼Œä½†åœ¨å®é™…å·¥ä½œä¸­é‡åˆ°çš„æƒ…å½¢å¯èƒ½æ¯”è¿™è¦å¤æ‚ä¸€äº›ï¼Œæµæ°´çº¿éœ€è¦é…ç½®çš„å‚æ•°ä¹Ÿè¦å¤šä¸€äº›ã€‚é‚£ä¹ˆæˆ‘å°†ä¼šåœ¨ä¸‹ä¸€ç¯‡åšå®¢ä¸­å†è®²ä¸€ä¸‹é«˜çº§çš„ç”¨æ³•ï¼šä½¿ç”¨ Jenkins å®Œæˆ kubespray ç¦»çº¿å®‰è£…åŒ…æ‰“åŒ…ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><p><a href="https://jenkins-zh.cn/wechat/articles/2020/03/2020-03-10-create-a-ci-cd-pipeline-with-kubernetes-and-jenkins/" target="_blank" rel="noopener">ä½¿ç”¨ Kubernetes å’Œ Jenkins åˆ›å»ºä¸€ä¸ª CI/CD æµæ°´çº¿</a></p></li><li><p><a href="https://www.qikqiak.com/k8s-book/docs/36.Jenkins%20Slave.html" target="_blank" rel="noopener">åŸºäº Jenkins çš„ CI/CD (ä¸€)</a></p></li><li><p><a href="https://a-wing.top/kubernetes/2021/01/27/jenkins_and_kubernetes.html" target="_blank" rel="noopener">PingCAP é¢è¯•ï¼šJenkins å’Œ Kubernetes</a></p></li><li><p><a href="https://www.chenshaowen.com/blog/using-podman-to-build-images-under-kubernetes-and-jenkins.html" target="_blank" rel="noopener">åŸºäº Kubernetes çš„ Jenkins æœåŠ¡ä¹Ÿå¯ä»¥å» Docker äº†</a></p></li><li><p><a href="https://www.chenshaowen.com/blog/jenkins-pipeline-usging-and-debug.html" target="_blank" rel="noopener">Jenkins Pipeline ä½¿ç”¨åŠè°ƒè¯•</a></p></li><li><p><a href="https://www.chenshaowen.com/blog/creating-jenkins-slave-dynamically-on-kubernetes.html" target="_blank" rel="noopener">åœ¨ Kubernetes ä¸ŠåŠ¨æ€åˆ›å»º Jenkins Slave</a></p></li><li><p><a href="https://www.chenshaowen.com/blog/jenkins-x-is-not-jenkins-but-stack.html" target="_blank" rel="noopener">Jenkins X ä¸æ˜¯ Jenkins ï¼Œè€Œæ˜¯ä¸€ä¸ªæŠ€æœ¯æ ˆ</a></p></li><li><p><a href="https://atbug.com/using-role-based-authorization-strategy-in-jenkins/" target="_blank" rel="noopener">Jenkins CI/CD (ä¸€) åŸºäºè§’è‰²çš„æˆæƒç­–ç•¥</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="kubernetes" scheme="https://blog.k8s.li/tags/kubernetes/"/>
    
      <category term="Jenkins" scheme="https://blog.k8s.li/tags/Jenkins/"/>
    
  </entry>
  
  <entry>
    <title>overlay2 åœ¨æ‰“åŒ…å‘å¸ƒæµæ°´çº¿ä¸­çš„åº”ç”¨</title>
    <link href="https://blog.k8s.li/overlay2-on-package-pipline.html"/>
    <id>https://blog.k8s.li/overlay2-on-package-pipline.html</id>
    <published>2021-03-01T16:00:00.000Z</published>
    <updated>2021-03-01T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è‡ªä»å»å¹´äº”æœˆä»½å…¥èŒåä¸€ç›´åœ¨è´Ÿè´£å…¬å¸ PaaS toB äº§å“çš„æ‰“åŒ…å‘å¸ƒåŠéƒ¨ç½²è¿ç»´å·¥ä½œï¼Œå·¥ä½œæ€§è´¨ä¸Šæœ‰ç‚¹ç±»ä¼¼äº Kubernetes ç¤¾åŒºçš„ <a href="https://github.com/kubernetes/sig-release" target="_blank" rel="noopener">SIG Release  å›¢é˜Ÿ</a>ã€‚è¯•ç”¨æœŸçš„ä¸»è¦å·¥ä½œå°±æ˜¯ä¼˜åŒ–æˆ‘ä»¬å…ˆæœ‰çš„æ‰“åŒ…å‘å¸ƒæµç¨‹ã€‚åœ¨è¿™æœŸé—´äº§å“æ‰“åŒ…å‘å¸ƒæµæ°´çº¿åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œå…¶ä¸­æœ€çªå‡ºçš„æ˜¯é•œåƒåŒæ­¥çš„ä¼˜åŒ–ï¼Œå°†é•œåƒåŒæ­¥çš„é€Ÿåº¦æå‡äº† 5 åˆ° 15 å€ã€‚å¤§å¤§ç¼©çŸ­äº†æ•´ä¸ªäº§å“çš„å‘å¸ƒè€—æ—¶ï¼Œä¹Ÿå¾—åˆ°äº†åŒäº‹ä»¬çš„ä¸€è‡´å¥½è¯„ã€‚äºæ˜¯ä»Šå¤©å°±æƒ³ç€æŠŠè¿™é¡¹ä¼˜åŒ–å’ŒèƒŒåçš„åŸç†åˆ†äº«å‡ºæ¥ã€‚</p><p>æˆ‘ä»¬çš„äº§å“æ‰“åŒ…æ—¶ä¼šæœ‰ä¸€ä¸ªé•œåƒåˆ—è¡¨ï¼Œå¹¶æ ¹æ®è¿™ä¸ªé•œåƒåˆ—è¡¨åœ¨ CI/CD çš„æµæ°´çº¿é•œåƒä»“åº“é‡Œå°†é•œåƒåŒæ­¥åˆ°ä¸€ä¸ªå‘å¸ƒå½’æ¡£çš„é•œåƒä»“åº“å’Œä¸€ä¸ªæ‰“åŒ…çš„é•œåƒä»“åº“ã€‚æœ€ç»ˆä¼šå°†æ‰“åŒ…çš„é•œåƒä»“åº“çš„ registry å­˜å‚¨ç›®å½•æ‰“åŒ…ä¸€ä¸ªæœªç» gzip å‹ç¼©çš„ tar åŒ…ã€‚æœ€ç»ˆåœ¨å®¢æˆ·ç¯å¢ƒéƒ¨ç½²çš„æ—¶å€™å°†è¿™ä¸ª tar åŒ…è§£å‹åˆ°éƒ¨ç½²çš„é•œåƒä»“åº“å­˜å‚¨ç›®å½•ä¸­ï¼Œä¾›é›†ç¾¤éƒ¨ç½²å’Œç»„ä»¶éƒ¨ç½²ä½¿ç”¨ã€‚è‡³äºéƒ¨ç½²çš„æ—¶å€™ä¸ºä»€ä¹ˆå¯ä»¥è¿™æ ·åšï¼Œå…¶ä¸­çš„åŸç†å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™è¿‡çš„æ–‡ç«  <a href="https://blog.k8s.li/docker-registry-to-harbor.html">docker registry è¿ç§»è‡³ harbor</a>ã€‚</p><p>åœ¨æ‰“åŒ…çš„è¿‡ç¨‹ä¸­é•œåƒåŒæ­¥ä¼šè¿›è¡Œä¸¤æ¬¡ï¼Œæ¯æ¬¡éƒ½ä¼šæ ¹æ®ä¸€ä¸ª images.list åˆ—è¡¨å°†é•œåƒåŒæ­¥åˆ°ä¸åŒçš„é•œåƒä»“åº“ä¸­ï¼ŒåŒæ­¥çš„æ–¹å¼ä½¿ç”¨çš„æ˜¯  <code>docker pull â€“&gt; docker tag â€“&gt; docker push</code>ã€‚å…¶é•œåƒåŒæ­¥çš„æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://p.k8s.li/2021-03-01-001.jpeg" alt="img"></p><p>ç¬¬ä¸€æ¬¡æ˜¯ä»CI/CD æµæ°´çº¿é•œåƒä»“åº“ï¼ˆcicd.registry.localï¼‰ä¸­æ‹‰å–é•œåƒå¹¶ push åˆ°å‘å¸ƒå½’æ¡£çš„é•œåƒä»“åº“(archive.registry.local)ä¸­ï¼Œå…¶ç›®çš„æ˜¯å½’æ¡£å¹¶å¤‡ä»½æˆ‘ä»¬å·²ç»å‘å¸ƒçš„é•œåƒï¼Œè¿™ä¸€æ­¥ç§°å…¶ä¸ºä¿å­˜å¤‡ä»½åŒæ­¥ï¼ˆsave syncï¼‰ã€‚</p><p>ç¬¬äºŒæ¬¡å°†é•œåƒä»å‘å¸ƒå½’æ¡£çš„é•œåƒä»“åº“ (archive.registry.local) åŒæ­¥é•œåƒåˆ°æ‰“åŒ…é•œåƒä»“åº“ï¼ˆpackage.registry.localï¼‰ä¸­ã€‚ä¸åŒäºç¬¬ä¸€æ¬¡çš„é•œåƒåŒæ­¥ï¼Œè¿™æ¬¡åŒæ­¥é•œåƒçš„æ—¶å€™ä¼šå¯¹é•œåƒä»“åº“åšæ¸…ç†çš„æ“ä½œï¼Œé¦–å…ˆæ¸…ç†æ‰“åŒ…é•œåƒä»“åº“çš„å­˜å‚¨ç›®å½•ï¼Œç„¶åå®¹å™¨ registry å®¹å™¨è®© registry é‡æ–°æå–é•œåƒçš„å…ƒæ•°æ®ä¿¡æ¯åˆ°å†…å­˜ä¸­ã€‚å…¶ç›®çš„æ˜¯æ¸…ç†æ—§æ•°æ®ï¼Œé˜²æ­¢å†å²çš„é•œåƒå¸¦å…¥æœ¬æ¬¡å‘å¸ƒç‰ˆæœ¬çš„å®‰è£…åŒ…ä¸­ã€‚</p><p>é•œåƒåŒæ­¥å®Œæˆä¹‹åä¼šå°†æ•´ä¸ªæ‰“åŒ…é•œåƒä»“åº“çš„å­˜å‚¨ç›®å½•ï¼ˆ/var/lib/registryï¼‰æ‰“åŒ…æˆä¸€ä¸ª tar åŒ…ï¼Œå¹¶æ”¾åˆ°äº§å“å®‰è£…åŒ…ä¸­ã€‚</p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>æˆ‘åˆšå…¥èŒçš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„äº§å“å‘å¸ƒè€—æ—¶æœ€ä¹…çš„å°±æ˜¯é•œåƒåŒæ­¥é˜¶æ®µï¼Œè®°å¾—æœ€é•¿çš„æ—¶å€™è€—æ—¶ <code>2h30min</code>ã€‚è€—æ—¶è¿™ä¹ˆä¹…çš„ä¸»è¦åŸå› åˆ†æå¦‚ä¸‹ï¼š</p><h3 id="docker-æ€§èƒ½é—®é¢˜"><a href="#docker-æ€§èƒ½é—®é¢˜" class="headerlink" title="docker æ€§èƒ½é—®é¢˜"></a>docker æ€§èƒ½é—®é¢˜</h3><p>åœ¨åšé•œåƒåŒæ­¥çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯  <code>docker pull â€“&gt; docker tag â€“&gt; docker push</code> çš„æ–¹å¼ã€‚æœ¨å­åœ¨<a href="https://blog.k8s.li/Exploring-container-image.html">ã€Šæ·±å…¥æµ…å‡ºå®¹å™¨é•œåƒçš„ä¸€ç”Ÿã€‹</a> ä¸­åˆ†æè¿‡ï¼šåœ¨ docker pull å’Œ docker push çš„è¿‡ç¨‹ä¸­ docker å®ˆæŠ¤è¿›ç¨‹éƒ½ä¼šå¯¹é•œåƒçš„ layer åšè§£å‹ç¼©çš„æ“ä½œï¼Œè¿™æ˜¯åŠå…¶è€—æ—¶å’Œæµªè´¹ CPU èµ„æºçš„ã€‚</p><p>åˆå› ä¸ºæˆ‘ä»¬çš„å†…ç½‘æœºå™¨çš„ç£ç›˜æ€§èƒ½å®åœ¨æ˜¯å¤ªçƒ‚äº†ï¼Œæœ‰æ—¶ç”šè‡³è¿ USB 2.0 çš„é€Ÿåº¦ï¼ˆ57MB/sï¼‰éƒ½ä¸å¦‚ï¼é‚£æ…¢çš„ç¨‹åº¦å¯æƒ³è€ŒçŸ¥ã€‚è¿™å°±å¯¼è‡´äº†æ¯æ¬¡åŒæ­¥ä¸€ä¸¤ç™¾ä¸ªé•œåƒæ—¶ç”¨æ—¶å¾ˆä¹…ï¼Œæœ€é•¿çš„æ—¶å€™éœ€è¦ä¸¤ä¸ªåŠå°æ—¶ã€‚</p><h3 id="æ— æ³•å¤ç”¨æ—§æ•°æ®"><a href="#æ— æ³•å¤ç”¨æ—§æ•°æ®" class="headerlink" title="æ— æ³•å¤ç”¨æ—§æ•°æ®"></a>æ— æ³•å¤ç”¨æ—§æ•°æ®</h3><p>åœ¨ç¬¬äºŒæ¬¡é•œåƒåŒæ­¥æ—¶ä¼šå¯¹æ‰“åŒ…é•œåƒä»“åº“åšæ¸…ç†çš„æ“ä½œï¼Œå¯¼è‡´æ— æ³•å¤ç”¨å†å²çš„é•œåƒã€‚å…¶å®æ¯æ¬¡å‘å¸ƒçš„æ—¶å€™ï¼Œå˜æ›´å’Œæ–°å¢çš„é•œåƒå¾ˆå°‘ï¼Œå¹³å‡ä¸ºåŸæ¥çš„ 1/10 å·¦å³ï¼Œå¢é‡åŒæ­¥çš„é•œåƒä¹Ÿå°±é‚£ä¹ˆä¸€ä¸¢ä¸¢ã€‚å› ä¸ºè¦ä¿è¯è¿™æ¬¡æ‰“åŒ…å‘å¸ƒçš„é•œåƒä»“åº“ä¸­åªèƒ½åŒ…å¥½è¿™ä¸ªéœ€è¦çš„é•œåƒï¼Œä¸èƒ½åŒ…å«ä¸æœ¬æ¬¡æ— å…³çš„é•œåƒï¼Œå› æ­¤æ¯æ¬¡éƒ½éœ€è¦æ¸…ç†æ‰“åŒ…é•œåƒä»“åº“ï¼Œè¿™æ— æ³•é¿å…ã€‚ä¸€ç›´æ²¡æœ‰æ‰¾åˆ°èƒ½å¤Ÿå¤ç”¨è¿™äº›å†å²é•œåƒçš„æ–¹æ³•ã€‚</p><h2 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h2><p>æ ¹æ®ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªé—®é¢˜ï¼Œç»è¿‡åå¤çš„ç ”ç©¶å’Œæµ‹è¯•ç»ˆäºéƒ½å®Œç¾åœ°è§£å†³äº†ï¼Œå¹¶å°†é•œåƒåŒæ­¥ä»åŸæ¥æœ€é•¿éœ€è¦ä¸¤ä¸ªåŠå°æ—¶ä¼˜åŒ–åˆ°äº†å¹³å‡äº”åˆ†é’Ÿã€‚</p><h3 id="skopeo-æ›¿ä»£-docker"><a href="#skopeo-æ›¿ä»£-docker" class="headerlink" title="skopeo æ›¿ä»£ docker"></a>skopeo æ›¿ä»£ docker</h3><p>é’ˆå¯¹  <code>docker pull â€“&gt; docker tag â€“&gt; docker push</code>  çš„æ€§èƒ½é—®é¢˜ï¼Œå½“æ—¶ç¬¬ä¸€ä¸ªæ–¹æ¡ˆæƒ³åˆ°çš„å°±æ˜¯ä½¿ç”¨ skopeo æ¥æ›¿ä»£å®ƒã€‚ä½¿ç”¨ <code>skopeo copy</code> ç›´æ¥å°†é•œåƒä»ä¸€ä¸ª registry å¤åˆ¶åˆ°å¦ä¸€ä¸ª registry ä¸­ã€‚è¿™æ ·å¯ä»¥é¿å… docker å®ˆæŠ¤è¿›ç¨‹å¯¹é•œåƒçš„ layer è¿›è¡Œè§£å‹ç¼©è€Œå¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚å…³äº skopeo çš„ä½¿ç”¨å’Œå…¶èƒŒåçš„åŸç†å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„åšå®¢ <a href="https://blog.k8s.li/skopeo.html">é•œåƒæ¬è¿å·¥ skopeo åˆä½“éªŒ</a> ã€‚ä½¿ç”¨ skopeo ä¹‹åé•œåƒåŒæ­¥æ¯”ä¹‹å‰å¿«äº†å¾ˆå¤šï¼Œå¹³å‡å¿«äº† 5 å€å·¦å³ã€‚</p><h3 id="overlay2-å¤ç”¨æ—§æ•°æ®"><a href="#overlay2-å¤ç”¨æ—§æ•°æ®" class="headerlink" title="overlay2 å¤ç”¨æ—§æ•°æ®"></a>overlay2 å¤ç”¨æ—§æ•°æ®</h3><p>è§£å†³äº† docker çš„æ€§èƒ½é—®é¢˜ï¼Œå‰©ä¸‹çš„å°±æ˜¯æ— æ³•å¤ç”¨æ—§æ•°æ®çš„é—®é¢˜äº†ã€‚åœ¨å¦‚ä½•ä¿ç•™å†å²é•œåƒçš„é—®é¢˜ä¸Šå¯ç…è´¹è‹¦å¿ƒã€‚<strong>å½“æ—¶ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆå°±æƒ³åˆ°äº† overlay2 çš„ç‰¹æ€§</strong>ï¼š<code>å†™æ—¶å¤åˆ¶</code>ã€‚å°±å¥½æ¯”å¦‚ docker run å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œåœ¨å®¹å™¨å†…è¿›è¡Œä¿®æ”¹å’Œåˆ é™¤æ–‡ä»¶çš„æ“ä½œï¼Œè¿™äº›æ“ä½œå¹¶ä¸ä¼šå½±å“åˆ°é•œåƒæœ¬èº«ã€‚å› ä¸º docker ä½¿ç”¨ overlay2 è”åˆæŒ‚è½½çš„æ–¹å¼å°†é•œåƒçš„æ¯ä¸€å±‚æŒ‚è½½ä¸ºä¸€ä¸ª merged çš„å±‚ã€‚åœ¨å®¹å™¨å†…çœ‹åˆ°çš„å°±æ˜¯è¿™ä¸ª merged çš„å±‚ï¼Œåœ¨å®¹å™¨å†…å¯¹ merged å±‚æ–‡ä»¶çš„ä¿®æ”¹å’Œåˆ é™¤æ“ä½œæ˜¯é€šè¿‡ overlay2 çš„ upper å±‚å®Œæˆçš„ï¼Œå¹¶ä¸ä¼šå½±å“åˆ°å¤„åœ¨ lower å±‚çš„é•œåƒæœ¬èº«ã€‚ä» docker å®˜æ–¹æ–‡æ¡£ <a href="https://docs.docker.com/storage/storagedriver/overlayfs-driver/" target="_blank" rel="noopener">Use the OverlayFS storage driver</a> é‡Œå·æ¥çš„ä¸€å¼ å›¾ç‰‡ï¼š</p><p><img src="https://p.k8s.li/overlay_constructs.jpg" alt="img"></p><p>å…³äºä¸Šå›¾ä¸­è¿™äº› Dir çš„ä½œç”¨ï¼Œä¸‹é¢æ˜¯ä¸€æ®µä» <a href="https://stackoverflow.com/questions/56550890/docker-image-merged-diff-work-lowerdir-components-of-graphdriver" target="_blank" rel="noopener">StackOverflow</a> ä¸Šæ¬è¿è¿‡æ¥çš„è§£é‡Šã€‚å¦‚æœæƒ³å¯¹ overlayfs æ–‡ä»¶ç³»ç»Ÿæœ‰è¯¦ç»†çš„äº†è§£ï¼Œå¯ä»¥å‚è€ƒ Linux å†…æ ¸å®˜ç½‘ä¸Šçš„è¿™ç¯‡æ–‡æ¡£ <a href="https://www.kernel.org/doc/Documentation/filesystems/overlayfs.txt" target="_blank" rel="noopener">overlayfs.txt</a> ã€‚</p><blockquote><p><strong>LowerDir</strong>: these are the read-only layers of an overlay filesystem. For docker, these are the image layers assembled in order.</p><p><strong>UpperDir</strong>: this is the read-write layer of an overlay filesystem. For docker, that is the equivalent of the container specific layer that contains changes made by that container.</p><p><strong>WorkDir</strong>: this is a required directory for overlay, it needs an empty directory for internal use.</p><p><strong>MergedDir</strong>: this is the result of the overlay filesystem. Docker effectively chrootâ€™s into this directory when running the container.</p></blockquote><p>æ€»ä¹‹ overlay2 å¤§æ³•å¥½ï¼æ ¹æ® overlay2 çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å°†å†å²çš„æ•°æ®å½“ä½œ overlay2 é‡Œçš„ lowerdir æ¥ä½¿ç”¨ã€‚è€Œ upperdir åˆ™æ˜¯æœ¬æ¬¡é•œåƒåŒæ­¥çš„å¢é‡æ•°æ®ï¼Œmerged åˆ™æ˜¯æœ€ç»ˆå®é™…éœ€è¦çš„æ•°æ®ã€‚</p><h2 id="overlay2"><a href="#overlay2" class="headerlink" title="overlay2"></a>overlay2</h2><p>è™½ç„¶åœ¨ä¸Šæ–‡ä¸­æåˆ°äº†ä½¿ç”¨ overlay2 çš„æ–¹æ¡ˆï¼Œä½†åˆ°ç›®å‰ä¸ºæ­¢è¿˜æ˜¯æ²¡æœ‰ä¸€ä¸ªæˆç†Ÿçš„è§£å†³æ–¹æ¡ˆã€‚éœ€è¦è§£å†³çš„é—®é¢˜å¦‚ä¸‹ï¼š</p><ul><li><p>å¦‚ä½•æ¸…ç†æ—§æ•°æ®</p></li><li><p>å¦‚ä½•å¤ç”¨å†å²çš„é•œåƒï¼Ÿ</p></li><li><p>å¦‚ä½•åŒºåˆ†å‡ºå†å²çš„é•œåƒå’Œæœ¬æ¬¡çš„é•œåƒï¼Ÿ</p></li><li><p>å¦‚ä½•ä¿éšœæœ¬æ¬¡é•œåƒåŒæ­¥çš„ç»“æœåªåŒ…å«æœ¬æ¬¡éœ€è¦çš„é•œåƒï¼Ÿ</p></li></ul><h3 id="registry-å­˜å‚¨ç»“æ„"><a href="#registry-å­˜å‚¨ç»“æ„" class="headerlink" title="registry å­˜å‚¨ç»“æ„"></a>registry å­˜å‚¨ç»“æ„</h3><p>æ—¢ç„¶è¦ä½¿ç”¨å†å²çš„é•œåƒä»“åº“æ•°æ®æ¥ä½œä¸º overlay2 çš„ lowerdirã€‚é‚£ä¹ˆå¦‚ä½•è§£å†³ä¹‹å‰æåˆ°çš„æ¸…ç†æ—§æ•°æ®é—®é¢˜ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å†å²çš„é•œåƒçš„é—®é¢˜ï¼Ÿé‚£ä¹ˆè¿˜æ˜¯éœ€è¦å†æ¬¡å›é¡¾ä¸€ä¸‹ registry å­˜å‚¨ç›®å½•ç»“æ„ã€‚</p><p><img src="https://p.k8s.li/registry-storage.jpeg" alt="img"></p><p>æ ¹æ® registry çš„å­˜å‚¨ç»“æ„å¯ä»¥å¾—çŸ¥ï¼šåœ¨ blobs ç›®å½•ä¸‹ä¿å­˜çš„æ˜¯é•œåƒçš„ blob çš„æ–‡ä»¶ã€‚blob æ–‡ä»¶å¤§ä½“ä¸Šæœ‰ä¸‰ç§ï¼šé•œåƒçš„ manifestsï¼›é•œåƒçš„ image config æ–‡ä»¶ï¼›ä»¥åŠé•œåƒçš„ layer å±‚æ–‡ä»¶ã€‚å…¶ä¸­ manifests å’Œ images config æ–‡ä»¶éƒ½æ˜¯ json æ ¼å¼çš„æ–‡æœ¬æ–‡ä»¶ï¼Œé•œåƒçš„ layer å±‚æ–‡ä»¶åˆ™æ˜¯ç»è¿‡å‹ç¼©çš„ tar åŒ…æ–‡ä»¶(ä¸€èˆ¬ä¸º gzip)ã€‚å¦‚æœè¦å¤ç”¨å†å²çš„é•œåƒï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå¤ç”¨çš„æ˜¯é•œåƒçš„ layer å±‚æ–‡ä»¶ï¼Œå› ä¸ºè¿™äº›æ–‡ä»¶æ˜¯é•œåƒå½“ä¸­æœ€å¤§çš„ï¼Œåœ¨ docker pull å’Œ docker push çš„æ—¶å€™å°±æ˜¯å¯¹é•œåƒçš„ layer å±‚æ–‡ä»¶è¿›è¡Œè§£å‹ç¼©çš„ã€‚</p><p>è€Œä¸”å¯¹äºåŒä¸€ä¸ªé•œåƒä»“åº“æ¥è®²ï¼Œblobs ä¸‹çš„æ–‡ä»¶éƒ½æ˜¯ç”± repositories ä¸‹çš„ link æ–‡ä»¶æŒ‡å‘å¯¹åº”çš„ data æ–‡ä»¶çš„ã€‚è¿™å°±æ„å‘³ç€ï¼Œå¤šä¸ªé•œåƒå¯ä»¥ä½¿ç”¨ç›¸åŒçš„ layerã€‚æ¯”å¦‚å‡å¦‚å¤šä¸ªé•œåƒçš„ base é•œåƒä½¿ç”¨çš„éƒ½æ˜¯  <code>debian:buster</code>ï¼Œé‚£ä¹ˆå¯¹äºæ•´ä¸ª registry é•œåƒä»“åº“è€Œè¨€ï¼Œåªéœ€è¦å­˜ä¸€ä»½ <code>debian:buster</code> é•œåƒå³å¯ã€‚</p><p>åŒç†ï¼Œåœ¨ä½¿ç”¨å†å²çš„é•œåƒæ—¶ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥åªä½¿ç”¨å®ƒçš„ layer å‘¢ï¼Ÿè¿™ä¸€ç‚¹å¯èƒ½æ¯”è¾ƒéš¾ç†è§£ ğŸ˜‚ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢è¿™ä¸ªä¾‹å­æ¥ç®€å•è¯´æ˜ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">k8s.gcr.io/kube-apiserver:v1.18.3</span><br><span class="line">k8s.gcr.io/kube-controller-manager:v1.18.3</span><br><span class="line">k8s.gcr.io/kube-scheduler:v1.18.3</span><br><span class="line">k8s.gcr.io/kube-proxy:v1.v1.18.3</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ä½¿ç”¨  skopeo copy å°†è¿™äº›é•œåƒä» <code>k8s.gcr.io</code> å¤åˆ¶åˆ°æœ¬åœ°çš„ä¸€ä¸ªé•œåƒä»“åº“æ—¶ï¼Œå¤åˆ¶å®Œç¬¬ä¸€ä¸ªé•œåƒåï¼Œåœ¨ copy åé¢çš„é•œåƒæ—¶éƒ½ä¼šæç¤º <code>Copying blob 83b4483280e5 skipped: already exists</code> çš„æ—¥å¿—ä¿¡æ¯ã€‚è¿™æ˜¯å› ä¸ºè¿™äº›é•œåƒä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ª base é•œåƒï¼Œè¿™ä¸ª base é•œåƒåªåŒ…å«äº†ä¸€ä¸ª layerï¼Œä¹Ÿå°±æ˜¯ <code>83b4483280e5</code> è¿™ä¸€ä¸ª blob æ–‡ä»¶ã€‚è™½ç„¶æœ¬åœ°çš„é•œåƒä»“åº“ä¸­æ²¡æœ‰è¿™äº›é•œåƒçš„ base é•œåƒï¼Œä½†æ˜¯æœ‰ base é•œåƒçš„ layerï¼Œskopeo ä¹Ÿå°±ä¸ä¼šå† copy è¿™ä¸ªç›¸åŒçš„ blobã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€<span class="comment"># skopeo copy docker://k8s.gcr.io/kube-apiserver:v1.18.3 docker://localhost/kube-apiserver:v1.18.3 --dest-tls-verify=false                                                     </span></span><br><span class="line">Getting image <span class="built_in">source</span> signatures</span><br><span class="line">Copying blob 83b4483280e5 <span class="keyword">done</span></span><br><span class="line">Copying blob 2bfb66b13a96 <span class="keyword">done</span></span><br><span class="line">Copying config 7e28efa976 <span class="keyword">done</span></span><br><span class="line">Writing manifest to image destination</span><br><span class="line">Storing signatures</span><br><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€<span class="comment"># skopeo copy docker://k8s.gcr.io/kube-controller-manager:v1.18.3 docker://localhost/kube-controller-manager:v1.18.3 --dest-tls-verify=false</span></span><br><span class="line">Getting image <span class="built_in">source</span> signatures</span><br><span class="line">Copying blob 83b4483280e5 skipped: already exists</span><br><span class="line">Copying blob 7a73c2c3b85e <span class="keyword">done</span></span><br><span class="line">Copying config da26705ccb <span class="keyword">done</span></span><br><span class="line">Writing manifest to image destination</span><br><span class="line">Storing signatures</span><br><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€<span class="comment"># skopeo copy docker://k8s.gcr.io/kube-scheduler:v1.18.3 docker://localhost/kube-scheduler:v1.18.3 --dest-tls-verify=false</span></span><br><span class="line">Getting image <span class="built_in">source</span> signatures</span><br><span class="line">Copying blob 83b4483280e5 skipped: already exists</span><br><span class="line">Copying blob 133c4d2f432a <span class="keyword">done</span></span><br><span class="line">Copying config 76216c34ed <span class="keyword">done</span></span><br><span class="line">Writing manifest to image destination</span><br><span class="line">Storing signatures</span><br><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€<span class="comment"># skopeo copy docker://k8s.gcr.io/kube-proxy:v1.18.3 docker://localhost/kube-proxy:v1.18.3 --dest-tls-verify=false</span></span><br><span class="line">Getting image <span class="built_in">source</span> signatures</span><br><span class="line">Copying blob 83b4483280e5 skipped: already exists</span><br><span class="line">Copying blob ffa39a529ef3 <span class="keyword">done</span></span><br><span class="line">Copying config 3439b7546f <span class="keyword">done</span></span><br><span class="line">Writing manifest to image destination</span><br><span class="line">Storing signatures</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„å®éªŒæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œåªè¦ registry ä¸­å­˜åœ¨ç›¸åŒçš„ blobï¼Œskopeo å°±ä¸ä¼š copy è¿™ä¸ªç›¸åŒçš„ blobã€‚é‚£ä¹ˆå¦‚ä½•è®© skopeo å’Œ registry çŸ¥é“å­˜åœ¨è¿™äº› layer äº†å‘¢ï¼Ÿ</p><p>è¿™æ—¶éœ€è¦å†æ¬¡å›é¡¾ä»¥ä¸‹ registry å­˜å‚¨ç»“æ„ã€‚åœ¨ repositories ä¸‹ï¼Œæ¯ä¸ªé•œåƒçš„æ–‡ä»¶å¤¹ä¸­éƒ½ä¼šæœ‰ <code>_layers</code> è¿™ä¸ªç›®å½•ï¼Œè€Œè¿™ä¸ªç›®å½•ä¸‹çš„å†…å®¹æ­£æ˜¯æŒ‡å‘é•œåƒ layer å’Œ image config çš„ link æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šåªè¦æŸä¸ªé•œåƒçš„ <code>_layers</code> ä¸‹æœ‰æŒ‡å‘ blob çš„ link æ–‡ä»¶ï¼Œå¹¶ä¸”è¯¥ link æ–‡ä»¶æŒ‡å‘çš„ blobs ä¸‹çš„ data æ–‡ä»¶ç¡®å®å­˜åœ¨ï¼Œé‚£ä¹ˆåœ¨ push é•œåƒçš„æ—¶å€™ registry å°±ä¼šå‘å®¢æˆ·ç«¯è¿”å›è¯¥ blob å·²ç»å­˜åœ¨ï¼Œè€Œ skopeo å°±ä¼šç•¥è¿‡å¤„ç†å·²ç»å­˜åœ¨çš„ blob ã€‚ä»¥æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¾¾åˆ°å¤ç”¨å†å²æ•°æ®çš„ç›®çš„ã€‚</p><p><img src="https://p.k8s.li/registry-storage.jpeg" alt="img"></p><p>åœ¨å†å²é•œåƒä»“åº“æ–‡ä»¶ä¸­ï¼šblobs ç›®å½•æ˜¯å…¨éƒ¨éƒ½è¦çš„ï¼› repositories ç›®å½•ä¸‹åªéœ€è¦æ¯ä¸ªé•œåƒçš„ <code>_layers</code> ç›®å½•å³å¯ï¼›<code>_manifests</code> ç›®å½•ä¸‹æ˜¯é•œåƒçš„ tag æˆ‘ä»¬å¹¶ä¸éœ€è¦ä»–ä»¬ï¼› <code>_uploads</code> ç›®å½•åˆ™æ˜¯ push é•œåƒæ—¶çš„ä¸´æ—¶ç›®å½•ä¹Ÿä¸éœ€è¦ã€‚é‚£ä¹ˆæˆ‘ä»¬æœ€ç»ˆéœ€è¦çš„å†å²é•œåƒä»“åº“ä¸­çš„æ–‡ä»¶å°±å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://p.k8s.li/2021-03-01_09-18-19.jpg" alt="img"></p><p>åˆ°æ­¤ä¸ºæ­¢å·²ç»è§£å†³æ‰äº†å¦‚ä½•æ¸…ç†æ—§æ•°æ®å’Œå¦‚ä½•å¦‚ä½•å¤ç”¨å†å²çš„é•œåƒçš„é—®é¢˜äº†ã€‚æ¥ä¸‹æ¥è¦åšçš„å¦‚ä½•ä½¿ç”¨ overlay2  å»æ„å»ºè¿™ä¸ªé•œåƒä»“åº“æ‰€éœ€çš„æ–‡ä»¶ç³»ç»Ÿäº†ã€‚</p><h3 id="å¥—å¨ƒï¼šé•œåƒé‡Œå¡é•œåƒï¼Ÿ"><a href="#å¥—å¨ƒï¼šé•œåƒé‡Œå¡é•œåƒï¼Ÿ" class="headerlink" title="å¥—å¨ƒï¼šé•œåƒé‡Œå¡é•œåƒï¼Ÿ"></a>å¥—å¨ƒï¼šé•œåƒé‡Œå¡é•œåƒï¼Ÿ</h3><p>æåˆ° overlay2 ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„æ–¹æ¡ˆå°±æ˜¯å®¹å™¨é•œåƒï¼šä½¿ç”¨å¥—å¨ƒçš„æ–¹å¼ï¼Œå°†å†å²çš„é•œåƒä»“åº“å­˜å‚¨ç›®å½•å¤åˆ¶åˆ°ä¸€ä¸ª registry çš„é•œåƒé‡Œï¼Œç„¶åç”¨è¿™ä¸ªé•œåƒæ¥å¯åŠ¨æ‰“åŒ…é•œåƒä»“åº“çš„ registry å®¹å™¨ã€‚è¿™ä¸ªé•œåƒä»“åº“çš„ <code>Dockerfile</code> å¦‚ä¸‹ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> registry:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å†å²é•œåƒä»“åº“çš„ç›®å½•æ‰“åŒ…æˆ tar åŒ…ï¼Œæ”¾åˆ° registry çš„é•œåƒä¸­ï¼Œ ADD æŒ‡ä»¤ä¼šè‡ªåŠ¨è§£å¼€è¿™ä¸ª tar åŒ…</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> docker.tar /var/lib/registry/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æ‰æ‰€æœ‰é•œåƒçš„ _manifests ç›®å½•ï¼Œè®© registry è®¤ä¸ºé‡Œé¢æ²¡æœ‰é•œåƒåªæœ‰ blobs æ•°æ®</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> find /var/lib/registry/docker/registry/v2/repositories -<span class="built_in">type</span> d -name <span class="string">"_manifests"</span> -<span class="built_in">exec</span> rm -rf &#123;&#125; \;</span></span><br></pre></td></tr></table></figure><ul><li>ç„¶åä½¿ç”¨è¿™ä¸ª <code>Dockerfile</code> æ„å»ºä¸€ä¸ªé•œåƒï¼Œå¹¶å‘½åä¸º <code>registry:v0.1.0-base</code> ï¼Œä½¿ç”¨è¿™ä¸ªé•œåƒæ¥ docker run ä¸€ä¸ªå®¹å™¨ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name registry -p 127.0.0.1:443:5000 registry:v0.1.0-base</span><br></pre></td></tr></table></figure><ul><li>æ¥ç€åŒæ­¥é•œåƒ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat images.list | xargs -L1 -I &#123;&#125; skopeo copy  docker://cidi.registry.local/&#123;&#125; docker://package.registry.local/&#123;&#125;</span><br></pre></td></tr></table></figure><ul><li>åŒæ­¥å®Œæˆé•œåƒä¹‹åï¼Œéœ€è¦åˆ é™¤æ‰ repositories ä¸‹æ²¡æœ‰ç”Ÿæˆ _manifests ç›®å½•çš„é•œåƒã€‚å› ä¸ºå¦‚æœæœ¬æ¬¡åŒæ­¥é•œåƒæœ‰è¯¥é•œåƒçš„è¯ï¼Œä¼šåœ¨ repositories ç›®å½•ä¸‹é‡æ–°ç”Ÿæˆ _manifests ç›®å½•ï¼Œå¦‚æœæ²¡æœ‰ç”Ÿæˆçš„è¯å°±è¯´æ˜æœ¬æ¬¡åŒæ­¥çš„åˆ—è¡¨ä¸­ä¸åŒ…å«è¯¥é•œåƒã€‚ä»¥æ­¤å¯ä»¥è§£å†³å¦‚ä½•åŒºåˆ†å‡ºå†å²çš„é•œåƒå’Œæœ¬æ¬¡çš„é•œåƒçš„é—®è…¿ï¼Œè¿™æ ·åˆèƒ½ä½•ä¿éšœæœ¬æ¬¡é•œåƒåŒæ­¥çš„ç»“æœåªåŒ…å«æœ¬æ¬¡éœ€è¦çš„é•œåƒã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> project <span class="keyword">in</span> $(ls repositories/); <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">for</span> image <span class="keyword">in</span> $(ls repositories/<span class="variable">$&#123;project&#125;</span>); <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [[ ! -d <span class="string">"repositories/<span class="variable">$&#123;project&#125;</span>/<span class="variable">$&#123;image&#125;</span>/_manifests"</span> ]]; <span class="keyword">then</span></span><br><span class="line">    rm -rf repositories/<span class="variable">$&#123;project&#125;</span>/<span class="variable">$&#123;image&#125;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><ul><li>æœ€åè¿˜éœ€è¦ä½¿ç”¨ registry GC æ¥åˆ é™¤æ‰ blobs ç›®å½•ä¸‹æ²¡æœ‰è¢«å¼•ç”¨çš„æ–‡ä»¶ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it registry registry garbage-collect /etc/docker/registry/config.yml</span><br></pre></td></tr></table></figure><ul><li>å†ä½¿ç”¨ docker cp çš„æ–¹å¼å°†é•œåƒä»å®¹å™¨é‡Œå¤åˆ¶å‡ºæ¥å¹¶æ‰“åŒ…æˆä¸€ä¸ª tar åŒ…</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker cp registry:/var/lib/registry/docker docker</span><br><span class="line">tar -cf docker.tar docker</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¿™ç§åŠæ³•åšäº†ä¸€ä¸‹ç®€å•çš„æµ‹è¯•ï¼Œå› ä¸ºä½¿ç”¨ skopeo copy é•œåƒçš„æ—¶å€™ä¼šæç¤ºå¾ˆå¤š blobs å·²ç»å­˜åœ¨äº†ï¼Œæ‰€ä»¥å®é™…ä¸Šå¤åˆ¶çš„é•œåƒåªæ˜¯ä¸€å°éƒ¨åˆ†ï¼Œæ€§èƒ½ä¸Šçš„ç¡®æ¯”ä¹‹å‰å¿«äº†å¾ˆå¤šã€‚ä½†æ˜¯è¿™ç§æ–¹æ¡ˆä¹Ÿå­˜åœ¨å¾ˆå¤šçš„å¼Šç«¯ï¼šä¸€æ˜¯è¿™ä¸ª registry çš„é•œåƒéœ€è¦æ‰‹åŠ¨ç»´æŠ¤å’Œæ„å»ºï¼›äºŒæ˜¯ä½¿ç”¨ docker cp çš„æ–¹å¼å°†å®¹å™¨å†…çš„ registry å­˜å‚¨ç›®å½•å¤åˆ¶åˆ°å®¹å™¨å®¿ä¸»æœºï¼Œæ€§èƒ½ä¸Šæœ‰ç‚¹å·®ï¼›ä¸‰æ˜¯ä¸åŒçš„äº§å“éœ€è¦ä¸åŒçš„ base é•œåƒï¼Œç»´æŠ¤èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦æ›´ä¸ºç®€å•ä¸€ç‚¹ä½¿ç”¨ overlay2 æŠ€æœ¯ã€‚</p><h3 id="å®¹å™¨æŒ‚è½½-overlay2-merged-ç›®å½•"><a href="#å®¹å™¨æŒ‚è½½-overlay2-merged-ç›®å½•" class="headerlink" title="å®¹å™¨æŒ‚è½½ overlay2 merged ç›®å½•"></a>å®¹å™¨æŒ‚è½½ overlay2 merged ç›®å½•</h3><p>ä»”ç»†æƒ³ä¸€ä¸‹ï¼Œå°†å†å²çš„é•œåƒæ•°æ®æ”¾åˆ° registry é•œåƒä¸­ï¼Œç”¨å®ƒæ¥å¯åŠ¨ä¸€ä¸ª registry å®¹å™¨ã€‚åŒæ­¥é•œåƒå’Œè¿›è¡Œ registry gc è¿™ä¸¤éƒ¨å®é™…ä¸Šæ˜¯å¯¹ overlay2 çš„ merged å±‚è¿›è¡Œè¯»å†™åˆ é™¤æ“ä½œã€‚é‚£æˆ‘ä»¬ä¸ºä½•ä¸ç›´æ¥åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºå¥½ overlay2 éœ€è¦çš„ç›®å½•ï¼Œç„¶åå†ä½¿ç”¨ overlay2 è”åˆæŒ‚è½½çš„æ–¹å¼å°†è¿™äº›ç›®å½•æŒ‚è½½ä¸ºä¸€ä¸ª merged ç›®å½•ã€‚åœ¨å¯åŠ¨ registry å®¹å™¨çš„æ—¶å€™é€šè¿‡ <code>docker run -v</code> å‚æ•°å°†è¿™ä¸ª merged ç›®å½•ä»¥ bind çš„æ–¹å¼æŒ‚è½½åˆ° registry å®¹å™¨å†…å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬å°±åšä¸€ä¸ªç®€å•çš„éªŒè¯å’Œæµ‹è¯•ï¼š</p><ul><li>é¦–å…ˆåˆ›å»º overlay2 éœ€è¦çš„ç›®å½•</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/lib/registry</span><br><span class="line">mkdir -p lower upper work merged</span><br></pre></td></tr></table></figure><ul><li>å°†å†å²é•œåƒä»“åº“æ•°æ®æ”¾åˆ° lower ç›®å½•å†…</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -cf docker.tar -C /var/lib/registry/lower</span><br></pre></td></tr></table></figure><ul><li>åˆ é™¤ æ‰€æœ‰é•œåƒçš„ _manifests ç›®å½•ï¼Œè®© registry è®¤ä¸ºé‡Œé¢æ²¡æœ‰é•œåƒåªæœ‰ blobs æ•°æ®</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /var/lib/registry/lower/docker/registry/v2/repositories -<span class="built_in">type</span> d -name <span class="string">"_manifests"</span> -<span class="built_in">exec</span> rm -rf &#123;&#125; \;</span><br></pre></td></tr></table></figure><ul><li>æ¨¡æ‹Ÿå®¹å™¨çš„å¯åŠ¨ï¼Œä½¿ç”¨ overlay2 è”åˆæŒ‚è½½ä¸ºä¸€å±‚ merged å±‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t overlay overlay -o lowerdir=lower,upperdir=upper,workdir=work merged</span><br></pre></td></tr></table></figure><ul><li>docker run å¯åŠ¨ä¸€ä¸ª registry ï¼Œå¹¶å°† merged ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…çš„ <code>/var/lib/registry/docker</code> ç›®å½•</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -name registry -p 127.0.0.1:443:5000 \</span><br><span class="line">-v /var/lib/registry/merged/docker:/var/lib/registry/docker</span><br></pre></td></tr></table></figure><ul><li>åŒæ­¥é•œåƒï¼Œå°†æœ¬æ¬¡å‘å¸ƒéœ€è¦çš„é•œåƒåŒæ­¥åˆ° registry ä¸­</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat images.list | xargs -L1 -I &#123;&#125; skopeo copy --insecure-policy --src-tls-verify=<span class="literal">false</span> --dest-tls-verify=<span class="literal">false</span> docker://cicd.registry.local/&#123;&#125; docker://package.registry.local/&#123;&#125;</span><br></pre></td></tr></table></figure><ul><li>åŒæ­¥å®Œæˆé•œåƒåï¼Œè¿›è¡Œ registry gc ï¼Œåˆ é™¤æ— ç”¨çš„ blob æ•°æ®</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it registry registry garbage-collect /etc/docker/registry/config.yml</span><br></pre></td></tr></table></figure><ul><li>æœ€åæ‰“åŒ… merged ç›®å½•ï¼Œå°±æ˜¯æœ¬æ¬¡æœ€ç»ˆçš„ç»“æœ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/lib/registry/merged</span><br><span class="line">tar -cf docker.tar docker</span><br></pre></td></tr></table></figure><p>åœ¨æœ¬åœ°æŒ‰ç…§ä¸Šè¿°æ­¥éª¤è¿›è¡Œäº†ç®€å•çš„éªŒè¯ï¼Œç¡®å®å¯ä»¥ï¼åœ¨ç¬¬äºŒæ¬¡åŒæ­¥é•œåƒçš„æ—¶å€™ä¼šæç¤ºå¾ˆå¤š blob å·²ç»å­˜åœ¨ï¼Œé•œåƒåŒæ­¥çš„é€Ÿåº¦æ¯”ä¹‹å‰åˆå¿«äº† 5 å€å·¦å³ã€‚é‚£ä¹ˆå°†ä¸Šè¿°æ­¥éª¤å†™æˆä¸€ä¸ªè„šæœ¬å°±èƒ½åå¤ä½¿ç”¨äº†ã€‚</p><h3 id="registry-gc-é—®é¢˜-ï¼Ÿ"><a href="#registry-gc-é—®é¢˜-ï¼Ÿ" class="headerlink" title="registry gc é—®é¢˜ ï¼Ÿ"></a>registry gc é—®é¢˜ ï¼Ÿ</h3><p>åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­é‡åˆ°è¿‡ registry GC æ¸…ç†ä¸å¹²å‡€çš„é—®é¢˜ï¼šåœ¨è¿›è¡Œ GC ä¹‹åï¼Œä¸€äº›é•œåƒ layer å’Œ config æ–‡ä»¶å·²ç»åœ¨ blobs å­˜å‚¨ç›®å½•ä¸‹åˆ é™¤äº†ï¼Œä½†æŒ‡å‘å®ƒçš„ link æ–‡ä»¶ä¾æ—§ä¿å­˜åœ¨ repositories ç›®å½•ä¸‹ğŸ™„ã€‚GitHub ä¸Šæœ‰ä¸ª PR <a href="https://github.com/docker/distribution/issues/2288" target="_blank" rel="noopener">Remove the layerâ€™s link by garbage-collect #2288</a> å°±æ˜¯ä¸“é—¨æ¥æ¸…ç†è¿™äº›æ— ç”¨çš„ layer link æ–‡ä»¶çš„ï¼Œæœ€æ—©çš„ä¸€ä¸ªæ˜¯ä¸‰å¹´å‰çš„ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰åˆå¹¶ğŸ˜‚ã€‚</p><p>è§£å†³åŠæ³•å°±æ˜¯ä½¿ç”¨æˆ‘åœ¨ <a href="https://blog.k8s.li/registry-gc.html">docker registry GC åŸç†åˆ†æ</a> æ–‡ç« ä¸­æåˆ°çš„æ–¹æ¡ˆï¼šè‡ªåˆ¶ registry GC è„šæœ¬ğŸ™ƒã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">v2=<span class="variable">$1</span></span><br><span class="line">v2=<span class="variable">$&#123;v2:="/var/lib/registry/docker/registry/v2"&#125;</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$&#123;v2&#125;</span></span><br><span class="line">all_blobs=/tmp/all_blobs.list</span><br><span class="line">: &gt; <span class="variable">$&#123;all_blobs&#125;</span></span><br><span class="line"><span class="comment"># delete unlink blob's link file in _layers</span></span><br><span class="line"><span class="keyword">for</span> link <span class="keyword">in</span> $(find repositories -<span class="built_in">type</span> f -name <span class="string">"link"</span> | grep -E <span class="string">"_layers\/sha256\/.*"</span>); <span class="keyword">do</span></span><br><span class="line">    link_sha256=$(<span class="built_in">echo</span> <span class="variable">$&#123;link&#125;</span> | grep -Eo <span class="string">"_layers\/sha256\/.*"</span> | sed <span class="string">'s/_layers\/sha256\///g;s/\/link//g'</span>)</span><br><span class="line">    link_short=<span class="variable">$&#123;link:0:2&#125;</span></span><br><span class="line">    link_dir=$(<span class="built_in">echo</span> <span class="variable">$&#123;link&#125;</span> | sed <span class="string">'s/\/link//'</span>)</span><br><span class="line">    data_file=blobs/sha256/<span class="variable">$&#123;link_short&#125;</span>/<span class="variable">$&#123;link&#125;</span></span><br><span class="line">    <span class="keyword">if</span> [[ ! -d <span class="variable">$&#123;data_file&#125;</span> ]]; <span class="keyword">then</span> rm -rf <span class="variable">$&#123;link_dir&#125;</span>; <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#marking all the blob by all images manifest</span></span><br><span class="line"><span class="keyword">for</span> tag <span class="keyword">in</span> $(find repositories -name <span class="string">"link"</span> | grep current); <span class="keyword">do</span></span><br><span class="line">    link=$(cat <span class="variable">$&#123;tag&#125;</span> | cut -c8-71)</span><br><span class="line">    mfs=blobs/sha256/<span class="variable">$&#123;link:0:2&#125;</span>/<span class="variable">$&#123;link&#125;</span>/data</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;link&#125;</span> &gt;&gt; <span class="variable">$&#123;all_blobs&#125;</span></span><br><span class="line">    grep -Eo <span class="string">"\b[a-f0-9]&#123;64&#125;\b"</span> <span class="variable">$&#123;mfs&#125;</span> | sort -n | uniq | cut -c1-12 &gt;&gt; <span class="variable">$&#123;all_blobs&#125;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#delete blob if the blob doesn't exist in all_blobs.list</span></span><br><span class="line"><span class="keyword">for</span> blob <span class="keyword">in</span> $(find blobs -name <span class="string">"data"</span> | cut -d <span class="string">"/"</span> -f4); <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> ! grep <span class="variable">$&#123;blob&#125;</span> <span class="variable">$&#123;all_blobs&#125;</span>; <span class="keyword">then</span></span><br><span class="line">        rm -rf blobs/sha256/<span class="variable">$&#123;blob:0:2&#125;</span>/<span class="variable">$&#123;blob&#125;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h2><p>å¥½äº†ï¼Œè‡³æ­¤æœ€ç»ˆçš„ä¼˜åŒ–æ–¹æ¡ˆå·²ç»å®šä¸‹æ¥äº†ï¼Œå…¶æµç¨‹ä¸Šå¦‚ä¸‹ï¼š</p><p><img src="https://p.k8s.li/2021-03-01-002.jpeg" alt="img"></p><ul><li>ç¬¬ä¸€æ¬¡åŒæ­¥é•œåƒçš„æ—¶å€™ä¸å†å°†é•œåƒåŒæ­¥å½’æ¡£å¤‡ä»½çš„é•œåƒä»“åº“ï¼ˆarchive.registry.localï¼‰ è€Œæ˜¯åŒæ­¥åˆ° overlay2 çš„é•œåƒä»“åº“ï¼Œè¿™ä¸ªé•œåƒä»“åº“ä¸­çš„é•œåƒå°†ä½œä¸ºç¬¬äºŒæ¬¡é•œåƒåŒæ­¥çš„ lower å±‚ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat images.list | xargs -L1 -I &#123;&#125; skopeo copy --insecure-policy --src-tls-verify=<span class="literal">false</span> --dest-tls-verify=<span class="literal">false</span> docker://cicd.registry.local/&#123;&#125; docker://overlay2.registry.local/&#123;&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€æ¬¡é•œåƒåŒæ­¥å®Œæˆä¹‹åï¼Œå…ˆæ¸…ç†æ‰ overlay2 çš„ mergedã€upperã€work è¿™ä¸‰å±‚ï¼Œåªä¿ç•™ lower å±‚ã€‚å› ä¸º lower å±‚é‡Œä¿ç•™ç€ç¬¬ä¸€æ¬¡é•œåƒåŒæ­¥çš„ç»“æœã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">umount /var/lib/registry/merged</span><br><span class="line">rm -rf /var/lib/registry/&#123;merged,upper,work&#125;</span><br></pre></td></tr></table></figure><ul><li>æ¥ä¸‹æ¥å°±æ˜¯ä½¿ç”¨ mount æŒ‚è½½ overlay2ï¼ŒæŒ‚è½½å®Œæˆä¹‹åè¿›å…¥åˆ° merged å±‚åˆ é™¤æ‰æ‰€æœ‰çš„ _manifests ç›®å½•</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mount -t overlay overlay -o lowerdir=lower,upperdir=upper,workdir=work merged</span><br><span class="line"><span class="built_in">cd</span> /var/lib/registry/merged</span><br><span class="line">find registry/v2/repositories -<span class="built_in">type</span> d -name <span class="string">"_manifests"</span> -<span class="built_in">exec</span> rm -rf &#123;&#125; \;</span><br></pre></td></tr></table></figure><ul><li>æ¥ç€è¿›è¡Œç¬¬äºŒæ¬¡çš„é•œåƒåŒæ­¥ï¼Œè¿™ä¸€æ¬¡çš„åŒæ­¥ç›®çš„æ˜¯é‡æ–°å»ºç«‹  _manifests ç›®å½•</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat images.list | xargs -L1 -I &#123;&#125; skopeo copy --insecure-policy --src-tls-verify=<span class="literal">false</span> --dest-tls-verify=<span class="literal">false</span> docker://overlay2.registry.local/&#123;&#125; docker://package.registry.local/&#123;&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¬¬äºŒæ¬¡åŒæ­¥å®Œæˆä¹‹åå†ä½¿ç”¨è‡ªåˆ¶çš„ registry GC è„šæœ¬æ¥åˆ é™¤ä¸å¿…è¦çš„ blob æ–‡ä»¶å’Œ link æ–‡ä»¶ã€‚</li><li>æœ€åå°†é•œåƒä»“åº“å­˜å‚¨ç›®å½•æ‰“åŒ…å°±å¾—åˆ°äº†æœ¬æ¬¡éœ€è¦çš„é•œåƒå•¦ã€‚</li></ul><h2 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h2><p>è™½ç„¶æ¯”ä¹‹å‰çš„æµç¨‹å¤æ‚äº†å¾ˆå¤šï¼Œä½†ä¼˜åŒ–çš„ç»“æœæ˜¯ååˆ†æ˜æ˜¾ï¼Œæ¯”ä»¥å¾€å¿«äº† 5 åˆ° 15 å€ï¼Œå¹¶åœ¨æˆ‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒä¸­å·²ç»ç¨³ç¨³åœ°ä½¿ç”¨äº†å¤§åŠå¹´ã€‚</p><p>è¯»å®Œè¿™ç¯‡æ–‡ç« å¯èƒ½ä½ ä¼šè§‰å¾—ä¸€å¤´é›¾æ°´ï¼Œä¸çŸ¥é“ç©¶ç«Ÿåœ¨è®²ä»€ä¹ˆã€‚ä»€ä¹ˆé•œåƒåŒæ­¥ã€é•œåƒ blobã€layerã€overlay2ã€è”åˆæŒ‚è½½ã€å†™æ—¶å¤åˆ¶ç­‰ç­‰ï¼Œè¢«è¿™ä¸€å †å¤æ‚çš„èƒŒæ™¯å’Œæ¦‚å¿µææ··äº†ğŸ˜‚ã€‚æœ¬æ–‡ç¡®å®ä¸å¤ªå¥½ç†è§£ï¼Œå› ä¸ºèƒŒæ™¯å¯èƒ½è¾ƒç‰¹æ®Šå’Œå¤æ‚ï¼Œå¾ˆå°‘äººä¼šé‡åˆ°è¿™æ ·çš„åœºæ™¯ã€‚ä¸ºäº†å¾ˆå¥½åœ°ç†è§£æœ¬æ–‡æ‰€è®²åˆ°çš„å†…å®¹å’ŒèƒŒåçš„åŸç†ï¼Œè¿‡æ®µæ—¶é—´æˆ‘ä¼šå•ç‹¬å†™ä¸€ç¯‡åšå®¢ï¼Œé€šè¿‡æœ€ä½³å®è·µæ¥ç†è§£æœ¬æ–‡æåˆ°çš„æŠ€æœ¯åŸç†ã€‚æ•¬è¯·æœŸå¾…ğŸ˜</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><h3 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h3><ul><li><a href="https://github.com/containers/image" target="_blank" rel="noopener">image</a></li><li><a href="https://github.com/opencontainers/image-spec" target="_blank" rel="noopener">OCI Image Manifest Specification</a></li><li><a href="https://github.com/opencontainers/distribution-spec" target="_blank" rel="noopener">distribution-spec</a></li><li><a href="https://doi-janky.infosiftr.net/job/tianon/job/debuerreotype/" target="_blank" rel="noopener">debuerreotype/</a></li><li><a href="https://www.kernel.org/doc/Documentation/filesystems/overlayfs.txt" target="_blank" rel="noopener">overlayfs.txt</a></li></ul><h3 id="åšå®¢"><a href="#åšå®¢" class="headerlink" title="åšå®¢"></a>åšå®¢</h3><ul><li><a href="http://open.daocloud.io/allen-tan-docker-xi-lie-zhi-tu-kan-jin-docker-rong-qi-wen-jian-xi-tong/" target="_blank" rel="noopener">çœ‹å°½ docker å®¹å™¨æ–‡ä»¶ç³»ç»Ÿ</a></li><li><a href="https://supereagle.github.io/2018/04/24/docker-registry/" target="_blank" rel="noopener">é•œåƒä»“åº“ä¸­é•œåƒå­˜å‚¨çš„åŸç†è§£æ</a></li><li><a href="https://segmentfault.com/a/1190000014284289" target="_blank" rel="noopener">Dockeré•œåƒçš„å­˜å‚¨æœºåˆ¶</a></li></ul><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ul><li><a href="https://blog.k8s.li/Exploring-container-image.html">æ·±å…¥æµ…å‡ºå®¹å™¨é•œåƒçš„ä¸€ç”ŸğŸ¤”</a></li><li><a href="https://blog.k8s.li/skopeo.html">é•œåƒæ¬è¿å·¥ skopeo åˆä½“éªŒ</a></li><li><a href="https://blog.k8s.li/mount-bind.html">mount å‘½ä»¤ä¹‹ â€“bind æŒ‚è½½å‚æ•°</a></li><li><a href="https://blog.k8s.li/registry-gc.html">docker registry GC åŸç†åˆ†æ</a></li><li><a href="https://blog.k8s.li/docker-registry-to-harbor.html">docker registry è¿ç§»è‡³ harbor</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="registry" scheme="https://blog.k8s.li/tags/registry/"/>
    
      <category term="images" scheme="https://blog.k8s.li/tags/images/"/>
    
  </entry>
  
  <entry>
    <title>åŒæ­¥ docker hub library é•œåƒåˆ°æœ¬åœ° registry</title>
    <link href="https://blog.k8s.li/sync-dockerhub-library-images.html"/>
    <id>https://blog.k8s.li/sync-dockerhub-library-images.html</id>
    <published>2021-02-09T16:00:00.000Z</published>
    <updated>2021-02-15T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ°çƒ‚é’±ï¼Ÿ"><a href="#æ°çƒ‚é’±ï¼Ÿ" class="headerlink" title="æ°çƒ‚é’±ï¼Ÿ"></a>æ°çƒ‚é’±ï¼Ÿ</h2><p>è‡ªä»å»å¹´ 11 æœˆä»½å¼€å§‹ï¼Œdocker å…¬å¸ä¸ºäº†æ°ç‚¹çƒ‚é’±å°±å¯¹ docker hub ä¸Š pull é•œåƒçš„ç­–ç•¥è¿›è¡Œé™åˆ¶ï¼š</p><ul><li><strong>æœªç™»å½•ç”¨æˆ·ï¼Œæ¯ 6 å°æ—¶åªå…è®¸ pull 100 æ¬¡</strong></li><li><strong>å·²ç™»å½•ç”¨æˆ·ï¼Œæ¯ 6 å°æ—¶åªå…è®¸ pull 200 æ¬¡</strong></li></ul><p>è€Œä¸”ï¼Œé™åˆ¶çš„æ‰‹æ®µä¹Ÿéå¸¸åœ°ç²—æš´ï¼Œé€šè¿‡åˆ¤æ–­è¯·æ±‚é•œåƒçš„ manifest æ–‡ä»¶çš„æ¬¡æ•°ï¼Œè¯·æ±‚ä¸€ä¸ªé•œåƒçš„ manifest æ–‡ä»¶å°±ç®—ä½œä¸€æ¬¡ pull é•œåƒã€‚å³ä¾¿ä½  pull å¤±è´¥äº†ï¼Œä¹Ÿä¼šç®—ä½œä¸€æ¬¡ã€‚</p><p>éšåä¹Ÿæœ‰å¾ˆå¤šå¤§ä½¬åˆ†äº«ç»•è¿‡ docker hub é™åˆ¶çš„åŠæ³•ï¼Œæ¯”å¦‚æ­å»ºç§æœ‰çš„é•œåƒä»“åº“ï¼Œç„¶åå†ç»™å®¢æˆ·ç«¯é…ç½®ä¸Š <code>registry-mirrors</code> å‚æ•°ï¼Œå°±å¯ä»¥é€šè¿‡æœ¬åœ°çš„é•œåƒä»“åº“æ¥æ‹‰å–é•œåƒã€‚</p><ul><li><a href="https://moelove.info/2020/09/20/%E7%AA%81%E7%A0%B4-DockerHub-%E9%99%90%E5%88%B6%E5%85%A8%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E6%9C%8D%E5%8A%A1/" target="_blank" rel="noopener">çªç ´ DockerHub é™åˆ¶ï¼Œå…¨é•œåƒåŠ é€ŸæœåŠ¡</a></li><li><a href="https://nova.moe/bypass-docker-hub-429/" target="_blank" rel="noopener">ç»•è¿‡ä» Docker Hub pull é•œåƒæ—¶çš„ 429 toomanyrequests</a></li><li><a href="https://www.chenshaowen.com/blog/how-to-cross-the-limit-of-dockerhub.html" target="_blank" rel="noopener">å¦‚ä½•ç»•è¿‡ DockerHub æ‹‰å–é•œåƒé™åˆ¶</a></li></ul><p>ä½†æ˜¯å‘¢ï¼Œä»¥ä¸Šæ–¹æ³•éƒ½æ¯”è¾ƒå±€é™ï¼šé¦–å…ˆé•œåƒéœ€è¦æŒ¨ä¸ªæ‰‹åŠ¨ push åˆ°æœ¬åœ°é•œåƒä»“åº“ï¼›å…¶æ¬¡æœ¬åœ°é•œåƒä»“åº“ä¸­çš„é•œåƒæ— æ³•å’Œå®˜æ–¹é•œåƒä¿æŒåŒæ­¥æ›´æ–°ï¼Œå¦‚æœè¦ä½¿ç”¨æ–°çš„ tag å¥½çš„é•œåƒä»ç„¶éœ€è¦æ‰‹åŠ¨å°†é•œåƒä» docker hub ä¸Š pull ä¸‹æ¥ï¼Œç„¶åå† push åˆ°æœ¬åœ°é•œåƒä»“åº“ï¼›è¿˜æœ‰æ‰‹åŠ¨ push é•œåƒæ˜¯æ¯”è¾ƒæ··ä¹±çš„ï¼Œå¦‚æœä½¿ç”¨çš„é•œåƒæ¯”è¾ƒå¤šï¼Œæ¯”å¦‚å…¬æœ‰äº‘å®¹å™¨æœåŠ¡ï¼Œè¿™æ—¶å€™å†æ‰‹åŠ¨ push çš„è¯ç®¡ç†èµ·æ¥æ˜¯åŠå…¶ä¸æ–¹ä¾¿çš„ã€‚</p><p>å› æ­¤ç»è¿‡ä¸€ç•ªæŠ˜è…¾ç»ˆäºæ‘¸ç´¢å‡ºäº†ä¸€ä¸ªæ–¹æ¡ˆï¼šå°† docker hub ä¸Š library repo çš„é•œåƒåŒæ­¥åˆ°æœ¬åœ°é•œåƒä»“åº“ï¼Œæœ€ç»ˆè¦åšåˆ°ä¸Šæ¸¸å¦‚æœæ›´æ–°äº†é•œåƒ tag ä¹Ÿèƒ½è‡ªåŠ¨åœ°å°†é•œåƒåŒæ­¥åˆ°æœ¬åœ°é•œåƒä»“åº“ã€‚</p><h2 id="è·å–é•œåƒ-tag"><a href="#è·å–é•œåƒ-tag" class="headerlink" title="è·å–é•œåƒ tag"></a>è·å–é•œåƒ tag</h2><p>å¯¹äº docker hub ä¸Šçš„é•œåƒï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ°æœ€å¤šçš„å°±æ˜¯ library è¿™ä¸ª repo å³ <a href="https://docs.docker.com/docker-hub/official_images/" target="_blank" rel="noopener">Official Images on Docker Hub</a>ï¼Œé‡Œé¢åŒ…å«ç€å¤§éƒ¨åˆ†å¼€æºè½¯ä»¶å’Œ Linux å‘è¡Œç‰ˆçš„åŸºç¡€é•œåƒã€‚</p><blockquote><ul><li>Provide essential base OS repositories (for example, <a href="https://hub.docker.com/_/ubuntu/" target="_blank" rel="noopener">ubuntu</a>, <a href="https://hub.docker.com/_/centos/" target="_blank" rel="noopener">centos</a>) that serve as the starting point for the majority of users.</li><li>Provide drop-in solutions for popular programming language runtimes, data stores, and other services, similar to what a Platform as a Service (PAAS) would offer.</li><li>Exemplify <a href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/" target="_blank" rel="noopener"><code>Dockerfile</code> best practices</a> and provide clear documentation to serve as a reference for other <code>Dockerfile</code> authors.</li><li>Ensure that security updates are applied in a timely manner. This is particularly important as Official Images are some of the most popular on Docker Hub.</li></ul></blockquote><p>library çš„é•œåƒå¸¸è§çš„ç‰¹ç‚¹å°±æ˜¯å½“æˆ‘ä»¬ä½¿ç”¨ docker å®¢æˆ·ç«¯å» pull ä¸€ä¸ªé•œåƒæ—¶ï¼Œæ— éœ€æŒ‡å®šè¯¥é•œåƒçš„ repo ï¼Œæ¯”å¦‚ <code>ubuntu:latest</code>ï¼Œå…¶ä»–é library çš„é•œåƒéœ€è¦æŒ‡å®šé•œåƒæ‰€å±çš„ repo ï¼Œæ¯”å¦‚ <code>jenkins/slave:latest</code>ã€‚è¿™éƒ¨åˆ†ä»£ç æ˜¯ç¡¬ç¼–ç åœ¨ docker çš„æºç å½“ä¸­çš„ã€‚</p><blockquote><p>æˆ‘ä»¬è™½ç„¶æ—¥å¸¸è®¿é—®çš„æ˜¯ <code>https://hub.docker.com</code> ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨ <a href="https://github.com/docker/distribution/blob/master/reference/normalize.go#L13" target="_blank" rel="noopener">https://github.com/docker/distribution/blob/master/reference/normalize.go#L13</a> ä¸­å¯ä»¥çœ‹åˆ°å®é™… <code>docker</code> ä½¿ç”¨çš„åœ°å€æ˜¯ä¸€ä¸ªç¡¬ç¼–ç çš„ <code>docker.io</code></p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">legacyDefaultDomain = <span class="string">"index.docker.io"</span></span><br><span class="line">defaultDomain       = <span class="string">"docker.io"</span></span><br><span class="line">officialRepoName    = <span class="string">"library"</span></span><br><span class="line">defaultTag          = <span class="string">"latest"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></blockquote><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å‡ ç§åŠæ³•æ¥è·å– docker hub ä¸Š library repo çš„é•œåƒåˆ—è¡¨ã€‚</p><h3 id="é€šè¿‡-docker-registry-å‘½ä»¤è¡Œ"><a href="#é€šè¿‡-docker-registry-å‘½ä»¤è¡Œ" class="headerlink" title="é€šè¿‡ docker registry å‘½ä»¤è¡Œ"></a>é€šè¿‡ docker registry å‘½ä»¤è¡Œ</h3><p>åœ¨ docker å®˜æ–¹æ–‡æ¡£ä¸­ <a href="https://docs.docker.com/engine/reference/commandline/registry/" target="_blank" rel="noopener">docker registry</a> æœ‰æåˆ°å¯ä»¥åˆ—å‡ºæŸä¸ª registry ä¸­çš„é•œåƒï¼Œä½†è¿™ä¸ªåŠŸèƒ½ä»…é™äº <a href="https://docs.docker.com/ee/supported-platforms/" target="_blank" rel="noopener">Docker Enterprise Edition.</a> ç‰ˆæœ¬ï¼Œè€Œç¤¾åŒºçš„ç‰ˆæœ¬ä¸­æœªæœ‰è¯¥å‘½ä»¤ã€‚é‚æ”¾å¼ƒâ€¦â€¦</p><blockquote><p>This command is only available on Docker Enterprise Edition.</p><p>Learn more about <a href="https://docs.docker.com/ee/supported-platforms/" target="_blank" rel="noopener">Docker Enterprise products</a>.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker registry ls <span class="comment"># List registry images</span></span><br></pre></td></tr></table></figure><h3 id="é€šè¿‡-registry-v2-API"><a href="#é€šè¿‡-registry-v2-API" class="headerlink" title="é€šè¿‡ registry v2 API"></a>é€šè¿‡ registry v2 API</h3><ul><li><code>get-images.list</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -eo pipefail</span><br><span class="line"></span><br><span class="line">DOCKER_HUB_URL=<span class="string">"https://hub.docker.com/v2/repositories/library"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">get_images_list</span></span>() &#123;</span><br><span class="line">    ALL_IMAGES=<span class="string">""</span></span><br><span class="line">    URL=<span class="string">"<span class="variable">$&#123;DOCKER_HUB_URL&#125;</span>/?page_size=100"</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span> ; <span class="keyword">do</span></span><br><span class="line">        ALL_IMAGES=<span class="string">"<span class="variable">$(curl -sSL $&#123;URL&#125; | jq -r '.results[].name' | tr '\n' ' ')</span> <span class="variable">$&#123;ALL_IMAGES&#125;</span>"</span></span><br><span class="line">        URL=<span class="string">"<span class="variable">$(curl -sSL $&#123;URL&#125; | jq -r '.next')</span>"</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;URL&#125;</span>"</span> = <span class="string">"null"</span> ]; <span class="keyword">then</span> <span class="built_in">break</span>; <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    : &gt; all_library_images.list</span><br><span class="line">    <span class="keyword">for</span> image <span class="keyword">in</span> <span class="variable">$&#123;ALL_IMAGES&#125;</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> skopeo list-tags docker://<span class="variable">$&#123;image&#125;</span> &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">            skopeo list-tags docker://<span class="variable">$&#123;image&#125;</span> | jq <span class="string">".Tags"</span> | tr -d <span class="string">'[],\" '</span> | tr -s <span class="string">'\n'</span> | sed <span class="string">"s|^|<span class="variable">$&#123;image&#125;</span>:|g"</span> &gt;&gt; all_library_images.list</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line">get_images_list</span><br></pre></td></tr></table></figure><p>é€šè¿‡ docker hub çš„  API è·å–åˆ°çš„é•œåƒ tag å®åœ¨æ˜¯å¤ªå¤šäº†ï¼Œæˆªè‡³ä»Šæ—¥ docker hub ä¸Šæ•´ä¸ª <a href="https://hub.docker.com/u/library" target="_blank" rel="noopener">library repo</a> çš„é¡¹ç›®ä¸€å…±æœ‰ 162 ä¸ªï¼Œè€Œè¿™ 162 ä¸ªé¡¹ç›®ä¸­çš„é•œåƒ tag æ•°é‡å¤šè¾¾<strong>äº”ä¸‡ä¸¤åƒ</strong>å¤šä¸ªã€‚æ€»çš„é•œåƒä»“åº“å­˜å‚¨å ç”¨ç©ºé—´çš„å¤§å°é¢„è®¡è‡³å°‘ 5TB ã€‚å…¶ä¸­çš„é•œåƒæˆ‘ä»¬çœŸæ­£éœ€è¦ç”¨åˆ°çš„ä¼°è®¡ä¹Ÿä¸åˆ° <strong>0.1%</strong>ï¼Œå› æ­¤éœ€è¦æƒ³ä¸ªåŠæ³•å‡å°‘è¿™ä¸ªé•œåƒåˆ—è¡¨çš„æ•°é‡ï¼Œè·å¾—çš„é•œåƒåˆ—è¡¨æ›´ç²¾ç¡®ä¸€äº›ï¼Œé€šç”¨ä¸€äº›ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /opt/official-images â€¹sync*â€º</span><br><span class="line">â•°â”€<span class="comment"># cat all_library_images.list|cut -d ':' -f1 | sort -u | wc</span></span><br><span class="line">    162     162    1353</span><br><span class="line">â•­â”€root@sg-02 /opt/official-images â€¹sync*â€º</span><br><span class="line">â•°â”€<span class="comment"># cat all_library_images.list | wc</span></span><br><span class="line">  52094   52094 1193973</span><br></pre></td></tr></table></figure><h3 id="é€šè¿‡-official-images-repo"><a href="#é€šè¿‡-official-images-repo" class="headerlink" title="é€šè¿‡ official-images repo"></a>é€šè¿‡ official-images repo</h3><p>ä»¥ <a href="https://hub.docker.com/_/debian" target="_blank" rel="noopener">debian</a> ä¸ºä¾‹ï¼Œåœ¨ docker hub ä¸Šé•œåƒçš„ tag åŸºæœ¬ä¸Šéƒ½æ˜¯è¿™æ ·å­çš„ï¼š</p><blockquote><p><strong>Supported tags and respective <code>Dockerfile</code> links</strong></p><ul><li><a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/bullseye/Dockerfile" target="_blank" rel="noopener"><code>bullseye</code>, <code>bullseye-20210208</code></a></li><li><a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/bullseye/backports/Dockerfile" target="_blank" rel="noopener"><code>bullseye-backports</code></a></li><li><a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/bullseye/slim/Dockerfile" target="_blank" rel="noopener"><code>bullseye-slim</code>, <code>bullseye-20210208-slim</code></a></li><li><a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/buster/Dockerfile" target="_blank" rel="noopener"><code>buster</code>, <code>buster-20210208</code>, <code>10.8</code>, <code>10</code>, <code>latest</code></a></li><li><a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/buster/backports/Dockerfile" target="_blank" rel="noopener"><code>buster-backports</code></a></li><li><a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/buster/slim/Dockerfile" target="_blank" rel="noopener"><code>buster-slim</code>, <code>buster-20210208-slim</code>, <code>10.8-slim</code>, <code>10-slim</code></a></li><li><a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/experimental/Dockerfile" target="_blank" rel="noopener"><code>experimental</code>, <code>experimental-20210208</code></a></li><li><a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/jessie/Dockerfile" target="_blank" rel="noopener"><code>jessie</code>, <code>jessie-20210208</code>, <code>8.11</code>, <code>8</code></a></li><li><a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/jessie/slim/Dockerfile" target="_blank" rel="noopener"><code>jessie-slim</code>, <code>jessie-20210208-slim</code>, <code>8.11-slim</code>, <code>8-slim</code></a></li></ul></blockquote><p>æ¯ä¸€è¡Œéƒ½ä»£è¡¨ç€åŒä¸€ä¸ªé•œåƒï¼Œå¦‚ï¼š <a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/buster/Dockerfile" target="_blank" rel="noopener"><code>buster</code>, <code>buster-20210208</code>, <code>10.8</code>, <code>10</code>, <code>latest</code></a> ã€‚ä¸€è¡Œä¸­é•œåƒè™½ç„¶æœ‰å¤šä¸ª tagï¼Œä½†è¿™äº› tag æŒ‡å‘çš„ manifest å…¶å®éƒ½æ˜¯ä¸€è‡´çš„ã€‚é•œåƒ tag çš„å…³ç³»æœ‰ç‚¹ç±»ä¼¼äº C è¯­è¨€é‡Œçš„æŒ‡é’ˆå˜é‡ï¼Œæ˜¯å¼•ç”¨çš„å…³ç³»ã€‚</p><p>ä½†è¿™ä¹ˆå¤šçš„ä¿¡æ¯æ˜¯å¦‚ä½•é«˜æ•ˆåœ°ç®¡ç†çš„å‘¢ï¼Ÿäºæ˜¯é¡ºè—¤æ‘¸ç“œå‘ç°äº†ï¼šç”±äº library repo é‡Œçš„é•œåƒæ„å»ºä¿¡æ¯éƒ½æ˜¯ç”± <a href="https://github.com/docker-library/official-images" target="_blank" rel="noopener">official-images</a> è¿™ä¸ª repo æ¥ç®¡ç†çš„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># buster -- Debian 10.8 Released 06 February 2021</span></span><br><span class="line">Tags: buster, buster-20210208, 10.8, 10, latest</span><br><span class="line">Architectures: amd64, arm32v5, arm32v7, arm64v8, i386, mips64le, ppc64le, s390x</span><br><span class="line">Directory: buster</span><br><span class="line"></span><br><span class="line">Tags: buster-backports</span><br><span class="line">Architectures: amd64, arm32v5, arm32v7, arm64v8, i386, mips64le, ppc64le, s390x</span><br><span class="line">Directory: buster/backports</span><br><span class="line"></span><br><span class="line">Tags: buster-slim, buster-20210208-slim, 10.8-slim, 10-slim</span><br><span class="line">Architectures: amd64, arm32v5, arm32v7, arm64v8, i386, mips64le, ppc64le, s390x</span><br><span class="line">Directory: buster/slim</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ª <a href="https://github.com/docker-library/official-images" target="_blank" rel="noopener">official-images</a>  repo é‡Œ  library ç›®å½•ä¸‹æœ‰ä»¥é•œåƒ name å‘½åçš„æ–‡ä»¶ï¼Œè€Œæ–‡ä»¶çš„å†…å®¹æ­£æ˜¯è®°å½•ç€ä¸ docker hub ç›¸å¯¹åº”çš„ tag ä¿¡æ¯ã€‚ç”±æ­¤æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸ª repo è·å– library repo é•œåƒçš„ tagã€‚å¥½å¤„åœ¨äºè™½ç„¶è¿™æ ·å¾—åˆ°çš„é•œåƒåˆ—è¡¨å¹¶ä¸æ˜¯å…¨é¢çš„ï¼Œä½†è¿™ä¸ª repo é‡Œè®°å½•çš„é•œåƒ tag éƒ½æ˜¯å®˜æ–¹è¿˜åœ¨ç»´æŠ¤çš„ï¼Œå¹¶ä¸ä¼šåŒ…å«ä¸€äº›æ—§çš„æˆ–è€… CI æµ‹è¯•çš„é•œåƒã€‚è¿™æ ·è·å¾—çš„é•œåƒåˆ—è¡¨æ›´é€šç”¨ä¸€äº›ã€‚</p><p>æ‹¿å‡º Linux æ–‡æœ¬å¤„ç†ä¸‰å‰‘å®¢ï¼Œä¸€é¡¿æ“ä½œæ“å‡ºäº†ä¸ªè„šæœ¬æ¥ç”Ÿæˆé•œåƒä»¥åŠé•œåƒçš„æ•°é‡ã€‚æƒŠå¥‡çš„å‘ç°ï¼Œé€šè¿‡è¿™ç§æ–¹å¼è·å–åˆ°çš„é•œåƒæ•°é‡ä¸º docker hub çš„ registry API è·å–åˆ°çš„é•œåƒæ•°é‡çš„ååˆ†ä¹‹ä¸€å·¦å³ã€‚æ ¹æ®å¦‚ä¸‹æ•°æ®å¯ä»¥å¾—å‡ºï¼Œdocker hub çœŸå®éœ€è¦çš„é•œåƒæ•°é‡ä¸º 1517 ä¸ªï¼Œè€Œ 5590 ä¸ªé•œåƒä¸­åŒ…å«äº†å¤šä¸ª tag æŒ‡å‘åŒä¸€ä¸ªé•œåƒçš„æƒ…å†µï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¿™äº›ç›¸åŒé•œåƒçš„ tag pull ä¸€æ¬¡å³å¯ï¼Œå…¶ä½™çš„é•œåƒé€šè¿‡ retag çš„æ–¹å¼æ‰“ä¸Š tag å³å¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–é•œåƒåˆ—è¡¨</span></span><br><span class="line">$ grep -Er <span class="string">"^Tags:|^SharedTags:"</span> library | sed <span class="string">'s|library/||g;s|:Tags||g;s|:SharedTags||g;s| ||g'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–é•œåƒæ•°é‡ï¼Œä¹Ÿå°±æ˜¯ manifests çš„æ•°é‡</span></span><br><span class="line">$ grep -Er <span class="string">"^Tags:|^SharedTags:"</span> library | sed <span class="string">'s|library/||g;s|:Tags||g;s|:SharedTags||g;s| ||g'</span> | wc</span><br><span class="line">   1518    1518   95999</span><br><span class="line"><span class="comment"># è·å–æ‰€æœ‰é•œåƒ tag æ•°é‡ï¼ŒåŒ…å«äº†æ‰€æœ‰çš„ tag</span></span><br><span class="line">$ grep -Er <span class="string">"^Tags:|^SharedTags:"</span> library | sed <span class="string">'s|library/||g;s|:Tags||g;s|:SharedTags||g;s| ||g'</span> | tr <span class="string">','</span> <span class="string">'\n'</span> | wc</span><br><span class="line">   5590    5590   95999</span><br></pre></td></tr></table></figure><h2 id="æœ¬åœ°åŒæ­¥é•œåƒ"><a href="#æœ¬åœ°åŒæ­¥é•œåƒ" class="headerlink" title="æœ¬åœ°åŒæ­¥é•œåƒ"></a>æœ¬åœ°åŒæ­¥é•œåƒ</h2><p>è·å–åˆ°é•œåƒåˆ—è¡¨ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ç”¨ä½¿ç”¨ <a href="https://github.com/containers/skopeo/blob/master/docs/skopeo-copy.1.md" target="_blank" rel="noopener">skopeo copy</a> ç›´æ¥å°†é•œåƒ copy åˆ°æœ¬åœ°çš„é•œåƒä»“åº“ä¸­å•¦ã€‚ç»“åˆä¸Šè¿°æ­¥éª¤ï¼Œä½¿ç”¨ä¸åˆ° 20 è¡Œçš„è„šæœ¬å°±èƒ½å®Œæˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ALL_IMAGES=$(grep -Er <span class="string">"^Tags:|^SharedTags:"</span> library \</span><br><span class="line">| sed <span class="string">'s|library/||g;s|:Tags||g;s|:SharedTags||g;s| ||g'</span>)</span><br><span class="line">IFS=$<span class="string">'\n'</span></span><br><span class="line"><span class="keyword">for</span> image <span class="keyword">in</span> <span class="variable">$&#123;ALL_IMAGES&#125;</span>; <span class="keyword">do</span></span><br><span class="line">    name=<span class="string">"<span class="variable">$(echo $&#123;image&#125; | cut -d ':' -f1)</span>"</span></span><br><span class="line">    tags=<span class="string">"<span class="variable">$(echo $&#123;image&#125; | cut -d ':' -f2 | cut -d ',' -f1)</span>"</span></span><br><span class="line">    <span class="keyword">if</span> skopeo copy docker://<span class="variable">$&#123;name&#125;</span>:<span class="variable">$&#123;tags&#125;</span> docker://registry.local/library/<span class="variable">$&#123;name&#125;</span>:<span class="variable">$&#123;tags&#125;</span>; <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">for</span> tag <span class="keyword">in</span> $(<span class="built_in">echo</span> <span class="variable">$&#123;image&#125;</span> | cut -d <span class="string">':'</span> -f2 | tr <span class="string">','</span> <span class="string">'\n'</span>); <span class="keyword">do</span></span><br><span class="line">        skopeo copy docker://<span class="variable">$&#123;name&#125;</span>:<span class="variable">$&#123;tag&#125;</span> docker://registry.local/library/<span class="variable">$&#123;name&#125;</span>:<span class="variable">$&#123;tags&#125;</span>;</span><br><span class="line">     <span class="keyword">done</span></span><br><span class="line">     <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>ä½†ï¼Œæ²¡æˆ‘æƒ³è±¡ä¸­çš„é‚£ä¹ˆç®€å•ï¼Œåœ¨è‡ªå·±çš„æœºå™¨ä¸Š pull äº†ä¸åˆ° 150 ä¸ªé•œåƒçš„æ—¶å€™å°±æŠ¥é”™é€€å‡ºäº†ï¼Œæç¤º <code>toomanyrequests: You have reached your pull rate limit.</code> é”™è¯¯ã€‚å¿ƒé‡Œ mmpï¼Œdocker inc å•Šï¼Œå¹²å•¥å•¥ä¸è¡Œï¼ˆå¦‚ä»Š Docker Machineï¼ŒDocker Swarmï¼Œdocker-compose ä¸‰é©¾é©¬è½¦å“ªå„¿å»äº†ï¼Ÿï¼‰ï¼Œ<strong>æ°çƒ‚é’±å¯è¿˜è¡Œ</strong>ğŸ˜¡ã€‚</p><blockquote><p>ime=â€2021-02-12T07:08:51Zâ€ level=fatal msg=â€Error parsing image name &quot;docker://ubuntu:latest&quot;:</p><p>Error reading manifest latest in docker.io/library/ubuntu: toomanyrequests: You have reached your pull rate limit. You may increase the limit by authenticating and upgrading: <a href="https://www.docker.com/increase-rate-limit&quot;" target="_blank" rel="noopener">https://www.docker.com/increase-rate-limit&quot;</a></p></blockquote><h2 id="Dockerfile-é‡ŒåŒæ­¥é•œåƒï¼Ÿ"><a href="#Dockerfile-é‡ŒåŒæ­¥é•œåƒï¼Ÿ" class="headerlink" title="Dockerfile é‡ŒåŒæ­¥é•œåƒï¼Ÿ"></a>Dockerfile é‡ŒåŒæ­¥é•œåƒï¼Ÿ</h2><p>æ—¢ç„¶åœ¨æœ¬åœ°æœ‰ pull æ¬¡æ•°çš„é™åˆ¶ï¼Œé‚£ä»€ä¹ˆåœ°æ–¹ä¸ä¼šæœ‰è¿™ç§é™åˆ¶å‘¢ï¼Ÿé¦–å…ˆæƒ³åˆ°çš„æ˜¯ docker hub ä¸Š build é•œåƒè‚¯å®šä¸ä¼šé™åˆ¶å§ã€‚åº”è¯¥æ˜¯çš„â€¦â€¦ã€‚ä¸å¦‚åœ¨ Dockerfile é‡Œå¡ä¸€ä¸ªè„šæœ¬ï¼Œç”¨å®ƒæ¥åŒæ­¥é•œåƒå¦‚ä½•ï¼Ÿäºæ˜¯ä¸€é¡¿æ“ä½œçŒ›å¦‚è™ï¼Œä¸ä¸€ä¼šå„¿å°±æ“å‡ºæ¥ä¸ª Dockerfileã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:unstable-slim</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">set</span> -xue ;\</span></span><br><span class="line"><span class="bash">    apt update -y ;\</span></span><br><span class="line"><span class="bash">    apt install ca-certificates skopeo git curl jq -y --no-install-recommends ;\</span></span><br><span class="line"><span class="bash">    rm -rf /var/lib/apt/lists/* ;\</span></span><br><span class="line"><span class="bash">    git <span class="built_in">clone</span> -b sync https://github.com/muzi502/official-images /build</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">set</span> -xue ;\</span></span><br><span class="line"><span class="bash">    skopeo login hub.k8s.li -u admin -p Harbor123456 ;\</span></span><br><span class="line"><span class="bash">    bash /build/sync-images.sh</span></span><br></pre></td></tr></table></figure><p>ç„¶â€¦â€¦äº‹å®è¯æ˜æ˜¯æˆ‘å¤ªå¤©çœŸäº†ï¼Œåœ¨åŒæ­¥äº†ä¸åˆ° 100 å¤šä¸ªé•œåƒåï¼ŒåŒæ ·ä¹Ÿå‡ºç°äº† 429 toomanyrequests çš„é™åˆ¶ã€‚æ€æ¡Œå„¿ï¼åœ¨ docker hub ä¸Šæ„å»ºé•œåƒï¼Œä¹Ÿä¼šè¢«é™åˆ¶ï¼Ÿè‡ªå·±é™åˆ¶è‡ªå·±ï¼Ÿï¼Ÿè¿™ä»€ä¹ˆé¸¡å„¿ç©æ„ã€‚</p><p><del>å‡å¦‚æœ‰ä¸€ä¸ªå¤šé˜¶æ®µæ„å»ºçš„ Dockerfileï¼Œå°±æœ‰å¯èƒ½å› ä¸ºæ‹‰ä¸åˆ°é•œåƒè€Œå¯¼è‡´é•œåƒæ„å»ºå¤±è´¥ã€‚é‚£ä¹ˆè¿™ç§æ™ºéšœçš„è®¾è®¡æ²¡æƒ³åˆ°è¿‡ï¼Ÿ</del></p><p>æƒ³åˆ°ä¸€ç§å¯èƒ½æ˜¯ docker hub å†…éƒ¨æ˜¯é€šè¿‡ token æ¥è¿›è¡ŒéªŒè¯çš„ï¼Œè€Œä¸æ˜¯æ ¹æ®å®¢æˆ·ç«¯è®¿é—®æº IP ã€‚build é•œåƒçš„å®¿ä¸»æœºä¸Šä¼šæœ‰ docker login çš„ token æ–‡ä»¶ï¼Œä½† build é•œåƒçš„å®¹å™¨é‡Œæ˜¯æ²¡æœ‰è¿™ä¸ª token æ–‡ä»¶çš„ï¼Œæ‰€ä»¥åœ¨ dockerfile é‡Œ pull é•œåƒåŒæ ·ä¼šè¢«é™åˆ¶ã€‚çœ‹æ¥ dockerfile é‡ŒåŒæ­¥é•œåƒçš„æ–¹æ¡ˆä¹Ÿå°±ä¸è¡Œäº†ğŸ™ƒï¼Œåªèƒ½å¦å¯»ä»–è·¯å•¦ã€‚</p><h2 id="GitHub-Action-æ¥åŒæ­¥é•œåƒ"><a href="#GitHub-Action-æ¥åŒæ­¥é•œåƒ" class="headerlink" title="GitHub Action æ¥åŒæ­¥é•œåƒ"></a>GitHub Action æ¥åŒæ­¥é•œåƒ</h2><h3 id="ssh-è¿æ¥-runner"><a href="#ssh-è¿æ¥-runner" class="headerlink" title="ssh è¿æ¥ runner"></a>ssh è¿æ¥ runner</h3><p>åœ¨åˆšå¼€å§‹å†™è¿™ç¯‡åšå®¢çš„æ—¶å€™ä¹Ÿæ²¡æœ‰æƒ³åˆ°ä½¿ç”¨ GitHub Actionï¼Œåœ¨åˆ· GitHub åŠ¨æ€çš„æ—¶å€™æ— æ„é—´å‘ç°äº†å®ƒã€‚äºæ˜¯åˆä¸€é¡¿æ“ä½œçœ‹çœ‹ GitHub Action æ˜¯å¦èƒ½ç”¨æ¥åŒæ­¥é•œåƒã€‚</p><p>é¦–å…ˆå‚è€ƒ <a href="https://p3terx.com/archives/ssh-to-the-github-actions-virtual-server-environment.html" target="_blank" rel="noopener">SSH è¿æ¥åˆ° GitHub Actions è™šæ‹ŸæœåŠ¡å™¨</a> è¿æ¥åˆ° runner çš„æœºå™¨ä¸Š:</p><ul><li><code>.github/workflows/ssh.yaml</code></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Ubuntu</span></span><br><span class="line"><span class="attr">on:</span> <span class="string">push</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-20.04</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">tmate</span> <span class="string">session</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">mxschmitt/action-tmate@v1</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ ssh è¿æ¥åˆ° action runner çš„æœºå™¨é‡Œæ„å¤–å‘ç°ï¼Œåœ¨ <code>~/.docker/config.json</code> æ–‡ä»¶é‡Œç«Ÿç„¶å·²ç»æœ‰äº†ä¸ª login çš„ docker hub è´¦æˆ·ã€‚<code>å“¦è±.jpg</code>ã€‚ç”±äº docker login çš„é…ç½®æ–‡ä»¶åªæ˜¯ç®€å•çš„ base64 åŠ å¯†ï¼Œè§£ç åæ‹¿åˆ°çœŸå®çš„ user å’Œ tokenã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">runner@fv-az60-303:~$ cat .docker/config.json</span><br><span class="line">&#123;</span><br><span class="line">        "auths": &#123;</span><br><span class="line">                "https://index.docker.io/v1/": &#123;</span><br><span class="line">                        "auth": "Z2l0aHViYWN0aW9uczozZDY0NzJiOS0zZDQ5LTRkMTctOWZjOS05MGQyNDI1ODA0M2I="</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;runner@fv-az60-303:~$ echo "Z2l0aHViYWN0aW9uczozZDY0NzJiOS0zZDQ5LTRkMTctOWZjOS05MGQyNDI1ODA0M2I=" | base64 -d</span><br><span class="line">githubactions:3d6472b9-3d49-4d17-9fc9-90d24258043b</span><br></pre></td></tr></table></figure><p><img src="https://p.k8s.li/image-20210216173039196.png" alt=""></p><p>äºæ˜¯æƒ³ç€å¯ä»¥éªŒè¯ä¸€ä¸‹è¿™ä¸ªè´¦æˆ·æ˜¯å¦æœ‰é™åˆ¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --user <span class="string">'githubactions:3d6472b9-3d49-4d17-9fc9-90d24258043'</span> <span class="string">"https://auth.docker.io/token?service=registry.docker.io&amp;scope=repository:ratelimitpreview/test:pull"</span></span><br></pre></td></tr></table></figure><p>ä½†å¤±è´¥äº†ï¼Œæç¤º <code>{&quot;details&quot;:&quot;incorrect username or password&quot;}</code> ï¼Œä¼°è®¡è¿™ä¸ªè´¦æˆ·æ˜¯ä¸ª bot è´¦æˆ·ï¼Œåªèƒ½ç”¨äº pull é•œåƒï¼Œå…¶ä»–çš„ api è¯·æ±‚éƒ½æ²¡æƒé™ä½¿ç”¨ã€‚è‡³äºè¿™ä¸ªè´¦æˆ·æœ‰æ²¡æœ‰é™åˆ¶ï¼Œè¿˜éœ€è¦åšä¸‹æµ‹è¯•ã€‚</p><p>å¦å¤–æ„å¤–åœ°å‘ç° runner çš„æœºå™¨é‡Œé›†æˆäº†å¾ˆå¤šå·¥å…·ï¼Œå…¶ä¸­  skopeo ä¹ŸåŒ…å«åœ¨å†…ï¼Œå®åœ¨æ˜¯å¤ªæ–¹ä¾¿äº†ã€‚GitHub ç‰›çš®ï¼Œå¾®è½¯çˆ¸çˆ¸æˆ‘çˆ±ä½ ğŸ˜˜ï¼é‚£å°±æ–¹ä¾¿äº†ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨ skopeo inspect å»è¯·æ±‚é•œåƒçš„ manifests æ–‡ä»¶ã€‚çœ‹çœ‹æœ€å¤šèƒ½è¯·æ±‚å¤šå°‘ä¼šè¢«é™åˆ¶ã€‚äºæ˜¯èŠ±äº†ç‚¹æ—¶é—´æ“äº†ä¸ªè„šæœ¬ç”¨äºå»è·å– docker hub ä¸Š library repo ä¸­çš„æ‰€æœ‰é•œåƒçš„ manifests æ–‡ä»¶ã€‚</p><ul><li><code>get-manifests.sh</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -eo pipefail</span><br><span class="line"></span><br><span class="line">DOCKER_HUB_URL=<span class="string">"https://hub.docker.com/v2/repositories/library"</span></span><br><span class="line">IMAGES_LIST=<span class="string">"images.list"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">get_images_list</span></span>() &#123;</span><br><span class="line">    ALL_IMAGES=<span class="string">""</span></span><br><span class="line">    URL=<span class="string">"<span class="variable">$&#123;DOCKER_HUB_URL&#125;</span>/?page_size=100"</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span> ; <span class="keyword">do</span></span><br><span class="line">        ALL_IMAGES=<span class="string">"<span class="variable">$(curl -sSL $&#123;URL&#125; | jq -r '.results[].name' | tr '\n' ' ')</span> <span class="variable">$&#123;ALL_IMAGES&#125;</span>"</span></span><br><span class="line">        URL=<span class="string">"<span class="variable">$(curl -sSL $&#123;URL&#125; | jq -r '.next')</span>"</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;URL&#125;</span>"</span> = <span class="string">"null"</span> ]; <span class="keyword">then</span> <span class="built_in">break</span>; <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    : &gt; <span class="variable">$&#123;IMAGES_LIST&#125;</span></span><br><span class="line">    <span class="keyword">for</span> image <span class="keyword">in</span> <span class="variable">$&#123;ALL_IMAGES&#125;</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> skopeo list-tags docker://<span class="variable">$&#123;image&#125;</span> &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">            skopeo list-tags docker://<span class="variable">$&#123;image&#125;</span> | jq -c <span class="string">".Tags"</span> | tr -d <span class="string">'[]\"'</span> \</span><br><span class="line">            | tr <span class="string">','</span> <span class="string">'\n'</span> | sed <span class="string">"s|^|<span class="variable">$&#123;image&#125;</span>:|g"</span> &gt;&gt; <span class="variable">$&#123;IMAGES_LIST&#125;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">get_manifests</span></span>() &#123;</span><br><span class="line">    mkdir -p manifests</span><br><span class="line">    IFS=$<span class="string">'\n'</span></span><br><span class="line">    <span class="keyword">for</span> image <span class="keyword">in</span> $(cat <span class="variable">$&#123;IMAGES_LIST&#125;</span>); <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> skopeo inspect --raw docker://<span class="variable">$&#123;image&#125;</span> | jq  -r <span class="string">'.manifests[].digest'</span> &amp;&gt; /dev/null ; <span class="keyword">then</span></span><br><span class="line">            skopeo inspect --raw docker://<span class="variable">$&#123;image&#125;</span> | jq  -r <span class="string">'.manifests[].digest'</span> \</span><br><span class="line">            |  xargs -L1 -P8 -I % sh -c <span class="string">"skopeo inspect --raw docker://<span class="variable">$&#123;image/:*/&#125;</span>@% &gt; manifests/<span class="variable">$&#123;image&#125;</span>@%.json"</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            skopeo inspect --raw docker://<span class="variable">$&#123;image&#125;</span> &gt; manifests/<span class="variable">$&#123;image&#125;</span>.json</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">get_images_list</span><br><span class="line">get_manifests</span><br></pre></td></tr></table></figure><p>ç»è¿‡ä¸€ç•ªé•¿æ—¶é—´çš„åˆºæµ‹è¯•ï¼Œåœ¨è·å–äº† 20058   ä¸ªé•œåƒçš„ manifest æ–‡ä»¶ä¹‹åä¾æ—§æ²¡æœ‰è¢«é™åˆ¶ï¼Œäºæ˜¯å¤§èƒ†çŒœæµ‹ï¼Œrunner é‡Œå†…ç½®çš„ docker hub è´¦æˆ· pull library é•œåƒæ˜¯æ²¡æœ‰é™åˆ¶çš„ã€‚ä¼°è®¡æ˜¯ GitHub å’Œ docker inc è¾¾æˆäº†  py äº¤æ˜“ï¼Œç”¨è¿™ä¸ªè´¦æˆ·å» pull å…¬å…±é•œåƒæ²¡æœ‰é™åˆ¶ã€‚</p><p><img src="https://p.k8s.li/image-20210216173003436.png" alt=""></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">runner@fv-az212-267:~/work/runner-test/runner-test$ ls manifests/ | wc</span><br><span class="line">  20058   20058 1875861</span><br></pre></td></tr></table></figure><h3 id="å®šæ—¶åŒæ­¥é•œåƒ"><a href="#å®šæ—¶åŒæ­¥é•œåƒ" class="headerlink" title="å®šæ—¶åŒæ­¥é•œåƒ"></a>å®šæ—¶åŒæ­¥é•œåƒ</h3><p>ä»ä¸Šè¿°æ­¥éª¤ä¸€å¯çŸ¥åœ¨ GitHub Action runner æœºå™¨é‡Œè‡ªå¸¦çš„ docker login è´¦æˆ·æ˜¯æ²¡æœ‰é™åˆ¶ï¼Œé‚£æˆ‘ä»¬æœ€ç»ˆå°±é€‰å®šä½¿ç”¨å®ƒæ¥åŒæ­¥é•œåƒåˆ°æœ¬åœ° registry å§ã€‚å‚ç…§ GitHub Action ç…§è‘«èŠ¦ç”»ç“¢æ“äº†ä¸ª action çš„é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">sync-images</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sync</span></span><br><span class="line">  <span class="comment"># è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œæ¯ 6 å°æ—¶è¿è¡Œä¸€æ¬¡</span></span><br><span class="line">  <span class="attr">schedule:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">cron:</span> <span class="string">"* */6 * * *"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">sync-images:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-20.04</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Clone</span> <span class="string">repository</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">git</span> <span class="string">config</span> <span class="string">user.name</span> <span class="string">github-actions</span></span><br><span class="line">          <span class="string">git</span> <span class="string">config</span> <span class="string">user.email</span> <span class="string">github-actions@github.com</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Sync</span> <span class="string">images</span></span><br><span class="line">        <span class="attr">shell:</span> <span class="string">bash</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">REGISTRY_DOMAIN:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.REGISTRY_DOMAIN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">REGISTRY_USER:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.REGISTRY_USER</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">REGISTRY_PASSWORD:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.REGISTRY_PASSWORD</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">sudo</span> <span class="string">skopeo</span> <span class="string">login</span> <span class="string">$&#123;REGISTRY_DOMAIN&#125;</span>  <span class="string">-u</span> <span class="string">$&#123;REGISTRY_USER&#125;</span> <span class="string">-p</span> <span class="string">$&#123;REGISTRY_PASSWORD&#125;</span></span><br><span class="line">          <span class="string">sudo</span> <span class="string">bash</span> <span class="string">sync-images.sh</span> <span class="string">$&#123;REGISTRY_DOMAIN&#125;</span></span><br></pre></td></tr></table></figure><p>æ—¢ç„¶ GitHub runner çš„æœºå™¨é‡Œæœ‰ docker login çš„é…ç½®æ–‡ä»¶ï¼Œä¸å¦‚æŠŠå®ƒ<strong>å·</strong>è¿‡æ¥ï¼Œå¤åˆ¶ç²˜è´´åˆ°è‡ªå®¶çš„æœºå™¨ä¸Šä½¿ç”¨ğŸ˜œï¼Ÿä¸è¿‡æˆ‘è®¤ä¸ºè¿™ç§è¡Œä¸ºæœ‰ç‚¹ä¸åšé“ğŸ˜‚ï¼Œè¿˜æ˜¯åˆ«å¹²äº†ã€‚åœ¨è¿™é‡Œåªæä¾›ä¸€ä¸ªæ€è·¯ï¼Œå®é™…ä¸Šå¯è¡Œæ€§è¿˜å¾…éªŒè¯ã€‚</p><h3 id="å¢é‡åŒæ­¥"><a href="#å¢é‡åŒæ­¥" class="headerlink" title="å¢é‡åŒæ­¥"></a>å¢é‡åŒæ­¥</h3><p>é»˜è®¤è®¾ç½®çš„ä¸º 6 å°æ—¶åŒæ­¥ä¸€æ¬¡ä¸Šæ¸¸æœ€æ–°çš„ä»£ç ï¼Œç”±äºå®šæ—¶æ›´æ–°æ˜¯ä½¿ç”¨çš„å¢é‡åŒæ­¥ï¼Œå³é€šè¿‡ git diff çš„æ–¹å¼å°†å½“å‰åˆ†æ”¯æœ€æ–°çš„ commit å’Œä¸Šæ¸¸ docker hub å®˜æ–¹çš„ repo æœ€æ–° commit è¿›è¡Œæ¯”è¾ƒï¼Œæ‰¾å‡ºå˜åŒ–çš„é•œåƒã€‚å› æ­¤å¦‚æœæ˜¯é¦–æ¬¡åŒæ­¥ï¼Œéœ€è¦å…¨é‡åŒæ­¥ï¼Œåœ¨åŒæ­¥å®Œæˆä¹‹åä¼šç»™ repo æ‰“ä¸Šä¸€ä¸ªæ—¶é—´æˆ³çš„ tag ï¼Œä¸‹æ¬¡åŒæ­¥çš„æ—¶å€™å°±ç”¨è¿™ä¸ª tag å’Œä¸Šæ¸¸ repo æœ€æ–° commit åšå·®å¼‚æ¯”è¾ƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IMAGES=$(git diff --name-only --ignore-space-at-eol --ignore-space-change \</span><br><span class="line">    --diff-filter=AM $&#123;LAST_TAG&#125; $&#123;CURRENT_COMMIT&#125; library | xargs -L1 -I &#123;&#125; sed "s|^|&#123;&#125;:|g" &#123;&#125; \</span><br><span class="line">    | sed -n "s| ||g;s|library/||g;s|:Tags:|:|p;s|:SharedTags:|:|p" | sort -u | sed "/$&#123;SKIPE_IMAGES&#125;/d")</span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•é£Ÿç”¨ï¼Ÿ"><a href="#å¦‚ä½•é£Ÿç”¨ï¼Ÿ" class="headerlink" title="å¦‚ä½•é£Ÿç”¨ï¼Ÿ"></a>å¦‚ä½•é£Ÿç”¨ï¼Ÿ</h2><p>å¦‚æœä½ ä¹Ÿæƒ³å°† docker hub ä¸Š library repo çš„é•œåƒæåˆ°æœ¬åœ°é•œåƒä»“åº“ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹æ–¹æ³•ï¼š</p><h3 id="åŠé€€ä¸‰è¿ğŸ˜‚"><a href="#åŠé€€ä¸‰è¿ğŸ˜‚" class="headerlink" title="åŠé€€ä¸‰è¿ğŸ˜‚"></a>åŠé€€ä¸‰è¿ğŸ˜‚</h3><ul><li>é¦–å…ˆè¦æœ¬åœ°éƒ¨ç½²å¥½é•œåƒä»“åº“å¹¶é…ç½®å¥½ SSL è¯ä¹¦ã€‚é•œåƒä»“åº“å»ºè®®ä½¿ç”¨ docker registry æˆ–è€… harborï¼Œå…·ä½“çš„éƒ¨ç½²æ–¹æ³•å¯ä»¥åœ¨äº’è”ç½‘ä¸Šæ‰¾åˆ°ã€‚</li><li>éœ€è¦ä¸ªå¤§ç›˜é¸¡ï¼ˆå¤§ç¡¬ç›˜æœºå™¨ï¼‰ï¼Œå½“å‰ docker hub ä¸Šè¿˜åœ¨ç»´æŠ¤çš„ tag é•œåƒæ€»å¤§å°ä¸º 128 GB å·¦å³ã€‚</li><li>å¦‚æœæ˜¯é•¿æœŸä½¿ç”¨ï¼Œæœ¬åœ°é•œåƒä»“åº“çš„å­˜å‚¨ç©ºé—´è‡³å°‘ 1TB ä»¥ä¸Šã€‚</li><li>ç”±äºæ˜¯ä½¿ç”¨ GitHub action çš„æœºå™¨å°†é•œåƒ push åˆ°æœ¬åœ°é•œåƒä»“åº“ï¼Œå› æ­¤æœ¬åœ°é•œåƒä»“åº“éœ€è¦æœ‰ä¸ªå…¬ç½‘IPä»¥åŠåŸŸå + SSL è¯ä¹¦</li></ul><h3 id="å¢åŠ é…ç½®"><a href="#å¢åŠ é…ç½®" class="headerlink" title="å¢åŠ é…ç½®"></a>å¢åŠ é…ç½®</h3><p>é¦–å…ˆ fork å®˜æ–¹çš„ repo <a href="https://github.com/docker-library/official-images" target="_blank" rel="noopener">docker-library/official-images</a>  åˆ°è‡ªå·±çš„ GitHub è´¦æˆ·ä¸‹ï¼›</p><p>ç„¶å fork è¿™ä¸ª repo <a href="https://github.com/muzi502/sync-library-images" target="_blank" rel="noopener">muzi502/sync-library-images</a> åˆ°è‡ªå·±çš„ GitHub è´¦æˆ·ä¸‹ï¼›</p><p>æœ€ååœ¨è‡ªå·±çš„ sync-library-images è¿™ä¸ª repo çš„ <code>Settings &gt;  Secrets</code> ä¸­é…ç½®å¥½å¦‚ä¸‹ä¸‰ä¸ªå˜é‡ï¼š</p><ul><li>REGISTRY_DOMAIN è®¾ç½®ä¸ºæœ¬åœ°é•œåƒä»“åº“çš„åŸŸå</li><li>REGISTRY_USER æœ¬åœ°é•œåƒä»“åº“çš„ç”¨æˆ·å</li><li>REGISTRY_PASSWORD è®¾ç½®ä¸ºæœ¬åœ°é•œåƒä»“åº“çš„å¯†ç </li></ul><p><img src="https://p.k8s.li/image-20210216163441719.png" alt=""></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><p><a href="https://docs.docker.com/docker-hub/official_images/" target="_blank" rel="noopener">Official Images on Docker Hub</a></p></li><li><p><a href="https://hub.docker.com/support/doc/how-do-i-authenticate-with-the-v2-api" target="_blank" rel="noopener">How do I authenticate with the V2 API?</a></p></li><li><p><a href="https://docs.docker.com/docker-hub/download-rate-limit/" target="_blank" rel="noopener">Download rate limit</a></p></li><li><p><a href="https://moelove.info/2020/09/20/%E7%AA%81%E7%A0%B4-DockerHub-%E9%99%90%E5%88%B6%E5%85%A8%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E6%9C%8D%E5%8A%A1/" target="_blank" rel="noopener">çªç ´ DockerHub é™åˆ¶ï¼Œå…¨é•œåƒåŠ é€ŸæœåŠ¡</a></p></li><li><p><a href="https://nova.moe/bypass-docker-hub-429/" target="_blank" rel="noopener">ç»•è¿‡ä» Docker Hub pull é•œåƒæ—¶çš„ 429 toomanyrequests</a></p></li><li><p><a href="https://www.chenshaowen.com/blog/how-to-cross-the-limit-of-dockerhub.html" target="_blank" rel="noopener">å¦‚ä½•ç»•è¿‡ DockerHub æ‹‰å–é•œåƒé™åˆ¶</a></p></li><li><p><a href="https://p3terx.com/archives/ssh-to-the-github-actions-virtual-server-environment.html" target="_blank" rel="noopener">SSH è¿æ¥åˆ° GitHub Actions è™šæ‹ŸæœåŠ¡å™¨</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;æ°çƒ‚é’±ï¼Ÿ&quot;&gt;&lt;a href=&quot;#æ°çƒ‚é’±ï¼Ÿ&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="registry" scheme="https://blog.k8s.li/tags/registry/"/>
    
      <category term="images" scheme="https://blog.k8s.li/tags/images/"/>
    
  </entry>
  
  <entry>
    <title>docker registry è¿ç§»è‡³ harbor</title>
    <link href="https://blog.k8s.li/docker-registry-to-harbor.html"/>
    <id>https://blog.k8s.li/docker-registry-to-harbor.html</id>
    <published>2021-01-30T16:00:00.000Z</published>
    <updated>2021-04-17T01:11:01.098Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Registry"><a href="#Registry" class="headerlink" title="Registry"></a>Registry</h2><h3 id="Docker-Distribution"><a href="#Docker-Distribution" class="headerlink" title="Docker Distribution"></a>Docker Distribution</h3><p><a href="https://github.com/distribution/distribution" target="_blank" rel="noopener">Docker Distribution</a> æ˜¯ç¬¬ä¸€ä¸ªæ˜¯å®ç°äº†æ‰“åŒ…ã€å‘å¸ƒã€å­˜å‚¨å’Œé•œåƒåˆ†å‘çš„å·¥å…·ï¼Œèµ·åˆ° Docker registry çš„ä½œç”¨ã€‚ï¼ˆç›®å‰ Distribution å·²ç»æèµ ç»™äº† CNCFï¼‰ã€‚å…¶ä¸­ Docker Distribution ä¸­çš„ <a href="https://github.com/distribution/distribution/tree/main/docs/spec" target="_blank" rel="noopener">spec è§„èŒƒ</a> åæ¥ä¹Ÿå°±æˆä¸ºäº† OCI <a href="https://github.com/opencontainers/distribution-spec" target="_blank" rel="noopener">distribution-spec</a> è§„èŒƒã€‚å¯ä»¥è®¤ä¸º Docker Distribution å®ç°äº†å¤§éƒ¨åˆ† OCI é•œåƒåˆ†å‘çš„è§„èŒƒï¼ŒäºŒè€…åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¹Ÿæ˜¯å…¼å®¹çš„ã€‚ OCI çš„æŒ‡å¯¼æ€æƒ³æ—¶å…ˆæœ‰å·¥ä¸šç•Œçš„å®è·µï¼Œå†å°†è¿™äº›å®è·µæ€»ç»“æˆæŠ€æœ¯è§„èŒƒï¼Œå› æ­¤å°½ç®¡ OCI çš„ <a href="https://github.com/opencontainers/distribution-spec" target="_blank" rel="noopener">distribution-spec</a> è§„èŒƒè¿˜æ²¡æœ‰æ­£å¼å‘å¸ƒï¼ˆç›®å‰ç‰ˆæœ¬æ˜¯<a href="https://github.com/opencontainers/distribution-spec/releases/tag/v1.0.0-rc1" target="_blank" rel="noopener">v1.0.0-rc1</a>ï¼‰ï¼Œä½†ä»¥ Docker Distribution ä½œä¸ºåŸºç¡€çš„é•œåƒä»“åº“å·²ç»æˆä¸ºæ™®éé‡‡ç”¨çš„æ–¹æ¡ˆï¼ŒDocker registry HTTP API V2 ä¹Ÿå°±æˆä¸ºäº†äº‹å®ä¸Šçš„æ ‡å‡†ã€‚</p><h3 id="Harbor"><a href="#Harbor" class="headerlink" title="Harbor"></a>Harbor</h3><p>Harbor ä¹Ÿæ˜¯é‡‡ç”¨äº† Docker Distribution ï¼ˆdocker registryï¼‰ä½œä¸ºåç«¯é•œåƒå­˜å‚¨æœåŠ¡ï¼Œåœ¨ Harbor 2.0 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œé•œåƒç›¸å…³çš„åŠŸèƒ½å¤§éƒ¨åˆ†æ˜¯ç”± Docker Distribution æ¥å¤„ç†ï¼Œé•œåƒå’Œ OCI ç­‰åˆ¶å“çš„å…ƒæ•°æ®æ˜¯ harbor ç»„ä»¶ä» docker registry ä¸­æå–å‡ºæ¥çš„ï¼›Harbor åœ¨ 2.0 ç‰ˆæœ¬ä¹‹åï¼Œé•œåƒç­‰ OCI åˆ¶å“ç›¸å…³çš„å…ƒæ•°æ®ç”± Harbor è‡ªå·±æ¥ç»´æŠ¤ï¼Œè€Œä¸”<strong>å…ƒæ•°æ®æ˜¯åœ¨ PUSH è¿™äº›åˆ¶å“æ—¶å†™å…¥åˆ° harbor çš„æ•°æ®åº“ä¸­çš„</strong>ã€‚ä¹Ÿæ­£å› å¾—ç›Šäºæ­¤ï¼ŒHarbor ä¸å†ä»…ä»…æ˜¯ä¸ªç”¨æ¥å­˜å‚¨å’Œç®¡ç†é•œåƒçš„æœåŠ¡ï¼Œè€Œä¸€ä¸ªäº‘åŸç”Ÿä»“åº“æœåŠ¡ï¼Œèƒ½å¤Ÿå­˜å‚¨å’Œç®¡ç†ç¬¦åˆ OCI è§„èŒƒçš„ Helm Chartã€CNABã€OPA Bundle ç­‰å¤šç§ Artifact ã€‚</p><h3 id="docker-registry-to-harbor"><a href="#docker-registry-to-harbor" class="headerlink" title="docker registry to harbor"></a>docker registry to harbor</h3><p>å¥½äº†ï¼Œæ‰¯äº†è¿™ä¹ˆå¤šæ²¡ç”¨çš„æ¦‚å¿µï¼Œå›åˆ°æœ¬æ–‡è¦è§£å†³çš„é—®é¢˜ï¼š<strong>å¦‚ä½•å°† docker registry ä¸­çš„é•œåƒè¿ç§»è‡³ harborï¼Ÿ</strong></p><p>å‡å¦‚å†…ç½‘ç¯å¢ƒä¸­æœ‰ä¸¤å°æœºå™¨ï¼Œä¸€å°æœºå™¨ä¸Šè¿è¡Œç€ docker registryï¼ŒåŸŸåå‡è®¾ä¸º registry.k8s.li ã€‚å¦ä¸€å°æœºå™¨è¿è¡Œç€ harborï¼Œå‡è®¾åŸŸåä¸º harbor.k8s.liã€‚ç°åœ¨ docker registry ä¸­å­˜æ”¾äº†äº”åƒä¸ªé•œåƒã€‚harbor æ˜¯åˆšåˆšéƒ¨ç½²çš„ï¼Œé‡Œé¢è¿˜æ²¡æœ‰é•œåƒã€‚åœ¨ç£ç›˜å’Œç½‘ç»œæ²¡æœ‰é™åˆ¶çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•é«˜æ•ˆåœ°å°† docker registry ä¸­çš„é•œåƒè¿ç§»åˆ° harbor ä¸­å‘¢ï¼Ÿ</p><h2 id="è·å–-registry-æ‰€æœ‰é•œåƒçš„åˆ—è¡¨"><a href="#è·å–-registry-æ‰€æœ‰é•œåƒçš„åˆ—è¡¨" class="headerlink" title="è·å– registry æ‰€æœ‰é•œåƒçš„åˆ—è¡¨"></a>è·å– registry æ‰€æœ‰é•œåƒçš„åˆ—è¡¨</h2><p>é¦–å…ˆåœ¨è¿ç§»ä¹‹å‰æˆ‘ä»¬è¦æ‹‰æ¸…å•ï¼Œè·å–ä¸€ä»½ docker registry ä¸­é•œåƒçš„åˆ—è¡¨ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½ä¿è¯è¿ç§»åæ²¡æœ‰é•œåƒä¸¢å¤±ã€‚æ ¹æ®æœ¨å­åœ¨ <a href="https://blog.k8s.li/Exploring-container-image.html">æ·±å…¥æµ…å‡ºå®¹å™¨é•œåƒçš„ä¸€ç”ŸğŸ¤”</a> æ–‡ç« ä¸­æåˆ°çš„ registry çš„å­˜å‚¨ç›®å½•ç»“æ„ã€‚åœ¨ registry å­˜å‚¨ç›®å½•ä¸­ï¼Œæ¯ä¸ªé•œåƒçš„ tag éƒ½æ˜¯ç”± <code>current/index</code> è¿™ä¸ªæ–‡ä»¶æŒ‡å‘è¯¥ tag é•œåƒçš„ manifests æ–‡ä»¶çš„ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡éå† registry å­˜å‚¨ç›®å½•ä¸­ <code>current/index</code> æ–‡ä»¶çš„æ–¹å¼æ¥å¾—åˆ°æ‰€æœ‰é•œåƒçš„ tagï¼Œç”±æ­¤å¾—åˆ°è¯¥ registry ä¸­æ‰€æœ‰é•œåƒçš„åˆ—è¡¨ã€‚æ³¨æ„ï¼Œè¿™æ ·åªèƒ½å¾—åˆ°æœ‰ tag çš„é•œåƒï¼Œå…¶ä»–æ²¡ tag çš„é•œåƒæ— æ³•è·å–åˆ°ã€‚</p><p><img src="https://p.k8s.li/registry-storage.jpeg" alt=""></p><p>å¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤åœ¨ registry å­˜å‚¨ç›®å½•ä¸‹è·å–é•œåƒåˆ—è¡¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆè¿›å…¥åˆ° registry å­˜å‚¨çš„ä¸»ç›®å½•ä¸‹</span></span><br><span class="line"><span class="built_in">cd</span>  /var/lib/registry</span><br><span class="line">find docker -<span class="built_in">type</span> d -name <span class="string">"current"</span> | sed <span class="string">'s|docker/registry/v2/repositories/||g;s|/_manifests/tags/|:|g;s|/current||g'</span> &gt; images.list</span><br></pre></td></tr></table></figure><h2 id="harbor-åˆ›å»º-project"><a href="#harbor-åˆ›å»º-project" class="headerlink" title="harbor åˆ›å»º project"></a>harbor åˆ›å»º project</h2><p>å¯¹äºæ–°éƒ¨ç½²çš„ harbor æ¥è¯´ï¼Œä¸Šé¢åªä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ library çš„ projectï¼Œéœ€è¦æ‰‹åŠ¨åœ¨ harbor ä¸Šåˆ›å»º docker registry ä¸­å¯¹åº”çš„ projectã€‚docker registry ä¸­é•œåƒçš„ project å°±æ˜¯ registry å­˜å‚¨ç›®å½•ä¸­ <code>repositories</code> ä¸‹çš„ç›®å½•åã€‚</p><p>å¾—åˆ°äº†é•œåƒåˆ—è¡¨ï¼Œä»¥åŠåœ¨ harbor ä¸Šå®Œæˆäº†å¯¹åº” project çš„åˆ›å»ºï¼Œæˆ‘ä»¬å°±å¯ä»¥åšæ­£å¼çš„è¿ç§»å·¥ä½œå•¦ã€‚æ ¹æ®ä¸åŒçš„åœºæ™¯ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹å‡ ç§æ–¹æ¡ˆï¼š</p><h2 id="æ–¹æ¡ˆä¸€ï¼šdocker-retag"><a href="#æ–¹æ¡ˆä¸€ï¼šdocker-retag" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šdocker retag"></a>æ–¹æ¡ˆä¸€ï¼šdocker retag</h2><p>æ–¹æ¡ˆä¸€å¯èƒ½æ˜¯å¤§å¤šæ•°äººé¦–å…ˆæƒ³åˆ°çš„åŠæ³•ï¼Œä¹Ÿæ˜¯æœ€ç®€å•ç²—æš´çš„æ–¹æ³•ã€‚å°±æ˜¯åœ¨ä¸€å°æœºå™¨ä¸Šä½¿ç”¨ docker pull ä¸‹ docker  registry ä¸­çš„æ‰€æœ‰é•œåƒï¼Œç„¶åå† docker retag ä¸€ä¸‹ï¼Œå† docker push åˆ° harbor ä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡è®¾å…¶ä¸­çš„ä¸€ä¸ªé•œåƒä¸º library/alpine:latest</span></span><br><span class="line"></span><br><span class="line">docker pull registry.k8s.li/library/alpine:latest</span><br><span class="line"></span><br><span class="line">docker tag registry.k8s.li/library/alpine:latest harbor.k8s.li/library/alpine:latest</span><br><span class="line"></span><br><span class="line">docker push harbor.k8s.li/library/alpine:latest</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä¹‹å‰è¯»è¿‡æœ¨å­æ›¾ç»å†™è¿‡çš„ <a href="https://blog.k8s.li/Exploring-container-image.html">æ·±å…¥æµ…å‡ºå®¹å™¨é•œåƒçš„ä¸€ç”ŸğŸ¤”</a> å’Œ <a href="https://blog.k8s.li/skopeo.html">é•œåƒæ¬è¿å·¥ skopeo åˆä½“éªŒ</a> å¹¶ä¸”å·²ç»åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ä½¿ç”¨ skopeo ï¼Œä½ ä¸€å®šä¼šå¾ˆè§‰ç€è¿™ä¸ªæ–¹æ¡ˆå¾ˆè ¢ï¼Œå› ä¸º docker pull â€“&gt; docker tag â€“&gt; docker pull çš„è¿‡ç¨‹ä¸­ä¼šå¯¹é•œåƒçš„ layer è¿›è¡Œè§£å‹ç¼©ã€‚å¯¹äºåªæ˜¯å°†é•œåƒä»ä¸€ä¸ª registry å¤åˆ¶åˆ°å¦ä¸€ä¸ª registry æ¥è¯´ï¼Œè¿™äº› docker åœ¨è¿™äº›è¿‡ç¨‹ä¸­åšäº†å¾ˆå¤šæ— ç”¨åŠŸã€‚è¯¦ç»†çš„åŸç†å¯ä»¥ç¿»çœ‹ä¸€ä¸‹åˆšæåˆ°çš„ä¸¤ç¯‡æ–‡ç« ï¼Œåœ¨æ­¤å°±ä¸å†èµ˜è¿°ã€‚</p><p>é‚£ä¹ˆä¸ºäº†è¿½æ±‚é«˜æ•ˆï¼Œè‚¯å®šä¸ä¼šä½¿ç”¨ docker retag è¿™ä¹ˆè ¢çš„åŠæ³•å•¦ï¼Œä¸‹é¢å°±è®²ä¸€ä¸‹æ–¹æ¡ˆäºŒï¼š</p><h2 id="æ–¹æ¡ˆäºŒï¼šskopeo"><a href="#æ–¹æ¡ˆäºŒï¼šskopeo" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šskopeo"></a>æ–¹æ¡ˆäºŒï¼šskopeo</h2><p>åœ¨ <a href="https://blog.k8s.li/skopeo.html">é•œåƒæ¬è¿å·¥ skopeo åˆä½“éªŒ</a> ä¸­ä»‹ç»è¿‡å¯ä»¥ä½¿ç”¨ skopeo copy ç›´æ¥ä»ä¸€ä¸ª registry ä¸­å¤åˆ¶é•œåƒåŸå§‹ blobs åˆ°å¦ä¸€ä¸ª registry ä¸­ï¼Œåœ¨æ­¤æœŸé—´ä¸ä¼šæ¶‰åŠé•œåƒ layer è§£å‹ç¼©æ“ä½œã€‚è‡³äºæ€§èƒ½å’Œè€—æ—¶ï¼Œæ¯”ä½¿ç”¨ docker çš„æ–¹å¼é«˜åˆ°ä¸çŸ¥é“å“ªé‡Œå»äº†ğŸ˜‚ã€‚</p><ul><li>ä½¿ç”¨ skopeo copy</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">skopeo copy --insecure-policy --src-tls-verify=<span class="literal">false</span> --dest-tls-verify=<span class="literal">false</span> --src docker://registry.k8s.li/library/alpine:latest docker://harbor.k8s.li/library/alpine:latest</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ skopeo sync</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">skopeo sync --insecure-policy --src-tls-verify=<span class="literal">false</span> --dest-tls-verify=<span class="literal">false</span> --src docker --dest docker registry.k8s.li/library/alpine:latest harbor.k8s.li/library/alpine:latest</span><br></pre></td></tr></table></figure><p>ä½†è¿˜æœ‰æ²¡æœ‰æ›´å¥½çš„åŠæ³•ï¼Ÿè¦çŸ¥é“æ— è®ºæ˜¯ docker å’Œ skopeo æœ¬è´¨ä¸Šéƒ½æ˜¯é€šè¿‡ registry çš„ HTTP API ä¸‹è½½å’Œä¸Šä¼ é•œåƒçš„ï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­è¿˜æ˜¯å¤šäº†ä¸å°‘ HTTP è¯·æ±‚çš„ï¼Œå¦‚æœèµ°çš„æ˜¯ HTTPS çš„è¯ï¼Œè¿˜æ¶‰åŠäº† HTTPS åŠ å¯†å’Œè§£å¯†çš„è¿‡ç¨‹ï¼Œè¿™æœŸé—´ä¹Ÿæ˜¯åšäº†å¾ˆå¤š<del>æ— ç”¨åŠŸ</del>çš„ã€‚é‚£ä¹ˆè¿˜æœ‰æ²¡æœ‰æ›´å¥½çš„åŠæ³•ï¼Ÿ</p><h2 id="æ–¹æ¡ˆä¸‰ï¼šè¿ç§»å­˜å‚¨ç›®å½•"><a href="#æ–¹æ¡ˆä¸‰ï¼šè¿ç§»å­˜å‚¨ç›®å½•" class="headerlink" title="æ–¹æ¡ˆä¸‰ï¼šè¿ç§»å­˜å‚¨ç›®å½•"></a>æ–¹æ¡ˆä¸‰ï¼šè¿ç§»å­˜å‚¨ç›®å½•</h2><p>æ–‡ç« å¼€ç¯‡æåˆ° harbor çš„åç«¯é•œåƒå­˜å‚¨ä¹Ÿæ˜¯ä½¿ç”¨çš„  docker registryï¼Œå¯¹äºä¸€ä¸ª registry æ¥è¯´ï¼Œåªè¦æ˜¯ä½¿ç”¨çš„æ˜¯ Docker Distribution V2 ï¼Œå®ƒåç«¯çš„å­˜å‚¨ç›®å½•ç»“æ„éƒ½æ˜¯é•¿å¾—ä¸€æ‘¸ä¸€æ ·çš„ã€‚é‚£ä¸ºä½•ä¸ç›´æ¥å°† registry çš„å­˜å‚¨ç›®å½•æ‰“åŒ…å¤åˆ¶å¹¶è§£å‹åˆ° harbor çš„ registry å­˜å‚¨ç›®å½•å‘¢ï¼Ÿè¿™æ ·åˆèƒ½ä¿è¯æ‰€æœ‰çš„é•œåƒéƒ½è¿ç§»è¿‡å»ï¼Œä¸ä¼šè½ä¸‹ä»»ä½•ä¸€ä¸ªã€‚</p><p>å¯¹äº harbor 1.x ç‰ˆæœ¬æ¥è®²ï¼Œå°† docker registry çš„å­˜å‚¨ç›®å½•ç›´æ¥è¿ç§»åˆ° harbor çš„ registry å­˜å‚¨ç›®å½•ï¼Œç„¶ååˆ é™¤ harbor çš„ redis æ•°æ®ï¼ˆå› ä¸º harbor çš„ redis ç¼“å­˜äº†é•œåƒçš„å…ƒæ•°æ®ä¿¡æ¯ï¼‰ï¼Œé‡å¯ harbor å°±å®Œäº‹å„¿äº†ã€‚é‡å¯ harbor ä¹‹åï¼Œharbor ä¼šè°ƒç”¨åç«¯çš„ registry å»æå–é•œåƒçš„å…ƒæ•°æ®ä¿¡æ¯å¹¶å­˜å‚¨åˆ° redis ä¸­ã€‚è¿™æ ·å°±å®Œæˆäº†è¿ç§»çš„å·¥ä½œã€‚</p><p>åœ¨ docker registry æœºå™¨ä¸Šå¤‡ä»½ registry å­˜å‚¨ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢åˆ° docker registry çš„å­˜å‚¨ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span>  /var/lib/registry</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼Œè¿›è¡Œå¤‡ä»½æ—¶æ— éœ€è¿›è¡Œå‹ç¼©ï¼Œå› ä¸º registry ä¸­é•œåƒçš„ layer éƒ½æ˜¯å‹ç¼©è¿‡çš„</span></span><br><span class="line">tar -cpf docker.tar docker</span><br></pre></td></tr></table></figure><p>å¤‡ä»½å®Œæˆä¹‹åå°† docker.tar scp åˆ° harbor æœºå™¨ä¸Šï¼Œç„¶ååœ¨ harbor æœºå™¨ä¸Šæ¢å¤ registry å­˜å‚¨ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢åˆ° harbor çš„å­˜å‚¨ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /data/harbor</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å¤‡ä»½çš„ docker ç›®å½•è§£å‹åˆ° harbor çš„ registry ç›®å½•ä¸‹ï¼Œç›®å½•å±‚çº§ä¸€å®šè¦å¯¹åº”å¥½</span></span><br><span class="line">tar -xpf docker.tar -C ./registry</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ harbor çš„ regis æ•°æ®ï¼Œé‡å¯ harbor åä¼šé‡å»º redis æ•°æ®ã€‚</span></span><br><span class="line">rm -f redis/dump.rdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ° harbor çš„å®‰è£…ç›®å½•é‡å¯ harbor</span></span><br><span class="line"><span class="built_in">cd</span> /opt/harbor</span><br><span class="line">docker-compose restart</span><br></pre></td></tr></table></figure><p>è¿™æ ·è¿ç§»ä¹‹åå¯èƒ½ä¼šé‡åˆ°æ— æ³•å¾€ harbor push é•œåƒçš„é—®é¢˜ã€‚å› ä¸º docker registry å®¹å™¨å†… registry å­˜å‚¨ç›®å½•çš„æ‰€å±å’Œæ‰€å±ç»„ä¸º root ï¼Œè€Œ harbor registry å®¹å™¨å†… registry å­˜å‚¨ç›®å½•çš„æ‰€å±å’Œæ‰€å±ç»„ä¸º 10000:10000 ,äºŒè€…æƒé™å¹¶ä¸ç›¸åŒï¼Œä¼šå¯¼è‡´ harbor æ— æ³• push é•œåƒã€‚å› æ­¤åœ¨è¿ç§»å®Œæˆä¹‹åéœ€è¦ä¿®æ”¹ä¸€ä¸‹ harbor registry ç›®å½•çš„æ‰€å±å’Œæ‰€å±ç»„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢åˆ° harbor çš„å­˜å‚¨ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /data/harbor</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ registry å­˜å‚¨ç›®å½•çš„æ‰€å±å’Œæ‰€å±ç»„ä¸º 10000</span></span><br><span class="line">chown -R 10000:10000 ./registry</span><br></pre></td></tr></table></figure><h2 id="æ–¹æ¡ˆå››ï¼š"><a href="#æ–¹æ¡ˆå››ï¼š" class="headerlink" title="æ–¹æ¡ˆå››ï¼š"></a>æ–¹æ¡ˆå››ï¼š</h2><p>å¯¹äº harbor 2.x æ¥è®²ï¼Œç”±äº harbor å¼ºåŒ–äº† Artifact çš„å…ƒæ•°æ®ç®¡ç†èƒ½åŠ›ï¼Œå³å…ƒæ•°æ®è¦åœ¨ push æˆ–è€… sync åˆ° harbor æ—¶å†™å…¥åˆ° harbor è‡ªèº«çš„æ•°æ®åº“ä¸­ã€‚åœ¨ harbor çœ‹æ¥åªè¦æ•°æ®åº“ä¸­æ²¡æœ‰è¿™ä¸ª Artifact çš„ manifest ä¿¡æ¯æˆ–è€…æ²¡æœ‰è¿™ä¸€å±‚ layer çš„ä¿¡æ¯ï¼Œharbor éƒ½ä¼šè®¤ä¸ºè¯¥ Artifact æˆ–è€… layer ä¸å­˜åœ¨ï¼Œè¿”å› 404 çš„é”™è¯¯ã€‚æŒ‰ç…§æ–¹æ¡ˆä¸‰ç›´æ¥è€Œå°† docker registry å­˜å‚¨ç›®å½•è§£å‹åˆ° harbor çš„ registry å­˜å‚¨ç›®å½•çš„æ–¹æ³•è¡Œä¸é€šçš„ã€‚å› ä¸ºæ˜¯å°†é•œåƒè§£å‹åˆ° registry å­˜å‚¨ä¸­çš„ï¼Œè™½ç„¶åœ¨ harbor çš„ registry å®¹å™¨çœ‹æ¥æ˜¯æœ‰é•œåƒçš„ï¼Œä½†å› ä¸º harbor çš„æ•°æ®åº“ä¸­æ²¡æœ‰é•œåƒï¼Œharbor å°±ä¼šè®¤ä¸ºæ²¡æœ‰é•œåƒã€‚é‚£ä¹ˆç°åœ¨çœ‹æ¥åªèƒ½é€šè¿‡æ–¹æ¡ˆäºŒä½¿ç”¨ skopeo å°†é•œåƒä¸€ä¸ªä¸€ä¸ªåœ° push åˆ° harbor ä¸­äº†ã€‚</p><p>ä½†å¯¹äºæŸäº›ç‰¹å®šçš„åœºæ™¯ä¸‹ï¼Œä¸èƒ½åƒæ–¹æ¡ˆäºŒé‚£æ ·æ‹¥æœ‰ä¸€ä¸ª docker registry çš„ HTTP æœåŠ¡ï¼Œåªæœ‰ä¸€ä¸ª docker registry çš„å‹ç¼©åŒ…ï¼Œè¿™å¦‚ä½•å°† docker registry çš„å­˜å‚¨ç›®å½•ä¸­çš„é•œåƒè¿ç§»åˆ° harbor 2.0 ä¸­å‘¢ï¼Ÿ</p><p>åœ¨ <a href="https://blog.k8s.li/skopeo.html">é•œåƒæ¬è¿å·¥ skopeo åˆä½“éªŒ</a> ä¸­æåˆ°è¿‡ skopeo æ”¯æŒçš„<code>é•œåƒæ ¼å¼</code>æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><table><thead><tr><th align="left">IMAGE NAMES</th><th align="left">example</th></tr></thead><tbody><tr><td align="left"><strong>containers-storage:</strong></td><td align="left">containers-storage:</td></tr><tr><td align="left"><strong>dir:</strong></td><td align="left">dir:/PATH</td></tr><tr><td align="left"><strong>docker://</strong></td><td align="left">docker://k8s.gcr.io/kube-apiserver:v1.17.5</td></tr><tr><td align="left"><strong>docker-daemon:</strong></td><td align="left">docker-daemon:alpine:latest</td></tr><tr><td align="left"><strong>docker-archive:</strong></td><td align="left">docker-archive:alpine.tar (docker save)</td></tr><tr><td align="left"><strong>oci:</strong></td><td align="left">oci:alpine:latest</td></tr></tbody></table><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™å‡ ç§é•œåƒçš„åå­—ï¼Œå¯¹åº”ç€é•œåƒå­˜åœ¨çš„æ–¹å¼ï¼Œä¸åŒå­˜åœ¨çš„æ–¹å¼å¯¹é•œåƒçš„ layer å¤„ç†çš„æ–¹å¼ä¹Ÿä¸ä¸€æ ·ï¼Œæ¯”å¦‚ <code>docker://</code> è¿™ç§æ–¹å¼æ˜¯å­˜åœ¨ registry ä¸Šçš„ï¼›<code>docker-daemon:</code> æ˜¯å­˜åœ¨æœ¬åœ° docker pull ä¸‹æ¥çš„ï¼›å†æ¯”å¦‚ <code>docker-archive</code> æ˜¯é€šè¿‡ docker save å‡ºæ¥çš„é•œåƒï¼›è€Œ <code>dir:</code> æ˜¯é•œåƒä»¥æ–‡ä»¶å¤¹çš„å½¢å¼ä¿å­˜çš„ã€‚åŒä¸€ä¸ªé•œåƒæœ‰è¿™å‡ ç§å­˜åœ¨çš„æ–¹å¼å°±åƒæ°´æœ‰æ°”ä½“ã€æ¶²ä½“ã€å›ºä½“ä¸€æ ·ã€‚å¯ä»¥è¿™æ ·å»ç†è§£ï¼Œä»–ä»¬è¡¨è¿°çš„éƒ½æ˜¯åŒä¸€ä¸ªé•œåƒï¼Œåªä¸è¿‡æ˜¯å­˜åœ¨çš„æ–¹å¼ä¸ä¸€æ ·è€Œå·²ã€‚</p><p>æ—¢ç„¶é•œåƒæ˜¯å­˜æ”¾åœ¨ registry å­˜å‚¨ç›®å½•é‡Œçš„ï¼Œé‚£ä¹ˆä½¿ç”¨ dir çš„å½¢å¼ç›´æ¥ä»æ–‡ä»¶ç³»ç»Ÿè¯»å–é•œåƒï¼Œç†è®ºä¸Šæ¥è®²ä¼šæ¯”æ–¹æ¡ˆäºŒè¦å¥½ä¸€äº›ã€‚è™½ç„¶ skopeo æ”¯æŒ dir æ ¼å¼çš„é•œåƒï¼Œä½† skopeo ç›®å‰å¹¶ä¸æ”¯æŒç›´æ¥ä½¿ç”¨ registry çš„å­˜å‚¨ç›®å½•ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦æƒ³åŠæ³•å°† docker registry å­˜å‚¨ç›®å½•é‡Œçš„æ¯ä¸€ä¸ªé•œåƒè½¬æ¢æˆ skopeo dir çš„å½¢å¼ã€‚</p><h3 id="skopeo-dir"><a href="#skopeo-dir" class="headerlink" title="skopeo dir"></a>skopeo dir</h3><p>é‚£ä¹ˆå…ˆæ¥çœ‹ä¸€ä¸‹ skopeo dir æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ</p><p>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•æ–¹æ¡ˆçš„å¯è¡Œæ€§ï¼Œå…ˆä½¿ç”¨ skopeo å‘½ä»¤å…ˆä» docker hub ä¸Šæ‹‰å–ä¸€ä¸ªé•œåƒï¼Œå¹¶ä¿å­˜ä¸º dirï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">skopeo copy docker://alpine:latest dir:./alpine</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ tree å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹ alpine æ–‡ä»¶å¤¹çš„ç›®å½•ç»“æ„ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry</span><br><span class="line">â•°â”€# tree -h alpine</span><br><span class="line">alpine</span><br><span class="line">â”œâ”€â”€ [2.7M]  4c0d98bf9879488e0407f897d9dd4bf758555a78e39675e72b5124ccf12c2580</span><br><span class="line">â”œâ”€â”€ [1.4K]  e50c909a8df2b7c8b92a6e8730e210ebe98e5082871e66edd8ef4d90838cbd25</span><br><span class="line">â”œâ”€â”€ [ 528]  manifest.json</span><br><span class="line">â””â”€â”€ [  33]  version</span><br><span class="line"></span><br><span class="line">0 directories, 4 files</span><br><span class="line">â•­â”€root@sg-02 /var/lib/registry</span><br><span class="line">â•°â”€# file alpine/e50c909a8df2b7c8b92a6e8730e210ebe98e5082871e66edd8ef4d90838cbd25</span><br><span class="line">alpine/e50c909a8df2b7c8b92a6e8730e210ebe98e5082871e66edd8ef4d90838cbd25: ASCII text, with very long lines, with no line terminators</span><br><span class="line"></span><br><span class="line">â•­â”€root@sg-02 /var/lib/registry</span><br><span class="line">â•°â”€# file alpine/4c0d98bf9879488e0407f897d9dd4bf758555a78e39675e72b5124ccf12c2580</span><br><span class="line">alpine/4c0d98bf9879488e0407f897d9dd4bf758555a78e39675e72b5124ccf12c2580: gzip compressed data</span><br></pre></td></tr></table></figure><p>ä»æ–‡ä»¶åå’Œå¤§å°ä»¥åŠæ–‡ä»¶çš„å†…çœæˆ‘ä»¬å¯ä»¥åˆ¤æ–­å‡ºï¼Œmanifest æ–‡ä»¶å¯¹åº”çš„å°±æ˜¯é•œåƒçš„ manifests æ–‡ä»¶ï¼›ç±»å‹ä¸º <code>ASCII text</code> çš„æ–‡ä»¶æ­£æ˜¯é•œåƒçš„ image config æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«ç€é•œåƒçš„å…ƒæ•°æ®ä¿¡æ¯ã€‚è€Œå¦ä¸€ä¸ª <code>gzip compressed data</code> æ–‡ä»¶ä¸å°±æ˜¯ç»è¿‡ gzip å‹ç¼©è¿‡çš„é•œåƒ layer å˜›ã€‚çœ‹ä¸€ä¸‹ manifest æ–‡ä»¶çš„å†…å®¹ä¹Ÿå†æ¬¡å°è¯äº†è¿™ä¸ªç»“è®ºï¼š</p><ul><li>é•œåƒçš„ config å­—æ®µå¯¹åº”çš„æ­£æ˜¯ e50c909a8df2ï¼Œè€Œæ–‡ä»¶ç±»å‹æ­£æ˜¯ <code>image.v1+json</code> æ–‡æœ¬æ–‡ä»¶ã€‚</li><li>é•œåƒçš„ layer å­—æ®µå¯¹åº”çš„ä¹Ÿæ­£æ˜¯  4c0d98bf9879 è€Œæ–‡ä»¶ç±»å‹æ­£æ˜¯  <code>.tar.gzip</code> gzip å‹ç¼©æ–‡ä»¶ã€‚</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">alpine/4c0d98bf9879488e0407f897d9dd4bf758555a78e39675e72b5124ccf12c2580: gzip compressed data</span><br><span class="line">â•­â”€root@sg-02 /var/lib/registry</span><br><span class="line">â•°â”€# cat alpine/manifest.json</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">   <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.container.image.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">1471</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:e50c909a8df2b7c8b92a6e8730e210ebe98e5082871e66edd8ef4d90838cbd25"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">2811321</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:4c0d98bf9879488e0407f897d9dd4bf758555a78e39675e72b5124ccf12c2580"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä»-registry-å­˜å‚¨ç›®å½•ä¸­æé•œåƒå‡ºæ¥"><a href="#ä»-registry-å­˜å‚¨ç›®å½•ä¸­æé•œåƒå‡ºæ¥" class="headerlink" title="ä» registry å­˜å‚¨ç›®å½•ä¸­æé•œåƒå‡ºæ¥"></a>ä» registry å­˜å‚¨ç›®å½•ä¸­æé•œåƒå‡ºæ¥</h3><p>æ¥ä¸‹æ¥åˆ°æœ¬æ–‡çš„è¾ƒä¸ºç²¾å½©çš„åœ°æ–¹äº†ã€‚å¦‚ä½•ä» registry å­˜å‚¨é‡Œçš„ <code>æ</code> é•œåƒå‡ºæ¥ï¼Œè½¬æ¢æˆ skopeo æ‰€æ”¯æŒçš„ dir æ ¼å¼ã€‚</p><p><img src="https://p.k8s.li/registry-storage.jpeg" alt=""></p><ul><li>é¦–å…ˆè¦å¾—åˆ°é•œåƒçš„ manifests æ–‡ä»¶ï¼Œä» manifests æ–‡ä»¶ä¸­å¯ä»¥å¾—åˆ°è¯¥é•œåƒçš„æ‰€æœ‰ blob æ–‡ä»¶ã€‚ä¾‹å¦‚å¯¹äº registry å­˜å‚¨ç›®å½•ä¸­çš„ <code>library/alpine:latest</code> é•œåƒæ¥è®²ï¼Œå®ƒåœ¨ registry ä¸­æ˜¯è¿™æ ·å­˜æ”¾çš„ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ blobs</span><br><span class="line">â”‚   â””â”€â”€ sha256</span><br><span class="line">â”‚       â”œâ”€â”€ 21</span><br><span class="line">â”‚       â”‚   â””â”€â”€ 21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">â”‚       â”‚       â””â”€â”€ data</span><br><span class="line">â”‚       â”œâ”€â”€ a1</span><br><span class="line">â”‚       â”‚   â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">â”‚       â”‚       â””â”€â”€ data</span><br><span class="line">â”‚       â””â”€â”€ be</span><br><span class="line">â”‚           â””â”€â”€ be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">â”‚               â””â”€â”€ data</span><br><span class="line">â””â”€â”€ repositories</span><br><span class="line">    â””â”€â”€ library</span><br><span class="line">        â””â”€â”€ alpine</span><br><span class="line">            â”œâ”€â”€ _layers</span><br><span class="line">            â”‚   â””â”€â”€ sha256</span><br><span class="line">            â”‚       â”œâ”€â”€ 21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">            â”‚       â”‚   â””â”€â”€ link</span><br><span class="line">            â”‚       â””â”€â”€ be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">            â”‚           â””â”€â”€ link</span><br><span class="line">            â”œâ”€â”€ _manifests</span><br><span class="line">            â”‚   â”œâ”€â”€ revisions</span><br><span class="line">            â”‚   â”‚   â””â”€â”€ sha256</span><br><span class="line">            â”‚   â”‚       â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">            â”‚   â”‚           â””â”€â”€ link</span><br><span class="line">            â”‚   â””â”€â”€ tags</span><br><span class="line">            â”‚       â””â”€â”€ latest</span><br><span class="line">            â”‚           â”œâ”€â”€ current</span><br><span class="line">            â”‚           â”‚   â””â”€â”€ link</span><br><span class="line">            â”‚           â””â”€â”€ index</span><br><span class="line">            â”‚               â””â”€â”€ sha256</span><br><span class="line">            â”‚                   â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">            â”‚                       â””â”€â”€ link</span><br><span class="line">            â””â”€â”€ _uploads</span><br><span class="line"></span><br><span class="line">26 directories, 8 files</span><br></pre></td></tr></table></figure><ol><li>é€šè¿‡ <code>repositories/library/alpine/_manifests/tags/latest/current/link</code> æ–‡ä»¶å¾—åˆ° alpine é•œåƒ lasts è¿™ä¸ª tag çš„ manifests æ–‡ä»¶çš„ sha256 å€¼ï¼Œç„¶åæ ¹æ®è¿™ä¸ª sha256 å€¼å» blobs æ‰¾åˆ°é•œåƒçš„ manifests æ–‡ä»¶;</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/repositories/library/alpine/_manifests/tags/latest/current/</span><br><span class="line">â•°â”€# cat link</span><br><span class="line">sha256:39eda93d15866957feaee28f8fc5adb545276a64147445c64992ef69804dbf01#</span><br></pre></td></tr></table></figure><ol start="2"><li>æ ¹æ® <code>current/link</code> æ–‡ä»¶ä¸­çš„ sha256 å€¼åœ¨ blobs ç›®å½•ä¸‹æ‰¾åˆ°ä¸ä¹‹å¯¹åº”çš„æ–‡ä»¶ï¼Œblobs ç›®å½•ä¸‹å¯¹åº”çš„ manifests æ–‡ä»¶ä¸º blobs/sha256/39/39eda93d15866957feaee28f8fc5adb545276a64147445c64992ef69804dbf01/data;</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/repositories/library/alpine/_manifests/tags/latest/current</span><br><span class="line">â•°â”€# cat /var/lib/registry/docker/registry/v2/blobs/sha256/39/39eda93d15866957feaee28f8fc5adb545276a64147445c64992ef69804dbf01/data</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">   <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.container.image.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">1507</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">2813316</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨æ­£åˆ™åŒ¹é…ï¼Œè¿‡æ»¤å‡º manifests æ–‡ä»¶ä¸­çš„æ‰€æœ‰ sha256 å€¼ï¼Œè¿™äº› sha256 å€¼å°±å¯¹åº”ç€ blobs ç›®å½•ä¸‹çš„ image config æ–‡ä»¶å’Œ image layer æ–‡ä»¶;</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/repositories/library/alpine/_manifests/tags/latest/current</span><br><span class="line">â•°â”€<span class="comment"># grep -Eo "\b[a-f0-9]&#123;64&#125;\b" /var/lib/registry/docker/registry/v2/blobs/sha256/39/39eda93d15866957feaee28f8fc5adb545276a64147445c64992ef69804dbf01/data</span></span><br><span class="line">f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span><br><span class="line">cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08</span><br></pre></td></tr></table></figure><ol start="4"><li>æ ¹æ® manifests æ–‡ä»¶å°±å¯ä»¥å¾—åˆ° blobs ç›®å½•ä¸­é•œåƒçš„æ‰€æœ‰ layer å’Œ image config æ–‡ä»¶ï¼Œç„¶åå°†è¿™äº›æ–‡ä»¶æ‹¼æˆä¸€ä¸ª dir æ ¼å¼çš„é•œåƒï¼Œåœ¨è¿™é‡Œä½¿ç”¨ cp çš„æ–¹å¼å°†é•œåƒä» registry å­˜å‚¨ç›®å½•é‡Œå¤åˆ¶å‡ºæ¥ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä¸ºäº†ä¿ç•™é•œåƒçš„ name å’Œ tagï¼Œæ–‡ä»¶å¤¹çš„åç§°å°±å¯¹åº”çš„æ˜¯ NAME:TAG</span></span><br><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker</span><br><span class="line">â•°â”€# mkdir -p skopeo/library/alpine:latest</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¤åˆ¶é•œåƒçš„ manifest æ–‡ä»¶</span></span><br><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker</span><br><span class="line">â•°â”€# cp /var/lib/registry/docker/registry/v2/blobs/sha256/39/39eda93d15866957feaee28f8fc5adb545276a64147445c64992ef69804dbf01/data skopeo/library/alpine:latest/manifest</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¤åˆ¶é•œåƒçš„ blob æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cp /var/lib/registry/docker/registry/v2/blobs/sha256/f7/f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a/data skopeo/library/alpine:latest/f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cp /var/lib/registry/docker/registry/v2/blobs/sha256/cb/cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08/data skopeo/library/alpine:latest/cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08</span></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå¾—åˆ°çš„é•œåƒæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker</span><br><span class="line">â•°â”€<span class="comment"># tree skopeo/library/alpine:latest</span></span><br><span class="line">skopeo/library/alpine:latest</span><br><span class="line">â”œâ”€â”€ cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08</span><br><span class="line">â”œâ”€â”€ f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span><br><span class="line">â””â”€â”€ manifest</span><br><span class="line"></span><br><span class="line">0 directories, 3 files</span><br></pre></td></tr></table></figure><p>å’Œä¸Šé¢çš„ skopeo copy å‡ºæ¥çš„ dir æ–‡ä»¶å¤¹å¯¹æ¯”ä¸€ä¸‹ï¼Œé™¤äº†ä¸€ä¸ªæ— å…³ç´§è¦çš„ version æ–‡ä»¶ï¼Œå…¶ä»–çš„éƒ½ä¸€æ‘¸ä¸€æ ·ã€‚</p><ol start="5"><li>å†ä¼˜åŒ–ä¸€ä¸‹ï¼Œå°†æ­¥éª¤ 4 ä¸­çš„ cp æ“ä½œä¿®æ”¹æˆç¡¬é“¾æ¥æ“ä½œï¼Œèƒ½æå¤§å‡å°‘ç£ç›˜çš„ IO æ“ä½œã€‚éœ€è¦æ³¨æ„ï¼šç¡¬é“¾æ¥æ–‡ä»¶ä¸èƒ½è·¨åˆ†åŒºï¼Œæ‰€ä»¥è¦å’Œ registry å­˜å‚¨ç›®å½•åœ¨åŒä¸€ä¸ªåˆ†åŒºä¸‹æ‰è¡Œã€‚</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker</span><br><span class="line">â•°â”€# ln /var/lib/registry/docker/registry/v2/blobs/sha256/39/39eda93d15866957feaee28f8fc5adb545276a64147445c64992ef69804dbf01/data skopeo/library/alpine:latest/manifest</span><br><span class="line"><span class="meta">#</span><span class="bash"> ln /var/lib/registry/docker/registry/v2/blobs/sha256/f7/f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a/data skopeo/library/alpine:latest/f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ln /var/lib/registry/docker/registry/v2/blobs/sha256/cb/cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08/data skopeo/library/alpine:latest/cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08</span></span><br><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker</span><br><span class="line">â•°â”€# tree skopeo/library/alpine:latest</span><br><span class="line">skopeo/library/alpine:latest</span><br><span class="line">â”œâ”€â”€ cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08</span><br><span class="line">â”œâ”€â”€ f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span><br><span class="line">â””â”€â”€ manifest</span><br><span class="line"></span><br><span class="line">0 directories, 3 files</span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨ skopeo copy æˆ–è€… skopeo sync å°†æå‡ºæ¥çš„é•œåƒ push åˆ° harbor</p><ul><li>ä½¿ç”¨ skopeo copy</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">skopeo copy  --insecure-policy --src-tls-verify=false --dest-tls-verify=false \</span><br><span class="line">dir:skopeo/library/alpine:latest docker://harbor.k8s.li/library/alpine:latest</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ skopeo sync</li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œskopeo sync çš„æ–¹å¼æ˜¯åŒæ­¥ project çº§åˆ«çš„ï¼Œé•œåƒçš„ name å’Œ tag å°±å¯¹åº”çš„æ˜¯ç›®å½•çš„åç§°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">skopeo sync --insecure-policy --src-tls-verify=false --dest-tls-verify=false \</span><br><span class="line">--src dir --dest docker skopeo/library/ harbor.k8s.li/library/</span><br></pre></td></tr></table></figure><h3 id="å®ç°è„šæœ¬"><a href="#å®ç°è„šæœ¬" class="headerlink" title="å®ç°è„šæœ¬"></a>å®ç°è„šæœ¬</h3><p>å¤§å«ä¸€å£° shell å¤§æ³•å¥½ï¼ğŸ˜‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">REGISTRY_DOMAIN="harbor.k8s.li"</span><br><span class="line">REGISTRY_PATH="/var/lib/registry"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ‡æ¢åˆ° registry å­˜å‚¨ä¸»ç›®å½•ä¸‹</span></span><br><span class="line">cd $&#123;REGISTRY_PATH&#125;</span><br><span class="line"></span><br><span class="line">gen_skopeo_dir() &#123;</span><br><span class="line"><span class="meta">   #</span><span class="bash"> å®šä¹‰ registry å­˜å‚¨çš„ blob ç›®å½• å’Œ repositories ç›®å½•ï¼Œæ–¹ä¾¿åé¢ä½¿ç”¨</span></span><br><span class="line">    BLOB_DIR="docker/registry/v2/blobs/sha256"</span><br><span class="line">    REPO_DIR="docker/registry/v2/repositories"</span><br><span class="line">    # å®šä¹‰ç”Ÿæˆ skopeo ç›®å½•</span><br><span class="line">    SKOPEO_DIR="docker/skopeo"</span><br><span class="line">    # é€šè¿‡ find å‡º current æ–‡ä»¶å¤¹å¯ä»¥å¾—åˆ°æ‰€æœ‰å¸¦ tag çš„é•œåƒï¼Œå› ä¸ºä¸€ä¸ª tag å¯¹åº”ä¸€ä¸ª current ç›®å½•</span><br><span class="line">    for image in $(find $&#123;REPO_DIR&#125; -type d -name "current"); do</span><br><span class="line">        # æ ¹æ®é•œåƒçš„ tag æå–é•œåƒçš„åå­—</span><br><span class="line">        name=$(echo $&#123;image&#125; | awk -F '/' '&#123;print $5"/"$6":"$9&#125;')</span><br><span class="line">        link=$(cat $&#123;image&#125;/link | sed 's/sha256://')</span><br><span class="line">        mfs="$&#123;BLOB_DIR&#125;/$&#123;link:0:2&#125;/$&#123;link&#125;/data"</span><br><span class="line">        # åˆ›å»ºé•œåƒçš„ç¡¬é“¾æ¥éœ€è¦çš„ç›®å½•</span><br><span class="line">        mkdir -p "$&#123;SKOPEO_DIR&#125;/$&#123;name&#125;"</span><br><span class="line">        # ç¡¬é“¾æ¥é•œåƒçš„ manifests æ–‡ä»¶åˆ°ç›®å½•çš„ manifest æ–‡ä»¶</span><br><span class="line">        ln $&#123;mfs&#125; $&#123;SKOPEO_DIR&#125;/$&#123;name&#125;/manifest.json</span><br><span class="line">        # ä½¿ç”¨æ­£åˆ™åŒ¹é…å‡ºæ‰€æœ‰çš„ sha256 å€¼ï¼Œç„¶åæ’åºå»é‡</span><br><span class="line">        layers=$(grep -Eo "\b[a-f0-9]&#123;64&#125;\b" $&#123;mfs&#125; | sort -n | uniq)</span><br><span class="line">        for layer in $&#123;layers&#125;; do</span><br><span class="line">          # ç¡¬é“¾æ¥ registry å­˜å‚¨ç›®å½•é‡Œçš„é•œåƒ layer å’Œ images config åˆ°é•œåƒçš„ dir ç›®å½•</span><br><span class="line">            ln $&#123;BLOB_DIR&#125;/$&#123;layer:0:2&#125;/$&#123;layer&#125;/data $&#123;SKOPEO_DIR&#125;/$&#123;name&#125;/$&#123;layer&#125;</span><br><span class="line">        done</span><br><span class="line">    done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sync_image() &#123;</span><br><span class="line">    # ä½¿ç”¨ skopeo sync å°† dir æ ¼å¼çš„é•œåƒåŒæ­¥åˆ° harbor</span><br><span class="line">    for project in $(ls $&#123;SKOPEO_DIR&#125;); do</span><br><span class="line">        skopeo sync --insecure-policy --src-tls-verify=false --dest-tls-verify=false \</span><br><span class="line">        --src dir --dest docker $&#123;SKOPEO_DIR&#125;/$&#123;project&#125; $&#123;REGISTRY_DOMAIN&#125;/$&#123;project&#125;</span><br><span class="line">    done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gen_skopeo_dir</span><br><span class="line">sync_image</span><br></pre></td></tr></table></figure><p>å…¶å®é­”æ”¹ä¸€ä¸‹ skopeo çš„æºç ä¹Ÿæ˜¯å¯ä»¥æ— ç¼æ”¯æŒ registry å­˜å‚¨ç›®å½•çš„ï¼Œç›®å‰æ­£åœ¨ç ”ç©¶ä¸­ğŸ˜ƒ</p><h2 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h2><table><thead><tr><th></th><th>æ–¹æ³•</th><th>é€‚ç”¨èŒƒå›´</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>ä¸€</td><td>docker retag</td><td>ä¸¤ä¸ª registry ä¹‹é—´åŒæ­¥é•œåƒ</td><td></td></tr><tr><td>äºŒ</td><td>skopeo</td><td>ä¸¤ä¸ª registry ä¹‹é—´åŒæ­¥é•œåƒ</td><td></td></tr><tr><td>ä¸‰</td><td>è§£å‹ç›®å½•</td><td>registry å­˜å‚¨ç›®å½•åˆ°å¦ä¸€ä¸ª registry</td><td>harbor 1.x</td></tr><tr><td>å››</td><td>skopeo dir</td><td>registry å­˜å‚¨ç›®å½•åˆ°å¦ä¸€ä¸ª registry</td><td>é€‚ç”¨äº harbor 2.x</td></tr></tbody></table><p>å¯¹æ¯”æ€»ç»“ä¸€ä¸‹ä»¥ä¸Šå‡ ç§æ–¹æ¡ˆï¼š</p><ul><li>æ–¹æ¡ˆä¸€ï¼šä¸Šæ‰‹æˆæœ¬ä½ï¼Œé€‚ç”¨äºé•œåƒæ•°é‡æ¯”è¾ƒå¤šå°‘ï¼Œæ— éœ€å®‰è£… skopeo çš„æƒ…å†µï¼Œç¼ºç‚¹æ˜¯æ€§èƒ½è¾ƒå·®ï¼›</li><li>æ–¹æ¡ˆäºŒï¼šé€‚ç”¨äºä¸¤ä¸ª registry ä¹‹é—´åŒæ­¥å¤åˆ¶é•œåƒï¼Œå¦‚å°† docker hub ä¸­çš„ä¸€äº›å…¬å…±é•œåƒå¤åˆ¶åˆ°å…¬å¸å†…ç½‘çš„é•œåƒä»“åº“ä¸­ã€‚</li><li>æ–¹æ¡ˆä¸‰ï¼šé€‚ç”¨äºé•œåƒä»“åº“ä¹‹é—´è¿›è¡Œè¿ç§»ï¼Œæ€§èƒ½æ˜¯æ‰€æœ‰æ–¹æ¡ˆé‡Œæœ€å¥½çš„ï¼Œéœ€è¦é¢å¤–æ³¨æ„çš„æ˜¯å¦‚æœç›®çš„é•œåƒä»“åº“æ˜¯ harbor 2.xï¼Œæ˜¯æ— æ³•ä½¿ç”¨è¿™ç§æ–¹å¼çš„ã€‚</li><li>æ–¹æ¡ˆå››ï¼šæ˜¯æ–¹æ¡ˆä¸‰çš„å¦¥åç‰ˆï¼Œä¸ºäº†é€‚é… harbor 2.0 ï¼Œå› ä¸ºéœ€è¦é‡æ–°å°†é•œåƒ push åˆ° harbor ï¼Œæ‰€ä»¥æ€§èƒ½ä¸Šè¦æ¯”æ–¹æ¡ˆä¸‰å·®ä¸€äº›ã€‚</li></ul><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="">ã€Šharboræƒå¨æŒ‡å—</a></li><li><a href="https://goharbor.io/blog/harbor-2.0/" target="_blank" rel="noopener">Harbor 2.0 takes a giant leap in expanding supported artifacts with OCI support</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;Registry&quot;&gt;&lt;a
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="registry" scheme="https://blog.k8s.li/tags/registry/"/>
    
      <category term="harbor" scheme="https://blog.k8s.li/tags/harbor/"/>
    
      <category term="é•œåƒ" scheme="https://blog.k8s.li/tags/%E9%95%9C%E5%83%8F/"/>
    
  </entry>
  
  <entry>
    <title>2020 å¹´è¯»ä¹¦ç¬”è®°å’Œæ€è€ƒ</title>
    <link href="https://blog.k8s.li/2020-booklist.html"/>
    <id>https://blog.k8s.li/2020-booklist.html</id>
    <published>2020-12-30T16:00:00.000Z</published>
    <updated>2021-01-09T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>é¦–å…ˆç»™å„ä½å…³æ³¨æˆ‘åšå®¢çš„å°ä¼™ä¼´è¯´å£°æŠ±æ­‰ï¼Œå·²ç»å¾ˆé•¿æ—¶é—´ï¼ˆå°†è¿‘ 4 ä¸ªæœˆï¼‰æ²¡æœ‰æ›´æ–°åšå®¢äº†ï¼Œå®åœ¨æ˜¯å¯¹ä¸ä½å¤§å®¶ï¼Œè‡ªå·±ä¸€ç›´åœ¨å·æ‡’æ²¡èƒ½åšæŒåˆ›ä½œã€‚2021 å¹´åˆšå¼€å§‹ï¼Œå†³å®šå†³å®šä»¥åè¿˜æ˜¯è¦åšæŒåˆ›ä½œä¸‹å»ï¼Œäºæ˜¯æœ€è¿‘æŠ½å‡ºç‚¹æ—¶é—´æ•´ç†äº†ä¸‹ 2020 å¹´è¯»è¿‡çš„ä¹¦åˆ†äº«ç»™å¤§å®¶ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°å¤§å®¶æ‰¾åˆ°äº›æœ‰æ„æ€çš„ä¹¦æ¥è¯»ã€‚å†…å®¹æœ‰ç‚¹å¤šï¼Œå¤§æ¦‚ 2 ä¸‡å¤šå­—ğŸ™ƒã€‚</p><h2 id="ä¹¦å•"><a href="#ä¹¦å•" class="headerlink" title="ä¹¦å•"></a>ä¹¦å•</h2><p>ç”±äºç–«æƒ…çš„å½±å“ï¼ŒèŠ‚å‡æ—¥å’Œå‘¨æœ«éƒ½ä¸æ€ä¹ˆå‡ºå»ï¼Œä¸€ç›´å®…åœ¨å®¶é‡Œï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†çš„é—²æš‡æ—¶é—´éƒ½æ˜¯æ§ç€ kindle çœ‹ä¼šä¹¦ï¼Œäº¦æˆ–è€…åˆ·ä¸€ä¼š Pixiv å’Œ Twitter æ”¶é›†ä¸€äº›çº¸ç‰‡äººæ’ç”»ï¼Œä¿¨ç„¶æˆäº†ä¸€ä¸ªæ ‡å‡†çš„æ­»è‚¥å®…ã€‚2020 å¹´ä¸€æ•´å¹´ç•™ç»™è‡ªå·±çš„æ—¶é—´æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥æ€»ä½“ä¸Šæ¥è®² 2020 å¹´è¯»è¿‡çš„ä¹¦æ¯” 2019 å¹´å¤šäº†å°†è¿‘ä¸€å€ï¼Œæœ‰å…´è¶£çš„å¯ä»¥ç¿»å¼€ä¸€ä¸‹ 2019 å¹´çš„è¯»ä¹¦æ€»ç»“ <a href="https://blog.k8s.li/2019-reading-notes.html">2019 å¹´è¯»ä¹¦ç¬”è®°å’Œæ€è€ƒ</a> ã€‚ä¸‹é¢çš„è¡¨æ ¼æ˜¯æˆ‘å‚è€ƒ kindle ä¸Šçš„æ ‡æ³¨æ—¶é—´æ•´ç†çš„ 2020 å¹´è¯»å®Œçš„ä¹¦ï¼ˆå…±è®¡ 68 æœ¬ä¹¦ï¼‰ã€‚</p><table><thead><tr><th align="center">ä¹¦å</th><th align="center">ä½œè€…</th><th align="center">start</th><th align="center">end</th><th align="center">æ—¶é•¿</th></tr></thead><tbody><tr><td align="center">è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€</td><td align="center">ã€æ³•ã€‘è®©-é›…å…‹Â·å¢æ¢­</td><td align="center">01-01</td><td align="center">01-05</td><td align="center">6h</td></tr><tr><td align="center">ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ</td><td align="center">ã€å¥¥ã€‘ è·¯å¾·ç»´å¸ŒÂ·å†¯Â·ç±³ç‘Ÿæ–¯</td><td align="center">01-01</td><td align="center">01-10</td><td align="center">10h</td></tr><tr><td align="center">å¿ƒç†æµ‹é‡è€…</td><td align="center">ã€æ—¥ã€‘æ·±çœŸè§</td><td align="center">01-03</td><td align="center">01-05</td><td align="center">6h</td></tr><tr><td align="center">è®ºé©å‘½</td><td align="center">ã€å¾·ã€‘æ±‰å¨œÂ·é˜¿ä¼¦ç‰¹</td><td align="center">01-05</td><td align="center">01-20</td><td align="center">12h</td></tr><tr><td align="center">æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨å’Œåæœ</td><td align="center">å¼ é›ªå¿ </td><td align="center">01-15</td><td align="center">01-20</td><td align="center">4h</td></tr><tr><td align="center">è®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´</td><td align="center">ã€æ³•ã€‘è®©-é›…å…‹Â·å¢æ¢­</td><td align="center">01-21</td><td align="center">01-25</td><td align="center">4h</td></tr><tr><td align="center">åœ°çƒè„‰åŠ¨ï¼šå‰æ‰€æœªè§çš„è‡ªç„¶ä¹‹ç¾</td><td align="center">ã€è‹±ã€‘é˜¿æ‹‰æ–¯æ³°å°”Â·ç¦ç‘Ÿå‰å°”</td><td align="center">01-22</td><td align="center">01-25</td><td align="center">2h</td></tr><tr><td align="center">ç¤¾ä¼šå¥‘çº¦è®º (è¯‘æ—äººæ–‡ç²¾é€‰)</td><td align="center">ã€æ³•ã€‘è®©-é›…å…‹Â·å¢æ¢­</td><td align="center">01-23</td><td align="center">01-25</td><td align="center">4h</td></tr><tr><td align="center">ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶</td><td align="center">å‘¨é›ªå…‰</td><td align="center">01-28</td><td align="center">02-07</td><td align="center">8h</td></tr><tr><td align="center">ç—…æ¯’æ˜Ÿçƒ</td><td align="center">ã€ç¾]ã€‘å°”Â·é½é»˜</td><td align="center">01-28</td><td align="center">01-30</td><td align="center">4h</td></tr><tr><td align="center">ç—…æ¯’æ¥è¢­</td><td align="center">ã€ç¾ã€‘å†…æ£®â€¢æ²ƒå°”å¤«</td><td align="center">01-29</td><td align="center">01-31</td><td align="center">2h</td></tr><tr><td align="center">è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹</td><td align="center">ç†æŸ¥å¾·Â·æ™®é›·æ–¯é¡¿</td><td align="center">02-01</td><td align="center">02-08</td><td align="center">8h</td></tr><tr><td align="center">è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½</td><td align="center">å‘¨å¿—ç‚</td><td align="center">02-05</td><td align="center">05-08</td><td align="center">4h</td></tr><tr><td align="center">å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹</td><td align="center">æœ±æ‰ä¼</td><td align="center">02-06</td><td align="center">02-10</td><td align="center">3h</td></tr><tr><td align="center">ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥</td><td align="center">æœ±é’¦å£«</td><td align="center">02-07</td><td align="center">02-12</td><td align="center">6h</td></tr><tr><td align="center">æœ±é’¦å£«çš„ä¸ªäººåšå®¢</td><td align="center">æœ±é’¦å£«</td><td align="center">02-08</td><td align="center">03-30</td><td align="center">8h</td></tr><tr><td align="center">è¿œå¤çš„è¾‰ç…Œï¼šç”Ÿç‰©å¤§å¹…å°„</td><td align="center">æˆå˜‰ä½™</td><td align="center">02-13</td><td align="center">05-15</td><td align="center">6h</td></tr><tr><td align="center">ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ</td><td align="center">ã€è‹±ã€‘é©¬ä¸Â·é›·å¾·èŠ¬</td><td align="center">02-13</td><td align="center">02-15</td><td align="center">6h</td></tr><tr><td align="center">ç”Ÿå‘½æ´»åŠ¨çš„æ‘‡ç¯®ï¼šç»†èƒ</td><td align="center">ç‹è€€å‘</td><td align="center">02-16</td><td align="center">02-18</td><td align="center">4h</td></tr><tr><td align="center">åœ°çƒè„‰åŠ¨2ï¼šå¥‡è¿¹ä¸–ç•Œ</td><td align="center">ã€è‹±ã€‘èƒ¡Â·ç§‘é‡Œ</td><td align="center">02-24</td><td align="center">02-27</td><td align="center">3h</td></tr><tr><td align="center">ä¸€æƒ³åˆ°è¿˜æœ‰95<em>%çš„</em>é—®é¢˜ç•™ç»™äººç±»ï¼Œæˆ‘å°±æ”¾å¿ƒäº†</td><td align="center">ã€å·´æ‹¿é©¬ã€‘è±ªå°”èµ«â€¢é™ˆ</td><td align="center">03-07</td><td align="center">03-15</td><td align="center">4h</td></tr><tr><td align="center">å†å²çš„ç»ˆç»“åŠæœ€åä¹‹äºº</td><td align="center">ã€ç¾ã€‘å¼—æœ—è¥¿æ–¯Â·ç¦å±±</td><td align="center">03-03</td><td align="center">03-10</td><td align="center">10h</td></tr><tr><td align="center">æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³</td><td align="center">ä½™æ°</td><td align="center">03-13</td><td align="center">03-20</td><td align="center">8h</td></tr><tr><td align="center">ç¥å¥‡çš„ç”Ÿç‰©åŒ–å­¦</td><td align="center">ç¥å¥‡çš„ç”Ÿç‰©åŒ–å­¦</td><td align="center">03-23</td><td align="center">03-25</td><td align="center">4h</td></tr><tr><td align="center">è´¹é©¬æœ€ç»ˆå®šç†</td><td align="center">ã€æ—¥ã€‘æ—¥å†²æ¨±çš®</td><td align="center">03-26</td><td align="center">03-28</td><td align="center">3h</td></tr><tr><td align="center">è¢«è®¨åŒçš„å‹‡æ°”</td><td align="center">ã€æ—¥ã€‘å²¸è¦‹ä¸€éƒ</td><td align="center">03-28</td><td align="center">03-30</td><td align="center">4h</td></tr><tr><td align="center">é¸Ÿç°å¤æ–‡æ˜</td><td align="center">ã€æ³•ã€‘ è®©-å…‹åŠ³å¾·Â·æˆˆå°”ä¸‡</td><td align="center">04-03</td><td align="center">04-10</td><td align="center">8h</td></tr><tr><td align="center">è‡ªç”±å®ªç« </td><td align="center">ã€å¥¥ã€‘å¼—é‡Œå¾·é‡Œå¸ŒÂ·å“ˆè€¶å…‹</td><td align="center">04-01</td><td align="center">04-20</td><td align="center">16h</td></tr><tr><td align="center">ç›—ç«è€…ï¼šä¸­å›½æ•™è‚²é©å‘½é™æ‚„æ‚„</td><td align="center">é‚“åº·å»¶ æ¢ç½—å…´</td><td align="center">04-11</td><td align="center">04-20</td><td align="center">6h</td></tr><tr><td align="center">æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—éŸ©äººæ°‘çš„çœŸå®ç”Ÿæ´»</td><td align="center">ã€ç¾ã€‘èŠ­èŠ­æ‹‰Â·å¾·ç±³å…‹</td><td align="center">04-23</td><td align="center">04-26</td><td align="center">6h</td></tr><tr><td align="center">å“ˆç»´å°”æ–‡é›†</td><td align="center">ã€æ·å…‹ã€‘å“ˆç»´å°”</td><td align="center">04-24</td><td align="center">04-30</td><td align="center">8h</td></tr><tr><td align="center">å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ</td><td align="center">ã€ç¾ã€‘ å¡è’‚Â·é©¬é¡¿</td><td align="center">04-26</td><td align="center">04-30</td><td align="center">6h</td></tr><tr><td align="center">è‡´å‘½çš„è‡ªè´Ÿï¼šç¤¾ä¼šä¸»ä¹‰çš„è°¬è¯¯</td><td align="center">ã€å¥¥ã€‘å¼—é‡Œå¾·é‡Œå¸ŒÂ·å“ˆè€¶å…‹</td><td align="center">05-01</td><td align="center">05-30</td><td align="center">10h</td></tr><tr><td align="center">åœ°çƒçš„æ¼”å˜æ•…äº‹</td><td align="center">å§šå»ºæ˜</td><td align="center">05-02</td><td align="center">05-05</td><td align="center">4h</td></tr><tr><td align="center">å›¾è§£ç§‘æŠ€è¯‘ä¸›ï¼šæ¼«ç”»å…ƒç´ 118</td><td align="center">ã€æ—¥ã€‘æ–‹è…¾èƒœè£•</td><td align="center">05-02</td><td align="center">05-03</td><td align="center">2h</td></tr><tr><td align="center">é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–</td><td align="center">å¾è´²</td><td align="center">05-02</td><td align="center">05-10</td><td align="center">4h</td></tr><tr><td align="center">ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘</td><td align="center">å¾è´²</td><td align="center">05-03</td><td align="center">05-25</td><td align="center">8h</td></tr><tr><td align="center">ä¸‰è§’è·ç¦»æ— é™ä¸ºé›¶1-4</td><td align="center">ã€æ—¥ã€‘å²¬é¹­å®«</td><td align="center">05-05</td><td align="center">05-25</td><td align="center">10h</td></tr><tr><td align="center">è¢«ç¦é”¢çš„å¤´è„‘</td><td align="center">ã€ç«‹ã€‘åˆ‡æ–¯ç“¦å¤«Â·ç±³æ²ƒä»€</td><td align="center">05-05</td><td align="center">05-10</td><td align="center">6h</td></tr><tr><td align="center">äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†</td><td align="center">å¾è´²</td><td align="center">05-02</td><td align="center">05-10</td><td align="center">10h</td></tr><tr><td align="center">å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾</td><td align="center">ã€è‹±ã€‘å¸ƒè±æ©â€¢è€ƒå…‹æ–¯</td><td align="center">05-25</td><td align="center">05-30</td><td align="center">5h</td></tr><tr><td align="center">é€šå¾€å°Šä¸¥çš„å…¬å…±ç”Ÿæ´»</td><td align="center">å¾è´²</td><td align="center">05-25</td><td align="center">05-30</td><td align="center">10h</td></tr><tr><td align="center">å®‡å®™ä»èµ·æºåˆ°æœªæ¥</td><td align="center">ã€ç¾ã€‘çº¦ç¿°Â·å¸ƒç½—å…‹æ›¼</td><td align="center">06-18</td><td align="center">06-25</td><td align="center">5h</td></tr><tr><td align="center">kubernetes ç½‘ç»œæƒå¨æŒ‡å—</td><td align="center">æœå†›</td><td align="center">06-20</td><td align="center">06-27</td><td align="center">6h</td></tr><tr><td align="center">Linuxå¼€æºç½‘ç»œå…¨æ ˆè¯¦è§£ï¼šä»DPDKåˆ°OpenFlow</td><td align="center">è‹±ç‰¹å°”äºšå¤ªç ”å‘æœ‰é™å…¬å¸</td><td align="center">06-20</td><td align="center">06-23</td><td align="center">3h</td></tr><tr><td align="center">å¤§è¯å¤„ç†å™¨</td><td align="center">ä¸‡æœ¨æ¨</td><td align="center">06-21</td><td align="center">06-21</td><td align="center">2h</td></tr><tr><td align="center">ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶5</td><td align="center">ã€æ—¥ã€‘å²¬é¹­å®«</td><td align="center">06-24</td><td align="center">06-25</td><td align="center">2.5h</td></tr><tr><td align="center">å¤§è¯å­˜å‚¨</td><td align="center">å¼ å†¬</td><td align="center">06-27</td><td align="center">07-21</td><td align="center">18h</td></tr><tr><td align="center">å¸ƒæ‹‰æ ¼ç²¾ç¥</td><td align="center">ã€æ·ã€‘ä¼Šå‡¡Â·å…‹é‡Œç›</td><td align="center">07-01</td><td align="center">07-10</td><td align="center">6h</td></tr><tr><td align="center">å¾è´²æ–‡é›†</td><td align="center">å¾è´²</td><td align="center">07-10</td><td align="center">07-30</td><td align="center">30h</td></tr><tr><td align="center">ç”Ÿå‘½é€šå²</td><td align="center">æœ±é’¦å£«</td><td align="center">04-10</td><td align="center">08-20</td><td align="center">60h</td></tr><tr><td align="center">Kubernetes æºç å‰–æ</td><td align="center">éƒ‘ä¸œæ—­</td><td align="center">08-01</td><td align="center">08-10</td><td align="center">10h</td></tr><tr><td align="center">Kubernetes æŒ‡å—ç¬¬å››ç‰ˆ</td><td align="center">é¾šæ­£ï¼Œå´æ²»è¾‰ï¼Œå´”ç§€é¾™</td><td align="center">08-10</td><td align="center">08-30</td><td align="center">8h</td></tr><tr><td align="center">åª’ä»‹æ‰¹åˆ¤ä¸‰éƒ¨æ›²</td><td align="center">ã€ç¾ã€‘å°¼å°”Â·æ³¢å…¹æ›¼</td><td align="center">09-01</td><td align="center">09-30</td><td align="center">20h</td></tr><tr><td align="center">æ—¶å…‰æ²™æ¼</td><td align="center">ã€æ—¥ã€‘ã•ã¨(</td><td align="center">09-13</td><td align="center">09-13</td><td align="center">1h</td></tr><tr><td align="center">Just Because!</td><td align="center">ã€æ—¥ã€‘é¸­å¿—ç”°ä¸€</td><td align="center">09-13</td><td align="center">09-14</td><td align="center">4h</td></tr><tr><td align="center">æˆ‘çš„é’æ˜¥æˆ€æ„›ç‰©èªæœç„¶æœ‰å•é¡Œ</td><td align="center">ã€æ—¥ã€‘æ¸¡èˆª</td><td align="center">09-15</td><td align="center">09-30</td><td align="center">30h</td></tr><tr><td align="center">kubernetes æºç åˆ†æ</td><td align="center">éƒ‘ä¸œæ—­</td><td align="center">10-01</td><td align="center">10-07</td><td align="center">15h</td></tr><tr><td align="center">å®‰è¾¾ä¸å²›æ‘ 1-8</td><td align="center">ã€æ—¥ã€‘å…¥é—´äººé—´</td><td align="center">11-15</td><td align="center">11-20</td><td align="center">20h</td></tr><tr><td align="center">å¤æ‚ç”Ÿå‘½çš„èµ·æº</td><td align="center">ã€è‹±ã€‘ å°¼å…‹Â·è±æ©</td><td align="center">11-30</td><td align="center">12-07</td><td align="center">15h</td></tr><tr><td align="center">æ¥è‡ªæ–°ä¸–ç•Œ</td><td align="center">ã€æ—¥ã€‘è´µå¿—ç¥ä»‹</td><td align="center">11-30</td><td align="center">12-10</td><td align="center">20h</td></tr><tr><td align="center">æ”¿å®—å›çš„å¾©ä»‡</td><td align="center">ã€æ—¥ã€‘ç«¹å†ˆå¶æœˆ</td><td align="center">12-05</td><td align="center">12-07</td><td align="center">6h</td></tr><tr><td align="center">æ˜Ÿé™…ç©¿è¶Š</td><td align="center">ã€ç¾ã€‘åŸºæ™®Â·ç´¢æ©</td><td align="center">12-10</td><td align="center">12-12</td><td align="center">4h</td></tr><tr><td align="center">Life ç”Ÿå‘½</td><td align="center">ã€ç¾ã€‘çº¦ç¿°Â·å¸ƒç½—å…‹æ›¼</td><td align="center">12-12</td><td align="center">12-23</td><td align="center">8h</td></tr><tr><td align="center">ç¾ä¸½æ–°ä¸–ç•Œ</td><td align="center">ã€è‹±ã€‘é˜¿é“å¸Â·èµ«èƒ¥é»</td><td align="center">12-14</td><td align="center">12-18</td><td align="center">8h</td></tr><tr><td align="center">æ¨±èŠ±åº„çš„å® ç‰©å¥³å­©</td><td align="center">ã€æ—¥ã€‘é¸­å¿—ç”°ä¸€</td><td align="center">12-13</td><td align="center">12-21</td><td align="center">36h</td></tr><tr><td align="center">ç”Ÿå‘½çš„è·ƒå‡</td><td align="center">ã€è‹±]ã€‘å°¼å…‹Â·è±æ©</td><td align="center">12-22</td><td align="center">12-26</td><td align="center">8h</td></tr><tr><td align="center">æ¶ˆå¤±çš„å¾®ç”Ÿç‰©ï¼šæ»¥ç”¨æŠ—ç”Ÿç´ å¼•å‘çš„å±æœº</td><td align="center">ã€ç¾ã€‘é©¬ä¸â€¢å¸ƒè±æ³½</td><td align="center">12-28</td><td align="center">01-02</td><td align="center">8h</td></tr></tbody></table><h2 id="æ¨è"><a href="#æ¨è" class="headerlink" title="æ¨è"></a>æ¨è</h2><ul><li>ç¤¾ä¼šå¥‘çº¦è®º</li><li>è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€</li><li>è®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´</li><li>è‡´å‘½çš„è‡ªè´Ÿï¼šç¤¾ä¼šä¸»ä¹‰çš„è°¬è¯¯</li><li>ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ</li><li>ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶</li><li>æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—éŸ©äººæ°‘çš„çœŸå®ç”Ÿæ´»</li><li>å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ</li><li>è¢«è®¨åŒçš„å‹‡æ°”</li><li>é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–</li><li>ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘</li><li>äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†</li><li>é€šå¾€å°Šä¸¥çš„å…¬å…±ç”Ÿæ´»</li><li>å¸ƒæ‹‰æ ¼ç²¾ç¥</li><li>å¾è´²æ–‡é›†</li><li>ç”Ÿå‘½é€šå²</li><li>å¤æ‚ç”Ÿå‘½çš„èµ·æº</li><li>ç”Ÿå‘½çš„è·ƒå‡</li><li>æ¥è‡ªæ–°ä¸–ç•Œ</li></ul><h2 id="æ”¿æ²»-å“²å­¦"><a href="#æ”¿æ²»-å“²å­¦" class="headerlink" title="æ”¿æ²»/å“²å­¦"></a>æ”¿æ²»/å“²å­¦</h2><h3 id="ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ"><a href="#ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ" class="headerlink" title="ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ"></a>ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ</h3><p>è¿™æœ¬ä¹¦æ˜¯ 2020 å¹´è¯»çš„ç¬¬ä¸€æœ¬ä¹¦ï¼Œè¿™æœ¬ä¹¦å¯ä»¥å’Œå“ˆè€¶å…‹çš„ã€Šé€šå¾€å¥´å½¹ä¹‹è·¯ã€‹ç»“åˆç€è¯»ã€‚æœ¬ä¹¦å‡ºç‰ˆäº 1922 å¹´ï¼Œåˆ†åˆ«ä»å¤šä¸ªé¢†åŸŸï¼ˆæ”¿æ²»ã€ç»æµã€æ–‡åŒ–ã€ä¼¦ç†ã€å®—æ•™â€¦ï¼‰è®ºè¿°äº†ç¤¾ä¼šä¸»ä¹‰å¿…å®šå¤±è´¥çš„æ‚²æƒ¨ç»“å±€ï¼Œå¯¹å½“æ—¶çš„ç¤¾ä¼šå°¤å…¶é’å¹´å­¦ç”Ÿæ¥è®²å†²å‡»ç›¸å½“çš„å¤§ï¼Œé‚£æ—¶å€™ CCP åˆšåˆšæˆç«‹æ‰ 1 å¹´å“¦ã€‚</p><p>å…ˆè¯´ä¸€ä¸‹ä½œè€…ï¼Œè·¯å¾·ç»´å¸ŒÂ·å†¯Â·ç±³å¡æ–¯ä½œä¸ºâ€œ<a href="https://zh.wikipedia.org/wiki/å¥§åœ°åˆ©ç¶“æ¿Ÿå­¸æ´¾" target="_blank" rel="noopener">å¥¥åœ°åˆ©ç»æµå­¦æ´¾</a>çš„é™¢é•¿â€ï¼Œç°ä»£<a href="https://zh.wikipedia.org/wiki/è‡ªç”±æ„å¿—ä¸»ç¾©" target="_blank" rel="noopener">è‡ªç”±æ„å¿—ä¸»ä¹‰</a>è¿åŠ¨çš„ä¸»è¦é¢†å¯¼äººï¼Œä¹Ÿæ˜¯<a href="https://zh.wikipedia.org/wiki/å¤å…¸è‡ªç”±ä¸»ç¾©" target="_blank" rel="noopener">å¤å…¸è‡ªç”±ä¸»ä¹‰</a>ç¬¬ä¸€æŠŠäº¤æ¤…ï¼Œå…¶å½±å“åŠ›ä¸è¨€è€Œå–»ã€‚ä»–çš„å­¦ç”Ÿæ›´æ˜¯é’å‡ºäºè“èƒœäºè“ï¼šå¼—é‡Œå¾·é‡Œå¸ŒÂ·å†¯Â·å“ˆè€¶å…‹ã€å¼—é‡ŒèŒ¨Â·é©¬å…‹å¢æ™®ã€æˆˆç‰¹å¼—é‡Œå¾·Â·å†¯Â·å“ˆä¼¯å‹’ã€å¥¥æ–¯å¡Â·æ‘©æ ¹æ–¯å¦ã€å¨å»‰Â·å‹’æ™®å…‹ã€ç†æŸ¥å¾·Â·å†¯Â·æ–½ç‰¹é‡Œæˆˆå°”ã€è‰¾å°”å¼—é›·å¾·Â·èˆ’èŒ¨ã€è´¹é‡Œå…‹æ–¯Â·è€ƒå¤«æ›¼ã€åŸƒé‡Œå…‹Â·æ²ƒæ ¼æ—ã€æ ¼å¥¥å°”æ ¼Â·å“ˆå°”å§†ã€ä¿ç½—Â·ç½—æ£®æ–¯å¦-ç½—ä¸¹ã€è±æ˜‚å†…å°”Â·ç½—å®¾æ–¯ã€‚åœ¨ä»–çš„å­¦ç”Ÿå½“ä¸­ï¼Œå“ˆè€¶å…‹è·è¯ºè´å°”ç»æµå­¦å¥–ï¼Œå¼—é‡ŒèŒ¨Â·é©¬å…‹å¢æ™®ã€æˆˆç‰¹å¼—é‡Œå¾·Â·å†¯Â·å“ˆä¼¯å‹’æ›¾å…ˆåä»»ç¾å›½ç»æµå­¦ä¼šä¼šé•¿ã€‚</p><blockquote><p>æˆ‘ä»¬æ„Ÿåˆ°ï¼Œæˆ‘ä»¬æˆé•¿äºå…¶ä¸­çš„é‚£ä¸ªæ–‡æ˜å·²ç»å´©æºƒã€‚æˆ‘ä»¬ç«‹å¿—å»ºè®¾ä¸€ä¸ªæ›´ç¾å¥½çš„ä¸–ç•Œï¼Œè€Œæ­£æ˜¯è¿™ç§å†é€ ç¤¾ä¼šçš„æ¸´æœ›ï¼Œé­ç­–æˆ‘ä»¬æŠ•èº«ç»æµå­¦ç ”ç©¶ã€‚ç¤¾ä¼šä¸»ä¹‰è®¸è¯ºç»™æˆ‘ä»¬ä¸€ä¸ªæ›´åŠ ç†æ€§ã€æ›´åŠ å…¬æ­£çš„ä¸–ç•Œã€‚æ­¤æ—¶ï¼Œã€Šç¤¾ä¼šä¸»ä¹‰ã€‹é—®ä¸–äº†ï¼Œæˆ‘ä»¬çš„ä¿¡å¿µåå¡Œäº†ã€‚ã€Šç¤¾ä¼šä¸»ä¹‰ã€‹å¯¹æˆ‘ä»¬è¯´ï¼Œæˆ‘ä»¬çš„æ–¹å‘é”™äº†ã€‚</p></blockquote><p><code>æ‘˜æŠ„</code> <a href="https://t.co/mSj0qay7jW" target="_blank" rel="noopener">ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ</a></p><blockquote><p>ç±³å¡æ–¯åœ¨ä¹¦ä¸­åˆ†åˆ«ä»å¤šä¸ªé¢†åŸŸï¼ˆæ”¿æ²»ã€ç»æµã€æ–‡åŒ–ã€ä¼¦ç†ã€å®—æ•™â€¦ï¼‰å¯¹ã€å„ç§æµæ´¾ã€‘çš„ç¤¾ä¼šä¸»ä¹‰è¿›è¡ŒçŒ›çƒˆæ‰¹åˆ¤ã€‚å…¶æŠ¨å‡»çš„ç«åŠ›ä¹‹çŒ›ï¼Œå®å±ç½•è§ã€‚</p></blockquote><p>å¦å¤–æ¨èè¯»ä¸€ä¸‹ <a href="https://program-think.blogspot.com/2018/09/Book-Review-The-Errors-of-Marxism-Leninism.html" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆé©¬å…‹æ€æ˜¯é”™çš„ï¼Ÿâ€”â€”å…¨é¢æ‰¹åˆ¤é©¬åˆ—ä¸»ä¹‰çš„çŸ¥åè‘—ä½œå¯¼è¯»</a> ã€‚</p><blockquote><p>ä½œè€…<a href="https://zh.wikipedia.org/wiki/è·¯å¾·ç¶­å¸ŒÂ·é¦®Â·ç±³å¡æ–¯" target="_blank" rel="noopener">è·¯å¾·ç»´å¸ŒÂ·å†¯Â·ç±³å¡æ–¯</a>æ˜¯å¥¥åœ°åˆ©å­¦æ´¾çš„å¹²å°†ï¼Œå¹¶å¯¹åŒä¸€å­¦æ´¾çš„å“ˆè€¶å…‹æœ‰é‡å¤§å½±å“ã€‚åœ¨å“ˆè€¶å…‹çš„å¾ˆå¤šè‘—ä½œå’Œç†è®ºä¸­ï¼Œéƒ½å¯ä»¥çœ‹åˆ°ç±³å¡æ–¯çš„å½±å­ã€‚<br>ã€€ã€€ç±³å¡æ–¯çš„æˆå°±é•¿æœŸè¢«å­¦æœ¯ç•Œå¿½è§†ï¼ˆç”šè‡³æ˜¯æ’æ–¥ï¼‰ã€‚ä¸€æ–¹é¢æ˜¯ä»–çš„ç†è®ºå¤ªè¶…å‰ï¼Œå¦ä¸€æ–¹é¢æ˜¯ä»–çš„æ€§æ ¼å¤ªæ¿€çƒˆâ€”â€”ä¸äººäº¤æµæ—¶æ€»æ˜¯ä¸€é’ˆè§è¡€ï¼Œä¸ç•™æƒ…é¢ï¼Œæ¯«ä¸é¡¾å¿Œä»–äººæ„Ÿå—ã€‚<br>ã€€ã€€è¯´åˆ°ã€è¶…å‰æ€§ã€‘ï¼Œä»–å¯èƒ½æ˜¯ç»æµå­¦ç•Œæœ€æ—©æ„è¯†åˆ°â€œã€åšå¼ˆè®ºã€‘é‡è¦æ€§â€çš„é‚£ä¸ªäººï¼ˆæ—¶é—´æ˜¯20ä¸–çºªåˆæœŸï¼‰ã€‚å‡ åå¹´åï¼Œä¸å†¯Â·è¯ºä¾æ›¼å…±åŒå‘è¡¨åˆ’æ—¶ä»£è®ºæ–‡ã€Šåšå¼ˆè®ºä¸ç»æµè¡Œä¸ºã€‹çš„é‚£ä¸ªæ‘©æ ¹æ–¯å¦ï¼ˆå‰é¢ä¿ºæè¿‡æ­¤äººï¼‰ï¼Œå°±æ˜¯ç±³å¡æ–¯çš„å­¦ç”Ÿã€‚</p></blockquote><h3 id="è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€"><a href="#è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€" class="headerlink" title="è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€"></a>è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€</h3><p>è¿™æœ¬ä¹¦æ˜¯æˆ‘åœ¨çœ‹ã€Šå¿ƒç†æµ‹é‡è€…ã€‹åŠ¨ç”»çš„æ—¶å€™æåˆ°çš„ï¼Œåœ¨çœ‹å°è¯´çš„æ—¶å€™ä¹Ÿè§åˆ°è¿‡ã€‚äºæ˜¯å°±æ‹¿æ¥è¯»äº†ä¸€ä¸‹ï¼Œ<code>Kindle Unlimited</code>  çš„ä¼šå‘˜å¯ä»¥åœ¨ Amazon å•†åº—å…è´¹å€Ÿé˜…åˆ°ã€‚</p><p>ã€Šè®ºäººç±»ä¸å¹³ç­‰èµ·æºå’ŒåŸºç¡€ã€‹æ˜¯å¢æ¢­åº”æ³•å›½ç¬¬æˆç§‘å­¦é™¢çš„å¾æ–‡è€Œæ’°å†™çš„ç¬¬äºŒè®ºæ–‡ï¼Œç¬¬ä¸€ç¯‡è®ºæ–‡æ˜¯ã€Šè®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´ã€‹ã€‚åœ¨æœ¬ä¹¦ä¸­ï¼Œå¢æ¢­é˜å‘äº†è‡ªèº«çš„æ”¿æ²»å“²å­¦ï¼Œä¸ºã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹çš„å†™ä½œå¥ å®šäº†åŸºç¡€ã€‚å¢æ¢­å°†äººç±»å†å²çš„å‘å±•è¿‡ç¨‹è§†ä½œè¿›æ­¥ä¸é€€åŒ–çš„çŸ›ç›¾ç»Ÿä¸€ä½“ã€‚ä»–ä¸€æ–¹é¢å€ŸåŠ©å½“æ—¶æœ‰å…³è‡ªç„¶çŠ¶æ€ä¸‹äººçš„äººç±»å­¦ææ–™ï¼Œä¸€æ–¹é¢å±•å¼€è¾©è¯çš„æƒ³è±¡ï¼Œå›é¡¾äº†äººç±»ç”±è‡ªç„¶çŠ¶æ€å‘ç¤¾ä¼šçŠ¶æ€è¿‡æ¸¡çš„å†å²è¿›ç¨‹ï¼ŒæŒ‡å‡ºäººç±»çš„è¿›æ­¥å²åŒæ—¶ä¹Ÿæ˜¯äººç±»çš„å •è½å²ï¼Œå› ä¸ºäººç±»æ¯å‘å‰å‘å±•ä¸€æ­¥ï¼Œä¸å¹³ç­‰çš„ç¨‹åº¦å³åŠ æ·±ä¸€æ­¥ã€‚è€Œç§æœ‰åˆ¶çš„ç¡®ç«‹ï¼Œæ˜¯é€ æˆäººç±»ä¸å¹³ç­‰åŠå…¶åæœçš„å…³é”®ç¯èŠ‚ã€‚</p><p>æ­£æ˜¯è¿™æ ·çš„å‡è®¾ï¼Œä½¿äººä»¬å¾—ä»¥æ˜ç™½â€œæˆ‘ä»¬å¹¶éç”Ÿæ¥å¦‚æ­¤â€ï¼Œåªæ˜¯â€œå·²ç„¶å¦‚æ­¤â€ã€‚æ—¢ç„¶å¤„äºè‡ªç„¶çŠ¶æ€ä¸‹çš„äººç±»åªæ˜¯ä¸€ä¸ªæŠ½è±¡åŒ–çš„å½¢è±¡ï¼Œå³ä¸€ç§â€œæ— â€çš„å¢ƒç•Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å½“ç„¶ä¸èƒ½è¯´å¢æ¢­çš„ç›®çš„æ˜¯è®©äººç±»å›åˆ°è¿™ä¸ªæœ¬å°±ä¸å­˜åœ¨çš„å½¢è±¡äº†ã€‚ä»–åªæ˜¯ä¼å›¾ä»¥è¿™ä¸ªâ€œæ— â€çš„å¢ƒç•Œä¸ºèµ·ç‚¹ï¼Œå‘äººä»¬å±•ç¤ºå‡ºäººç±»æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥å˜æˆç°åœ¨çš„æ ·å­ï¼Œä»è€Œè¿›ä¸€æ­¥æ€è€ƒï¼Œè¦æƒ³æ‘†è„±ç°åœ¨çš„å›°å¢ƒï¼Œæˆ‘ä»¬æ‰€éœ€è¦åšå‡ºçš„åŠªåŠ›ã€‚æœ¬æ–‡ä¸ºæˆ‘ä»¬æä¾›çš„åæ€å°±åƒé‚£é«˜é€Ÿè·¯ä¸Šçš„ç¼“å†²å¸¦ï¼Œåªæœ‰åœç•™åœ¨ç¼“å†²å¸¦ä¸Šçš„é‚£ä¸€ç§’é’Ÿï¼Œäººç±»æ‰ç»ˆäºçœŸæ­£åœ°æ€è€ƒã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/oTmpnrHLKS" target="_blank" rel="noopener">è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€</a></p><h3 id="è®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´"><a href="#è®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´" class="headerlink" title="è®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´"></a>è®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´</h3><p><code>æ‘˜æŠ„</code> <a href="https://t.co/Vsq6Lc1FeW" target="_blank" rel="noopener">è®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´</a></p><h3 id="ç¤¾ä¼šå¥‘çº¦è®º"><a href="#ç¤¾ä¼šå¥‘çº¦è®º" class="headerlink" title="ç¤¾ä¼šå¥‘çº¦è®º"></a>ç¤¾ä¼šå¥‘çº¦è®º</h3><p>æŒ‰ç…§å¢æ¢­çš„ç¬¬ä¸€ç¯‡è®ºæ–‡ã€Šè®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´ã€‹å’Œç¬¬äºŒç¯‡è®ºæ–‡ã€Šè®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€ ã€‹çš„åˆ†æï¼Œäººæœ¬æ¥æ˜¯çº¯æœ´å–„è‰¯çš„ï¼Œç”±äºæœ‰ç¼ºé™·çš„ç¤¾ä¼šåˆ¶åº¦ï¼Œç”Ÿæ´»äºç¤¾ä¼šä¸­çš„äººæ‰å˜åï¼Œå¹¶å •å…¥ç½ªæ¶çš„æ·±æ¸Šã€‚ç”±æ–‡æ˜å¼•å‘çš„é—®é¢˜å¿…é¡»é€šè¿‡æ–°çš„æ”¿æ²»ç»„ç»‡å½¢å¼æ¥åŠ ä»¥å…‹æœã€‚ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹è¦åšçš„å·¥ä½œæ˜¯ï¼Œé€šè¿‡å»ºç«‹ä¸€ä¸ªå¥å…¨çš„ç¤¾ä¼šæ”¿æ²»åˆ¶åº¦ï¼Œå¸®åŠ©äººä»¬æ¢å¤è‡ªç„¶è‰¯å–„ï¼ˆnatural goodnessï¼‰ã€‚</p><p>ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåˆæ³•çš„å›½å®¶å¿…é¡»æ ¹æ®æ™®éæ„å¿—æ¥è¿›è¡Œç®¡ç†ã€‚æƒ³è¦è¯»æ‡‚è¿™æœ¬ä¹¦è¿˜éœ€è¦è¯»å¢æ¢­çš„å¦å¤–ä¸¤ç¯‡è®ºæ–‡ï¼Œç¬¬ä¸€è®ºæ–‡ï¼ˆã€Šè®ºè‰ºæœ¯ä¸ç§‘å­¦ã€‹ï¼‰å’Œç¬¬äºŒè®ºæ–‡è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€ã€‹ï¼Œå¢æ¢­ä¸»è¦æ€è€ƒçš„æ˜¯æ–‡æ˜ç¤¾ä¼šä¸­ç§ç§ç½ªæ¶ä¸ä¸å¹¸ï¼Œå¹¶è§£é‡Šå®ƒä»¬çš„èµ·æºï¼›é‚£ä¹ˆï¼Œä»ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹å¼€å§‹ï¼Œå¢æ¢­åˆ™è‡´åŠ›äºæ€è€ƒå¦‚ä½•æ”¹å˜è¿™ç§çŠ¶å†µã€‚</p><p>ä»€ä¹ˆæ ·çš„ç¤¾ä¼šæ”¿æ²»åˆ¶åº¦æ‰æ˜¯å¥å…¨çš„å‘¢ï¼Ÿè¿™å°±è¦è¿½é—®ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜ï¼šæ­£ä¹‰ä¸åˆæ³•çš„æ”¿æ²»ç§©åºåŠå…¶åŸºç¡€æ˜¯ä»€ä¹ˆï¼Ÿã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹æ‰€æœ‰å…¶ä»–çš„é—®é¢˜å‡æ˜¯ä»è¿™é‡Œç”Ÿå‘å‡ºæ¥ï¼Œå¹¶ä¸ä¹‹å…³è”åœ¨ä¸€èµ·çš„ã€‚ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹å…±æœ‰å››å·ï¼Œç¬¬ä¸€å·è®¨è®ºçš„æ˜¯åˆæ³•çš„æ”¿æ²»ç§©åºçš„åŸºç¡€ï¼›ç¬¬äºŒå·è®¨è®ºçš„ä¸»é¢˜æ˜¯æ³•å¾‹å’Œç«‹æ³•ï¼›ç¬¬ä¸‰å·çš„ä¸»é¢˜æ˜¯æ™®éæ„å¿—è¿ç”¨äºç‰¹å®šæƒ…å½¢å³æ”¿åºœçš„æœºåˆ¶ï¼›ç¬¬å››å·ï¼Œè¿™ä¸€å·ä»¥å¯¹ç½—é©¬çš„æ”¿æ²»åˆ¶åº¦çš„æè¿°ä¸ºæ ¸å¿ƒå†…å®¹ï¼Œä»¥æ­¤æ¥æ¢è®¨æ”¿æ²»å…±åŒä½“çš„å‡èšåŠ›é—®é¢˜ï¼Œæœ€åä»¥å…¬æ°‘å®—æ•™ç»“æŸå…¨ä¹¦ã€‚</p><p>ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯<strong>åˆæ³•çš„å›½å®¶å¿…é¡»æ ¹æ®æ™®éæ„å¿—æ¥è¿›è¡Œç®¡ç†ï¼Œå³å·²æå‡º</strong>ã€‚ã€Šçˆ±å¼¥å„¿ã€‹èƒŒåçš„ä¸€ä¸ªåŸºæœ¬é¢„è®¾æ˜¯ï¼šæ²¡æœ‰æ–‡åŒ–åšæ”¯æ’‘ï¼Œåˆ¶åº¦æ˜¯æ²¡æœ‰åŠæ³•æœ‰æ•ˆè¿è¡Œçš„ã€‚å› æ­¤ï¼Œæœ€é‡è¦çš„ä»»åŠ¡æ˜¯ï¼šé€šè¿‡æ•™è‚²ï¼Œå°†â€œäººâ€è½¬å˜ä¸ºâ€œå…¬æ°‘â€ï¼Œåƒçˆ±å¼¥å„¿ä¸€æ ·çš„å…¬æ°‘ã€‚å”¯å…¶å¦‚æ­¤ï¼Œæ™®éæ„å¿—æ‰æœ‰å¯èƒ½ï¼Œæ­£ä¹‰è€Œåˆæ³•çš„æ”¿æ²»ç§©åºæ‰æœ‰å¯èƒ½ã€‚</p><p>æŒ‰ç…§ç¬¬ä¸€è®ºæ–‡å’Œç¬¬äºŒè®ºæ–‡çš„åˆ†æï¼Œäººæœ¬æ¥æ˜¯çº¯æœ´å–„è‰¯çš„ï¼Œç”±äºæœ‰ç¼ºé™·çš„ç¤¾ä¼šåˆ¶åº¦ï¼Œç”Ÿæ´»äºç¤¾ä¼šä¸­çš„äººæ‰å˜åï¼Œå¹¶å •å…¥ç½ªæ¶çš„æ·±æ¸Šã€‚ç”±æ–‡æ˜å¼•å‘çš„é—®é¢˜å¿…é¡»é€šè¿‡æ–°çš„æ”¿æ²»ç»„ç»‡å½¢å¼æ¥åŠ ä»¥å…‹æœã€‚ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹è¦åšçš„å·¥ä½œæ˜¯ï¼Œ<strong>é€šè¿‡å»ºç«‹ä¸€ä¸ªå¥å…¨çš„ç¤¾ä¼šæ”¿æ²»åˆ¶åº¦ï¼Œå¸®åŠ©äººä»¬æ¢å¤è‡ªç„¶è‰¯å–„ã€‚</strong> æ‰¾åˆ°ä¸€ç§ç»“åˆå½¢å¼ï¼Œå‡­å€Ÿå®ƒå¯ä»¥è¿ç”¨æ‰€æœ‰å…±åŒçš„åŠ›é‡æ¥æå«å’Œä¿æŠ¤æ¯ä¸ªç»“åˆè€…çš„äººèº«å’Œè´¢äº§ï¼Œè¿™ç§å½¢å¼ä½¿å¾—æ¯ä¸ªç»“åˆè€…è™½ç„¶ä¸æ‰€æœ‰äººç»“åˆåœ¨ä¸€èµ·ï¼Œä½†æ˜¯åªæœä»è‡ªå·±ï¼Œå¹¶ä¸”ä¸€å¦‚æ—¢å¾€åœ°è‡ªç”±ã€‚â€è¿™å°±æ˜¯ç¤¾ä¼šå¥‘çº¦æ‰€è¦è§£å†³çš„æ ¹æœ¬æ€§é—®é¢˜ã€‚ç¤¾ä¼šå¥‘çº¦å¯ä»¥ç®€åŒ–ä¸ºå¦‚ä¸‹è¯å¥ï¼š<strong>æˆ‘ä»¬ä¸­çš„æ¯ä¸ªäººå°†å…¶è‡ªèº«åŠå…¶æ‰€æœ‰çš„åŠ›é‡å…±åŒç½®äºæ™®éæ„å¿—çš„æœ€é«˜é¢†å¯¼ä¹‹ä¸‹ï¼Œè€Œå°†æ¯ä¸ªæˆå‘˜ä½œä¸ºæ•´ä½“ä¸å¯åˆ†å‰²çš„éƒ¨åˆ†çº³å…¥æ•´ä½“ã€‚</strong> åœ¨ã€Šçˆ±å¼¥å„¿ã€‹èƒŒåçš„ä¸€ä¸ªåŸºæœ¬é¢„è®¾æ˜¯ï¼šæ²¡æœ‰æ–‡åŒ–åšæ”¯æ’‘ï¼Œåˆ¶åº¦æ˜¯æ²¡æœ‰åŠæ³•æœ‰æ•ˆè¿è¡Œçš„ã€‚å› æ­¤ï¼Œæœ€é‡è¦çš„ä»»åŠ¡æ˜¯ï¼šé€šè¿‡æ•™è‚²ï¼Œå°†â€œäººâ€è½¬å˜ä¸ºâ€œå…¬æ°‘â€ï¼Œåƒçˆ±å¼¥å„¿ä¸€æ ·çš„å…¬æ°‘ã€‚å”¯å…¶å¦‚æ­¤ï¼Œæ™®éæ„å¿—æ‰æœ‰å¯èƒ½ï¼Œæ­£ä¹‰è€Œåˆæ³•çš„æ”¿æ²»ç§©åºæ‰æœ‰å¯èƒ½ã€‚æ‰€ä¾ç†è§£å¢æ¢­çš„æ€æƒ³ï¼Œæœ€å¥½æ˜¯ä»ç¬¬ä¸€ç¯‡è®ºæ–‡ã€ç¬¬äºŒç¯‡è®ºæ–‡ã€ç¤¾ä¼šå¥‘çº¦è®ºã€çˆ±å¼¥å°” è¿™æ ·çš„é¡ºåºè¯»å®Œã€‚</p><p>æ‰€ä»¥å¢æ¢­çš„è¿™å‡ æœ¬ä¹¦è¿è´¯æ€§å¾ˆå¼ºï¼Œéƒ½è¯»å®Œæ‰èƒ½ç†è§£å¢æ¢­çš„æ”¿æ²»å“²å­¦æ€æƒ³ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://kindle.502.li/" target="_blank" rel="noopener">ç¤¾ä¼šå¥‘çº¦è®º</a></p><h3 id="æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨ä¸åæœ"><a href="#æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨ä¸åæœ" class="headerlink" title="æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨ä¸åæœ"></a>æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨ä¸åæœ</h3><p>è¿™æœ¬ä¹¦æ˜¯å¼ é›ªå¿ æ•™æˆå†™çš„ï¼Œå†™ä½œé£æ ¼å’Œå¼ åƒå¸†ã€è®¸ç« æ¶¦ã€å¼ ç»´è¿ä»–ä»¬ä¸€æ ·ã€‚æ¯”è¾ƒå–œæ¬¢è¿™æ ·çš„è€å¸ˆï¼Œå…³äºå¼ é›ªå¿ æ•™æˆï¼Œç»´åŸºç™¾ç§‘ä¸Šæœ‰ä¸€æ®µï¼š</p><blockquote><p>2013å¹´5æœˆï¼Œå¼ é›ªå¿ é¦–å…ˆåœ¨ç½‘ç»œå…¬å¼€ä¸€ä»½ä¸­å›½å®˜æ–¹çš„â€œ<a href="https://zh.wikipedia.org/wiki/ä¸ƒä¸è®²" target="_blank" rel="noopener">ä¸ƒä¸è®²</a>â€çš„å†…éƒ¨ææ–™çš„å†…å®¹ã€‚å…¶åå¾—åˆ°å…¶ä»–å­¦è€…å’Œæ•™æˆçš„è¯å®ã€‚â€œä¸ƒä¸è®²â€æ˜¯ä¸­å…±ä¸­å¤®åœ¨2013å¹´åœ¨æ„è¯†å½¢æ€é¢†åŸŸçš„æŒ‡ä»¤ï¼Œç¡®å®šä¸ƒä¸ªé¢†åŸŸä¸ºç¦åŒºï¼š<a href="https://zh.wikipedia.org/wiki/æ™®ä¸–ä»·å€¼" target="_blank" rel="noopener">æ™®ä¸–ä»·å€¼</a>ã€<a href="https://zh.wikipedia.org/wiki/æ–°é—»è‡ªç”±" target="_blank" rel="noopener">æ–°é—»è‡ªç”±</a>ã€<a href="https://zh.wikipedia.org/wiki/å…¬æ°‘ç¤¾ä¼š" target="_blank" rel="noopener">å…¬æ°‘ç¤¾ä¼š</a>ã€<a href="https://zh.wikipedia.org/wiki/å…¬æ°‘æƒåˆ©" target="_blank" rel="noopener">å…¬æ°‘æƒåˆ©</a>ã€ä¸­å›½å…±äº§å…šçš„å†å²é”™è¯¯ã€<a href="https://zh.wikipedia.org/wiki/æƒè´µèµ„äº§é˜¶çº§" target="_blank" rel="noopener">æƒè´µèµ„äº§é˜¶çº§</a>ã€<a href="https://zh.wikipedia.org/wiki/å¸æ³•ç¨ç«‹" target="_blank" rel="noopener">å¸æ³•ç‹¬ç«‹</a>ã€‚éšåâ€œä¸ƒä¸è®²â€æˆä¸ºç½‘ç»œç¦è¯ï¼Œå¼ çš„æ–°æµªå¾®åšå†æ¬¡è¢«åˆ å·ã€‚<a href="https://zh.wikipedia.org/wiki/å¼ é›ªå¿ #cite_note-rfa2-6" target="_blank" rel="noopener">[6]</a></p></blockquote><p>è¿™ä¸€ä»¶äº‹ä¸å¾—æŠ¥é“ã€é‚£ä¸€æœ¬ä¹¦ä¸å¾—å‡ºç‰ˆã€è¿™å¥è¯ä¸èƒ½è®²ï¼Œåˆ è´´å°å·ç­‰ï¼Œè¡¨é¢ä¸Šè¨€è®ºå®¡æŸ¥æ˜¯åœ¨ä¾µçŠ¯è¨€è®ºè‡ªç”±ï¼Œä½†å®è´¨ä¸Šå´æ˜¯åœ¨è´¬ä½å…¨ä½“å›½æ°‘çš„äººæ ¼å’Œå°Šä¸¥ã€‚è¨€è®ºå®¡æŸ¥å®Œå…¨æ˜¯åœ¨å‘å…¨ä½“å›½æ°‘å®£å‘Šï¼šâ€œä½ ä»¬è¿™å¸®å±æ°‘æ ¹æœ¬å°±æ²¡æœ‰èµ„æ ¼äº†è§£è¿™ä»¶äº‹æƒ…çš„çœŸç›¸ï¼Œä¹Ÿæ²¡æœ‰èµ„æ ¼å»æ€è€ƒå’Œè¾¨åˆ«ä¿¡æ¯çš„çœŸå‡ã€‚â€ï¼Œä»·å€¼åˆ¤æ–­çš„æ ‡å‡†ç”±çœŸç†éƒ¨è¯´äº†ç®—ã€‚ä¸€ä¸ªäººä¸ä¸€å¤´çŒªçš„æœ€å¤§åŒºåˆ«ï¼Œå°±åœ¨äºäººå…·æœ‰çŒªæ‰€æ²¡æœ‰çš„ç†æ™ºï¼Œè€Œè¨€è®ºå®¡æŸ¥æ°æ°æ˜¯åœ¨å‰¥å¤ºäººä»¬è‡ªç”±è¿ç”¨ç†æ™ºçš„èµ„æ ¼ï¼Œä¹Ÿå°±æ˜¯å°½é‡ç¼©å°äººä¸çŒªä¹‹é—´çš„å·®åˆ«ã€‚ä¸“åˆ¶ç»Ÿæ²»è€…ç¡®å®å¸Œæœ›å›½æ°‘å¿˜è®°è‡ªå·±æ˜¯æœ‰ç†æ™ºçš„åŠ¨ç‰©ï¼Œå¹¶èƒ½åƒçŒªä¸€æ ·å®¹æ˜“æ»¡è¶³ï¼Œåªéœ€æœ‰è¶³ä»¥æœè…¹çš„é£Ÿç‰©ï¼Œå°±ä¼šå¯¹ç»Ÿæ²»è€…æ„Ÿæ©æˆ´å¾·ã€‚</p><blockquote><p>å…¨ä½“å›½æ°‘ä½œä¸ºä¸»æƒè€…ç»„å»ºæ”¿åºœå¹¶é€‰ä»»æ‰§æ”¿è€…ï¼Œæœ¬æ˜¯ä¸ºäº†æ›´å¥½åœ°ä¿æŠ¤è‡ªå·±çš„ç”Ÿå‘½ã€è´¢äº§å’Œè‡ªç”±ã€‚æ”¿åºœçš„ç›®çš„å’Œæ‰§æ”¿è€…çš„ä½¿å‘½ï¼Œæ˜¯ä¿æŠ¤ä¸»æƒè€…æœ¬æ¥å°±äº«æœ‰çš„æƒåˆ©å’Œè‡ªç”±ï¼Œè€Œä¸æ˜¯èµäºˆä¸»æƒè€…æœ¬æ¥ä¸äº«æœ‰çš„æƒåˆ©å’Œè‡ªç”±ã€‚æ‰§æ”¿è€…è®¤ä¸ºå›½æ°‘çš„æƒåˆ©å’Œè¿½æ±‚å¹¸ç¦çš„æœºä¼šï¼Œæ˜¯æºäºè‡ªå·±çš„èµèµï¼Œå°±åƒå­å¥³è®¤ä¸ºçˆ¶æ¯çš„å­˜åœ¨æ˜¯å‡ºäºè‡ªå·±çš„æ„å¿—ä¸€æ ·è’è°¬å’Œæ‚–ç†ã€‚</p></blockquote><p><code>æ‘˜æŠ„</code> <a href="https://t.co/1vyK1t0NMr" target="_blank" rel="noopener">æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨ä¸åæœ</a></p><h3 id="ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶"><a href="#ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶" class="headerlink" title="ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶"></a>ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶</h3><p>è¿™æœ¬ä¹¦æ˜¯æ˜¥èŠ‚çš„æ—¶å€™åœ¨å®¶è¯»å®Œçš„ï¼Œè¾ƒä¹‹äºå¼ é›ªå¿ æ•™æˆçš„ã€Šæ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨å’Œåæœã€‹ï¼Œå‘¨é›ªå…‰æ•™æˆä»ç»„ç»‡å­¦è§’åº¦æ¥è¿›è¡Œåˆ†æä¸­å…±å›½å®¶æ²»ç†å¾—é€»è¾‘ã€‚å¯¹äºè¿™æ¬¡å¾—ç–«æƒ…æ¥è®²ï¼Œå†ä¸€æ¬¡å°è¯äº†ä¹¦ä¸­æ‰€é˜é‡Šçš„å†…å®¹ã€‚<strong>å³ä¸€ç»Ÿä½“åˆ¶ä¸æœ‰æ•ˆæ²»ç†ï¼šä¸­å›½å›½å®¶æ²»ç†çš„ä¸€ä¸ªæ·±åˆ»çŸ›ç›¾</strong>ã€‚ä¸åšè¿‡å¤šè¯„è®ºï¼Œæ­¤ä¹¦å¦‚åŒæ¨ç‰¹ä¸Šçš„ä¸€äº›äººæ¨èä¸€æ ·ï¼Œå¾ˆé€‚åˆå½“ä¸‹å»çœ‹çœ‹ï¼Œå»åˆ†æä¸€ä¸‹è¿™ä¸ªå®˜åƒšä½“åˆ¶æ˜¯å¤šä¹ˆåœ°è…è´¥å’Œæ— èƒ½ã€‚å°±å¦‚ã€Šå¿ƒç†æµ‹é‡è€…ã€‹ä¸­æ‰€è¯´çš„ï¼Œ<strong>æˆ‘ä»¬å§‹ç»ˆæ‰¿æ‹…ç€æ”¿åºœå¼ºåŠ ç»™æˆ‘ä»¬çš„é£é™©</strong>ï¼Œè¿™æ˜¯æƒåŠ›é›†ä¸­åŒ–çš„å¿…ç„¶ç»“æœã€‚é‚£äº›å·²ç»é›†ä¸­èµ·æ¥çš„æƒåŠ›ç»å¯¹ä¸ä¼šå› ä¸ºä»–ç¾å¥½çš„æ„¿æ™¯è€Œå˜å¾—æ— å®³ã€‚é‚£äº›æ­»åœ¨æ­¦æ±‰è‚ºç‚ç—…æ¯’ä¹‹å¤–çš„äººä¸æ­£æ˜¯æˆ‘ä»¬æ¯ä¸ªäººéƒ½è¦æ‰¿æ‹…çš„é£é™©å—</p><p>åœ¨ä¸“åˆ¶å›½å®¶ï¼ŒæƒåŠ›ä¸å—çº¦æŸçš„ç»Ÿæ²»è€…ï¼Œæ˜¯æ™®éçš„æ”¿åºœè…è´¥å’Œå„ç§ç¤¾ä¼šé—®é¢˜çš„æ ¹ç”±ï¼Œä¹Ÿæ˜¯äººç±»æ–‡æ˜ç¤¾ä¼šæœ€å¤§çš„<code>ç—…æ¯’</code> ã€‚ä¹Ÿæ­£æ˜¯æ­£æ˜¯è¿™ä¸ªè…è´¥æ— èƒ½çš„å®˜åƒšä½“åˆ¶æ¬ºä¸Šç’ä¸‹ã€åˆ å¸–å°å·ã€ç»´ç¨³æŠ“äººã€å°æ€è¨€è®ºã€æ‹˜ç•™è®°è€…ã€æŠ“æ•å¾‹å¸ˆã€é€ è°£å¼è¾Ÿè°£ç­‰ç­‰ä½œæ¶è¡Œä¸ºæ‰å¯¼è‡´çš„å…¨çƒç–«æƒ…å¤§çˆ†å‘ã€‚å…¶å®è¿™äº›æ—¶åˆ»ä¼´éšç€æˆ‘ä»¬ï¼Œåªä¸è¿‡æ˜¯è¿™æ¬¡çš„ç—…æ¯’å°†è¿™ä¸ªä½“åˆ¶çš„ä¸€ä¸ªé˜´æš—é¢æ­éœ²äº†å‡ºæ¥è€Œå·²ï¼Œå®ƒè…çƒ‚åˆ°æ ¹é‡Œå·²ç»å¾ˆä¹…å¾ˆä¹…â€¦â€¦</p><p>åœ¨ææƒä¸»ä¹‰ä½“åˆ¶ä¸‹ï¼Œå›½å®¶ä¸€æ–¹é¢ç”¨æ„è¯†å½¢æ€è›Šæƒ‘å’Œéº»é†‰äººæ°‘ï¼Œå¦ä¸€æ–¹é¢åˆç”¨åˆ©ç”¨å›½å®¶æœºå™¨é™åˆ¶ç¤¾ä¼šå†…éƒ¨çš„ç›´æ¥äº¤å¾€ï¼Œä½¿ä¹‹ä¿æŒæœ‰åˆ©äºå›½å®¶æ§åˆ¶çš„â€œåŸå­åŒ–â€çŠ¶æ€ã€‚åŸºäºå›½å®¶çš„ç»å¯¹æƒåŠ›å’Œæ•´ä¸ªç¤¾ä¼šçš„éç»“æ„åŒ–ï¼Œå›½å®¶èƒ½å¤Ÿæ ¹æ®è‡ªå·±çš„æ„å¿—å‘èµ·ä»»ä½•è¡ŒåŠ¨ï¼ŒåŒ…æ‹¬æ”¿æ²»æˆ–ç¤¾ä¼šè¿åŠ¨ã€‚è¿™æ¬¡çš„<code>ç–«æƒ…é˜²å«æˆ˜ç–«</code>ä¸å°±æ˜¯è¿™ä¸ªå®˜åƒšä½“åˆ¶å‘èµ·çš„æ”¿æ²»è¿åŠ¨å˜›ï¼Ÿæ„ŸæŸ“æ­»äº¡äººæ•°ä½œå‡ï¼Œå…¬ä¿¡åŠ›ä¸æ–­åœ°ä¸§å¤±ã€‚ä½ èƒ½åœ¨è¿™æœ¬ä¹¦é‡Œæ‰¾åˆ°å¾ˆå¥½çš„è§£é‡Šï¼Œä¹¦ä¸­ä¹Ÿæåˆ°è¿‡ä¸Šçº§æ¥è§†å¯Ÿçš„æ—¶å€™ï¼Œåœ°æ–¹æ”¿åºœå¦‚ä½•å¿½æ‚ ä¸­å¤®ï¼Œä»¥åŠå„ç§æƒåˆ©å…³ç³»ä¹‹é—´å¦‚ä½•å…±è°‹è¾¾åˆ°<strong>ä¸Šæœ‰æ”¿ç­–ä¸‹æœ‰å¯¹ç­–çš„</strong>ã€‚</p><p>ã€å¡ç†æ–¯ç›æƒå¨çš„æ ¸å¿ƒæ˜¯ï¼Œé¢†è¢–ä»¥å…¶è¶…å‡¡ç¦€èµ‹è€Œå¾—åˆ°è¿½éšè€…çš„æ‹¥æˆ´å’Œæœä»ï¼›è€Œé¢†è¢–åˆ™é€šè¿‡ä¸æ–­åœ°åˆ›é€ â€œå¥‡è¿¹â€æ¥æ˜¾ç¤ºå…¶è¶…å‡¡ç¦€èµ‹ï¼Œä»¥å»¶ç»­å’Œå¼ºåŒ–è¿™ä¸€åˆæ³•æ€§åŸºç¡€ã€‚ åœ¨ç»è¿‡äº†æˆ˜äº‰åŠ¨è¡ï¼Œæ°‘ç”Ÿå‡‹æ•ï¼Œä¸§æƒè¾±å›½çš„æ°‘æ—å±æœºä¹‹åï¼Œä¸­å›½å¤§åœ°æœ‰æœŸå†€å¥‡è¿¹ã€å´‡å°šä¼Ÿäººçš„å¡ç†æ–¯ç›æƒå¨çš„è‚¥æ²ƒåœŸå£¤ã€‚ã€</p><p>ã€ä»»ä½•æŒ‘æˆ˜å¡ç†æ–¯ç›æƒå¨çš„è¯è¯­éƒ½ä¼šå¼±åŒ–ç”šè‡³ç“¦è§£å…¶åˆæ³•æ€§åŸºç¡€ï¼Œå› æ­¤è¯è¯­å„æ–­æƒæ˜¯ç»´ç³»å¡ç†æ–¯ç›æƒå¨çš„å…³é”®æ‰€åœ¨ã€‚å»ºå›½ä»¥åï¼Œå›½å®¶é€æ­¥é€šè¿‡å®˜åƒšä½“åˆ¶ä»‹å…¥ã€æ§åˆ¶ä»¥è‡³å„æ–­æ„è¯†å½¢æ€ç›¸å…³çš„é¢†åŸŸï¼Œæœ‰æ•ˆåœ°æœç»äº†è´¨ç–‘æˆ–æŒ‘æˆ˜å¡ç†æ–¯ç›æƒå¨çš„æ½œåœ¨å¯èƒ½æ€§ã€ è¿™ä¹Ÿæ˜¯è¨€è®ºå®¡æŸ¥çš„æ ¹æœ¬åŸå› å§ï¼Œç»´æŠ¤ç»Ÿæ²»è€…çš„æƒåŠ›åˆæ³•æ€§ã€‚</p><p>åœ¨æ”¿æ²»è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸éš¾çœ‹åˆ°åœ°æ–¹æ”¿åºœçš„å„ç§åšæ³•ï¼ˆå¦‚åœ¨æ‹†è¿ã€ä¸¥æ‰“ã€åŸç®¡ã€ä¿¡è®¿ç­‰ç­‰è¿‡ç¨‹ä¸­çš„å…·ä½“æ‰€ä¸ºï¼‰å¸¸å¸¸ä¸æ³•å¾‹æ¡æ–‡ç›¸æ‚–ã€‚åœ°æ–¹æ”¿åºœçš„è¿™äº›åšæ³•åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå¢å¼ºäº†åŸºå±‚æ”¿åºœè§£å†³å®é™…é—®é¢˜çš„èƒ½åŠ›ï¼Œä½†ä¸æ­¤åŒæ—¶ï¼Œå®ƒä»¬ä¸æ–­åœ°ä¾µèš€å¼±åŒ–æ³•æ²»åŸºç¡€å’Œæ³•ç†è§‚å¿µã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/tl1mmh7z3t" target="_blank" rel="noopener">ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶</a></p><h3 id="å›½å®¶å»ºè®¾ä¸æ”¿åºœè¡Œä¸º"><a href="#å›½å®¶å»ºè®¾ä¸æ”¿åºœè¡Œä¸º" class="headerlink" title="å›½å®¶å»ºè®¾ä¸æ”¿åºœè¡Œä¸º"></a>å›½å®¶å»ºè®¾ä¸æ”¿åºœè¡Œä¸º</h3><p>è¯»å®Œã€Šä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶ã€‹ååœ¨ Amazon ä¸Šæœç´¢å‘¨é›ªå…‰ä½œè€…æ‰¾åˆ°çš„ä¹¦ã€‚ä¸å…¶è¯´æ˜¯ä¸€æœ¬ä¹¦ï¼Œå…¶å®æ›´åƒæ˜¯ä¸€å†Œç ”ç©¶ä¸­å›½å®˜åƒšä½“åˆ¶çš„è®ºæ–‡é›†ï¼Œä»å­¦æœ¯è§’åº¦æ¥åˆ†æä¸€äº›ä½“åˆ¶é—®é¢˜ã€‚</p><blockquote><p>ä½œä¸ºæ‰€æœ‰æƒåŠ›é›†äºä¸€èº«çš„ä¸­å¤®æ”¿åºœï¼Œä¸»è¦éœ€è¦å®Œæˆä¸¤é¡¹åŸºæœ¬ä»»åŠ¡ï¼šä¸€æ˜¯ä¸ºå¹¿å¤§ç™¾å§“æä¾›åŸºæœ¬çš„å…¬å…±æœåŠ¡ï¼Œç»´æŒæ”¿æƒçš„é•¿æœŸç¨³å®šï¼›äºŒæ˜¯ä¿è¯ä¸‹æ”¾ç»™è¡Œæ”¿ä»£ç†äººçš„æƒåŠ›ä¸è¢«æ»¥ç”¨ï¼Œä¸­å¤®çš„æ”¿ä»¤èƒ½å¤Ÿç•…é€šæ— é˜»ã€‚è¿™ä¸¤é¡¹ä»»åŠ¡æœ¬è´¨ä¸Šæ˜¯å†²çªçš„ï¼šä¸€æ–¹é¢ï¼Œä¸ºäº†ç»™å¹¿å¤§ç™¾å§“æ›´å¥½åœ°æä¾›å…¬å…±æœåŠ¡ï¼Œå°±å¿…é¡»å°½å¯èƒ½æŠŠæƒåŠ›ä¸‹æ”¾ç»™åŸºå±‚æ”¿åºœï¼Œå› ä¸ºåŸºå±‚æ”¿åºœç›¸å¯¹æ¥è¯´æ›´äº†è§£å½“åœ°æ°‘ä¼—å¯¹å…¬å…±æœåŠ¡çš„åå¥½ï¼Œæ›´äº†è§£å½“åœ°çš„å…·ä½“æ¡ä»¶ï¼›ä»å…¬å…±æœåŠ¡çš„è§’åº¦ï¼Œé›†æƒè€…åº”è¯¥å°½å¯èƒ½é€‰æ‹©åˆ†æƒã€‚å¦ä¸€æ–¹é¢ï¼Œç»™å®šä¸‹çº§æ”¿åºœçš„å®˜å‘˜ç›®æ ‡å’Œåˆ©ç›Šä¸åŒäºä¸­å¤®æ”¿åºœï¼Œä¸‹çº§å®˜å‘˜çš„è¡Œä¸ºä¸æ˜“ç›‘ç£ï¼ŒæƒåŠ›ä¸‹æ”¾å°±æ„å‘³ç€æƒåŠ›è¢«æ»¥ç”¨çš„å±é™©ï¼Œç”šè‡³è¢«æ¶ç©ºï¼Œè€Œä¸”æƒåŠ›ä¸‹æ”¾è¶Šæ˜¯åˆ°åŸºå±‚ï¼Œç›‘ç£å°±è¶Šå›°éš¾ï¼ŒæƒåŠ›è¢«æ»¥ç”¨çš„å¨èƒä¹Ÿå°±è¶Šå¤§ã€‚</p><p>å½“æ”¿åºœé»˜è®¸æˆ–é¼“åŠ±ä¸‹çº§æ”¿åºœå› åœ°åˆ¶å®œæ—¶ï¼Œåè€…å¯èƒ½æŒ‰è‡ªå·±æ„å›¾è§£è¯»å®æ–½æ”¿ç­–ï¼Œéšç€æ”¿ç­–å®æ–½è¿‡ç¨‹çš„å±•å¼€ï¼Œæ‰§è¡Œçµæ´»æ€§è¶Šæ¥è¶Šå¤§ï¼Œä¸è¿™ä¸€ä¸»çº¿çš„åå·®è·ç¦»è¶Šæ¥è¶Šå¤§ï¼Œå¯¼è‡´ä¸åŸæ”¿ç­–ç›¸å»ç”šè¿œçš„ç»“æœã€‚</p></blockquote><p>ç»“åˆè¿™æ¬¡ç–«æƒ…ï¼Œä¸éš¾ç†è§£ä¸ºä»€ä¹ˆåœ°æ–¹æ”¿åºœæ“…è‡ªå°è·¯å°åŸçš„ä¸¾æªï¼Œå³ä¾¿è¿™äº›ä¸¾æªå·²ç»æ˜æ˜¾åœ°è¿åäº†æ³•å¾‹ï¼ˆå›½åŠ¡é™¢é¢å¸ƒçš„è§„å®šï¼‰ï¼Œå³ä¾¿æ˜¯å› ä¸ºå°è·¯è€Œé€ æˆäººå‘˜æ„å¤–èº«äº¡ï¼Œå³ä¾¿æ˜¯ä¸€å®¶å››å£åœ¨å®¶æ‰“éº»å°†ä¹Ÿè¦è¢«æ‹‰ä¸Šè¡—è¢«<code>æ‰¹æ–—</code>â€¦â€¦ä¸­å¤®æ”¿åºœä¹Ÿä¸ä¼šå¤„ç½šåœ°æ–¹æ”¿åºœã€‚åœ¨è¿™æ¬¡ç–«æƒ…ä¸­ï¼Œåœ°æ–¹æ”¿åºœçš„ä¸€äº›è¡Œä¸ºå·²ç»è¿åäº†å®ªæ³•ï¼Œç®€ç§°è¿å®ªè¡Œä¸ºï¼Œè€Œæ‰€è°“çš„<code>çº¢è¢–ç« </code>ä»—ç€ç‚¹æ‰‹ä¸­çš„ç‰¹æƒè‚†æ„ä¾µçŠ¯ç€å…¬æ°‘çš„æƒåŠ›ã€‚å°±å¦‚å‰©ä½™ä»·å€¼è¢«å°æ€çš„é‚£æœŸä¸­ç½—æ–°è€å¸ˆæåˆ°çš„ï¼š</p><blockquote><p>æˆ‘ä»¬ç°åœ¨å¬å¾ˆå¤šäººå¤§è°ˆ<strong>æˆ˜æ—¶çŠ¶æ€</strong>ï¼Œä½†éšä¾¿ä¸€ä¸ªè¡Œæ”¿å®˜å‘˜å°±èƒ½å¤Ÿå®£å¸ƒâ€æˆ˜æ—¶çŠ¶æ€â€å—ï¼Ÿè¿™å¿…é¡»æ˜¯è¦ç»è¿‡æœ€é«˜ç«‹æ³•æœºæ„å†³å®šçš„ã€‚å°åŸæˆ–è€…è¯¸å¦‚æ­¤ç±»çš„æç«¯æªæ–½å¸¦æ¥çš„ä¼¤å®³ï¼Œä¸€å®šä¼šæ¯”ç—…æ¯’æœ¬èº«è¿˜è¦å¤§ã€‚</p></blockquote><p><code>æ‘˜æŠ„</code> <a href="https://t.co/7oYY1ZTdAL" target="_blank" rel="noopener">å›½å®¶å»ºè®¾ä¸æ”¿åºœè¡Œä¸º</a></p><h3 id="æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—æœé²œäººæ°‘çš„çœŸå®ç”Ÿæ´»"><a href="#æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—æœé²œäººæ°‘çš„çœŸå®ç”Ÿæ´»" class="headerlink" title="æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—æœé²œäººæ°‘çš„çœŸå®ç”Ÿæ´»"></a>æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—æœé²œäººæ°‘çš„çœŸå®ç”Ÿæ´»</h3><p>è¯»å®Œè¿™æœ¬ä¹¦å°±æ„Ÿè§‰åˆ°å½“ä»Šçš„æœé²œå°±å¦‚ä¸Šä¸–çºªçš„ä¸­å›½<strong>åå¹´æ–‡é©åŸºç¡€ä¸Šå†åŠ ä¸Šä¸‰å¹´å¤§é¥¥è’</strong>ä¸€æ ·æ‚²æƒ¨ï¼Œè¿™ç§çºªå®ç±»çš„å†™ä½œå’Œã€Šåˆ‡å°”è¯ºè´åˆ©çš„æ‚²é¸£ã€‹ä»¥åŠã€Šåä¸ªäººçš„ä¸€ç™¾å¹´ã€‹ä¸€æ ·ï¼Œæ²‰é‡çš„å†å²æ„Ÿã€‚æˆ‘ä»¬éƒ½æ˜¯è¢«å…±äº§ä¸»ä¹‰çš„ææƒä¸“åˆ¶ç‹¬è£æš´æ”¿ç»Ÿæ²»è¹‚èºè¿‡çš„æ°‘æ—ï¼Œæ„ŸåŒèº«å—çš„å†å²è®°å¿†ï¼Œå½·ä½›å°±åœ¨æ˜ å°„ç€å½“ä¸‹ä¸€æ ·ï¼Œè®©äººæœ‰ç§èº«åœ¨å†å²ä¸­æ„Ÿå—å®ƒçš„å­˜åœ¨ä¸€æ ·ã€‚çœ‹çœ‹ä¸‹é¢è¿™å‡ æ®µæ‘˜æŠ„ï¼Œå’Œæ–‡é©æ—¶æœŸçš„æˆ‘ä»¬ä»¥åŠå½“ä¸‹çš„æˆ‘ä»¬åˆæ˜¯ä½•å…¶çš„ç›¸ä¼¼ï¼š</p><blockquote><p>  ç”±äºåŒ—éŸ©å¤ªè´«å›°ï¼Œç”µåŠ›ä¾›åº”ä¸è¶³ä»¥ç»´æŒç”µå­ç›‘æ§ï¼Œæ‰€ä»¥å›½å®¶å®‰å…¨å¿…é¡»ä»°èµ–äººåŠ›æƒ…æŠ¥â€”â€”å‘Šå¯†ã€‚æŠ¥çº¸å¶å°”ä¼šå‡ºç°æ–‡æƒ…å¹¶èŒ‚çš„æŠ¥å¯¼ï¼Œæè¿°å‹‡æ•¢çš„å­©å­çº ä¸¾çˆ¶æ¯çš„è¿æ³•è¡Œä¸ºã€‚ç”±æ­¤çœ‹æ¥ï¼Œå› å‘è¡¨å¯¹å½“å±€ä¸æ»¡çš„è¨€è®ºè€Œè¢«é‚»å±…å‘Šå‘ä¹Ÿå°±ä¸è§‰å¾—å¥‡æ€ªäº†ã€‚</p></blockquote><blockquote><p>  åŒ—éŸ©äººå­¦ä¼šåä¸‹è‡ªå·±çš„è‡ªå°Šä¸æä½è‡ªå·±çš„é¼»å­ã€‚ä»–ä»¬ä»å†œæ‘åŠ¨ç‰©çš„æ’æ³„ç‰©ä¸­æŒ‘å‡ºæ¥æœªè¢«æ¶ˆåŒ–çš„ç‰ç±³ç²’ã€‚èˆ¹å‚å·¥äººå‘å±•å¤„ä¸€ç§æŠ€æœ¯ï¼ŒåŸæœ¬å‚¨å­˜ç²®é£Ÿçš„è´§ä»“åº•éƒ¨æ®‹ç•™ç€è…è‡­é»è…»çš„ä¸œè¥¿ï¼Œä»–ä»¬å°†è¿™äº›ä¸œè¥¿åˆ®èµ·äº†ï¼Œæ”¾åœ¨åœ°é¢æ™¾å¹²ï¼Œä»ä¸­å¯ä»¥æ‹¾å–ä¸€ç‚¹æœªçƒ¹ç…®è¿‡çš„ç¨»ç±³ä¸å…¶ä»–å¯é£Ÿç”¨çš„è°·ç‰©ã€‚</p></blockquote><blockquote><p>  å­©å­ç¡è§‰æ—¶è¦æé˜²å…¶ä»–å¸®æ´¾å·èµ°ä»–ä»¬çš„å°‘è®¸ä½™ç²®ã€‚æ­¤å¤–ä¹Ÿæµä¼ ç€è®¸å¤šè¯¡å¼‚çš„æ•…äº‹ï¼Œæåˆ°æˆå¹´äººæŠŠå­©å­å½“æˆçŒç‰©ã€‚ä¸åªç”¨æ¥å‘æ³„æ€§æ¬²ï¼Œä¹Ÿå½“æˆé£Ÿç‰©ã€‚é‡‘èµ«å¬è¯´æœ‰äººå¯¹å­©å­ä¸‹æ¯’ï¼Œæ€æ­»å­©å­ï¼Œå¤§å¸å…«å—åƒä¸‹è‚šã€‚åœ¨ç«è½¦ç«™åé¢ï¼Œé è¿‘é“é“è¾¹ï¼Œæœ‰äº›å°è´©åœ¨å°ç«ç‚‰ä¸Šç…®æ±¤ç…®é¢ï¼Œæ®è¯´æµ®åœ¨ä¸Šé¢çš„ç°è‰²è‚‰å—å°±æ˜¯äººè‚‰ã€‚</p></blockquote><blockquote><p>  å„çº§ç£å¯¼ä¾‹è¡Œæ€§åœ°æé€ å†œä¸šç”Ÿäº§ä¸å·¥ä¸šäº§å‡ºçš„ç»Ÿè®¡æ•°æ®ï¼Œå› ä¸ºä»–ä»¬ä¸æ•¢å‘Šè¯‰é•¿å®˜å®æƒ…ã€‚ä¸ºäº†åœ†è°ï¼Œåªå¥½è¯´æ›´å¤šçš„è°ï¼Œä»åŸºå±‚ä¼ è¾¾åˆ°é«˜å±‚çš„è®¯æ¯æ²¡æœ‰ä¸€ä»¶æ˜¯çœŸçš„ï¼Œæ‰€ä»¥å¯ä»¥æƒ³è§é‡‘æ—¥æˆæœ¬äººææ€•å®Œå…¨ä¸çŸ¥é“ç»æµçš„çŠ¶å†µæœ‰å¤šç³Ÿã€‚</p></blockquote><p>çœ‹å®Œè¿™æœ¬ä¹¦ä¹Ÿå¯ä»¥å»çœ‹å¦å¤–ä¸€æœ¬ä¹¦ã€Šé»„é•¿çƒ¨å›å¿†å½•ã€‹</p><blockquote><p>  æˆ‘åœ¨ä¸€ä¸ªå……æ»¡äº†è™šä¼ªå’Œæ¬ºéª—çš„ç¤¾ä¼šç”Ÿæ´»äº†å¾ˆä¹…ï¼Œä¸€å¼€å§‹æˆ‘ä»¥ä¸ºè™šä¼ªå’Œæ¬ºéª—æ˜¯ä¸ºäº†è§£æ”¾å‹¤åŠ³çš„äººæ°‘å¤§ä¼—ï¼Œå³ä¸ºäº†å–å¾—ä¸å‰¥å‰Šé˜¶çº§æ–—äº‰çš„èƒœåˆ©è€Œå¿…é¡»é‡‡ç”¨çš„æ‰‹æ®µã€‚ ä½†æ˜¯ï¼Œåæ¥æˆ‘æ„è¯†åˆ°ï¼Œè™šä¼ªä¸æ¬ºéª—å·²ç»ä¸ç‹¬è£è€…çš„åˆ©å·±ä¸»ä¹‰ç»“åˆèµ·æ¥ã€‚ç‹¬è£è€…çš„åˆ©å·±ä¸»ä¹‰é›†ä¸­ä½“ç°ä¸ºä¸ªäººå´‡æ‹œæ€æƒ³ï¼ŒåŒ—æœé²œæ˜¯å…¨ä¸–ç•Œä¸ªäººå´‡æ‹œå’Œé˜¶çº§ä¸»ä¹‰æœ€ä¸¥é‡çš„å›½å®¶ã€‚ æˆ‘èº«å¤„åŒ—æœé²œç»Ÿæ²»ä½“åˆ¶çš„ä¸­æ¢ï¼Œæ˜¯æ•´ä¸ªè™šä¼ªå®£ä¼ çš„åŠ¨å‘˜å’Œç»„ç»‡è€…ï¼ˆä½œè€…æ˜¯åŒ—æœé²œé©¬å…‹æ€ä¸»ä¹‰å’Œæ„è¯†å½¢æ€é¢†åŸŸçš„æƒå¨ï¼Œè¯‘è€…æ³¨ï¼‰ã€‚è™šä¼ªæ›¾ç»ä¸€åº¦å–ä»£çœŸç†å æ®ä¸€ä¸ªå­¦è€…çš„è‰¯å¿ƒï¼Œä¸å­¦è€…çš„çµé­‚å¯¹ç«‹ã€‚ æˆ‘ï¼ˆåœ¨ä¹¦ä¸­ï¼‰ä¸ä¼šå› ä¸ºè®¨åŒæˆ‘å’Œè®©æˆ‘è®¨åŒçš„äººè€Œå¤¸å¤§ã€ä¸‘åŒ–äº‹å®ï¼Œä¹Ÿä¸ä¼šå› ä¸ºçˆ±æˆ‘å’Œè®©æˆ‘çˆ±çš„äººè€Œæ¯«æ— åŸåˆ™çš„ç¾åŒ–ç°å®ã€‚ å†å²å°±æ‘†åœ¨é‚£é‡Œï¼Œå¯¹å†å²æ¥è¯´ï¼Œæ­ªæ›²æ˜¯æœ€å¤§çš„çŠ¯ç½ªã€‚æˆ‘ä¸è®¤ä¸ºæˆ‘è¯´çš„å°±æ˜¯ç»å¯¹ï¼ˆæ­£ç¡®ï¼‰ï¼Œæˆ‘åå€’æ›´å¸Œæœ›è¯»è€…å¸¦ç€æ‰¹åˆ¤çš„æ€åº¦æ¥é˜…è¯»æœ¬ä¹¦ã€‚ å¯¹äºä¸å¤§ä¼—åˆ©ç›Šæ¯«æ— å…³ç³»çš„ä¸ªäººç”Ÿæ´»ï¼Œæˆ–è€…æœ‰å¹²æ¶‰å®ƒå›½å†…æ”¿ä¹‹å«Œçš„è¨€è®ºï¼Œæˆ‘ä¼šå°½é‡é¿å…ã€‚æ¥åˆ°éŸ©å›½ä¹‹åï¼Œæˆ‘åœ¨åŠªåŠ›å­¦ä¹ æ–°äº‹ç‰©ï¼Œå¼€å§‹æ–°çš„ä½“éªŒã€‚ ä½†æ˜¯ï¼Œæˆ‘å·²ç»è€äº†ï¼Œå­¦åˆ°çš„æ–°çŸ¥è¯†å’Œæ–°ç»éªŒå¯¹æˆ‘æ€è€ƒæ–¹æ³•çš„å½±å“æœ‰é™ã€‚åœ¨æœ¬ä¹¦ä¸­ï¼Œæˆ‘è¿˜æ˜¯æƒ³å°†åœ¨åŒ—æœé²œç»å†è¿‡çš„ã€ä½“éªŒè¿‡çš„å†™å‡ºæ¥ã€‚</p></blockquote><p>æ‘˜æŠ„<a href="https://t.co/LWaF4VeGVq" target="_blank" rel="noopener">æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—æœé²œäººæ°‘çš„çœŸå®ç”Ÿæ´»</a></p><h3 id="å“ˆç»´å°”æ–‡é›†"><a href="#å“ˆç»´å°”æ–‡é›†" class="headerlink" title="å“ˆç»´å°”æ–‡é›†"></a>å“ˆç»´å°”æ–‡é›†</h3><p>ä¸‰æœˆä»½åœ¨è¯»ã€Šæˆ‘æ— ç½ªï¼šåˆ˜æ™“æ³¢ä¼ ã€‹çš„æ—¶å€™æ„å¤–æ”¶è·åˆ°çš„è¿™æœ¬ä¹¦ã€‚è¿™æœ¬ä¹¦å¹¶æ²¡æœ‰åœ¨å¤§é™†å…¬å¼€å‡ºç‰ˆï¼Œåªèƒ½æ‰¾åˆ°ä¸€ç‚¹ç”µå­ç‰ˆçš„æ¥çœ‹ã€‚æœ¬ä¹¦çš„ä½œè€…æ˜¯å“ˆç»´å°”ï¼Œå¤§é™†çš„è¯‘è€…æ˜¯å´”å«å¹³ã€‚å…ˆè¯´ä¸€ä¸‹ä½œè€…å“ˆç»´å°”ï¼Œä»–æ˜¯ä¸œæ¬§äººæ°‘æˆ˜èƒœå…±äº§ä¸»ä¹‰ä¹‹åï¼Œ1989å¹´12æœˆå½“é€‰çš„æ€»ç»Ÿã€‚åœ¨ä»–ä¸»æŒä¸‹ï¼Œæ·å…‹å’Œæ–¯æ´›ä¼å…‹å’Œå¹³åˆ†ç¦»ï¼Œä»–åˆå½“é€‰ä¸ºæ·å…‹å…±å’Œå›½é¦–ä»»æ€»ç»Ÿï¼Œç›´åˆ°2003å¹´è¿ä»»æœŸæ»¡ï¼Œæ‰å¸ä»»æ€»ç»ŸèŒåŠ¡ã€‚</p><p>ä½œä¸ºä¸€ä½æˆå‰§å®¶ã€ä½œå®¶å’Œå“²å­¦å®¶ï¼Œä»–æ˜¯è‘—åã€Šä¸ƒä¸ƒå®ªç« ã€‹è¿åŠ¨çš„å‘èµ·è€…å’Œæœ€æ—©çš„å‘è¨€äººä¹‹ä¸€ï¼Œä»–çš„æ€æƒ³æ·±åˆ»åœ°å½±å“äº†ä¸­å›½è‡ªç”±çŸ¥è¯†ç•Œã€‚1998å¹´ä¸€æ‰¹ä¸­å›½çš„è‡ªç”±çŸ¥è¯†åˆ†å­ï¼Œè¦å‡ºç‰ˆã€Šå“ˆç»´å°”æ–‡é›†ã€‹ï¼Œå…«ä¹æ°‘ä¸»è¿åŠ¨ä¸­â€œä¸åœ¨æªå£ä¸‹åšå®˜â€çš„å‰ä¸­å›½ç¤¾ä¼šç§‘å­¦é™¢å‰¯é™¢é•¿ <a href="https://zh.wikipedia.org/wiki/%E6%9D%8E%E6%85%8E%E4%B9%8B" target="_blank" rel="noopener">ææ…ä¹‹</a>ï¼Œä¸ºè¯¥ä¹¦å†™äº†åºâ€”â€”<a href="http://www.aisixiang.com/data/1724.html" target="_blank" rel="noopener">ã€Šæ— æƒè€…çš„æƒåŠ›å’Œåæ”¿æ²»çš„æ”¿æ²»ï¼šåææƒä¸»ä¹‰æ—¶ä»£çš„äººç”Ÿå“²å­¦ã€‹</a>ã€‚</p><p>ææ…ä¹‹ç§°å“ˆç»´å°”æ˜¯â€œæˆ‘ä»¬æ—¶ä»£æ°å‡ºçš„æ€æƒ³å®¶â€ã€‚ å“ˆç»´å°”æå‡ºâ€œæ— æƒè€…çš„æƒåˆ©â€çš„å“²å­¦å‘½é¢˜ï¼Œæ­ç¤ºäº†â€œ<strong>å› ä¸ºææƒ§ï¼Œæ•´ä¸ªç¤¾ä¼šçš„è°è¨€æœ‰äº†æœ€ç°å®ä¹Ÿæœ€å¦¥å½“çš„ç†ç”±ï¼Œå…¶ç»“æœå°±æ˜¯è´£ä»»æ„Ÿï¼Œå¯¹è‡ªå·±çš„è‰¯çŸ¥çš„è´£ä»»æ„Ÿï¼Œå¯¹ç¤¾ä¼šæ­£ä¹‰çš„è´£ä»»æ„Ÿçš„ä¸§å¤±</strong>ã€‚â€ææ…ä¹‹è®¤ä¸ºå“ˆç»´å°”çš„è¿™ä¸€å­¦è¯´â€œè‡³ä»Šä»æ—§æ˜¯å¯¹ææƒåˆ¶åº¦æœ€æ·±åˆ»çš„æ‰¹åˆ¤ã€‚â€å“ˆç»´å°”å‘åŠ¨çš„ã€Šä¸ƒä¸ƒå®ªç« ã€‹è¿åŠ¨ï¼Œå°±æ˜¯å…¬æ°‘è¡Œä½¿è‡ªå·±çš„æƒåˆ©ï¼Œæ•¢äºè®²çœŸè¯çš„è¿åŠ¨ã€‚ææ…ä¹‹ç§°èµå“ˆç»´å°”ï¼šâ€œä»–æœ€å¤§çš„åŠŸç»©å°±åœ¨äºæ•™å¯¼äººä»¬å¦‚ä½•åœ¨åææƒä¸»ä¹‰ç¤¾ä¼šå°Šä¸¥åœ°ç”Ÿæ´»ï¼Œåšä¸€ä¸ªçœŸæ­£çš„äººã€‚â€</p><blockquote><p>  å› ä¸ºææƒ§ã€‚æ¯ä¸ªäººéƒ½æœ‰ä¸œè¥¿å¯ä»¥å¤±å»ï¼Œå› æ­¤æ¯ä¸ªäººéƒ½æœ‰ç†ç”±ææƒ§ï¼šâ€œå› ä¸ºå®³æ€•å¤±å»è‡ªå·±çš„å·¥ä½œã€‚ä¸­å­¦è€å¸ˆè®²æˆä»–è‡ªå·±å¹¶ä¸ç›¸ä¿¡çš„ä¸œè¥¿ï¼Œå› ä¸ºæ€•è‡ªå·±çš„å‰é€”ä¸ç¨³ï¼›å­¦ç”Ÿè·Ÿåœ¨è€å¸ˆåé¢é‡å¤ä»–çš„è¯ï¼Œå› ä¸ºæ€•è‡ªå·±ä¸è¢«å…è®¸ç»§ç»­å­¦ä¸šï¼›é’å¹´äººåŠ å…¥å…±é’å›¢ï¼Œå‚åŠ ä¸è®ºæ˜¯å¦å¿…è¦çš„æ´»åŠ¨ã€‚åœ¨è¿™ç§ç•¸å½¢çš„åˆ¶åº¦ä¸‹ï¼Œå› ä¸ºææƒ§è‡ªå·±çš„å„¿å­æˆ–å¥³å„¿æ— æ³•åœ¨å­¦æ ¡é‡Œå–å¾—å¿…è¦çš„å‡å­¦æ€»åˆ†ï¼Œä½¿å¾—çˆ¶äº²é‡‡ç”¨â€˜è‡ªæ„¿â€™çš„æ–¹å¼å»åšæ¯ä¸€ä»¶è¢«è¦æ±‚çš„äº‹ã€‚ææƒ§çš„ç»“æœï¼Œå¯¼è‡´äººä»¬å‚åŠ é€‰ä¸¾ã€ç»™æ¨èå‡ºæ¥çš„å€™é€‰äººæŠ•ç¥¨ï¼Œå¹¶ä¸”å‡è£…ä»–ä»¬è®¤ä¸ºè¿™ç§å½¢åŒè™šè®¾çš„èµ°è¿‡åœºæ˜¯çœŸæ­£çš„é€‰ä¸¾ã€‚å‡ºäºå¯¹ç”Ÿè®¡ã€åœ°ä½æˆ–è€…å‰ç¨‹çš„ææƒ§ï¼Œä»–ä»¬æŠ•ç¥¨èµæˆæ¯ä¸€é¡¹å†³è®®ï¼Œæˆ–è€…è‡³å°‘ä¿æŒæ²‰é»˜â€¦â€¦ã€‚â€</p><p>  æ€æ ·æ‰èƒ½æ‰“ç ´è¿™ç§å› å¤„äºææƒ§ä¹‹ä¸­è€Œå‡­å€Ÿè°è¨€ç”Ÿæ´»çš„ç°å®å‘¢?å“ˆç»´å°”çš„ç­”æ¡ˆååˆ†ç®€å•ï¼Œå³â€œåœ¨çœŸå®ä¸­ç”Ÿæ´»â€ï¼Œæˆ–æ›°â€œåœ¨çœŸç†ä¸­ç”Ÿæ´»â€ï¼Œè‹±æ–‡æ˜¯Living in Truth!è¿™å¥è¯çœ‹èµ·æ¥å¤ªç†æƒ³ã€å¤ªè™šæ— é£˜æ¸ºï¼Œä½†æ˜¯æˆ‘å€’ä¹Ÿä¸æƒ³å»ºè®®è¯‘è€…æ”¹å˜è¯‘æ–‡ï¼Œå› ä¸ºå¦‚æœç”¨å¤§ç™½è¯æ¥è¯´ï¼Œå®ƒæ— éæ˜¯æŒ‡â€œè¿‡è¯´çœŸè¯çš„æ—¥å­â€æˆ–è€…æ˜¯â€œç”Ÿæ´»åœ¨çœŸè¯ä¸­â€ã€â€œåšä¸€ä¸ªè¯´çœŸè¯çš„äººâ€è€Œå·²ã€‚</p></blockquote><p>æ‘˜æŠ„<a href="https://t.co/3yjW5T3OW4" target="_blank" rel="noopener">å“ˆç»´å°”æ–‡é›†</a></p><h3 id="å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ"><a href="#å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ" class="headerlink" title="å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ"></a>å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ</h3><p>åœ¨äºŒæœˆä»½çš„æ—¶å€™å‰©ä½™ä»·å€¼é‡Œçš„ä¸€æœŸèŠ‚ç›®ä¸­æåˆ°è¿‡ã€Šå¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆã€‹ã€‚æœ¬ä¹¦é€šè¿‡å†·æˆ˜æ—¶æœŸåŒˆç‰™åˆ©ç§˜å¯†è­¦å¯Ÿé•¿è¾¾20å¹´çš„æ¡£æ¡ˆï¼Œæ‰€æ­å¼€çš„æ˜¯ä¸€éƒ¨éšè—äº†å‡ åå¹´çš„å®¶åº­å†å²å’Œæ—¶ä»£ä¾§è®°ã€‚</p><p>å†·æˆ˜æ—¶æœŸï¼Œè‹è”é›†å›¢ä¸­çš„åŒˆç‰™åˆ©ï¼Œç§˜å¯†è­¦å¯Ÿé€šè¿‡åºå¤§çš„å‘Šå¯†ç½‘ï¼Œè¯•å›¾å…¨é¢æ¸—é€æ§åˆ¶åŒˆç‰™åˆ©çš„æ”¿æ²»ç”Ÿæ´»ã€‚ä½œè€…çš„çˆ¶æ¯åŸæ˜¯åŒˆç‰™åˆ©è‘—åè®°è€…ï¼Œä»–ä»¬çš„æŠ¥é“æ˜¯è¥¿æ–¹äº†è§£åŒˆç‰™åˆ©çš„é‡è¦ä¿¡æ¯æ¥æºã€‚å› æ­¤ä»–ä»¬è¢«è§†ä¸ºâ€œäººæ°‘çš„æ•Œäººâ€ï¼Œé•¿æœŸå—ç§˜å¯†è­¦å¯Ÿçš„ç›‘æ§ï¼Œç»ˆå› å›å›½å’Œé—´è°ç½ªè€Œå…ˆåå…¥ç‹±ã€‚ä¸€å®¶ç§»å±…ç¾å›½åï¼ŒåŒˆç‰™åˆ©æ”¿åºœå´åˆå¼‚æƒ³å¤©å¼€åœ°è¯•å›¾æ‹›å‹Ÿä»–ä»¬å½“é—´è°ï¼Œè€Œç¾å›½ä¹Ÿå¯¹ä»–ä»¬è¿›è¡Œäº†å‡ å¹´çš„ç›‘æ§ã€‚ä¹¦ä¸­ä¸åªè¿˜åŸäº†é©¬é¡¿å¤«å¦‡è¢«å‘Šå¯†è€…åŒ…å›´çš„ç»å†å’Œé­é‡ï¼Œä»–ä»¬çš„æŠ—äº‰ã€åšå®ˆã€è„†å¼±å’Œå‹‡æ°”ï¼Œä¹Ÿå±•ç°äº†ä»–ä»¬æƒ…æ„Ÿå’Œå†…å¿ƒçš„çŸ›ç›¾â€”â€”å¤«å¦»ä¹‹é—´ç›¸äº’çš„æ„Ÿæƒ…èƒŒå›ä¸ç¾éš¾ä¸­çš„æ”¯æ’‘ï¼Œçˆ¶æ¯å­å¥³ä¹‹é—´çš„çˆ±ä¸äº²æƒ…ï¼Œäººæ€§çš„åšå¼ºä¸è½¯å¼±ï¼Œä»è€Œä½¿å¾—è¿™æœ¬ä¹¦æ›´ä¸ºä¸°å¯Œã€å¤æ‚ï¼Œå…·æœ‰è¡€è‚‰ã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯è¿™æœ¬ä¹¦ï¼Œè€Œè¿™æœ¬ä¹¦çš„åºè¨€æ­£æ˜¯å¾è´²è€å¸ˆå†™çš„ã€‚</p><blockquote><p>  è¿™ç§ç»Ÿæ²»ä¸‹çš„ææƒ§ã€å±ˆè¾±ã€å‹æŠ‘å’Œç»æœ›ï¼Œè¿™æ ·çš„è‹¦éš¾è®©ç†¬è¿‡æ¥çš„å’Œè¿˜æœªç†¬è¿‡æ¥çš„äººä»¬éƒ½æ›´åŠ æœŸå¾…ä¸€ä¸ªèƒ½è®©æ‰€æœ‰äººè‡ªç”±ã€å¹³ç­‰ã€æœ‰å°Šä¸¥çš„ç”Ÿæ´»ä¸–ç•Œï¼Œä¹Ÿæ›´åŠ æœŸå¾…ä¸€ç§äººä¸äººèƒ½å¤Ÿå½¼æ­¤ä¿¡ä»»ï¼Œè€Œä¸æ˜¯ç›¸äº’èƒŒå›ã€å‡ºå–çš„ç”Ÿå­˜æ–¹å¼ã€‚è¿™ç§æœŸå¾…ä¸­åŒ…å«ç€å¯¹äººç±»æœªæ¥çš„å¸Œæœ›ï¼Œã€Šå¸ƒè¾¾ä½©æ–¯å¾€äº‹ã€‹ä¹‹æ‰€ä»¥æ„Ÿäººï¼Œæ­£æ˜¯å› ä¸ºå®ƒä¼ é€’äº†è¿™æ ·çš„å¸Œæœ›è®¯æ¯ã€‚</p></blockquote><p>æ‘˜æŠ„ <a href="https://t.co/NmRoJATcau" target="_blank" rel="noopener">å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ</a></p><h3 id="äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†"><a href="#äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†" class="headerlink" title="äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†"></a>äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†</h3><p>ä¹‹å‰æˆ‘ä¹Ÿè¯»è¿‡å¾è´²çš„è®ºæ–‡ <a href="https://matters.news/@philosophia1979/å¾è´²-ä¸­å›½çš„-æ–°ææƒä¸»ä¹‰-åŠå…¶æœ«ä¸–æ™¯è±¡-é‡å…½èè¯»-bafyreiegbg5tti3ljc7newaah5wp36ncf7fvb2oaovd6p7elc4xqfhbcd4" target="_blank" rel="noopener">ã€Šä¸­å›½çš„â€œæ–°ææƒä¸»ä¹‰â€åŠå…¶æœ«ä¸–æ™¯è±¡ã€‹</a>) ï¼Œæ‰€ä»¥å¯¹ä»–å…³æ³¨çš„å†…å®¹ä¹Ÿæœ‰æ‰€äº†è§£ã€‚æ€»æ„Ÿè§‰è¿™æœ¬ä¹¦æ›´åƒæ˜¯é˜¿ä¼¦ç‰¹ã€åŠ ç¼ªã€è¨ç‰¹ã€å“ˆç»´å°”ç­‰äººå¯¹äºææƒä¸»ä¹‰è‘—ä½œåŠæ€æƒ³çš„è§£æã€‚å°±åƒåœ¨å‰©ä½™ä»·å€¼é‡Œæåˆ°çš„ï¼Œæˆ‘ä»¬è¯»è¿™äº›å†å²çš„æ—¶å€™ï¼Œè€Œå½“ä¸‹å°±ä»¿ä½›ç½®èº«äºå†å²ä¹‹ä¸­ä¸€æ ·ã€‚ä¹¦ä¸­è®°å½•è‹è”å’Œçº³ç²¹å¾·å›½ææƒç»Ÿæ²»æ”¹é€ äººæ€§çš„è¨€è®ºå®¡æŸ¥ã€ç§˜å¯†è­¦å¯Ÿã€é›†ä¸­è¥ã€æ— è¨€è®ºè‡ªç”±å’Œæ–°é—»è‡ªç”±ã€å…šåª’æ„šæ°‘æ´—è„‘ç­‰ï¼Œè¿™äº›æè¿°ææƒç»Ÿæ²»çš„å†å²ï¼Œå†çœ‹ä¸€çœ‹å½“ä¸‹ï¼Œæˆ‘ä»¬ä¸æ­£ç½®èº«äºå…¶ä¸­å—ï¼Ÿ</p><ul><li><strong>æ¯”ç˜Ÿç–«æ›´å¯æ€•çš„æ˜¯è¬Šè¨€ï¼Œæ¯”ç½é›£æ›´å¯æ€•çš„æ˜¯éºå¿˜</strong></li></ul><blockquote><p>  <strong>å‰©ä½™ä»·å€¼ï¼š</strong> ææµ·é¹ä¹‹å‰å‘äº†ä¸€æ¡å¾®åšï¼Œå¤§æ¦‚æ˜¯è¯´ï¼Œä¸€ä¸ªä¸¾å›½ä½“åˆ¶çš„éšæ‚£åˆ°æœ€åå¯èƒ½åˆä¼šå˜æˆä¸€ä¸ªä¸¾å›½ä½“åˆ¶çš„èƒœåˆ©ã€‚</p><p>  <strong>ç½—æ–°ï¼š</strong>å†å²å­¦è€…è®¤ä¸ºï¼Œåœ¨è¥¿æ–¹ï¼Œä½ çœ‹åˆ°æ‰€æœ‰çš„æˆ˜äº‰ã€ç¾éš¾æ€§çš„é©å‘½æˆ–è€…æ˜¯ä½“åˆ¶æ€§çš„å´©æºƒï¼Œå…¶åæœå¯èƒ½æ˜¯å¼•èµ·äº†ä¸€æ³¢æ–°çš„å†å²ä¸Šå‡æœŸã€‚æ¯”å¦‚ç¾å›½åœ¨ç»æµå¤§è§æ¡ä¹‹åï¼Œç»æµåè€Œæœ‰æ‰€å›å‡ï¼Œåè€Œå¼€é€šäº†ä¸€æ¡å‘ä¸Šçˆ¬çš„æ–°çš„é“è·¯ã€‚ä½†æ˜¯ç ”ç©¶è€…ä¹Ÿå‘ç°ï¼Œåœ¨ä¸œæ–¹ä¸ä¸€å®šæ˜¯è¿™æ ·ï¼Œç¾éš¾ä¹‹åå¯èƒ½æ˜¯æ›´å¤§çš„ç¾éš¾ï¼Œæ›´å¤§çš„ç¾éš¾åé¢è¿˜æœ‰æ›´å¤§çš„ç¾éš¾ï¼Œå¼•å‘ç¾éš¾çš„é‚£äº›å› ç´ ä¸ä»…å¾—ä¸åˆ°ä¿®æ­£ï¼Œè¿˜å¾—åˆ°äº†åŠ å¼ºåŒ–ã€‚è¿™æ˜¯æˆ‘ä»¬è¦æ³¨æ„çš„ã€‚äººä»¬è¯´ï¼Œéƒ½å‘ç”Ÿäº†è¿™ä¹ˆå¤§çš„äº‹ï¼Œæˆ‘ä»¬è¯¥ä¸è¯¥åæ€äº†ï¼Ÿè¦å°å¿ƒï¼Œå¯èƒ½æ²¡æœ‰åæ€ï¼Œå¯èƒ½æ˜¯å¼ºåŒ–ã€‚</p></blockquote><p>ä¸€åœºç¾éš¾å˜æˆäº†ä¸€åœºä¸¾å›½ä½“åˆ¶çš„èƒœåˆ©ï¼Œæ˜¯æˆ‘ä»¬çš„æ‚²å“€ä¹Ÿæ˜¯å…¨ä¸–ç•Œè¢«æ–°å† ç—…æ¯’æŠ˜ç£¨äººçš„ä¸å¹¸ã€‚ä¸€äº›æ— è€»çš„äººä¸§å°½å¤©è‰¯è¿˜åœ¨å®£ä¼ ä»€ä¹ˆæ­£ç¡®çš„é›†ä½“è®°å¿†ï¼ŒæŠ—ç–«ä¸»æ—‹å¾‹ï¼Œå¥½å¤šäººçš„ç”Ÿå‘½å°±è¿™æ ·è¢«å®å¤§å™äº‹æŠ¹æ€æ‰äº†ã€‚</p><blockquote><p>  å› ä¸ºæŠ—ç–«å™äº‹ä¸èƒ½è¢«è°è¨€è¯¯å¯¼ç·æ±¡ï¼Œè€Œåº”ç•™ä¸‹æ­£ç¡®çš„äººç±»é›†ä½“è®°å¿†</p></blockquote><p><img src="https://p.k8s.li/image-20210106235706623.png" alt=""></p><p><img src="https://p.k8s.li/image-20210106235547786.png" alt=""></p><blockquote><p>  â€œå¯¹äºä¸€ä¸ªæ°‘æ—æ¥è¯´ï¼Œè®°å¿†å¯¹é—å¿˜çš„æŠ—æ‹’ï¼Œé¦–å…ˆæ˜¯çŸ¥è¯†ç²¾è‹±çš„è‰¯çŸ¥å¯¹å¼ºæƒçš„æŠ—æ‹’ã€‚å¦åˆ™çš„è¯ï¼Œæˆ‘ä»¬éä½†æ— æ³•æŠŠå…­å››å¤§å± æ€çš„çœŸç›¸ã€è¿›è€ŒæŠŠç‹¬è£åˆ¶åº¦çš„ç½ªæ¶å˜æˆæ°‘ä¼—çš„å†å²å¸¸è¯†ï¼Œä¹Ÿæ— æ³•é˜²æ­¢ç±»ä¼¼å¤§æ‚²å‰§çš„é‡æ¼”ã€‚éš¾é“ä¸­å›½å†å²åœ¨ä¸“åˆ¶ä¸‹æ¶æ€§å¾ªç¯çš„æ—¶é—´è¿˜ä¸å¤Ÿé•¿å—ï¼Ÿâ€</p></blockquote><p>æœ€ç»ˆï¼Œå› ä¸ºé—å¿˜ç½ªæ¶å†å²è€Œå—å®³çš„ï¼Œåªä¼šæ˜¯ä¸­å›½äººè‡ªå·±ã€‚</p><p><strong>â€œç”¨æ°‘é—´è®°å¿†æŠ—æ‹’å®˜æ–¹çš„å¼ºåˆ¶é—å¿˜ï¼Œå°±æ˜¯ä¸ºæˆ‘ä»¬è¿™ä¸ªå†å°½è‹¦éš¾çš„æ°‘æ—ä¿å­˜è®°å¿†å’Œè‰¯çŸ¥ã€‚â€</strong></p><blockquote><p>  äººæ°‘â€œè·å¾—â€çš„â€œå›½å®¶å†å²â€æ˜¯é‚£äº›è®°å½•ä¸‹æ¥ï¼Œæˆ–è€…è¯´è¢«æƒåŠ›å…è®¸è®°å½•ä¸‹æ¥çš„â€œäº‹ä»¶â€ï¼Œè€Œé‚£äº›æ²¡æœ‰è¢«è®°å½•æˆ–ä¸è¢«å…è®¸è®°å½•ä¸‹æ¥çš„äº‹ä»¶ï¼Œå°±æ­¤è¢«æ­¦æ–­åœ°ä»å›½å®¶å†å²ä¸­å‰”é™¤ï¼Œä¹Ÿä»æ—ç¾¤è®°å¿†ä¸­æ’æ–¥å‡ºå»äº†ã€‚å› æ­¤ï¼Œå¯¹å†å²çœŸå®ä¿æŒæ²‰é»˜ï¼Œè™½ç„¶æ˜¯ä»æ”¹å†™å†å²å¼€å§‹ï¼Œä½†æœ€ç»ˆå´è¡¨ç°ä¸ºæ—ç¾¤çš„é›†ä½“å¿˜å´ã€‚æ¯ä¸ªæ²‰é»˜çš„ä¸ªäººï¼Œæ¯ä¸ªåœ¨æ—ç¾¤ä¸­æŒ‰æƒåŠ›æ„å¿—æ¥è®°å¿†æˆ–å¿˜å´çš„äººï¼Œéƒ½å‚ä¸åœ¨ä»¥æ²‰é»˜ä»£æ›¿çœŸå®ï¼Œä»¥æ²‰é»˜ç»´æŒè°è¨€çš„å…±è°‹ä¹‹ä¸­ã€‚</p></blockquote><p>æƒ³èµ·äº† ã€Š1984ã€‹ é‡Œçš„ä¸€æ®µè¯ï¼Œæˆ–è®¸ç”¨ææƒä¸»ä¹‰æ¥è§£é‡Šå½“ä¸‹æœ€é€‚åˆä¸è¿‡äº†ï¼š<strong>ææƒæœ€æœ‰æ•ˆçš„ç»Ÿæ²»æœ¯æ˜¯ä»‡æ¨æ•™è‚²ï¼Œå¡‘é€ ä¸€ä¸ªè¿œåœ¨å¤©è¾¹çš„å¤–åœ¨æ•Œäººï¼Œäººä»¬å°±ä¼šå¿˜è®°èº«è¾¹çš„ç—›è‹¦ã€‚</strong></p><p>æ‘˜æŠ„ <a href="https://t.co/qZ2ID5XeuR" target="_blank" rel="noopener">äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†</a></p><h3 id="é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–"><a href="#é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–" class="headerlink" title="é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–"></a>é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–</h3><p>æ°å¥½è¯»å®Œè¿™æœ¬ä¹¦ä¹‹åä¸ä¹… B ç«™å°±ä¸Šæ˜ äº†åæµªæ´—è„‘å®£ä¼ ç‰‡ï¼Œä¸æ–™å¾®åšè¯„è®ºåŒºä¹Ÿæ˜¯ç¿»è½¦ç°åœºğŸ¤£</p><p>ç¬¬ä¸€æ¬¡å¬è¯´åˆ°åæµªçš„æ—¶å€™æˆ‘å°±è§‰ç€ï¼Œè¿™ç±»èº«å±…é«˜ä½çš„çŠ¬å„’çŸ¥è¯†ä»½å­ï¼Œå¦‚èƒ¡é”¡è¿›ã€èƒ¡éé’¢ã€é‡‘ç¿è£ã€å¼ ç»´ä¸ºè¿™ç±»ï¼Œä¸ºå½“æƒè€…æ­ŒåŠŸèµå¾·ã€æ‹é©¬æºœé¡»ã€è°„åªšçŒ®åªšã€é˜¿è°€å¥‰æ‰¿ã€‚è¿™ç±»äººåº”è¯¥æ¯”ä»»ä½•äººéƒ½æ¸…æ¥šåœ¨è¿™å¤ªå¹³ç››ä¸–çš„èƒŒåï¼ŒæŠ“æ•äº†å¤šå°‘ç»´æƒå¾‹å¸ˆã€è¿«å®³äº†å¤šå°‘å¼‚è®®äººå£«ã€å…³æŠ¼äº†å¤šå°‘å…¬æ°‘è®°è€…ã€å¤„åˆ†äº†å¤šå°‘ç›´è¨€æ•™å¸ˆã€‚ç„¶è¿™äº›çŸ¥è¯†åˆ†å­ã€æ•™æˆã€ä¸“å®¶åœ¨è¯´å‡è¯ï¼Œç”¨æ‰€è°“çš„â€å­¦æœ¯â€æ¥å–æ‚¦å’ŒæŠ•é æƒåŠ›å’Œå½“æƒè€…,è°‹å–ç§åˆ©ï¼Œä»¥è²Œä¼¼é«˜æ·±ã€æ¸Šåšã€ç²¾è‡´çš„ç†è®ºåŒ…è£…æ™®é€šäººç”¨å¸¸è¯†å°±èƒ½çœ‹ç©¿çš„æ…Œè¨€ï¼Œæœ‰çš„ç”šè‡³è¿˜ç›¸å½“â€å¯Œæœ‰åˆ›æ„â€ï¼Œå–„äºâ€ç†è®ºæ›´æ–°â€,æˆ–æœ‰â€ç†è®ºå»ºæ ‘â€ã€‚</p><p><img src="https://p.k8s.li/image-20210106235133212.png" alt=""></p><p>åœ¨æ”¿æ²»æ„è¯†å½¢æ€ä¸»å¯¼ä¸€åˆ‡,æƒåŠ›å¯ä»¥æ“æ§ä¸€åˆ‡çš„ç¤¾ä¼šé‡Œ,ä¸å­˜åœ¨æ‰€è°“çš„â€ç‹¬ç«‹å­¦æœ¯â€,å°¤å…¶ä¸å­˜åœ¨ç‹¬ç«‹çš„äººæ–‡å­¦æœ¯ã€‚ä¸€äº›çŸ¥è¯†åˆ†å­å› ä¸ºä¸å¾—å·²è€Œåšâ€çº¯å­¦é—®â€,æ˜¯ä¸€ç§æ†‹å±ˆçš„å­¦æœ¯â€è‡ªå®«â€ã€‚æƒåŠ›çš„å’¸èƒä¸åˆ©è¯±é€ å°±ä½“åˆ¶æ€§çš„â€å­¦æœ¯ä¹‰å„’â€,å®ƒå¾€å¾€æ˜¯ä¸€ç§åœ¨æ¸…é†’çŠ¶æ€ä¸‹çš„è£…å‚»â€”â€”ä¸€é¢è‡ªå˜²,ä¸€é¢é…åˆä½“åˆ¶,ç§¯æè‡ªæˆ‘å®¡æŸ»ï¼›ä¸€é¢å’’éª‚,ä¸€é¢è¿åˆä½“åˆ¶çš„æ— ç†è¦æ±‚ï¼›ä¸€é¢é„™è§†ä¸æ‡‚å­¦æœ¯çš„é¡¶å¤´ä¸Šå¸,ä¸€é¢é¡ºä»ä»–ä»¬çš„é¢†å¯¼æƒå¨ï¼›ä¸€é¢å˜²ç¬‘,ä¸€é¢å‚ä¸ä¸ºå®˜å‘˜æˆäºˆå„ç§çœŸçš„å‡å­¦ä½å’Œå‡å¤´è¡”ã€‚</p><blockquote><p>  é˜¿ä¼¦ç‰¹åœ¨1963å¹´7æœˆ24æ—¥ç»™å‹äººå¡æ–¯è´å°”ï¼ˆGerhard Casperï¼‰çš„ä¿¡é‡Œå†™é“:â€äººä»¬ç»å¸¸å‘ç°,æ´—è„‘æ¬ºéª—æœ€è‚¯å®šçš„é•¿æœŸåæœå°±æ˜¯é€ æˆçŠ¬å„’ä¸»ä¹‰â€”â€”ç»å¯¹ä¸ç›¸ä¿¡ä»»ä½•äº‹æƒ…å¯èƒ½æ˜¯çœŸçš„,å“ªæ€•æ˜¯ç¡®æœ‰å®æ®çš„çœŸå®,ä¹Ÿç…§æ ·ä¸ç›¸ä¿¡ã€‚æ¢è¨€ä¹‹,å®Œå…¨ç”¨è°è¨€æ¥ä»£æ›¿äº‹å®çœŸç›¸çš„ç»“æœä¸æ˜¯äººä»¬ä¼šæŠŠè°è¨€å½“ä½œçœŸå®,æˆ–è€…çœŸå®ä¼šè¢«å½“ä½œä¸ºè°è¨€,è€Œæ˜¯æˆ‘ä»¬èµ–ä»¥åœ¨çœŸå®ä¸–ç•Œé‡Œå­˜åœ¨çš„çŸ¥è§‰ä¼šè¢«å®Œå…¨æ‘§æ¯ã€‚äººç±»ä¸ºäº†ç”Ÿå­˜,å¿…é¡»å…·å¤‡åŸºæœ¬çŸ¥è§‰,å…¶ä¸­å°±æœ‰å¯¹çœŸå’Œå‡çš„è¯†åˆ«ã€‚â€</p></blockquote><blockquote><p>  é˜¿ä¼¦ç‰¹è®¤ä¸º,ç¤¾ä¼šä¸­çš„å¤šæ•°äººé›†ä½“æŠ•å‘çŠ¬å„’ä¸»ä¹‰,æ˜¯å› ä¸ºæ”¿æ²»æƒåŠ›é•¿æœŸç”¨è°è¨€æ¥ä»£æ›¿çœŸå®,å¤§è§„æ¨¡åœ°å¯¹ç¾¤ä¼—è¿›è¡Œæ´—è„‘å¹¶æ¬ºéª—ä»–ä»¬ã€‚è¿™æ˜¯20ä¸–çºªæ‰æœ‰çš„ç»Ÿæ²»æ–¹å¼,æœ€å…¸å‹çš„ä¾‹å­å°±æ˜¯æ–¯å¤§æ—ç»Ÿæ²»æ—¶æœŸå¦è®¤æ‰˜æ´›èŒ¨åŸºæ›¾å¯¹ä¿„ç½—æ–¯é©å‘½æœ‰è¿‡ä»»ä½•è´¡çŒ®ã€‚é˜¿ä¼¦ç‰¹ç§°æ­¤ä¸ºâ€ææƒè°è¨€â€,å®ƒè¦ç¼–é€ çš„æ˜¯ä¸€ç§å®Œå…¨è™šå‡çš„,å› æ­¤å½»åº•é¢ è¦†çœŸä¼ªåŒºåˆ«çš„â€çœŸå®â€ã€‚</p></blockquote><p><strong>çŠ¬å„’ä¸»ä¹‰ï¼š</strong></p><ul><li>ï¼ˆ1ï¼‰å¨±ä¹è‡³æ­»ï¼ˆæ²¡æœ‰ç›®æ ‡æˆ–ä¿¡ä»°,å¾—è¿‡ä¸”è¿‡ï¼‰ï¼›</li><li>ï¼ˆ2ï¼‰çœ‹å®¢å¿ƒæ€ï¼ˆçœ‹ç©¿ã€å†·æ¼ ã€å›´è§‚,ç®¡äº†ä¹Ÿæ²¡ç”¨,ä¸å¦‚ä¸ç®¡ï¼‰ï¼›</li><li>ï¼ˆ3ï¼‰ä¹ æƒ¯æ€§æ€€ç–‘ï¼ˆä¸Šè‡³æ”¿åºœ,ä¸‹è‡³æœ‹å‹,å¯¹è°éƒ½ä¸ä¿¡ä»»,éƒ½ä¸ç›¸ä¿¡ï¼‰ï¼›</li><li>ï¼ˆ4ï¼‰å®¡ä¸‘å¿ƒç†ï¼ˆåœ¨ä¸€ä¸ªæ˜¯éä¸åˆ†çš„ç¯å¢ƒé‡Œ,ç¾ä¸‘ã€å–„æ¶ã€çœŸå‡ä¹Ÿæ— æ³•è¾¨åˆ«,ä½•å¿…è¦åšæŒçœŸã€å–„ã€ç¾ï¼‰ï¼›</li><li>ï¼ˆ8ï¼‰â€é¸µé¸Ÿå¿ƒæ€â€ï¼ˆå¤šä¸€äº‹ä¸å¦‚å°‘ä¸€äº‹,è¢«å®£ä¼ çš„ç°å®åæ­£æ˜¯å‡çš„,ä¸å¦‚â€èº²è¿›å°æ¥¼æˆä¸€ç»Ÿâ€ï¼‰;</li><li>ï¼ˆ9ï¼‰æ€è€ƒææƒ§ç—‡ï¼ˆå¤šæ€å¤šæƒ¹äº‹,æœ‰çš„æ˜¯å‰è½¦ä¹‹é‰´,ä½ è¦æˆ‘æ€ä¹ˆè¯´,æˆ‘å°±æ€ä¹ˆè¯´,è¿™æ‰æ˜¯å®‰èº«ä¿å‘½ä¹‹é“ï¼‰ï¼›</li><li>ï¼ˆ11ï¼‰ç‚«å¯Œå¿ƒæ€ï¼ˆçœ‹ç©¿ä¸€äº›é“å¾·ã€ç†æƒ³ã€æœªæ¥å±•æœ›çš„è™šå¦„,åªæœ‰é’±æ‰æ˜¯å®åœ¨çš„,æ‰æ˜¯ä¸–äººè®¤å¯çš„å”¯ä¸€ä»·å€¼ï¼‰ï¼›</li><li>ï¼ˆ12ï¼‰åˆè€ç—‡ï¼ˆæ²¡æœ‰å‰é€”ã€æ²¡æœ‰æœªæ¥ã€æ²¡æœ‰è¿½æ±‚,è¿‡ä¸€å¤©ç®—ä¸€å¤©,ååƒç­‰æ­»ï¼‰ï¼›</li><li>ï¼ˆ13ï¼‰è‡ªè™å¿ƒæ€ï¼ˆè¿™ä¸ªè¯´æ³•å¹¶ä¸ç¡®å®,å› ä¸ºä¸€èˆ¬äººæ—¢éå…±äº§å…šåˆéä½“åˆ¶,ä¸æ˜¯â€è‡ªè™â€,è¿™ç§é¡¾å·¦å³è€Œè¨€ä»–çš„è¯´æ³•,æ˜ç™½äººè¯´ç³Šæ¶‚è¯,æ—¢ä¸è¯šå®,ä¹Ÿä¸çœŸå®,å®ƒæœ¬èº«å°±æ˜¯çŠ¬å„’ä¸»ä¹‰çš„ï¼‰ã€‚</li></ul><blockquote><p>  å¯¹çŠ¬å„’çš„ç°ä»£å®šä¹‰æ˜¯æœ‰ä»£è¡¨æ€§çš„:ä¸€ã€æŒ‘åˆºã€å˜²ç¬‘ã€è®½åˆºï¼›äºŒã€ä¸ç›¸ä¿¡æˆ–è£…ç€ä¸ç›¸ä¿¡æ™®é€šäººæ¥å—çš„é“å¾·ä»·å€¼è§‚å’Œäººç±»è¡Œä¸ºçœŸè¯šçš„å–„è‰¯åŠ¨æœº,æŠŠè‡ªç§è‡ªåˆ©è®¤ä½œå”¯ä¸€å¯èƒ½çš„åŠ¨æœºï¼›è½»è”‘ã€é„™è§†ã€å˜²è®½çš„æ€€ç–‘å’Œä¸ç›¸ä¿¡ã€‚</p></blockquote><p>åˆ˜æ™“æ³¢æ›¾åœ¨ <a href="http://www.liu-xiaobo.org/blog/archives/12412" target="_blank" rel="noopener">åˆ˜æ™“æ³¢ï¼šåœ¨åˆ€é”‹ä¸Šè¡Œèµ°â€”â€”ç‹±ä¸­è¯»ã€Šå¸ƒæ‹‰æ ¼ç²¾ç¥ã€‹</a> å†™è¿‡ï¼š</p><blockquote><p>  æ®å…‹é‡Œç›çš„ä»‹ç»ï¼Œåœ¨å‰è‹ä¸œææƒä¸‹çš„æ·å…‹çŸ¥è¯†åˆ†å­ç¾¤ä½“ä¸­ï¼Œä¸ä»…å‡ºç°äº†å“ˆç»´å°”è¿™æ ·çš„é“ä¹‰ç¤ºèŒƒï¼Œè€Œä¸”æœ‰95ï¼…ä»¥ä¸Šçš„äººä¸ºäº†è‡ªç”±å’Œè‰¯çŸ¥è€Œè¿›è¡Œç€å„ç§å½¢å¼çš„æ‹’ç»ï¼Œåªæœ‰ä¸åˆ°5%çš„äººç”˜æ„¿å •è½ä¸ºå–èº«æŠ•é è€…ã€‚è¿™å½“ç„¶æ˜¯è®©ä¸­å›½çŸ¥è¯†åˆ†å­è‡ªè§‰ç¾æ„§çš„è¡¨ç°ã€‚æˆ‘ä»¬æ²¡æœ‰æ·å…‹äººé‚£ç§æ¸…é†’å’ŒåšéŸ§ï¼Œä»…ä»…åå¹´çš„æ—¶é—´ï¼Œå…­å››çš„ä¼¤å£ä¾¿è¢«é—å¿˜ï¼Œè¿™ä¸å…‰æ˜¯å› ä¸ºå®˜æ–¹çš„å¼ºåˆ¶ï¼Œä¹Ÿæ˜¯æ°‘æ—çµé­‚çš„å†·æ¼ ã€‚çŸ¥è¯†åˆ†å­ç¾¤ä½“ä¸èƒ½ä»¥è¨€è¡Œæ¥æ´—åˆ·è€»è¾±ï¼Œæ—¢æºäºå¤–åœ¨çš„æ”¿æ²»ææ€–ï¼Œæ›´æºäºä»–ä»¬ç”Ÿå‘½ä¸­æ´—åˆ·è€»è¾±çš„å†²åŠ¨å·²ç»æ­»äº¡ã€‚</p></blockquote><p>æ‘˜æŠ„<a href="https://t.co/3C2OUjki3P" target="_blank" rel="noopener">é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–</a></p><h3 id="ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘"><a href="#ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘" class="headerlink" title="ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘"></a>ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘</h3><blockquote><p>  ææƒæ”¿ä½“å½»åº•æ§åˆ¶ä¸æ€æƒ³ã€è¨€è®ºã€æ–°é—»æœ‰å…³çš„è¦å®³é¢†åŸŸï¼Œæ•™è‚²æ˜¯è¢«ç®¡åˆ¶å¾—æœ€ä¸¥å‰çš„é¢†åŸŸä¹‹ä¸€ï¼Œå’Œå®£ä¼ ä¸€æ ·ï¼Œè¢«ä¸¥æ ¼æ§åˆ¶ã€‚è¿™æ ·çš„æ•™è‚²è™½ç„¶ä¸æ°‘ä¸»å›½å®¶çš„æ•™è‚²ä¸€æ ·è¢«ç§°ä¸ºâ€œæ•™è‚²â€ï¼Œä½†å®é™…ä¸Šå·²ç»æˆä¸ºæ”¿æ²»æƒåŠ›æ§åˆ¶å›½æ°‘æ€æƒ³å’ŒåŸ¹å…»å­æ°‘çš„å·¥å…·ã€‚è¿™ä¸æ°‘ä¸»å›½å®¶ä¸­å­¦æ ¡æ•™è‚²ä½œä¸ºå…¬æ°‘ç¤¾ä¼šæ–‡åŒ–æœºåˆ¶çš„ä¸€éƒ¨åˆ†ï¼Œèµ·åˆ°åŸ¹å…»æ°‘ä¸»å…¬æ°‘çš„ä½œç”¨ï¼Œæ˜¯å®Œå…¨ä¸åŒçš„ã€‚</p></blockquote><blockquote><p>  çº³ç²¹ç»Ÿæ²»å¾·å›½ï¼Œä¾é çš„ä¸ä»…æ˜¯å®Œå…¨ç”±çº³ç²¹æ§åˆ¶å’Œæ“çºµçš„å›½å®¶æœºå™¨ï¼Œæ”¿åºœã€å„çº§çº³ç²¹å…šç»„ç»‡ã€å…šå«å†›ã€å†²é”‹é˜Ÿã€è­¦å¯Ÿç­‰ï¼Œè€Œä¸”æ›´æ˜¯æ— å¤„ä¸åœ¨çš„çº³ç²¹æ„è¯†å½¢æ€ï¼Œå®ƒæ¸—é€åˆ°å¾·å›½ç¤¾ä¼šã€æ–‡åŒ–ã€æ•™è‚²å’Œå®¶åº­ç”Ÿæ´»çš„æ¯ä¸€ä¸ªè§’è½ï¼Œç¡®ä¿çº³ç²¹æ”¿å…šæˆä¸ºå¾·å›½ä¸»æƒçš„å†…æ ¸ã€‚æ­£æ˜¯ç”±äºçº³ç²¹æ”¿å…šå®é™…ä¸Šå·²ç»æˆä¸ºå¾·å›½ä¸»æƒçš„å†…æ ¸ï¼Œå¾·å›½çš„å›½å®¶ä¸»ä¹‰æ‰ä¼šæŒ‰ç…§çº³ç²¹çš„æ„å¿—è½¬å˜ä¸ºç¬¦åˆçº³ç²¹å…šåˆ©ç›Šï¼Œå¹¶ä¸ºå®ƒçš„åˆ©ç›ŠæœåŠ¡çš„å…šå›½ä¸»ä¹‰ã€‚</p></blockquote><blockquote><p>  åœ¨çº³ç²¹çš„ææƒç»Ÿæ²»åˆ¶åº¦ä¸­ï¼Œå­¦æ ¡è¿›è¡Œçš„æ˜¯ä¸€ç§ç”±ç»Ÿæ²»æ”¿å…šæ„è¯†å½¢æ€æŒ‡æŒ¥çš„å…šåŒ–æ•™è‚²ã€‚è¿™ç§å…šåŒ–æ•™è‚²æ¸—é€åˆ°æ•™è‚²çš„æ¯ä¸€ä¸ªç¯èŠ‚ä¹‹ä¸­ï¼Œè€Œåœ¨æ¯ä¸€ä¸ªç¯èŠ‚ä¸­ä½¿è¿™ç§å…šåŒ–æ„è¯†å½¢æ€é¡ºåˆ©å‘ç”Ÿä½œç”¨çš„æ­£æ˜¯æ— æ•°ç›´æ¥ä»äº‹æ•™å­¦å·¥ä½œçš„æ•™å¸ˆã€‚å…šåŒ–æ•™è‚²è¿«ä½¿äººä»¬ä¸æ–­è¿›è¡Œæ€æƒ³çš„ç›¸äº’çº¯æ´å’Œè‡ªæˆ‘çº¯æ´ï¼Œå®ƒåœ¨è¯¾å ‚é‡Œå‘ç”Ÿä¹‹å‰ï¼Œæ—©å°±å…ˆå·²ç»åœ¨è®¸å¤šæ•™å¸ˆçš„å¤´è„‘ä¸­å‘ç”Ÿäº†ï¼Œå¹¶æˆä¸ºä»–ä»¬çš„æ€ç»´å’Œè¡Œä¸ºä¹ æƒ¯ã€‚æ²¡æœ‰è¿™æ ·çš„æ•™å¸ˆï¼Œå…šåŒ–æ•™è‚²æ˜¯ä¸å¯èƒ½åœ¨å­¦æ ¡é‡Œæœ‰æ•ˆè´¯å½»çš„ã€‚</p></blockquote><blockquote><p>  åœ¨ææƒå›½å®¶é‡Œï¼Œå›½æ°‘å¿…é¡»æœ‰ç›¸åŒçš„æ­£ç¡®è¡¨ç°ï¼Œæ•™å¸ˆåœ¨å­¦æ ¡é‡Œçš„è¡Œä¸ºè¢«å®Œå…¨æ¨¡å¼åŒ–äº†ã€‚æ•™å¸ˆä»¬éƒ½å¿ äºå…šï¼ŒæŒ‰å…šçš„è¦æ±‚å»åšï¼Œä»–ä»¬åœ¨å­¦æ ¡çš„è¡Œä¸ºå¹¶ä¸ä»…ä»…æ˜¯â€œå¥½æ•™å¸ˆâ€è¡Œä¸ºï¼ŒåŒæ—¶ä¹Ÿæ˜¯â€œå¥½å›½æ°‘â€è¡Œä¸ºã€‚å½“ä¸€ä¸ªâ€œå¥½å›½æ°‘â€ï¼Œå°±æ˜¯åƒæ‰€æœ‰å…¶ä»–å›½æ°‘ä¸€æ ·å¯¹é¢†è¢–ã€å…šå’Œå…šå›½è¡¨ç°ç»å¯¹çš„å¿ è¯šã€‚â€œ</p></blockquote><blockquote><p>  çº³ç²¹å¾·å›½å®è¡Œçš„æ˜¯ä¸€ç§å½»åº•çš„ä»¥å›½å®¶ä¸»ä¹‰ä¸ºæ——å·çš„å…šåŒ–æ•™è‚²ï¼Œè¿™ç§æ•™è‚²ä»å„¿ç«¥å¼€å§‹ï¼Œåœ¨è¯¾ç¨‹ã€æ•™å­¦ã€æ•™æã€å¸ˆç”Ÿå…³ç³»çš„æ¯ä¸€ä¸ªç¯èŠ‚ä¸Šéƒ½è´¯å½»çº³ç²¹çš„ææƒç»Ÿæ²»åŸåˆ™ã€‚</p></blockquote><blockquote><p>  åœ¨ã€Šææƒä¸»ä¹‰çš„èµ·æºã€‹ä¸€ä¹¦ä¸­ï¼Œæ±‰å¨œÂ·é˜¿ä¼¦ç‰¹ä»ææƒä¸»ä¹‰åŸå‹çš„ç‰¹ç‚¹ä¸­æ¦‚æ‹¬å‡ºå®ƒæˆåŠŸç»Ÿæ²»çš„ä¸‰å¤§è¦ç´ ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯æš´åŠ›å’Œææƒ§çš„ç»Ÿæ²»ï¼Œè¿«ä½¿äººæ°‘æˆä¸ºç›¸äº’éš”ç»çš„ã€æ— åŠ©æ— æ´çš„æ•£æ²™ä¸ªä½“ï¼Œä»¥åŠå……åˆ†è¿ç”¨â€œç»„ç»‡â€å’Œâ€œå®£ä¼ â€çš„åŠ›é‡ã€‚é˜¿ä¼¦ç‰¹äº²èº«ç»å†è¿‡å¥¹æ‰€æ€è€ƒçš„ææƒä¸»ä¹‰ä¸­æœ€ä¸ºæˆåŠŸçš„ä¸€ç§ï¼Œé‚£å°±æ˜¯å¾·å›½çº³ç²¹çš„ææƒã€‚å¥¹å¯¹ææƒä¸»ä¹‰ä¸‰è¦ç´ çš„æ€»ç»“ä¾¿æ˜¯ä»å¥¹çš„ç›´æ¥ç»éªŒä¸­è§‚å¯Ÿå¾—å‡ºçš„ã€‚</p></blockquote><blockquote><p>  å…šçš„å®£ä¼ è¦æ±‚æ–°é—»ä»â€œæ­£é¢æŠ¥é“â€ï¼Œæ‰€ä»¥æ€»æ˜¯å°½é‡ä¸è®©åæ¶ˆæ¯æ›å…‰ã€‚å®ƒè®¤ä¸ºï¼Œåæ¶ˆæ¯ä¸åˆ©äºç¨³å®šäººå¿ƒï¼Œä¹Ÿå¯èƒ½è¢«åˆ«äººåˆ©ç”¨ï¼Œæ‰€ä»¥ï¼Œåæ¶ˆæ¯ä¹Ÿæˆä¸ºä¸€ç§ä¸èƒ½æ³„éœ²çš„â€œå›½å®¶æœºå¯†â€ã€‚</p></blockquote><p>æ‘˜æŠ„ <a href="https://t.co/PoWTqUQOQ7" target="_blank" rel="noopener">ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘</a></p><h3 id="æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³"><a href="#æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³" class="headerlink" title="æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³"></a>æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³</h3><p>è¿™æœ¬ä¹¦æ˜¯æˆ‘åœ¨ <a href="https://twitter.com/linyujing" target="_blank" rel="noopener">æ—æ„ˆéœ</a> ç«‹åœºæ–°é—»çš„æ–‡ç« é‡Œä¸Šå‘ç°çš„ã€‚ä¹‹å‰æˆ‘æ˜¯çŸ¥é“åˆ˜æ™“æ³¢æ˜¯è¯ºè´å°”å’Œå¹³å¥–å¾—ä¸»ï¼Œä¹ŸçŸ¥é“ä»–çš„ä¸€äº›äº‹è¿¹ï¼Œä½†é€šè¿‡è¿™æœ¬ä¼ è®°æ‰çœŸçœŸåˆ‡åˆ‡åœ°äº†è§£åˆ°åˆ˜æ™“æ³¢æ˜¯ä¸€ä½å¤šä¹ˆåšå¼ºçš„çŸ¥è¯†ä»½å­ã€‚åŒ…æ‹¬ç‹¬ç«‹ä¸­æ–‡ç¬”ä¼šçš„å‘å±•ï¼Œéƒ½ç¦»ä¸å¼€åˆ˜æ™“æ³¢å…ˆç”Ÿçš„ä»˜å‡ºã€‚</p><blockquote><p>åŠ‰æ›‰æ³¢æ‰¿èªï¼šã€Œé¡ä¼¼çš„æ®˜å¿è¡Œç‚ºä»¥åŠå°æ®˜å¿çš„è‡ªå¾—å…¶æ¨‚ï¼Œæˆ‘å°æ™‚å€™æ²’å°‘å¹¹ã€‚é€™ç¨®è¡Œç‚ºèˆ‡å°ˆé–€æ‰“ç ¸æ¶ã€æªé¬¥åˆ¥äººçš„ç´…è¡›å…µæ²’æœ‰ä»€éº¼å¯¦è³ªçš„å€åˆ¥ã€‚æˆ‘å€‘é€™äº›äººï¼Œåœ¨ä¸€ç¨®é‡è »çš„åˆ¶åº¦å’Œæ•™è‚²ä¹‹ä¸‹é•·å¤§ï¼Œå®ƒå´‡å°šæš´åŠ›ã€åŸ¹é¤Šä»‡æ¨ã€é¼“å‹µæ®˜å¿ã€ç¸±å®¹ç„¡æƒ…ï¼Œæ•™çµ¦å­©å­å€‘ä¸€ç¨®å¾å¨˜èƒè£¡å¸¶å‡ºä¾†çš„ä¸æ‹¿äººç•¶äººçš„æ®˜æš´å…‡ç‹ ã€‚åœ¨è¦–ç”Ÿå‘½å¦‚è‰èŠ¥çš„å¹´ä»£ï¼Œæˆ‘å€‘éƒ½åœ¨ä¸åŒçš„ç¨‹åº¦ä¸Šå……ç•¶éåŠŠå­æ‰‹å’Œå¹«å…‡ï¼Œèª°ä¹Ÿè„«ä¸æ‰è²¬ä»»ï¼Œæ´—ä¸æ¸…è‡ªå·±ï¼ã€</p></blockquote><blockquote><p>æˆ‘çš„æ•´å€‹é’æ˜¥æœŸç”Ÿé•·æ–¼æ–‡åŒ–æ²™æ¼ ä¹‹ä¸­ï¼Œæˆ‘æ‰€è³´ä»¥å¯«ä½œçš„æ–‡åŒ–æ»‹é¤Šï¼Œé™¤äº†ä»‡æ¨ã€æš´åŠ›ã€ç‹‚å¦„ï¼Œå°±æ˜¯èªªè¬Šã€ç„¡è³´ã€çŠ¬å„’ï¼Œé€™äº›é»¨æ–‡åŒ–çš„æ¯’ç´ é¤µé¤Šäº†æ•´æ•´å¹¾ä»£äººï¼Œæˆ‘ä¾¿æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œå³ä¾¿åœ¨æ€æƒ³è§£æ”¾çš„å…«â—‹å¹´ä»£ï¼Œä¹Ÿä¸¦æ²’æœ‰å®Œå…¨æ“ºè„«é»¨æ–‡åŒ–ã€‚</p></blockquote><blockquote><p>åŠ‰æ›‰æ³¢å¼·èª¿äº†è¨€è«–è‡ªç”±çš„é‡è¦æ€§ï¼šã€Œä¸€å€‹æ”¿æ¬Šä¸å¯èƒ½é å£“æŠ‘ä¸åŒæ”¿è¦‹ä¾†å»ºç«‹åˆæ³•æ€§ï¼Œä¹Ÿä¸å¯èƒ½é æ–‡å­—ç„ä¾†é”æˆé•·æ²»ä¹…å®‰ã€‚ã€ä»–å‘¼ç±²ä¸­åœ‹æ—©æ—¥å‘Šåˆ¥æ–‡å­—ç„ï¼šã€Œåªæœ‰å¾åˆ¶åº¦ä¸Šæ ¹çµ•æ–‡å­—ç„ï¼Œæ†²æ³•æ‰€è¦å®šçš„è¨€è«–è‡ªç”±æ¬Šåˆ©æ‰èƒ½è½å¯¦åˆ°æ¯ä¸€ä½åœ‹æ°‘èº«ä¸Šï¼›åªæœ‰ç•¶åœ‹æ°‘çš„è¨€è«–è‡ªç”±æ¬Šåˆ©å¾—åˆ°åˆ¶åº¦åŒ–çš„ç¾å¯¦ä¿éšœï¼Œæ–‡å­—ç„æ‰æœƒåœ¨ä¸­åœ‹å¤§åœ°ä¸Šæ»…çµ•ã€‚ã€</p></blockquote><p><code>æ‘˜æŠ„</code> <a href="https://t.co/eefs4gZspV" target="_blank" rel="noopener">æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³</a></p><h3 id="Age-of-Ambition"><a href="#Age-of-Ambition" class="headerlink" title="Age of Ambition"></a>Age of Ambition</h3><p><code>æ‘˜æŠ„</code> <a href="https://t.co/uvCqxbUb0i" target="_blank" rel="noopener">Age of Ambition</a></p><h3 id="è‡ªç”±å®ªç« "><a href="#è‡ªç”±å®ªç« " class="headerlink" title="è‡ªç”±å®ªç« "></a>è‡ªç”±å®ªç« </h3><p>ã€Šè‡ªç”±å®ªç« ã€‹æ˜¯è¿™å¤§åŠå¹´æ¥æœ€éš¾å•ƒçš„ä¹¦ï¼Œå“ˆè€¶å…‹çš„ä¹¦å¯¹äºæœ¨å­è¿™ç§èœé¸¡æ¥è¯´è¯»èµ·æ¥å°±æ˜¯å¤´å¤§å•Šï¼Œå’Œæˆ‘åœ¨ä¸€æœˆä»½è¯»çš„ã€Šè‡ªç”±ä¸ç¹è£çš„å›½åº¦ã€‹å‘³é“ä¸€æ ·ã€‚</p><p><strong>å¼—é‡Œå¾·é‡Œå¸ŒÂ·å“ˆè€¶å…‹</strong>ï¼ˆFriedrich AÂ·Hayekï¼‰æ˜¯å¥¥åœ°åˆ©ç»æµå­¦å®¶å’Œæ”¿æ²»å“²å­¦å®¶ã€‚èº«ä¸º1974å¹´çš„è¯ºè´å°”ç»æµå­¦å¥–çš„è·å¾—è€…ä¹‹ä¸€ï¼Œä»–ä¸»å¼ ä»¥å¸‚åœºä¸ºåŸºç¡€çš„è‡ªç”±èµ„æœ¬ä¸»ä¹‰å’Œæœ‰é™çš„æ”¿åºœã€‚æ­¤å¤–ï¼Œä»–è¿˜äº1991å¹´è·å¾—äº†æ€»ç»Ÿè‡ªç”±å‹‹ç« ã€‚</p><p>åœ¨è¿™æœ¬ä¹¦ä¸­ï¼Œå•å•æ³•æ²»æ¦‚å¿µçš„å«ä¹‰ï¼Œå“ˆè€¶å…‹æœ¬äººå°±ç½—åˆ—å¼•ç”¨äº† 30 å¤šæœ¬è‘—ä½œï¼å¯è§å½“æ—¶å“ˆè€¶å…‹æœ¬äººçš„å­¦æœ¯æ°´å¹³ç›¸å½“é«˜æ»´ï¼</p><blockquote><ul><li>ã€Šæ³•å¾‹ä¸ç§©åºã€‹</li><li>ã€Šæ•™ä¼šã€å›½å®¶ä¸ç ”ç©¶ã€‹</li><li>ã€Šæ–°åˆ©ç»´å¦ã€‹</li><li>ã€Šç¾å›½çš„è¡Œæ”¿å¸æ³•åŠæ³•å¾‹çš„æœ€é«˜åœ°ä½ã€‹</li><li>ã€Šå®ªæ”¿æ”¿æ²»ä¸æ°‘ä¸»ã€‹</li><li>ã€Šæ”¿æ²»ä¸è¡Œæ”¿ã€‹</li><li>ã€Šç°ä»£å…±åŒä½“çš„åŸºç¡€ã€‹</li><li>ã€Šå¯¹è‰¯å¥½ç¤¾ä¼šåŸåˆ™æ¢ç´¢ã€‹</li><li>ã€Šå®ªæ”¿ä¸å˜åŠ¨ä¸­çš„ä¸–ç•Œã€‹</li><li>ã€Šæ°‘ä¸»å›½å®¶ä¸é›†æƒå›½å®¶ã€‹</li><li>ã€Šè¡Œæ”¿ä¸æ³•æ²»ã€‹</li><li>ã€Šç°ä»£æ”¿æ²»è¯¸è¦ç´ ã€‹</li><li>ã€Šæ³•æ²»ï¼šä¿å®ˆçš„ä¼¦æ•¦å¾‹å¸ˆå…¬ä¼šä¸å·¥ä¼šåä¼šè¿›è¡Œçš„ç ”ç©¶ã€‹</li><li>ã€Šæ³•å¾‹ï¼šæœ‰å…³æ°‘ä¸»ä¹‹ä¸­çš„æƒå¨çš„ç†è®ºçš„è®ºæ–‡ã€‹</li><li>ã€Šä¸ªäººä¸»ä¹‰ä¸æ³•å¾‹ã€‹</li><li>ã€Šå®ªæ³•å­¦ã€‹</li><li>ã€Šå®ªæ³•ä¹‹ä¿å«è€…ã€‹</li><li>ã€Šæ³•æ²»å›½å®¶ï¼Œè¿˜æ˜¯ç‹¬è£ï¼Ÿã€‹</li><li>ã€Šæ”¿æ²»å­¦ã€‹ã€Šæ³•æ²»å›½å®¶æœ‰æ•ˆæ€§çš„ç•Œé™ã€‹</li><li>ã€Šæ³•æ²»å›½å®¶è¿˜æ˜¯å¨æƒå›½å®¶ï¼Ÿã€‹</li><li>ã€Šè‡ªç”±ä¸»ä¹‰ä½œä¸ºä¸€ç§æ„è¯†å½¢æ€çš„æ²¡è½ã€‹</li><li>ã€Šæ³¢æ©åŸºæœ¬æ³•ä¸­çš„ç¤¾ä¼šæ³•æ²»å›½å®¶æ¦‚å¿µã€‹</li><li>ã€Šä½œä¸ºåˆ‘æ³•æœ€æ–°å‘å±•çš„ä¸­å¿ƒæ¦‚å¿µçš„æ³•æ²»å›½å®¶ã€‹</li><li>ã€Šæ³•ã€å›½å®¶ã€ç»æµã€‹</li><li>ã€Šä»æ³•å¾‹å›½å®¶åˆ°æ³•å®˜å›½å®¶ã€‹</li><li>ã€Šç‘å£«è”é‚¦å›½å®¶æ³•ã€‹</li><li>ã€Šå¾·å›½è¡Œæ”¿æ³•çš„ä½“åˆ¶ã€‹</li><li>ã€Šç‘å£«è”é‚¦æ³•é™¢çš„å®ªæ³•ç®¡è¾–æƒã€‹</li><li>ã€Šæ³•åˆ¶å›½å®¶æ°‘ä¸»åˆ¶ã€‹</li><li>ã€Šç¾å›½ä¸ç‘å£«å®ªæ³•ç®¡è¾–æƒçš„æ”¿æ²»æ„è¯†å½¢æ€ä¸Šä¸æ³•å¾‹æ„è¯†å½¢æ€ä¸Šçš„æ ¹æ®ã€‹</li><li>ã€Šä½œä¸ºå›½å®¶æ ¹æœ¬æ³•å¾‹ç§©åºçš„å®ªæ³•ã€‹</li><li>ã€Šç‘å£«æ³•å¾‹ä¸­çš„å…¬æ°‘è‡ªç”±ã€‹</li><li>ã€Šæ³•æ²»å›½å®¶çš„ç§©åºã€‹</li><li>ã€Š1955å¹´é›…å…¸å›½é™…æ³•å­¦å®¶å¤§ä¼šæŠ¥å‘Šã€‹</li></ul></blockquote><p>è™½ç„¶è¿™æœ¬ä¹¦æ—©åœ¨1960å¹´å°±å·²å‡ºç‰ˆï¼Œä½†å…¶æ·±åˆ»çš„è§è§£æ—¶è‡³ä»Šæ—¥ä»ç„¶ç››è¡Œã€‚ä»–æ‰€å€¡å¯¼çš„ç»æµå’Œä¸ªäººè‡ªç”±ç†è®ºé€‚ç”¨äºå¾ˆå¤šå½“ä»Šçš„çƒ­è®®è¯é¢˜ï¼Œä»ç‰©ä»·ä¸Šæ¶¨åˆ°ç´¯è¿›ç¨åˆ¶ã€‚åœ¨ä¹¦ä¸­ï¼Œä½œè€…å¯¹æ¯”äº†å»ºç«‹æœ‰é™æ”¿åºœçš„ç›Šå¤„å’Œå®æ–½ä¸­å¤®è®¡åˆ’ç»æµçš„å¼Šç«¯ã€‚é™åˆ¶æ”¿åºœæƒåŠ›å°†ä¼šæœ‰åˆ©äºæå‡ä¸ªä½“èƒ½åŠ¨æ€§å’Œåˆ›é€ åŠ›ï¼Œè¿›è€Œæ¨åŠ¨äººç±»çŸ¥è¯†å’Œæ–‡æ˜çš„è¿›æ­¥ã€‚å“ˆè€¶å…‹è®ºè¯äº†æ³•å¾‹æ³•è§„ã€åˆæ³•ç¨‹åºå’Œå®ªæ³•æ”¿åºœå¯¹è‡ªç”±çš„ç§¯æä½œç”¨ï¼Œå¹¶æŒ‡å‡ºä¸ªäººè‡ªç”±æ‰€é¢ä¸´çš„ä¸¥å³»çš„æ½œåœ¨å¨èƒã€‚ä»¥ä¸‹æ˜¯æœ¬ä¹¦çš„å‡ ä¸ªè¦ç‚¹ï¼š</p><ul><li>æœ‰é™çš„æ”¿åºœé€šè¿‡æ¿€å‘äººçš„ä¸ªä½“ä¸»åŠ¨æ€§æ¥æ¨åŠ¨ç¤¾ä¼šçš„è¿›æ­¥ã€‚</li><li>è´¢äº§æƒåˆ©å’Œä¸ªäººè‡ªç”±è¿™ä¸€å®½æ³›çš„æ”¿æ²»æ¦‚å¿µæœ‰ç€å¯†åˆ‡çš„è”ç³»ã€‚</li><li>åªæœ‰é‚£äº›ä¸çº¦å®šä¿—æˆçš„é“å¾·è§‚å¿µç›¸ç¬¦çš„æ³•å¾‹æ‰èƒ½ç»å¾—ä½æ—¶é—´çš„è€ƒéªŒã€‚</li><li>å¤šæ•°è£å®šåŸåˆ™è‡ªç„¶å¾ˆæœ‰å¿…è¦ï¼Œä½†ä»…ä»…ä¾é å®ƒè¿˜ä¸è¶³ä»¥å»ºç«‹ä¸€ä¸ªè‡ªç”±ç¤¾ä¼šã€‚</li><li>å®ªæ”¿æ˜¯ç¾å›½è¿½æ±‚è‡ªç”±äº‹ä¸šæœ€æœ‰åŠ›çš„æ­¦å™¨ã€‚</li><li>ç¤¾ä¼šä¸»ä¹‰æ˜¯ä¸€ç§å¤±è´¥çš„æ”¿åºœå½¢å¼ï¼Œä½†å®ƒè‡³ä»Šä¾ç„¶å½±å“ç€å…¬å…±æ”¿ç­–çš„åˆ¶å®šã€‚</li><li>é€šè¿‡æ”¶å…¥å†åˆ†é…æ¥ç¼“è§£è´«å›°ä¼šå¸¦æ¥æ„æƒ³ä¸åˆ°çš„è´Ÿé¢æ•ˆåº”ï¼Œæ¯”å¦‚â€œç¦åˆ©å›½å®¶â€çš„å‡ºç°ã€‚</li><li>åŸºäºå¸‚åœºçŠ¶å†µçš„å¥–åŠ±åˆ¶åº¦æ¯”åŸºäºä¸ªäººä¼˜ç‚¹çš„å¥–åŠ±åˆ¶åº¦æ›´åŠ æœ‰æ•ˆã€‚</li><li>æ¯”èµ·é€šè´§ç´§ç¼©ï¼Œæ”¿åºœæ›´å€¾å‘äºé€šè´§è†¨èƒ€ã€‚ä½†è¿‡åº¦çš„è†¨èƒ€ä¼šå¨èƒåˆ°è‡ªç”±ã€‚</li><li>é™åˆ¶æ”¿åºœå¯¹æ•™è‚²çš„å¹²æ¶‰æœ‰åˆ©äºç¤¾ä¼šä¿æŒæ€æƒ³æ´»åŠ›ã€‚</li></ul><p><img src="https://p.k8s.li/image-20210106235239532.png" alt=""></p><p>æ‘˜æŠ„ <a href="https://t.co/t1GhiJgIsa" target="_blank" rel="noopener">è‡ªç”±å®ªç« </a></p><h3 id="ä¸€æƒ³åˆ°è¿˜æœ‰ç™¾åˆ†ä¹‹ä¹åäº”çš„é—®é¢˜ç•™ç»™äººç±»-æˆ‘å°±æ”¾å¿ƒäº†"><a href="#ä¸€æƒ³åˆ°è¿˜æœ‰ç™¾åˆ†ä¹‹ä¹åäº”çš„é—®é¢˜ç•™ç»™äººç±»-æˆ‘å°±æ”¾å¿ƒäº†" class="headerlink" title="ä¸€æƒ³åˆ°è¿˜æœ‰ç™¾åˆ†ä¹‹ä¹åäº”çš„é—®é¢˜ç•™ç»™äººç±»,æˆ‘å°±æ”¾å¿ƒäº†"></a>ä¸€æƒ³åˆ°è¿˜æœ‰ç™¾åˆ†ä¹‹ä¹åäº”çš„é—®é¢˜ç•™ç»™äººç±»,æˆ‘å°±æ”¾å¿ƒäº†</h3><p><code>æ‘˜æŠ„</code> <a href="https://t.co/HX1EXtz2oZ" target="_blank" rel="noopener">ä¸€æƒ³åˆ°è¿˜æœ‰ç™¾åˆ†ä¹‹ä¹åäº”çš„é—®é¢˜ç•™ç»™äººç±»,æˆ‘å°±æ”¾å¿ƒäº†</a></p><h3 id="è¢«è®¨åŒçš„å‹‡æ°”"><a href="#è¢«è®¨åŒçš„å‹‡æ°”" class="headerlink" title="è¢«è®¨åŒçš„å‹‡æ°”"></a>è¢«è®¨åŒçš„å‹‡æ°”</h3><p>æ— æ„é—´åœ¨ <a href="https://sanshiliuxiao.top/talkSelf/20191212/" target="_blank" rel="noopener">æ¤å’²è‰¯ç”°|æƒ³ä¸åˆ°å•¥æ ‡é¢˜</a> å‘ç°äº†è¿™æœ¬ä¹¦ã€‚</p><blockquote><p>ä¹¦é‡Œé¢æœ‰å¾ˆå¤šçš„è§‚ç‚¹ä¸€å¼€å§‹éƒ½æŒºè®©äººéš¾ä»¥æ¥å—çš„ï¼Œå°±åƒé‚£ä½å»å¯»æ±‚å“²äººå¸®åŠ©çš„é’å¹´ï¼Œä¸å»æ¥å—å“²äººçš„è§‚ç‚¹ï¼Œå¿ƒé‡Œæƒ³ç€æ ¹æœ¬å°±ä¸æ˜¯å“²äººè¯´çš„é‚£æ ·ï¼Œå†³å®šè¦å»å¥½å¥½åé©³ä»–ã€‚å¯æ˜¯ä»”ç»†æƒ³æƒ³ï¼Œå“²äººè¯´çš„è¯ä¹Ÿç®—æ˜¯è›®æœ‰é“ç†çš„ã€‚æ•´æœ¬ä¹¦ä¸­å“²äººè¯´çš„ä¸€äº›è¨€è®ºï¼Œå¦‚æœå•å•åªæ‹†å‡ºä¸€æ®µæˆ–ä¸€å¥ï¼Œå°±ä¼šè§‰å¾—è¿™ä¸ªå“²äººæ˜¯åœ¨å¼ºè¯å¤ºç†ï¼Œå¯æ˜¯ä»–çš„è¯é‡Œé¢æœ‰ç€æ˜¯æœ‰å¾ˆå¤šçš„å‰ç½®æ¡ä»¶ï¼Œå¦‚ä½•ç»“åˆç€ä¸€èµ·çœ‹ï¼Œé‚£å°±ä¼šæ„Ÿè§‰ä¸ä¸€æ ·ã€‚</p></blockquote><p>å…ˆè¯´ä¸€ä¸‹æˆ‘è‡ªå·±çš„æ„Ÿå—å§ï¼Œè¯»å®Œè¿™æœ¬ä¹¦ç¡®å®æ”¹å˜äº†æˆ‘ä¸€äº›æ ¹æ·±è’‚å›ºçš„è§‚å¿µã€‚æˆ‘æ‰¿è®¤æˆ‘æœ‰ç‚¹æç«¯å¿ƒç†ï¼Œå¹¶ä¸”æˆ‘å¾ˆé•¿æ—¶é—´æŠŠå®ƒå½’å› äºç«¥å¹´æ—¶æœŸçš„å®¶åº­æš´åŠ›ï¼Œæˆ‘è§‰ç€æ˜¯è€çˆ¸çš„æš´è„¾æ°”å½±å“äº†æˆ‘çš„æ€§æ ¼ï¼Œä»¥è‡³äºæ€§æ ¼åæ¿€ã€å¯¡è¨€å°‘è¯­ã€ä¸å–„ç¤¾äº¤ã€è‡ªå‘å†…å‘ç­‰ã€‚å¾ˆé•¿å¾ˆé•¿ä¸€æ®µæ—¶é—´æˆ‘éƒ½æŠŠè¿™ä¸€åˆ‡å½’è´£äºè€çˆ¸å¯¹æˆ‘çš„å®¶åº­æš´åŠ›ï¼Œé•¿ä¹…ä¸èƒ½é‡Šæ€€ã€‚å°±åœ¨ä»Šå¹´è¿‡å¹´æ—¶åœ¨å®¶è¿˜å’Œè€çˆ¸äº‰åµæ€ªä»–å°æ—¶å€™æ‰“æˆ‘æ‰å¯¼è‡´æˆ‘æ€§æ ¼åæ¿€ã€‚</p><p>ç›´åˆ°è¯»å®Œè¿™æœ¬ä¹¦ï¼Œæˆ‘æ‰æ”¹å˜äº†è¿™ç§å¹¼ç¨šçš„æƒ³æ³•ã€‚<strong>æˆ‘ä»¬å¹¶éå› ä¸ºè‡ªèº«ç»å†ä¸­çš„åˆºæ¿€â€”â€”æ‰€è°“çš„å¿ƒç†åˆ›ä¼¤â€”â€”è€Œç—›è‹¦ï¼Œäº‹å®ä¸Šæˆ‘ä»¬ä¼šä»ç»å†ä¸­å‘ç°ç¬¦åˆè‡ªå·±ç›®çš„çš„å› ç´ ã€‚å†³å®šæˆ‘ä»¬è‡ªèº«çš„ä¸æ˜¯è¿‡å»çš„ç»å†ï¼Œè€Œæ˜¯æˆ‘ä»¬è‡ªå·±èµ‹äºˆç»å†çš„æ„ä¹‰ã€‚</strong>ç»å†æœ¬èº«ä¸ä¼šå†³å®šä»€ä¹ˆã€‚æˆ‘ä»¬ç»™è¿‡å»çš„ç»å†â€œèµ‹äºˆäº†ä»€ä¹ˆæ ·çš„æ„ä¹‰â€ï¼Œè¿™ç›´æ¥å†³å®šäº†æˆ‘ä»¬çš„ç”Ÿæ´»ã€‚ä¸å¯ä»¥ä»è¿‡å»ä¸­æ‰¾åŸå› ï¼›è¦å¦å®šç²¾ç¥åˆ›ä¼¤ï¼›äººä¸æ˜¯å—è¿‡å»åŸå› æ”¯é…çš„å­˜åœ¨ï¼Œäººæ˜¯ä¸ºäº†è¾¾æˆæŸç§ç›®çš„è€Œé‡‡å–è¡ŒåŠ¨çš„ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/o6cc1csJI2" target="_blank" rel="noopener">è¢«è®¨åŒçš„å‹‡æ°”</a></p><h3 id="å¸ƒæ‹‰æ ¼ç²¾ç¥"><a href="#å¸ƒæ‹‰æ ¼ç²¾ç¥" class="headerlink" title="å¸ƒæ‹‰æ ¼ç²¾ç¥"></a>å¸ƒæ‹‰æ ¼ç²¾ç¥</h3><p>æœ¬ä¹¦çš„ä½œè€…æ˜¯è¿™æœ¬ä¹¦çš„è¯‘è€…åŒæ ·ä¹Ÿæ˜¯ã€Šå“ˆç»´å°”æ–‡é›†ã€‹çš„è¯‘è€…å´”å«å¹³ã€‚æåˆ°å¸ƒæ‹‰æ ¼å°±ä¸å¾—ä¸æ <a href="https://zh.wikipedia.org/zh-hans/%E5%B8%83%E6%8B%89%E6%A0%BC%E4%B9%8B%E6%98%A5" target="_blank" rel="noopener">å¸ƒæ‹‰æ ¼ä¹‹æ˜¥</a> </p><p>æ¨èé˜…è¯» <a href="http://www.liu-xiaobo.org/blog/archives/5381" target="_blank" rel="noopener">åˆ˜æ™“æ³¢ï¼šè¯»ã€Šå¸ƒæ‹‰æ ¼ç²¾ç¥ã€‹â€”â€”ç‹±ä¸­è¯»ä¹¦ç¬”è®°</a> å’Œ <a href="http://www.liu-xiaobo.org/blog/archives/12412" target="_blank" rel="noopener">åˆ˜æ™“æ³¢ï¼šåœ¨åˆ€é”‹ä¸Šè¡Œèµ°â€”â€”ç‹±ä¸­è¯»ã€Šå¸ƒæ‹‰æ ¼ç²¾ç¥ã€‹</a></p><h2 id="è‡ªç„¶-ç§‘å­¦"><a href="#è‡ªç„¶-ç§‘å­¦" class="headerlink" title="è‡ªç„¶/ç§‘å­¦"></a>è‡ªç„¶/ç§‘å­¦</h2><h3 id="ç—…æ¯’æ˜Ÿçƒ"><a href="#ç—…æ¯’æ˜Ÿçƒ" class="headerlink" title="ç—…æ¯’æ˜Ÿçƒ"></a>ç—…æ¯’æ˜Ÿçƒ</h3><p>æä¸ºç®€çŸ­çš„ä¸€æœ¬ç§‘æ™®ï¼Œå¤§æ¦‚ç”¨äº†ä¸¤ä¸ªå°æ—¶çš„æ—¶é—´å°±è¯»å®Œäº†ã€‚ä¸»è¦ç§‘æ™®äº†ä¸€ä¸‹ç—…çš„æ€§è´¨ä»¥åŠå…¥ä¾µäººä½“ç»†èƒçš„æœºç†ç­‰ã€‚æ„Ÿè§‰è¯»èµ·æ¥æµ·æ˜Ÿå§ï¼Œæ²¡æœ‰å¤ªå¤šç²¾å½©çš„åœ°æ–¹ï¼Œå°±åƒå›é¡¾äº†ä¸€ä¸‹é«˜ä¸­ç”Ÿç‰©å­¦ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/Op5GTfaOch" target="_blank" rel="noopener">ç—…æ¯’æ˜Ÿçƒ</a></p><h3 id="ç—…æ¯’æ¥è¢­"><a href="#ç—…æ¯’æ¥è¢­" class="headerlink" title="ç—…æ¯’æ¥è¢­"></a>ç—…æ¯’æ¥è¢­</h3><p>æ„Ÿè§‰æ²¡ã€Šç—…æ¯’æ˜Ÿçƒã€‹è¦å¥½ä¸€äº›ï¼Œæ€»ä¹‹æ¨èå‰ä¸€æœ¬ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/kfTZIY7Zt0" target="_blank" rel="noopener">ç—…æ¯’æ¥è¢­</a></p><h3 id="è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹"><a href="#è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹" class="headerlink" title="è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹"></a>è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹</h3><p>ç–«æƒ…æœŸé—´åœ¨å®¶çœ‹å®Œçš„ä¹¦ï¼Œä¹Ÿæœ‰åŒåçš„çºªå½•ç‰‡ï¼Œæ¨èä¸¤è€…éƒ½çœ‹ä¸€ä¸‹ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://kindle.502.li/" target="_blank" rel="noopener">è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹</a></p><h3 id="è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½"><a href="#è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½" class="headerlink" title="è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½"></a>è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½</h3><p>è¿™æœ¬ä¹¦ä¸»è¦è®²äº†æ¤ç‰©çš„èµ·æºã€å…‰åˆä½œç”¨ã€å¶ç»¿ä½“ã€å­¢å­ç”Ÿæ®–ä»¥åŠä¸€äº›è¿œå¤æ—¶æœŸçš„ç”Ÿæ€ç¯å¢ƒç­‰ã€‚æ€»ä¹‹å¯¹äºå’±è¿™ç§å¯¹å¤ç”Ÿç‰©å­¦æ„Ÿå…´è¶£çš„æ¥è¯´ç®—æ˜¯ä¸€é¡¿ç§‘æ™®ç››å®´ï¼Œå­¦åˆ°å¾ˆå¤šçŸ¥è¯†è€¶ï¼Œæå¤§å¾—æ»¡è¶³äº†å’±çš„å¥½å¥‡å¿ƒğŸ˜‚ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/5KOfa96qlr" target="_blank" rel="noopener">è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½</a></p><h3 id="å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹"><a href="#å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹" class="headerlink" title="å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹"></a>å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹</h3><p>è¯¾æœ¬æ•™æï¼Œæ¯ç‡¥ã€åªæ˜¯äº†è§£äº†ä¸€ä¸‹åŸºæœ¬çš„æ¦‚å¿µï¼Œæ„Ÿè§‰æˆ‘ä¸é€‚åˆè¯»è¿™ç§æ¯ç‡¥çš„è¯¾æœ¬(ï¿£â–½ï¿£)â€</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/G6oMMnAAji" target="_blank" rel="noopener">å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹</a></p><h3 id="æœ±é’¦å£«çš„ä¸ªäººåšå®¢"><a href="#æœ±é’¦å£«çš„ä¸ªäººåšå®¢" class="headerlink" title="æœ±é’¦å£«çš„ä¸ªäººåšå®¢"></a>æœ±é’¦å£«çš„ä¸ªäººåšå®¢</h3><p>è¿™å¹¶ä¸æ˜¯ä¸€æœ¬ä¹¦ï¼Œè€Œæ˜¯æˆ‘åœ¨ <a href="http://blog.sciencenet.cn/home.php?mod=space&uid=582158" target="_blank" rel="noopener">æœ±é’¦å£« </a>åšå£«çš„ä¸ªäººåšå®¢ä¸Šå¤åˆ¶ä¸‹æ¥æ•´ç†æˆçš„ç”µå­ä¹¦ï¼Œåœ¨ kindle ä¸Šè¯»èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ã€‚å¯¹äºåªå…·å¤‡é«˜ä¸­ç”Ÿç‰©çŸ¥è¯†å¾—å’±æ¥è¯´ï¼Œè¯»èµ·æœ±é™¢å£«å†™çš„æ–‡ç« è¿˜æ˜¯æœ‰äº›åƒåŠ›çš„ï¼Œæ„Ÿè§‰è¿™åŸºæœ¬ä¸Šå°±æ˜¯è®ºæ–‡çš„æ³¨é‡Šç‰ˆã€‚é‡Œé¢çš„ä¸€äº›å­¦æœ¯ç”¨è¯­æœ‰å¾ˆå¤šéƒ½ä¸æ‡‚ï¼Œåªèƒ½è‡ªå·±æœç´¢äº†è§£ä¸€ä¸‹ã€‚è®²åˆ°äº†çœŸæ ¸ç”Ÿç‰©çš„èµ·æºï¼Œä»¥åŠåŠ¨ç‰©ç»†èƒå’Œæ¤ç‰©ç»†èƒçš„èµ·æºã€‚å’±ä»¬äººç±»ï¼ˆåŠ¨ç‰©ï¼‰æ˜¯ä»å•é­æ¯›çš„åŸç”Ÿç”Ÿç‰©é¢†é­æ¯›è™«ï¼ˆChoanoflagellateï¼‰æ¼”åŒ–è€Œæ¥ï¼Œè€Œæ¤ç‰©åˆ™ç”±åŒé­æ¯›åŸç”Ÿç”Ÿç‰©ä¸­çš„åŒæ˜Ÿè—»ï¼ˆZygmematalesï¼‰æ¼”åŒ–è€Œæ¥ï¼ŒåŸæ¥å’±ä»¬çš„ç¥–å…ˆæ˜¯åªé­æ¯›è™«ğŸ˜‚ï¼Ÿ</p><p>æ‘˜æŠ„ <a href="https://t.co/50HX5FvBPk" target="_blank" rel="noopener">æœ±é’¦å£«çš„ä¸ªäººåšå®¢</a></p><h3 id="ç”Ÿå‘½é€šå²"><a href="#ç”Ÿå‘½é€šå²" class="headerlink" title="ç”Ÿå‘½é€šå²"></a>ç”Ÿå‘½é€šå²</h3><p>ç”Ÿå‘½é€šå²è¿™æœ¬ä¹¦æ˜¯ä»Šå¹´èŠ±äº†ç›¸å½“é•¿çš„æ—¶é—´æ¥è¯»å®Œçš„ï¼Œä¹‹å‰åœ¨ <a href="http://blog.sciencenet.cn/home.php?mod=space&uid=582158" target="_blank" rel="noopener">æœ±é’¦å£« </a>åšå£«çš„ä¸ªäººåšå®¢ä¸Šè¯»äº†å¾ˆå¤šæ–‡ç« ä¸€ç›´ä¸çŠ¹æœªå°½ã€‚</p><p>çœŸæ ¸ç»†èƒæ˜¯æ€æ ·å½¢æˆçš„å‘¢ï¼Œä¹¦ä¸­è§£é‡Šä¸ºï¼šçœŸæ ¸ç»†èƒæ˜¯å…ˆè·å¾—çº¿ç²’ä½“ï¼Œå†å‘å±•å‡ºç»†èƒæ ¸ã€‚çº¿ç²’ä½“çš„å‡ºç°ç»™çœŸæ ¸ç”Ÿç‰©å¸¦æ¥å……è¶³èƒ½æºçš„åŒæ—¶ï¼Œä¹Ÿå¸¦æ¥äº†å†…å«å­çš„å…¥ä¾µã€‚ä¸ºè›‹ç™½è´¨ç¼–ç çš„åŸºå› ä¸­å†…å«å­çš„å‡ºç°ï¼Œåˆè¿«ä½¿ç»†èƒå½¢æˆç»†èƒæ ¸ä»¥æŠŠDNAå’Œæ ¸ç³–ä½“åˆ†éš”å¼€æ¥ã€‚è¿™å¤§æ¦‚å°±æ˜¯çœŸæ ¸ç»†èƒå‡ºç°çš„æ ¹æœ¬åŸå› ã€‚å…¶å®ƒçš„æ”¹å˜éƒ½æ˜¯åœ¨è¿™ä¸ªåŸºç¡€ä¸Šè¿›è¡Œçš„ã€‚è½¬å½•å’Œè›‹ç™½è´¨åˆæˆå¿…é¡»åœ¨ç©ºé—´ä¸Šåˆ†å¼€ï¼Œè€Œè¿™æ­£æ˜¯ç»†èƒæ ¸çš„ä½œç”¨ã€‚ç»†èƒæ ¸çš„è†œèƒ½å¤Ÿé˜²æ­¢å®Œæ•´çš„æ ¸ç³–ä½“è¿›å…¥ç»†èƒï¼Œè€ŒmRNAåœ¨å‰ªæ¥å®Œæˆå‰ï¼Œåˆä¸ä¼šç¦»å¼€ç»†èƒæ ¸ï¼Œè¿™æ ·æ ¸ç³–ä½“èƒ½å¤Ÿæ¥è§¦çš„ï¼Œå°±åªèƒ½æ˜¯åŠ å·¥å®Œæ¯•çš„ mRNAã€‚</p><p>è¯»è¿™æœ¬ä¹¦åªéœ€è¦åŸºæœ¬çš„é«˜ä¸­ç”Ÿç‰©å’ŒåŒ–å­¦çŸ¥è¯†å°±èƒ½è¯»æ‡‚ã€‚ä»åˆ†å­ç”Ÿç‰©å­¦å’ŒåŸºå› è§’åº¦è§£é‡Šä¸€äº›å®è§‚çš„ç”Ÿå‘½ç°è±¡ï¼Œæ¯”å¦‚æœ‰æ°§å‘¼å¸ç”µå­çš„ä¼ é€’ï¼›çº¿ç²’ä½“å’Œå¶ç»¿ä½“å¦‚ä½•å·¥ä½œï¼›ä¸‰ç¾§é…¸å¾ªç¯ï¼›åŸºå› è¡¨è¾¾å¦‚ä½•æ§åˆ¶æ§åˆ¶ä¸ªä½“çš„å½¢æˆç­‰ç­‰ï¼Œéƒ½åˆ†æçš„ååˆ†ç²¾å½©ï¼Œæ€»ä¹‹ç›¸å½“äºä¸€æœ¬ç”Ÿå‘½ç§‘å­¦çš„â€œæºç åˆ†æâ€ã€‚</p><p>å¦å¤–å€¼å¾—ä»¤äººå€¾ä½©çš„æ˜¯ã€Šç”Ÿå‘½é€šå²ã€‹è¿™æœ¬ä¹¦å¹¶æ²¡æœ‰ä»»ä½•äººçš„æ¨èåºï¼Œæ²¡æœ‰èŠ±é‡Œèƒ¡å“¨çš„å¹å˜˜åªæœ‰ä¸¥è°¨åŠ¡å®çš„å­¦æœ¯çŸ¥è¯†ï¼Œåœ¨è¿™æµ®èºçš„å¹´ä»£ï¼Œå¾ˆå°‘èƒ½è§åˆ°è¿™æ ·çš„ä¹¦äº†ã€‚è¿™æœ¬ä¹¦åœ¨æˆ‘å¿ƒä¸­çš„åœ°ä½è¿œé«˜äºã€Šäººç±»ç®€å²ã€‹ç­‰ç•…é”€ä¹¦ï¼Œå› ä¸ºè¿™çœŸçš„æ˜¯ä¸€æœ¬é€‚åˆè‡ªå·±æ¥è¯»çš„ä¹¦ğŸ˜€ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/6PBLon5t09" target="_blank" rel="noopener">æœ±é’¦å£«çš„ä¸ªäººåšå®¢</a></p><h3 id="ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥"><a href="#ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥" class="headerlink" title="ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥"></a>ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥</h3><p>è¯»å®Œäº†æœ±é™¢å£«çš„åšå®¢ä¸Šçš„æ–‡ç« ï¼Œå°±åƒæ‰“å¼€äº†æˆ‘çš„å¥½å¥‡å¿ƒæ½˜å¤šæ‹‰é­”ç›’ï¼Œè¶Šæ¥è¶ŠåƒçŸ¥é“å…³äºç”Ÿå‘½ç§‘å­¦çš„çŸ¥è¯†ï¼Œå°±åœ¨ Amazon ä¸Šæœäº†ä¸€ä¸‹ä»–çš„ä¹¦ï¼Œè¿˜çœŸçš„æœ‰ä¸€æœ¬ï¼Œå°± get åˆ°å•¦ã€‚</p><blockquote><p>è¿™æ˜¯ä¸€æœ¬ä»åˆ†å­ç»†èƒå°ºåº¦ä¸Šè®²è§£ç”Ÿå‘½å¥¥ç§˜çš„ç§‘æ™®å°ä¹¦ã€‚ç”¨å¹³å®æµ…æ˜¾çš„è¯­è¨€è§£é‡Šäº†å¤æ‚ç”Ÿå‘½ç³»ç»Ÿçš„ä¸€äº›åŸºæœ¬çŸ¥è¯†ã€‚ è®©æˆ‘äº†è§£äº†äººä½“æ˜¯ç”±60ä¸‡äº¿ä¸ªç»†èƒç»„æˆçš„å¤æ‚ç³»ç»Ÿï¼Œè›‹ç™½è´¨å¯¹ç”Ÿå‘½ä½“çš„é‡è¦æ„ä¹‰ï¼Œäº†è§£äº†æ‰€æœ‰ç”Ÿç‰©ä»åˆ†å­å±‚é¢ä¸Šæ˜¯åŸºæœ¬ä¸€è‡´çš„ã€å…·æœ‰å…±åŒçš„ç¥–å…ˆã€‚ä¹¦ä¸­è§£é‡Šäº†å…ˆæœ‰è›‹å†æœ‰é¸¡çš„ç»“è®ºï¼Œè§£é‡Šäº†å¯¹ç‰›å¼¹ç´çš„ç§‘å­¦ä¾æ®ã€‚ç»™è¿™äº›â€œåƒå¤å¥‡æ¡ˆâ€ä»¥â€œç§‘å­¦å®šè®ºâ€ã€‚è¿˜æœ‰å¾ˆå¤šå¹³æ—¶æˆ‘ä»¬ä½“ä¼šåˆ°äº†ä½†æ˜¯æ²¡æœ‰æ·±æƒ³çš„ç”Ÿå‘½ç°è±¡ï¼Œä½œè€…éƒ½ç»™å‡ºäº†æœ‰æ„æ€çš„æè¿°å’Œè§£é‡Šã€‚ æœ€åä¸€ç« è§£é‡Šäº†ç¥ç»ç³»ç»Ÿçš„å¤æ‚ç¨‹åº¦ï¼Œè®©æˆ‘ä»ç”Ÿç‰©å­¦æ„ä¹‰ä¸Šäº†è§£äº†æ—¶ä¸‹å¤§çƒ­çš„äººå·¥æ™ºèƒ½æ·±åº¦å­¦ä¹ æŠ€æœ¯çš„ç”Ÿç‰©å­¦åŸºç¡€ã€‚ ä¸è¿‡ï¼Œæœ€åä¸€ç« åœ¨å…¨ä¹¦ä¸­å äº†å¤§çº¦å››åˆ†ä¹‹ä¸€çš„ç¯‡å¹…ï¼Œä¸ªäººæ„Ÿè§‰ç”¨åŠ›ä¸å‡ã€‚æˆ‘æ˜¯è·³ç€çœ‹äº†äº›ç‰‡æ®µã€‚ ç„¶è€Œç‘•ä¸æ©ç‘œï¼Œå¯¹äºç”Ÿç‰©å­¦å°ç™½æ¥è¯´ï¼Œä¼šè®©ä½ å…¥è¿·çš„ã€‚æ„Ÿè°¢ä½œè€…ï¼</p></blockquote><p>çœ‹è¿™æœ¬ä¹¦å’Œä»–çš„åšå®¢ä¸€æ ·ç²¾å½©ï¼Œå¦å¤–è¿˜å‡ºäº†å¦ä¸€æœ¬ä¹¦ã€Šç”Ÿå‘½é€šå²ã€‹ï¼Œçœ‹äº†ä¸€ä¸‹ç›®å½•å’Œä»–åšå®¢é‡Œå†™çš„å†…å®¹åŠå…¶ç›¸ä¼¼ï¼Œç­‰åˆ°ä»¥åå†ä¹°æœ¬çº¸è´¨ç‰ˆçš„çœ‹ã€‚æƒ³èµ·æ¥äº†å¤§å­¦æ—¶æ›¾è¯»è¿‡çš„ä¸€æœ¬ä¹¦ã€Šç”Ÿå‘½çš„è·ƒå‡ã€‹ï¼Œæˆ‘è§‰ç€äºŒè€…ä¹‹é—´æ¯”è¾ƒç›¸ä¼¼ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/tjOSuGPhu7" target="_blank" rel="noopener">ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥</a></p><h3 id="ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ"><a href="#ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ" class="headerlink" title="ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ"></a>ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ</h3><p>ç‰›æ´¥é€šè¯†è¯»æœ¬ç³»åˆ—çš„ä¹¦ç±å¤§æ¦‚æœ‰ä¸‰åå‡ æœ¬ï¼Œåœ¨ Amazon ä¸Š Kindle Unlimited ä¼šå‘˜æ˜¯å¯ä»¥å…è´¹å€Ÿé˜…ã€‚åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸€äº›ä¸€ä¸¤ç™¾é¡µå­ã€‚è¿™æœ¬å…³äºåœ°çƒç§‘æ™®å°å†Œå­ç®€å•åœ°ä»‹ç»äº†ä¸€ä¸‹åœ°çƒçš„åœ°çƒçš„å½¢æˆã€å†…æ ¸ã€åœ°ç£åœºã€ç«å±±è¿åŠ¨ç­‰çŸ¥è¯†ã€‚æ€»ä¹‹è¯»èµ·æ¥å¯ä»¥æ»¡è¶³ä¸€ä¸‹è‡ªå·±çš„å¥½å¥‡å¿ƒå•¦ğŸ˜‹</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/ExJxAKtv8d" target="_blank" rel="noopener">ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ</a></p><h3 id="ä¸ƒå ‚æç®€ç‰©ç†è¯¾"><a href="#ä¸ƒå ‚æç®€ç‰©ç†è¯¾" class="headerlink" title="ä¸ƒå ‚æç®€ç‰©ç†è¯¾"></a>ä¸ƒå ‚æç®€ç‰©ç†è¯¾</h3><p>è™½ç„¶è¢«æ§å¾—å¾ˆå¥½ï¼Œä½†è§‰ç€æ²¡å•¥å¥½çœ‹çš„â€¦â€¦ğŸ™„</p><h3 id="é¸Ÿç°å¤æ–‡æ˜"><a href="#é¸Ÿç°å¤æ–‡æ˜" class="headerlink" title="é¸Ÿç°å¤æ–‡æ˜"></a>é¸Ÿç°å¤æ–‡æ˜</h3><p>è¿™æœ¬ä¹¦æ˜¯æœ‹å‹é€çš„ï¼Œä¹Ÿæ˜¯ 2020 å¹´è¯»è¿‡æœ€å–œæ¬¢çš„ä¹¦ï¼Œä¹¦ä¸­çš„æ’å›¾ç›¸å½“ç²¾ç¾</p><p>ä¹¦ä¸­æåˆ°è¿‡åºè´å¤åŸï¼Œå½“æ—¶æ‰¾äº†ä¸¤æœŸçºªå½•ç‰‡æ¥çœ‹ï¼š</p><ul><li><a href="https://www.bilibili.com/video/BV1aK4y1e7k7" target="_blank" rel="noopener">ã€çºªå½•ç‰‡ã€‘åºè´å¤åŸ æ­ç§˜è¢«å†»ç»“äºæ—¶å…‰ä¸­çš„äººã€åŒè¯­ç‰¹æ•ˆå­—å¹•ã€‘ã€çºªå½•ç‰‡ä¹‹å®¶å­—å¹•ç»„ã€‘</a></li><li><a href="https://www.bilibili.com/video/BV1jT4y1373W" target="_blank" rel="noopener">ã€çºªå½•ç‰‡ã€‘åºè´ å°˜åŸƒè½å®šã€1080pã€‘ã€åŒè¯­ç‰¹æ•ˆå­—å¹•ã€‘ã€çºªå½•ç‰‡ä¹‹å®¶å­—å¹•ç»„ã€‘</a></li></ul><blockquote><p>  130å¹…åŸå¸‚å¤åŸå›¾ï¼Œé‡ç°å¤æ–‡æ˜å…¨æ™¯</p><p>  å€Ÿç”±ç»†è…»ç”»ç¬”ï¼Œæº¯ç€æ—¶é—´ä¹‹æµï¼Œè§¦ç¢°åƒå¹´å‰çš„ç¹åå·¨æ¢¦</p><p>  ä»¥åœ°ä¸­æµ·æ²¿å²¸ä¸ºä¸­å¿ƒï¼Œæ¨ªè·¨ä¹å¤§åœ°åŸŸï¼Œè¿‘ç™¾åº§å»ºç­‘ç¾¤è·ƒç„¶çœ¼å‰</p><p>  å®ƒä»¬æ˜¯å¤ä»£ç»Ÿæ²»è€…é›„å¿ƒä¸æŠ±è´Ÿçš„è§è¯</p><p>  ä¹Ÿæ˜¯æˆ‘ä»¬ç†è§£å¤å¸Œè…Šã€ç½—é©¬ã€åŸƒåŠæ–‡æ˜çš„æœ€ä½³é€”å¾„</p><p>  ğŸŒŸ æ‰€æœ‰ä¼Ÿå¤§çš„åŸå¸‚ï¼Œéƒ½æ˜¯åœ¨ä¿¡å¿µä¸æ¢¦æƒ³ä¸­å»ºæ„è€Œæˆã€‚</p><p>  å®ƒä»¬å¹¶ä¸åªè¾‰ç…Œäºå†å²ï¼Œå…¶å…‰èŠ’ä¹Ÿç…§è€€äº†åä¸–å‰è¿›ä¹‹è·¯ã€‚</p><p>  ğŸŒŸ å¤ä»£åŸå¸‚å¤åŸé¢†åŸŸå·¨æ“˜è®©-å…‹åŠ³å¾·Â·æˆˆå°”ä¸‡å‡­å€Ÿé›†ç»˜ç”»ã€å»ºç­‘ä¸è€ƒå¤å­¦äºä¸€èº«çš„å¤©èµ‹ï¼Œ å°†é‚£äº›åŒ–ä¸ºå°˜åœŸï¼Œé¢“æˆæ®‹å£çš„å¤è€åºŸå¢Ÿé‡æ–°ä¿®è‘ºã€‚</p></blockquote><p><img src="https://p.k8s.li/20200403_043253117_iOS.jpg" alt=""><br><img src="https://p.k8s.li/20200405_162332630_iOS.jpg" alt=""><br><img src="https://p.k8s.li/20200405_162437116_iOS.jpg" alt=""><br><img src="https://p.k8s.li/20200406_101134106_iOS.jpg" alt=""><br><img src="https://p.k8s.li/20200406_102610423_iOS.jpg" alt=""></p><h3 id="å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾"><a href="#å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾" class="headerlink" title="å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾"></a>å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾</h3><p>ä¸é”™çš„å¤©ä½“ç‰©ç†å­¦ç§‘æ™®ï¼Œæ˜¯è‘—åçš„å…¨çƒç•…é”€ä¹¦ä½œå®¶å¸ƒè±æ©Â·è€ƒå…‹æ–¯å’Œæ°å¤«Â·ç¦ä¿®çš„å…¨æ–°åŠ›ä½œã€‚è¿™æ˜¯ä¸€æœ¬å…³äºå®‡å®™å†å²çš„ç§‘æ™®è¯»ç‰©ã€‚å…¨ä¹¦åˆ†ä¸ºå®‡å®™çš„æ•…äº‹ã€å¤ªé˜³æœ‰å¤šè€ã€ç»™åœ°çƒç§°é‡ã€åˆ°æ’æ˜Ÿçš„è·ç¦»ã€çˆ±å› æ–¯å¦å¼•åŠ›è®ºã€å¤§çˆ†ç‚¸ã€ç»™å®‡å®™ç§¤é‡ã€å¤§çˆ†ç‚¸ä¹‹å‰å‘ç”Ÿäº†ä»€ä¹ˆã€æˆ‘ä»¬çš„ä¸–ç•Œä¹éƒ¨åˆ†ç»„æˆã€‚ä¹¦ä¸­ç”¨åˆ°çš„æ–¹æ³•è€¶ååˆ†æœ‰è¶£ï¼Œä¾‹å¦‚åˆ©ç”¨å¸†å¸ƒèƒŒåŒ…é‡Œè£…ä¸Šä¸¤ä¸ªGPS æ¥æ”¶å™¨æ¥æµ‹é‡å¤ªé˜³æœ‰å¤šè€ï¼›åˆ©ç”¨åœ¨å¸ƒé‡Œæ–¯æ‰˜å°”æµ·å³¡çš„æµ·å¹³é¢ä¸Šçš„ä¸€ä¸ªæµ®æ ‡ï¼Œæ¥ç»™åœ°çƒçš„å¤§å°åšä¸€ä¸ªå¤§è‡´çš„æµ‹é‡ğŸ˜‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/qDg3uQqKW5" target="_blank" rel="noopener">å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾</a></p><h3 id="å®‡å®™ä»èµ·æºåˆ°æœªæ¥"><a href="#å®‡å®™ä»èµ·æºåˆ°æœªæ¥" class="headerlink" title="å®‡å®™ä»èµ·æºåˆ°æœªæ¥"></a>å®‡å®™ä»èµ·æºåˆ°æœªæ¥</h3><p><code>æ‘˜æŠ„</code> <a href="https://t.co/zDlbJOshP1" target="_blank" rel="noopener">å®‡å®™ä»èµ·æºåˆ°æœªæ¥</a></p><h3 id="Life-ç”Ÿå‘½"><a href="#Life-ç”Ÿå‘½" class="headerlink" title="Life ç”Ÿå‘½"></a>Life ç”Ÿå‘½</h3><p><code>æ‘˜æŠ„</code> <a href="https://t.co/d1FD3UtnXV" target="_blank" rel="noopener">Life ç”Ÿå‘½</a></p><h3 id="å¤æ‚ç”Ÿå‘½çš„èµ·æº"><a href="#å¤æ‚ç”Ÿå‘½çš„èµ·æº" class="headerlink" title="å¤æ‚ç”Ÿå‘½çš„èµ·æº"></a>å¤æ‚ç”Ÿå‘½çš„èµ·æº</h3><p>è¿™æœ¬ä¹¦æ˜¯ä» Twitter ä¸Šå‘ç°çš„ï¼Œ2020 å¹´ 11 æœˆä»½åˆšå‡ºç‰ˆï¼ŒKindle å•†åº—é‡Œæœ‰ç”µå­ç‰ˆï¼Œçœ‹åˆ°ä½œè€…æ˜¯<strong>å°¼å…‹Â·è±æ©</strong>æ—¶å°±æƒ³åˆ°ä¹‹å‰è¯»è¿‡ä»–çš„ã€Šç”Ÿå‘½çš„è·ƒå‡ã€‹ï¼Œå°±æ¯«ä¸çŠ¹è±«åœ°ä¹°äº†èŠ±äº†ä¸€å‘¨çš„æ—¶é—´è¯»å®Œäº†ã€‚å› ä¸ºè¯»è¿‡ä»–çš„ã€Šç”Ÿå‘½çš„è·ƒå‡ã€‹ï¼Œåœ¨è¯»è¯»è¿™æœ¬ä¹¦çš„æ—¶å€™å¾ˆå¤šå†…å®¹å°±ä¼¼æ›¾ç›¸è¯†ã€‚</p><ul><li>çº¿ç²’ä½“æœçœŸæ˜¯åå‰¯å…¶å®çš„â€œå‘ç”µæœºâ€ğŸ˜‚</li></ul><blockquote><p>  è´¨å­è¿˜æ˜¯å¸¦ç”µç²’å­ï¼Œå¸¦ä¸€ä¸ªå•ä½çš„æ­£ç”µè·ã€‚æ‰€ä»¥æŠŠè´¨å­æ³µè¿‡ä¸€å±‚å°é—­çš„è†œäº§ç”Ÿäº†ä¸¤ä¸ªæ•ˆæœï¼šç¬¬ä¸€ï¼Œåœ¨è†œçš„ä¸¤è¾¹åˆ¶é€ äº†è´¨å­çš„æµ“åº¦å·®ï¼›ç¬¬äºŒï¼Œè†œçš„ä¸¤è¾¹å½¢æˆäº†ç”µä½å·®ï¼Œå¤–éƒ¨ç¯å¢ƒç›¸å¯¹äºå†…éƒ¨æ˜¯æ­£ç”µä½ï¼Œè†œå†…è†œå¤–çš„ç”µä½å·®æ˜¯150ï½200æ¯«ä¼ã€‚ä¸è¦å°çœ‹è¿™ä¸ªæ•°å­—ï¼Œå› ä¸ºè†œæœ¬èº«éå¸¸è–„ï¼ˆåšåº¦ä¸º6çº³ç±³å·¦å³ï¼‰ï¼Œåœ¨è¿™ä¹ˆçŸ­çš„è·ç¦»ä¸Šï¼Œè¿™æ˜¯éå¸¸å¼ºå¤§çš„ç”µåŠ¿èƒ½åœºã€‚ä½ å¯ä»¥å†æ¬¡å˜å›ATPçš„å¤§å°å»ä½“éªŒä¸€ä¸‹ã€‚å¦‚æœå¾…åœ¨è†œé™„è¿‘ï¼Œä½ æ„Ÿå—åˆ°çš„ç”µåœºå¼ºåº¦æ˜¯æ¯ç±³ä¸‰åƒä¸‡ä¼ç‰¹ï¼Œç›¸å½“äºä¸€é“é—ªç”µï¼Œæˆ–è€…æ˜¯æ™®é€šå®¶ç”¨ç”µçš„1,000å€ã€‚</p></blockquote><ul><li>åœ¨è¯»ã€Šç”Ÿå‘½é€šå²ã€‹çš„æ—¶å€™é‡Œé¢ä¹Ÿè°ˆåˆ°è¿‡çœŸæ ¸ç»†èƒæ¼”åŒ–å‡ºç»†èƒæ ¸çš„åŸå› ï¼š</li></ul><blockquote><p>  ç»†èƒæ ¸è†œå°±æ˜¯è¿™é“éšœç¢ï¼Œå¯ä»¥æŠŠè½¬å½•å’Œè½¬è¯‘ä¸¤ä¸ªè¿‡ç¨‹åˆ†å¼€ã€‚åœ¨ç»†èƒæ ¸ä¸­ï¼ŒåŸºå› è¢«è½¬å½•æˆRNAè½¬å½•æœ¬ï¼›åœ¨ç»†èƒæ ¸å¤–ï¼Œæ ¸ç³–ä½“ä¼šè¯»å–RNAï¼Œå†è½¬è¯‘æˆè›‹ç™½è´¨ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œç¼“æ…¢çš„å‰ªæ¥è¿‡ç¨‹åœ¨ç»†èƒæ ¸å†…è¿›è¡Œï¼Œåœ¨æ ¸ç³–ä½“æœ‰æœºä¼šæ¥è§¦åˆ°RNAä¹‹å‰å·²ç»å¤„ç†å®Œæ¯•ã€‚è¿™å°±æ˜¯ç»†èƒæ ¸çœŸæ­£çš„æ„ä¹‰ï¼šæŠŠå¹²åŠ²å†²å¤©çš„æ ¸ç³–ä½“æŒ¡åœ¨å¤–é¢ã€‚è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆçœŸæ ¸ç”Ÿç‰©éœ€è¦ç»†èƒæ ¸ï¼Œè€ŒåŸæ ¸ç”Ÿç‰©ä¸éœ€è¦ã€‚åŸæ ¸ç”Ÿç‰©æ ¹æœ¬æ²¡æœ‰å†…å«å­çš„éº»çƒ¦ã€‚</p></blockquote><blockquote class="twitter-tweet"><p lang="zh" dir="ltr"><a href="https://twitter.com/hashtag/%E9%89%B4%E4%B9%A6?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#é‰´ä¹¦</a> ç»ˆäºå‡ºä¸­æ–‡ç‰ˆäº†ï¼æˆ‘è¿˜æ²¡æœ‰è¯»è¿‡ï¼Œä¸çŸ¥é“ç¿»è¯‘å¾—æ€æ ·ã€‚åŸä¹¦çš„è‹±æ–‡ç‰ˆæ˜¯æˆ‘è¯»è¿‡çš„æœ€æ£’çš„ç§‘æ™®ä¹¦ä¹‹ä¸€ï¼Œåœ¨æˆ‘å¿ƒç›®ä¸­çš„åœ°ä½å’Œã€Šè‡ªç§çš„åŸºå› ã€‹ã€ã€Šæªç‚®ç—…èŒä¸é’¢é“ã€‹å’Œã€Šæ— ç©·çš„å¼€å§‹ã€‹å·®ä¸å¤šã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™4æœ¬ä¹¦æ˜¯ç°ä»£çŸ¥è¯†åˆ†å­çš„å¿…è¯»ä¹¦ï¼Œç¼ºä¸€æœ¬ä½ éƒ½ä¸å®Œæ•´ã€‚ <a href="https://t.co/ohO7iID6be" target="_blank" rel="noopener">pic.twitter.com/ohO7iID6be</a></p>&mdash; immusoul (@ayuan1000) <a href="https://twitter.com/ayuan1000/status/1332641409510215680?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">November 28, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>å¦å¤–æ¨èä¸‹é¢å‡ æœŸè§†é¢‘èŠ‚ç›®ï¼Œä¹Ÿä¸è¿™æœ¬ä¹¦çš„å†…å®¹æœ‰å¾ˆå¤§å…³ç³»ã€‚</p><ul><li><a href="https://www.bilibili.com/video/BV185411h79H" target="_blank" rel="noopener">ã€é¬¼è°·é—²è°ˆã€‘åœ¨é‚£å……æ»¡æ¯’ä¸ç«çš„æ·±æ¸Šä¸­ï¼Œç§‘å­¦å®¶å‘ç°äº†ç”Ÿå‘½æœ¬æºçš„çº¿ç´¢</a></li><li><a href="https://www.bilibili.com/video/BV1Qh411R7Zf" target="_blank" rel="noopener">ã€é¬¼è°·é—²è°ˆã€‘ç´«è‰²åœ°çƒï¼šä¸€ä¸ªæ€ç”Ÿä»¥æŠ¤ç”Ÿçš„æ•…äº‹</a></li><li><a href="https://www.bilibili.com/video/BV1NT4y1w7vD" target="_blank" rel="noopener">ã€é¬¼è°·é—²è°ˆã€‘ä¸€æ¬¡æ”¹å†™ç”Ÿå‘½æ¼”åŒ–çš„é‚‚é€…</a></li><li><a href="https://www.youtube.com/watch?v=GPYn1vJh1Q0" target="_blank" rel="noopener">ç§‘å­¦å£°éŸ³ï¼šç”Ÿå‘½èµ·æº</a></li><li><a href="https://www.bilibili.com/video/BV1N54y1R7CM" target="_blank" rel="noopener">ã€Šå®‡å®™æ—¶ç©ºä¹‹æ—…ï¼šæœªçŸ¥ä¸–ç•Œã€‹03ï¼šå¤±è½çš„ç”Ÿå‘½ä¹‹åŸ</a> å¢™è£‚æ¨èğŸ˜Š</li></ul><p>å¦å¤–å†æ¨èè±†ç“£å°ç»„ä¸Šçš„ç¯‡æ–‡ç«  <a href="https://www.douban.com/group/topic/33656795/" target="_blank" rel="noopener">1978å¹´åŒ–å­¦è¯ºå¥–ï¼šATPã€çº¿ç²’ä½“ç»“æ„å’Œæœ‰æ°§å‘¼å¸</a></p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/soPnC8gnbs" target="_blank" rel="noopener">å¤æ‚ç”Ÿå‘½çš„èµ·æº</a></p><h3 id="ç”Ÿå‘½çš„è·ƒå‡"><a href="#ç”Ÿå‘½çš„è·ƒå‡" class="headerlink" title="ç”Ÿå‘½çš„è·ƒå‡"></a>ç”Ÿå‘½çš„è·ƒå‡</h3><p>è¿™æœ¬ä¹¦åœ¨å¤§å­¦çš„æ—¶å€™è¯»è¿‡ä¸€éï¼Œé‚£æ—¶å€™æ˜¯çœ‹çš„ <a href="https://www.bilibili.com/video/BV1wx41177Tm" target="_blank" rel="noopener">æŸ´çŸ¥é“ï¼šå…­åˆ†é’Ÿé€Ÿè¯»ã€Šç”Ÿå‘½çš„è·ƒå‡ã€‹</a> æ‰è®¤è¯†åˆ°è¿™æœ¬ä¹¦ï¼Œåœ¨è¯»å®Œ </p><p>ã€Šå¤æ‚ç”Ÿå‘½çš„èµ·æºã€‹çš„èµ·æºååˆå†³å®šé‡æ–°å›é¡¾ä¸€ä¸‹è¿™æœ¬ä¹¦ï¼Œé‡è¯»äº†ä¸€éã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/50bSWvIOAd" target="_blank" rel="noopener">ç”Ÿå‘½çš„è·ƒå‡</a></p><p>å…³äºä½œè€…å°¼å…‹Â·è±æ©ï¼Œå‰½çªƒä¸€æ®µè±†ç“£ä¸Šçš„ç®€ä»‹ï¼š</p><blockquote><p>  å°¼å…‹Â·è±æ©ï¼ˆNick Laneï¼‰ï¼Œæ¼”åŒ–ç”Ÿç‰©å­¦å®¶ï¼Œè‹±å›½ä¼¦æ•¦å¤§å­¦å­¦é™¢æ•™æˆã€‚ä»–çš„ç ”ç©¶æ–¹å‘ä¸ºæ¼”åŒ–ç”Ÿç‰©å­¦ä¸ç”Ÿç‰©èƒ½é‡å­¦ï¼Œèšç„¦äºç”Ÿå‘½çš„èµ·æºä¸å¤æ‚ç»†èƒçš„æ¼”åŒ–ã€‚ä»–è¿˜æ˜¯ä¼¦æ•¦å¤§å­¦å­¦é™¢çº¿ç²’ä½“ç ”ç©¶å­¦ä¼šçš„åˆ›å§‹æˆå‘˜ï¼Œä¹Ÿæ˜¯ç”Ÿå‘½èµ·æºç ”ç©¶è®¡åˆ’çš„é¡¹ç›®é¢†å¤´äººã€‚2010å¹´ï¼Œä»–ä»¥ã€Šç”Ÿå‘½çš„è·ƒå‡ã€‹è£è·è‹±å›½çš‡å®¶å­¦ä¼šç§‘å­¦å›¾ä¹¦å¥–ã€‚å°¼å…‹æœ¬äººå› ä¸ºåœ¨åˆ†å­ç”Ÿç‰©å­¦ç ”ç©¶ä¸Šçš„å“è¶Šè´¡çŒ®ï¼Œäº2015å¹´è£è·è‹±å›½ç”Ÿç‰©åŒ–å­¦å­¦ä¼šå¥–ã€‚ä»–ä¸ä»…æ·±è€•è‡ªå·±çš„å­¦æœ¯ç ”ç©¶é¢†åŸŸï¼Œè¿˜å­œå­œä¸å€¦åœ°å‚ä¸å…¬ä¼—ç§‘å­¦æ™®åŠã€‚2016å¹´ï¼Œå°¼å…‹å› ä¸ºåœ¨ç§‘å­¦ä¼ æ’­ä¸Šçš„æ·±å…¥ä»˜å‡ºè€Œè£è·è‹±å›½çš‡å®¶å­¦ä¼šè¿ˆå…‹å°”Â·æ³•æ‹‰ç¬¬å¥–ç« ã€‚</p></blockquote><p>æœ€è¿‘ä¹Ÿåœ¨è¯»ä»–çš„<a href="https://search.books.com.tw/redirect/move/key/å°¼å…‹â€§é€£æ©/area/mid/item/0010730616/page/1/idx/2/cat/001/pdf/1" target="_blank" rel="noopener">ç”Ÿå‘½ä¹‹æºï¼šèƒ½é‡ã€æ¼”åŒ–èˆ‡è¤‡é›œç”Ÿå‘½çš„èµ·æº</a>ï¼Œå°æ¹¾è²“é ­é·¹å‡ºç‰ˆå‡ºç‰ˆçš„ï¼Œå¤§é™†è¿˜æ²¡æœ‰ï¼Œåªèƒ½ä¹°ç¹ä½“çš„çº¸è´¨ä¹¦æ¥çœ‹ã€‚å¦å¤–è¿˜æœ‰ä¸€æœ¬ã€Š<a href="https://search.books.com.tw/redirect/move/key/å°¼å…‹â€§é€£æ©/area/mid/item/0010874343/page/1/idx/1/cat/001/pdf/1" target="_blank" rel="noopener">èƒ½é‡ã€æ€§ã€æ­»äº¡ï¼šç²’ç·šé«”èˆ‡æˆ‘å€‘çš„ç”Ÿå‘½(15å‘¨å¹´æ–°ç‰ˆ)</a>ã€‹ã€‚è¿™ä¸¤æœ¬éƒ½èƒ½åœ¨æŸå®ä¸Šä»£è´­ä¹°åˆ°ï¼Œæˆ–è€…é€šè¿‡ <a href="https://www.books.com.tw/products/0010730616?sloc=main" target="_blank" rel="noopener">åšå®¢æ¥</a> ä»£è´­ä¹°åˆ°ã€‚</p><p><img src="https://p.k8s.li/image-20210109225801483.png" alt=""></p><h3 id="æ¶ˆå¤±çš„å¾®ç”Ÿç‰©ï¼šæ»¥ç”¨æŠ—ç”Ÿç´ å¼•å‘çš„å±æœº"><a href="#æ¶ˆå¤±çš„å¾®ç”Ÿç‰©ï¼šæ»¥ç”¨æŠ—ç”Ÿç´ å¼•å‘çš„å±æœº" class="headerlink" title="æ¶ˆå¤±çš„å¾®ç”Ÿç‰©ï¼šæ»¥ç”¨æŠ—ç”Ÿç´ å¼•å‘çš„å±æœº"></a>æ¶ˆå¤±çš„å¾®ç”Ÿç‰©ï¼šæ»¥ç”¨æŠ—ç”Ÿç´ å¼•å‘çš„å±æœº</h3><p>å½“èƒå„¿é€šè¿‡é˜´é“çš„æ—¶å€™ï¼Œåè€…å°±åƒä¸€åªå¯Œæœ‰å¼¹æ€§çš„æ‰‹æŒï¼Œç´§ç´§åœ°åŒ…è£¹ä½å©´å„¿æŸ”è½¯çš„èº«ä½“ï¼ŒæŠšæ‘¸è¿‡æ¯ä¸€å¯¸è‚Œè‚¤ã€‚å°±æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç»†èŒè½¬ç§»å‘ç”Ÿäº†ã€‚å©´å„¿çš„çš®è‚¤å°±åƒæµ·ç»µï¼Œå¸æ”¶äº†å®ƒå‘¨å›´çš„ä¹³é…¸æ†èŒã€‚èƒå„¿çš„è„‘è¢‹æœä¸‹ï¼Œè€Œä¸”é¢å¯¹ç€æ¯äº²çš„èƒŒéƒ¨ï¼Œæ°å¥½è´´åˆç€äº§é“ã€‚å©´å„¿å¸å…¥çš„ç¬¬ä¸€å£æ±æ¶²åŒ…å«äº†æ¯äº²é˜´é“é‡Œçš„å¾®ç”Ÿç‰©ï¼Œä¹Ÿä¸æ’é™¤æœ‰ä¸€å®šçš„è‚ é“å¾®ç”Ÿç‰©ã€‚å¤©ç„¶çš„åˆ†å¨©å¹¶ä¸æ˜¯ä¸€ä¸ªæ— èŒçš„è¿‡ç¨‹ï¼Œä½†æ˜¯å®ƒä»æ¥éƒ½æ˜¯è¿™ç§çŠ¶æ€â€”â€”ä»æˆ‘ä»¬æœ€æ—©çš„å“ºä¹³åŠ¨ç‰©ç¥–å…ˆç®—èµ·ï¼Œè‡³å°‘7000ä¸‡å¹´äº†ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/CpTb1LusIP" target="_blank" rel="noopener">æ¶ˆå¤±çš„å¾®ç”Ÿç‰©ï¼šæ»¥ç”¨æŠ—ç”Ÿç´ å¼•å‘çš„å±æœº</a></p><h2 id="æ¼«ç”»-å°è¯´"><a href="#æ¼«ç”»-å°è¯´" class="headerlink" title="æ¼«ç”»/å°è¯´"></a>æ¼«ç”»/å°è¯´</h2><h3 id="å¿ƒé‡Œæµ‹é‡è€…"><a href="#å¿ƒé‡Œæµ‹é‡è€…" class="headerlink" title="å¿ƒé‡Œæµ‹é‡è€…"></a>å¿ƒé‡Œæµ‹é‡è€…</h3><p>è¯»åæ„Ÿå¯ä»¥å‚è§ <a href="https://blog.k8s.li/PSYCHO-PASS-booklist.html">PSYCHO-PASS å¿ƒç†æµ‹é‡è€…å°è¯´è¯»åæ„Ÿ</a>ï¼Œè¿™éƒ¨æ”¹ç¼–è‡ªåŠ¨æ¼«çš„å°è¯´åŸºæœ¬ä¸Šè¿˜åŸäº†æ•´ä¸ªç¬¬ä¸€éƒ¨åŠ¨ç”»å®Œæ•´çš„å‰§æƒ…ï¼Œæ€»ä¹‹ä¹Ÿæ˜¯å…³äºä¸€ä¸ªå¦‚ä½•æ„å»ºäººç±»ç¤¾ä¼šé¢˜æçš„å°è¯´ã€‚å°è¯´ä¸­ä¹Ÿæåˆ°äº†å¾ˆå¤šä¹¦ç±ï¼Œä¹Ÿæœ‰ç½‘å‹æ€»ç»“äº†ä¸€ä»½å¿ƒç†æµ‹é‡è€…ä¸­æåˆ°çš„ä¹¦ç±ï¼Œä¹¦å•å¦‚ä¸‹:</p><p>å…¶ä¸­å¢æ¢­çš„ä¹¦ä¹Ÿæ˜¯æˆ‘çœ‹äº†è¿™éƒ¨å°è¯´ä¹‹åæ‰å¼€å§‹è¯»çš„ï¼Œè¿˜æœ‰ä¸€æœ¬æ˜¯ç¦æŸ¯çš„ã€Šè§„è®­ä¸æƒ©ç½šï¼šç›‘ç‹±çš„è¯ç”Ÿã€‹ï¼Œå‰©ä½™ä»·å€¼é‚£æœŸè¢«å°æ€çš„èŠ‚ç›®é‡Œç½—æ–°è€å¸ˆä¹Ÿæåˆ°è¿‡è¿™æœ¬ä¹¦ã€‚é©¬å…‹æ€Â·éŸ¦ä¼¯çš„ä¹¦åœ¨ã€Šä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶ã€‹ä¸­æåˆ°ä¸å°‘ï¼Œå°¤å…¶æ˜¯å…³äºå®˜åƒšæ”¿æ²»çš„ï¼Œè€Œä¸”é©¬å…‹æ€Â·éŸ¦ä¼¯è¿˜å’Œå‰æ–‡æåˆ°çš„è·¯å¾·ç»´å¸ŒÂ·å†¯Â·ç±³å¡æ–¯ä¹Ÿæ˜¯ä¸€å¯¹å­¦æœ¯ä¸Šçš„å¥½åŸºå‹ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/gp1upTv3IK" target="_blank" rel="noopener">å¿ƒé‡Œæµ‹é‡è€…</a></p><h3 id="è´¹é©¬æœ€ç»ˆå®šç†"><a href="#è´¹é©¬æœ€ç»ˆå®šç†" class="headerlink" title="è´¹é©¬æœ€ç»ˆå®šç†"></a>è´¹é©¬æœ€ç»ˆå®šç†</h3><p>æ—¥ç³»ç‹—ç²®å°è¯´ğŸ•ï¼Œç¬¬ä¸€æ¬¡è¯»è¿™æœ¬ä¹¦è¿˜æ˜¯å¤§ä¸‰çš„æ—¶å€™ï¼Œ<del>é‚£æ—¶å€™å’±åˆšåˆšå¼€å§‹äº†äººç”Ÿçš„ç¬¬ä¸€æ¬¡åˆæ‹ï¼Œå¹¶æŠŠè¿™æœ¬ä¹¦é€ç»™äº†å‰å¥³å‹</del>ğŸ¤£ã€‚åŒæ ·çš„å°è¯´è¿˜æœ‰ã€Šæ•°å­¦å¥³å­©ã€‹ï¼Œåè€…çš„è¯„ä»·å¾ˆé«˜ï¼Œä½†æƒ³è¦é€šè¿‡å°è¯´æ¥å­¦ä¹ æ•°å­¦æ˜¯ç—´å¿ƒå¦„æƒ³å•¦ã€‚å˜›ï¼Œå°è¯´å°±æ˜¯å…´è¶£è¯»ç‰©ï¼Œç»™è¿™äº›æ¯ç‡¥ä¼šè‰²çš„æ•°å­¦å…¬å¼å¢åŠ ä¸€ç‚¹è‰²å½©~~</p><p>è™½ç„¶å¯¹äºæ•°å­¦æ¥è®²ï¼Œå’±æœ¨å­ç®€ç›´æ˜¯ä¸ªå­¦è„†ğŸ˜­ï¼Œé«˜è€ƒæ•°å­¦è€ƒäº† 60 å‡ åˆ†ï¼Œè¿™ä¹Ÿè®©å’±ä¸åç‰Œå¤§å­¦å¤±ä¹‹äº¤è‡‚ï¼Œåªèƒ½å»è¯»ç¬¬å…­çº§æœ¬ç§‘é™¢æ ¡ğŸ˜‘ï¼Œå¤šå°‘æœ‰ç‚¹é—æ†¾å§ã€‚ä¸è¿‡çº³ï¼Œå¯¹äºé‚£äº›æ¯ç‡¥æ— æ¯”çš„è®¡ç®—å…¬å¼æ±‚ç§¯åˆ†è§£å¾®åˆ†æ–¹ç¨‹ç­‰ï¼Œå’±æ›´å–œæ¬¢çŸ¥é“æ•°å­¦è¿™æœ¬å­¦ç§‘èƒŒåçš„å†å²ï¼šæƒ³çŸ¥é“ç‰›é¡¿å’Œè±å¸ƒå°¼èŒ¨ä¹‹é—´çš„æ’•é€¼å¤§æˆ˜ï¼Œæƒ³çŸ¥é“ä¼¯åŠªåŠ›å®¶æ—çš„æ©ä»‡æ€¨æ¨ï¼Œæƒ³çŸ¥é“ç¬›å¡å°”ä¸å…¬ä¸»çš„çˆ±æƒ…æ•…äº‹ï¼Œæƒ³çŸ¥é“æ¬§æ‹‰å¥‹ç¬”ç–¾ä¹¦éå‡¡çš„ä¸€ç”Ÿï¼Œæƒ³çŸ¥é“åºåŠ è±çŒœæƒ³ä¸<code>å®‡å®™çš„å½¢çŠ¶</code>ç­‰ç­‰ã€‚è¿™ä¹Ÿæ˜¯å’±å³ä¾¿æ¯•ä¸šç¦»å¼€å¤§å­¦ä¹‹åï¼Œä¸å†æ˜¯ä¸€åå­¦ç”Ÿä½†ä¹Ÿæ˜¯åƒå­¦ç”Ÿæ—¶ä»£çš„è‡ªå·±é‚£æ ·å¥½å¥‡å¿ƒå¦‚æ­¤åœ°æ—ºç››ğŸ˜‚</p><blockquote><p>ã€æˆ‘ä¸€ç›´è§‰å¾—ï¼Œè´¹é©¬ã€æ¬§æ‹‰ã€å“¥å¾·å·´èµ«ç­‰äººä¸ç°ä»£äººç›¸æ¯”ï¼Œä»–ä»¬å…·æœ‰æ ¼å¤–æ—ºç››çš„å¥½å¥‡å¿ƒå’Œä¸°å¯Œçš„æƒ³è±¡åŠ›ï¼Œå¹¶ä¸”å……æ»¡äº†ç”Ÿæœºä¸æ´»åŠ›ã€‚éšç€ç¤¾ä¼šå‘å±•çš„æ—¥ç›Šæˆç†Ÿï¼Œå¥½å¥‡å¿ƒå’Œæƒ³è±¡åŠ›ä¸å¯é¿å…åœ°ä¸æ–­é™ä½ï¼Œä½†å¹¶ä¸ä»£è¡¨ç°ä»£ç¤¾ä¼šä¸å†éœ€è¦å¥½å¥‡å¿ƒå’Œæƒ³è±¡åŠ›ã€‚ã€</p></blockquote><p><code>æ‘˜æŠ„</code> <a href="https://t.co/UqDfbYRjs7" target="_blank" rel="noopener">è´¹é©¬æœ€ç»ˆå®šç†</a></p><h3 id="æ¥è‡ªæ–°ä¸–ç•Œ"><a href="#æ¥è‡ªæ–°ä¸–ç•Œ" class="headerlink" title="æ¥è‡ªæ–°ä¸–ç•Œ"></a>æ¥è‡ªæ–°ä¸–ç•Œ</h3><p>å…ˆæ˜¯çœ‹å®Œçš„ TV åŠ¨ç”»ï¼Œåˆçœ‹çš„åŸåˆ›å°è¯´ã€‚è™½ç„¶å°è¯´ç§°ä¹‹ä¸ºæ˜¯åä¹Œæ‰˜é‚¦ä¹‹ä½œï¼Œä½†å®ƒä¸ã€Š1984ã€‹ã€ã€Šç¾ä¸½æ–°ä¸–ç•Œã€‹è¿™ç±»ä¹¦æœ‰ç€å¾ˆå¤§çš„ä¸åŒã€‚ä¹¦ä¸­å¹¶æ²¡æœ‰ç¬¦å·åŒ–ä¸€ä¸ªå¼ºåŠ¿çš„æ”¿åºœå½¢è±¡ï¼Œä¹Ÿæ²¡æœ‰ç»å¯¹çš„â€åäººâ€œã€‚</p><p><a href="https://t.co/JbLvSP4cP0" target="_blank" rel="noopener">æ¥è‡ªæ–°ä¸–ç•Œ</a></p><h3 id="æ¨±èŠ±åº„çš„å® ç‰©å¥³å­©"><a href="#æ¨±èŠ±åº„çš„å® ç‰©å¥³å­©" class="headerlink" title="æ¨±èŠ±åº„çš„å® ç‰©å¥³å­©"></a>æ¨±èŠ±åº„çš„å® ç‰©å¥³å­©</h3><p>å¤§å­¦çš„æ—¶å€™çœ‹è¿‡ TV åŠ¨ç”»ï¼ŒèŠ±äº†å‡ ä¸ªé€šå®µæ—¶é—´åˆè¯»å®Œäº†è¿™éƒ¨å°è¯´ã€‚</p><h3 id="æ˜Ÿé™…ç©¿è¶Š"><a href="#æ˜Ÿé™…ç©¿è¶Š" class="headerlink" title="æ˜Ÿé™…ç©¿è¶Š"></a>æ˜Ÿé™…ç©¿è¶Š</h3><p>å’Œæœ‹å‹ä¸€å—å»çœ‹å®Œæ˜Ÿé™…ç©¿è¶Šçš„ç”µå½±ååˆè¡¥çœ‹çš„å°è¯´ï¼Œæ€»ä½“ä¸Šä¸é”™ï¼Œé«˜åº¦è¿˜åŸäº†ç”µå½±ä¸­çš„æƒ…èŠ‚ã€‚</p><blockquote><p>  äº‹å®è¿˜ä¸æ­¢äºæ­¤ã€‚äººç±»ä¸æ˜¯ä¸€ç¾¤å­¤ç‹¬çš„ç”Ÿç‰©æœ‰æœºä½“ï¼Œè€Œæ˜¯ä¸€ä¸ªç§æ—å‘å±•ä¸Šç™¾ä¸‡å¹´çš„æœ€ç»ˆç»“æœï¼Œè•´å«ç€ä¸Šç™¾ä¸‡å¹´çš„æ¢ç´¢ã€ç¥è¯ã€ç¤¾ç¾¤ã€æˆ–é‡è¦æˆ–è’è°¬çš„æƒ³æ³•ã€è¯—æ­Œã€å“²å­¦ã€å·¥ç¨‹ã€ç§‘å­¦ã€‚</p></blockquote><blockquote><p>  è¯šç„¶ï¼Œå€ŸåŠ©è¿™ä»¶ä¸œè¥¿ï¼Œä»–å’Œå¸ƒå…°å¾·æ•™æˆèƒ½è®©æ•°åƒä¸ªç”Ÿç‰©å­¦æ„ä¹‰ä¸Šçš„äººç±»é™ç”Ÿäºä¸–ï¼Œä½†ä»–ä»¬ä¸¤äººå°±èƒ½çœŸæ­£æ›¿ä»£é”™ç»¼äº¤ç»‡çš„ä¼ æ‰¿å’Œå½’å±â€”â€”æ›¿ä»£çˆ±å—ï¼Ÿè¿™çœŸçš„æ˜¯åœ¨æ‹¯æ•‘äººç±»å—ï¼Ÿåœ¨æ£®æ—è¢«çƒ§ä¸ºå¹³åœ°ä¹‹å‰æŠ¢æ•‘å‡ºä¸€ç²’ç§å­ï¼Œå¹¶ä¸æ„å‘³ç€æ‹¯æ•‘äº†æ£®æ—ã€‚ç¹å¤è€Œç‹¬ç‰¹çš„ç”Ÿæ€ç³»ç»Ÿæ°¸è¿œæ— æ³•å¤åˆ¶ã€‚è§£å†»äººç±»èƒšèƒä¹Ÿç®—ä¸ä¸Šâ€œæ‹¯æ•‘â€äººç±»ã€‚</p></blockquote><p>æ‘˜æŠ„ <a href="https://t.co/Hmv8cWVB80" target="_blank" rel="noopener">æ˜Ÿé™…ç©¿è¶Š</a></p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;é¦–å…ˆç»™å„ä½å…³æ³¨æˆ‘åšå®¢çš„å°ä¼™ä¼´è¯´å£°æŠ±æ­‰ï¼Œå·²ç»å¾ˆé•¿æ—¶é—´ï¼ˆå°†è¿‘
        
      
    
    </summary>
    
    
      <category term="æ€è€ƒ" scheme="https://blog.k8s.li/categories/%E6%80%9D%E8%80%83/"/>
    
    
      <category term="é˜…è¯»" scheme="https://blog.k8s.li/tags/%E9%98%85%E8%AF%BB/"/>
    
      <category term="è¯»ä¹¦ç¬”è®°" scheme="https://blog.k8s.li/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>è½»é‡çº§å®¹å™¨ä¼˜åŒ–å‹ Linux å‘è¡Œç‰ˆ Photon OS</title>
    <link href="https://blog.k8s.li/Photon-OS.html"/>
    <id>https://blog.k8s.li/Photon-OS.html</id>
    <published>2020-09-24T16:00:00.000Z</published>
    <updated>2020-09-24T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‰æ®µæ—¶é—´æ¡åƒåœ¾ä¸œæ‹¼è¥¿å‡‘æäº†å° Homelab ğŸ‘‡ç©ç© ğŸ‘‰<a href="https://blog.k8s.li/homelab.html">ã€Šåƒåœ¾ä½¬çš„ Homelab æŠ˜è…¾è®°å½•ã€‹</a> ã€‚</p><p><img src="https://p.k8s.li/20200913_esxi_01.png" alt=""></p><p>æ€»ä½“æ¥è®²æ€§ä»·æ¯”é«˜ï¼ŒIntel i5-6600T çš„æ€§èƒ½å’Œ i5-6600 æŒå¹³ï¼Œæ¯”é‚£ç§ 8250U ä¹‹ç±»çš„ä½å‹ U è¦é«˜å¾ˆå¤šï¼Œè·‘ä¸€å †è™šæ‹Ÿæœºä¹Ÿä¸æˆé—®é¢˜ï¼Œç”šè‡³è·‘ä¸ªä¸‰ master + ä¸¤ node çš„ kubernetes é›†ç¾¤ä¹Ÿæ˜¯å¯ä»¥ğŸ˜‚ã€‚è‡³äºåŠŸè€—ï¼Œæ•´æœºå¾…æœºæ—¶ä¸åˆ° 30W ï¼Œä¸€å¤©ä¸åˆ° 1 åº¦ç”µï¼Œä¸ç”¨æ‹…å¿ƒç”µè´¹çˆ†è¡¨äº†ï¼›è‡³äºä»·æ ¼ï¼Œä¸€é¢— Intel i5-6600T  ä¸åˆ° 450 å—é’±ï¼Œè¿˜ä¸é¦™å˜›ğŸ™ƒã€‚</p><p>åœ¨ ESXi è¿è¡Œç€ä¸€äº›è™šæ‹Ÿæœºï¼Œæ¯”å¦‚ç”¨ WireGuard æ‰“é€š VPS ä¹‹é—´çš„ç½‘ç»œï¼Œè¿è¡Œåœ¨ä¸€ä¸ª alpine è™šæ‹Ÿæœºé‡Œä½œä¸ºç½‘å…³æœºä½¿ç”¨ï¼›æ¯”å¦‚ä½¿ç”¨ <a href="https://pi-hole.net/" target="_blank" rel="noopener">Pi-holeÂ®</a> æ¥æ„å»ºè‡ªå·±çš„ DNS æœåŠ¡å™¨ï¼Œç”¨æ¥æ‹¦æˆªå±è”½åŸŸåï¼›æ¯”å¦‚è¿è¡Œ time-machine æœåŠ¡ç”¨æ¥å®šæ—¶å¤‡ä»½ MacBook ï¼›æ¯”å¦‚ Windows è™šæ‹Ÿæœºé‡Œè¿è¡Œç€ä¸€äº›å›½äº§æ¯’ç˜¤è½¯ä»¶ğŸ˜¡ï¼›æ¯”å¦‚ä½¿ç”¨ <a href="https://docs.drone.io/" target="_blank" rel="noopener">Drone</a> è·‘ä¸€å¥—è½»é‡çº§çš„ CI æµæ°´çº¿ç³»ç»Ÿï¼Œæ€»ä¹‹å¯ç©æ€§éå¸¸é«˜å“¦ï¼Œåªè¦ä½ åˆæ—¶é—´çæŠ˜è…¾ï¼Œæ€»èƒ½æ‰¾ç‚¹ä¹å­ç©ğŸ˜‚ã€‚</p><h2 id="Linux-Container-OS"><a href="#Linux-Container-OS" class="headerlink" title="Linux Container OS ?"></a>Linux Container OS ?</h2><p>æœ‰äº†ä¸€å°è¿è¡Œç€ ESXi çš„ Homelab ï¼Œä»Šå¤©å°±ç©ä¸€ä¸‹ Linux container OS ï¼Œå³ Linux å®¹å™¨  OS ã€å®¹å™¨ä¼˜åŒ–å‹ OSï¼Œè¿™æ˜¯ä¸€ç±»ä¸“é—¨é’ˆå¯¹è¿è¡Œå®¹å™¨å®šåˆ¶åŒ–å¼€å‘çš„ Linux å‘è¡Œç‰ˆï¼Œè£å‰ªæ‰ä¸€äº›ä¸å¿…è¦çš„è½¯ä»¶å’Œå†…æ ¸æ¨¡å—ï¼Œä½¿ç³»ç»Ÿæ›´åŠ è½»é‡ä¸€äº›ã€‚è™½ç„¶æ¥è¯´æ°‘ç”¨çº§çš„ Intel i5-6600T æ€§èƒ½ä¹Ÿä¸ç®—å¤ªå·®ï¼Œä½†å’Œ E3  å°ç‹å­ï¼ŒE5 è€å¤§å“¥æ¯”è¿˜æ˜¯å·®ä¸ªåä¸‡å…«åƒé‡Œã€‚å› æ­¤ä¸ºäº†èŠ‚çœä¸€äº› CPU èµ„æºï¼Œå‡å°‘è™šæ‹ŸåŒ–å¸¦æ¥çš„å¼€é”€ï¼Œå°±é€‰æ‹©äº†å®¹å™¨åŒ–è¿è¡Œä¸€äº›åº”ç”¨ï¼ŒåŒæ—¶å†ä¸ºè¿™äº›å®¹å™¨æ‰¾ä¸€ä¸ªè½»é‡çº§çš„å®¿ä¸»æœº OS ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæƒ³è¦ä½¿ç”¨ Linux container OS çš„åŸå› ã€‚</p><h3 id="GKE-çš„-Container-Optimized-OS"><a href="#GKE-çš„-Container-Optimized-OS" class="headerlink" title="GKE çš„ Container-Optimized OS"></a>GKE çš„ <a href="https://cloud.google.com/container-optimized-os/docs/" target="_blank" rel="noopener">Container-Optimized OS</a></h3><p>Kubernetes çš„äº²çˆ¸çˆ¸ Google å®¶çš„ <a href="https://cloud.google.com/kubernetes-engine" target="_blank" rel="noopener">Google Kubernetes Engine</a> å³ GKE é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä½¿ç”¨ <a href="https://cloud.google.com/container-optimized-os/docs/" target="_blank" rel="noopener">Container-Optimized OS</a> æ¥è¿è¡Œå·¥ä½œè´Ÿè½½ï¼Œä¸è¿‡ä»…ä»…æ˜¯é’ˆå¯¹ GCE æ¥è¿›è¡Œä¼˜åŒ–çš„ï¼Œå¯èƒ½åœ¨ OpenStack æˆ–è€… vSphere ä¸Šè¿è¡Œä¸èµ·æ¥ï¼Œ(ççŒœğŸ˜‚ã€‚</p><blockquote><p>  Container-Optimized OS æ˜¯é€‚ç”¨äº <a href="https://cloud.google.com/compute" target="_blank" rel="noopener">Compute Engine</a> è™šæ‹Ÿæœºçš„æ“ä½œç³»ç»Ÿæ˜ åƒï¼Œä¸“ä¸ºè¿è¡Œ Docker å®¹å™¨è€Œä¼˜åŒ–ã€‚å€ŸåŠ© Container-Optimized OSï¼Œæ‚¨å¯ä»¥å¿«é€Ÿã€é«˜æ•ˆã€å®‰å…¨åœ°åœ¨ Google Cloud Platform ä¸Šå¯åŠ¨ Docker å®¹å™¨ã€‚Container-Optimized OS ç”± Google ç»´æŠ¤ï¼ŒåŸºäº <a href="https://www.chromium.org/chromium-os" target="_blank" rel="noopener">Chromium OS</a> å¼€æ”¾æºä»£ç é¡¹ç›®ã€‚</p></blockquote><p>ç‰¹ç‚¹å°±æ˜¯ä¸åŒäºå…¶ä»–çš„ Linux å‘è¡Œç‰ˆï¼Œè¿™ä¸ªæ˜¯åŸºäº <a href="https://www.chromium.org/chromium-os" target="_blank" rel="noopener">Chromium OS</a> å®šåˆ¶åŒ–å¼€å‘çš„ï¼Œå¯¹å†…æ ¸ç‰ˆæœ¬é€‰ç”¨çš„ä¹Ÿæ¯”è¾ƒæ¿€è¿›ï¼Œä¸€èˆ¬æ˜¯ <code>4.19.112+</code> æˆ–è€… <code>5.x</code> ç‰ˆæœ¬ï¼Œè¿™æ ·ä½ å°±ä¸ç”¨å†æ‹…å¿ƒåƒ CentOS 7.x ç³»åˆ—é‚£æ ·å„ç§å†…æ ¸ bug äº†ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">items:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Node</span></span><br><span class="line">  <span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">nodeInfo:</span></span><br><span class="line">      <span class="attr">architecture:</span> <span class="string">amd64</span></span><br><span class="line">      <span class="attr">bootID:</span> <span class="string">0c517083-aaf6-75fc4b2204ba</span></span><br><span class="line">      <span class="attr">containerRuntimeVersion:</span> <span class="string">docker://19.3.1</span></span><br><span class="line">      <span class="attr">kernelVersion:</span> <span class="number">4.19</span><span class="number">.112</span><span class="string">+</span></span><br><span class="line">      <span class="attr">kubeProxyVersion:</span> <span class="string">v1.16.13-gke.1</span></span><br><span class="line">      <span class="attr">kubeletVersion:</span> <span class="string">v1.16.13-gke.1</span></span><br><span class="line">      <span class="attr">machineID:</span> <span class="string">33a96ff3203d88c0a542</span></span><br><span class="line">      <span class="attr">operatingSystem:</span> <span class="string">linux</span></span><br><span class="line">      <span class="attr">osImage:</span> <span class="string">Container-Optimized</span> <span class="string">OS</span> <span class="string">from</span> <span class="string">Google</span></span><br><span class="line">      <span class="attr">systemUUID:</span> <span class="string">33a96ff33d88c0a542</span></span><br></pre></td></tr></table></figure><p>Chromium OS å°±æ˜¯ Google åŸºäº Linux å†…æ ¸å¼€å‘çš„æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥ Google ä¹Ÿæœ‰è¿™ä¸ªå®åŠ›é’ˆå¯¹è‡ªå®¶çš„ GCP äº‘å¹³å°è¿›è¡Œå®šåˆ¶åŒ–å¼€å‘ä¸ª OS å‡ºæ¥ï¼Œä¸“é—¨ç»™ kubernetes é›†ç¾¤è¿è¡Œä½¿ç”¨ï¼Œå®šåˆ¶åŒ–å¼€å‘çš„å¥½å¤„å°±æ˜¯å¯ä»¥å¸¦æ¥æ›´å¤šçš„æ–°ç‰¹æ€§ï¼ŒäºŒä¸å—åˆ¶äºä¸Šæ¸¸çš„ Linux å‘è¡Œç‰ˆçš„é™åˆ¶ã€‚æ¯”å¦‚ä¸ä¹…å‰ Google å®£å¸ƒå°†ä½¿ç”¨ <a href="https://cilium.io/" target="_blank" rel="noopener">Cilium</a> ä½œä¸º GKE çš„ä¸‹ä¸€ä»£æ•°æ®é¢ï¼Œ<a href="https://cloud.google.com/blog/products/containers-kubernetes/bringing-ebpf-and-cilium-to-google-kubernetes-engine" target="_blank" rel="noopener">New GKE Dataplane V2 increases security and visibility for containers</a> ï¼Œè€Œ Cilium è¿™é¡¹æŠ€æœ¯æ˜¯ä¾èµ–äºå¯¹ eBPF æŠ€æœ¯ï¼Œè€Œ eBPF åˆä¾èµ–äºå†…æ ¸ç‰¹æ€§çš„æ”¯æŒã€‚</p><h3 id="AWS-çš„-Bottlerocket-OS"><a href="#AWS-çš„-Bottlerocket-OS" class="headerlink" title="AWS çš„ Bottlerocket OS"></a>AWS çš„ <a href="https://github.com/bottlerocket-os/bottlerocket" target="_blank" rel="noopener">Bottlerocket OS</a></h3><p>è¿™ä¸ªæ˜¯ AWS æœ€è¿‘å¼€æºä¸“é—¨é’ˆå¯¹  EC2 è¿›è¡Œä¼˜åŒ–çš„ Linux Container OSï¼Œå’Œ GKE ä¸€æ ·ï¼Œåªæ˜¯é’ˆå¯¹äºè‡ªå®¶çš„ AWS å…¬æœ‰äº‘ï¼Œç”±äºæ˜¯æœ€è¿‘åˆšåˆšæ¨å‡ºçš„ï¼Œè¿˜æ²¡æ¥å¾—åŠå…³æ³¨ï¼Œæ‰€ä»¥å°±ä¸ä»‹ç»äº†ã€‚åŒ GKE çš„ Container-Optimized OS ä¸€æ ·ï¼Œä¸€èˆ¬å…¬æœ‰äº‘å®šåˆ¶åŒ–å¼€å‘çš„ Container OS ä»…ä»…åªé’ˆå¯¹è‡ªå®¶çš„äº‘å¹³å°ã€‚</p><blockquote><h3 id="Optimized-performance-through-AWS-integrations"><a href="#Optimized-performance-through-AWS-integrations" class="headerlink" title="Optimized performance through AWS integrations"></a>Optimized performance through AWS integrations</h3><p>  AWS provided builds of Bottlerocket are optimized to run on Amazon EC2 and include support for the latest Amazon EC2 instance capabilities. They also have built-in integrations with AWS services for container orchestration, registries, and observability.</p></blockquote><h3 id="CoreOS-Container-Linux"><a href="#CoreOS-Container-Linux" class="headerlink" title="CoreOS Container Linux"></a>CoreOS Container Linux</h3><p>æ¥è‡ª CoreOS å›¢é˜Ÿçš„ CoreOS Container Linux ï¼Œå®ƒåº”è¯¥æ˜¯æœ€å¤è€çš„ Linux Container OS ï¼Œæ—©åœ¨ 2013 å¹´ 10 æœˆå°±å·²ç» release ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œé‚£æ—¶å€™çš„ docker è¿˜æ²¡æœ‰åœ¨ 0.x.x ç‰ˆæœ¬ã€‚</p><blockquote><p>  <a href="https://github.com/coreos/manifest/releases/tag/v94.0.0" target="_blank" rel="noopener">v94.0.0</a></p><ul><li>Git is now included by default as a number of people use it for shipping around assets, code, etc like a distributed rsync</li><li>Docker is upgraded to 0.6.3</li><li>xz is included to support new compression types</li><li>Custom OEMs can be provided via the cpio on PXE images</li></ul></blockquote><p>å®ƒæ²¡æœ‰åƒ yum æˆ– apt è¿™æ ·çš„åŒ…ç®¡ç†å™¨æ¥å®‰è£…è½¯ä»¶ï¼Œåœ¨ CoreOS ä¸­ä½ ä¸éœ€è¦å®‰è£…è½¯ä»¶ï¼Œå› ä¸ºæ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½è¦ä½¿ç”¨ docker æ¥æ‰“åŒ…ã€‚</p><ul><li>æœ€å°åŒ–çš„æ“ä½œç³»ç»Ÿï¼š å ç”¨å†…å­˜å¾ˆå°‘ï¼Œæ¯”å…¸å‹çš„æœåŠ¡å™¨ç‰ˆæœ¬ Linux å°‘å  40%çš„å†…å­˜ã€‚</li><li>æ˜“äºå‡çº§ï¼š CoreOS é‡‡ç”¨åŒç³»ç»Ÿåˆ†åŒºï¼ˆä¸»åŠ¨åˆ†åŒº/è¢«åŠ¨åˆ†åŒºï¼‰è®¾è®¡è€Œä¸æ˜¯é‡‡ç”¨ä¼ ç»Ÿçš„é€šè¿‡å‡çº§åŒ…æ¥å‡çº§ç³»ç»Ÿï¼Œè¿™ä½¿å¾—æ¯æ¬¡å‡çº§æ›´åŠ å¿«é€Ÿï¼Œå¯é å’Œæ˜“äºå›æ»šã€‚è¿™ä¸€ç‚¹æœ‰ç‚¹åƒ Android çš„ A/B åˆ†åŒºï¼Ÿ</li><li>é›†æˆ Dockerï¼š CoreOS é»˜è®¤é›†æˆ Docker å¹¶ä½œäº†å¾ˆå¥½çš„æ”¯æŒå’Œä¼˜åŒ–ï¼Œçœå»ç”¨æˆ·å®‰è£…ï¼Œé…ç½®ï¼Œä¼˜åŒ– Docker çš„æ—¶é—´ï¼Œæå¤§åœ°æ–¹ä¾¿äº†ç”¨æˆ·ã€‚</li><li>æ˜“äºé›†ç¾¤åŒ–ï¼š CoreOS æœ¬èº«æä¾›äº†å¤§å‹ Docker å®¹å™¨é›†ç¾¤çš„æ•´ä½“è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡å†…ç½®çš„ fleet å·¥å…·åœ¨å¤šå°ç³»ç»Ÿä¸­éƒ¨ç½²å®¹å™¨å¹¶è¿›è¡Œé›†ç¾¤åŒ–ç®¡ç†ã€‚åŒæ—¶é€šè¿‡æä¾› Discovery Serviceï¼Œä¾¿äºåŠ¨æ€éƒ¨ç½²å’Œç®¡ç†é›†ç¾¤ï¼Œè§£å†³æ–¹æ¡ˆæ¯”è¾ƒæˆç†Ÿã€‚</li><li>è‡ªåŠ¨åŒ–çš„å¤§è§„æ¨¡éƒ¨ç½²ï¼š CoreOS è‡ªèº«æä¾›çš„è§£å†³æ–¹æ¡ˆèƒ½å¤Ÿè‡ªåŠ¨åœ°å¤§è§„æ¨¡æ‰¹é‡éƒ¨ç½²å¹¶æ“ä½œç³»ç»Ÿï¼Œæå¤§åœ°å‡å°‘ç”¨æˆ·å·¥ä½œé‡ã€‚</li><li>ä½¿ç”¨ systemd åšä¸ºç³»ç»ŸæœåŠ¡ç®¡ç†å·¥å…·ï¼Œæ€§èƒ½æ¯”è¾ƒå¥½ï¼Œsystemd æœ‰ç°ä»£åŒ–çš„æ—¥å¿—åŠŸèƒ½ï¼ŒåŒæ—¶é‡‡ç”¨ socket å¼ä¸ D-Bus æ€»çº¿å¼æ¿€æ´»æœåŠ¡.</li></ul><p>ä¸è¿‡ CoreOS æ—©åœ¨ä»Šå¹´å››æœˆä»½å°±å·²ç» EOF äº†ï¼Œ<a href="https://getfedora.org/coreos/" target="_blank" rel="noopener">Fedora CoreOS</a> æˆä¸º CoreOS çš„ç»§ä»»è€…ï¼š</p><blockquote><p>  As weâ€™ve <a href="https://groups.google.com/d/msg/coreos-user/zgqkG88DS3U/PFP9yrKbAgAJ" target="_blank" rel="noopener">previously announced</a>, <a href="https://getfedora.org/coreos/" target="_blank" rel="noopener">Fedora CoreOS</a> is the official successor to CoreOS Container Linux. Fedora CoreOS is a <a href="https://fedoramagazine.org/fedora-coreos-out-of-preview/" target="_blank" rel="noopener">new Fedora Edition</a> built specifically for running containerized workloads securely and at scale. It combines the provisioning tools and automatic update model of Container Linux with the packaging technology, OCI support, and SELinux security of Atomic Host. For more on the Fedora CoreOS philosophy, goals, and design, see the <a href="https://fedoramagazine.org/introducing-fedora-coreos/" target="_blank" rel="noopener">announcement of the preview release</a> and the <a href="https://docs.fedoraproject.org/en-US/fedora-coreos/" target="_blank" rel="noopener">Fedora CoreOS documentation</a>.</p></blockquote><h3 id="çº¢å¸½çš„-RHCOS"><a href="#çº¢å¸½çš„-RHCOS" class="headerlink" title="çº¢å¸½çš„ RHCOS"></a>çº¢å¸½çš„ <a href="https://docs.openshift.com/container-platform/4.1/architecture/architecture-rhcos.html" target="_blank" rel="noopener">RHCOS</a></h3><p>æ¥è‡ªçº¢å¸½å­å®¶çš„ <a href="https://docs.openshift.com/container-platform/4.1/architecture/architecture-rhcos.html" target="_blank" rel="noopener">Red Hat Enterprise Linux CoreOS (RHCOS)</a>ï¼Œæ˜¯åŸºäºä¸è¿‡è¿™ä¸ª OS ä»…ä»…é€‚ç”¨äºå®ƒè‡ªå®¶çš„ <a href="https://docs.openshift.com/" target="_blank" rel="noopener">OpenShift</a>ï¼Œè€Œä¸”å®¹å™¨è¿è¡Œæ—¶ä»…æ”¯æŒ CRI-Oã€‚</p><blockquote><p>  At the moment, CRI-O is only available as a container engine within OpenShift Container Platform clusters.</p></blockquote><p>å› ä¸º CoreOS å›¢é˜Ÿç°å¦‚ä»Šå·²ç»è¢« Red HatÂ® æ”¶è´­äº†ï¼Œæ­£å¦‚åœ¨ <a href="https://access.redhat.com/documentation/zh-cn/openshift_container_platform/4.2/html/architecture/architecture-rhcos" target="_blank" rel="noopener">OpenShift æ–‡æ¡£</a> ä¸­æåˆ°çš„ï¼š Red Hat Enterprise Linux CoreOS (RHCOS) ä»£è¡¨äº†ä¸‹ä¸€ä»£å•ç”¨é€”å®¹å™¨æ“ä½œç³»ç»ŸæŠ€æœ¯ã€‚RHCOS ç”±åˆ›å»ºäº† Red Hat Enterprise Linux Atomic Host å’Œ CoreOS Container Linux çš„åŒä¸€å¼€å‘å›¢é˜Ÿæ‰“é€ ï¼Œå®ƒå°† Red Hat Enterprise Linux (RHEL) çš„è´¨é‡æ ‡å‡†ä¸ Container Linux çš„è‡ªåŠ¨åŒ–è¿œç¨‹å‡çº§åŠŸèƒ½ç»“åˆåœ¨ä¸€èµ·ã€‚</p><h3 id="RancherOS"><a href="#RancherOS" class="headerlink" title="RancherOS"></a>RancherOS</h3><p>RancherOS æ˜¯ Rancher å›¢é˜Ÿæ‰€ç»´æŠ¤çš„å¼€æºé¡¹ç›®ï¼Œä¹Ÿæ˜¯å¯¹æ ‡ CoreOS ä¸€æ ·ï¼Œä¸“é—¨ç”¨æ¥è¿è¡Œå®¹å™¨ï¼Œå¹¶ä¸”å¯ä»¥è¿è¡Œåœ¨ç”Ÿäº§ç¯å¢ƒï¼ˆè‡³å°‘å®˜æ–¹åšäº†è¿™ä¹ˆæ ·çš„æ‰¿è¯ºï¼Œå’±ä¹Ÿæ²¡åœ¨ç”Ÿäº§ç”¨è¿‡ï¼Œä¸å¥½è¯´ã€‚åœ¨ RancherOS ä¸­æ‰€æœ‰çš„è¿›ç¨‹ï¼ˆåŒ…æ‹¬ç³»ç»Ÿæ‰€æœ‰çš„æœåŠ¡ï¼Œæ¯”å¦‚ udev å’Œ syslogï¼‰éƒ½æ˜¯ç”¨ docker æ¥ç®¡ç†ï¼Œè¿™ä¸€ç‚¹è¦æ¯” CoreOS æ›´åŠ æ¿€è¿›ä¸€äº›ï¼Œè€Œ CoreOS è¿˜æ˜¯ä½¿ç”¨ä¼ ç»Ÿ Linux å‘è¡Œç‰ˆä¸­çš„ systemd æ¥ç®¡ç†ç³»ç»Ÿä¸­çš„æœåŠ¡ã€‚RancherOS é€šè¿‡ç§»é™¤ä¼ ç»Ÿ Linux å‘è¡Œç‰ˆä¸­ä¸å¿…è¦çš„æœåŠ¡å’Œåº“æ¥æœ€å°åŒ–ç³»ç»Ÿï¼Œä½¿ä»–ä¸“æ³¨å•ä¸€çš„åŠŸèƒ½ï¼Œå³è¿è¡Œ docker å®¹å™¨ã€‚ä¸è¿‡ä¹‹å‰ä½“éªŒäº†ä¸€ç•ªï¼Œå ç”¨èµ„æºæ¯”è¾ƒå¤šğŸ˜‚ï¼Œå¥½åƒå¹¶æ²¡æœ‰å¤ªå¤§çš„ä¼˜åŠ¿ï¼ˆ</p><p><code>Everything in RancherOS is a Docker container.</code> æ„Ÿè§‰è¿™ä¸ªè¦æ¯” CoreOS æ›´åŠ å®¹å™¨åŒ–ï¼Œç”šè‡³ä½¿ç”¨ docker å–ä»£äº† systemd æ¥ç®¡ç†ç³»ç»Ÿçš„å„ç§æœåŠ¡ã€‚ç³»ç»Ÿå¯åŠ¨åè¿è¡Œä¸¤ä¸ª docker æœåŠ¡è¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯ç³»ç»Ÿ docker ï¼Œåœ¨æ­¤ä¹‹ä¸Šåœ¨è¿è¡Œç³»ç»ŸæœåŠ¡å®¹å™¨ï¼Œå’Œç”¨æˆ·å±‚é¢çš„ docker ã€‚ä¸è¿‡çœ‹ä¸€ä¸‹ä¸‹é¢çš„è¿™å¼ å›¾ä½ å°±ä¼šæ˜ç™½ã€‚æ€»çš„æ¥è®² RancherOS æ˜¯ä½¿ç”¨ docker æ¥ç®¡ç†æ•´ä¸ªç³»ç»Ÿçš„æœåŠ¡çš„ï¼ŒåŒ…æ‹¬ç”¨æˆ·å±‚é¢çš„ docker ã€‚</p><p><img src="https://p.k8s.li/rancheroshowitworks.png" alt=""></p><h3 id="VMware-çš„-Photon-OS"><a href="#VMware-çš„-Photon-OS" class="headerlink" title="VMware çš„ Photon OS"></a>VMware çš„ <a href="https://vmware.github.io/photon/" target="_blank" rel="noopener">Photon OS</a></h3><p>ä»Šå¤©çš„ä¸»è§’ï¼ŒVMware  å¼€æºçš„ Photon OSï¼Œè¿™ä¸ª OS ä½ å¯èƒ½æ²¡å¬è¯´è¿‡ï¼Œä½† VMware å¼€æºçš„ Harbor æƒ³å¿…å¾ˆç†Ÿæ‚‰ï¼Œè€Œ Harbor çš„åŸºç¡€é•œåƒä½¿ç”¨çš„å°±æ˜¯ä»–å®¶çš„ Photon OSğŸ˜‚ã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root [ /harbor ]# cat /etc/os-release</span><br><span class="line"><span class="attr">NAME</span>=<span class="string">"VMware Photon OS"</span></span><br><span class="line"><span class="attr">VERSION</span>=<span class="string">"2.0"</span></span><br><span class="line"><span class="attr">ID</span>=photon</span><br><span class="line"><span class="attr">VERSION_ID</span>=<span class="number">2.0</span></span><br><span class="line"><span class="attr">PRETTY_NAME</span>=<span class="string">"VMware Photon OS/Linux"</span></span><br><span class="line"><span class="attr">ANSI_COLOR</span>=<span class="string">"1;34"</span></span><br><span class="line"><span class="attr">HOME_URL</span>=<span class="string">"https://vmware.github.io/photon/"</span></span><br><span class="line"><span class="attr">BUG_REPORT_URL</span>=<span class="string">"https://github.com/vmware/photon/issues"</span></span><br></pre></td></tr></table></figure><p>åœ¨ Photon OS çš„æ„å»ºè„šæœ¬ <a href="https://github.com/vmware/photon/blob/master/build.py" target="_blank" rel="noopener">build.py</a> ä¸­å¯ä»¥çœ‹åˆ°å®ƒæ„å»ºçš„äº§ç‰©æ”¯æŒ ISO å’Œ docker é•œåƒï¼Œä»¥åŠä¼—å¤šå…¬æœ‰äº‘çš„è™šæ‹Ÿæœºæ ¼å¼ï¼Œä¸¤è€…éƒ½æ˜¯æ¥è‡ªç›¸åŒçš„æºç ï¼Œæ ¹æ®æ„å»ºå‡ºæ¥çš„æ˜¯å½¢å¼ä¸åŒï¼Œæ‰€åŒ…å«çš„è½¯ä»¶ä¹Ÿä¸åŒã€‚å› ä¸ºè£å‰ªæ‰äº†ä¸€äº›ä¸å¿…è¦çš„ç³»ç»ŸæœåŠ¡ï¼Œ docker é•œåƒæ ¼å¼çš„è¦æ›´ç²¾ç®€ä¸€äº›ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">targetList = &#123;</span><br><span class="line">        "image":["iso", "ami", "gce", "azure", "rpi3", "ova", "ova_uefi", "all", "src-iso",</span><br><span class="line">                "photon-docker-image", "k8s-docker-images", "all-images", "minimal-iso", "rt-iso"],</span><br><span class="line"></span><br><span class="line">        "rpmBuild": ["packages", "packages-minimal", "packages-initrd", "packages-docker",</span><br><span class="line">                "updated-packages", "tool-chain-stage1", "tool-chain-stage2", "check",</span><br><span class="line">                "ostree-repo", "generate-yaml-files", "create-repo", "distributed-build"],</span><br><span class="line"></span><br><span class="line">        "buildEnvironment": ["packages-cached", "sources", "sources-cached", "publish-rpms",</span><br><span class="line">                "publish-x-rpms", "publish-rpms-cached", "publish-x-rpms-cached", "photon-stage"]</span><br></pre></td></tr></table></figure><p>æ€»çš„æ¥è®²ï¼Œä¸Šé¢æåˆ°çš„å‡ ç§å®¹å™¨ä¼˜åŒ–å‹ OS ä¸­ ï¼ŒPhoton OS æ¯”è¾ƒå¼€æ”¾ä¸€äº›ï¼Œè™½ç„¶æ¥è¯´æ˜¯é’ˆå¯¹äºè‡ªå®¶ vSphere è¿›è¡Œä¼˜åŒ–çš„ï¼Œä½†å…¶ä»–å…¬æœ‰äº‘å’Œç§æœ‰äº‘ä¹Ÿæ˜¯æ”¯æŒï¼Œç”šè‡³è¿˜æ”¯æŒæ ‘è“æ´¾ğŸ“ï¼æ‰€ä»¥ä¸ªäººç”¨æˆ·æƒ³æ‹¿æ¥ç©ç©ï¼Œè¿˜æ˜¯ä¸é”™æ»´ã€‚å°¤å…¶æ˜¯é’ˆå¯¹å’±è¿™ç§ç© ESXi è½¯è·¯ç”±çš„åƒåœ¾ä½¬ï¼Œåœ¨ Photon OS ä¸Šè·‘ä¸€äº›å®¹å™¨åº”ç”¨ï¼Œå†é€‚åˆä¸è¿‡äº†ã€‚</p><h2 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h2><table><thead><tr><th align="center">Providers</th><th align="center">Name</th><th align="center">STAR</th><th align="center">FORK</th></tr></thead><tbody><tr><td align="center">Google</td><td align="center"><a href="https://github.com/GoogleCloudPlatform/cos-customizer" target="_blank" rel="noopener">Container-Optimized OS</a></td><td align="center">-</td><td align="center">-</td></tr><tr><td align="center">Amazon</td><td align="center"><a href="https://github.com/bottlerocket-os/bottlerocket" target="_blank" rel="noopener">Bottlerocket OS</a></td><td align="center">4.8K</td><td align="center">185</td></tr><tr><td align="center">CoreOS</td><td align="center">CoreOS Container Linux</td><td align="center">-</td><td align="center">-</td></tr><tr><td align="center">Red Hat</td><td align="center">RHCOS</td><td align="center">-</td><td align="center">-</td></tr><tr><td align="center">Rancher</td><td align="center"><a href="https://github.com/rancher/os" target="_blank" rel="noopener">Rancher OS</a></td><td align="center">6k</td><td align="center">625</td></tr><tr><td align="center">Flatcar</td><td align="center"><a href="https://github.com/flatcar-linux/Flatcar" target="_blank" rel="noopener">Flatcar Linux</a></td><td align="center">117</td><td align="center">3</td></tr><tr><td align="center">VMware</td><td align="center"><a href="https://github.com/vmware/photon" target="_blank" rel="noopener">Photon OS</a></td><td align="center">2.1k</td><td align="center">591</td></tr></tbody></table><table><thead><tr><th align="center">Providers</th><th align="center">Name</th><th align="center">Runtime</th><th align="center">Support Platform</th></tr></thead><tbody><tr><td align="center">Google</td><td align="center">Container-Optimized OS</td><td align="center">docker</td><td align="center">GCP</td></tr><tr><td align="center">Amazon</td><td align="center">Bottlerocket OS</td><td align="center">docker</td><td align="center">AWS</td></tr><tr><td align="center">CoreOS</td><td align="center">CoreOS Container Linux</td><td align="center">docker</td><td align="center">AWS/GCP/OpenStack/VMware<BR>Alibaba Cloud/Azure/DigitalOcean</td></tr><tr><td align="center">Red Hat</td><td align="center">RHCOS</td><td align="center">CRI-O</td><td align="center">AWS/vSphere/Bare Metal</td></tr><tr><td align="center">Rancher</td><td align="center">Rancher OS</td><td align="center">docker</td><td align="center">AWS/GCP/OpenStack/VMware<BR>Alibaba Cloud/Azure/DigitalOcean</td></tr><tr><td align="center">Flatcar</td><td align="center">Flatcar Linux</td><td align="center">docker</td><td align="center">AWS/GCP/OpenStack/VMware<BR>Alibaba Cloud/Azure/DigitalOcean</td></tr><tr><td align="center">VMware</td><td align="center">Photon OS</td><td align="center">docker</td><td align="center">AWS/GCE/Azure/OpenStack<br>vSphere/bare metal/Raspberry Pi 3</td></tr></tbody></table><p>ç›®å‰æ¥è®² Photon OS ä½œä¸º Harbor çš„åŸºç¡€é•œåƒï¼Œåœ¨å®¹å™¨æ–¹é¢æ¯”è¾ƒçªå‡ºä¸€äº›ï¼Œä½†ä½œä¸ºå®¹å™¨çš„å®¿ä¸»æœº OS ï¼Œè¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚ç”±äºæˆ‘æ˜¯ä½¿ç”¨çš„ VMware å®¶çš„ ESXi è™šæ‹ŸåŒ–ï¼Œé‚£ä¹ˆé€‰æ‹©ä»–å®¶çš„ Photon OS æ˜¯æœ€å¥½çš„å–½ï¼Œè€Œä¸” Photon OS æ˜¯é’ˆå¯¹ ESXi åšè¿‡ä¼˜åŒ–çš„ï¼Œå†…æ ¸éƒ½æ˜¯é’ˆå¯¹ ESXi è™šæ‹ŸåŒ–è¿›è¡Œäº†å®šåˆ¶åŒ–çš„å¼€å‘ï¼Œæ‰€ä»¥ç†è®ºä¸Šé€‰æ‹© Photon OS åº”è¯¥æ˜¯æœ€åˆé€‚çš„ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="Download-Format"><a href="#Download-Format" class="headerlink" title="Download Format"></a><a href="https://github.com/vmware/photon/wiki/Downloading-Photon-OS" target="_blank" rel="noopener">Download Format</a></h3><table><thead><tr><th>Format</th><th>Description</th></tr></thead><tbody><tr><td>ISO Image</td><td>Contains everything needed to install either the minimal or full installation of Photon OS. The bootable ISO has a manual installer or can be used with PXE/kickstart environments for automated installations.</td></tr><tr><td>OVA</td><td>Pre-installed minimal environment, customized for VMware hypervisor environments. These customizations include a highly sanitized and optimized kernel to give improved boot and runtime performance for containers and Linux applications. Since an OVA is a complete virtual machine definition, weâ€™ve made available a Photon OS OVA that has virtual hardware version 11; this will allow for compatibility with several versions of VMware platforms or allow for the latest and greatest virtual hardware enhancements.</td></tr><tr><td>Amazon AMI</td><td>Pre-packaged and tested version of Photon OS made ready to deploy in your Amazon EC2 cloud environment. Previously, weâ€™d published documentation on how to create an Amazon compatible instance, but, now weâ€™ve done the work for you.</td></tr><tr><td>Google GCE Image</td><td>Pre-packaged and tested Google GCE image that is ready to deploy in your Google Compute Engine Environment, with all modifications and package requirements for running Photon OS in GCE.</td></tr><tr><td>Azure VHD</td><td>Pre-packaged and tested Azure HD image that is ready to deploy in your Microsoft Azure Cloud, with all modifications and package requirements for running Photon OS in Azure.</td></tr><tr><td>Raspberry Pi3 Image</td><td>Pre-packaged and tested Raspberry Pi3 Image (Version 3.0 onwards) on ARM64 architecture.</td></tr></tbody></table><p>Photon OS æä¾›äº†å¤šç§å®‰è£…æ–¹å¼ï¼Œå…¶ä¸­ ISO æ˜¯é€šç”¨æ€§çš„ï¼Œå°±å’Œå®‰è£…å…¶ä»– Linux å‘è¡Œç‰ˆçš„è¿‡ç¨‹å·®ä¸å¤šï¼ŒOVA æ˜¯è™šæ‹Ÿæœºæ¨¡æ¿ï¼Œå¯ä»¥å¯¼å…¥åˆ° VMware è™šæ‹ŸåŒ–å¹³å°ä¸Šä½¿ç”¨ï¼ŒçœåŒºå®‰è£…çš„æ­¥éª¤ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚OVA è™šæ‹Ÿæœºæ¨¡æ¿çš„ç‰ˆæœ¬ä¸º 11 ï¼Œæ ¹æ® <a href="https://kb.vmware.com/s/article/1003746" target="_blank" rel="noopener">Virtual machine hardware versions</a> ä¸­çš„å®šä¹‰ï¼Œéœ€è¦ ESXi 6.0 Fusion 7.x Workstation 11.x Player 7.x ç‰ˆæœ¬ä»¥ä¸Šçš„è™šæ‹ŸåŒ–æ”¯æŒã€‚</p><table><thead><tr><th><strong>Virtual Hardware Version</strong></th><th><strong>Products</strong></th></tr></thead><tbody><tr><td>18</td><td>ESXi 7.0.1</td></tr><tr><td>17</td><td>ESXi 7.0.0</td></tr><tr><td>16</td><td>Fusion 11.x Workstation Pro 15.x Workstation Player 15.x</td></tr><tr><td>15</td><td>VMware Cloud on AWS ESXi 6.7 U2</td></tr><tr><td>14</td><td>ESXi 6.7 Fusion 10.x Workstation Pro 14.x Workstation Player 14.x</td></tr><tr><td>13</td><td>ESXi 6.5</td></tr><tr><td>12</td><td>Fusion 8.x Workstation Pro 12.x Workstation Player 12.x</td></tr><tr><td>11</td><td>ESXi 6.0 Fusion 7.x Workstation 11.x Player 7.x</td></tr><tr><td>10</td><td>ESXi 5.5 Fusion 6.x Workstation 10.x Player 6.x</td></tr></tbody></table><p>å¦å¤–è¿˜æ”¯æŒ <code>Raspberry Pi 3</code> ï¼Œä¸è¿‡éœ€è¦æ‹¿æºç è‡ªè¡Œç¼–è¯‘é•œåƒï¼Œç„¶ååˆ·åˆ°æ ‘è“æ´¾ä¸Šï¼Œä½ åƒç°çš„æ ‘è“æ´¾åˆæœ‰ç”¨é€”å•¦ğŸ˜‚ã€‚</p><p><a href="https://github.com/vmware/photon/wiki/Downloading-Photon-OS" target="_blank" rel="noopener">ä¸‹è½½æ–¹å¼</a> ğŸ‘‡</p><h3 id="Photon-OS-3-0-Revision-2-Update3-Binaries"><a href="#Photon-OS-3-0-Revision-2-Update3-Binaries" class="headerlink" title="Photon OS 3.0 Revision 2 Update3 Binaries"></a>Photon OS 3.0 Revision 2 Update3 Binaries</h3><p>Aug 14, 2020 An update to 3.0 revision 2 Update3 binaries are now available.</p><table><thead><tr><th>Download</th><th>Size</th><th>md5 checksum</th></tr></thead><tbody><tr><td><a href="https://packages.vmware.com/photon/3.0/Rev3/iso/photon-3.0-a383732.iso" target="_blank" rel="noopener">Full ISO x86_64</a></td><td>5.2G</td><td>2dd9f18c5162a7367f2463f4a9bb4890</td></tr><tr><td><a href="https://packages.vmware.com/photon/3.0/Rev3/iso/photon-minimal-3.0-a383732.iso" target="_blank" rel="noopener">Minimal ISO x86_64</a></td><td>299M</td><td>0119f0f275f246fd382d419ff41898a4</td></tr><tr><td><a href="https://packages.vmware.com/photon/3.0/Rev3/iso/photon-rt-3.0-a383732.iso" target="_blank" rel="noopener">ISO x86_64 Real-Time flavour</a></td><td>489M</td><td>d2bfce95b54a29174b5beaef9962dbc1</td></tr><tr><td><a href="https://packages.vmware.com/photon/3.0/Rev3/ova/photon-hw11-3.0-a383732.ova" target="_blank" rel="noopener">OVA-hw11</a></td><td>188M</td><td>ba52abd88c5b22cd4498cf0e88457f28</td></tr><tr><td><a href="https://packages.vmware.com/photon/3.0/Rev3/ova/photon-hw13_uefi-3.0-a383732.ova" target="_blank" rel="noopener">OVA-hw13_uefi</a></td><td>214M</td><td>95614f3b08c1a93306ababcc826572df</td></tr></tbody></table><p>åœ¨æ­¤ä½¿ç”¨ OVA-hw11 æ ¼å¼çš„ OVA è™šæ‹Ÿæœºæ¨¡æ¿ï¼Œåé¢é‚£ä¸ªå¸¦ uefi çš„éœ€è¦è®¾ç½®è™šæ‹Ÿæœºä¸º EFI æ¨¡å¼å¯åŠ¨ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚</p><ul><li>åˆ›å»ºè™šæ‹Ÿæœºçš„æ—¶å€™ä½¿ç”¨ OVA æ–‡ä»¶å¯¼å…¥</li></ul><p><img src="https://p.k8s.li/20200922-esxi_ova_01.png" alt=""></p><ul><li>é»˜è®¤çš„ç”¨æˆ·åä¸º <code>root</code> ï¼Œå¯†ç ä¸º <code>changeme</code>ï¼Œç™»å½•ä¹‹åå†è¾“å…¥ä¸€é <code>changeme</code>ï¼Œç„¶åä¿®æ”¹ä¸ºæ–°çš„å¯†ç ã€‚</li></ul><p><img src="https://p.k8s.li/20200922-esxi_photonos-01.png" alt=""></p><h2 id="ç³»ç»Ÿä¿¡æ¯"><a href="#ç³»ç»Ÿä¿¡æ¯" class="headerlink" title="ç³»ç»Ÿä¿¡æ¯"></a>ç³»ç»Ÿä¿¡æ¯</h2><ul><li>å†…æ ¸ç‰ˆæœ¬ä¸º <code>4.19.132-5.ph3-esx</code>ï¼Œ4.19 æ˜¯ä¸ª LTS ç‰ˆæœ¬çš„å†…æ ¸ï¼Œç»“å°¾çš„ <code>esx</code> åˆ™ä»£è¡¨ç€ä¸º <code>ESXi</code> è™šæ‹ŸåŒ–å®šåˆ¶çš„å†…æ ¸ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Linux photon-machine 4.19.132-5.ph3-esx #1-photon SMP Wed Aug 12 21:02:13 UTC 2020 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure><ul><li>rpm åŒ…æ•°é‡ä»…ä»…ä¸º 146 ä¸ªï¼Œä¸€èˆ¬çš„ CentOS å‘è¡Œç‰ˆè‡ªå¸¦çš„ rpm åŒ…æ•°é‡ä¸º 300 ä¸ªå·¦å³ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# rpm -qa | wc</span><br><span class="line">    146     146    4307</span><br></pre></td></tr></table></figure><ul><li>ç³»ç»Ÿè¿›ç¨‹ä¿¡æ¯ï¼Œè¿˜æ˜¯é‡‡ç”¨ systemd æ¥ç®¡ç†è¿›ç¨‹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# systemctl status</span><br><span class="line">â— photon-machine</span><br><span class="line">    State: running</span><br><span class="line">     Jobs: 0 queued</span><br><span class="line">   Failed: 0 units</span><br><span class="line">    Since: Tue 2020-09-22 08:07:29 UTC; 10min ago</span><br><span class="line">   CGroup: /</span><br><span class="line">           â”œâ”€user.slice</span><br><span class="line">           â”‚   â”œâ”€session-c2.scope</span><br><span class="line">           â”‚   â”‚ â”œâ”€413 sshd: root@pts/0</span><br><span class="line">           â”‚   â”‚ â”œâ”€420 -bash</span><br><span class="line">           â”‚   â”‚ â”œâ”€443 systemctl status</span><br><span class="line">           â”‚   â”‚ â””â”€444 systemctl status</span><br><span class="line">           â”‚   â””â”€user@0.service</span><br><span class="line">           â”‚     â””â”€init.scope</span><br><span class="line">           â”‚       â”œâ”€393 /lib/systemd/systemd --user</span><br><span class="line">           â”‚       â””â”€394 (sd-pam)</span><br><span class="line">           â”œâ”€init.scope</span><br><span class="line">           â”‚ â””â”€1 /lib/systemd/systemd</span><br><span class="line">           â””â”€system.slice</span><br><span class="line">             â”œâ”€systemd-networkd.service</span><br><span class="line">             â”‚ â””â”€245 /lib/systemd/systemd-networkd</span><br><span class="line">             â”œâ”€systemd-udevd.service</span><br><span class="line">             â”‚ â””â”€124 /lib/systemd/systemd-udevd</span><br><span class="line">             â”œâ”€vgauthd.service</span><br><span class="line">             â”‚ â””â”€159 /usr/bin/VGAuthService -s</span><br><span class="line">             â”œâ”€systemd-journald.service</span><br><span class="line">             â”‚ â””â”€97 /lib/systemd/systemd-journald</span><br><span class="line">             â”œâ”€sshd.service</span><br><span class="line">             â”‚ â””â”€352 /usr/sbin/sshd -D</span><br><span class="line">             â”œâ”€vmtoolsd.service</span><br><span class="line">             â”‚ â””â”€161 /usr/bin/vmtoolsd</span><br><span class="line">             â”œâ”€systemd-resolved.service</span><br><span class="line">             â”‚ â””â”€247 /lib/systemd/systemd-resolved</span><br><span class="line">             â”œâ”€dbus.service</span><br><span class="line">             â”‚ â””â”€157 /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only</span><br><span class="line">             â”œâ”€systemd-timesyncd.service</span><br><span class="line">             â”‚ â””â”€151 /lib/systemd/systemd-timesyncd</span><br><span class="line">             â””â”€systemd-logind.service</span><br><span class="line">               â””â”€158 /lib/systemd/systemd-logind</span><br></pre></td></tr></table></figure><ul><li>ç£ç›˜æ ¹ç›®å½•åªä½¿ç”¨äº†ä¸åˆ° 600M</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# df -h</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">&#x2F;dev&#x2F;root        16G  577M   15G   4% &#x2F;</span><br></pre></td></tr></table></figure><ul><li>å†…å­˜ä¹Ÿåªä½¿ç”¨äº† 43Miï¼Œå¯åŠ¨ dockerd ä¹‹åå†…å­˜å ç”¨ 108Miï¼Œæ¢æˆ containerd å°†ä¼šå°ä¸€äº›ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:          2.0Gi        43Mi       1.8Gi       0.0Ki       103Mi       1.8Gi</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨ dockerd å®ˆæŠ¤è¿›ç¨‹ä¹‹åå†…å­˜å ç”¨ 108Mi</span></span><br><span class="line">root@photon-machine [ ~ ]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:          2.0Gi       108Mi       1.6Gi       0.0Ki       298Mi       1.8Gi</span><br></pre></td></tr></table></figure><ul><li>å†…æ ¸æ¨¡å—çš„æ•°é‡ä¹Ÿæ¯”è¾ƒå°‘ 30 ä¸ªå·¦å³ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ä¸€äº›ç½‘ç»œç›¸å…³çš„å†…æ ¸æ¨¡å—ã€‚å¸¸è§„çš„ Linux å‘è¡Œç‰ˆçš„å†…æ ¸æ¨¡å—å¾€å¾€åœ¨ 60 ä¸ªä»¥ä¸Šã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# lsmod</span><br><span class="line">Module                  Size  Used by</span><br><span class="line">xt_conntrack           16384  2</span><br><span class="line">ip6table_mangle        16384  0</span><br><span class="line">ip6table_nat           16384  0</span><br><span class="line">nf_nat_ipv6            16384  1 ip6table_nat</span><br><span class="line">iptable_mangle         16384  0</span><br><span class="line">iptable_nat            16384  0</span><br><span class="line">nf_nat_ipv4            16384  1 iptable_nat</span><br><span class="line">nf_nat                 28672  2 nf_nat_ipv6,nf_nat_ipv4</span><br><span class="line">ip6table_filter        16384  1</span><br><span class="line">ip6_tables             24576  3 ip6table_filter,ip6table_nat,ip6table_mangle</span><br><span class="line">iptable_filter         16384  1</span><br><span class="line">xt_LOG                 16384  0</span><br><span class="line">nf_conntrack           90112  4 xt_conntrack,nf_nat,nf_nat_ipv6,nf_nat_ipv4</span><br><span class="line">nf_defrag_ipv6         20480  1 nf_conntrack</span><br><span class="line">nf_defrag_ipv4         16384  1 nf_conntrack</span><br><span class="line">mousedev               20480  0</span><br><span class="line">vfat                   20480  1</span><br><span class="line">fat                    61440  1 vfat</span><br><span class="line">evdev                  20480  1</span><br><span class="line">vmwgfx                253952  1</span><br><span class="line">psmouse                90112  0</span><br><span class="line">drm_kms_helper        106496  1 vmwgfx</span><br><span class="line">ttm                    86016  1 vmwgfx</span><br><span class="line">drm                   323584  4 vmwgfx,drm_kms_helper,ttm</span><br><span class="line">sr_mod                 24576  0</span><br><span class="line">i2c_core               40960  2 drm_kms_helper,drm</span><br><span class="line">cdrom                  49152  1 sr_mod</span><br><span class="line">rdrand_rng             16384  0</span><br><span class="line">rng_core               16384  1 rdrand_rng</span><br><span class="line">ipv6                  368640  16 nf_nat_ipv6,ip6table_mangle</span><br><span class="line">root@photon-machine [ ~ ]# lsmod | wc</span><br><span class="line">     31     109    1273</span><br></pre></td></tr></table></figure><ul><li>ç³»ç»Ÿè‡ªå¸¦çš„ docker ç‰ˆæœ¬ä¸º <code>19.03.10</code>ï¼Œå­˜å‚¨é©±åŠ¨ä½¿ç”¨çš„æ˜¯ <code>overlay2</code></li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">Client:</span><br><span class="line"> Debug Mode: false</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Containers: 0</span><br><span class="line">  Running: 0</span><br><span class="line">  Paused: 0</span><br><span class="line">  Stopped: 0</span><br><span class="line"> Images: 0</span><br><span class="line"> Server Version: 19.03.10</span><br><span class="line"> Storage Driver: overlay2</span><br><span class="line">  Backing Filesystem: extfs</span><br><span class="line">  Supports d_type: true</span><br><span class="line">  Native Overlay Diff: true</span><br><span class="line"> Logging Driver: json-file</span><br><span class="line"> Cgroup Driver: cgroupfs</span><br><span class="line"> Plugins:</span><br><span class="line">  Volume: local</span><br><span class="line">  Network: bridge host ipvlan macvlan null overlay</span><br><span class="line">  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog</span><br><span class="line"> Swarm: inactive</span><br><span class="line"> Runtimes: runc</span><br><span class="line"> Default Runtime: runc</span><br><span class="line"> Init Binary: docker-init</span><br><span class="line"> containerd version: b34a5c8af56e510852c35414db4c1f4fa6172339</span><br><span class="line"> runc version: d736ef14f0288d6993a1845745d6756cfc9ddd5a</span><br><span class="line"> init version: fec3683</span><br><span class="line"> Security Options:</span><br><span class="line">  apparmor</span><br><span class="line">  seccomp</span><br><span class="line">   Profile: default</span><br><span class="line"> Kernel Version: 4.19.132-5.ph3-esx</span><br><span class="line"> Operating System: VMware Photon OS/Linux</span><br><span class="line"> OSType: linux</span><br><span class="line"> Architecture: x86_64</span><br><span class="line"> CPUs: 1</span><br><span class="line"> Total Memory: 1.951GiB</span><br><span class="line"> Name: photon-machine</span><br><span class="line"> ID: HXBT:Z4LZ:4HZM:3YII:U7ZA:RVOH:Z7CL:L4FA:YGA4:Y2V6:DSVR:NWPD</span><br><span class="line"> Docker Root Dir: /var/lib/docker</span><br><span class="line"> Debug Mode: false</span><br><span class="line"> Registry: https://index.docker.io/v1/</span><br><span class="line"> Labels:</span><br><span class="line"> Experimental: false</span><br><span class="line"> Insecure Registries:</span><br><span class="line">  127.0.0.0/8</span><br><span class="line"> Live Restore Enabled: false</span><br><span class="line"> Product License: Community Engine</span><br></pre></td></tr></table></figure><h2 id="ç³»ç»Ÿç®¡ç†"><a href="#ç³»ç»Ÿç®¡ç†" class="headerlink" title="ç³»ç»Ÿç®¡ç†"></a>ç³»ç»Ÿç®¡ç†</h2><h3 id="ç½‘ç»œç®¡ç†"><a href="#ç½‘ç»œç®¡ç†" class="headerlink" title="ç½‘ç»œç®¡ç†"></a>ç½‘ç»œç®¡ç†</h3><ul><li>æŸ¥çœ‹ç½‘å¡çŠ¶æ€ï¼Œå¯ä½¿ç”¨è‡ªå¸¦çš„ <code>networkctl</code> å‘½ä»¤è¡Œå·¥å…·ï¼Œåƒ ifconfigã€ipã€ss ç­‰å‘½ä»¤éƒ½å·²ç»é»˜è®¤å®‰è£…ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ /mnt/RPMS ]# networkctl status eth0</span><br><span class="line">â— 2: eth0</span><br><span class="line">       Link File: /usr/lib/systemd/network/99-default.link</span><br><span class="line">    Network File: /etc/systemd/network/99-dhcp-en.network</span><br><span class="line">            Type: ether</span><br><span class="line">           State: routable (configured)</span><br><span class="line">            Path: pci-0000:0b:00.0</span><br><span class="line">          Driver: vmxnet3</span><br><span class="line">          Vendor: VMware</span><br><span class="line">           Model: VMXNET3 Ethernet Controller</span><br><span class="line">      HW Address: 00:0c:29:74:13:16 (VMware, Inc.)</span><br><span class="line">         Address: 192.168.0.235</span><br><span class="line">                  fe80::20c:29ff:fe74:1316</span><br><span class="line">         Gateway: 192.168.0.1 (NETGEAR)</span><br><span class="line">             DNS: 119.29.29.29</span><br><span class="line">                  223.6.6.6</span><br><span class="line">        CLIENTID: ffb6220feb00020000ab113bc2c88225c0d29b</span><br><span class="line">    Connected To: n/a on port 00:e0:4c:68:54:12</span><br><span class="line">                  n/a on port 00:e0:4c:68:54:13</span><br><span class="line">                  n/a on port 00:e0:4c:68:54:15</span><br></pre></td></tr></table></figure><ul><li>ç³»ç»Ÿå®‰è£…æ—¶é»˜è®¤ä½¿ç”¨çš„ DHCP è·å– IP ï¼Œå¯ä»¥ä½¿ç”¨ systemd æ¥è®¾ç½®é™æ€ IP</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> é¦–å…ˆä¿®æ”¹ DHCP çš„ systemd æ–‡ä»¶ï¼Œå…³é—­ DHCP</span></span><br><span class="line">sed -i 's/yes/no/' /etc/systemd/network/99-dhcp-en.network</span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºé™æ€ IP çš„ systemd æ–‡ä»¶</span></span><br><span class="line">cat &gt; /etc/systemd/network/10-static-en.network &lt;&lt; "EOF"</span><br><span class="line"></span><br><span class="line">[Match]</span><br><span class="line">Name=eth0</span><br><span class="line"></span><br><span class="line">[Network]</span><br><span class="line">Address=198.168.0.235/24</span><br><span class="line">Gateway=198.168.0.1</span><br><span class="line">DNS=192.168.0.100</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶æƒé™ä¸º 644 ï¼Œä¸ç„¶å¯åŠ¨çš„æ—¶å€™ä¼šæŠ¥é”™æç¤ºæƒé™é—®é¢˜</span></span><br><span class="line">chmod 644 /etc/systemd/network/10-static-en.network</span><br><span class="line"><span class="meta">#</span><span class="bash"> é‡å¯ä¸€ä¸‹ç½‘ç»œ</span></span><br><span class="line">systemctl restart systemd-networkd</span><br></pre></td></tr></table></figure><ul><li>æŒ‚è½½ NFS æ–‡ä»¶ç³»ç»Ÿéœ€è¦å®‰è£… <code>nfs-utils</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tdnf install nfs-utils -y</span><br><span class="line">mount 192.168.0.100:/nfs /mnt/nfs</span><br></pre></td></tr></table></figure><h3 id="åŒ…ç®¡ç†"><a href="#åŒ…ç®¡ç†" class="headerlink" title="åŒ…ç®¡ç†"></a>åŒ…ç®¡ç†</h3><p>Photon OS ä½¿ç”¨çš„æ˜¯ yum/tdnf ä½œä¸ºåŒ…ç®¡ç†å™¨ï¼Œä½¿ç”¨æ–¹æ³•å’Œ RedHat ç³»çš„å‘è¡Œç‰ˆåŸºæœ¬ç›¸åŒï¼Œrepo ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ls /etc/yum.repos.d/</span><br><span class="line">lightwave.repo</span><br><span class="line">photon-extras.repo</span><br><span class="line">photon-iso.repo</span><br><span class="line">photon-updates.repo</span><br><span class="line">photon.repo</span><br></pre></td></tr></table></figure><h3 id="æºç ç¼–è¯‘"><a href="#æºç ç¼–è¯‘" class="headerlink" title="æºç ç¼–è¯‘"></a>æºç ç¼–è¯‘</h3><h2 id="è¿è¡Œå®¹å™¨"><a href="#è¿è¡Œå®¹å™¨" class="headerlink" title="è¿è¡Œå®¹å™¨"></a>è¿è¡Œå®¹å™¨</h2><h3 id="Pi-hole"><a href="#Pi-hole" class="headerlink" title="Pi-hole"></a>Pi-hole</h3><blockquote><p>  Pi-hole æ˜¯ä¸€æ¬¾å¼€æºä¸”å…è´¹çš„ DNS æ²‰æ´æœåŠ¡å™¨ï¼ˆDNS sinkholeï¼‰ï¼Œèƒ½å¤Ÿåœ¨ä¸å®‰è£…ä»»ä½•å®¢æˆ·ç«¯ä¾§è½¯ä»¶çš„å‰æä¸‹ä¸ºè®¾å¤‡æä¾›ç½‘ç»œå†…å®¹å±è”½æœåŠ¡ï¼Œéå¸¸è½»é‡æ˜“ç”¨ã€‚æ­é…ä¸Šå®¶ä¸­åƒç°å·²ä¹…çš„æ ‘è“æ´¾ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿè½»æ¾æ‰“é€ å±äºè‡ªå·±çš„å¹¿å‘Šå±è”½åŠ©æ‰‹ã€‚<br>  åœ¨<a href="https://pi-hole.net/" target="_blank" rel="noopener">å®˜ç½‘</a>çš„ä»‹ç»ä¸­ï¼ŒPi-hole ä¸»è¦å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li>æ˜“äºå®‰è£…å’Œé…ç½®ï¼ˆå·ç§° 10 åˆ†é’Ÿå®‰è£…é…ç½®ä¸€æ¡é¾™ï¼‰ã€‚</li><li>å…¨å¹³å°ï¼Œå¹¿å‘Šå±è”½æœåŠ¡å¯ä½œç”¨äºä»»ä½•è®¾å¤‡ï¼ŒåŒ…æ‹¬PCã€æ‰‹æœºã€å¹³æ¿ç”µè„‘ã€‚</li><li>è½»é‡ï¼Œå¯¹ç¡¬ä»¶è¦æ±‚æä½ã€‚</li><li>åŠŸèƒ½ç¨³å®šä¸”å¼ºå¤§ï¼Œèƒ½è½»æ¾ hold ä½ç™¾ä¸‡çº§åˆ«çš„è¯·æ±‚ã€‚</li><li>æä¾›äº†ç¾è§‚çš„ Web æ•°æ®ç›‘æ§ä»ªè¡¨ç›˜ã€‚</li><li>å¼€æºä¸”å…è´¹ã€‚</li></ul></blockquote><ul><li>é¦–å…ˆéœ€è¦å…³é—­ systemd è‡ªå¸¦çš„ DNS æœåŠ¡ï¼Œä¸ç„¶ Pi-hole åšæŒºçš„ 53 ç«¯å£ä¼šè¢«å ç”¨</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop systemd-resolved</span><br><span class="line">systemctl disable systemd-resolved</span><br></pre></td></tr></table></figure><ul><li>å®‰è£… docker-composeï¼Œä¿®æ”¹ docker-compose.yaml æ–‡ä»¶</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3"</span></span><br><span class="line"><span class="comment"># More info at https://github.com/pi-hole/docker-pi-hole/ and https://docs.pi-hole.net/</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">pihole:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">pihole</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">pihole/pihole:latest</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"53:53/tcp"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"53:53/udp"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"67:67/udp"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"80:80/tcp"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"443:443/tcp"</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">'Asia/Shanghai'</span></span><br><span class="line">      <span class="attr">WEBPASSWORD:</span> <span class="string">'changeme'</span></span><br><span class="line">    <span class="comment"># Volumes store your data between container upgrades</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'./etc-pihole/:/etc/pihole/'</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'./etc-dnsmasq.d/:/etc/dnsmasq.d/'</span></span><br><span class="line">    <span class="comment"># Recommended but not required (DHCP needs NET_ADMIN)</span></span><br><span class="line">    <span class="comment">#   https://github.com/pi-hole/docker-pi-hole#note-on-capabilities</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br></pre></td></tr></table></figure><ul><li>docker-compose up èµ°èµ·ï¼</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">root@PhotonOS [ /opt/docker/pihole ]# docker-compose up</span><br><span class="line">Creating network "pihole_default" with the default driver</span><br><span class="line">Creating pihole ... done</span><br><span class="line">Attaching to pihole</span><br><span class="line">pihole    | [s6-init] making user provided files available at /var/run/s6/etc...exited 0.</span><br><span class="line">pihole    | [s6-init] ensuring user provided files have correct perms...exited 0.</span><br><span class="line">pihole    | [fix-attrs.d] applying ownership &amp; permissions fixes...</span><br><span class="line">pihole    | [fix-attrs.d] 01-resolver-resolv: applying...</span><br><span class="line">pihole    | [fix-attrs.d] 01-resolver-resolv: exited 0.</span><br><span class="line">pihole    | [fix-attrs.d] done.</span><br><span class="line">pihole    | [cont-init.d] executing container initialization scripts...</span><br><span class="line">pihole    | [cont-init.d] 20-start.sh: executing...</span><br><span class="line">pihole    |  ::: Starting docker specific checks &amp; setup for docker pihole/pihole</span><br><span class="line">  [âœ“] Update local cache of available packages</span><br><span class="line">pihole    |   [i] Existing PHP installation detected : PHP version 7.0.33-0+deb9u8</span><br><span class="line">pihole    |</span><br><span class="line">pihole    |   [i] Installing configs from /etc/.pihole...</span><br><span class="line">pihole    |   [i] Existing dnsmasq.conf found... it is not a Pi-hole file, leaving alone!</span><br><span class="line">  [âœ“] Copying 01-pihole.conf to /etc/dnsmasq.d/01-pihole.conf</span><br><span class="line">pihole    | chown: cannot access '': No such file or directory</span><br><span class="line">pihole    | chmod: cannot access '': No such file or directory</span><br><span class="line">pihole    | chown: cannot access '/etc/pihole/dhcp.leases': No such file or directory</span><br><span class="line">pihole    | ::: Pre existing WEBPASSWORD found</span><br><span class="line">pihole    | Using default DNS servers: 8.8.8.8 &amp; 8.8.4.4</span><br><span class="line">pihole    | DNSMasq binding to default interface: eth0</span><br><span class="line">pihole    | Added ENV to php:</span><br><span class="line">pihole    |                     "PHP_ERROR_LOG" =&gt; "/var/log/lighttpd/error.log",</span><br><span class="line">pihole    |                     "ServerIP" =&gt; "0.0.0.0",</span><br><span class="line">pihole    |                     "VIRTUAL_HOST" =&gt; "0.0.0.0",</span><br><span class="line">pihole    | Using IPv4 and IPv6</span><br><span class="line">pihole    | ::: Preexisting ad list /etc/pihole/adlists.list detected ((exiting setup_blocklists early))</span><br><span class="line">pihole    | https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts</span><br><span class="line">pihole    | https://mirror1.malwaredomains.com/files/justdomains</span><br><span class="line">pihole    | ::: Testing pihole-FTL DNS: FTL started!</span><br><span class="line">pihole    | ::: Testing lighttpd config: Syntax OK</span><br><span class="line">pihole    | ::: All config checks passed, cleared for startup ...</span><br><span class="line">pihole    |  ::: Docker start setup complete</span><br><span class="line">pihole    |   [i] Neutrino emissions detected...</span><br><span class="line">  [âœ“] Pulling blocklist source list into range</span><br><span class="line">pihole    |</span><br><span class="line">  [âœ“] Preparing new gravity database</span><br><span class="line">pihole    |   [i] Target: https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts</span><br><span class="line">pihole    |   [i] Received 55654 domains</span><br><span class="line">pihole    |   [i] Target: https://mirror1.malwaredomains.com/files/justdomains</span><br><span class="line">  [âœ“] Status: No changes detected</span><br><span class="line">pihole    |   [i] Received 26854 domains</span><br><span class="line">  [âœ“] Storing downloaded domains in new gravity database</span><br><span class="line">  [âœ“] Building tree</span><br><span class="line">  [âœ“] Swapping databases</span><br><span class="line">pihole    |   [i] Number of gravity domains: 82508 (82465 unique domains)</span><br><span class="line">pihole    |   [i] Number of exact blacklisted domains: 0</span><br><span class="line">pihole    |   [i] Number of regex blacklist filters: 0</span><br><span class="line">pihole    |   [i] Number of exact whitelisted domains: 0</span><br><span class="line">pihole    |   [i] Number of regex whitelist filters: 0</span><br><span class="line">  [âœ“] Cleaning up stray matter</span><br><span class="line">pihole    |</span><br><span class="line">pihole    |   [âœ“] DNS service is running</span><br><span class="line">pihole    |   [âœ“] Pi-hole blocking is Enabled</span><br><span class="line">pihole    |   Pi-hole version is v5.1.2 (Latest: v5.1.2)</span><br><span class="line">pihole    |   AdminLTE version is v5.1.1 (Latest: v5.1.1)</span><br><span class="line">pihole    |   FTL version is v5.2 (Latest: v5.2)</span><br><span class="line">pihole    | [cont-init.d] 20-start.sh: exited 0.</span><br><span class="line">pihole    | [cont-init.d] done.</span><br><span class="line">pihole    | [services.d] starting services</span><br><span class="line">pihole    | Starting pihole-FTL (no-daemon) as root</span><br><span class="line">pihole    | Starting lighttpd</span><br><span class="line">pihole    | Starting crond</span><br><span class="line">pihole    | [services.d] done.</span><br></pre></td></tr></table></figure><ul><li>æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ <code>http://ip:port/admin</code> å³å¯è¿›å…¥ Pi-hole çš„åå°ç®¡ç†é¡µé¢ï¼Œåœ¨è¿™é‡Œå¯ä»¥æŸ¥çœ‹åˆ° DNS è§£æçš„è¯¦ç»†è®°å½•ï¼Œå…³äº Pi-hole çš„ä½¿ç”¨å¯ä»¥å‚è€ƒä¸€äº›å¤§ä½¬çš„åšå®¢ï¼Œæ¯”å¦‚ <a href="https://wzyboy.im/post/1372.html" target="_blank" rel="noopener">æ­å»º Pi-Hole ä¸ºç½‘ä¸Šå†²æµªä¿é©¾æŠ¤èˆª</a>ã€‚</li></ul><p><img src="https://p.k8s.li/20200925-pihole.png" alt=""></p><p>å¦‚æœæƒ³è¦è®©å†…ç½‘çš„æœºå™¨éƒ½èµ° Pi-hole æ¥è¿›è¡Œ DNS ï¼Œå¯ä»¥å°†è·¯ç”±å™¨çš„ DHCP çš„  DNS çš„ IP è®¾ç½®ä¸º Pi-hole çš„ IPã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://cloud.google.com/blog/products/containers-kubernetes/bringing-ebpf-and-cilium-to-google-kubernetes-engine" target="_blank" rel="noopener">New GKE Dataplane V2 increases security and visibility for containers</a></li><li><a href="https://moelove.info/2020/09/02/%E8%A2%AB-Google-%E9%80%89%E6%8B%A9%E7%9A%84%E4%B8%8B%E4%B8%80%E4%BB%A3%E6%95%B0%E6%8D%AE%E9%9D%A2-Cilium-%E6%98%AF%E4%BB%80%E4%B9%88/" target="_blank" rel="noopener">è¢« Google é€‰æ‹©çš„ä¸‹ä¸€ä»£æ•°æ®é¢ Cilium æ˜¯ä»€ä¹ˆ</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;å‰æ®µæ—¶é—´æ¡åƒåœ¾ä¸œæ‹¼è¥¿å‡‘æäº†å° Homelab ğŸ‘‡ç©ç©
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="å®¹å™¨" scheme="https://blog.k8s.li/tags/%E5%AE%B9%E5%99%A8/"/>
    
      <category term="PhotonOS" scheme="https://blog.k8s.li/tags/PhotonOS/"/>
    
      <category term="Linux" scheme="https://blog.k8s.li/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ç»™é˜µåˆ—å¡åˆ·ä¸ªæœºï¼ŒIR æ¨¡å¼è½¬ IT æ¨¡å¼</title>
    <link href="https://blog.k8s.li/lsi-9211-4i-ir-to-it.html"/>
    <id>https://blog.k8s.li/lsi-9211-4i-ir-to-it.html</id>
    <published>2020-09-07T16:00:00.000Z</published>
    <updated>2020-09-07T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åˆ·æœºï¼Ÿ"><a href="#åˆ·æœºï¼Ÿ" class="headerlink" title="åˆ·æœºï¼Ÿ"></a>åˆ·æœºï¼Ÿ</h2><p>ä¸ä¹…å‰æ¡åƒåœ¾æäº†ä¸€å°ä½åŠŸè€— Homelab ä¸»æœºç©ç©ï¼Œç”±äºä¸»æ¿ SATA å£çš„é™åˆ¶ï¼Œä¸èƒ½ä½¿ç”¨å¤§äº 2TB çš„ç¡¬ç›˜ï¼Œå¯¹äºå’±æ¢¦æƒ³ç€è¿™ç§æ‹¥æœ‰å‡ å TB å­˜å‚¨æ¥å­˜æ”¾è€å©†çš„æ­»è‚¥å®…æ¥è¯´ï¼Œ2TB æ€ä¹ˆå¤Ÿäº†ã€‚äºæ˜¯æƒ³è¦çªç ´é™åˆ¶ï¼Œå†ç»™ Homelab ä¸»æœºå¢åŠ ä¸€å— 6TB çš„ç£ç›˜ã€‚äºæ˜¯ï¼Œåœ¨æ´‹åƒåœ¾å †é‡ŒèŠ±äº† 50 å—é’±æ¡äº†è¿™å—é˜µåˆ—å¡ğŸ‘‡ã€‚</p><p><img src="https://p.k8s.li/20200830_9211-4i-01.jpg" alt=""></p><p>ä¹°çš„è¿™å—é˜µåˆ—å¡å‹å·æ˜¯ <a href="https://lenovopress.com/tips0831-serveraid-h1110" target="_blank" rel="noopener">ServeRAID H1110 SAS/SATA Controller for IBM System x </a> ï¼Œå–å®¶è¯´æ˜¯ <code>IBM H1110</code> ï¼Œå…¶å®éƒ½å·®ä¸å¤šå•¦ã€‚ç”±äºæ˜¯ç¬¬ä¸€æ¬¡ç©å„¿é˜µåˆ—å¡ï¼Œå¯¹è¿™ç§å‹å·ä¹Ÿä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œä¹‹ååˆ·äº†æ–°çš„å›ºä»¶åˆå˜æˆäº† <code>LSI 9211-4i</code> ã€‚</p><h2 id="ç¿»è½¦ï¼Ÿ"><a href="#ç¿»è½¦ï¼Ÿ" class="headerlink" title="ç¿»è½¦ï¼Ÿ"></a>ç¿»è½¦ï¼Ÿ</h2><p>æ”¶åˆ°è´§åï¼Œè¿«ä¸åŠå¾…åœ°å°†å­˜æ»¡è€å©†çš„ç¡¬ç›˜æ¥åˆ°é˜µåˆ—å¡ä¸Šï¼Œå¼€æœºçš„æ—¶å€™ï¼Œä¸€ç›´å¡åœ¨é˜µåˆ—å¡ BIOS åˆå§‹åŒ–é¡µé¢å¾ˆä¹…å¾ˆä¹…ã€‚é¡¿æ—¶è§‰ç€ï¼Œå®Œè›‹ç¿»è½¦äº†ï¼Œæ­£å‡†å¤‡å»æ€¼ä¸€æ³¢å–å®¶ï¼Œé˜µåˆ—å¡å¯åŠ¨ç­‰äº†äº”å…­åˆ†é’Ÿåè¿›å…¥äº†ä¹…è¿çš„  ESXi çš„å¯åŠ¨é¡µé¢ã€‚è¿™å°¼ç›ï¼Œå‘æˆ‘å•Šï¼Œä½ ä¸€ä¸ªå·´æŒå¤§çš„é˜µåˆ—å¡å¯åŠ¨ç«Ÿç„¶éœ€è¦äº”åˆ†é’Ÿï¼Ÿå†…å¿ƒä¸€ä¸‡åŒ¹è‰æ³¥é©¬å¥”è…¾è€Œè¿‡ã€‚</p><p><img src="https://p.k8s.li/20200830_9211-4i-02.png" alt=""></p><h2 id="IR-æ¨¡å¼ï¼Ÿ"><a href="#IR-æ¨¡å¼ï¼Ÿ" class="headerlink" title="IR æ¨¡å¼ï¼Ÿ"></a>IR æ¨¡å¼ï¼Ÿ</h2><p>åœ¨ç½‘ä¸Šçœ‹æ¥ä¸€ä¸‹å¤§ä½¬ä»¬çš„è¯„è®ºï¼Œè¯´é˜µåˆ—å¡ IR æ¨¡å¼çš„å¯åŠ¨é€Ÿåº¦è¦æ…¢ä¸€äº›ï¼Ÿç„¶ååˆæ‰¾åˆ°äº† <a href="https://wiki2.xbits.net:4430/hardware:lsi:h1110-it-firmware" target="_blank" rel="noopener">IBM H1110å¡åˆ·ä¸ºLSI 9211-4i ITå›ºä»¶</a> ï¼Œé‡Œé¢æåˆ°çš„å¯ä»¥å°† IR æ¨¡å¼åˆ·ä¸º IT ç›´é€šæ¨¡å¼ã€‚è‡³äº IR æ¨¡å¼å’Œ IT æ¨¡å¼ï¼Œè‡ªå·±å¤ªèœæ²¡æ‰¾åˆ°ç¡®åˆ‡çš„èµ„æ–™ã€‚å¤§æ¦‚å¯ä»¥ç†è§£ä¸º IR æ¨¡å¼é€‚ç”¨äºä½¿ç”¨é˜µåˆ—å¡ç»„ RAID é˜µåˆ—ï¼Œè€Œ IT æ¨¡å¼å°±æ˜¯æ‰€è°“çš„ç›´é€šæ¨¡å¼ï¼Œä¸é€‚ç”¨ RAID ï¼Œåªä½¿ç”¨é˜µåˆ—å¡çš„ç£ç›˜æ§åˆ¶å™¨ï¼Ÿç›¸å½“äºä¸»æ¿ä¸Šçš„ SATA æ¥å£ã€‚ä½•å†µæˆ‘è¿™ä¸ªæ˜¯å°ä¸»æœºï¼Œé‡Œé¢ä¹Ÿå¡ä¸ä¸‹é‚£ä¹ˆå¤šçš„ç£ç›˜ï¼Œæ‰€ä»¥é˜µåˆ—å¡ä½¿ç”¨ IT ç›´é€šæ¨¡å¼æ— ç–‘æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚</p><p><img src="https://p.k8s.li/20200828_9211-4i-03.jpg" alt=""></p><h2 id="ä¸‡ç‰©çš†å¯åˆ·ï¼Ÿ"><a href="#ä¸‡ç‰©çš†å¯åˆ·ï¼Ÿ" class="headerlink" title="ä¸‡ç‰©çš†å¯åˆ·ï¼Ÿ"></a>ä¸‡ç‰©çš†å¯åˆ·ï¼Ÿ</h2><p>å‚ç…§å¤§ä½¬ä»¬çš„åšå®¢ï¼Œå’±ä¹Ÿè¦ä½“éªŒä¸€æŠŠåˆ·<del>æœº</del>å¡çš„ç—›å¿«äº†ï¼Œæ¯•ç«ŸæŠ˜è…¾è¿™äº›æ²¡ç”¨çš„ç©æ„å„¿ä¹Ÿæ˜¯å’±çš„ä¸€å¤§ä¹è¶£ã€‚</p><blockquote><p>  æˆ‘é’å¹´æ—¶ä»£å°±åˆ·è¿‡ï¼šè¯ºåŸºäºšã€æ‘©æ‰˜ç½—æ‹‰ã€ä¸‰æ˜Ÿã€é»‘è“ã€Lumiaã€HTCï¼Œæˆ‘è¿˜åˆ·è¿‡ï¼šè·¯ç”±å™¨ã€äº¤æ¢æœºã€é˜µåˆ—å¡ã€ç”µè§†ç›’å­â€¦â€¦</p></blockquote><p>å®‰å“<del>åŸº</del>æœºä½¬ä»¬æƒ³å¿…å¯¹ twrp å†ç†Ÿæ‚‰ä¸è¿‡äº†ï¼Œå®ƒæ˜¯æˆ‘ä»¬åˆ·æœºï¼Œåˆ·å„ç§ ROM åŒ…æœ€å¸¸ç”¨çš„ç³»ç»Ÿï¼Œç›¸å½“äº Windows ä¸­çš„ PE ç³»ç»Ÿï¼Œå¯¹ç³»ç»Ÿåˆ†åŒºåˆ·ä¸Š ROM æ¥è¾¾åˆ°åˆ·æœºçš„ç›®çš„ã€‚åˆ·é˜µåˆ—å¡çš„å›ºä»¶å’Œåˆ·æœºä¹Ÿå·®ä¸å¤šï¼Œä¹Ÿæ˜¯éœ€è¦ä¸€ä¸ªåº•å±‚çš„ç³»ç»Ÿè¿›å»å¯¹é˜µåˆ—å¡ä¸Šçš„å­˜å‚¨èŠ¯ç‰‡è¿›è¡Œæ“ä½œã€‚æœ€å¸¸è§çš„å°±æ˜¯ Dos å’Œ EFI Shell ï¼Œç”±äº Dos å¹´ä»£ä¹…è¿œï¼Œä¸”æˆ‘çš„ä¸»æ¿å¯¹ EFI æ”¯æŒæ¯”è¾ƒå‹å¥½ï¼Œåœ¨è¿›è¡Œåˆ·æœºçš„æ—¶å€™ä¸ºäº†ç¨³å¦¥èµ·è§é€‰æ‹© EFI shellã€‚</p><h3 id="è®°å½•-SAS-åœ°å€"><a href="#è®°å½•-SAS-åœ°å€" class="headerlink" title="è®°å½• SAS åœ°å€"></a>è®°å½• SAS åœ°å€</h3><p>åœ¨åˆ·é˜µåˆ—å¡ä¹‹å‰è¦çº¿è®°å½•ä¸‹ SAS çš„ Address ï¼Œè¿›å…¥åˆ°é˜µåˆ—å¡çš„ BIOS ä¸­ä¼šæœ‰è¿™ä¸ªä¿¡æ¯ã€‚</p><h3 id="æ‰¾å¥½å›ºä»¶å’Œæ–‡æ¡£"><a href="#æ‰¾å¥½å›ºä»¶å’Œæ–‡æ¡£" class="headerlink" title="æ‰¾å¥½å›ºä»¶å’Œæ–‡æ¡£"></a>æ‰¾å¥½å›ºä»¶å’Œæ–‡æ¡£</h3><p>ç”±äºæˆ‘è¦åˆ·å…¥çš„å›ºä»¶ä¸æ˜¯é˜µåˆ—å¡åŸå‚çš„å›ºä»¶ï¼Œåªæ‰¾åˆ°äº†ç°æˆçš„å›ºä»¶ï¼Œç›´æ¥å°±æ‹¿æ¥ç”¨äº†ï¼Œåº”è¯¥é—®é¢˜ä¸å¤§ã€‚è€Œä¸”åˆ·å…¥çš„æµç¨‹ä¹Ÿæ˜¯æ¯”è¾ƒç®€ç­”ã€‚<a href="https://wiki2.xbits.net:4430/hardware:lsi:h1110-it-firmware" target="_blank" rel="noopener">IBM H1110å¡åˆ·ä¸ºLSI 9211-4i ITå›ºä»¶</a> :</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¤‡ä»½åŸå¡ä¿¡æ¯å’Œsbr</span></span><br><span class="line">MegaCli.exe -AdpAllInfo -aAll -ApplogFile bak.txt</span><br><span class="line">MegaRec.exe -readsbr 0 orig.sbr</span><br><span class="line"><span class="meta">#</span><span class="bash">æ“¦å†™sbrå’Œflashä¸€éèƒ½åˆ·å…¥LSIåŸå‚å›ºä»¶</span></span><br><span class="line">MegaRec -writesbr 0 sbrempty.bin</span><br><span class="line">MegaRec -cleanflash 0</span><br><span class="line"><span class="meta">#</span><span class="bash">é‡å¯å†æ¬¡è¿›å…¥DOS</span></span><br><span class="line">reboot</span><br><span class="line"><span class="meta">#</span><span class="bash">åˆ·å…¥å¯¹åº”ITå›ºä»¶å’ŒROM</span></span><br><span class="line">sas2flsh -o -f 2114it.bin -b mptsas2.rom</span><br><span class="line"><span class="meta">#</span><span class="bash">æ¢å¤åŸæ¥çš„SASåœ°å€</span></span><br><span class="line">sas2flsh -o -sasadd xxxxxxxx</span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹æœ€æ–°çŠ¶æ€</span></span><br><span class="line">sas2flsh -list</span><br><span class="line"><span class="meta">#</span><span class="bash">é‡å¯ï¼Œå®Œæˆ</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><p>ä¸€äº›å®˜æ–¹çš„æ–‡æ¡£<a href="https://www.broadcom.cn/support/knowledgebase/1211161495925/flash-upgrading-firmware-on-lsi-sas-hbas-upgraded-firmware-on-92" target="_blank" rel="noopener">Flash upgrading firmware on LSI SAS HBAs; Upgraded firmware on 9211-8i to P8, now duplicated drives</a>ï¼š</p><blockquote><p>  Advanced users:</p><p>  To delete the firmware and BIOS in your 9211, then reflash it, follow these steps:</p><ol><li><p>Check to see if there is an also an onboard SATA controller with disk in the system before running the commands below.<br>Run sas2flsh -listall<br>If you see only the 9211, then run the commands as shown below.<br>If you see two controllers (e.g. c0 and c1, then add -c 1 to all of the commands belowâ€“&gt; sas2flsh -c 1 -o -e 6</p></li><li><p>Record the SAS address of the 9211 in case you need it later.  To display it, type:<br>sas2flsh -list</p><p>and write down the SAS address.  You can run the is DOS, Windows, Linux, etc.</p></li><li><p>Download 9211_8i_Package_for_P9_Firmware_BIOS_on_MSDOS_and_Windows.zip for the 9211-8i</p></li><li><p>Boot to DOS (create a DOS bootable USB stick from <a href="http://www.bootdisk.com" target="_blank" rel="noopener">http://www.bootdisk.com</a> or <a href="http://www.gocoding.com" target="_blank" rel="noopener">www.gocoding.com</a>).</p></li><li><p>Run from DOS sas2flsh -o -e 6 (this will erase the controller firmware and BIOS).</p></li><li><p>Turn the system off.</p></li><li><p>Turn the system on and boot to DOS (note:  the BIOS wonâ€™t post, as you will reflash it in step 8 below).</p></li><li><p>Run from DOS, with files sas2flsh.exe, the .bin and .rom files in the same directory:</p><p>For IR firmware:  sas2flsh -f 9211IRP9.bin -b mptsas2.rom<br>For IT firmware:  sas2flsh -f 9211itp9.bin -b mptsas2.rom</p><p>Note:  you will need to rename 9211-8i_IR_P9.bin to 9211IRP9.bin and 9211-8i-IT_ph9.bin to 9211itp9.bin</p></li><li><p>The controller will now work normally, with the P9 firmware and BIOS.</p></li><li><p>Check to make sure you have a SAS address:<br>sas2flsh -list<br>If you see the same SAS address that you had in step 2, then you are done.<br>If you donâ€™t see the same SAS address, or you donâ€™t see a SAS address, type:<br>sas2flsh -o -sasadd <SAS address></p></li></ol></blockquote><p>ä¸Šé¢æåˆ°çš„éƒ½æ˜¯åŸºäº Dos ç³»ç»Ÿä¸Šæ“ä½œçš„ï¼Œä¸è¿‡æˆ‘è¯•äº†ä¸€ä¸‹éƒ½ç¿»è½¦äº†ğŸ¤£</p><h3 id="åˆ¶ä½œ-EFI-shell-ç³»ç»Ÿ"><a href="#åˆ¶ä½œ-EFI-shell-ç³»ç»Ÿ" class="headerlink" title="åˆ¶ä½œ EFI shell ç³»ç»Ÿ"></a>åˆ¶ä½œ EFI shell ç³»ç»Ÿ</h3><p>å¦‚æœä¸»æ¿æ”¯æŒ EFI çš„è¯ï¼Œå»ºè®®ä½¿ç”¨ EFI shell åˆ·å…¥å›ºä»¶ï¼Œåœ¨ Dos ä¸‹ä¼šæœ‰äº›å¥‡æ€ªçš„é—®é¢˜ã€‚</p><p>æŒ‰ç…§ <a href="https://superuser.com/questions/1057446/how-do-i-boot-to-uefi-shell" target="_blank" rel="noopener">How do I â€œBoot to UEFI shellâ€?</a> ä¸­æåˆ°çš„ï¼š</p><blockquote><p>It depends on whether your UEFI has a shell builtin. If it does, there should be an option in its settings / boot menu for you to launch it. Some motherboard also provide an option to launch a shell from the EFI System Partition (ESP). You should consult the manual of your motherboard for the path it will look for (the instruction is often vague though). Usually they are looking for a file named <code>Shell.efi</code> in the ESP root folder.</p><p>Another way is to launch it just like you launch any other EFI binary (e.g. bootloader). Since itâ€™s not really accessible to register a EFI binary to your UEFI or put the shell binary to your ESP in Windows, so the easiest way is probably to put it as <code>\EFI\Boot\bootx64.efi</code> <strong>(also put the <code>update.nsh</code> you need to run and the files it requires under <code>\EFI\Boot\</code>)</strong> in a FAT(32)-formatted USB drive (It shouldnâ€™t matter whether itâ€™s MBR or GPT as long as your UEFI is standard-conforming enough). <strong>Then reboot and boot the USB in UEFI mode from your UEFI boot menu.</strong></p><p>You can obtain the EFI shell binary from the EDK2 project repo:</p><ul><li><p><a href="https://github.com/tianocore/edk2/releases/download/edk2-stable202002/ShellBinPkg.zip" target="_blank" rel="noopener">version 2</a></p></li><li><p><a href="https://github.com/tianocore/edk2/blob/UDK2018/EdkShellBinPkg/FullShell/X64/Shell_Full.efi?raw=true" target="_blank" rel="noopener">version 1 (no longer updated, only for old UEFI that does not work with v2)</a></p><p>(<strong>Note:</strong> some older EFI tools like [sas2flash.efi](<a href="https://www.broadcom.com/site-search?q=Installer" target="_blank" rel="noopener">https://www.broadcom.com/site-search?q=Installer</a> for UEFI) only work with such an old EFI shell (which works on current mainboards with current UEFI))</p></li></ul></blockquote><p>é¦–å…ˆéœ€è¦ä¸€ä¸ª U ç›˜ï¼Œå¯¹å®¹é‡æ²¡æœ‰é—²ç½®ï¼Œå‡ åå…†è¶³å¤Ÿï¼ŒæŠŠåˆ†åŒºæ ¼å¼åŒ–ä¸º FAT32 æ–‡ä»¶ç³»ç»Ÿæ ¼å¼ï¼Œç„¶åä¸‹è½½ä¸€ä¸ª EFI shell çš„ efi æ–‡ä»¶ <a href="https://github.com/tianocore/edk2/blob/UDK2018/EdkShellBinPkg/FullShell/X64/Shell_Full.efi?raw=true" target="_blank" rel="noopener">version 1 </a>ï¼ŒæŠŠè¯¥æ–‡ä»¶ä¿å­˜åœ¨ FAT32 åˆ†åŒºä¸‹çš„ <code>\EFI\Boot\bootx64.efi</code> è·¯å¾„ä¸‹ã€‚</p><blockquote><p>  Download from Github Tianocore the precompiled UEFI version 1 Shell: <a href="https://github.com/tianocore/edk2/tree/master/EdkShellBinPkg/FullShell/X64" target="_blank" rel="noopener">Shell_Full.efi</a>. (Only v1 is applicable, later versions are not compatible with the flash tool and end up with the message: â€œInitShellApp: Application not started from Shellâ€.)</p></blockquote><p>ç”±äºåˆ·å›ºä»¶çš„å·¥å…· <code>sas2flash.efi</code> åªå’Œ EFI shell v1 ç‰ˆæœ¬çš„å…¼å®¹ï¼Œæˆ‘ç¬¬ä¸€æ¬¡åˆ·çš„æ—¶å€™æ—¶ä½¿ç”¨çš„ v2 ç‰ˆæœ¬ï¼Œæç¤º <code>â€œInitShellApp: Application not started from Shellâ€</code> é”™è¯¯ğŸ˜‚</p><p>ç„¶åè¿˜éœ€è¦æŠŠå›ºä»¶ <code>2114it.bin</code> ï¼Œä»¥åŠåˆ·å›ºä»¶ç”¨åˆ°çš„å·¥å…· <code>sas2flash.efi</code> æ”¾å…¥åˆ° FAT32 è·Ÿç›®å½•ä¸‹ï¼Œå…¶ä¸­å›ºä»¶æ ¹æ®é˜µåˆ—å¡çš„å‹å·ä¸åŒéœ€è¦è‡ªè¡Œæ‰¾åˆ°ç›¸åº”çš„å›ºä»¶ç‰ˆæœ¬ï¼Œæˆ‘è¿™ä¸ªè™½ç„¶æ˜¯ IBM H1110 å‹å·çš„ï¼Œä½†æ˜¯å¯ä»¥åˆ·æˆ LSI 9211 çš„ï¼Œæ‰€ä»¥å°±æ²¡å»æ‰¾åŸå‚çš„å›ºä»¶ã€‚</p><h3 id="è¿›å…¥-EFI-shell-åˆ·å…¥æ–°çš„å›ºä»¶"><a href="#è¿›å…¥-EFI-shell-åˆ·å…¥æ–°çš„å›ºä»¶" class="headerlink" title="è¿›å…¥ EFI shell åˆ·å…¥æ–°çš„å›ºä»¶"></a>è¿›å…¥ EFI shell åˆ·å…¥æ–°çš„å›ºä»¶</h3><p>ä» <a href="https://www.ixsystems.com/community/threads/how-to-flash-lsi-9211-8i-using-efi-shell.50902/" target="_blank" rel="noopener">How-to: Flash LSI 9211-8i using EFI shell</a> å¤§ä½¬é‚£é‡Œå¤åˆ¶ç²˜è´´è¿‡æ¥çš„çš„æ•™ç¨‹ï¼š</p><blockquote><ol><li>Insert the controller card in a PCIe slot. (Iâ€™ve used the slot Nr. 3. In case of troubles recognizing the card in your desktop PC try different slots.)</li><li>Boot the PC and prepare the USB stick:</li><li>In the USB stick create and format a FAT or FAT32 partition &gt;= 10 MB. (Iâ€™ve created 500 MB FAT32 partition. I wouldnâ€™t recommend large partitions, who knows if the EFI shell will read every big partition.)</li><li>Create the sub-folders for EFI boot. In the web there are two different structures: <code>/boot/efi</code> and <code>/efi/boot</code>. For time saving Iâ€™ve created both groups, it works.</li><li>Download from Broadcom following packages: <a href="https://docs.broadcom.com/docs/12350820" target="_blank" rel="noopener">Installer_P20_for_UEFI</a> and <a href="https://docs.broadcom.com/docs/12350530" target="_blank" rel="noopener">9211-8i_Package_P20_IR_IT_Firmware_BIOS_for_MSDOS_Windows</a> and extract them on your PCâ€™s HDD.</li><li>Copy from the downloaded packages three files to the USB stick root folder:</li><li>from the first package the file <code>sas2flash.efi</code> (it is in sub-folder <code>/sas2flash_efi_ebc_rel/</code>);</li><li>from the second package: <code>2118it.bin</code> (it is in sub-folder <code>/Firmware/HBA_9211_8i_IT/</code>) and <code>mptsas2.rom</code> (it is in sub-folder <code>/sasbios_rel/</code>).</li><li>Download from Github Tianocore the precompiled UEFI version 1 Shell: <a href="https://github.com/tianocore/edk2/tree/master/EdkShellBinPkg/FullShell/X64" target="_blank" rel="noopener">Shell_Full.efi</a>. (Only v1 is applicable, later versions are not compatible with the flash tool and end up with the message: â€œInitShellApp: Application not started from Shellâ€.)</li><li>Rename the <code>Shell_Full.efi</code> in <code>ShellX64.efi</code> and copy this file to following three USB stick destinations: root folder, <code>/boot/efi/</code>, <code>/efi/boot/</code>. (Again, there are different advices, for time saving it easier to use all three choices.)</li><li>The creative part is completed, itâ€™s time for action. Restart the PC and enter the BIOS. If you use ASUS UEFI BIOS Utility in advanced mode, mouse click on the Exit (not by using keyboard â€œEscâ€), in the next dialog select â€œLaunch EFI Shell from filesystem deviceâ€. Other BIOS should behave similarly.</li><li>Next you should see starting shell execution, ending with a prompt: â€œShell&gt;â€ (not the â€œ2.0 Shell&gt;â€!).</li><li>Type the command: <code>map â€“b</code> (+Enter) for listing of available disks. Locate which one is your USB stick. In my case it is the fs6:<br>â€œfs6 :Removable HardDisk - â€¦ USB(â€¦)â€</li><li>You can break further execution of the map command by <code>q</code>.</li><li>Switch to the located USB stick by command <code>fsN:</code> (+Enter) (N=6 â€“ in my example = â€œfs6:â€, set N to your USB stick ID).</li><li><code>Dir</code> shows the file list:<br>2118IT.BIN<br>MPTSAS2.ROM<br>sas2flash.efi<DIR> BOOT<DIR> EFIShellX64.efi</li><li>The action can start. During it the power shall not be brocken!</li><li>Erase the controller flash memory: <code>sas2flash.efi -o -e 6</code>.</li><li>Write the new firmware to the flash: <code>sas2flash.efi -o -f 2118it.bin -b mptsas2.rom</code>.</li><li>After a while youâ€™ll see the success message. You can restart the PC and check if the controller BIOS reports the new â€œITâ€-firmware.</li><li>The card is ready to use.</li></ol></blockquote><ul><li>ä½¿ç”¨ <code>map -b</code> å‘½ä»¤æŸ¥çœ‹ U ç›˜çš„è·¯å¾„ï¼Œä¸€èˆ¬ä¸º <code>fsX</code> ç„¶åæŒ‰ä¸‹ <code>fs0:</code> è·¯å¾„å°±åˆ‡æ¢åˆ°äº† U ç›˜çš„ FAT32 åˆ†åŒºä¸‹ã€‚</li></ul><p><img src="https://p.k8s.li/20200828_9211-4i-04.jpg" alt=""></p><ul><li>ç„¶åä½¿ç”¨ <code>sas2flash.efi -o -e 6</code> å‘½ä»¤æ¸…ç©ºé˜µåˆ—å¡çš„  <code>flash memory</code>ã€‚</li><li>æ¥ç€ä½¿ç”¨ <code>sas2flsh -o -f 2114it.bin -b mptsas2.rom</code> å‘½ä»¤åˆ·å…¥æ–°çš„å›ºä»¶ã€‚</li></ul><p><img src="https://p.k8s.li/20200828_9211-4i-05.jpg" alt=""></p><ul><li>æ¢å¤ SAS åœ°å€ <code>sas2flsh -o -sasadd xxxxxxxx</code> </li></ul><p>æ“ä½œå®Œä»¥ä¸Šæ­¥éª¤åå°±å¯ä»¥é‡å¯äº†</p><h2 id="IT-æ¨¡å¼ï¼Ÿ"><a href="#IT-æ¨¡å¼ï¼Ÿ" class="headerlink" title="IT æ¨¡å¼ï¼Ÿ"></a>IT æ¨¡å¼ï¼Ÿ</h2><p>åˆ·å®Œä¹‹åé˜µåˆ—å¡çš„å‹å·å°±è«åå…¶å¦™åœ°å˜æˆäº† <code>LSIÂ® SAS 9211-4i PCI ExpressÂ® to 6Gb/s Serial Attached SCSI (SAS) Host Bus Adapter</code> ï¼Œå›ºä»¶çš„ç‰ˆæœ¬ä¹Ÿå˜æˆäº†  IT æ¨¡å¼ï¼Œå¼€æœºçš„é€Ÿåº¦æ¯”ä»¥å‰å¿«äº†å¾ˆå¤šï¼Œåªéœ€è¦ä¸åˆ° 5s å°±è‡ªæ£€å®Œæˆè¿›å…¥ ESXi çš„å¯åŠ¨æµç¨‹ï¼Œç»ˆäºå‘Šåˆ«åŸå…ˆçš„é¾Ÿé€Ÿå¯åŠ¨äº†ã€‚</p><p><img src="https://p.k8s.li/20200828_9211-4i-06.jpg" alt=""></p><p>åœ¨ ESXi ä¸­ï¼Œé˜µåˆ—å¡ä¹Ÿè¢«è¯†åˆ«ä¸ºäº† <code>LSI2004</code> ï¼Œçœ‹æ¥æ˜¯æ²¡é—®é¢˜äº†ï¼Œæ’ä¸Šç¡¬ç›˜ä¹Ÿéƒ½æ˜¯è¯†åˆ«å‡ºæ¥äº†ã€‚</p><p><img src="https://p.k8s.li/20200908_9211-4i-07.png" alt=""></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>ç”±äºæ˜¯æ˜¯ç¬¬ä¸€æ¬¡ç»™é˜µåˆ—å¡åˆ·å›ºä»¶ï¼Œåœ¨ç½‘ä¸Šæ‰¾åˆ°äº†å†™èµ„æ–™å¯ä»¥åšå‚è€ƒã€‚</p><ul><li><a href="https://wiki2.xbits.net:4430/hardware:lsi:h1110-it-firmware" target="_blank" rel="noopener">IBM H1110å¡åˆ·ä¸ºLSI 9211-4i ITå›ºä»¶</a></li><li><a href="https://www.tfir.io/easiest-way-to-flash-lsi-sas-9211-8i-on-motherboards-without-efi-shell/" target="_blank" rel="noopener">Easiest Way To Flash LSI SAS 9211-8i on Motherboards without EFI Shell</a></li><li><a href="https://www.broadcom.cn/support/knowledgebase/1211161495925/flash-upgrading-firmware-on-lsi-sas-hbas-upgraded-firmware-on-92" target="_blank" rel="noopener">Flash upgrading firmware on LSI SAS HBAs; Upgraded firmware on 9211-8i to P8, now duplicated drives</a></li><li><a href="chrome-extension://ikhdkkncnoglghljlkmcimlnlhkeamad/pdf-viewer/web/viewer.html?file=https%3A%2F%2Fdocs.broadcom.com%2Fdoc%2F12353332">LSIÂ® SAS 9211-4i PCI ExpressÂ® to 6Gb/s Serial Attached SCSI (SAS) Host Bus Adapter </a></li><li><a href="https://www.ixsystems.com/community/threads/how-to-flash-lsi-9211-8i-using-efi-shell.50902/" target="_blank" rel="noopener">How-to: Flash LSI 9211-8i using EFI shell</a></li><li><a href="https://github.com/bsodmike/s5clouds8-lsi9211-8i-IR-to-IT-EFI-bootable-usb" target="_blank" rel="noopener">s5clouds8-lsi9211-8i-IR-to-IT-EFI-bootable-usb</a></li><li><a href="https://superuser.com/questions/1057446/how-do-i-boot-to-uefi-shell" target="_blank" rel="noopener">How do I â€œBoot to UEFI shellâ€?</a></li><li><a href="https://forums.laptopvideo2go.com/topic/29059-sas2008-lsi92409211-firmware-files/" target="_blank" rel="noopener">SAS2008 (LSI9240/9211) Firmware files</a></li><li><a href="https://www.servethehome.com/ibm-serveraid-m1015-part-4/" target="_blank" rel="noopener">IBM ServeRAID M1015 Part 4: Cross flashing to a LSI9211-8i in IT or IR mode</a></li><li><a href="https://web.archive.org/web/20200423162708/http://brycv.com/blog/2012/flashing-it-firmware-to-lsi-sas9211-8i/" target="_blank" rel="noopener">Flashing IT Firmware to the LSI SAS9211-8i HBA</a></li><li><a href="https://forum.openmediavault.org/index.php?thread/2310-ibm-m1015-ir-vs-it/" target="_blank" rel="noopener">IBM M1015 - IR vs. IT</a></li><li><a href="https://marcan.st/2016/05/crossflashing-the-fujitsu-d2607/" target="_blank" rel="noopener">Crossflashing the Fujitsu D2607</a></li><li><a href="https://kc.mcafee.com/corporate/index?page=content&id=KB90801&locale=en_US" target="_blank" rel="noopener">How to create a bootable USB media to access the default EFI shell</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;åˆ·æœºï¼Ÿ&quot;&gt;&lt;a href=&quot;#åˆ·æœºï¼Ÿ&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="åˆ·æœº" scheme="https://blog.k8s.li/tags/%E5%88%B7%E6%9C%BA/"/>
    
      <category term="é˜µåˆ—å¡" scheme="https://blog.k8s.li/tags/%E9%98%B5%E5%88%97%E5%8D%A1/"/>
    
  </entry>
  
  <entry>
    <title>åƒåœ¾ä½¬çš„ Homelab æŠ˜è…¾è®°å½•</title>
    <link href="https://blog.k8s.li/homelab.html"/>
    <id>https://blog.k8s.li/homelab.html</id>
    <published>2020-08-20T16:00:00.000Z</published>
    <updated>2021-04-17T01:11:01.098Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ¡åƒåœ¾"><a href="#æ¡åƒåœ¾" class="headerlink" title="æ¡åƒåœ¾"></a>æ¡åƒåœ¾</h2><p>æ¥è‡ª <a href="https://space.bilibili.com/1292029" target="_blank" rel="noopener">@awpak78 </a>çš„å›¾ğŸ‘‡</p><p><img src="https://p.k8s.li/20200801_150112.jpg" alt=""></p><p>ä½œä¸ºä¸€åè¿ç»´å·¥ç¨‹å¸ˆï¼Œç™½å¤©åœ¨å·¥åœ°ä¸Šæ¬ç –å…»å®¶ç³Šå£ï¼Œæ™šä¸Šä¸‹ç­å›å®¶åå°±å¼€å§‹æŠ˜è…¾ä¸€å †ç ´é“œçƒ‚é“è‡ªå¨±è‡ªä¹ğŸ˜‚ã€‚æœ€è¿‘ä¸œæ‹¼è¥¿å‡‘èŠ±äº† 2000 æ¥å—é’±æ¡åƒåœ¾æ•´äº†å° HomeLab ç©ç©ï¼ŒæŠ˜è…¾ä¸€äº›æ²¡ç”¨çš„ä¸œè¥¿ğŸ™ƒ</p><p>å…¶å®å¾ˆæ—©ä¹‹å‰å°±æƒ³æä¸€å°ä½åŠŸè€—çš„ HomeLab ä¸»æœºç©å„¿äº†ï¼Œæœ€æ—©å¼€å§‹é€‰æ‹©çš„æ˜¯ Dell T1700 SFF + E3-1271V3 +32GB DDR3ï¼Œä½†æ˜¯å‘¢ï¼ŒE3 V3 ç³»åˆ—æ˜¯ Intel ç¬¬å››ä»£  CPU ï¼Œ1150 èŠ¯ç‰‡ç»„æ— æ³•ä» M.2 å¯åŠ¨ï¼Œç£ç›˜é€Ÿåº¦åªèƒ½è¾¾åˆ° SATA III ä¹Ÿå°±æ˜¯é¡¶å¤š 600 MB/s çš„è¯»å†™é€Ÿåº¦ï¼Œè€Œç›®å‰éšä¾¿ä¸€å—æ”¯æŒ  PCI-e M.2 NVMe çš„ä¸»æ¿æ™®ééƒ½èƒ½è¾¾åˆ° 3000MB/s äº†ã€‚æ‰€ä»¥è¿™ä¸€ç‚¹æ¥è®² E3 V3 å·²ç»ä¸å€¼å¾—æ¡äº†ã€‚è€Œä¸”æˆ‘æƒ³æŠŠæˆ‘å°å¼æœºä¸Š SN750 500GB æ¢åˆ°è¿™å°æœºå™¨ä¸Šï¼Œæ‰€ä»¥è¿˜æ˜¯è¦é€‰æ‹©ä¸€ä¸ªæ”¯æŒ PCI-e M.2 NVMe çš„ä¸»æ¿ã€‚</p><table><thead><tr><th align="center">ç¡¬ä»¶</th><th>é…ç½®</th><th align="center">ä»·æ ¼</th></tr></thead><tbody><tr><td align="center">CPU</td><td>Intel(R) Core(TM) i5-6600T CPU @ 2.70GHz 35w</td><td align="center">480</td></tr><tr><td align="center">ä¸»æ¿</td><td>Dell OptiPlex 7040 å‡†ç³»ç»Ÿï¼šIntel Â®Q170</td><td align="center">400</td></tr><tr><td align="center">å†…å­˜</td><td>é•å…‰ DDR4 16GB 2666MHz</td><td align="center">310</td></tr><tr><td align="center">æ˜¾å¡</td><td>è‹±ç‰¹å°”Â® æ ¸èŠ¯æ˜¾å¡ 530</td><td align="center">0</td></tr><tr><td align="center">æœºç®±</td><td>Dell OptiPlex 7040 å‡†ç³»ç»Ÿ</td><td align="center">0</td></tr><tr><td align="center">ç”µæº</td><td>Dell OptiPlex 7040 å‡†ç³»ç»Ÿï¼š290W å¼€å…³ç”µæº</td><td align="center">0</td></tr><tr><td align="center">UPS</td><td>æŸæ‚ç‰Œ UPS 650VA360W</td><td align="center">160</td></tr><tr><td align="center">å›ºæ€</td><td>ä¸‰æ˜Ÿ 970PRO 512GB</td><td align="center">820</td></tr><tr><td align="center">æ€»ä»·</td><td></td><td align="center">2170</td></tr></tbody></table><h3 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h3><p>è‡³äº 6600T çš„æ€§èƒ½ï¼Œåœ¨ 500 å—é’±çš„ä»·ä½å†… 35Wä½åŠŸè€—çš„ 6600T è¿˜ç®—å¯ä»¥èƒ½æ¥å—ï¼Œä¸ºä»€ä¹ˆä¸ä¹° 7200U è¿™ç§ä½å‹ U å‘¢ï¼Ÿï¼Œä¸€æ˜¯ä½å‹ U çš„è£…æœºæˆæœ¬å¤ªé«˜ï¼Œè€Œä¸”æ€§ä»·æ¯”å¾ˆä½ï¼Œæˆ‘è¿˜è¦åœ¨ä¸Šé¢è·‘ä¸€å †è™šæ‹Ÿæœºï¼Œä½å‹ U ææ€•æ‰›ä¸ä½ï¼Œæ‰€ä»¥ä¸€å¼€å§‹å°±æ”¾å¼ƒäº†ä½å‹ U çš„è£…æœºæ–¹æ¡ˆã€‚</p><p><img src="https://p.k8s.li/HomeLab-1.jpg" alt=""></p><h3 id="ä¸»æ¿"><a href="#ä¸»æ¿" class="headerlink" title="ä¸»æ¿"></a>ä¸»æ¿</h3><p>ç”±äº Dell SFF ç³»åˆ—çš„æœºç®±æ˜¯å®šåˆ¶çš„ï¼Œå’Œæ™®é€šçš„ä¸»æ¿ä¸å¤ªä¸€æ ·ï¼Œä¹Ÿåªæœ‰è¿™æ ·æ‰èƒ½å¡è¿›è¿™ä¹ˆå°çš„ç©ºé—´ï¼Œå¯¹äº MFF ç³»åˆ—çš„åˆ™æ›´å°ä¸€ç‚¹ã€‚å¯¹äºè¿™ç§å°æœºç®±è€Œè¨€ï¼Œæ‹¥æœ‰ 2ä¸ª PCI-e*4 å’Œä¸€ä¸ª PIC-e*16 æ˜¯ç›¸å½“ä¸é”™äº†ï¼ŒPCI-e*4å¯ä»¥è£…ä¸€ä¸ªé˜µåˆ—å¡ä¸ªä¸€ä¸ªå››ç½‘å£çš„ç½‘å¡ï¼ŒPIC-e*16åˆå¯ä»¥è£…ä¸€ä¸ªä½åŠŸè€—çš„åˆ€å¡æ˜¾å¡ã€‚ç­‰åˆ°ä»¥åå°å¼æœºå‡çº§çš„ç¡¬ä»¶çš„æ—¶å€™å†æŠŠå°å¼æœºä¸Šçš„ GT1030 äº®æœºå¡æ”¾ä¸Šå»ã€‚ä¸‰ä¸ª SATA ä¸€ä¸ª M.2 æœ‰ç‚¹æ‰è¥Ÿè§è‚˜ï¼Œæœºç®±ç©ºé—´å°±é‚£ä¹ˆç‚¹ï¼Œå£å­å¤šäº†ç¡¬ç›˜ä¹Ÿå¡ä¸ä¸‹å‘€ğŸ˜‚ã€‚</p><table><thead><tr><th>Model:</th><th><a href="https://www.dell.com/support/manuals/us/en/04/optiplex-7040-desktop/opti7040_sff_om/specifications?guid=guid-f058d593-d332-479e-9d55-6c6031fa6cba&lang=en-us" target="_blank" rel="noopener"><em>Dell OptiPlex 7040 SFF</em></a></th></tr></thead><tbody><tr><td>Form factor:</td><td>Small Form Factor</td></tr><tr><td>CPU options:</td><td>Intel Gen6 i3/i5/i7</td></tr><tr><td>Chipset:</td><td><a href="https://ark.intel.com/content/www/us/en/ark/products/90587/intel-q170-chipset.html" target="_blank" rel="noopener">Intel Q170</a></td></tr><tr><td>RAM slots:</td><td>(4x) DIMM DDR4-2133</td></tr><tr><td>Max RAM:</td><td>64 GB</td></tr><tr><td>USB Ports:</td><td>(6x) USB3.0; (4x) USB2.0;</td></tr><tr><td>Video Ports:</td><td>(2x) Display Port 1.2; HDMI 1.4;</td></tr><tr><td>Other Ports:</td><td>Serial; (2x) PS2; RJ45; Headset; Line-Out;</td></tr><tr><td>Optional Ports:</td><td>VGA; Media Card Reader;</td></tr><tr><td>SATA:</td><td>(3x) SATA 3.0*</td></tr><tr><td>PCIe:</td><td>PCIe 3.0 x16 (low profile); PCIe 3.0 x4 (low profile);</td></tr><tr><td>M.2 slots:</td><td>M.2 2280 M-key (PCIe 3.0 x4, SATA 3.0)</td></tr><tr><td>Drive bays:</td><td>3.5-inch/(2x)2.5-inch; 5.25-inch (slim);</td></tr><tr><td>Hard Drive:</td><td>max 2TB; RAID 0 &amp; 1;</td></tr><tr><td>PSU:</td><td>180 W</td></tr><tr><td>Weight:</td><td>6.00 kg (13.22 lb)</td></tr></tbody></table><ul><li>ä» <a href="https://www.hardware-corner.net/guides/difference-optiplex-3040-vs-5040-vs-7040/" target="_blank" rel="noopener">The difference between Dell OptiPlex 3040 vs. 5040 vs. 7040</a> å·æ¥çš„ä¸€å¼ å›¾ç‰‡ğŸ‘‡</li></ul><p><img src="https://p.k8s.li/OptiPlex_5040SFF_motherboard.jpg" alt=""></p><h3 id="å†…å­˜"><a href="#å†…å­˜" class="headerlink" title="å†…å­˜"></a>å†…å­˜</h3><p>ä¸¤æ¡ 8GB DDR4 å†…ä»ä»æˆ‘å°å¼æœºä¸Šæ‹†ä¸‹æ¥çš„ï¼ŒåˆèŠ±äº† 300 å—é’±ä¹°äº†ä¸ªé•å…‰çš„ 16GB DDR4 è£…äº†ä¸Šå»ï¼Œè¿«äº æˆ‘çš„å°å¼æœº B350M-K çš„ç¼©æ°´æ¿åªæœ‰ä¸¤ä¸ªå†…å­˜æ’æ§½è€Œä¸”æ”¯æŒåˆ° 32GBï¼Œæš‚æ—¶è£…ä¸€ä¸ª 16GB çš„å§ï¼Œèƒ½ä»¥åå†è£…ä¸€ä¸ªä¸Šå»ã€‚</p><h3 id="å›ºæ€"><a href="#å›ºæ€" class="headerlink" title="å›ºæ€"></a>å›ºæ€</h3><p>å…¶å®æœ¬æ¥çš„é¢„ç®—ä¸‰æ˜Ÿ 970PRO 512GBæ²¡æ‰“ç®—ä¹°ï¼Œæ˜¯æˆ‘åœ¨æ‰¾ Dell OptiPlex 7040 æ—¶æ„å¤–ç¢°åˆ°çš„ä¸€ä¸ªè€å“¥ï¼Œè€Œä¸”è¿™å—å›ºæ€æ˜¯å¾·äºšçš„ï¼Œè¿˜ç®—é è°±ä¸€äº›ï¼Œäºæ˜¯å‰æ‰‹ä¹°äº†è¿™ä¸ªå—å›ºæ€ã€‚970PRO ç³»åˆ—çš„éƒ½æ˜¯ MLC çš„é¢—ç²’çš„å›ºæ€ç¡¬ç›˜ï¼Œé€š SM961 ä¸€æ ·æ˜¯å±äºä¼ å®¶å®ç³»åˆ—ğŸ˜‚ï¼Œä½†æ˜¯ SM961 æ·˜å®ä¸Šæ°´å¤ªæ·±ï¼Œæ¸…é›¶ç›˜å æ®å¤šæ•°ï¼Œæ‰€ä»¥ä¸å»ºè®®ä¹°ã€‚</p><p>æ­£å¥½æŠŠè¿™å— 970PRO æ¢åˆ°æˆ‘çš„å°å¼æœºä¸Šï¼ŒæŠŠå°å¼æœºä¸Šçš„ SN750 512GB æ¢åˆ° HomeLab æœºå™¨ä¸Šï¼Œç»™ ESXi ä¸Šçš„è™šæ‹Ÿæœºç”¨ã€‚åœ¨ç©å„¿è™šæ‹ŸåŒ–çš„æ—¶å€™æ·±æœ‰æ„Ÿè§¦ï¼Œå®¿ä¸»æœºçš„ç£ç›˜æ˜¯æœºæ¢°ç¡¬ç›˜çš„è¯ï¼Œä¸Šé¢çš„è™šæ‹Ÿæœºè¾¾åˆ°ä¸€å®šæ•°é‡æ—¶ï¼Œè™šæ‹Ÿæœºä¼šå¾ˆå¡ï¼Œæ‰€ä»¥ç© ESXi è™šæ‹ŸåŒ–ï¼Œæœ‰å—å›ºæ€çš„ä½“éªŒæ˜¯éå¸¸çˆ½æ»´ğŸ˜‹ã€‚</p><h2 id="è£…æœº"><a href="#è£…æœº" class="headerlink" title="è£…æœº"></a>è£…æœº</h2><p>å…¶å®è£…æœºå¾ˆå¿«ï¼Œç”±äºæ˜¯ä¹°çš„ Dell OptiPlex 7040 å‡†ç³»ç»Ÿï¼Œæ‰€ä»¥åªéœ€è¦æŠŠ CPU ã€å†…å­˜ã€ç¡¬ç›˜è£…ä¸Šå»å°±å®Œäº‹å„¿äº†ã€‚</p><p>æ”¶åˆ°å‡†ç³»ç»Ÿåå‘ç°æ²¡æœ‰å¸¦ M.2 èºä¸ï¼Œåªèƒ½ä¸´æ—¶æ‹¿èƒ¶å¸¦ç²˜ç³Šä¸Šå»ï¼Œå‹‰å¼ºæ’‘äº†ä¸¤å¤©ï¼Œåæ¥ä¹°äº†ä¸ªèºä¸å’Œæ•£çƒ­ç‰‡å®Œç¾åœ°è§£å†³äº†ã€‚</p><p><img src="https://p.k8s.li/HomeLab-5.jpg" alt=""></p><p>ä»ä»¥å‰æ—§ç¬”è®°æœ¬æ·˜æ±°ä¸‹æ¥çš„ 2TB 5400RPM çš„çŸ³å¤´ç›˜ï¼Œå·²ç»å‡ºç°åé“äº†ï¼Œä¸´æ—¶å½“ä¸ªä¸‹è½½ç›˜å§ï¼Œåœ¨å®ƒè¿˜æ²¡å½»åº•å´©ç›˜ä¹‹å‰å†å‹æ¦¨ä¸€ä¸‹å®ƒå§ğŸ˜‚ã€‚åé¢æ‰“ç®—å†æ·»åŠ ä¸€å—12TBçš„æ°¦æ°”ç›˜å½“ä»“åº“ç›˜å’Œå¤‡ä»½æ•°æ®ä½¿ç”¨ï¼Œæœ‰äº† UPS å’Œè¿™å°ä¸»æœº 7*24 å°æ—¶å¼€æœºä¹Ÿæ²¡å•¥é—®é¢˜äº†ã€‚</p><p><img src="https://p.k8s.li/HomeLab-3.jpg" alt=""></p><p>åé¢é‚£å°æ˜¯æˆ‘çš„å°å¼æœºï¼Œä¹Ÿæ˜¯å»å¹´è¿™æ—¶å€™ä¹°çš„ï¼Œä¸¤è€…æ¯”è¾ƒèµ·æ¥ SFF çš„å‹å·ç¡®å®å°å¾ˆå¤šã€‚Dell çš„è¿™ç§ä¸»æœºè¿˜æœ‰ä¸€ç§ MFF å‹å·çš„ï¼Œé‚£ç§æ›´å°ä¸€äº›ï¼Œå·®ä¸å¤šæ¯”è·¯ç”±å™¨å¤§ä¸€äº›è€Œå·²ï¼Œä¸è¿‡æ‰©å±•æ€§ä¸å¥½ï¼Œè€Œä¸”è¿˜éœ€è¦å¤–ç½®ç”µæºï¼Œä¹Ÿå°±æ²¡è€ƒè™‘ï¼Œä¸è¿‡ç°åœ¨æƒ³æƒ³æœ‰ç‚¹åæ‚”äº†ï¼Œå½“åˆåº”è¯¥å¤šåŠ ç‚¹é’±ä¹° SFF çš„ï¼Œä¸è¿‡è¿˜å¥½ä¹Ÿèƒ½æ¥å—ï¼Œåªä¸è¿‡ä½“ç§¯å¤§äº†äº›ï¼Œæ¬å®¶çš„æ—¶å€™ä¸å¤ªæ–¹ä¾¿ã€‚</p><p><img src="https://p.k8s.li/HomeLab-4.jpg" alt=""></p><h2 id="ESXi"><a href="#ESXi" class="headerlink" title="ESXi"></a>ESXi</h2><p>è£…å®Œæœºå™¨ä¹‹åå°±å¼€å§‹è£… ESXi ï¼Œå¯¹äºè™šæ‹ŸåŒ–ï¼ŒESXi ç®—æ˜¯æ¯”è¾ƒç†Ÿæ‚‰çš„äº†ï¼Œå¬è¯´ Proxmox VE ä¹Ÿä¸é”™ğŸ¤”ï¼Œç­‰åˆ°åé¢ç¡¬ç›˜åˆ°äº†å†æŠ˜è…¾ä¸€ä¸‹ Proxmox VEã€‚çœ‹åˆ°éš”å£ <a href="https://wzyboy.im/post/1293.html" target="_blank" rel="noopener">Proxmox VEï¼šä¼˜ç§€çš„è‡ªå»ºè™šæ‹ŸåŒ–æ–¹æ¡ˆ</a> æ„ˆå‘æƒ³ç©ç©äº†ã€‚</p><blockquote><p>  è´¯å½»ã€Œä¸é‡å¤é€ è½®å­ã€çš„åŸåˆ™ï¼Œå½“å‰ç‰ˆæœ¬çš„ PVE åŸºäºæˆç†Ÿç¨³å®šçš„ Debian 9 â€œStretchâ€ æ„å»ºã€‚åœ¨ç†Ÿæ‚‰å’Œä½¿ç”¨ PVE çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘è¶Šå‘å–œæ¬¢å®ƒã€Œä¸é‡å¤é€ è½®å­ã€çš„ç‰¹æ€§ã€‚ç›¸è¾ƒä¹‹å‰ç”¨è¿‡çš„å…¶ä»–è™šæ‹ŸåŒ–æ–¹æ¡ˆï¼ŒPVE çš„å†…éƒ¨æ„é€ å’Œå·¥ä½œåŸç†å¯¹æˆ‘æ¥è¯´ä¸å†æ˜¯ä¸€ä¸ªé»‘ç›’ï¼Œæˆ‘å¯ä»¥æ¸…æ™°åœ°è§‚æµ‹åˆ°å®ƒåœ¨å¹²ä»€ä¹ˆâ€”â€”æ¯”å¦‚è¦è¿ç§»ä¸€å°è™šæ‹Ÿæœºåˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘å°±å¯ä»¥é€šè¿‡ <code>ps</code> è§‚å¯Ÿåˆ°å®ƒå¯åŠ¨äº†ä¸€ä¸ª <code>dd</code> è¿›ç¨‹ï¼Œå¯¹æ¥ <code>ssh</code> ç®¡é“ï¼Œå°†ç£ç›˜æ•°æ®é€šè¿‡ç½‘ç»œå¤åˆ¶åˆ°ç›®æ ‡æœºå™¨â€”â€”è¿™ç§ä»¿ä½›é€æ˜æ‰‹è¡¨ä¸€æ ·èƒ½çœ‹åˆ°å†…éƒ¨å·¥ä½œåŸç†çš„æ„Ÿè§‰çœŸæ˜¯å¤ªæ£’äº†ï¼</p></blockquote><p>ä» VMware å®¶ä¸‹è½½å¥½ <code>VMware-VMvisor-Installer-7.0.0-15843807.x86_64.iso</code> é•œåƒï¼Œæ‰¾äº†ä¸¤ä¸ª U ç›˜ï¼Œä¸€ä¸ªç”¨äº ESXi çš„å®‰è£…ç›˜ï¼Œä¸€ä¸ªç”¨äº ESXi çš„ç³»ç»Ÿç›˜ï¼Œå…¶ä¸­ä¸€ä¸ª U ç›˜è¿˜æ˜¯æˆ‘ç”¨è¯»å¡å™¨+16GBå†…å­˜å¡æ‹¼å‡‘è€Œæˆçš„ï¼Œç›®çš„æ˜¯ä¸ºäº†æŠŠ ESXi è£…åˆ° U ç›˜é‡Œæ–¹ä¾¿è¿ç§»æ•°æ®ä¹‹ç±»çš„ï¼Œä¹‹ååœ¨ç½‘ä¸Šæ‰¾ä¸€ä¸ªç¥ KEY æ¿€æ´»ä¸€ä¸‹ï¼ˆğŸ¤«å°å£°</p><p><img src="https://p.k8s.li/HomeLab-6.jpg" alt=""></p><h3 id="Ubuntu-20-04"><a href="#Ubuntu-20-04" class="headerlink" title="Ubuntu 20.04"></a>Ubuntu 20.04</h3><p>å½“ä½œç½‘å…³æœºä½¿ç”¨ï¼Œå’Œæˆ‘æ‰€æœ‰çš„ äº‘ä¸»æœºæ‰“é€šç½‘ç»œï¼Œä½¿ç”¨ WireGuard ç»„æˆä¸€ä¸ªå°å†…ç½‘ï¼Œå…³äº WireGuard çš„ä½¿ç”¨å»ºè®®é˜…è¯»å¤§ä½¬å†™å¾—åšå®¢ <a href="https://fuckcloudnative.io/posts/wireguard-docs-practice/" target="_blank" rel="noopener">WireGuard æ•™ç¨‹ï¼šWireGuard çš„æ­å»ºä½¿ç”¨ä¸é…ç½®è¯¦è§£</a> ä»¥åŠ <a href="https://fuckcloudnative.io/posts/wireguard-docs-theory/" target="_blank" rel="noopener">WireGuard æ•™ç¨‹ï¼šWireGuard çš„å·¥ä½œåŸç†</a>ã€‚</p><p>é¡ºå¸¦ç”¨ <a href="https://github.com/Aniverse/ZBench" target="_blank" rel="noopener">ZBench</a> æµ‹äº†ä¸€ä¸‹è™šæ‹Ÿæœºçš„ç£ç›˜æ€§èƒ½ï¼Œè¿˜ç®—å‹‰å¼ºè¯´çš„è¿‡å»ï¼Œå®é™…ä¸Š SN750 512GB åªæœ‰ 2GB å·¦å³çš„ç¼“å­˜ï¼Œå†™æ»¡æ¢ç²—ä¹‹åï¼Œå†™å…¥çš„æ€§èƒ½ä¼šç›´çº¿ä¸‹é™åˆ° 800MB/sï¼Œè¯»çš„æ€§èƒ½å€’æ˜¯å¯ä»¥è¾¾åˆ° 3200MB/s ä»¥ä¸Šï¼Œæˆ–è®¸æ˜¯ä¸»æ¿çš„é™åˆ¶ï¼Œæ²¡èƒ½è¾¾åˆ°ç†æƒ³çš„è¯»å†™æ€§èƒ½ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------------------------------------------------</span><br><span class="line">CPU model            : Intel(R) Core(TM) i5-6600T CPU @ 2.70GHz</span><br><span class="line">Number of cores      : 4</span><br><span class="line">CPU frequency        : 2712.000 MHz</span><br><span class="line">Total size of Disk   : 33.3 GB (7.7 GB Used)</span><br><span class="line">Total amount of Mem  : 3935 MB (306 MB Used)</span><br><span class="line">Total amount of Swap : 3934 MB (0 MB Used)</span><br><span class="line">System uptime        : 4 days, 19 hour 47 min</span><br><span class="line">Load average         : 0.13, 0.08, 0.03</span><br><span class="line">OS                   : Ubuntu 20.04 LTS</span><br><span class="line">Arch                 : x86_64 (64 Bit)</span><br><span class="line">Kernel               : 5.4.0-42-generic</span><br><span class="line">Virt                 : vmware</span><br><span class="line">--------------------------------------------------------------------------</span><br><span class="line">I/O speed(1st run)   :1.3 GB/s</span><br><span class="line">I/O speed(2nd run)   :1.3 GB/s</span><br><span class="line">I/O speed(3rd run)   :1.3 GB/s</span><br></pre></td></tr></table></figure><h3 id="PhotonOS"><a href="#PhotonOS" class="headerlink" title="PhotonOS"></a>PhotonOS</h3><p>è¿™ä¸ªæ˜¯ç³»ç»Ÿåœ¨æˆ‘å¦ä¸€ç¯‡åšå®¢ <a href="https://blog.k8s.li/container-linux-os.html">Container Linux OS ä»å…¥å‘åˆ°çˆ¬å‡ºæ¥</a> é‡Œæåˆ°è¿‡ï¼ŒPhoton OSâ„¢ æ˜¯é’ˆå¯¹ VMware vSphereÂ® è™šæ‹ŸåŒ–å¹³å°è¿›è¡Œå†…æ ¸ä¼˜åŒ–çš„å®¹å™¨ä¸“ç”¨æ“ä½œç³»ç»Ÿï¼Œå°±å’Œ CoreOS ä¸€æ ·ã€‚ååˆ†é€‚åˆä¸“é—¨ç”¨æ¥è¿è¡Œå®¹å™¨ï¼Œå½“ä½œ Kubernetes é›†ç¾¤ä¸­çš„å·¥ä½œè´Ÿè½½æ¥ä½¿ç”¨ã€‚</p><ul><li>ç³»ç»Ÿåˆå§‹åŒ–å¯åŠ¨ä¹‹åå†…å­˜ä»…ä»…ä½¿ç”¨äº† 45Mi</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:          2.0Gi        45Mi       1.8Gi       0.0Ki        93Mi       1.8Gi</span><br><span class="line">Swap:            0B          0B          0B</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨ docker è¿›ç¨‹ä¹‹åçš„å ç”¨æƒ…å†µï¼Œä¹Ÿä»…ä»… 109Mi</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:          2.0Gi       109Mi       1.6Gi       0.0Ki       238Mi       1.8Gi</span><br><span class="line">Swap:            0B          0B          0B</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ OVA è™šæ‹Ÿæœºæ¨¡æ¿å¯åŠ¨åçš„è™šæ‹Ÿæœºï¼Œç£ç›˜ä»…ä»…å ç”¨äº† 515MB ï¼Œç¡®å®æ˜¯ç›¸å½“è½»é‡åŒ–ï¼Œè¿™è¿˜æ˜¯åŒ…å«äº† dockerã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# df -h</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/root        16G  515M   15G   4% /</span><br><span class="line">devtmpfs        998M     0  998M   0% /dev</span><br><span class="line">tmpfs          1000M     0 1000M   0% /dev/shm</span><br><span class="line">tmpfs          1000M  532K  999M   1% /run</span><br><span class="line">tmpfs          1000M     0 1000M   0% /sys/fs/cgroup</span><br><span class="line">tmpfs          1000M     0 1000M   0% /tmp</span><br><span class="line">/dev/sda2        10M  2.2M  7.9M  22% /boot/efi</span><br><span class="line">tmpfs           200M     0  200M   0% /run/user/0</span><br></pre></td></tr></table></figure><p>æ€»ä¹‹ï¼ŒPhotonOS æ˜¯ä¸ªå¾ˆè½»é‡çš„ OS ï¼Œé€‚åˆä¸“é—¨ç”¨æ¥è¿è¡Œä¸€äº›å®¹å™¨åŒ–çš„æœåŠ¡ï¼Œè¿™æ­£å¥½ç¬¦åˆæˆ‘çš„éœ€æ±‚ã€‚åˆ«é—®æˆ‘ä¸ºä»€ä¹ˆä¸ç”¨ CoreOS ï¼ŒCoreOS å·²ç»å‡‰äº†ã€‚</p><h3 id="Alpine-NFS"><a href="#Alpine-NFS" class="headerlink" title="Alpine NFS"></a>Alpine NFS</h3><p>æŠŠæˆ‘ä¸€å—ç£ç›˜ç›´é€šç»™è¿™ä¸ªè™šæ‹Ÿæœºï¼Œä¸»è¦ç”¨æ¥ç»™ k8s é›†ç¾¤ä¸­çš„ Pod æŒ‚è½½ PVC æŒä¹…åŒ–å­˜å‚¨ä½¿ç”¨ã€‚</p><h3 id="Debian"><a href="#Debian" class="headerlink" title="Debian"></a>Debian</h3><p>ä¸»è¦æ˜¯ç”¨æ¥è¿è¡Œ K8s é›†ç¾¤ï¼Œç›®å‰åªæœ‰ä¸€ä¸ª  master å’Œä¸€ä¸ª node ç©ç©å„¿ï¼Œè·‘äº†ä¸€äº›è‡ªç”¨çš„æœåŠ¡ã€‚</p><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>å½“ä¸‹è½½æœºä½¿ç”¨ï¼Œå¤–åŠ è¿è¡Œä¸€äº›ä¸å¾—ä¸ä½¿ç”¨çš„å›½äº§æ¯’ç˜¤è½¯ä»¶ğŸ˜¡</p><h2 id="é¢å¤–ç¡¬ä»¶"><a href="#é¢å¤–ç¡¬ä»¶" class="headerlink" title="é¢å¤–ç¡¬ä»¶"></a>é¢å¤–ç¡¬ä»¶</h2><p>æ¡åƒåœ¾çš„ä¹è¶£å°±åœ¨äºè¶ŠæŠ˜è…¾è¶Šå¥½ç©ï¼Œäºæ˜¯åˆå¼€å§‹æ‰“ç®—æŠ˜è…¾ä¸€äº›</p><h3 id="UPS"><a href="#UPS" class="headerlink" title="UPS"></a>UPS</h3><p>ç”±äºæœ€è¿‘æˆ¿ä¸œå®¶é‡Œç»å¸¸æ–­ç”µï¼Œæœ‰æ—¶ä¸€å¤©æ–­ç”µå…«ä¹æ¬¡ï¼Œæ¯æ¬¡æ–­ç”µæˆ‘éƒ½æ‹…å¿ƒç€ç¡¬ç›˜é‡Œçš„è€å©†ä»¬ä¼šä¸ä¼šæŒ‚æ‰ï¼Œç´¢æ€§è¿˜æ˜¯ä¹°äº† UPS ï¼Œåœ¨é©¬äº‘å®¶çœ‹äº†çœ‹ï¼Œå¸¦ç»™ NAS è‡ªåŠ¨æ–­ç”µçš„ UPS æ™®éåœ¨ 400å—é’±ä»¥ä¸Šï¼Œè€Œä¸”æˆ‘è¿™ä¸ªè¿˜æ˜¯ä¸ªå‡çš„ NAS ï¼ŒUPS ä¸Šçš„ USB å£ä¸ä¸€å®šæ”¯æŒæˆ‘çš„ä¸»æœºã€‚æœ€åä¸ºäº†èŠ‚çœä¸€ä¸‹é¢„ç®—èŠ±å„¿ 160 å—é’±ä¹°äº†ä¸ªä¸æ”¯æŒ USB çš„ UPS ï¼Œä½†æ˜¯åˆä¸èƒ½æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œå› ä¸ºå®¶é‡Œçš„ 220V å¸‚ç”µæ–­ç”µä¹‹åï¼ŒUPS çš„ç”µé‡åªèƒ½ç»™ä¸»æœºç»­å‘½ 10~20min å·¦å³ï¼ŒUPS çš„ç”µé‡ç”¨å®Œä¹‹åå°±å—å±äº†ï¼Œç…§é˜³è¿˜æ˜¯æ–­ç”µã€‚æ‰€ä»¥åœ¨ UPS ç”¨å°½ç”µé‡è¿˜æ˜¯æ²¡æœ‰æ¥ç”µä¹‹å‰ï¼Œä¸€å®šè¦æƒ³åŠæ³•æŠŠä¸»æœºé€šè¿‡ poweroff çš„æ–¹å¼å®‰å…¨ä¼˜é›…æ»´å…³æœºã€‚</p><p>é¦–å…ˆè¦è€ƒè™‘çš„æ˜¯æ€ä¹ˆçŸ¥é“ 220V å¸‚ç”µæ–­ç”µäº†ï¼Œèµ·åˆæƒ³æœ‰æ²¡æœ‰ä¸ª 220V çš„ä¼ æ„Ÿå™¨ï¼Œæˆ‘å»ï¼Œæœ‰ç‚¹éš¾åº¦è¿˜æ˜¯ç®—äº†å§ã€‚æœ€åä¸€æƒ³ï¼Œå¯ä»¥é€šè¿‡ ping æˆ¿ä¸œå®¶å…‰çŒ«çš„æ–¹å¼ã€‚æˆ‘çš„è·¯ç”±å™¨å’Œä¸»æœºç­‰è®¾å¤‡è¿æ¥ UPS ï¼Œæˆ¿ä¸œå®¶çš„å…‰çŒ«å¹¶æ²¡æœ‰è¿æ¥ UPS ï¼Œæˆ‘åœ¨è·¯ç”±å™¨ä¸Šè®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯åˆ†é’Ÿå» ping æˆ¿ä¸œå®¶çš„å…‰çŒ«ï¼Œæ²¡æœ‰ ping é€šè¯´æ˜å°±æ˜¯æ–­ç”µäº†ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ç½‘çº¿è¢«æ‹”æ‰äº†ï¼Œä½†æ¦‚ç‡å¾ˆå°ã€‚<code>! ping -c 8 A &amp;&amp; ssh B &quot;poweroff&quot;</code> ä¸€è¡Œç®€å•çš„å‘½ä»¤å°±æ»¡è¶³äº†æˆ‘çš„éœ€æ±‚ï¼Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">echo "start" &gt;&gt; /tmp/power_status</span><br><span class="line">if ! ping -c 32 192.168.1.1</span><br><span class="line">then</span><br><span class="line">    sleep 300</span><br><span class="line">    ping -c 32 192.168.1.1 &amp;&amp; exit 0</span><br><span class="line">    sshpass -p "pwd" ssh root@192.168.0.210 "net rpc shutdown -I 192.168.0.240 -U admin%poweroff"</span><br><span class="line">    sshpass -p "pwd" ssh root@192.168.0.200 "sh -c /suspend_vm.sh"</span><br><span class="line">    echo "220v poweroff" &gt;&gt; /tmp/power_status</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>å¯¹äº ESXi ä¸Šçš„è™šæ‹Ÿæœºï¼Œè¿˜æ˜¯é‡‡ç”¨äº†æŒ‚èµ·çš„æ–¹å¼ï¼Œå°†è™šæ‹Ÿæœºçš„å†…å­˜çŠ¶æ€ä¿å­˜åœ¨æ•°æ®å­˜å‚¨çš„ç£ç›˜é‡Œï¼Œè¿™æ ·é‡æ–°å¼€å¯è™šæ‹Ÿæœºåå°±èƒ½æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼Œè¿™ä¸€ç‚¹æœ‰ç‚¹åƒ Windows çš„ä¼‘çœ ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">for vm in $(/sbin/vmdumper -l | grep -v Alpine |  awk '&#123;print $1&#125;' | sed 's/wid=//g')</span><br><span class="line">do</span><br><span class="line">     /sbin/vmdumper $&#123;vm&#125; suspend_vm</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h3 id="ç½‘ç®¡äº¤æ¢æœº"><a href="#ç½‘ç®¡äº¤æ¢æœº" class="headerlink" title="ç½‘ç®¡äº¤æ¢æœº"></a>ç½‘ç®¡äº¤æ¢æœº</h3><p>å½“æˆ‘ä»å°å¼æœºå‘ ESXI é‡Œçš„è™šæ‹Ÿæœºä¼ è¾“æ–‡ä»¶çš„æ—¶å€™ï¼Œå‘ç°ç½‘ç»œé€Ÿåº¦æœ€å¿«åªèƒ½è¾¾åˆ° 700Mbits/sec ï¼Œçœ‹æ¥åº”è¯¥æ˜¯è·¯ç”±å™¨çš„æ€§èƒ½ç“¶é¢ˆï¼Œäºæ˜¯æƒ³ç€å‡çº§ä¸€ä¸‹ç½‘ç»œè®¾å¤‡ï¼ŒæŠŠ R6300V2 è·¯ç”±å™¨å½“ä½œ AP æ¥ç”¨ï¼Œå°†æµé‡éƒ½æ±‡èšåˆ°ç½‘ç®¡äº¤æ¢æœºä¸Šã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[  4] local 192.168.0.240 port 50718 connected to 192.168.0.123 port 5201</span><br><span class="line">[ ID] Interval           Transfer     Bandwidth</span><br><span class="line">[  4]   0.00-1.00   sec  83.8 MBytes   702 Mbits/sec</span><br><span class="line">[  4]   1.00-2.00   sec  83.4 MBytes   700 Mbits/sec</span><br><span class="line">[  4]   2.00-3.00   sec  83.6 MBytes   701 Mbits/sec</span><br><span class="line">[  4]   3.00-4.00   sec  82.9 MBytes   695 Mbits/sec</span><br><span class="line">[  4]   4.00-5.00   sec  83.8 MBytes   702 Mbits/sec</span><br><span class="line">[  4]   5.00-6.00   sec  83.6 MBytes   701 Mbits/sec</span><br><span class="line">[  4]   6.00-7.00   sec  83.5 MBytes   701 Mbits/sec</span><br><span class="line">[  4]   7.00-8.00   sec  83.8 MBytes   703 Mbits/sec</span><br><span class="line">[  4]   8.00-9.00   sec  83.8 MBytes   702 Mbits/sec</span><br><span class="line">[  4]   9.00-10.00  sec  83.8 MBytes   702 Mbits/sec</span><br><span class="line">[  4]  10.00-11.00  sec  83.8 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  11.00-12.00  sec  83.8 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  12.00-13.00  sec  83.9 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  13.00-14.00  sec  83.8 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  14.00-15.00  sec  83.8 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  15.00-16.00  sec  83.9 MBytes   704 Mbits/sec</span><br><span class="line">[  4]  16.00-17.00  sec  83.4 MBytes   699 Mbits/sec</span><br><span class="line">[  4]  17.00-18.00  sec  83.9 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  18.00-19.00  sec  83.6 MBytes   702 Mbits/sec</span><br><span class="line">[  4]  19.00-20.00  sec  83.8 MBytes   702 Mbits/sec</span><br><span class="line">[  4]  20.00-21.00  sec  83.9 MBytes   704 Mbits/sec</span><br><span class="line">[  4]  21.00-22.00  sec  83.8 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  22.00-23.00  sec  83.9 MBytes   704 Mbits/sec</span><br><span class="line">[  4]  23.00-24.00  sec  83.9 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  24.00-25.00  sec  83.9 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  25.00-25.20  sec  16.6 MBytes   698 Mbits/sec</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€debian@debian ~</span><br><span class="line">â•°â”€$ qperf 192.168.0.123 -t 30 -vvu tcp_lat udp_lat tcp_bw udp_bw conf</span><br><span class="line">tcp_lat:</span><br><span class="line">    latency   =  98.7 us</span><br><span class="line">    msg_size  =     1 bytes</span><br><span class="line">    time      =    30 sec</span><br><span class="line">    timeout   =     5 sec</span><br><span class="line">udp_lat:</span><br><span class="line">    latency   =  98 us</span><br><span class="line">    msg_size  =   1 bytes</span><br><span class="line">    time      =  30 sec</span><br><span class="line">    timeout   =   5 sec</span><br><span class="line">tcp_bw:</span><br><span class="line">    bw        =  87.9 MB/sec</span><br><span class="line">    msg_size  =    64 KiB (65,536)</span><br><span class="line">    time      =    30 sec</span><br><span class="line">    timeout   =     5 sec</span><br><span class="line">udp_bw:</span><br><span class="line">    send_bw   =  56.7 MB/sec</span><br><span class="line">    recv_bw   =  56.7 MB/sec</span><br><span class="line">    msg_size  =    32 KiB (32,768)</span><br><span class="line">    time      =    30 sec</span><br><span class="line">    timeout   =     5 sec</span><br><span class="line">conf:</span><br><span class="line">    loc_node   =  debian</span><br><span class="line">    loc_cpu    =  16 Cores: AMD Ryzen 7 1700 Eight-Core   3.0GHz</span><br><span class="line">    loc_os     =  Linux 4.4.0-18362</span><br><span class="line">    loc_qperf  =  0.4.11</span><br><span class="line">    rem_node   =  gateway</span><br><span class="line">    rem_cpu    =  4 Cores: Intel Core i5-6600T @ 2.70GHz</span><br><span class="line">    rem_os     =  Linux 5.4.0-42-generic</span><br><span class="line">    rem_qperf  =  0.4.11</span><br></pre></td></tr></table></figure><p>å‡†å¤‡ä¹° GS108E V2 æˆ–è€… GS105E V2ï¼Œ</p><h3 id="å››ç½‘å£ç½‘å¡"><a href="#å››ç½‘å£ç½‘å¡" class="headerlink" title="å››ç½‘å£ç½‘å¡"></a>å››ç½‘å£ç½‘å¡</h3><p>ä¸ºäº†æŠ˜è…¾ä¸€ä¸‹ç½‘å¡ç›´é€šã€ç«¯å£æ±‡èšã€overlay ç½‘ç»œå¸è½½ç­‰ç‰¹æ€§ï¼Œåé¢è¿˜è¦æ·»åŠ ä¸€å— <a href="https://www.intel.cn/content/www/cn/zh/products/docs/network-io/ethernet/10-25-40-gigabit-adapters/ethernet-i350-server-adapter-brief.html" target="_blank" rel="noopener">intel I350 T4 V2</a> ï¼Œé—²é±¼ä¸Šçš„ä»·æ ¼ä¹Ÿä¸æ˜¯å¾ˆè´µã€‚</p><p><img src="https://p.k8s.li/20200822195450798.png" alt=""></p><h3 id="é˜µåˆ—å¡"><a href="#é˜µåˆ—å¡" class="headerlink" title="é˜µåˆ—å¡"></a>é˜µåˆ—å¡</h3><p>ç”±äºä¸»æ¿çš„ SATA æ¥å£æœ€å¤§åªæ”¯æŒåˆ° 2TB ï¼Œä¸ºäº†æ‰©å±•ä¸€ä¸‹å­˜å‚¨ï¼Œåªèƒ½é¢å¤–æ·»åŠ ä¸€å—é˜µåˆ—å¡äº†ï¼Œç”±äºä¸»æ¿çš„ PCIe æœ‰é™ï¼Œè€Œä¸”è¿™ä¹ˆå¤§ç‚¹çš„æœºç®±æœ€å¤šä¹Ÿå°±èƒ½å¡ä¸‹ 1 å— 3.5 å¯¸ç¡¬ç›˜å’Œ 3 å— 2.5 å¯¸ç¡¬ç›˜ï¼Œæ‰€ä»¥æ‰¾ä¸€å—å…¥é—¨çº§çš„é˜µåˆ—å¡å°±å¤Ÿäº†ï¼Œæœ€ç»ˆèŠ±äº† 50 å—é’±æ¡äº†ä¸€å— <a href="https://lenovopress.com/tips0831-serveraid-h1110" target="_blank" rel="noopener">ServeRAID H1110 SAS/SATA Controller</a> é˜µåˆ—å¡ï¼Œçœ‹æ¥ä¸€ä¸‹æ‰‹å†Œé‡Œçš„å‚æ•°ï¼Œå¤§æ¦‚ä¹Ÿèƒ½æš‚æ—¶æ»¡è¶³æˆ‘çš„éœ€æ±‚ã€‚</p><blockquote><ul><li>Four internal 6 Gbps SAS/SATA ports</li><li>One x4 mini-SAS internal connector (SFF-8087)</li><li>6 Gbps throughput per port</li><li>Based on LSI SAS2004 6 Gbps RAID on Chip (ROC) controller</li><li>x4 PCI Express 2.0 host interface</li><li>Supports RAID 0, 1, 1E, and 10</li><li>Connects to up to four SAS or SATA drives</li><li>SAS and SATA drives are supported, but the mixing of SAS and SATA in the same integrated volume is not supported</li><li>Supports simple-swap SATA and hot-swap SAS and SATA drives</li><li>Supports up to two integrated volumes</li><li>Supports up to two global hot-spare drives</li><li>Supports drive sizes greater than 2 TB for RAID 0, 1E, and 10 (not RAID 1)</li><li>Fixed stripe size of 64 KB</li><li>Compliant with Disk Data Format (DDF)</li><li>S.M.A.R.T. support</li></ul></blockquote><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>æ‡’å¾—å†™äº†</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;æ¡åƒåœ¾&quot;&gt;&lt;a href=&quot;#æ¡åƒåœ¾&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="æ¡åƒåœ¾" scheme="https://blog.k8s.li/tags/%E6%8D%A1%E5%9E%83%E5%9C%BE/"/>
    
      <category term="NAS" scheme="https://blog.k8s.li/tags/NAS/"/>
    
  </entry>
  
</feed>
