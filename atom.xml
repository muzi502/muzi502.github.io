<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æœ¨å­</title>
  <icon>https://blog.k8s.li/icon.png</icon>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://blog.k8s.li/"/>
  <updated>2021-02-15T16:00:00.000Z</updated>
  <id>https://blog.k8s.li/</id>
  
  <author>
    <name>æœ¨å­</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>åŒæ­¥ docker hub library é•œåƒåˆ°æœ¬åœ° registry</title>
    <link href="https://blog.k8s.li/sync-dockerhub-library-images.html"/>
    <id>https://blog.k8s.li/sync-dockerhub-library-images.html</id>
    <published>2021-02-09T16:00:00.000Z</published>
    <updated>2021-02-15T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ°çƒ‚é’±ï¼Ÿ"><a href="#æ°çƒ‚é’±ï¼Ÿ" class="headerlink" title="æ°çƒ‚é’±ï¼Ÿ"></a>æ°çƒ‚é’±ï¼Ÿ</h2><p>è‡ªä»å»å¹´ 11 æœˆä»½å¼€å§‹ï¼Œdocker å…¬å¸ä¸ºäº†æ°ç‚¹çƒ‚é’±å°±å¯¹ docker hub ä¸Š pull é•œåƒçš„ç­–ç•¥è¿›è¡Œé™åˆ¶ï¼š</p><ul><li><strong>æœªç™»å½•ç”¨æˆ·ï¼Œæ¯ 6 å°æ—¶åªå…è®¸ pull 100 æ¬¡</strong></li><li><strong>å·²ç™»å½•ç”¨æˆ·ï¼Œæ¯ 6 å°æ—¶åªå…è®¸ pull 200 æ¬¡</strong></li></ul><p>è€Œä¸”ï¼Œé™åˆ¶çš„æ‰‹æ®µä¹Ÿéå¸¸åœ°ç²—æš´ï¼Œé€šè¿‡åˆ¤æ–­è¯·æ±‚é•œåƒçš„ manifest æ–‡ä»¶çš„æ¬¡æ•°ï¼Œè¯·æ±‚ä¸€ä¸ªé•œåƒçš„ manifest æ–‡ä»¶å°±ç®—ä½œä¸€æ¬¡ pull é•œåƒã€‚å³ä¾¿ä½  pull å¤±è´¥äº†ï¼Œä¹Ÿä¼šç®—ä½œä¸€æ¬¡ã€‚</p><p>éšåä¹Ÿæœ‰å¾ˆå¤šå¤§ä½¬åˆ†äº«ç»•è¿‡ docker hub é™åˆ¶çš„åŠæ³•ï¼Œæ¯”å¦‚æ­å»ºç§æœ‰çš„é•œåƒä»“åº“ï¼Œç„¶åå†ç»™å®¢æˆ·ç«¯é…ç½®ä¸Š <code>registry-mirrors</code> å‚æ•°ï¼Œå°±å¯ä»¥é€šè¿‡æœ¬åœ°çš„é•œåƒä»“åº“æ¥æ‹‰å–é•œåƒã€‚</p><ul><li><a href="https://moelove.info/2020/09/20/%E7%AA%81%E7%A0%B4-DockerHub-%E9%99%90%E5%88%B6%E5%85%A8%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E6%9C%8D%E5%8A%A1/" target="_blank" rel="noopener">çªç ´ DockerHub é™åˆ¶ï¼Œå…¨é•œåƒåŠ é€ŸæœåŠ¡</a></li><li><a href="https://nova.moe/bypass-docker-hub-429/" target="_blank" rel="noopener">ç»•è¿‡ä» Docker Hub pull é•œåƒæ—¶çš„ 429 toomanyrequests</a></li><li><a href="https://www.chenshaowen.com/blog/how-to-cross-the-limit-of-dockerhub.html" target="_blank" rel="noopener">å¦‚ä½•ç»•è¿‡ DockerHub æ‹‰å–é•œåƒé™åˆ¶</a></li></ul><p>ä½†æ˜¯å‘¢ï¼Œä»¥ä¸Šæ–¹æ³•éƒ½æ¯”è¾ƒå±€é™ï¼šé¦–å…ˆé•œåƒéœ€è¦æŒ¨ä¸ªæ‰‹åŠ¨ push åˆ°æœ¬åœ°é•œåƒä»“åº“ï¼›å…¶æ¬¡æœ¬åœ°é•œåƒä»“åº“ä¸­çš„é•œåƒæ— æ³•å’Œå®˜æ–¹é•œåƒä¿æŒåŒæ­¥æ›´æ–°ï¼Œå¦‚æœè¦ä½¿ç”¨æ–°çš„ tag å¥½çš„é•œåƒä»ç„¶éœ€è¦æ‰‹åŠ¨å°†é•œåƒä» docker hub ä¸Š pull ä¸‹æ¥ï¼Œç„¶åå† push åˆ°æœ¬åœ°é•œåƒä»“åº“ï¼›è¿˜æœ‰æ‰‹åŠ¨ push é•œåƒæ˜¯æ¯”è¾ƒæ··ä¹±çš„ï¼Œå¦‚æœä½¿ç”¨çš„é•œåƒæ¯”è¾ƒå¤šï¼Œæ¯”å¦‚å…¬æœ‰äº‘å®¹å™¨æœåŠ¡ï¼Œè¿™æ—¶å€™å†æ‰‹åŠ¨ push çš„è¯ç®¡ç†èµ·æ¥æ˜¯åŠå…¶ä¸æ–¹ä¾¿çš„ã€‚</p><p>å› æ­¤ç»è¿‡ä¸€ç•ªæŠ˜è…¾ç»ˆäºæ‘¸ç´¢å‡ºäº†ä¸€ä¸ªæ–¹æ¡ˆï¼šå°† docker hub ä¸Š library repo çš„é•œåƒåŒæ­¥åˆ°æœ¬åœ°é•œåƒä»“åº“ï¼Œæœ€ç»ˆè¦åšåˆ°ä¸Šæ¸¸å¦‚æœæ›´æ–°äº†é•œåƒ tag ä¹Ÿèƒ½è‡ªåŠ¨åœ°å°†é•œåƒåŒæ­¥åˆ°æœ¬åœ°é•œåƒä»“åº“ã€‚</p><h2 id="è·å–é•œåƒ-tag"><a href="#è·å–é•œåƒ-tag" class="headerlink" title="è·å–é•œåƒ tag"></a>è·å–é•œåƒ tag</h2><p>å¯¹äº docker hub ä¸Šçš„é•œåƒï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ°æœ€å¤šçš„å°±æ˜¯ library è¿™ä¸ª repo å³ <a href="https://docs.docker.com/docker-hub/official_images/" target="_blank" rel="noopener">Official Images on Docker Hub</a>ï¼Œé‡Œé¢åŒ…å«ç€å¤§éƒ¨åˆ†å¼€æºè½¯ä»¶å’Œ Linux å‘è¡Œç‰ˆçš„åŸºç¡€é•œåƒã€‚</p><blockquote><ul><li>Provide essential base OS repositories (for example, <a href="https://hub.docker.com/_/ubuntu/" target="_blank" rel="noopener">ubuntu</a>, <a href="https://hub.docker.com/_/centos/" target="_blank" rel="noopener">centos</a>) that serve as the starting point for the majority of users.</li><li>Provide drop-in solutions for popular programming language runtimes, data stores, and other services, similar to what a Platform as a Service (PAAS) would offer.</li><li>Exemplify <a href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/" target="_blank" rel="noopener"><code>Dockerfile</code> best practices</a> and provide clear documentation to serve as a reference for other <code>Dockerfile</code> authors.</li><li>Ensure that security updates are applied in a timely manner. This is particularly important as Official Images are some of the most popular on Docker Hub.</li></ul></blockquote><p>library çš„é•œåƒå¸¸è§çš„ç‰¹ç‚¹å°±æ˜¯å½“æˆ‘ä»¬ä½¿ç”¨ docker å®¢æˆ·ç«¯å» pull ä¸€ä¸ªé•œåƒæ—¶ï¼Œæ— éœ€æŒ‡å®šè¯¥é•œåƒçš„ repo ï¼Œæ¯”å¦‚ <code>ubuntu:latest</code>ï¼Œå…¶ä»–é library çš„é•œåƒéœ€è¦æŒ‡å®šé•œåƒæ‰€å±çš„ repo ï¼Œæ¯”å¦‚ <code>jenkins/slave:latest</code>ã€‚è¿™éƒ¨åˆ†ä»£ç æ˜¯ç¡¬ç¼–ç åœ¨ docker çš„æºç å½“ä¸­çš„ã€‚</p><blockquote><p>æˆ‘ä»¬è™½ç„¶æ—¥å¸¸è®¿é—®çš„æ˜¯ <code>https://hub.docker.com</code> ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨ <a href="https://github.com/docker/distribution/blob/master/reference/normalize.go#L13" target="_blank" rel="noopener">https://github.com/docker/distribution/blob/master/reference/normalize.go#L13</a> ä¸­å¯ä»¥çœ‹åˆ°å®é™… <code>docker</code> ä½¿ç”¨çš„åœ°å€æ˜¯ä¸€ä¸ªç¡¬ç¼–ç çš„ <code>docker.io</code></p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">legacyDefaultDomain = <span class="string">"index.docker.io"</span></span><br><span class="line">defaultDomain       = <span class="string">"docker.io"</span></span><br><span class="line">officialRepoName    = <span class="string">"library"</span></span><br><span class="line">defaultTag          = <span class="string">"latest"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></blockquote><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å‡ ç§åŠæ³•æ¥è·å– docker hub ä¸Š library repo çš„é•œåƒåˆ—è¡¨ã€‚</p><h3 id="é€šè¿‡-docker-registry-å‘½ä»¤è¡Œ"><a href="#é€šè¿‡-docker-registry-å‘½ä»¤è¡Œ" class="headerlink" title="é€šè¿‡ docker registry å‘½ä»¤è¡Œ"></a>é€šè¿‡ docker registry å‘½ä»¤è¡Œ</h3><p>åœ¨ docker å®˜æ–¹æ–‡æ¡£ä¸­ <a href="https://docs.docker.com/engine/reference/commandline/registry/" target="_blank" rel="noopener">docker registry</a> æœ‰æåˆ°å¯ä»¥åˆ—å‡ºæŸä¸ª registry ä¸­çš„é•œåƒï¼Œä½†è¿™ä¸ªåŠŸèƒ½ä»…é™äº <a href="https://docs.docker.com/ee/supported-platforms/" target="_blank" rel="noopener">Docker Enterprise Edition.</a> ç‰ˆæœ¬ï¼Œè€Œç¤¾åŒºçš„ç‰ˆæœ¬ä¸­æœªæœ‰è¯¥å‘½ä»¤ã€‚é‚æ”¾å¼ƒâ€¦â€¦</p><blockquote><p>This command is only available on Docker Enterprise Edition.</p><p>Learn more about <a href="https://docs.docker.com/ee/supported-platforms/" target="_blank" rel="noopener">Docker Enterprise products</a>.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker registry ls <span class="comment"># List registry images</span></span><br></pre></td></tr></table></figure><h3 id="é€šè¿‡-registry-v2-API"><a href="#é€šè¿‡-registry-v2-API" class="headerlink" title="é€šè¿‡ registry v2 API"></a>é€šè¿‡ registry v2 API</h3><ul><li><code>get-images.list</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -eo pipefail</span><br><span class="line"></span><br><span class="line">DOCKER_HUB_URL=<span class="string">"https://hub.docker.com/v2/repositories/library"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">get_images_list</span></span>() &#123;</span><br><span class="line">    ALL_IMAGES=<span class="string">""</span></span><br><span class="line">    URL=<span class="string">"<span class="variable">$&#123;DOCKER_HUB_URL&#125;</span>/?page_size=100"</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span> ; <span class="keyword">do</span></span><br><span class="line">        ALL_IMAGES=<span class="string">"<span class="variable">$(curl -sSL $&#123;URL&#125; | jq -r '.results[].name' | tr '\n' ' ')</span> <span class="variable">$&#123;ALL_IMAGES&#125;</span>"</span></span><br><span class="line">        URL=<span class="string">"<span class="variable">$(curl -sSL $&#123;URL&#125; | jq -r '.next')</span>"</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;URL&#125;</span>"</span> = <span class="string">"null"</span> ]; <span class="keyword">then</span> <span class="built_in">break</span>; <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    : &gt; all_library_images.list</span><br><span class="line">    <span class="keyword">for</span> image <span class="keyword">in</span> <span class="variable">$&#123;ALL_IMAGES&#125;</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> skopeo list-tags docker://<span class="variable">$&#123;image&#125;</span> &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">            skopeo list-tags docker://<span class="variable">$&#123;image&#125;</span> | jq <span class="string">".Tags"</span> | tr -d <span class="string">'[],\" '</span> | tr -s <span class="string">'\n'</span> | sed <span class="string">"s|^|<span class="variable">$&#123;image&#125;</span>:|g"</span> &gt;&gt; all_library_images.list</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line">get_images_list</span><br></pre></td></tr></table></figure><p>é€šè¿‡ docker hub çš„  API è·å–åˆ°çš„é•œåƒ tag å®åœ¨æ˜¯å¤ªå¤šäº†ï¼Œæˆªè‡³ä»Šæ—¥ docker hub ä¸Šæ•´ä¸ª <a href="https://hub.docker.com/u/library" target="_blank" rel="noopener">library repo</a> çš„é¡¹ç›®ä¸€å…±æœ‰ 162 ä¸ªï¼Œè€Œè¿™ 162 ä¸ªé¡¹ç›®ä¸­çš„é•œåƒ tag æ•°é‡å¤šè¾¾<strong>äº”ä¸‡ä¸¤åƒ</strong>å¤šä¸ªã€‚æ€»çš„é•œåƒä»“åº“å­˜å‚¨å ç”¨ç©ºé—´çš„å¤§å°é¢„è®¡è‡³å°‘ 5TB ã€‚å…¶ä¸­çš„é•œåƒæˆ‘ä»¬çœŸæ­£éœ€è¦ç”¨åˆ°çš„ä¼°è®¡ä¹Ÿä¸åˆ° <strong>0.1%</strong>ï¼Œå› æ­¤éœ€è¦æƒ³ä¸ªåŠæ³•å‡å°‘è¿™ä¸ªé•œåƒåˆ—è¡¨çš„æ•°é‡ï¼Œè·å¾—çš„é•œåƒåˆ—è¡¨æ›´ç²¾ç¡®ä¸€äº›ï¼Œé€šç”¨ä¸€äº›ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /opt/official-images â€¹sync*â€º</span><br><span class="line">â•°â”€<span class="comment"># cat all_library_images.list|cut -d ':' -f1 | sort -u | wc</span></span><br><span class="line">    162     162    1353</span><br><span class="line">â•­â”€root@sg-02 /opt/official-images â€¹sync*â€º</span><br><span class="line">â•°â”€<span class="comment"># cat all_library_images.list | wc</span></span><br><span class="line">  52094   52094 1193973</span><br></pre></td></tr></table></figure><h3 id="é€šè¿‡-official-images-repo"><a href="#é€šè¿‡-official-images-repo" class="headerlink" title="é€šè¿‡ official-images repo"></a>é€šè¿‡ official-images repo</h3><p>ä»¥ <a href="https://hub.docker.com/_/debian" target="_blank" rel="noopener">debian</a> ä¸ºä¾‹ï¼Œåœ¨ docker hub ä¸Šé•œåƒçš„ tag åŸºæœ¬ä¸Šéƒ½æ˜¯è¿™æ ·å­çš„ï¼š</p><blockquote><p><strong>Supported tags and respective <code>Dockerfile</code> links</strong></p><ul><li><a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/bullseye/Dockerfile" target="_blank" rel="noopener"><code>bullseye</code>, <code>bullseye-20210208</code></a></li><li><a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/bullseye/backports/Dockerfile" target="_blank" rel="noopener"><code>bullseye-backports</code></a></li><li><a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/bullseye/slim/Dockerfile" target="_blank" rel="noopener"><code>bullseye-slim</code>, <code>bullseye-20210208-slim</code></a></li><li><a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/buster/Dockerfile" target="_blank" rel="noopener"><code>buster</code>, <code>buster-20210208</code>, <code>10.8</code>, <code>10</code>, <code>latest</code></a></li><li><a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/buster/backports/Dockerfile" target="_blank" rel="noopener"><code>buster-backports</code></a></li><li><a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/buster/slim/Dockerfile" target="_blank" rel="noopener"><code>buster-slim</code>, <code>buster-20210208-slim</code>, <code>10.8-slim</code>, <code>10-slim</code></a></li><li><a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/experimental/Dockerfile" target="_blank" rel="noopener"><code>experimental</code>, <code>experimental-20210208</code></a></li><li><a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/jessie/Dockerfile" target="_blank" rel="noopener"><code>jessie</code>, <code>jessie-20210208</code>, <code>8.11</code>, <code>8</code></a></li><li><a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/jessie/slim/Dockerfile" target="_blank" rel="noopener"><code>jessie-slim</code>, <code>jessie-20210208-slim</code>, <code>8.11-slim</code>, <code>8-slim</code></a></li></ul></blockquote><p>æ¯ä¸€è¡Œéƒ½ä»£è¡¨ç€åŒä¸€ä¸ªé•œåƒï¼Œå¦‚ï¼š <a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/b05117a87fbd32f977b4909e399fe368c75767ad/buster/Dockerfile" target="_blank" rel="noopener"><code>buster</code>, <code>buster-20210208</code>, <code>10.8</code>, <code>10</code>, <code>latest</code></a> ã€‚ä¸€è¡Œä¸­é•œåƒè™½ç„¶æœ‰å¤šä¸ª tagï¼Œä½†è¿™äº› tag æŒ‡å‘çš„ manifest å…¶å®éƒ½æ˜¯ä¸€è‡´çš„ã€‚é•œåƒ tag çš„å…³ç³»æœ‰ç‚¹ç±»ä¼¼äº C è¯­è¨€é‡Œçš„æŒ‡é’ˆå˜é‡ï¼Œæ˜¯å¼•ç”¨çš„å…³ç³»ã€‚</p><p>ä½†è¿™ä¹ˆå¤šçš„ä¿¡æ¯æ˜¯å¦‚ä½•é«˜æ•ˆåœ°ç®¡ç†çš„å‘¢ï¼Ÿäºæ˜¯é¡ºè—¤æ‘¸ç“œå‘ç°äº†ï¼šç”±äº library repo é‡Œçš„é•œåƒæ„å»ºä¿¡æ¯éƒ½æ˜¯ç”± <a href="https://github.com/docker-library/official-images" target="_blank" rel="noopener">official-images</a> è¿™ä¸ª repo æ¥ç®¡ç†çš„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># buster -- Debian 10.8 Released 06 February 2021</span></span><br><span class="line">Tags: buster, buster-20210208, 10.8, 10, latest</span><br><span class="line">Architectures: amd64, arm32v5, arm32v7, arm64v8, i386, mips64le, ppc64le, s390x</span><br><span class="line">Directory: buster</span><br><span class="line"></span><br><span class="line">Tags: buster-backports</span><br><span class="line">Architectures: amd64, arm32v5, arm32v7, arm64v8, i386, mips64le, ppc64le, s390x</span><br><span class="line">Directory: buster/backports</span><br><span class="line"></span><br><span class="line">Tags: buster-slim, buster-20210208-slim, 10.8-slim, 10-slim</span><br><span class="line">Architectures: amd64, arm32v5, arm32v7, arm64v8, i386, mips64le, ppc64le, s390x</span><br><span class="line">Directory: buster/slim</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ª <a href="https://github.com/docker-library/official-images" target="_blank" rel="noopener">official-images</a>  repo é‡Œ  library ç›®å½•ä¸‹æœ‰ä»¥é•œåƒ name å‘½åçš„æ–‡ä»¶ï¼Œè€Œæ–‡ä»¶çš„å†…å®¹æ­£æ˜¯è®°å½•ç€ä¸ docker hub ç›¸å¯¹åº”çš„ tag ä¿¡æ¯ã€‚ç”±æ­¤æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸ª repo è·å– library repo é•œåƒçš„ tagã€‚å¥½å¤„åœ¨äºè™½ç„¶è¿™æ ·å¾—åˆ°çš„é•œåƒåˆ—è¡¨å¹¶ä¸æ˜¯å…¨é¢çš„ï¼Œä½†è¿™ä¸ª repo é‡Œè®°å½•çš„é•œåƒ tag éƒ½æ˜¯å®˜æ–¹è¿˜åœ¨ç»´æŠ¤çš„ï¼Œå¹¶ä¸ä¼šåŒ…å«ä¸€äº›æ—§çš„æˆ–è€… CI æµ‹è¯•çš„é•œåƒã€‚è¿™æ ·è·å¾—çš„é•œåƒåˆ—è¡¨æ›´é€šç”¨ä¸€äº›ã€‚</p><p>æ‹¿å‡º Linux æ–‡æœ¬å¤„ç†ä¸‰å‰‘å®¢ï¼Œä¸€é¡¿æ“ä½œæ“å‡ºäº†ä¸ªè„šæœ¬æ¥ç”Ÿæˆé•œåƒä»¥åŠé•œåƒçš„æ•°é‡ã€‚æƒŠå¥‡çš„å‘ç°ï¼Œé€šè¿‡è¿™ç§æ–¹å¼è·å–åˆ°çš„é•œåƒæ•°é‡ä¸º docker hub çš„ registry API è·å–åˆ°çš„é•œåƒæ•°é‡çš„ååˆ†ä¹‹ä¸€å·¦å³ã€‚æ ¹æ®å¦‚ä¸‹æ•°æ®å¯ä»¥å¾—å‡ºï¼Œdocker hub çœŸå®éœ€è¦çš„é•œåƒæ•°é‡ä¸º 1517 ä¸ªï¼Œè€Œ 5590 ä¸ªé•œåƒä¸­åŒ…å«äº†å¤šä¸ª tag æŒ‡å‘åŒä¸€ä¸ªé•œåƒçš„æƒ…å†µï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¿™äº›ç›¸åŒé•œåƒçš„ tag pull ä¸€æ¬¡å³å¯ï¼Œå…¶ä½™çš„é•œåƒé€šè¿‡ retag çš„æ–¹å¼æ‰“ä¸Š tag å³å¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–é•œåƒåˆ—è¡¨</span></span><br><span class="line">$ grep -Er <span class="string">"^Tags:|^SharedTags:"</span> library | sed <span class="string">'s|library/||g;s|:Tags||g;s|:SharedTags||g;s| ||g'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–é•œåƒæ•°é‡ï¼Œä¹Ÿå°±æ˜¯ manifests çš„æ•°é‡</span></span><br><span class="line">$ grep -Er <span class="string">"^Tags:|^SharedTags:"</span> library | sed <span class="string">'s|library/||g;s|:Tags||g;s|:SharedTags||g;s| ||g'</span> | wc</span><br><span class="line">   1518    1518   95999</span><br><span class="line"><span class="comment"># è·å–æ‰€æœ‰é•œåƒ tag æ•°é‡ï¼ŒåŒ…å«äº†æ‰€æœ‰çš„ tag</span></span><br><span class="line">$ grep -Er <span class="string">"^Tags:|^SharedTags:"</span> library | sed <span class="string">'s|library/||g;s|:Tags||g;s|:SharedTags||g;s| ||g'</span> | tr <span class="string">','</span> <span class="string">'\n'</span> | wc</span><br><span class="line">   5590    5590   95999</span><br></pre></td></tr></table></figure><h2 id="æœ¬åœ°åŒæ­¥é•œåƒ"><a href="#æœ¬åœ°åŒæ­¥é•œåƒ" class="headerlink" title="æœ¬åœ°åŒæ­¥é•œåƒ"></a>æœ¬åœ°åŒæ­¥é•œåƒ</h2><p>è·å–åˆ°é•œåƒåˆ—è¡¨ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ç”¨ä½¿ç”¨ <a href="https://github.com/containers/skopeo/blob/master/docs/skopeo-copy.1.md" target="_blank" rel="noopener">skopeo copy</a> ç›´æ¥å°†é•œåƒ copy åˆ°æœ¬åœ°çš„é•œåƒä»“åº“ä¸­å•¦ã€‚ç»“åˆä¸Šè¿°æ­¥éª¤ï¼Œä½¿ç”¨ä¸åˆ° 20 è¡Œçš„è„šæœ¬å°±èƒ½å®Œæˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ALL_IMAGES=$(grep -Er <span class="string">"^Tags:|^SharedTags:"</span> library \</span><br><span class="line">| sed <span class="string">'s|library/||g;s|:Tags||g;s|:SharedTags||g;s| ||g'</span>)</span><br><span class="line">IFS=$<span class="string">'\n'</span></span><br><span class="line"><span class="keyword">for</span> image <span class="keyword">in</span> <span class="variable">$&#123;ALL_IMAGES&#125;</span>; <span class="keyword">do</span></span><br><span class="line">    name=<span class="string">"<span class="variable">$(echo $&#123;image&#125; | cut -d ':' -f1)</span>"</span></span><br><span class="line">    tags=<span class="string">"<span class="variable">$(echo $&#123;image&#125; | cut -d ':' -f2 | cut -d ',' -f1)</span>"</span></span><br><span class="line">    <span class="keyword">if</span> skopeo copy docker://<span class="variable">$&#123;name&#125;</span>:<span class="variable">$&#123;tags&#125;</span> docker://registry.local/library/<span class="variable">$&#123;name&#125;</span>:<span class="variable">$&#123;tags&#125;</span>; <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">for</span> tag <span class="keyword">in</span> $(<span class="built_in">echo</span> <span class="variable">$&#123;image&#125;</span> | cut -d <span class="string">':'</span> -f2 | tr <span class="string">','</span> <span class="string">'\n'</span>); <span class="keyword">do</span></span><br><span class="line">        skopeo copy docker://<span class="variable">$&#123;name&#125;</span>:<span class="variable">$&#123;tag&#125;</span> docker://registry.local/library/<span class="variable">$&#123;name&#125;</span>:<span class="variable">$&#123;tags&#125;</span>;</span><br><span class="line">     <span class="keyword">done</span></span><br><span class="line">     <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>ä½†ï¼Œæ²¡æˆ‘æƒ³è±¡ä¸­çš„é‚£ä¹ˆç®€å•ï¼Œåœ¨è‡ªå·±çš„æœºå™¨ä¸Š pull äº†ä¸åˆ° 150 ä¸ªé•œåƒçš„æ—¶å€™å°±æŠ¥é”™é€€å‡ºäº†ï¼Œæç¤º <code>toomanyrequests: You have reached your pull rate limit.</code> é”™è¯¯ã€‚å¿ƒé‡Œ mmpï¼Œdocker inc å•Šï¼Œå¹²å•¥å•¥ä¸è¡Œï¼ˆå¦‚ä»Š Docker Machineï¼ŒDocker Swarmï¼Œdocker-compose ä¸‰é©¾é©¬è½¦å“ªå„¿å»äº†ï¼Ÿï¼‰ï¼Œ<strong>æ°çƒ‚é’±å¯è¿˜è¡Œ</strong>ğŸ˜¡ã€‚</p><blockquote><p>ime=â€2021-02-12T07:08:51Zâ€ level=fatal msg=â€Error parsing image name &quot;docker://ubuntu:latest&quot;:</p><p>Error reading manifest latest in docker.io/library/ubuntu: toomanyrequests: You have reached your pull rate limit. You may increase the limit by authenticating and upgrading: <a href="https://www.docker.com/increase-rate-limit&quot;" target="_blank" rel="noopener">https://www.docker.com/increase-rate-limit&quot;</a></p></blockquote><h2 id="Dockerfile-é‡ŒåŒæ­¥é•œåƒï¼Ÿ"><a href="#Dockerfile-é‡ŒåŒæ­¥é•œåƒï¼Ÿ" class="headerlink" title="Dockerfile é‡ŒåŒæ­¥é•œåƒï¼Ÿ"></a>Dockerfile é‡ŒåŒæ­¥é•œåƒï¼Ÿ</h2><p>æ—¢ç„¶åœ¨æœ¬åœ°æœ‰ pull æ¬¡æ•°çš„é™åˆ¶ï¼Œé‚£ä»€ä¹ˆåœ°æ–¹ä¸ä¼šæœ‰è¿™ç§é™åˆ¶å‘¢ï¼Ÿé¦–å…ˆæƒ³åˆ°çš„æ˜¯ docker hub ä¸Š build é•œåƒè‚¯å®šä¸ä¼šé™åˆ¶å§ã€‚åº”è¯¥æ˜¯çš„â€¦â€¦ã€‚ä¸å¦‚åœ¨ Dockerfile é‡Œå¡ä¸€ä¸ªè„šæœ¬ï¼Œç”¨å®ƒæ¥åŒæ­¥é•œåƒå¦‚ä½•ï¼Ÿäºæ˜¯ä¸€é¡¿æ“ä½œçŒ›å¦‚è™ï¼Œä¸ä¸€ä¼šå„¿å°±æ“å‡ºæ¥ä¸ª Dockerfileã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:unstable-slim</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">set</span> -xue ;\</span></span><br><span class="line"><span class="bash">    apt update -y ;\</span></span><br><span class="line"><span class="bash">    apt install ca-certificates skopeo git curl jq -y --no-install-recommends ;\</span></span><br><span class="line"><span class="bash">    rm -rf /var/lib/apt/lists/* ;\</span></span><br><span class="line"><span class="bash">    git <span class="built_in">clone</span> -b sync https://github.com/muzi502/official-images /build</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">set</span> -xue ;\</span></span><br><span class="line"><span class="bash">    skopeo login hub.k8s.li -u admin -p Harbor123456 ;\</span></span><br><span class="line"><span class="bash">    bash /build/sync-images.sh</span></span><br></pre></td></tr></table></figure><p>ç„¶â€¦â€¦äº‹å®è¯æ˜æ˜¯æˆ‘å¤ªå¤©çœŸäº†ï¼Œåœ¨åŒæ­¥äº†ä¸åˆ° 100 å¤šä¸ªé•œåƒåï¼ŒåŒæ ·ä¹Ÿå‡ºç°äº† 429 toomanyrequests çš„é™åˆ¶ã€‚æ€æ¡Œå„¿ï¼åœ¨ docker hub ä¸Šæ„å»ºé•œåƒï¼Œä¹Ÿä¼šè¢«é™åˆ¶ï¼Ÿè‡ªå·±é™åˆ¶è‡ªå·±ï¼Ÿï¼Ÿè¿™ä»€ä¹ˆé¸¡å„¿ç©æ„ã€‚</p><p><del>å‡å¦‚æœ‰ä¸€ä¸ªå¤šé˜¶æ®µæ„å»ºçš„ Dockerfileï¼Œå°±æœ‰å¯èƒ½å› ä¸ºæ‹‰ä¸åˆ°é•œåƒè€Œå¯¼è‡´é•œåƒæ„å»ºå¤±è´¥ã€‚é‚£ä¹ˆè¿™ç§æ™ºéšœçš„è®¾è®¡æ²¡æƒ³åˆ°è¿‡ï¼Ÿ</del></p><p>æƒ³åˆ°ä¸€ç§å¯èƒ½æ˜¯ docker hub å†…éƒ¨æ˜¯é€šè¿‡ token æ¥è¿›è¡ŒéªŒè¯çš„ï¼Œè€Œä¸æ˜¯æ ¹æ®å®¢æˆ·ç«¯è®¿é—®æº IP ã€‚build é•œåƒçš„å®¿ä¸»æœºä¸Šä¼šæœ‰ docker login çš„ token æ–‡ä»¶ï¼Œä½† build é•œåƒçš„å®¹å™¨é‡Œæ˜¯æ²¡æœ‰è¿™ä¸ª token æ–‡ä»¶çš„ï¼Œæ‰€ä»¥åœ¨ dockerfile é‡Œ pull é•œåƒåŒæ ·ä¼šè¢«é™åˆ¶ã€‚çœ‹æ¥ dockerfile é‡ŒåŒæ­¥é•œåƒçš„æ–¹æ¡ˆä¹Ÿå°±ä¸è¡Œäº†ğŸ™ƒï¼Œåªèƒ½å¦å¯»ä»–è·¯å•¦ã€‚</p><h2 id="GitHub-Action-æ¥åŒæ­¥é•œåƒ"><a href="#GitHub-Action-æ¥åŒæ­¥é•œåƒ" class="headerlink" title="GitHub Action æ¥åŒæ­¥é•œåƒ"></a>GitHub Action æ¥åŒæ­¥é•œåƒ</h2><h3 id="ssh-è¿æ¥-runner"><a href="#ssh-è¿æ¥-runner" class="headerlink" title="ssh è¿æ¥ runner"></a>ssh è¿æ¥ runner</h3><p>åœ¨åˆšå¼€å§‹å†™è¿™ç¯‡åšå®¢çš„æ—¶å€™ä¹Ÿæ²¡æœ‰æƒ³åˆ°ä½¿ç”¨ GitHub Actionï¼Œåœ¨åˆ· GitHub åŠ¨æ€çš„æ—¶å€™æ— æ„é—´å‘ç°äº†å®ƒã€‚äºæ˜¯åˆä¸€é¡¿æ“ä½œçœ‹çœ‹ GitHub Action æ˜¯å¦èƒ½ç”¨æ¥åŒæ­¥é•œåƒã€‚</p><p>é¦–å…ˆå‚è€ƒ <a href="https://p3terx.com/archives/ssh-to-the-github-actions-virtual-server-environment.html" target="_blank" rel="noopener">SSH è¿æ¥åˆ° GitHub Actions è™šæ‹ŸæœåŠ¡å™¨</a> è¿æ¥åˆ° runner çš„æœºå™¨ä¸Š:</p><ul><li><code>.github/workflows/ssh.yaml</code></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Ubuntu</span></span><br><span class="line"><span class="attr">on:</span> <span class="string">push</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-20.04</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">tmate</span> <span class="string">session</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">mxschmitt/action-tmate@v1</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ ssh è¿æ¥åˆ° action runner çš„æœºå™¨é‡Œæ„å¤–å‘ç°ï¼Œåœ¨ <code>~/.docker/config.json</code> æ–‡ä»¶é‡Œç«Ÿç„¶å·²ç»æœ‰äº†ä¸ª login çš„ docker hub è´¦æˆ·ã€‚<code>å“¦è±.jpg</code>ã€‚ç”±äº docker login çš„é…ç½®æ–‡ä»¶åªæ˜¯ç®€å•çš„ base64 åŠ å¯†ï¼Œè§£ç åæ‹¿åˆ°çœŸå®çš„ user å’Œ tokenã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">runner@fv-az60-303:~$ cat .docker/config.json</span><br><span class="line">&#123;</span><br><span class="line">        "auths": &#123;</span><br><span class="line">                "https://index.docker.io/v1/": &#123;</span><br><span class="line">                        "auth": "Z2l0aHViYWN0aW9uczozZDY0NzJiOS0zZDQ5LTRkMTctOWZjOS05MGQyNDI1ODA0M2I="</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;runner@fv-az60-303:~$ echo "Z2l0aHViYWN0aW9uczozZDY0NzJiOS0zZDQ5LTRkMTctOWZjOS05MGQyNDI1ODA0M2I=" | base64 -d</span><br><span class="line">githubactions:3d6472b9-3d49-4d17-9fc9-90d24258043b</span><br></pre></td></tr></table></figure><p><img src="img/image-20210216173039196.png" alt="image-20210216173039196"></p><p>äºæ˜¯æƒ³ç€å¯ä»¥éªŒè¯ä¸€ä¸‹è¿™ä¸ªè´¦æˆ·æ˜¯å¦æœ‰é™åˆ¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --user <span class="string">'githubactions:3d6472b9-3d49-4d17-9fc9-90d24258043'</span> <span class="string">"https://auth.docker.io/token?service=registry.docker.io&amp;scope=repository:ratelimitpreview/test:pull"</span></span><br></pre></td></tr></table></figure><p>ä½†å¤±è´¥äº†ï¼Œæç¤º <code>{&quot;details&quot;:&quot;incorrect username or password&quot;}</code> ï¼Œä¼°è®¡è¿™ä¸ªè´¦æˆ·æ˜¯ä¸ª bot è´¦æˆ·ï¼Œåªèƒ½ç”¨äº pull é•œåƒï¼Œå…¶ä»–çš„ api è¯·æ±‚éƒ½æ²¡æƒé™ä½¿ç”¨ã€‚è‡³äºè¿™ä¸ªè´¦æˆ·æœ‰æ²¡æœ‰é™åˆ¶ï¼Œè¿˜éœ€è¦åšä¸‹æµ‹è¯•ã€‚</p><p>å¦å¤–æ„å¤–åœ°å‘ç° runner çš„æœºå™¨é‡Œé›†æˆäº†å¾ˆå¤šå·¥å…·ï¼Œå…¶ä¸­  skopeo ä¹ŸåŒ…å«åœ¨å†…ï¼Œå®åœ¨æ˜¯å¤ªæ–¹ä¾¿äº†ã€‚GitHub ç‰›çš®ï¼Œå¾®è½¯çˆ¸çˆ¸æˆ‘çˆ±ä½ ğŸ˜˜ï¼é‚£å°±æ–¹ä¾¿äº†ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨ skopeo inspect å»è¯·æ±‚é•œåƒçš„ manifests æ–‡ä»¶ã€‚çœ‹çœ‹æœ€å¤šèƒ½è¯·æ±‚å¤šå°‘ä¼šè¢«é™åˆ¶ã€‚äºæ˜¯èŠ±äº†ç‚¹æ—¶é—´æ“äº†ä¸ªè„šæœ¬ç”¨äºå»è·å– docker hub ä¸Š library repo ä¸­çš„æ‰€æœ‰é•œåƒçš„ manifests æ–‡ä»¶ã€‚</p><ul><li><code>get-manifests.sh</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -eo pipefail</span><br><span class="line"></span><br><span class="line">DOCKER_HUB_URL=<span class="string">"https://hub.docker.com/v2/repositories/library"</span></span><br><span class="line">IMAGES_LIST=<span class="string">"images.list"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">get_images_list</span></span>() &#123;</span><br><span class="line">    ALL_IMAGES=<span class="string">""</span></span><br><span class="line">    URL=<span class="string">"<span class="variable">$&#123;DOCKER_HUB_URL&#125;</span>/?page_size=100"</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span> ; <span class="keyword">do</span></span><br><span class="line">        ALL_IMAGES=<span class="string">"<span class="variable">$(curl -sSL $&#123;URL&#125; | jq -r '.results[].name' | tr '\n' ' ')</span> <span class="variable">$&#123;ALL_IMAGES&#125;</span>"</span></span><br><span class="line">        URL=<span class="string">"<span class="variable">$(curl -sSL $&#123;URL&#125; | jq -r '.next')</span>"</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;URL&#125;</span>"</span> = <span class="string">"null"</span> ]; <span class="keyword">then</span> <span class="built_in">break</span>; <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    : &gt; <span class="variable">$&#123;IMAGES_LIST&#125;</span></span><br><span class="line">    <span class="keyword">for</span> image <span class="keyword">in</span> <span class="variable">$&#123;ALL_IMAGES&#125;</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> skopeo list-tags docker://<span class="variable">$&#123;image&#125;</span> &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">            skopeo list-tags docker://<span class="variable">$&#123;image&#125;</span> | jq -c <span class="string">".Tags"</span> | tr -d <span class="string">'[]\"'</span> \</span><br><span class="line">            | tr <span class="string">','</span> <span class="string">'\n'</span> | sed <span class="string">"s|^|<span class="variable">$&#123;image&#125;</span>:|g"</span> &gt;&gt; <span class="variable">$&#123;IMAGES_LIST&#125;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">get_manifests</span></span>() &#123;</span><br><span class="line">    mkdir -p manifests</span><br><span class="line">    IFS=$<span class="string">'\n'</span></span><br><span class="line">    <span class="keyword">for</span> image <span class="keyword">in</span> $(cat <span class="variable">$&#123;IMAGES_LIST&#125;</span>); <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> skopeo inspect --raw docker://<span class="variable">$&#123;image&#125;</span> | jq  -r <span class="string">'.manifests[].digest'</span> &amp;&gt; /dev/null ; <span class="keyword">then</span></span><br><span class="line">            skopeo inspect --raw docker://<span class="variable">$&#123;image&#125;</span> | jq  -r <span class="string">'.manifests[].digest'</span> \</span><br><span class="line">            |  xargs -L1 -P8 -I % sh -c <span class="string">"skopeo inspect --raw docker://<span class="variable">$&#123;image/:*/&#125;</span>@% &gt; manifests/<span class="variable">$&#123;image&#125;</span>@%.json"</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            skopeo inspect --raw docker://<span class="variable">$&#123;image&#125;</span> &gt; manifests/<span class="variable">$&#123;image&#125;</span>.json</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">get_images_list</span><br><span class="line">get_manifests</span><br></pre></td></tr></table></figure><p>ç»è¿‡ä¸€ç•ªé•¿æ—¶é—´çš„åˆºæµ‹è¯•ï¼Œåœ¨è·å–äº† 20058   ä¸ªé•œåƒçš„ manifest æ–‡ä»¶ä¹‹åä¾æ—§æ²¡æœ‰è¢«é™åˆ¶ï¼Œäºæ˜¯å¤§èƒ†çŒœæµ‹ï¼Œrunner é‡Œå†…ç½®çš„ docker hub è´¦æˆ· pull library é•œåƒæ˜¯æ²¡æœ‰é™åˆ¶çš„ã€‚ä¼°è®¡æ˜¯ GitHub å’Œ docker inc è¾¾æˆäº†  py äº¤æ˜“ï¼Œç”¨è¿™ä¸ªè´¦æˆ·å» pull å…¬å…±é•œåƒæ²¡æœ‰é™åˆ¶ã€‚</p><p><img src="img/image-20210216173003436.png" alt="image-20210216173003436"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">runner@fv-az212-267:~/work/runner-test/runner-test$ ls manifests/ | wc</span><br><span class="line">  20058   20058 1875861</span><br></pre></td></tr></table></figure><h3 id="å®šæ—¶åŒæ­¥é•œåƒ"><a href="#å®šæ—¶åŒæ­¥é•œåƒ" class="headerlink" title="å®šæ—¶åŒæ­¥é•œåƒ"></a>å®šæ—¶åŒæ­¥é•œåƒ</h3><p>ä»ä¸Šè¿°æ­¥éª¤ä¸€å¯çŸ¥åœ¨ GitHub Action runner æœºå™¨é‡Œè‡ªå¸¦çš„ docker login è´¦æˆ·æ˜¯æ²¡æœ‰é™åˆ¶ï¼Œé‚£æˆ‘ä»¬æœ€ç»ˆå°±é€‰å®šä½¿ç”¨å®ƒæ¥åŒæ­¥é•œåƒåˆ°æœ¬åœ° registry å§ã€‚å‚ç…§ GitHub Action ç…§è‘«èŠ¦ç”»ç“¢æ“äº†ä¸ª action çš„é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">sync-images</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sync</span></span><br><span class="line">  <span class="comment"># è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œæ¯ 6 å°æ—¶è¿è¡Œä¸€æ¬¡</span></span><br><span class="line">  <span class="attr">schedule:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">cron:</span> <span class="string">"* */6 * * *"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">sync-images:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-20.04</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Clone</span> <span class="string">repository</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">git</span> <span class="string">config</span> <span class="string">user.name</span> <span class="string">github-actions</span></span><br><span class="line">          <span class="string">git</span> <span class="string">config</span> <span class="string">user.email</span> <span class="string">github-actions@github.com</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Sync</span> <span class="string">images</span></span><br><span class="line">        <span class="attr">shell:</span> <span class="string">bash</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">REGISTRY_DOMAIN:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.REGISTRY_DOMAIN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">REGISTRY_USER:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.REGISTRY_USER</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">REGISTRY_PASSWORD:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.REGISTRY_PASSWORD</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">sudo</span> <span class="string">skopeo</span> <span class="string">login</span> <span class="string">$&#123;REGISTRY_DOMAIN&#125;</span>  <span class="string">-u</span> <span class="string">$&#123;REGISTRY_USER&#125;</span> <span class="string">-p</span> <span class="string">$&#123;REGISTRY_PASSWORD&#125;</span></span><br><span class="line">          <span class="string">sudo</span> <span class="string">bash</span> <span class="string">sync-images.sh</span> <span class="string">$&#123;REGISTRY_DOMAIN&#125;</span></span><br></pre></td></tr></table></figure><p>æ—¢ç„¶ GitHub runner çš„æœºå™¨é‡Œæœ‰ docker login çš„é…ç½®æ–‡ä»¶ï¼Œä¸å¦‚æŠŠå®ƒ<strong>å·</strong>è¿‡æ¥ï¼Œå¤åˆ¶ç²˜è´´åˆ°è‡ªå®¶çš„æœºå™¨ä¸Šä½¿ç”¨ğŸ˜œï¼Ÿä¸è¿‡æˆ‘è®¤ä¸ºè¿™ç§è¡Œä¸ºæœ‰ç‚¹ä¸åšé“ğŸ˜‚ï¼Œè¿˜æ˜¯åˆ«å¹²äº†ã€‚åœ¨è¿™é‡Œåªæä¾›ä¸€ä¸ªæ€è·¯ï¼Œå®é™…ä¸Šå¯è¡Œæ€§è¿˜å¾…éªŒè¯ã€‚</p><h3 id="å¢é‡åŒæ­¥"><a href="#å¢é‡åŒæ­¥" class="headerlink" title="å¢é‡åŒæ­¥"></a>å¢é‡åŒæ­¥</h3><p>é»˜è®¤è®¾ç½®çš„ä¸º 6 å°æ—¶åŒæ­¥ä¸€æ¬¡ä¸Šæ¸¸æœ€æ–°çš„ä»£ç ï¼Œç”±äºå®šæ—¶æ›´æ–°æ˜¯ä½¿ç”¨çš„å¢é‡åŒæ­¥ï¼Œå³é€šè¿‡ git diff çš„æ–¹å¼å°†å½“å‰åˆ†æ”¯æœ€æ–°çš„ commit å’Œä¸Šæ¸¸ docker hub å®˜æ–¹çš„ repo æœ€æ–° commit è¿›è¡Œæ¯”è¾ƒï¼Œæ‰¾å‡ºå˜åŒ–çš„é•œåƒã€‚å› æ­¤å¦‚æœæ˜¯é¦–æ¬¡åŒæ­¥ï¼Œéœ€è¦å…¨é‡åŒæ­¥ï¼Œåœ¨åŒæ­¥å®Œæˆä¹‹åä¼šç»™ repo æ‰“ä¸Šä¸€ä¸ªæ—¶é—´æˆ³çš„ tag ï¼Œä¸‹æ¬¡åŒæ­¥çš„æ—¶å€™å°±ç”¨è¿™ä¸ª tag å’Œä¸Šæ¸¸ repo æœ€æ–° commit åšå·®å¼‚æ¯”è¾ƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IMAGES=$(git diff --name-only --ignore-space-at-eol --ignore-space-change \</span><br><span class="line">    --diff-filter=AM $&#123;LAST_TAG&#125; $&#123;CURRENT_COMMIT&#125; library | xargs -L1 -I &#123;&#125; sed "s|^|&#123;&#125;:|g" &#123;&#125; \</span><br><span class="line">    | sed -n "s| ||g;s|library/||g;s|:Tags:|:|p;s|:SharedTags:|:|p" | sort -u | sed "/$&#123;SKIPE_IMAGES&#125;/d")</span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•é£Ÿç”¨ï¼Ÿ"><a href="#å¦‚ä½•é£Ÿç”¨ï¼Ÿ" class="headerlink" title="å¦‚ä½•é£Ÿç”¨ï¼Ÿ"></a>å¦‚ä½•é£Ÿç”¨ï¼Ÿ</h2><p>å¦‚æœä½ ä¹Ÿæƒ³å°† docker hub ä¸Š library repo çš„é•œåƒæåˆ°æœ¬åœ°é•œåƒä»“åº“ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹æ–¹æ³•ï¼š</p><h3 id="åŠé€€ä¸‰è¿ğŸ˜‚"><a href="#åŠé€€ä¸‰è¿ğŸ˜‚" class="headerlink" title="åŠé€€ä¸‰è¿ğŸ˜‚"></a>åŠé€€ä¸‰è¿ğŸ˜‚</h3><ul><li>é¦–å…ˆè¦æœ¬åœ°éƒ¨ç½²å¥½é•œåƒä»“åº“å¹¶é…ç½®å¥½ SSL è¯ä¹¦ã€‚é•œåƒä»“åº“å»ºè®®ä½¿ç”¨ docker registry æˆ–è€… harborï¼Œå…·ä½“çš„éƒ¨ç½²æ–¹æ³•å¯ä»¥åœ¨äº’è”ç½‘ä¸Šæ‰¾åˆ°ã€‚</li><li>éœ€è¦ä¸ªå¤§ç›˜é¸¡ï¼ˆå¤§ç¡¬ç›˜æœºå™¨ï¼‰ï¼Œå½“å‰ docker hub ä¸Šè¿˜åœ¨ç»´æŠ¤çš„ tag é•œåƒæ€»å¤§å°ä¸º 128 GB å·¦å³ã€‚</li><li>å¦‚æœæ˜¯é•¿æœŸä½¿ç”¨ï¼Œæœ¬åœ°é•œåƒä»“åº“çš„å­˜å‚¨ç©ºé—´è‡³å°‘ 1TB ä»¥ä¸Šã€‚</li><li>ç”±äºæ˜¯ä½¿ç”¨ GitHub action çš„æœºå™¨å°†é•œåƒ push åˆ°æœ¬åœ°é•œåƒä»“åº“ï¼Œå› æ­¤æœ¬åœ°é•œåƒä»“åº“éœ€è¦æœ‰ä¸ªå…¬ç½‘IPä»¥åŠåŸŸå + SSL è¯ä¹¦</li></ul><h3 id="å¢åŠ é…ç½®"><a href="#å¢åŠ é…ç½®" class="headerlink" title="å¢åŠ é…ç½®"></a>å¢åŠ é…ç½®</h3><p>é¦–å…ˆ fork å®˜æ–¹çš„ repo <a href="https://github.com/docker-library/official-images" target="_blank" rel="noopener">docker-library/official-images</a>  åˆ°è‡ªå·±çš„ GitHub è´¦æˆ·ä¸‹ï¼›</p><p>ç„¶å fork è¿™ä¸ª repo <a href="https://github.com/muzi502/sync-library-images" target="_blank" rel="noopener">muzi502/sync-library-images</a> åˆ°è‡ªå·±çš„ GitHub è´¦æˆ·ä¸‹ï¼›</p><p>æœ€ååœ¨è‡ªå·±çš„ sync-library-images è¿™ä¸ª repo çš„ <code>Settings &gt;  Secrets</code> ä¸­é…ç½®å¥½å¦‚ä¸‹ä¸‰ä¸ªå˜é‡ï¼š</p><ul><li>REGISTRY_DOMAIN è®¾ç½®ä¸ºæœ¬åœ°é•œåƒä»“åº“çš„åŸŸå</li><li>REGISTRY_USER æœ¬åœ°é•œåƒä»“åº“çš„ç”¨æˆ·å</li><li>REGISTRY_PASSWORD è®¾ç½®ä¸ºæœ¬åœ°é•œåƒä»“åº“çš„å¯†ç </li></ul><p><img src="img/image-20210216163441719.png" alt="image-20210216163441719"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><p><a href="https://docs.docker.com/docker-hub/official_images/" target="_blank" rel="noopener">Official Images on Docker Hub</a></p></li><li><p><a href="https://hub.docker.com/support/doc/how-do-i-authenticate-with-the-v2-api" target="_blank" rel="noopener">How do I authenticate with the V2 API?</a></p></li><li><p><a href="https://docs.docker.com/docker-hub/download-rate-limit/" target="_blank" rel="noopener">Download rate limit</a></p></li><li><p><a href="https://moelove.info/2020/09/20/%E7%AA%81%E7%A0%B4-DockerHub-%E9%99%90%E5%88%B6%E5%85%A8%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E6%9C%8D%E5%8A%A1/" target="_blank" rel="noopener">çªç ´ DockerHub é™åˆ¶ï¼Œå…¨é•œåƒåŠ é€ŸæœåŠ¡</a></p></li><li><p><a href="https://nova.moe/bypass-docker-hub-429/" target="_blank" rel="noopener">ç»•è¿‡ä» Docker Hub pull é•œåƒæ—¶çš„ 429 toomanyrequests</a></p></li><li><p><a href="https://www.chenshaowen.com/blog/how-to-cross-the-limit-of-dockerhub.html" target="_blank" rel="noopener">å¦‚ä½•ç»•è¿‡ DockerHub æ‹‰å–é•œåƒé™åˆ¶</a></p></li><li><p><a href="https://p3terx.com/archives/ssh-to-the-github-actions-virtual-server-environment.html" target="_blank" rel="noopener">SSH è¿æ¥åˆ° GitHub Actions è™šæ‹ŸæœåŠ¡å™¨</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;æ°çƒ‚é’±ï¼Ÿ&quot;&gt;&lt;a href=&quot;#æ°çƒ‚é’±ï¼Ÿ&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="registry" scheme="https://blog.k8s.li/tags/registry/"/>
    
      <category term="images" scheme="https://blog.k8s.li/tags/images/"/>
    
  </entry>
  
  <entry>
    <title>docker registry è¿ç§»è‡³ harbor</title>
    <link href="https://blog.k8s.li/docker-registry-to-harbor.html"/>
    <id>https://blog.k8s.li/docker-registry-to-harbor.html</id>
    <published>2021-01-30T16:00:00.000Z</published>
    <updated>2021-02-24T13:42:05.248Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Registry"><a href="#Registry" class="headerlink" title="Registry"></a>Registry</h2><h3 id="Docker-Distribution"><a href="#Docker-Distribution" class="headerlink" title="Docker Distribution"></a>Docker Distribution</h3><p><a href="https://github.com/distribution/distribution" target="_blank" rel="noopener">Docker Distribution</a> æ˜¯ç¬¬ä¸€ä¸ªæ˜¯å®ç°äº†æ‰“åŒ…ã€å‘å¸ƒã€å­˜å‚¨å’Œé•œåƒåˆ†å‘çš„å·¥å…·ï¼Œèµ·åˆ° Docker registry çš„ä½œç”¨ã€‚ï¼ˆç›®å‰ Distribution å·²ç»æèµ ç»™äº† CNCFï¼‰ã€‚å…¶ä¸­ Docker Distribution ä¸­çš„ <a href="https://github.com/distribution/distribution/tree/main/docs/spec" target="_blank" rel="noopener">spec è§„èŒƒ</a> åæ¥ä¹Ÿå°±æˆä¸ºäº† OCI <a href="https://github.com/opencontainers/distribution-spec" target="_blank" rel="noopener">distribution-spec</a> è§„èŒƒã€‚å¯ä»¥è®¤ä¸º Docker Distribution å®ç°äº†å¤§éƒ¨åˆ† OCI é•œåƒåˆ†å‘çš„è§„èŒƒï¼ŒäºŒè€…åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¹Ÿæ˜¯å…¼å®¹çš„ã€‚ OCI çš„æŒ‡å¯¼æ€æƒ³æ—¶å…ˆæœ‰å·¥ä¸šç•Œçš„å®è·µï¼Œå†å°†è¿™äº›å®è·µæ€»ç»“æˆæŠ€æœ¯è§„èŒƒï¼Œå› æ­¤å°½ç®¡ OCI çš„ <a href="https://github.com/opencontainers/distribution-spec" target="_blank" rel="noopener">distribution-spec</a> è§„èŒƒè¿˜æ²¡æœ‰æ­£å¼å‘å¸ƒï¼ˆç›®å‰ç‰ˆæœ¬æ˜¯<a href="https://github.com/opencontainers/distribution-spec/releases/tag/v1.0.0-rc1" target="_blank" rel="noopener">v1.0.0-rc1</a>ï¼‰ï¼Œä½†ä»¥ Docker Distribution ä½œä¸ºåŸºç¡€çš„é•œåƒä»“åº“å·²ç»æˆä¸ºæ™®éé‡‡ç”¨çš„æ–¹æ¡ˆï¼ŒDocker registry HTTP API V2 ä¹Ÿå°±æˆä¸ºäº†äº‹å®ä¸Šçš„æ ‡å‡†ã€‚</p><h3 id="Harbor"><a href="#Harbor" class="headerlink" title="Harbor"></a>Harbor</h3><p>Harbor ä¹Ÿæ˜¯é‡‡ç”¨äº† Docker Distribution ï¼ˆdocker registryï¼‰ä½œä¸ºåç«¯é•œåƒå­˜å‚¨æœåŠ¡ï¼Œåœ¨ Harbor 2.0 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œé•œåƒç›¸å…³çš„åŠŸèƒ½å¤§éƒ¨åˆ†æ˜¯ç”± Docker Distribution æ¥å¤„ç†ï¼Œé•œåƒå’Œ OCI ç­‰åˆ¶å“çš„å…ƒæ•°æ®æ˜¯ harbor ç»„ä»¶ä» docker registry ä¸­æå–å‡ºæ¥çš„ï¼›Harbor åœ¨ 2.0 ç‰ˆæœ¬ä¹‹åï¼Œé•œåƒç­‰ OCI åˆ¶å“ç›¸å…³çš„å…ƒæ•°æ®ç”± Harbor è‡ªå·±æ¥ç»´æŠ¤ï¼Œè€Œä¸”<strong>å…ƒæ•°æ®æ˜¯åœ¨ PUSH è¿™äº›åˆ¶å“æ—¶å†™å…¥åˆ° harbor çš„æ•°æ®åº“ä¸­çš„</strong>ã€‚ä¹Ÿæ­£å› å¾—ç›Šäºæ­¤ï¼ŒHarbor ä¸å†ä»…ä»…æ˜¯ä¸ªç”¨æ¥å­˜å‚¨å’Œç®¡ç†é•œåƒçš„æœåŠ¡ï¼Œè€Œä¸€ä¸ªäº‘åŸç”Ÿä»“åº“æœåŠ¡ï¼Œèƒ½å¤Ÿå­˜å‚¨å’Œç®¡ç†ç¬¦åˆ OCI è§„èŒƒçš„ Helm Chartã€CNABã€OPA Bundle ç­‰å¤šç§ Artifact ã€‚</p><h3 id="docker-registry-to-harbor"><a href="#docker-registry-to-harbor" class="headerlink" title="docker registry to harbor"></a>docker registry to harbor</h3><p>å¥½äº†ï¼Œæ‰¯äº†è¿™ä¹ˆå¤šæ²¡ç”¨çš„æ¦‚å¿µï¼Œå›åˆ°æœ¬æ–‡è¦è§£å†³çš„é—®é¢˜ï¼š<strong>å¦‚ä½•å°† docker registry ä¸­çš„é•œåƒè¿ç§»è‡³ harborï¼Ÿ</strong></p><p>å‡å¦‚å†…ç½‘ç¯å¢ƒä¸­æœ‰ä¸¤å°æœºå™¨ï¼Œä¸€å°æœºå™¨ä¸Šè¿è¡Œç€ docker registryï¼ŒåŸŸåå‡è®¾ä¸º registry.k8s.li ã€‚å¦ä¸€å°æœºå™¨è¿è¡Œç€ harborï¼Œå‡è®¾åŸŸåä¸º harbor.k8s.liã€‚ç°åœ¨ docker registry ä¸­å­˜æ”¾äº†äº”åƒä¸ªé•œåƒã€‚harbor æ˜¯åˆšåˆšéƒ¨ç½²çš„ï¼Œé‡Œé¢è¿˜æ²¡æœ‰é•œåƒã€‚åœ¨ç£ç›˜å’Œç½‘ç»œæ²¡æœ‰é™åˆ¶çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•é«˜æ•ˆåœ°å°† docker registry ä¸­çš„é•œåƒè¿ç§»åˆ° harbor ä¸­å‘¢ï¼Ÿ</p><h2 id="è·å–-registry-æ‰€æœ‰é•œåƒçš„åˆ—è¡¨"><a href="#è·å–-registry-æ‰€æœ‰é•œåƒçš„åˆ—è¡¨" class="headerlink" title="è·å– registry æ‰€æœ‰é•œåƒçš„åˆ—è¡¨"></a>è·å– registry æ‰€æœ‰é•œåƒçš„åˆ—è¡¨</h2><p>é¦–å…ˆåœ¨è¿ç§»ä¹‹å‰æˆ‘ä»¬è¦æ‹‰æ¸…å•ï¼Œè·å–ä¸€ä»½ docker registry ä¸­é•œåƒçš„åˆ—è¡¨ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½ä¿è¯è¿ç§»åæ²¡æœ‰é•œåƒä¸¢å¤±ã€‚æ ¹æ®æœ¨å­åœ¨ <a href="https://blog.k8s.li/Exploring-container-image.html">æ·±å…¥æµ…å‡ºå®¹å™¨é•œåƒçš„ä¸€ç”ŸğŸ¤”</a> æ–‡ç« ä¸­æåˆ°çš„ registry çš„å­˜å‚¨ç›®å½•ç»“æ„ã€‚åœ¨ registry å­˜å‚¨ç›®å½•ä¸­ï¼Œæ¯ä¸ªé•œåƒçš„ tag éƒ½æ˜¯ç”± <code>current/index</code> è¿™ä¸ªæ–‡ä»¶æŒ‡å‘è¯¥ tag é•œåƒçš„ manifests æ–‡ä»¶çš„ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡éå† registry å­˜å‚¨ç›®å½•ä¸­ <code>current/index</code> æ–‡ä»¶çš„æ–¹å¼æ¥å¾—åˆ°æ‰€æœ‰é•œåƒçš„ tagï¼Œç”±æ­¤å¾—åˆ°è¯¥ registry ä¸­æ‰€æœ‰é•œåƒçš„åˆ—è¡¨ã€‚æ³¨æ„ï¼Œè¿™æ ·åªèƒ½å¾—åˆ°æœ‰ tag çš„é•œåƒï¼Œå…¶ä»–æ²¡ tag çš„é•œåƒæ— æ³•è·å–åˆ°ã€‚</p><p><img src="img/registry-storage.jpeg" alt="img"></p><p>å¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤åœ¨ registry å­˜å‚¨ç›®å½•ä¸‹è·å–é•œåƒåˆ—è¡¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆè¿›å…¥åˆ° registry å­˜å‚¨çš„ä¸»ç›®å½•ä¸‹</span></span><br><span class="line"><span class="built_in">cd</span>  /var/lib/registry</span><br><span class="line">find docker -<span class="built_in">type</span> d -name <span class="string">"current"</span> | sed <span class="string">'s|docker/registry/v2/repositories/||g;s|/_manifests/tags/|:|g;s|/current||g'</span> &gt; images.list</span><br></pre></td></tr></table></figure><h2 id="harbor-åˆ›å»º-project"><a href="#harbor-åˆ›å»º-project" class="headerlink" title="harbor åˆ›å»º project"></a>harbor åˆ›å»º project</h2><p>å¯¹äºæ–°éƒ¨ç½²çš„ harbor æ¥è¯´ï¼Œä¸Šé¢åªä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ library çš„ projectï¼Œéœ€è¦æ‰‹åŠ¨åœ¨ harbor ä¸Šåˆ›å»º docker registry ä¸­å¯¹åº”çš„ projectã€‚docker registry ä¸­é•œåƒçš„ project å°±æ˜¯ registry å­˜å‚¨ç›®å½•ä¸­ <code>repositories</code> ä¸‹çš„ç›®å½•åã€‚</p><p>å¾—åˆ°äº†é•œåƒåˆ—è¡¨ï¼Œä»¥åŠåœ¨ harbor ä¸Šå®Œæˆäº†å¯¹åº” project çš„åˆ›å»ºï¼Œæˆ‘ä»¬å°±å¯ä»¥åšæ­£å¼çš„è¿ç§»å·¥ä½œå•¦ã€‚æ ¹æ®ä¸åŒçš„åœºæ™¯ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹å‡ ç§æ–¹æ¡ˆï¼š</p><h2 id="æ–¹æ¡ˆä¸€ï¼šdocker-retag"><a href="#æ–¹æ¡ˆä¸€ï¼šdocker-retag" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šdocker retag"></a>æ–¹æ¡ˆä¸€ï¼šdocker retag</h2><p>æ–¹æ¡ˆä¸€å¯èƒ½æ˜¯å¤§å¤šæ•°äººé¦–å…ˆæƒ³åˆ°çš„åŠæ³•ï¼Œä¹Ÿæ˜¯æœ€ç®€å•ç²—æš´çš„æ–¹æ³•ã€‚å°±æ˜¯åœ¨ä¸€å°æœºå™¨ä¸Šä½¿ç”¨ docker pull ä¸‹ docker  registry ä¸­çš„æ‰€æœ‰é•œåƒï¼Œç„¶åå† docker retag ä¸€ä¸‹ï¼Œå† docker push åˆ° harbor ä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡è®¾å…¶ä¸­çš„ä¸€ä¸ªé•œåƒä¸º library/alpine:latest</span></span><br><span class="line"></span><br><span class="line">docker pull registry.k8s.li/library/alpine:latest</span><br><span class="line"></span><br><span class="line">docker tag registry.k8s.li/library/alpine:latest harbor.k8s.li/library/alpine:latest</span><br><span class="line"></span><br><span class="line">docker push harbor.k8s.li/library/alpine:latest</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä¹‹å‰è¯»è¿‡æœ¨å­æ›¾ç»å†™è¿‡çš„ <a href="https://blog.k8s.li/Exploring-container-image.html">æ·±å…¥æµ…å‡ºå®¹å™¨é•œåƒçš„ä¸€ç”ŸğŸ¤”</a> å’Œ <a href="https://blog.k8s.li/skopeo.html">é•œåƒæ¬è¿å·¥ skopeo åˆä½“éªŒ</a> å¹¶ä¸”å·²ç»åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ä½¿ç”¨ skopeo ï¼Œä½ ä¸€å®šä¼šå¾ˆè§‰ç€è¿™ä¸ªæ–¹æ¡ˆå¾ˆè ¢ï¼Œå› ä¸º docker pull â€“&gt; docker tag â€“&gt; docker pull çš„è¿‡ç¨‹ä¸­ä¼šå¯¹é•œåƒçš„ layer è¿›è¡Œè§£å‹ç¼©ã€‚å¯¹äºåªæ˜¯å°†é•œåƒä»ä¸€ä¸ª registry å¤åˆ¶åˆ°å¦ä¸€ä¸ª registry æ¥è¯´ï¼Œè¿™äº› docker åœ¨è¿™äº›è¿‡ç¨‹ä¸­åšäº†å¾ˆå¤šæ— ç”¨åŠŸã€‚è¯¦ç»†çš„åŸç†å¯ä»¥ç¿»çœ‹ä¸€ä¸‹åˆšæåˆ°çš„ä¸¤ç¯‡æ–‡ç« ï¼Œåœ¨æ­¤å°±ä¸å†èµ˜è¿°ã€‚</p><p>é‚£ä¹ˆä¸ºäº†è¿½æ±‚é«˜æ•ˆï¼Œè‚¯å®šä¸ä¼šä½¿ç”¨ docker retag è¿™ä¹ˆè ¢çš„åŠæ³•å•¦ï¼Œä¸‹é¢å°±è®²ä¸€ä¸‹æ–¹æ¡ˆäºŒï¼š</p><h2 id="æ–¹æ¡ˆäºŒï¼šskopeo"><a href="#æ–¹æ¡ˆäºŒï¼šskopeo" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šskopeo"></a>æ–¹æ¡ˆäºŒï¼šskopeo</h2><p>åœ¨ <a href="https://blog.k8s.li/skopeo.html">é•œåƒæ¬è¿å·¥ skopeo åˆä½“éªŒ</a> ä¸­ä»‹ç»è¿‡å¯ä»¥ä½¿ç”¨ skopeo copy ç›´æ¥ä»ä¸€ä¸ª registry ä¸­å¤åˆ¶é•œåƒåŸå§‹ blobs åˆ°å¦ä¸€ä¸ª registry ä¸­ï¼Œåœ¨æ­¤æœŸé—´ä¸ä¼šæ¶‰åŠé•œåƒ layer è§£å‹ç¼©æ“ä½œã€‚è‡³äºæ€§èƒ½å’Œè€—æ—¶ï¼Œæ¯”ä½¿ç”¨ docker çš„æ–¹å¼é«˜åˆ°ä¸çŸ¥é“å“ªé‡Œå»äº†ğŸ˜‚ã€‚</p><ul><li>ä½¿ç”¨ skopeo copy</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">skopeo copy --insecure-policy --src-tls-verify=<span class="literal">false</span> --dest-tls-verify=<span class="literal">false</span> --src docker://registry.k8s.li/library/alpine:latest docker://harbor.k8s.li/library/alpine:latest</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ skopeo sync</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">skopeo sync --insecure-policy --src-tls-verify=<span class="literal">false</span> --dest-tls-verify=<span class="literal">false</span> --src docker --dest docker registry.k8s.li/library/alpine:latest harbor.k8s.li/library/alpine:latest</span><br></pre></td></tr></table></figure><p>ä½†è¿˜æœ‰æ²¡æœ‰æ›´å¥½çš„åŠæ³•ï¼Ÿè¦çŸ¥é“æ— è®ºæ˜¯ docker å’Œ skopeo æœ¬è´¨ä¸Šéƒ½æ˜¯é€šè¿‡ registry çš„ HTTP API ä¸‹è½½å’Œä¸Šä¼ é•œåƒçš„ï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­è¿˜æ˜¯å¤šäº†ä¸å°‘ HTTP è¯·æ±‚çš„ï¼Œå¦‚æœèµ°çš„æ˜¯ HTTPS çš„è¯ï¼Œè¿˜æ¶‰åŠäº† HTTPS åŠ å¯†å’Œè§£å¯†çš„è¿‡ç¨‹ï¼Œè¿™æœŸé—´ä¹Ÿæ˜¯åšäº†å¾ˆå¤š<del>æ— ç”¨åŠŸ</del>çš„ã€‚é‚£ä¹ˆè¿˜æœ‰æ²¡æœ‰æ›´å¥½çš„åŠæ³•ï¼Ÿ</p><h2 id="æ–¹æ¡ˆä¸‰ï¼šè¿ç§»å­˜å‚¨ç›®å½•"><a href="#æ–¹æ¡ˆä¸‰ï¼šè¿ç§»å­˜å‚¨ç›®å½•" class="headerlink" title="æ–¹æ¡ˆä¸‰ï¼šè¿ç§»å­˜å‚¨ç›®å½•"></a>æ–¹æ¡ˆä¸‰ï¼šè¿ç§»å­˜å‚¨ç›®å½•</h2><p>æ–‡ç« å¼€ç¯‡æåˆ° harbor çš„åç«¯é•œåƒå­˜å‚¨ä¹Ÿæ˜¯ä½¿ç”¨çš„  docker registryï¼Œå¯¹äºä¸€ä¸ª registry æ¥è¯´ï¼Œåªè¦æ˜¯ä½¿ç”¨çš„æ˜¯ Docker Distribution V2 ï¼Œå®ƒåç«¯çš„å­˜å‚¨ç›®å½•ç»“æ„éƒ½æ˜¯é•¿å¾—ä¸€æ‘¸ä¸€æ ·çš„ã€‚é‚£ä¸ºä½•ä¸ç›´æ¥å°† registry çš„å­˜å‚¨ç›®å½•æ‰“åŒ…å¤åˆ¶å¹¶è§£å‹åˆ° harbor çš„ registry å­˜å‚¨ç›®å½•å‘¢ï¼Ÿè¿™æ ·åˆèƒ½ä¿è¯æ‰€æœ‰çš„é•œåƒéƒ½è¿ç§»è¿‡å»ï¼Œä¸ä¼šè½ä¸‹ä»»ä½•ä¸€ä¸ªã€‚</p><p>å¯¹äº harbor 1.x ç‰ˆæœ¬æ¥è®²ï¼Œå°† docker registry çš„å­˜å‚¨ç›®å½•ç›´æ¥è¿ç§»åˆ° harbor çš„ registry å­˜å‚¨ç›®å½•ï¼Œç„¶ååˆ é™¤ harbor çš„ redis æ•°æ®ï¼ˆå› ä¸º harbor çš„ redis ç¼“å­˜äº†é•œåƒçš„å…ƒæ•°æ®ä¿¡æ¯ï¼‰ï¼Œé‡å¯ harbor å°±å®Œäº‹å„¿äº†ã€‚é‡å¯ harbor ä¹‹åï¼Œharbor ä¼šè°ƒç”¨åç«¯çš„ registry å»æå–é•œåƒçš„å…ƒæ•°æ®ä¿¡æ¯å¹¶å­˜å‚¨åˆ° redis ä¸­ã€‚è¿™æ ·å°±å®Œæˆäº†è¿ç§»çš„å·¥ä½œã€‚</p><p>åœ¨ docker registry æœºå™¨ä¸Šå¤‡ä»½ registry å­˜å‚¨ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢åˆ° docker registry çš„å­˜å‚¨ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span>  /var/lib/registry</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼Œè¿›è¡Œå¤‡ä»½æ—¶æ— éœ€è¿›è¡Œå‹ç¼©ï¼Œå› ä¸º registry ä¸­é•œåƒçš„ layer éƒ½æ˜¯å‹ç¼©è¿‡çš„</span></span><br><span class="line">tar -cpf docker.tar docker</span><br></pre></td></tr></table></figure><p>å¤‡ä»½å®Œæˆä¹‹åå°† docker.tar scp åˆ° harbor æœºå™¨ä¸Šï¼Œç„¶ååœ¨ harbor æœºå™¨ä¸Šæ¢å¤ registry å­˜å‚¨ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢åˆ° harbor çš„å­˜å‚¨ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /data/harbor</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å¤‡ä»½çš„ docker ç›®å½•è§£å‹åˆ° harbor çš„ registry ç›®å½•ä¸‹ï¼Œç›®å½•å±‚çº§ä¸€å®šè¦å¯¹åº”å¥½</span></span><br><span class="line">tar -xpf docker.tar -C ./registry</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ harbor çš„ regis æ•°æ®ï¼Œé‡å¯ harbor åä¼šé‡å»º redis æ•°æ®ã€‚</span></span><br><span class="line">rm -f redis/dump.rdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ° harbor çš„å®‰è£…ç›®å½•é‡å¯ harbor</span></span><br><span class="line"><span class="built_in">cd</span> /opt/harbor</span><br><span class="line">docker-compose restart</span><br></pre></td></tr></table></figure><p>è¿™æ ·è¿ç§»ä¹‹åå¯èƒ½ä¼šé‡åˆ°æ— æ³•å¾€ harbor push é•œåƒçš„é—®é¢˜ã€‚å› ä¸º docker registry å®¹å™¨å†… registry å­˜å‚¨ç›®å½•çš„æ‰€å±å’Œæ‰€å±ç»„ä¸º root ï¼Œè€Œ harbor registry å®¹å™¨å†… registry å­˜å‚¨ç›®å½•çš„æ‰€å±å’Œæ‰€å±ç»„ä¸º 10000:10000 ,äºŒè€…æƒé™å¹¶ä¸ç›¸åŒï¼Œä¼šå¯¼è‡´ harbor æ— æ³• push é•œåƒã€‚å› æ­¤åœ¨è¿ç§»å®Œæˆä¹‹åéœ€è¦ä¿®æ”¹ä¸€ä¸‹ harbor registry ç›®å½•çš„æ‰€å±å’Œæ‰€å±ç»„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢åˆ° harbor çš„å­˜å‚¨ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /data/harbor</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ registry å­˜å‚¨ç›®å½•çš„æ‰€å±å’Œæ‰€å±ç»„ä¸º 10000</span></span><br><span class="line">chown -R 10000:10000 ./registry</span><br></pre></td></tr></table></figure><h2 id="æ–¹æ¡ˆå››ï¼š"><a href="#æ–¹æ¡ˆå››ï¼š" class="headerlink" title="æ–¹æ¡ˆå››ï¼š"></a>æ–¹æ¡ˆå››ï¼š</h2><p>å¯¹äº harbor 2.x æ¥è®²ï¼Œç”±äº harbor å¼ºåŒ–äº† Artifact çš„å…ƒæ•°æ®ç®¡ç†èƒ½åŠ›ï¼Œå³å…ƒæ•°æ®è¦åœ¨ push æˆ–è€… sync åˆ° harbor æ—¶å†™å…¥åˆ° harbor è‡ªèº«çš„æ•°æ®åº“ä¸­ã€‚åœ¨ harbor çœ‹æ¥åªè¦æ•°æ®åº“ä¸­æ²¡æœ‰è¿™ä¸ª Artifact çš„ manifest ä¿¡æ¯æˆ–è€…æ²¡æœ‰è¿™ä¸€å±‚ layer çš„ä¿¡æ¯ï¼Œharbor éƒ½ä¼šè®¤ä¸ºè¯¥ Artifact æˆ–è€… layer ä¸å­˜åœ¨ï¼Œè¿”å› 404 çš„é”™è¯¯ã€‚æŒ‰ç…§æ–¹æ¡ˆä¸‰ç›´æ¥è€Œå°† docker registry å­˜å‚¨ç›®å½•è§£å‹åˆ° harbor çš„ registry å­˜å‚¨ç›®å½•çš„æ–¹æ³•è¡Œä¸é€šçš„ã€‚å› ä¸ºæ˜¯å°†é•œåƒè§£å‹åˆ° registry å­˜å‚¨ä¸­çš„ï¼Œè™½ç„¶åœ¨ harbor çš„ registry å®¹å™¨çœ‹æ¥æ˜¯æœ‰é•œåƒçš„ï¼Œä½†å› ä¸º harbor çš„æ•°æ®åº“ä¸­æ²¡æœ‰é•œåƒï¼Œharbor å°±ä¼šè®¤ä¸ºæ²¡æœ‰é•œåƒã€‚é‚£ä¹ˆç°åœ¨çœ‹æ¥åªèƒ½é€šè¿‡æ–¹æ¡ˆäºŒä½¿ç”¨ skopeo å°†é•œåƒä¸€ä¸ªä¸€ä¸ªåœ° push åˆ° harbor ä¸­äº†ã€‚</p><p>ä½†å¯¹äºæŸäº›ç‰¹å®šçš„åœºæ™¯ä¸‹ï¼Œä¸èƒ½åƒæ–¹æ¡ˆäºŒé‚£æ ·æ‹¥æœ‰ä¸€ä¸ª docker registry çš„ HTTP æœåŠ¡ï¼Œåªæœ‰ä¸€ä¸ª docker registry çš„å‹ç¼©åŒ…ï¼Œè¿™å¦‚ä½•å°† docker registry çš„å­˜å‚¨ç›®å½•ä¸­çš„é•œåƒè¿ç§»åˆ° harbor 2.0 ä¸­å‘¢ï¼Ÿ</p><p>åœ¨ <a href="https://blog.k8s.li/skopeo.html">é•œåƒæ¬è¿å·¥ skopeo åˆä½“éªŒ</a> ä¸­æåˆ°è¿‡ skopeo æ”¯æŒçš„<code>é•œåƒæ ¼å¼</code>æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><table><thead><tr><th align="left">IMAGE NAMES</th><th align="left">example</th></tr></thead><tbody><tr><td align="left"><strong>containers-storage:</strong></td><td align="left">containers-storage:</td></tr><tr><td align="left"><strong>dir:</strong></td><td align="left">dir:/PATH</td></tr><tr><td align="left"><strong>docker://</strong></td><td align="left">docker://k8s.gcr.io/kube-apiserver:v1.17.5</td></tr><tr><td align="left"><strong>docker-daemon:</strong></td><td align="left">docker-daemon:alpine:latest</td></tr><tr><td align="left"><strong>docker-archive:</strong></td><td align="left">docker-archive:alpine.tar (docker save)</td></tr><tr><td align="left"><strong>oci:</strong></td><td align="left">oci:alpine:latest</td></tr></tbody></table><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™å‡ ç§é•œåƒçš„åå­—ï¼Œå¯¹åº”ç€é•œåƒå­˜åœ¨çš„æ–¹å¼ï¼Œä¸åŒå­˜åœ¨çš„æ–¹å¼å¯¹é•œåƒçš„ layer å¤„ç†çš„æ–¹å¼ä¹Ÿä¸ä¸€æ ·ï¼Œæ¯”å¦‚ <code>docker://</code> è¿™ç§æ–¹å¼æ˜¯å­˜åœ¨ registry ä¸Šçš„ï¼›<code>docker-daemon:</code> æ˜¯å­˜åœ¨æœ¬åœ° docker pull ä¸‹æ¥çš„ï¼›å†æ¯”å¦‚ <code>docker-archive</code> æ˜¯é€šè¿‡ docker save å‡ºæ¥çš„é•œåƒï¼›è€Œ <code>dir:</code> æ˜¯é•œåƒä»¥æ–‡ä»¶å¤¹çš„å½¢å¼ä¿å­˜çš„ã€‚åŒä¸€ä¸ªé•œåƒæœ‰è¿™å‡ ç§å­˜åœ¨çš„æ–¹å¼å°±åƒæ°´æœ‰æ°”ä½“ã€æ¶²ä½“ã€å›ºä½“ä¸€æ ·ã€‚å¯ä»¥è¿™æ ·å»ç†è§£ï¼Œä»–ä»¬è¡¨è¿°çš„éƒ½æ˜¯åŒä¸€ä¸ªé•œåƒï¼Œåªä¸è¿‡æ˜¯å­˜åœ¨çš„æ–¹å¼ä¸ä¸€æ ·è€Œå·²ã€‚</p><p>æ—¢ç„¶é•œåƒæ˜¯å­˜æ”¾åœ¨ registry å­˜å‚¨ç›®å½•é‡Œçš„ï¼Œé‚£ä¹ˆä½¿ç”¨ dir çš„å½¢å¼ç›´æ¥ä»æ–‡ä»¶ç³»ç»Ÿè¯»å–é•œåƒï¼Œç†è®ºä¸Šæ¥è®²ä¼šæ¯”æ–¹æ¡ˆäºŒè¦å¥½ä¸€äº›ã€‚è™½ç„¶ skopeo æ”¯æŒ dir æ ¼å¼çš„é•œåƒï¼Œä½† skopeo ç›®å‰å¹¶ä¸æ”¯æŒç›´æ¥ä½¿ç”¨ registry çš„å­˜å‚¨ç›®å½•ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦æƒ³åŠæ³•å°† docker registry å­˜å‚¨ç›®å½•é‡Œçš„æ¯ä¸€ä¸ªé•œåƒè½¬æ¢æˆ skopeo dir çš„å½¢å¼ã€‚</p><h3 id="skopeo-dir"><a href="#skopeo-dir" class="headerlink" title="skopeo dir"></a>skopeo dir</h3><p>é‚£ä¹ˆå…ˆæ¥çœ‹ä¸€ä¸‹ skopeo dir æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ</p><p>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•æ–¹æ¡ˆçš„å¯è¡Œæ€§ï¼Œå…ˆä½¿ç”¨ skopeo å‘½ä»¤å…ˆä» docker hub ä¸Šæ‹‰å–ä¸€ä¸ªé•œåƒï¼Œå¹¶ä¿å­˜ä¸º dirï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">skopeo copy docker://alpine:latest dir:./alpine</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ tree å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹ alpine æ–‡ä»¶å¤¹çš„ç›®å½•ç»“æ„ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry</span><br><span class="line">â•°â”€# tree -h alpine</span><br><span class="line">alpine</span><br><span class="line">â”œâ”€â”€ [2.7M]  4c0d98bf9879488e0407f897d9dd4bf758555a78e39675e72b5124ccf12c2580</span><br><span class="line">â”œâ”€â”€ [1.4K]  e50c909a8df2b7c8b92a6e8730e210ebe98e5082871e66edd8ef4d90838cbd25</span><br><span class="line">â”œâ”€â”€ [ 528]  manifest.json</span><br><span class="line">â””â”€â”€ [  33]  version</span><br><span class="line"></span><br><span class="line">0 directories, 4 files</span><br><span class="line">â•­â”€root@sg-02 /var/lib/registry</span><br><span class="line">â•°â”€# file alpine/e50c909a8df2b7c8b92a6e8730e210ebe98e5082871e66edd8ef4d90838cbd25</span><br><span class="line">alpine/e50c909a8df2b7c8b92a6e8730e210ebe98e5082871e66edd8ef4d90838cbd25: ASCII text, with very long lines, with no line terminators</span><br><span class="line"></span><br><span class="line">â•­â”€root@sg-02 /var/lib/registry</span><br><span class="line">â•°â”€# file alpine/4c0d98bf9879488e0407f897d9dd4bf758555a78e39675e72b5124ccf12c2580</span><br><span class="line">alpine/4c0d98bf9879488e0407f897d9dd4bf758555a78e39675e72b5124ccf12c2580: gzip compressed data</span><br></pre></td></tr></table></figure><p>ä»æ–‡ä»¶åå’Œå¤§å°ä»¥åŠæ–‡ä»¶çš„å†…çœæˆ‘ä»¬å¯ä»¥åˆ¤æ–­å‡ºï¼Œmanifest æ–‡ä»¶å¯¹åº”çš„å°±æ˜¯é•œåƒçš„ manifests æ–‡ä»¶ï¼›ç±»å‹ä¸º <code>ASCII text</code> çš„æ–‡ä»¶æ­£æ˜¯é•œåƒçš„ image config æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«ç€é•œåƒçš„å…ƒæ•°æ®ä¿¡æ¯ã€‚è€Œå¦ä¸€ä¸ª <code>gzip compressed data</code> æ–‡ä»¶ä¸å°±æ˜¯ç»è¿‡ gzip å‹ç¼©è¿‡çš„é•œåƒ layer å˜›ã€‚çœ‹ä¸€ä¸‹ manifest æ–‡ä»¶çš„å†…å®¹ä¹Ÿå†æ¬¡å°è¯äº†è¿™ä¸ªç»“è®ºï¼š</p><ul><li>é•œåƒçš„ config å­—æ®µå¯¹åº”çš„æ­£æ˜¯ e50c909a8df2ï¼Œè€Œæ–‡ä»¶ç±»å‹æ­£æ˜¯ <code>image.v1+json</code> æ–‡æœ¬æ–‡ä»¶ã€‚</li><li>é•œåƒçš„ layer å­—æ®µå¯¹åº”çš„ä¹Ÿæ­£æ˜¯  4c0d98bf9879 è€Œæ–‡ä»¶ç±»å‹æ­£æ˜¯  <code>.tar.gzip</code> gzip å‹ç¼©æ–‡ä»¶ã€‚</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">alpine/4c0d98bf9879488e0407f897d9dd4bf758555a78e39675e72b5124ccf12c2580: gzip compressed data</span><br><span class="line">â•­â”€root@sg-02 /var/lib/registry</span><br><span class="line">â•°â”€# cat alpine/manifest.json</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">   <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.container.image.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">1471</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:e50c909a8df2b7c8b92a6e8730e210ebe98e5082871e66edd8ef4d90838cbd25"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">2811321</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:4c0d98bf9879488e0407f897d9dd4bf758555a78e39675e72b5124ccf12c2580"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä»-registry-å­˜å‚¨ç›®å½•ä¸­æé•œåƒå‡ºæ¥"><a href="#ä»-registry-å­˜å‚¨ç›®å½•ä¸­æé•œåƒå‡ºæ¥" class="headerlink" title="ä» registry å­˜å‚¨ç›®å½•ä¸­æé•œåƒå‡ºæ¥"></a>ä» registry å­˜å‚¨ç›®å½•ä¸­æé•œåƒå‡ºæ¥</h3><p>æ¥ä¸‹æ¥åˆ°æœ¬æ–‡çš„è¾ƒä¸ºç²¾å½©çš„åœ°æ–¹äº†ã€‚å¦‚ä½•ä» registry å­˜å‚¨é‡Œçš„ <code>æ</code> é•œåƒå‡ºæ¥ï¼Œè½¬æ¢æˆ skopeo æ‰€æ”¯æŒçš„ dir æ ¼å¼ã€‚</p><p><img src="img/registry-storage.jpeg" alt="img"></p><ul><li>é¦–å…ˆè¦å¾—åˆ°é•œåƒçš„ manifests æ–‡ä»¶ï¼Œä» manifests æ–‡ä»¶ä¸­å¯ä»¥å¾—åˆ°è¯¥é•œåƒçš„æ‰€æœ‰ blob æ–‡ä»¶ã€‚ä¾‹å¦‚å¯¹äº registry å­˜å‚¨ç›®å½•ä¸­çš„ <code>library/alpine:latest</code> é•œåƒæ¥è®²ï¼Œå®ƒåœ¨ registry ä¸­æ˜¯è¿™æ ·å­˜æ”¾çš„ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ blobs</span><br><span class="line">â”‚   â””â”€â”€ sha256</span><br><span class="line">â”‚       â”œâ”€â”€ 21</span><br><span class="line">â”‚       â”‚   â””â”€â”€ 21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">â”‚       â”‚       â””â”€â”€ data</span><br><span class="line">â”‚       â”œâ”€â”€ a1</span><br><span class="line">â”‚       â”‚   â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">â”‚       â”‚       â””â”€â”€ data</span><br><span class="line">â”‚       â””â”€â”€ be</span><br><span class="line">â”‚           â””â”€â”€ be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">â”‚               â””â”€â”€ data</span><br><span class="line">â””â”€â”€ repositories</span><br><span class="line">    â””â”€â”€ library</span><br><span class="line">        â””â”€â”€ alpine</span><br><span class="line">            â”œâ”€â”€ _layers</span><br><span class="line">            â”‚   â””â”€â”€ sha256</span><br><span class="line">            â”‚       â”œâ”€â”€ 21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">            â”‚       â”‚   â””â”€â”€ link</span><br><span class="line">            â”‚       â””â”€â”€ be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">            â”‚           â””â”€â”€ link</span><br><span class="line">            â”œâ”€â”€ _manifests</span><br><span class="line">            â”‚   â”œâ”€â”€ revisions</span><br><span class="line">            â”‚   â”‚   â””â”€â”€ sha256</span><br><span class="line">            â”‚   â”‚       â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">            â”‚   â”‚           â””â”€â”€ link</span><br><span class="line">            â”‚   â””â”€â”€ tags</span><br><span class="line">            â”‚       â””â”€â”€ latest</span><br><span class="line">            â”‚           â”œâ”€â”€ current</span><br><span class="line">            â”‚           â”‚   â””â”€â”€ link</span><br><span class="line">            â”‚           â””â”€â”€ index</span><br><span class="line">            â”‚               â””â”€â”€ sha256</span><br><span class="line">            â”‚                   â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">            â”‚                       â””â”€â”€ link</span><br><span class="line">            â””â”€â”€ _uploads</span><br><span class="line"></span><br><span class="line">26 directories, 8 files</span><br></pre></td></tr></table></figure><ol><li>é€šè¿‡ <code>repositories/library/alpine/_manifests/tags/latest/current/link</code> æ–‡ä»¶å¾—åˆ° alpine é•œåƒ lasts è¿™ä¸ª tag çš„ manifests æ–‡ä»¶çš„ sha256 å€¼ï¼Œç„¶åæ ¹æ®è¿™ä¸ª sha256 å€¼å» blobs æ‰¾åˆ°é•œåƒçš„ manifests æ–‡ä»¶;</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/repositories/library/alpine/_manifests/tags/latest/current/</span><br><span class="line">â•°â”€# cat link</span><br><span class="line">sha256:39eda93d15866957feaee28f8fc5adb545276a64147445c64992ef69804dbf01#</span><br></pre></td></tr></table></figure><ol start="2"><li>æ ¹æ® <code>current/link</code> æ–‡ä»¶ä¸­çš„ sha256 å€¼åœ¨ blobs ç›®å½•ä¸‹æ‰¾åˆ°ä¸ä¹‹å¯¹åº”çš„æ–‡ä»¶ï¼Œblobs ç›®å½•ä¸‹å¯¹åº”çš„ manifests æ–‡ä»¶ä¸º blobs/sha256/39/39eda93d15866957feaee28f8fc5adb545276a64147445c64992ef69804dbf01/data;</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/repositories/library/alpine/_manifests/tags/latest/current</span><br><span class="line">â•°â”€# cat /var/lib/registry/docker/registry/v2/blobs/sha256/39/39eda93d15866957feaee28f8fc5adb545276a64147445c64992ef69804dbf01/data</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">   <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.container.image.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">1507</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">2813316</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨æ­£åˆ™åŒ¹é…ï¼Œè¿‡æ»¤å‡º manifests æ–‡ä»¶ä¸­çš„æ‰€æœ‰ sha256 å€¼ï¼Œè¿™äº› sha256 å€¼å°±å¯¹åº”ç€ blobs ç›®å½•ä¸‹çš„ image config æ–‡ä»¶å’Œ image layer æ–‡ä»¶;</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/repositories/library/alpine/_manifests/tags/latest/current</span><br><span class="line">â•°â”€<span class="comment"># grep -Eo "\b[a-f0-9]&#123;64&#125;\b" /var/lib/registry/docker/registry/v2/blobs/sha256/39/39eda93d15866957feaee28f8fc5adb545276a64147445c64992ef69804dbf01/data</span></span><br><span class="line">f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span><br><span class="line">cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08</span><br></pre></td></tr></table></figure><ol start="4"><li>æ ¹æ® manifests æ–‡ä»¶å°±å¯ä»¥å¾—åˆ° blobs ç›®å½•ä¸­é•œåƒçš„æ‰€æœ‰ layer å’Œ image config æ–‡ä»¶ï¼Œç„¶åå°†è¿™äº›æ–‡ä»¶æ‹¼æˆä¸€ä¸ª dir æ ¼å¼çš„é•œåƒï¼Œåœ¨è¿™é‡Œä½¿ç”¨ cp çš„æ–¹å¼å°†é•œåƒä» registry å­˜å‚¨ç›®å½•é‡Œå¤åˆ¶å‡ºæ¥ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä¸ºäº†ä¿ç•™é•œåƒçš„ name å’Œ tagï¼Œæ–‡ä»¶å¤¹çš„åç§°å°±å¯¹åº”çš„æ˜¯ NAME:TAG</span></span><br><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker</span><br><span class="line">â•°â”€# mkdir -p skopeo/library/alpine:latest</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¤åˆ¶é•œåƒçš„ manifest æ–‡ä»¶</span></span><br><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker</span><br><span class="line">â•°â”€# cp /var/lib/registry/docker/registry/v2/blobs/sha256/39/39eda93d15866957feaee28f8fc5adb545276a64147445c64992ef69804dbf01/data skopeo/library/alpine:latest/manifest</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¤åˆ¶é•œåƒçš„ blob æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cp /var/lib/registry/docker/registry/v2/blobs/sha256/f7/f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a/data skopeo/library/alpine:latest/f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cp /var/lib/registry/docker/registry/v2/blobs/sha256/cb/cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08/data skopeo/library/alpine:latest/cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08</span></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå¾—åˆ°çš„é•œåƒæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker</span><br><span class="line">â•°â”€<span class="comment"># tree skopeo/library/alpine:latest</span></span><br><span class="line">skopeo/library/alpine:latest</span><br><span class="line">â”œâ”€â”€ cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08</span><br><span class="line">â”œâ”€â”€ f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span><br><span class="line">â””â”€â”€ manifest</span><br><span class="line"></span><br><span class="line">0 directories, 3 files</span><br></pre></td></tr></table></figure><p>å’Œä¸Šé¢çš„ skopeo copy å‡ºæ¥çš„ dir æ–‡ä»¶å¤¹å¯¹æ¯”ä¸€ä¸‹ï¼Œé™¤äº†ä¸€ä¸ªæ— å…³ç´§è¦çš„ version æ–‡ä»¶ï¼Œå…¶ä»–çš„éƒ½ä¸€æ‘¸ä¸€æ ·ã€‚</p><ol start="5"><li>å†ä¼˜åŒ–ä¸€ä¸‹ï¼Œå°†æ­¥éª¤ 4 ä¸­çš„ cp æ“ä½œä¿®æ”¹æˆç¡¬é“¾æ¥æ“ä½œï¼Œèƒ½æå¤§å‡å°‘ç£ç›˜çš„ IO æ“ä½œã€‚éœ€è¦æ³¨æ„ï¼šç¡¬é“¾æ¥æ–‡ä»¶ä¸èƒ½è·¨åˆ†åŒºï¼Œæ‰€ä»¥è¦å’Œ registry å­˜å‚¨ç›®å½•åœ¨åŒä¸€ä¸ªåˆ†åŒºä¸‹æ‰è¡Œã€‚</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker</span><br><span class="line">â•°â”€# ln /var/lib/registry/docker/registry/v2/blobs/sha256/39/39eda93d15866957feaee28f8fc5adb545276a64147445c64992ef69804dbf01/data skopeo/library/alpine:latest/manifest</span><br><span class="line"><span class="meta">#</span><span class="bash"> ln /var/lib/registry/docker/registry/v2/blobs/sha256/f7/f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a/data skopeo/library/alpine:latest/f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ln /var/lib/registry/docker/registry/v2/blobs/sha256/cb/cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08/data skopeo/library/alpine:latest/cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08</span></span><br><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker</span><br><span class="line">â•°â”€# tree skopeo/library/alpine:latest</span><br><span class="line">skopeo/library/alpine:latest</span><br><span class="line">â”œâ”€â”€ cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08</span><br><span class="line">â”œâ”€â”€ f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span><br><span class="line">â””â”€â”€ manifest</span><br><span class="line"></span><br><span class="line">0 directories, 3 files</span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨ skopeo copy æˆ–è€… skopeo sync å°†æå‡ºæ¥çš„é•œåƒ push åˆ° harbor</p><ul><li>ä½¿ç”¨ skopeo copy</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">skopeo copy  --insecure-policy --src-tls-verify=false --dest-tls-verify=false \</span><br><span class="line">dir:skopeo/library/alpine:latest docker://harbor.k8s.li/library/alpine:latest</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ skopeo sync</li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œskopeo sync çš„æ–¹å¼æ˜¯åŒæ­¥ project çº§åˆ«çš„ï¼Œé•œåƒçš„ name å’Œ tag å°±å¯¹åº”çš„æ˜¯ç›®å½•çš„åç§°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">skopeo sync --insecure-policy --src-tls-verify=false --dest-tls-verify=false \</span><br><span class="line">--src dir --dest docker skopeo/library/ harbor.k8s.li/library/</span><br></pre></td></tr></table></figure><h3 id="å®ç°è„šæœ¬"><a href="#å®ç°è„šæœ¬" class="headerlink" title="å®ç°è„šæœ¬"></a>å®ç°è„šæœ¬</h3><p>å¤§å«ä¸€å£° shell å¤§æ³•å¥½ï¼ğŸ˜‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">REGISTRY_DOMAIN="harbor.k8s.li"</span><br><span class="line">REGISTRY_PATH="/var/lib/registry"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ‡æ¢åˆ° registry å­˜å‚¨ä¸»ç›®å½•ä¸‹</span></span><br><span class="line">cd $&#123;REGISTRY_PATH&#125;</span><br><span class="line"></span><br><span class="line">gen_skopeo_dir() &#123;</span><br><span class="line"><span class="meta">   #</span><span class="bash"> å®šä¹‰ registry å­˜å‚¨çš„ blob ç›®å½• å’Œ repositories ç›®å½•ï¼Œæ–¹ä¾¿åé¢ä½¿ç”¨</span></span><br><span class="line">    BLOB_DIR="docker/registry/v2/blobs/sha256"</span><br><span class="line">    REPO_DIR="docker/registry/v2/repositories"</span><br><span class="line">    # å®šä¹‰ç”Ÿæˆ skopeo ç›®å½•</span><br><span class="line">    SKOPEO_DIR="docker/skopeo"</span><br><span class="line">    # é€šè¿‡ find å‡º current æ–‡ä»¶å¤¹å¯ä»¥å¾—åˆ°æ‰€æœ‰å¸¦ tag çš„é•œåƒï¼Œå› ä¸ºä¸€ä¸ª tag å¯¹åº”ä¸€ä¸ª current ç›®å½•</span><br><span class="line">    for image in $(find $&#123;REPO_DIR&#125; -type d -name "current"); do</span><br><span class="line">        # æ ¹æ®é•œåƒçš„ tag æå–é•œåƒçš„åå­—</span><br><span class="line">        name=$(echo $&#123;image&#125; | awk -F '/' '&#123;print $5"/"$6":"$9&#125;')</span><br><span class="line">        link=$(cat $&#123;image&#125;/link | sed 's/sha256://')</span><br><span class="line">        mfs="$&#123;BLOB_DIR&#125;/$&#123;link:0:2&#125;/$&#123;link&#125;/data"</span><br><span class="line">        # åˆ›å»ºé•œåƒçš„ç¡¬é“¾æ¥éœ€è¦çš„ç›®å½•</span><br><span class="line">        mkdir -p "$&#123;SKOPEO_DIR&#125;/$&#123;name&#125;"</span><br><span class="line">        # ç¡¬é“¾æ¥é•œåƒçš„ manifests æ–‡ä»¶åˆ°ç›®å½•çš„ manifest æ–‡ä»¶</span><br><span class="line">        ln $&#123;mfs&#125; $&#123;SKOPEO_DIR&#125;/$&#123;name&#125;/manifest.json</span><br><span class="line">        # ä½¿ç”¨æ­£åˆ™åŒ¹é…å‡ºæ‰€æœ‰çš„ sha256 å€¼ï¼Œç„¶åæ’åºå»é‡</span><br><span class="line">        layers=$(grep -Eo "\b[a-f0-9]&#123;64&#125;\b" $&#123;mfs&#125; | sort -n | uniq)</span><br><span class="line">        for layer in $&#123;layers&#125;; do</span><br><span class="line">          # ç¡¬é“¾æ¥ registry å­˜å‚¨ç›®å½•é‡Œçš„é•œåƒ layer å’Œ images config åˆ°é•œåƒçš„ dir ç›®å½•</span><br><span class="line">            ln $&#123;BLOB_DIR&#125;/$&#123;layer:0:2&#125;/$&#123;layer&#125;/data $&#123;SKOPEO_DIR&#125;/$&#123;name&#125;/$&#123;layer&#125;</span><br><span class="line">        done</span><br><span class="line">    done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sync_image() &#123;</span><br><span class="line">    # ä½¿ç”¨ skopeo sync å°† dir æ ¼å¼çš„é•œåƒåŒæ­¥åˆ° harbor</span><br><span class="line">    for project in $(ls $&#123;SKOPEO_DIR&#125;); do</span><br><span class="line">        skopeo sync --insecure-policy --src-tls-verify=false --dest-tls-verify=false \</span><br><span class="line">        --src dir --dest docker $&#123;SKOPEO_DIR&#125;/$&#123;project&#125; $&#123;REGISTRY_DOMAIN&#125;/$&#123;project&#125;</span><br><span class="line">    done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gen_skopeo_dir</span><br><span class="line">sync_image</span><br></pre></td></tr></table></figure><p>å…¶å®é­”æ”¹ä¸€ä¸‹ skopeo çš„æºç ä¹Ÿæ˜¯å¯ä»¥æ— ç¼æ”¯æŒ registry å­˜å‚¨ç›®å½•çš„ï¼Œç›®å‰æ­£åœ¨ç ”ç©¶ä¸­ğŸ˜ƒ</p><h2 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h2><table><thead><tr><th></th><th>æ–¹æ³•</th><th>é€‚ç”¨èŒƒå›´</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>ä¸€</td><td>docker retag</td><td>ä¸¤ä¸ª registry ä¹‹é—´åŒæ­¥é•œåƒ</td><td></td></tr><tr><td>äºŒ</td><td>skopeo</td><td>ä¸¤ä¸ª registry ä¹‹é—´åŒæ­¥é•œåƒ</td><td></td></tr><tr><td>ä¸‰</td><td>è§£å‹ç›®å½•</td><td>registry å­˜å‚¨ç›®å½•åˆ°å¦ä¸€ä¸ª registry</td><td>harbor 1.x</td></tr><tr><td>å››</td><td>skopeo dir</td><td>registry å­˜å‚¨ç›®å½•åˆ°å¦ä¸€ä¸ª registry</td><td>é€‚ç”¨äº harbor 2.x</td></tr></tbody></table><p>å¯¹æ¯”æ€»ç»“ä¸€ä¸‹ä»¥ä¸Šå‡ ç§æ–¹æ¡ˆï¼š</p><ul><li>æ–¹æ¡ˆä¸€ï¼šä¸Šæ‰‹æˆæœ¬ä½ï¼Œé€‚ç”¨äºé•œåƒæ•°é‡æ¯”è¾ƒå¤šå°‘ï¼Œæ— éœ€å®‰è£… skopeo çš„æƒ…å†µï¼Œç¼ºç‚¹æ˜¯æ€§èƒ½è¾ƒå·®ï¼›</li><li>æ–¹æ¡ˆäºŒï¼šé€‚ç”¨äºä¸¤ä¸ª registry ä¹‹é—´åŒæ­¥å¤åˆ¶é•œåƒï¼Œå¦‚å°† docker hub ä¸­çš„ä¸€äº›å…¬å…±é•œåƒå¤åˆ¶åˆ°å…¬å¸å†…ç½‘çš„é•œåƒä»“åº“ä¸­ã€‚</li><li>æ–¹æ¡ˆä¸‰ï¼šé€‚ç”¨äºé•œåƒä»“åº“ä¹‹é—´è¿›è¡Œè¿ç§»ï¼Œæ€§èƒ½æ˜¯æ‰€æœ‰æ–¹æ¡ˆé‡Œæœ€å¥½çš„ï¼Œéœ€è¦é¢å¤–æ³¨æ„çš„æ˜¯å¦‚æœç›®çš„é•œåƒä»“åº“æ˜¯ harbor 2.xï¼Œæ˜¯æ— æ³•ä½¿ç”¨è¿™ç§æ–¹å¼çš„ã€‚</li><li>æ–¹æ¡ˆå››ï¼šæ˜¯æ–¹æ¡ˆä¸‰çš„å¦¥åç‰ˆï¼Œä¸ºäº†é€‚é… harbor 2.0 ï¼Œå› ä¸ºéœ€è¦é‡æ–°å°†é•œåƒ push åˆ° harbor ï¼Œæ‰€ä»¥æ€§èƒ½ä¸Šè¦æ¯”æ–¹æ¡ˆä¸‰å·®ä¸€äº›ã€‚</li></ul><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="">ã€Šharboræƒå¨æŒ‡å—</a></li><li><a href="https://goharbor.io/blog/harbor-2.0/" target="_blank" rel="noopener">Harbor 2.0 takes a giant leap in expanding supported artifacts with OCI support</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;Registry&quot;&gt;&lt;a
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="registry" scheme="https://blog.k8s.li/tags/registry/"/>
    
      <category term="harbor" scheme="https://blog.k8s.li/tags/harbor/"/>
    
      <category term="é•œåƒ" scheme="https://blog.k8s.li/tags/%E9%95%9C%E5%83%8F/"/>
    
  </entry>
  
  <entry>
    <title>2020 å¹´è¯»ä¹¦ç¬”è®°å’Œæ€è€ƒ</title>
    <link href="https://blog.k8s.li/2020-booklist.html"/>
    <id>https://blog.k8s.li/2020-booklist.html</id>
    <published>2020-12-30T16:00:00.000Z</published>
    <updated>2021-01-09T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>é¦–å…ˆç»™å„ä½å…³æ³¨æˆ‘åšå®¢çš„å°ä¼™ä¼´è¯´å£°æŠ±æ­‰ï¼Œå·²ç»å¾ˆé•¿æ—¶é—´ï¼ˆå°†è¿‘ 4 ä¸ªæœˆï¼‰æ²¡æœ‰æ›´æ–°åšå®¢äº†ï¼Œå®åœ¨æ˜¯å¯¹ä¸ä½å¤§å®¶ï¼Œè‡ªå·±ä¸€ç›´åœ¨å·æ‡’æ²¡èƒ½åšæŒåˆ›ä½œã€‚2021 å¹´åˆšå¼€å§‹ï¼Œå†³å®šå†³å®šä»¥åè¿˜æ˜¯è¦åšæŒåˆ›ä½œä¸‹å»ï¼Œäºæ˜¯æœ€è¿‘æŠ½å‡ºç‚¹æ—¶é—´æ•´ç†äº†ä¸‹ 2020 å¹´è¯»è¿‡çš„ä¹¦åˆ†äº«ç»™å¤§å®¶ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°å¤§å®¶æ‰¾åˆ°äº›æœ‰æ„æ€çš„ä¹¦æ¥è¯»ã€‚å†…å®¹æœ‰ç‚¹å¤šï¼Œå¤§æ¦‚ 2 ä¸‡å¤šå­—ğŸ™ƒã€‚</p><h2 id="ä¹¦å•"><a href="#ä¹¦å•" class="headerlink" title="ä¹¦å•"></a>ä¹¦å•</h2><p>ç”±äºç–«æƒ…çš„å½±å“ï¼ŒèŠ‚å‡æ—¥å’Œå‘¨æœ«éƒ½ä¸æ€ä¹ˆå‡ºå»ï¼Œä¸€ç›´å®…åœ¨å®¶é‡Œï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†çš„é—²æš‡æ—¶é—´éƒ½æ˜¯æ§ç€ kindle çœ‹ä¼šä¹¦ï¼Œäº¦æˆ–è€…åˆ·ä¸€ä¼š Pixiv å’Œ Twitter æ”¶é›†ä¸€äº›çº¸ç‰‡äººæ’ç”»ï¼Œä¿¨ç„¶æˆäº†ä¸€ä¸ªæ ‡å‡†çš„æ­»è‚¥å®…ã€‚2020 å¹´ä¸€æ•´å¹´ç•™ç»™è‡ªå·±çš„æ—¶é—´æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥æ€»ä½“ä¸Šæ¥è®² 2020 å¹´è¯»è¿‡çš„ä¹¦æ¯” 2019 å¹´å¤šäº†å°†è¿‘ä¸€å€ï¼Œæœ‰å…´è¶£çš„å¯ä»¥ç¿»å¼€ä¸€ä¸‹ 2019 å¹´çš„è¯»ä¹¦æ€»ç»“ <a href="https://blog.k8s.li/2019-reading-notes.html">2019 å¹´è¯»ä¹¦ç¬”è®°å’Œæ€è€ƒ</a> ã€‚ä¸‹é¢çš„è¡¨æ ¼æ˜¯æˆ‘å‚è€ƒ kindle ä¸Šçš„æ ‡æ³¨æ—¶é—´æ•´ç†çš„ 2020 å¹´è¯»å®Œçš„ä¹¦ï¼ˆå…±è®¡ 68 æœ¬ä¹¦ï¼‰ã€‚</p><table><thead><tr><th align="center">ä¹¦å</th><th align="center">ä½œè€…</th><th align="center">start</th><th align="center">end</th><th align="center">æ—¶é•¿</th></tr></thead><tbody><tr><td align="center">è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€</td><td align="center">ã€æ³•ã€‘è®©-é›…å…‹Â·å¢æ¢­</td><td align="center">01-01</td><td align="center">01-05</td><td align="center">6h</td></tr><tr><td align="center">ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ</td><td align="center">ã€å¥¥ã€‘ è·¯å¾·ç»´å¸ŒÂ·å†¯Â·ç±³ç‘Ÿæ–¯</td><td align="center">01-01</td><td align="center">01-10</td><td align="center">10h</td></tr><tr><td align="center">å¿ƒç†æµ‹é‡è€…</td><td align="center">ã€æ—¥ã€‘æ·±çœŸè§</td><td align="center">01-03</td><td align="center">01-05</td><td align="center">6h</td></tr><tr><td align="center">è®ºé©å‘½</td><td align="center">ã€å¾·ã€‘æ±‰å¨œÂ·é˜¿ä¼¦ç‰¹</td><td align="center">01-05</td><td align="center">01-20</td><td align="center">12h</td></tr><tr><td align="center">æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨å’Œåæœ</td><td align="center">å¼ é›ªå¿ </td><td align="center">01-15</td><td align="center">01-20</td><td align="center">4h</td></tr><tr><td align="center">è®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´</td><td align="center">ã€æ³•ã€‘è®©-é›…å…‹Â·å¢æ¢­</td><td align="center">01-21</td><td align="center">01-25</td><td align="center">4h</td></tr><tr><td align="center">åœ°çƒè„‰åŠ¨ï¼šå‰æ‰€æœªè§çš„è‡ªç„¶ä¹‹ç¾</td><td align="center">ã€è‹±ã€‘é˜¿æ‹‰æ–¯æ³°å°”Â·ç¦ç‘Ÿå‰å°”</td><td align="center">01-22</td><td align="center">01-25</td><td align="center">2h</td></tr><tr><td align="center">ç¤¾ä¼šå¥‘çº¦è®º (è¯‘æ—äººæ–‡ç²¾é€‰)</td><td align="center">ã€æ³•ã€‘è®©-é›…å…‹Â·å¢æ¢­</td><td align="center">01-23</td><td align="center">01-25</td><td align="center">4h</td></tr><tr><td align="center">ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶</td><td align="center">å‘¨é›ªå…‰</td><td align="center">01-28</td><td align="center">02-07</td><td align="center">8h</td></tr><tr><td align="center">ç—…æ¯’æ˜Ÿçƒ</td><td align="center">ã€ç¾]ã€‘å°”Â·é½é»˜</td><td align="center">01-28</td><td align="center">01-30</td><td align="center">4h</td></tr><tr><td align="center">ç—…æ¯’æ¥è¢­</td><td align="center">ã€ç¾ã€‘å†…æ£®â€¢æ²ƒå°”å¤«</td><td align="center">01-29</td><td align="center">01-31</td><td align="center">2h</td></tr><tr><td align="center">è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹</td><td align="center">ç†æŸ¥å¾·Â·æ™®é›·æ–¯é¡¿</td><td align="center">02-01</td><td align="center">02-08</td><td align="center">8h</td></tr><tr><td align="center">è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½</td><td align="center">å‘¨å¿—ç‚</td><td align="center">02-05</td><td align="center">05-08</td><td align="center">4h</td></tr><tr><td align="center">å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹</td><td align="center">æœ±æ‰ä¼</td><td align="center">02-06</td><td align="center">02-10</td><td align="center">3h</td></tr><tr><td align="center">ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥</td><td align="center">æœ±é’¦å£«</td><td align="center">02-07</td><td align="center">02-12</td><td align="center">6h</td></tr><tr><td align="center">æœ±é’¦å£«çš„ä¸ªäººåšå®¢</td><td align="center">æœ±é’¦å£«</td><td align="center">02-08</td><td align="center">03-30</td><td align="center">8h</td></tr><tr><td align="center">è¿œå¤çš„è¾‰ç…Œï¼šç”Ÿç‰©å¤§å¹…å°„</td><td align="center">æˆå˜‰ä½™</td><td align="center">02-13</td><td align="center">05-15</td><td align="center">6h</td></tr><tr><td align="center">ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ</td><td align="center">ã€è‹±ã€‘é©¬ä¸Â·é›·å¾·èŠ¬</td><td align="center">02-13</td><td align="center">02-15</td><td align="center">6h</td></tr><tr><td align="center">ç”Ÿå‘½æ´»åŠ¨çš„æ‘‡ç¯®ï¼šç»†èƒ</td><td align="center">ç‹è€€å‘</td><td align="center">02-16</td><td align="center">02-18</td><td align="center">4h</td></tr><tr><td align="center">åœ°çƒè„‰åŠ¨2ï¼šå¥‡è¿¹ä¸–ç•Œ</td><td align="center">ã€è‹±ã€‘èƒ¡Â·ç§‘é‡Œ</td><td align="center">02-24</td><td align="center">02-27</td><td align="center">3h</td></tr><tr><td align="center">ä¸€æƒ³åˆ°è¿˜æœ‰95<em>%çš„</em>é—®é¢˜ç•™ç»™äººç±»ï¼Œæˆ‘å°±æ”¾å¿ƒäº†</td><td align="center">ã€å·´æ‹¿é©¬ã€‘è±ªå°”èµ«â€¢é™ˆ</td><td align="center">03-07</td><td align="center">03-15</td><td align="center">4h</td></tr><tr><td align="center">å†å²çš„ç»ˆç»“åŠæœ€åä¹‹äºº</td><td align="center">ã€ç¾ã€‘å¼—æœ—è¥¿æ–¯Â·ç¦å±±</td><td align="center">03-03</td><td align="center">03-10</td><td align="center">10h</td></tr><tr><td align="center">æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³</td><td align="center">ä½™æ°</td><td align="center">03-13</td><td align="center">03-20</td><td align="center">8h</td></tr><tr><td align="center">ç¥å¥‡çš„ç”Ÿç‰©åŒ–å­¦</td><td align="center">ç¥å¥‡çš„ç”Ÿç‰©åŒ–å­¦</td><td align="center">03-23</td><td align="center">03-25</td><td align="center">4h</td></tr><tr><td align="center">è´¹é©¬æœ€ç»ˆå®šç†</td><td align="center">ã€æ—¥ã€‘æ—¥å†²æ¨±çš®</td><td align="center">03-26</td><td align="center">03-28</td><td align="center">3h</td></tr><tr><td align="center">è¢«è®¨åŒçš„å‹‡æ°”</td><td align="center">ã€æ—¥ã€‘å²¸è¦‹ä¸€éƒ</td><td align="center">03-28</td><td align="center">03-30</td><td align="center">4h</td></tr><tr><td align="center">é¸Ÿç°å¤æ–‡æ˜</td><td align="center">ã€æ³•ã€‘ è®©-å…‹åŠ³å¾·Â·æˆˆå°”ä¸‡</td><td align="center">04-03</td><td align="center">04-10</td><td align="center">8h</td></tr><tr><td align="center">è‡ªç”±å®ªç« </td><td align="center">ã€å¥¥ã€‘å¼—é‡Œå¾·é‡Œå¸ŒÂ·å“ˆè€¶å…‹</td><td align="center">04-01</td><td align="center">04-20</td><td align="center">16h</td></tr><tr><td align="center">ç›—ç«è€…ï¼šä¸­å›½æ•™è‚²é©å‘½é™æ‚„æ‚„</td><td align="center">é‚“åº·å»¶ æ¢ç½—å…´</td><td align="center">04-11</td><td align="center">04-20</td><td align="center">6h</td></tr><tr><td align="center">æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—éŸ©äººæ°‘çš„çœŸå®ç”Ÿæ´»</td><td align="center">ã€ç¾ã€‘èŠ­èŠ­æ‹‰Â·å¾·ç±³å…‹</td><td align="center">04-23</td><td align="center">04-26</td><td align="center">6h</td></tr><tr><td align="center">å“ˆç»´å°”æ–‡é›†</td><td align="center">ã€æ·å…‹ã€‘å“ˆç»´å°”</td><td align="center">04-24</td><td align="center">04-30</td><td align="center">8h</td></tr><tr><td align="center">å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ</td><td align="center">ã€ç¾ã€‘ å¡è’‚Â·é©¬é¡¿</td><td align="center">04-26</td><td align="center">04-30</td><td align="center">6h</td></tr><tr><td align="center">è‡´å‘½çš„è‡ªè´Ÿï¼šç¤¾ä¼šä¸»ä¹‰çš„è°¬è¯¯</td><td align="center">ã€å¥¥ã€‘å¼—é‡Œå¾·é‡Œå¸ŒÂ·å“ˆè€¶å…‹</td><td align="center">05-01</td><td align="center">05-30</td><td align="center">10h</td></tr><tr><td align="center">åœ°çƒçš„æ¼”å˜æ•…äº‹</td><td align="center">å§šå»ºæ˜</td><td align="center">05-02</td><td align="center">05-05</td><td align="center">4h</td></tr><tr><td align="center">å›¾è§£ç§‘æŠ€è¯‘ä¸›ï¼šæ¼«ç”»å…ƒç´ 118</td><td align="center">ã€æ—¥ã€‘æ–‹è…¾èƒœè£•</td><td align="center">05-02</td><td align="center">05-03</td><td align="center">2h</td></tr><tr><td align="center">é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–</td><td align="center">å¾è´²</td><td align="center">05-02</td><td align="center">05-10</td><td align="center">4h</td></tr><tr><td align="center">ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘</td><td align="center">å¾è´²</td><td align="center">05-03</td><td align="center">05-25</td><td align="center">8h</td></tr><tr><td align="center">ä¸‰è§’è·ç¦»æ— é™ä¸ºé›¶1-4</td><td align="center">ã€æ—¥ã€‘å²¬é¹­å®«</td><td align="center">05-05</td><td align="center">05-25</td><td align="center">10h</td></tr><tr><td align="center">è¢«ç¦é”¢çš„å¤´è„‘</td><td align="center">ã€ç«‹ã€‘åˆ‡æ–¯ç“¦å¤«Â·ç±³æ²ƒä»€</td><td align="center">05-05</td><td align="center">05-10</td><td align="center">6h</td></tr><tr><td align="center">äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†</td><td align="center">å¾è´²</td><td align="center">05-02</td><td align="center">05-10</td><td align="center">10h</td></tr><tr><td align="center">å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾</td><td align="center">ã€è‹±ã€‘å¸ƒè±æ©â€¢è€ƒå…‹æ–¯</td><td align="center">05-25</td><td align="center">05-30</td><td align="center">5h</td></tr><tr><td align="center">é€šå¾€å°Šä¸¥çš„å…¬å…±ç”Ÿæ´»</td><td align="center">å¾è´²</td><td align="center">05-25</td><td align="center">05-30</td><td align="center">10h</td></tr><tr><td align="center">å®‡å®™ä»èµ·æºåˆ°æœªæ¥</td><td align="center">ã€ç¾ã€‘çº¦ç¿°Â·å¸ƒç½—å…‹æ›¼</td><td align="center">06-18</td><td align="center">06-25</td><td align="center">5h</td></tr><tr><td align="center">kubernetes ç½‘ç»œæƒå¨æŒ‡å—</td><td align="center">æœå†›</td><td align="center">06-20</td><td align="center">06-27</td><td align="center">6h</td></tr><tr><td align="center">Linuxå¼€æºç½‘ç»œå…¨æ ˆè¯¦è§£ï¼šä»DPDKåˆ°OpenFlow</td><td align="center">è‹±ç‰¹å°”äºšå¤ªç ”å‘æœ‰é™å…¬å¸</td><td align="center">06-20</td><td align="center">06-23</td><td align="center">3h</td></tr><tr><td align="center">å¤§è¯å¤„ç†å™¨</td><td align="center">ä¸‡æœ¨æ¨</td><td align="center">06-21</td><td align="center">06-21</td><td align="center">2h</td></tr><tr><td align="center">ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶5</td><td align="center">ã€æ—¥ã€‘å²¬é¹­å®«</td><td align="center">06-24</td><td align="center">06-25</td><td align="center">2.5h</td></tr><tr><td align="center">å¤§è¯å­˜å‚¨</td><td align="center">å¼ å†¬</td><td align="center">06-27</td><td align="center">07-21</td><td align="center">18h</td></tr><tr><td align="center">å¸ƒæ‹‰æ ¼ç²¾ç¥</td><td align="center">ã€æ·ã€‘ä¼Šå‡¡Â·å…‹é‡Œç›</td><td align="center">07-01</td><td align="center">07-10</td><td align="center">6h</td></tr><tr><td align="center">å¾è´²æ–‡é›†</td><td align="center">å¾è´²</td><td align="center">07-10</td><td align="center">07-30</td><td align="center">30h</td></tr><tr><td align="center">ç”Ÿå‘½é€šå²</td><td align="center">æœ±é’¦å£«</td><td align="center">04-10</td><td align="center">08-20</td><td align="center">60h</td></tr><tr><td align="center">Kubernetes æºç å‰–æ</td><td align="center">éƒ‘ä¸œæ—­</td><td align="center">08-01</td><td align="center">08-10</td><td align="center">10h</td></tr><tr><td align="center">Kubernetes æŒ‡å—ç¬¬å››ç‰ˆ</td><td align="center">é¾šæ­£ï¼Œå´æ²»è¾‰ï¼Œå´”ç§€é¾™</td><td align="center">08-10</td><td align="center">08-30</td><td align="center">8h</td></tr><tr><td align="center">åª’ä»‹æ‰¹åˆ¤ä¸‰éƒ¨æ›²</td><td align="center">ã€ç¾ã€‘å°¼å°”Â·æ³¢å…¹æ›¼</td><td align="center">09-01</td><td align="center">09-30</td><td align="center">20h</td></tr><tr><td align="center">æ—¶å…‰æ²™æ¼</td><td align="center">ã€æ—¥ã€‘ã•ã¨(</td><td align="center">09-13</td><td align="center">09-13</td><td align="center">1h</td></tr><tr><td align="center">Just Because!</td><td align="center">ã€æ—¥ã€‘é¸­å¿—ç”°ä¸€</td><td align="center">09-13</td><td align="center">09-14</td><td align="center">4h</td></tr><tr><td align="center">æˆ‘çš„é’æ˜¥æˆ€æ„›ç‰©èªæœç„¶æœ‰å•é¡Œ</td><td align="center">ã€æ—¥ã€‘æ¸¡èˆª</td><td align="center">09-15</td><td align="center">09-30</td><td align="center">30h</td></tr><tr><td align="center">kubernetes æºç åˆ†æ</td><td align="center">éƒ‘ä¸œæ—­</td><td align="center">10-01</td><td align="center">10-07</td><td align="center">15h</td></tr><tr><td align="center">å®‰è¾¾ä¸å²›æ‘ 1-8</td><td align="center">ã€æ—¥ã€‘å…¥é—´äººé—´</td><td align="center">11-15</td><td align="center">11-20</td><td align="center">20h</td></tr><tr><td align="center">å¤æ‚ç”Ÿå‘½çš„èµ·æº</td><td align="center">ã€è‹±ã€‘ å°¼å…‹Â·è±æ©</td><td align="center">11-30</td><td align="center">12-07</td><td align="center">15h</td></tr><tr><td align="center">æ¥è‡ªæ–°ä¸–ç•Œ</td><td align="center">ã€æ—¥ã€‘è´µå¿—ç¥ä»‹</td><td align="center">11-30</td><td align="center">12-10</td><td align="center">20h</td></tr><tr><td align="center">æ”¿å®—å›çš„å¾©ä»‡</td><td align="center">ã€æ—¥ã€‘ç«¹å†ˆå¶æœˆ</td><td align="center">12-05</td><td align="center">12-07</td><td align="center">6h</td></tr><tr><td align="center">æ˜Ÿé™…ç©¿è¶Š</td><td align="center">ã€ç¾ã€‘åŸºæ™®Â·ç´¢æ©</td><td align="center">12-10</td><td align="center">12-12</td><td align="center">4h</td></tr><tr><td align="center">Life ç”Ÿå‘½</td><td align="center">ã€ç¾ã€‘çº¦ç¿°Â·å¸ƒç½—å…‹æ›¼</td><td align="center">12-12</td><td align="center">12-23</td><td align="center">8h</td></tr><tr><td align="center">ç¾ä¸½æ–°ä¸–ç•Œ</td><td align="center">ã€è‹±ã€‘é˜¿é“å¸Â·èµ«èƒ¥é»</td><td align="center">12-14</td><td align="center">12-18</td><td align="center">8h</td></tr><tr><td align="center">æ¨±èŠ±åº„çš„å® ç‰©å¥³å­©</td><td align="center">ã€æ—¥ã€‘é¸­å¿—ç”°ä¸€</td><td align="center">12-13</td><td align="center">12-21</td><td align="center">36h</td></tr><tr><td align="center">ç”Ÿå‘½çš„è·ƒå‡</td><td align="center">ã€è‹±]ã€‘å°¼å…‹Â·è±æ©</td><td align="center">12-22</td><td align="center">12-26</td><td align="center">8h</td></tr><tr><td align="center">æ¶ˆå¤±çš„å¾®ç”Ÿç‰©ï¼šæ»¥ç”¨æŠ—ç”Ÿç´ å¼•å‘çš„å±æœº</td><td align="center">ã€ç¾ã€‘é©¬ä¸â€¢å¸ƒè±æ³½</td><td align="center">12-28</td><td align="center">01-02</td><td align="center">8h</td></tr></tbody></table><h2 id="æ¨è"><a href="#æ¨è" class="headerlink" title="æ¨è"></a>æ¨è</h2><ul><li>ç¤¾ä¼šå¥‘çº¦è®º</li><li>è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€</li><li>è®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´</li><li>è‡´å‘½çš„è‡ªè´Ÿï¼šç¤¾ä¼šä¸»ä¹‰çš„è°¬è¯¯</li><li>ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ</li><li>ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶</li><li>æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—éŸ©äººæ°‘çš„çœŸå®ç”Ÿæ´»</li><li>å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ</li><li>è¢«è®¨åŒçš„å‹‡æ°”</li><li>é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–</li><li>ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘</li><li>äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†</li><li>é€šå¾€å°Šä¸¥çš„å…¬å…±ç”Ÿæ´»</li><li>å¸ƒæ‹‰æ ¼ç²¾ç¥</li><li>å¾è´²æ–‡é›†</li><li>ç”Ÿå‘½é€šå²</li><li>å¤æ‚ç”Ÿå‘½çš„èµ·æº</li><li>ç”Ÿå‘½çš„è·ƒå‡</li><li>æ¥è‡ªæ–°ä¸–ç•Œ</li></ul><h2 id="æ”¿æ²»-å“²å­¦"><a href="#æ”¿æ²»-å“²å­¦" class="headerlink" title="æ”¿æ²»/å“²å­¦"></a>æ”¿æ²»/å“²å­¦</h2><h3 id="ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ"><a href="#ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ" class="headerlink" title="ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ"></a>ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ</h3><p>è¿™æœ¬ä¹¦æ˜¯ 2020 å¹´è¯»çš„ç¬¬ä¸€æœ¬ä¹¦ï¼Œè¿™æœ¬ä¹¦å¯ä»¥å’Œå“ˆè€¶å…‹çš„ã€Šé€šå¾€å¥´å½¹ä¹‹è·¯ã€‹ç»“åˆç€è¯»ã€‚æœ¬ä¹¦å‡ºç‰ˆäº 1922 å¹´ï¼Œåˆ†åˆ«ä»å¤šä¸ªé¢†åŸŸï¼ˆæ”¿æ²»ã€ç»æµã€æ–‡åŒ–ã€ä¼¦ç†ã€å®—æ•™â€¦ï¼‰è®ºè¿°äº†ç¤¾ä¼šä¸»ä¹‰å¿…å®šå¤±è´¥çš„æ‚²æƒ¨ç»“å±€ï¼Œå¯¹å½“æ—¶çš„ç¤¾ä¼šå°¤å…¶é’å¹´å­¦ç”Ÿæ¥è®²å†²å‡»ç›¸å½“çš„å¤§ï¼Œé‚£æ—¶å€™ CCP åˆšåˆšæˆç«‹æ‰ 1 å¹´å“¦ã€‚</p><p>å…ˆè¯´ä¸€ä¸‹ä½œè€…ï¼Œè·¯å¾·ç»´å¸ŒÂ·å†¯Â·ç±³å¡æ–¯ä½œä¸ºâ€œ<a href="https://zh.wikipedia.org/wiki/å¥§åœ°åˆ©ç¶“æ¿Ÿå­¸æ´¾" target="_blank" rel="noopener">å¥¥åœ°åˆ©ç»æµå­¦æ´¾</a>çš„é™¢é•¿â€ï¼Œç°ä»£<a href="https://zh.wikipedia.org/wiki/è‡ªç”±æ„å¿—ä¸»ç¾©" target="_blank" rel="noopener">è‡ªç”±æ„å¿—ä¸»ä¹‰</a>è¿åŠ¨çš„ä¸»è¦é¢†å¯¼äººï¼Œä¹Ÿæ˜¯<a href="https://zh.wikipedia.org/wiki/å¤å…¸è‡ªç”±ä¸»ç¾©" target="_blank" rel="noopener">å¤å…¸è‡ªç”±ä¸»ä¹‰</a>ç¬¬ä¸€æŠŠäº¤æ¤…ï¼Œå…¶å½±å“åŠ›ä¸è¨€è€Œå–»ã€‚ä»–çš„å­¦ç”Ÿæ›´æ˜¯é’å‡ºäºè“èƒœäºè“ï¼šå¼—é‡Œå¾·é‡Œå¸ŒÂ·å†¯Â·å“ˆè€¶å…‹ã€å¼—é‡ŒèŒ¨Â·é©¬å…‹å¢æ™®ã€æˆˆç‰¹å¼—é‡Œå¾·Â·å†¯Â·å“ˆä¼¯å‹’ã€å¥¥æ–¯å¡Â·æ‘©æ ¹æ–¯å¦ã€å¨å»‰Â·å‹’æ™®å…‹ã€ç†æŸ¥å¾·Â·å†¯Â·æ–½ç‰¹é‡Œæˆˆå°”ã€è‰¾å°”å¼—é›·å¾·Â·èˆ’èŒ¨ã€è´¹é‡Œå…‹æ–¯Â·è€ƒå¤«æ›¼ã€åŸƒé‡Œå…‹Â·æ²ƒæ ¼æ—ã€æ ¼å¥¥å°”æ ¼Â·å“ˆå°”å§†ã€ä¿ç½—Â·ç½—æ£®æ–¯å¦-ç½—ä¸¹ã€è±æ˜‚å†…å°”Â·ç½—å®¾æ–¯ã€‚åœ¨ä»–çš„å­¦ç”Ÿå½“ä¸­ï¼Œå“ˆè€¶å…‹è·è¯ºè´å°”ç»æµå­¦å¥–ï¼Œå¼—é‡ŒèŒ¨Â·é©¬å…‹å¢æ™®ã€æˆˆç‰¹å¼—é‡Œå¾·Â·å†¯Â·å“ˆä¼¯å‹’æ›¾å…ˆåä»»ç¾å›½ç»æµå­¦ä¼šä¼šé•¿ã€‚</p><blockquote><p>æˆ‘ä»¬æ„Ÿåˆ°ï¼Œæˆ‘ä»¬æˆé•¿äºå…¶ä¸­çš„é‚£ä¸ªæ–‡æ˜å·²ç»å´©æºƒã€‚æˆ‘ä»¬ç«‹å¿—å»ºè®¾ä¸€ä¸ªæ›´ç¾å¥½çš„ä¸–ç•Œï¼Œè€Œæ­£æ˜¯è¿™ç§å†é€ ç¤¾ä¼šçš„æ¸´æœ›ï¼Œé­ç­–æˆ‘ä»¬æŠ•èº«ç»æµå­¦ç ”ç©¶ã€‚ç¤¾ä¼šä¸»ä¹‰è®¸è¯ºç»™æˆ‘ä»¬ä¸€ä¸ªæ›´åŠ ç†æ€§ã€æ›´åŠ å…¬æ­£çš„ä¸–ç•Œã€‚æ­¤æ—¶ï¼Œã€Šç¤¾ä¼šä¸»ä¹‰ã€‹é—®ä¸–äº†ï¼Œæˆ‘ä»¬çš„ä¿¡å¿µåå¡Œäº†ã€‚ã€Šç¤¾ä¼šä¸»ä¹‰ã€‹å¯¹æˆ‘ä»¬è¯´ï¼Œæˆ‘ä»¬çš„æ–¹å‘é”™äº†ã€‚</p></blockquote><p><code>æ‘˜æŠ„</code> <a href="https://t.co/mSj0qay7jW" target="_blank" rel="noopener">ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ</a></p><blockquote><p>ç±³å¡æ–¯åœ¨ä¹¦ä¸­åˆ†åˆ«ä»å¤šä¸ªé¢†åŸŸï¼ˆæ”¿æ²»ã€ç»æµã€æ–‡åŒ–ã€ä¼¦ç†ã€å®—æ•™â€¦ï¼‰å¯¹ã€å„ç§æµæ´¾ã€‘çš„ç¤¾ä¼šä¸»ä¹‰è¿›è¡ŒçŒ›çƒˆæ‰¹åˆ¤ã€‚å…¶æŠ¨å‡»çš„ç«åŠ›ä¹‹çŒ›ï¼Œå®å±ç½•è§ã€‚</p></blockquote><p>å¦å¤–æ¨èè¯»ä¸€ä¸‹ <a href="https://program-think.blogspot.com/2018/09/Book-Review-The-Errors-of-Marxism-Leninism.html" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆé©¬å…‹æ€æ˜¯é”™çš„ï¼Ÿâ€”â€”å…¨é¢æ‰¹åˆ¤é©¬åˆ—ä¸»ä¹‰çš„çŸ¥åè‘—ä½œå¯¼è¯»</a> ã€‚</p><blockquote><p>ä½œè€…<a href="https://zh.wikipedia.org/wiki/è·¯å¾·ç¶­å¸ŒÂ·é¦®Â·ç±³å¡æ–¯" target="_blank" rel="noopener">è·¯å¾·ç»´å¸ŒÂ·å†¯Â·ç±³å¡æ–¯</a>æ˜¯å¥¥åœ°åˆ©å­¦æ´¾çš„å¹²å°†ï¼Œå¹¶å¯¹åŒä¸€å­¦æ´¾çš„å“ˆè€¶å…‹æœ‰é‡å¤§å½±å“ã€‚åœ¨å“ˆè€¶å…‹çš„å¾ˆå¤šè‘—ä½œå’Œç†è®ºä¸­ï¼Œéƒ½å¯ä»¥çœ‹åˆ°ç±³å¡æ–¯çš„å½±å­ã€‚<br>ã€€ã€€ç±³å¡æ–¯çš„æˆå°±é•¿æœŸè¢«å­¦æœ¯ç•Œå¿½è§†ï¼ˆç”šè‡³æ˜¯æ’æ–¥ï¼‰ã€‚ä¸€æ–¹é¢æ˜¯ä»–çš„ç†è®ºå¤ªè¶…å‰ï¼Œå¦ä¸€æ–¹é¢æ˜¯ä»–çš„æ€§æ ¼å¤ªæ¿€çƒˆâ€”â€”ä¸äººäº¤æµæ—¶æ€»æ˜¯ä¸€é’ˆè§è¡€ï¼Œä¸ç•™æƒ…é¢ï¼Œæ¯«ä¸é¡¾å¿Œä»–äººæ„Ÿå—ã€‚<br>ã€€ã€€è¯´åˆ°ã€è¶…å‰æ€§ã€‘ï¼Œä»–å¯èƒ½æ˜¯ç»æµå­¦ç•Œæœ€æ—©æ„è¯†åˆ°â€œã€åšå¼ˆè®ºã€‘é‡è¦æ€§â€çš„é‚£ä¸ªäººï¼ˆæ—¶é—´æ˜¯20ä¸–çºªåˆæœŸï¼‰ã€‚å‡ åå¹´åï¼Œä¸å†¯Â·è¯ºä¾æ›¼å…±åŒå‘è¡¨åˆ’æ—¶ä»£è®ºæ–‡ã€Šåšå¼ˆè®ºä¸ç»æµè¡Œä¸ºã€‹çš„é‚£ä¸ªæ‘©æ ¹æ–¯å¦ï¼ˆå‰é¢ä¿ºæè¿‡æ­¤äººï¼‰ï¼Œå°±æ˜¯ç±³å¡æ–¯çš„å­¦ç”Ÿã€‚</p></blockquote><h3 id="è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€"><a href="#è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€" class="headerlink" title="è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€"></a>è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€</h3><p>è¿™æœ¬ä¹¦æ˜¯æˆ‘åœ¨çœ‹ã€Šå¿ƒç†æµ‹é‡è€…ã€‹åŠ¨ç”»çš„æ—¶å€™æåˆ°çš„ï¼Œåœ¨çœ‹å°è¯´çš„æ—¶å€™ä¹Ÿè§åˆ°è¿‡ã€‚äºæ˜¯å°±æ‹¿æ¥è¯»äº†ä¸€ä¸‹ï¼Œ<code>Kindle Unlimited</code>  çš„ä¼šå‘˜å¯ä»¥åœ¨ Amazon å•†åº—å…è´¹å€Ÿé˜…åˆ°ã€‚</p><p>ã€Šè®ºäººç±»ä¸å¹³ç­‰èµ·æºå’ŒåŸºç¡€ã€‹æ˜¯å¢æ¢­åº”æ³•å›½ç¬¬æˆç§‘å­¦é™¢çš„å¾æ–‡è€Œæ’°å†™çš„ç¬¬äºŒè®ºæ–‡ï¼Œç¬¬ä¸€ç¯‡è®ºæ–‡æ˜¯ã€Šè®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´ã€‹ã€‚åœ¨æœ¬ä¹¦ä¸­ï¼Œå¢æ¢­é˜å‘äº†è‡ªèº«çš„æ”¿æ²»å“²å­¦ï¼Œä¸ºã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹çš„å†™ä½œå¥ å®šäº†åŸºç¡€ã€‚å¢æ¢­å°†äººç±»å†å²çš„å‘å±•è¿‡ç¨‹è§†ä½œè¿›æ­¥ä¸é€€åŒ–çš„çŸ›ç›¾ç»Ÿä¸€ä½“ã€‚ä»–ä¸€æ–¹é¢å€ŸåŠ©å½“æ—¶æœ‰å…³è‡ªç„¶çŠ¶æ€ä¸‹äººçš„äººç±»å­¦ææ–™ï¼Œä¸€æ–¹é¢å±•å¼€è¾©è¯çš„æƒ³è±¡ï¼Œå›é¡¾äº†äººç±»ç”±è‡ªç„¶çŠ¶æ€å‘ç¤¾ä¼šçŠ¶æ€è¿‡æ¸¡çš„å†å²è¿›ç¨‹ï¼ŒæŒ‡å‡ºäººç±»çš„è¿›æ­¥å²åŒæ—¶ä¹Ÿæ˜¯äººç±»çš„å •è½å²ï¼Œå› ä¸ºäººç±»æ¯å‘å‰å‘å±•ä¸€æ­¥ï¼Œä¸å¹³ç­‰çš„ç¨‹åº¦å³åŠ æ·±ä¸€æ­¥ã€‚è€Œç§æœ‰åˆ¶çš„ç¡®ç«‹ï¼Œæ˜¯é€ æˆäººç±»ä¸å¹³ç­‰åŠå…¶åæœçš„å…³é”®ç¯èŠ‚ã€‚</p><p>æ­£æ˜¯è¿™æ ·çš„å‡è®¾ï¼Œä½¿äººä»¬å¾—ä»¥æ˜ç™½â€œæˆ‘ä»¬å¹¶éç”Ÿæ¥å¦‚æ­¤â€ï¼Œåªæ˜¯â€œå·²ç„¶å¦‚æ­¤â€ã€‚æ—¢ç„¶å¤„äºè‡ªç„¶çŠ¶æ€ä¸‹çš„äººç±»åªæ˜¯ä¸€ä¸ªæŠ½è±¡åŒ–çš„å½¢è±¡ï¼Œå³ä¸€ç§â€œæ— â€çš„å¢ƒç•Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å½“ç„¶ä¸èƒ½è¯´å¢æ¢­çš„ç›®çš„æ˜¯è®©äººç±»å›åˆ°è¿™ä¸ªæœ¬å°±ä¸å­˜åœ¨çš„å½¢è±¡äº†ã€‚ä»–åªæ˜¯ä¼å›¾ä»¥è¿™ä¸ªâ€œæ— â€çš„å¢ƒç•Œä¸ºèµ·ç‚¹ï¼Œå‘äººä»¬å±•ç¤ºå‡ºäººç±»æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥å˜æˆç°åœ¨çš„æ ·å­ï¼Œä»è€Œè¿›ä¸€æ­¥æ€è€ƒï¼Œè¦æƒ³æ‘†è„±ç°åœ¨çš„å›°å¢ƒï¼Œæˆ‘ä»¬æ‰€éœ€è¦åšå‡ºçš„åŠªåŠ›ã€‚æœ¬æ–‡ä¸ºæˆ‘ä»¬æä¾›çš„åæ€å°±åƒé‚£é«˜é€Ÿè·¯ä¸Šçš„ç¼“å†²å¸¦ï¼Œåªæœ‰åœç•™åœ¨ç¼“å†²å¸¦ä¸Šçš„é‚£ä¸€ç§’é’Ÿï¼Œäººç±»æ‰ç»ˆäºçœŸæ­£åœ°æ€è€ƒã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/oTmpnrHLKS" target="_blank" rel="noopener">è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€</a></p><h3 id="è®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´"><a href="#è®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´" class="headerlink" title="è®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´"></a>è®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´</h3><p><code>æ‘˜æŠ„</code> <a href="https://t.co/Vsq6Lc1FeW" target="_blank" rel="noopener">è®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´</a></p><h3 id="ç¤¾ä¼šå¥‘çº¦è®º"><a href="#ç¤¾ä¼šå¥‘çº¦è®º" class="headerlink" title="ç¤¾ä¼šå¥‘çº¦è®º"></a>ç¤¾ä¼šå¥‘çº¦è®º</h3><p>æŒ‰ç…§å¢æ¢­çš„ç¬¬ä¸€ç¯‡è®ºæ–‡ã€Šè®ºç§‘å­¦ä¸è‰ºæœ¯çš„å¤å…´æ˜¯å¦æœ‰åŠ©äºä½¿é£ä¿—æ—¥è¶‹çº¯æœ´ã€‹å’Œç¬¬äºŒç¯‡è®ºæ–‡ã€Šè®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€ ã€‹çš„åˆ†æï¼Œäººæœ¬æ¥æ˜¯çº¯æœ´å–„è‰¯çš„ï¼Œç”±äºæœ‰ç¼ºé™·çš„ç¤¾ä¼šåˆ¶åº¦ï¼Œç”Ÿæ´»äºç¤¾ä¼šä¸­çš„äººæ‰å˜åï¼Œå¹¶å •å…¥ç½ªæ¶çš„æ·±æ¸Šã€‚ç”±æ–‡æ˜å¼•å‘çš„é—®é¢˜å¿…é¡»é€šè¿‡æ–°çš„æ”¿æ²»ç»„ç»‡å½¢å¼æ¥åŠ ä»¥å…‹æœã€‚ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹è¦åšçš„å·¥ä½œæ˜¯ï¼Œé€šè¿‡å»ºç«‹ä¸€ä¸ªå¥å…¨çš„ç¤¾ä¼šæ”¿æ²»åˆ¶åº¦ï¼Œå¸®åŠ©äººä»¬æ¢å¤è‡ªç„¶è‰¯å–„ï¼ˆnatural goodnessï¼‰ã€‚</p><p>ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåˆæ³•çš„å›½å®¶å¿…é¡»æ ¹æ®æ™®éæ„å¿—æ¥è¿›è¡Œç®¡ç†ã€‚æƒ³è¦è¯»æ‡‚è¿™æœ¬ä¹¦è¿˜éœ€è¦è¯»å¢æ¢­çš„å¦å¤–ä¸¤ç¯‡è®ºæ–‡ï¼Œç¬¬ä¸€è®ºæ–‡ï¼ˆã€Šè®ºè‰ºæœ¯ä¸ç§‘å­¦ã€‹ï¼‰å’Œç¬¬äºŒè®ºæ–‡è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€ã€‹ï¼Œå¢æ¢­ä¸»è¦æ€è€ƒçš„æ˜¯æ–‡æ˜ç¤¾ä¼šä¸­ç§ç§ç½ªæ¶ä¸ä¸å¹¸ï¼Œå¹¶è§£é‡Šå®ƒä»¬çš„èµ·æºï¼›é‚£ä¹ˆï¼Œä»ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹å¼€å§‹ï¼Œå¢æ¢­åˆ™è‡´åŠ›äºæ€è€ƒå¦‚ä½•æ”¹å˜è¿™ç§çŠ¶å†µã€‚</p><p>ä»€ä¹ˆæ ·çš„ç¤¾ä¼šæ”¿æ²»åˆ¶åº¦æ‰æ˜¯å¥å…¨çš„å‘¢ï¼Ÿè¿™å°±è¦è¿½é—®ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜ï¼šæ­£ä¹‰ä¸åˆæ³•çš„æ”¿æ²»ç§©åºåŠå…¶åŸºç¡€æ˜¯ä»€ä¹ˆï¼Ÿã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹æ‰€æœ‰å…¶ä»–çš„é—®é¢˜å‡æ˜¯ä»è¿™é‡Œç”Ÿå‘å‡ºæ¥ï¼Œå¹¶ä¸ä¹‹å…³è”åœ¨ä¸€èµ·çš„ã€‚ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹å…±æœ‰å››å·ï¼Œç¬¬ä¸€å·è®¨è®ºçš„æ˜¯åˆæ³•çš„æ”¿æ²»ç§©åºçš„åŸºç¡€ï¼›ç¬¬äºŒå·è®¨è®ºçš„ä¸»é¢˜æ˜¯æ³•å¾‹å’Œç«‹æ³•ï¼›ç¬¬ä¸‰å·çš„ä¸»é¢˜æ˜¯æ™®éæ„å¿—è¿ç”¨äºç‰¹å®šæƒ…å½¢å³æ”¿åºœçš„æœºåˆ¶ï¼›ç¬¬å››å·ï¼Œè¿™ä¸€å·ä»¥å¯¹ç½—é©¬çš„æ”¿æ²»åˆ¶åº¦çš„æè¿°ä¸ºæ ¸å¿ƒå†…å®¹ï¼Œä»¥æ­¤æ¥æ¢è®¨æ”¿æ²»å…±åŒä½“çš„å‡èšåŠ›é—®é¢˜ï¼Œæœ€åä»¥å…¬æ°‘å®—æ•™ç»“æŸå…¨ä¹¦ã€‚</p><p>ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯<strong>åˆæ³•çš„å›½å®¶å¿…é¡»æ ¹æ®æ™®éæ„å¿—æ¥è¿›è¡Œç®¡ç†ï¼Œå³å·²æå‡º</strong>ã€‚ã€Šçˆ±å¼¥å„¿ã€‹èƒŒåçš„ä¸€ä¸ªåŸºæœ¬é¢„è®¾æ˜¯ï¼šæ²¡æœ‰æ–‡åŒ–åšæ”¯æ’‘ï¼Œåˆ¶åº¦æ˜¯æ²¡æœ‰åŠæ³•æœ‰æ•ˆè¿è¡Œçš„ã€‚å› æ­¤ï¼Œæœ€é‡è¦çš„ä»»åŠ¡æ˜¯ï¼šé€šè¿‡æ•™è‚²ï¼Œå°†â€œäººâ€è½¬å˜ä¸ºâ€œå…¬æ°‘â€ï¼Œåƒçˆ±å¼¥å„¿ä¸€æ ·çš„å…¬æ°‘ã€‚å”¯å…¶å¦‚æ­¤ï¼Œæ™®éæ„å¿—æ‰æœ‰å¯èƒ½ï¼Œæ­£ä¹‰è€Œåˆæ³•çš„æ”¿æ²»ç§©åºæ‰æœ‰å¯èƒ½ã€‚</p><p>æŒ‰ç…§ç¬¬ä¸€è®ºæ–‡å’Œç¬¬äºŒè®ºæ–‡çš„åˆ†æï¼Œäººæœ¬æ¥æ˜¯çº¯æœ´å–„è‰¯çš„ï¼Œç”±äºæœ‰ç¼ºé™·çš„ç¤¾ä¼šåˆ¶åº¦ï¼Œç”Ÿæ´»äºç¤¾ä¼šä¸­çš„äººæ‰å˜åï¼Œå¹¶å •å…¥ç½ªæ¶çš„æ·±æ¸Šã€‚ç”±æ–‡æ˜å¼•å‘çš„é—®é¢˜å¿…é¡»é€šè¿‡æ–°çš„æ”¿æ²»ç»„ç»‡å½¢å¼æ¥åŠ ä»¥å…‹æœã€‚ã€Šç¤¾ä¼šå¥‘çº¦è®ºã€‹è¦åšçš„å·¥ä½œæ˜¯ï¼Œ<strong>é€šè¿‡å»ºç«‹ä¸€ä¸ªå¥å…¨çš„ç¤¾ä¼šæ”¿æ²»åˆ¶åº¦ï¼Œå¸®åŠ©äººä»¬æ¢å¤è‡ªç„¶è‰¯å–„ã€‚</strong> æ‰¾åˆ°ä¸€ç§ç»“åˆå½¢å¼ï¼Œå‡­å€Ÿå®ƒå¯ä»¥è¿ç”¨æ‰€æœ‰å…±åŒçš„åŠ›é‡æ¥æå«å’Œä¿æŠ¤æ¯ä¸ªç»“åˆè€…çš„äººèº«å’Œè´¢äº§ï¼Œè¿™ç§å½¢å¼ä½¿å¾—æ¯ä¸ªç»“åˆè€…è™½ç„¶ä¸æ‰€æœ‰äººç»“åˆåœ¨ä¸€èµ·ï¼Œä½†æ˜¯åªæœä»è‡ªå·±ï¼Œå¹¶ä¸”ä¸€å¦‚æ—¢å¾€åœ°è‡ªç”±ã€‚â€è¿™å°±æ˜¯ç¤¾ä¼šå¥‘çº¦æ‰€è¦è§£å†³çš„æ ¹æœ¬æ€§é—®é¢˜ã€‚ç¤¾ä¼šå¥‘çº¦å¯ä»¥ç®€åŒ–ä¸ºå¦‚ä¸‹è¯å¥ï¼š<strong>æˆ‘ä»¬ä¸­çš„æ¯ä¸ªäººå°†å…¶è‡ªèº«åŠå…¶æ‰€æœ‰çš„åŠ›é‡å…±åŒç½®äºæ™®éæ„å¿—çš„æœ€é«˜é¢†å¯¼ä¹‹ä¸‹ï¼Œè€Œå°†æ¯ä¸ªæˆå‘˜ä½œä¸ºæ•´ä½“ä¸å¯åˆ†å‰²çš„éƒ¨åˆ†çº³å…¥æ•´ä½“ã€‚</strong> åœ¨ã€Šçˆ±å¼¥å„¿ã€‹èƒŒåçš„ä¸€ä¸ªåŸºæœ¬é¢„è®¾æ˜¯ï¼šæ²¡æœ‰æ–‡åŒ–åšæ”¯æ’‘ï¼Œåˆ¶åº¦æ˜¯æ²¡æœ‰åŠæ³•æœ‰æ•ˆè¿è¡Œçš„ã€‚å› æ­¤ï¼Œæœ€é‡è¦çš„ä»»åŠ¡æ˜¯ï¼šé€šè¿‡æ•™è‚²ï¼Œå°†â€œäººâ€è½¬å˜ä¸ºâ€œå…¬æ°‘â€ï¼Œåƒçˆ±å¼¥å„¿ä¸€æ ·çš„å…¬æ°‘ã€‚å”¯å…¶å¦‚æ­¤ï¼Œæ™®éæ„å¿—æ‰æœ‰å¯èƒ½ï¼Œæ­£ä¹‰è€Œåˆæ³•çš„æ”¿æ²»ç§©åºæ‰æœ‰å¯èƒ½ã€‚æ‰€ä¾ç†è§£å¢æ¢­çš„æ€æƒ³ï¼Œæœ€å¥½æ˜¯ä»ç¬¬ä¸€ç¯‡è®ºæ–‡ã€ç¬¬äºŒç¯‡è®ºæ–‡ã€ç¤¾ä¼šå¥‘çº¦è®ºã€çˆ±å¼¥å°” è¿™æ ·çš„é¡ºåºè¯»å®Œã€‚</p><p>æ‰€ä»¥å¢æ¢­çš„è¿™å‡ æœ¬ä¹¦è¿è´¯æ€§å¾ˆå¼ºï¼Œéƒ½è¯»å®Œæ‰èƒ½ç†è§£å¢æ¢­çš„æ”¿æ²»å“²å­¦æ€æƒ³ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://kindle.502.li/" target="_blank" rel="noopener">ç¤¾ä¼šå¥‘çº¦è®º</a></p><h3 id="æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨ä¸åæœ"><a href="#æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨ä¸åæœ" class="headerlink" title="æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨ä¸åæœ"></a>æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨ä¸åæœ</h3><p>è¿™æœ¬ä¹¦æ˜¯å¼ é›ªå¿ æ•™æˆå†™çš„ï¼Œå†™ä½œé£æ ¼å’Œå¼ åƒå¸†ã€è®¸ç« æ¶¦ã€å¼ ç»´è¿ä»–ä»¬ä¸€æ ·ã€‚æ¯”è¾ƒå–œæ¬¢è¿™æ ·çš„è€å¸ˆï¼Œå…³äºå¼ é›ªå¿ æ•™æˆï¼Œç»´åŸºç™¾ç§‘ä¸Šæœ‰ä¸€æ®µï¼š</p><blockquote><p>2013å¹´5æœˆï¼Œå¼ é›ªå¿ é¦–å…ˆåœ¨ç½‘ç»œå…¬å¼€ä¸€ä»½ä¸­å›½å®˜æ–¹çš„â€œ<a href="https://zh.wikipedia.org/wiki/ä¸ƒä¸è®²" target="_blank" rel="noopener">ä¸ƒä¸è®²</a>â€çš„å†…éƒ¨ææ–™çš„å†…å®¹ã€‚å…¶åå¾—åˆ°å…¶ä»–å­¦è€…å’Œæ•™æˆçš„è¯å®ã€‚â€œä¸ƒä¸è®²â€æ˜¯ä¸­å…±ä¸­å¤®åœ¨2013å¹´åœ¨æ„è¯†å½¢æ€é¢†åŸŸçš„æŒ‡ä»¤ï¼Œç¡®å®šä¸ƒä¸ªé¢†åŸŸä¸ºç¦åŒºï¼š<a href="https://zh.wikipedia.org/wiki/æ™®ä¸–ä»·å€¼" target="_blank" rel="noopener">æ™®ä¸–ä»·å€¼</a>ã€<a href="https://zh.wikipedia.org/wiki/æ–°é—»è‡ªç”±" target="_blank" rel="noopener">æ–°é—»è‡ªç”±</a>ã€<a href="https://zh.wikipedia.org/wiki/å…¬æ°‘ç¤¾ä¼š" target="_blank" rel="noopener">å…¬æ°‘ç¤¾ä¼š</a>ã€<a href="https://zh.wikipedia.org/wiki/å…¬æ°‘æƒåˆ©" target="_blank" rel="noopener">å…¬æ°‘æƒåˆ©</a>ã€ä¸­å›½å…±äº§å…šçš„å†å²é”™è¯¯ã€<a href="https://zh.wikipedia.org/wiki/æƒè´µèµ„äº§é˜¶çº§" target="_blank" rel="noopener">æƒè´µèµ„äº§é˜¶çº§</a>ã€<a href="https://zh.wikipedia.org/wiki/å¸æ³•ç¨ç«‹" target="_blank" rel="noopener">å¸æ³•ç‹¬ç«‹</a>ã€‚éšåâ€œä¸ƒä¸è®²â€æˆä¸ºç½‘ç»œç¦è¯ï¼Œå¼ çš„æ–°æµªå¾®åšå†æ¬¡è¢«åˆ å·ã€‚<a href="https://zh.wikipedia.org/wiki/å¼ é›ªå¿ #cite_note-rfa2-6" target="_blank" rel="noopener">[6]</a></p></blockquote><p>è¿™ä¸€ä»¶äº‹ä¸å¾—æŠ¥é“ã€é‚£ä¸€æœ¬ä¹¦ä¸å¾—å‡ºç‰ˆã€è¿™å¥è¯ä¸èƒ½è®²ï¼Œåˆ è´´å°å·ç­‰ï¼Œè¡¨é¢ä¸Šè¨€è®ºå®¡æŸ¥æ˜¯åœ¨ä¾µçŠ¯è¨€è®ºè‡ªç”±ï¼Œä½†å®è´¨ä¸Šå´æ˜¯åœ¨è´¬ä½å…¨ä½“å›½æ°‘çš„äººæ ¼å’Œå°Šä¸¥ã€‚è¨€è®ºå®¡æŸ¥å®Œå…¨æ˜¯åœ¨å‘å…¨ä½“å›½æ°‘å®£å‘Šï¼šâ€œä½ ä»¬è¿™å¸®å±æ°‘æ ¹æœ¬å°±æ²¡æœ‰èµ„æ ¼äº†è§£è¿™ä»¶äº‹æƒ…çš„çœŸç›¸ï¼Œä¹Ÿæ²¡æœ‰èµ„æ ¼å»æ€è€ƒå’Œè¾¨åˆ«ä¿¡æ¯çš„çœŸå‡ã€‚â€ï¼Œä»·å€¼åˆ¤æ–­çš„æ ‡å‡†ç”±çœŸç†éƒ¨è¯´äº†ç®—ã€‚ä¸€ä¸ªäººä¸ä¸€å¤´çŒªçš„æœ€å¤§åŒºåˆ«ï¼Œå°±åœ¨äºäººå…·æœ‰çŒªæ‰€æ²¡æœ‰çš„ç†æ™ºï¼Œè€Œè¨€è®ºå®¡æŸ¥æ°æ°æ˜¯åœ¨å‰¥å¤ºäººä»¬è‡ªç”±è¿ç”¨ç†æ™ºçš„èµ„æ ¼ï¼Œä¹Ÿå°±æ˜¯å°½é‡ç¼©å°äººä¸çŒªä¹‹é—´çš„å·®åˆ«ã€‚ä¸“åˆ¶ç»Ÿæ²»è€…ç¡®å®å¸Œæœ›å›½æ°‘å¿˜è®°è‡ªå·±æ˜¯æœ‰ç†æ™ºçš„åŠ¨ç‰©ï¼Œå¹¶èƒ½åƒçŒªä¸€æ ·å®¹æ˜“æ»¡è¶³ï¼Œåªéœ€æœ‰è¶³ä»¥æœè…¹çš„é£Ÿç‰©ï¼Œå°±ä¼šå¯¹ç»Ÿæ²»è€…æ„Ÿæ©æˆ´å¾·ã€‚</p><blockquote><p>å…¨ä½“å›½æ°‘ä½œä¸ºä¸»æƒè€…ç»„å»ºæ”¿åºœå¹¶é€‰ä»»æ‰§æ”¿è€…ï¼Œæœ¬æ˜¯ä¸ºäº†æ›´å¥½åœ°ä¿æŠ¤è‡ªå·±çš„ç”Ÿå‘½ã€è´¢äº§å’Œè‡ªç”±ã€‚æ”¿åºœçš„ç›®çš„å’Œæ‰§æ”¿è€…çš„ä½¿å‘½ï¼Œæ˜¯ä¿æŠ¤ä¸»æƒè€…æœ¬æ¥å°±äº«æœ‰çš„æƒåˆ©å’Œè‡ªç”±ï¼Œè€Œä¸æ˜¯èµäºˆä¸»æƒè€…æœ¬æ¥ä¸äº«æœ‰çš„æƒåˆ©å’Œè‡ªç”±ã€‚æ‰§æ”¿è€…è®¤ä¸ºå›½æ°‘çš„æƒåˆ©å’Œè¿½æ±‚å¹¸ç¦çš„æœºä¼šï¼Œæ˜¯æºäºè‡ªå·±çš„èµèµï¼Œå°±åƒå­å¥³è®¤ä¸ºçˆ¶æ¯çš„å­˜åœ¨æ˜¯å‡ºäºè‡ªå·±çš„æ„å¿—ä¸€æ ·è’è°¬å’Œæ‚–ç†ã€‚</p></blockquote><p><code>æ‘˜æŠ„</code> <a href="https://t.co/1vyK1t0NMr" target="_blank" rel="noopener">æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨ä¸åæœ</a></p><h3 id="ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶"><a href="#ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶" class="headerlink" title="ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶"></a>ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶</h3><p>è¿™æœ¬ä¹¦æ˜¯æ˜¥èŠ‚çš„æ—¶å€™åœ¨å®¶è¯»å®Œçš„ï¼Œè¾ƒä¹‹äºå¼ é›ªå¿ æ•™æˆçš„ã€Šæ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨å’Œåæœã€‹ï¼Œå‘¨é›ªå…‰æ•™æˆä»ç»„ç»‡å­¦è§’åº¦æ¥è¿›è¡Œåˆ†æä¸­å…±å›½å®¶æ²»ç†å¾—é€»è¾‘ã€‚å¯¹äºè¿™æ¬¡å¾—ç–«æƒ…æ¥è®²ï¼Œå†ä¸€æ¬¡å°è¯äº†ä¹¦ä¸­æ‰€é˜é‡Šçš„å†…å®¹ã€‚<strong>å³ä¸€ç»Ÿä½“åˆ¶ä¸æœ‰æ•ˆæ²»ç†ï¼šä¸­å›½å›½å®¶æ²»ç†çš„ä¸€ä¸ªæ·±åˆ»çŸ›ç›¾</strong>ã€‚ä¸åšè¿‡å¤šè¯„è®ºï¼Œæ­¤ä¹¦å¦‚åŒæ¨ç‰¹ä¸Šçš„ä¸€äº›äººæ¨èä¸€æ ·ï¼Œå¾ˆé€‚åˆå½“ä¸‹å»çœ‹çœ‹ï¼Œå»åˆ†æä¸€ä¸‹è¿™ä¸ªå®˜åƒšä½“åˆ¶æ˜¯å¤šä¹ˆåœ°è…è´¥å’Œæ— èƒ½ã€‚å°±å¦‚ã€Šå¿ƒç†æµ‹é‡è€…ã€‹ä¸­æ‰€è¯´çš„ï¼Œ<strong>æˆ‘ä»¬å§‹ç»ˆæ‰¿æ‹…ç€æ”¿åºœå¼ºåŠ ç»™æˆ‘ä»¬çš„é£é™©</strong>ï¼Œè¿™æ˜¯æƒåŠ›é›†ä¸­åŒ–çš„å¿…ç„¶ç»“æœã€‚é‚£äº›å·²ç»é›†ä¸­èµ·æ¥çš„æƒåŠ›ç»å¯¹ä¸ä¼šå› ä¸ºä»–ç¾å¥½çš„æ„¿æ™¯è€Œå˜å¾—æ— å®³ã€‚é‚£äº›æ­»åœ¨æ­¦æ±‰è‚ºç‚ç—…æ¯’ä¹‹å¤–çš„äººä¸æ­£æ˜¯æˆ‘ä»¬æ¯ä¸ªäººéƒ½è¦æ‰¿æ‹…çš„é£é™©å—</p><p>åœ¨ä¸“åˆ¶å›½å®¶ï¼ŒæƒåŠ›ä¸å—çº¦æŸçš„ç»Ÿæ²»è€…ï¼Œæ˜¯æ™®éçš„æ”¿åºœè…è´¥å’Œå„ç§ç¤¾ä¼šé—®é¢˜çš„æ ¹ç”±ï¼Œä¹Ÿæ˜¯äººç±»æ–‡æ˜ç¤¾ä¼šæœ€å¤§çš„<code>ç—…æ¯’</code> ã€‚ä¹Ÿæ­£æ˜¯æ­£æ˜¯è¿™ä¸ªè…è´¥æ— èƒ½çš„å®˜åƒšä½“åˆ¶æ¬ºä¸Šç’ä¸‹ã€åˆ å¸–å°å·ã€ç»´ç¨³æŠ“äººã€å°æ€è¨€è®ºã€æ‹˜ç•™è®°è€…ã€æŠ“æ•å¾‹å¸ˆã€é€ è°£å¼è¾Ÿè°£ç­‰ç­‰ä½œæ¶è¡Œä¸ºæ‰å¯¼è‡´çš„å…¨çƒç–«æƒ…å¤§çˆ†å‘ã€‚å…¶å®è¿™äº›æ—¶åˆ»ä¼´éšç€æˆ‘ä»¬ï¼Œåªä¸è¿‡æ˜¯è¿™æ¬¡çš„ç—…æ¯’å°†è¿™ä¸ªä½“åˆ¶çš„ä¸€ä¸ªé˜´æš—é¢æ­éœ²äº†å‡ºæ¥è€Œå·²ï¼Œå®ƒè…çƒ‚åˆ°æ ¹é‡Œå·²ç»å¾ˆä¹…å¾ˆä¹…â€¦â€¦</p><p>åœ¨ææƒä¸»ä¹‰ä½“åˆ¶ä¸‹ï¼Œå›½å®¶ä¸€æ–¹é¢ç”¨æ„è¯†å½¢æ€è›Šæƒ‘å’Œéº»é†‰äººæ°‘ï¼Œå¦ä¸€æ–¹é¢åˆç”¨åˆ©ç”¨å›½å®¶æœºå™¨é™åˆ¶ç¤¾ä¼šå†…éƒ¨çš„ç›´æ¥äº¤å¾€ï¼Œä½¿ä¹‹ä¿æŒæœ‰åˆ©äºå›½å®¶æ§åˆ¶çš„â€œåŸå­åŒ–â€çŠ¶æ€ã€‚åŸºäºå›½å®¶çš„ç»å¯¹æƒåŠ›å’Œæ•´ä¸ªç¤¾ä¼šçš„éç»“æ„åŒ–ï¼Œå›½å®¶èƒ½å¤Ÿæ ¹æ®è‡ªå·±çš„æ„å¿—å‘èµ·ä»»ä½•è¡ŒåŠ¨ï¼ŒåŒ…æ‹¬æ”¿æ²»æˆ–ç¤¾ä¼šè¿åŠ¨ã€‚è¿™æ¬¡çš„<code>ç–«æƒ…é˜²å«æˆ˜ç–«</code>ä¸å°±æ˜¯è¿™ä¸ªå®˜åƒšä½“åˆ¶å‘èµ·çš„æ”¿æ²»è¿åŠ¨å˜›ï¼Ÿæ„ŸæŸ“æ­»äº¡äººæ•°ä½œå‡ï¼Œå…¬ä¿¡åŠ›ä¸æ–­åœ°ä¸§å¤±ã€‚ä½ èƒ½åœ¨è¿™æœ¬ä¹¦é‡Œæ‰¾åˆ°å¾ˆå¥½çš„è§£é‡Šï¼Œä¹¦ä¸­ä¹Ÿæåˆ°è¿‡ä¸Šçº§æ¥è§†å¯Ÿçš„æ—¶å€™ï¼Œåœ°æ–¹æ”¿åºœå¦‚ä½•å¿½æ‚ ä¸­å¤®ï¼Œä»¥åŠå„ç§æƒåˆ©å…³ç³»ä¹‹é—´å¦‚ä½•å…±è°‹è¾¾åˆ°<strong>ä¸Šæœ‰æ”¿ç­–ä¸‹æœ‰å¯¹ç­–çš„</strong>ã€‚</p><p>ã€å¡ç†æ–¯ç›æƒå¨çš„æ ¸å¿ƒæ˜¯ï¼Œé¢†è¢–ä»¥å…¶è¶…å‡¡ç¦€èµ‹è€Œå¾—åˆ°è¿½éšè€…çš„æ‹¥æˆ´å’Œæœä»ï¼›è€Œé¢†è¢–åˆ™é€šè¿‡ä¸æ–­åœ°åˆ›é€ â€œå¥‡è¿¹â€æ¥æ˜¾ç¤ºå…¶è¶…å‡¡ç¦€èµ‹ï¼Œä»¥å»¶ç»­å’Œå¼ºåŒ–è¿™ä¸€åˆæ³•æ€§åŸºç¡€ã€‚ åœ¨ç»è¿‡äº†æˆ˜äº‰åŠ¨è¡ï¼Œæ°‘ç”Ÿå‡‹æ•ï¼Œä¸§æƒè¾±å›½çš„æ°‘æ—å±æœºä¹‹åï¼Œä¸­å›½å¤§åœ°æœ‰æœŸå†€å¥‡è¿¹ã€å´‡å°šä¼Ÿäººçš„å¡ç†æ–¯ç›æƒå¨çš„è‚¥æ²ƒåœŸå£¤ã€‚ã€</p><p>ã€ä»»ä½•æŒ‘æˆ˜å¡ç†æ–¯ç›æƒå¨çš„è¯è¯­éƒ½ä¼šå¼±åŒ–ç”šè‡³ç“¦è§£å…¶åˆæ³•æ€§åŸºç¡€ï¼Œå› æ­¤è¯è¯­å„æ–­æƒæ˜¯ç»´ç³»å¡ç†æ–¯ç›æƒå¨çš„å…³é”®æ‰€åœ¨ã€‚å»ºå›½ä»¥åï¼Œå›½å®¶é€æ­¥é€šè¿‡å®˜åƒšä½“åˆ¶ä»‹å…¥ã€æ§åˆ¶ä»¥è‡³å„æ–­æ„è¯†å½¢æ€ç›¸å…³çš„é¢†åŸŸï¼Œæœ‰æ•ˆåœ°æœç»äº†è´¨ç–‘æˆ–æŒ‘æˆ˜å¡ç†æ–¯ç›æƒå¨çš„æ½œåœ¨å¯èƒ½æ€§ã€ è¿™ä¹Ÿæ˜¯è¨€è®ºå®¡æŸ¥çš„æ ¹æœ¬åŸå› å§ï¼Œç»´æŠ¤ç»Ÿæ²»è€…çš„æƒåŠ›åˆæ³•æ€§ã€‚</p><p>åœ¨æ”¿æ²»è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸éš¾çœ‹åˆ°åœ°æ–¹æ”¿åºœçš„å„ç§åšæ³•ï¼ˆå¦‚åœ¨æ‹†è¿ã€ä¸¥æ‰“ã€åŸç®¡ã€ä¿¡è®¿ç­‰ç­‰è¿‡ç¨‹ä¸­çš„å…·ä½“æ‰€ä¸ºï¼‰å¸¸å¸¸ä¸æ³•å¾‹æ¡æ–‡ç›¸æ‚–ã€‚åœ°æ–¹æ”¿åºœçš„è¿™äº›åšæ³•åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå¢å¼ºäº†åŸºå±‚æ”¿åºœè§£å†³å®é™…é—®é¢˜çš„èƒ½åŠ›ï¼Œä½†ä¸æ­¤åŒæ—¶ï¼Œå®ƒä»¬ä¸æ–­åœ°ä¾µèš€å¼±åŒ–æ³•æ²»åŸºç¡€å’Œæ³•ç†è§‚å¿µã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/tl1mmh7z3t" target="_blank" rel="noopener">ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶</a></p><h3 id="å›½å®¶å»ºè®¾ä¸æ”¿åºœè¡Œä¸º"><a href="#å›½å®¶å»ºè®¾ä¸æ”¿åºœè¡Œä¸º" class="headerlink" title="å›½å®¶å»ºè®¾ä¸æ”¿åºœè¡Œä¸º"></a>å›½å®¶å»ºè®¾ä¸æ”¿åºœè¡Œä¸º</h3><p>è¯»å®Œã€Šä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶ã€‹ååœ¨ Amazon ä¸Šæœç´¢å‘¨é›ªå…‰ä½œè€…æ‰¾åˆ°çš„ä¹¦ã€‚ä¸å…¶è¯´æ˜¯ä¸€æœ¬ä¹¦ï¼Œå…¶å®æ›´åƒæ˜¯ä¸€å†Œç ”ç©¶ä¸­å›½å®˜åƒšä½“åˆ¶çš„è®ºæ–‡é›†ï¼Œä»å­¦æœ¯è§’åº¦æ¥åˆ†æä¸€äº›ä½“åˆ¶é—®é¢˜ã€‚</p><blockquote><p>ä½œä¸ºæ‰€æœ‰æƒåŠ›é›†äºä¸€èº«çš„ä¸­å¤®æ”¿åºœï¼Œä¸»è¦éœ€è¦å®Œæˆä¸¤é¡¹åŸºæœ¬ä»»åŠ¡ï¼šä¸€æ˜¯ä¸ºå¹¿å¤§ç™¾å§“æä¾›åŸºæœ¬çš„å…¬å…±æœåŠ¡ï¼Œç»´æŒæ”¿æƒçš„é•¿æœŸç¨³å®šï¼›äºŒæ˜¯ä¿è¯ä¸‹æ”¾ç»™è¡Œæ”¿ä»£ç†äººçš„æƒåŠ›ä¸è¢«æ»¥ç”¨ï¼Œä¸­å¤®çš„æ”¿ä»¤èƒ½å¤Ÿç•…é€šæ— é˜»ã€‚è¿™ä¸¤é¡¹ä»»åŠ¡æœ¬è´¨ä¸Šæ˜¯å†²çªçš„ï¼šä¸€æ–¹é¢ï¼Œä¸ºäº†ç»™å¹¿å¤§ç™¾å§“æ›´å¥½åœ°æä¾›å…¬å…±æœåŠ¡ï¼Œå°±å¿…é¡»å°½å¯èƒ½æŠŠæƒåŠ›ä¸‹æ”¾ç»™åŸºå±‚æ”¿åºœï¼Œå› ä¸ºåŸºå±‚æ”¿åºœç›¸å¯¹æ¥è¯´æ›´äº†è§£å½“åœ°æ°‘ä¼—å¯¹å…¬å…±æœåŠ¡çš„åå¥½ï¼Œæ›´äº†è§£å½“åœ°çš„å…·ä½“æ¡ä»¶ï¼›ä»å…¬å…±æœåŠ¡çš„è§’åº¦ï¼Œé›†æƒè€…åº”è¯¥å°½å¯èƒ½é€‰æ‹©åˆ†æƒã€‚å¦ä¸€æ–¹é¢ï¼Œç»™å®šä¸‹çº§æ”¿åºœçš„å®˜å‘˜ç›®æ ‡å’Œåˆ©ç›Šä¸åŒäºä¸­å¤®æ”¿åºœï¼Œä¸‹çº§å®˜å‘˜çš„è¡Œä¸ºä¸æ˜“ç›‘ç£ï¼ŒæƒåŠ›ä¸‹æ”¾å°±æ„å‘³ç€æƒåŠ›è¢«æ»¥ç”¨çš„å±é™©ï¼Œç”šè‡³è¢«æ¶ç©ºï¼Œè€Œä¸”æƒåŠ›ä¸‹æ”¾è¶Šæ˜¯åˆ°åŸºå±‚ï¼Œç›‘ç£å°±è¶Šå›°éš¾ï¼ŒæƒåŠ›è¢«æ»¥ç”¨çš„å¨èƒä¹Ÿå°±è¶Šå¤§ã€‚</p><p>å½“æ”¿åºœé»˜è®¸æˆ–é¼“åŠ±ä¸‹çº§æ”¿åºœå› åœ°åˆ¶å®œæ—¶ï¼Œåè€…å¯èƒ½æŒ‰è‡ªå·±æ„å›¾è§£è¯»å®æ–½æ”¿ç­–ï¼Œéšç€æ”¿ç­–å®æ–½è¿‡ç¨‹çš„å±•å¼€ï¼Œæ‰§è¡Œçµæ´»æ€§è¶Šæ¥è¶Šå¤§ï¼Œä¸è¿™ä¸€ä¸»çº¿çš„åå·®è·ç¦»è¶Šæ¥è¶Šå¤§ï¼Œå¯¼è‡´ä¸åŸæ”¿ç­–ç›¸å»ç”šè¿œçš„ç»“æœã€‚</p></blockquote><p>ç»“åˆè¿™æ¬¡ç–«æƒ…ï¼Œä¸éš¾ç†è§£ä¸ºä»€ä¹ˆåœ°æ–¹æ”¿åºœæ“…è‡ªå°è·¯å°åŸçš„ä¸¾æªï¼Œå³ä¾¿è¿™äº›ä¸¾æªå·²ç»æ˜æ˜¾åœ°è¿åäº†æ³•å¾‹ï¼ˆå›½åŠ¡é™¢é¢å¸ƒçš„è§„å®šï¼‰ï¼Œå³ä¾¿æ˜¯å› ä¸ºå°è·¯è€Œé€ æˆäººå‘˜æ„å¤–èº«äº¡ï¼Œå³ä¾¿æ˜¯ä¸€å®¶å››å£åœ¨å®¶æ‰“éº»å°†ä¹Ÿè¦è¢«æ‹‰ä¸Šè¡—è¢«<code>æ‰¹æ–—</code>â€¦â€¦ä¸­å¤®æ”¿åºœä¹Ÿä¸ä¼šå¤„ç½šåœ°æ–¹æ”¿åºœã€‚åœ¨è¿™æ¬¡ç–«æƒ…ä¸­ï¼Œåœ°æ–¹æ”¿åºœçš„ä¸€äº›è¡Œä¸ºå·²ç»è¿åäº†å®ªæ³•ï¼Œç®€ç§°è¿å®ªè¡Œä¸ºï¼Œè€Œæ‰€è°“çš„<code>çº¢è¢–ç« </code>ä»—ç€ç‚¹æ‰‹ä¸­çš„ç‰¹æƒè‚†æ„ä¾µçŠ¯ç€å…¬æ°‘çš„æƒåŠ›ã€‚å°±å¦‚å‰©ä½™ä»·å€¼è¢«å°æ€çš„é‚£æœŸä¸­ç½—æ–°è€å¸ˆæåˆ°çš„ï¼š</p><blockquote><p>æˆ‘ä»¬ç°åœ¨å¬å¾ˆå¤šäººå¤§è°ˆ<strong>æˆ˜æ—¶çŠ¶æ€</strong>ï¼Œä½†éšä¾¿ä¸€ä¸ªè¡Œæ”¿å®˜å‘˜å°±èƒ½å¤Ÿå®£å¸ƒâ€æˆ˜æ—¶çŠ¶æ€â€å—ï¼Ÿè¿™å¿…é¡»æ˜¯è¦ç»è¿‡æœ€é«˜ç«‹æ³•æœºæ„å†³å®šçš„ã€‚å°åŸæˆ–è€…è¯¸å¦‚æ­¤ç±»çš„æç«¯æªæ–½å¸¦æ¥çš„ä¼¤å®³ï¼Œä¸€å®šä¼šæ¯”ç—…æ¯’æœ¬èº«è¿˜è¦å¤§ã€‚</p></blockquote><p><code>æ‘˜æŠ„</code> <a href="https://t.co/7oYY1ZTdAL" target="_blank" rel="noopener">å›½å®¶å»ºè®¾ä¸æ”¿åºœè¡Œä¸º</a></p><h3 id="æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—æœé²œäººæ°‘çš„çœŸå®ç”Ÿæ´»"><a href="#æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—æœé²œäººæ°‘çš„çœŸå®ç”Ÿæ´»" class="headerlink" title="æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—æœé²œäººæ°‘çš„çœŸå®ç”Ÿæ´»"></a>æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—æœé²œäººæ°‘çš„çœŸå®ç”Ÿæ´»</h3><p>è¯»å®Œè¿™æœ¬ä¹¦å°±æ„Ÿè§‰åˆ°å½“ä»Šçš„æœé²œå°±å¦‚ä¸Šä¸–çºªçš„ä¸­å›½<strong>åå¹´æ–‡é©åŸºç¡€ä¸Šå†åŠ ä¸Šä¸‰å¹´å¤§é¥¥è’</strong>ä¸€æ ·æ‚²æƒ¨ï¼Œè¿™ç§çºªå®ç±»çš„å†™ä½œå’Œã€Šåˆ‡å°”è¯ºè´åˆ©çš„æ‚²é¸£ã€‹ä»¥åŠã€Šåä¸ªäººçš„ä¸€ç™¾å¹´ã€‹ä¸€æ ·ï¼Œæ²‰é‡çš„å†å²æ„Ÿã€‚æˆ‘ä»¬éƒ½æ˜¯è¢«å…±äº§ä¸»ä¹‰çš„ææƒä¸“åˆ¶ç‹¬è£æš´æ”¿ç»Ÿæ²»è¹‚èºè¿‡çš„æ°‘æ—ï¼Œæ„ŸåŒèº«å—çš„å†å²è®°å¿†ï¼Œå½·ä½›å°±åœ¨æ˜ å°„ç€å½“ä¸‹ä¸€æ ·ï¼Œè®©äººæœ‰ç§èº«åœ¨å†å²ä¸­æ„Ÿå—å®ƒçš„å­˜åœ¨ä¸€æ ·ã€‚çœ‹çœ‹ä¸‹é¢è¿™å‡ æ®µæ‘˜æŠ„ï¼Œå’Œæ–‡é©æ—¶æœŸçš„æˆ‘ä»¬ä»¥åŠå½“ä¸‹çš„æˆ‘ä»¬åˆæ˜¯ä½•å…¶çš„ç›¸ä¼¼ï¼š</p><blockquote><p>  ç”±äºåŒ—éŸ©å¤ªè´«å›°ï¼Œç”µåŠ›ä¾›åº”ä¸è¶³ä»¥ç»´æŒç”µå­ç›‘æ§ï¼Œæ‰€ä»¥å›½å®¶å®‰å…¨å¿…é¡»ä»°èµ–äººåŠ›æƒ…æŠ¥â€”â€”å‘Šå¯†ã€‚æŠ¥çº¸å¶å°”ä¼šå‡ºç°æ–‡æƒ…å¹¶èŒ‚çš„æŠ¥å¯¼ï¼Œæè¿°å‹‡æ•¢çš„å­©å­çº ä¸¾çˆ¶æ¯çš„è¿æ³•è¡Œä¸ºã€‚ç”±æ­¤çœ‹æ¥ï¼Œå› å‘è¡¨å¯¹å½“å±€ä¸æ»¡çš„è¨€è®ºè€Œè¢«é‚»å±…å‘Šå‘ä¹Ÿå°±ä¸è§‰å¾—å¥‡æ€ªäº†ã€‚</p></blockquote><blockquote><p>  åŒ—éŸ©äººå­¦ä¼šåä¸‹è‡ªå·±çš„è‡ªå°Šä¸æä½è‡ªå·±çš„é¼»å­ã€‚ä»–ä»¬ä»å†œæ‘åŠ¨ç‰©çš„æ’æ³„ç‰©ä¸­æŒ‘å‡ºæ¥æœªè¢«æ¶ˆåŒ–çš„ç‰ç±³ç²’ã€‚èˆ¹å‚å·¥äººå‘å±•å¤„ä¸€ç§æŠ€æœ¯ï¼ŒåŸæœ¬å‚¨å­˜ç²®é£Ÿçš„è´§ä»“åº•éƒ¨æ®‹ç•™ç€è…è‡­é»è…»çš„ä¸œè¥¿ï¼Œä»–ä»¬å°†è¿™äº›ä¸œè¥¿åˆ®èµ·äº†ï¼Œæ”¾åœ¨åœ°é¢æ™¾å¹²ï¼Œä»ä¸­å¯ä»¥æ‹¾å–ä¸€ç‚¹æœªçƒ¹ç…®è¿‡çš„ç¨»ç±³ä¸å…¶ä»–å¯é£Ÿç”¨çš„è°·ç‰©ã€‚</p></blockquote><blockquote><p>  å­©å­ç¡è§‰æ—¶è¦æé˜²å…¶ä»–å¸®æ´¾å·èµ°ä»–ä»¬çš„å°‘è®¸ä½™ç²®ã€‚æ­¤å¤–ä¹Ÿæµä¼ ç€è®¸å¤šè¯¡å¼‚çš„æ•…äº‹ï¼Œæåˆ°æˆå¹´äººæŠŠå­©å­å½“æˆçŒç‰©ã€‚ä¸åªç”¨æ¥å‘æ³„æ€§æ¬²ï¼Œä¹Ÿå½“æˆé£Ÿç‰©ã€‚é‡‘èµ«å¬è¯´æœ‰äººå¯¹å­©å­ä¸‹æ¯’ï¼Œæ€æ­»å­©å­ï¼Œå¤§å¸å…«å—åƒä¸‹è‚šã€‚åœ¨ç«è½¦ç«™åé¢ï¼Œé è¿‘é“é“è¾¹ï¼Œæœ‰äº›å°è´©åœ¨å°ç«ç‚‰ä¸Šç…®æ±¤ç…®é¢ï¼Œæ®è¯´æµ®åœ¨ä¸Šé¢çš„ç°è‰²è‚‰å—å°±æ˜¯äººè‚‰ã€‚</p></blockquote><blockquote><p>  å„çº§ç£å¯¼ä¾‹è¡Œæ€§åœ°æé€ å†œä¸šç”Ÿäº§ä¸å·¥ä¸šäº§å‡ºçš„ç»Ÿè®¡æ•°æ®ï¼Œå› ä¸ºä»–ä»¬ä¸æ•¢å‘Šè¯‰é•¿å®˜å®æƒ…ã€‚ä¸ºäº†åœ†è°ï¼Œåªå¥½è¯´æ›´å¤šçš„è°ï¼Œä»åŸºå±‚ä¼ è¾¾åˆ°é«˜å±‚çš„è®¯æ¯æ²¡æœ‰ä¸€ä»¶æ˜¯çœŸçš„ï¼Œæ‰€ä»¥å¯ä»¥æƒ³è§é‡‘æ—¥æˆæœ¬äººææ€•å®Œå…¨ä¸çŸ¥é“ç»æµçš„çŠ¶å†µæœ‰å¤šç³Ÿã€‚</p></blockquote><p>çœ‹å®Œè¿™æœ¬ä¹¦ä¹Ÿå¯ä»¥å»çœ‹å¦å¤–ä¸€æœ¬ä¹¦ã€Šé»„é•¿çƒ¨å›å¿†å½•ã€‹</p><blockquote><p>  æˆ‘åœ¨ä¸€ä¸ªå……æ»¡äº†è™šä¼ªå’Œæ¬ºéª—çš„ç¤¾ä¼šç”Ÿæ´»äº†å¾ˆä¹…ï¼Œä¸€å¼€å§‹æˆ‘ä»¥ä¸ºè™šä¼ªå’Œæ¬ºéª—æ˜¯ä¸ºäº†è§£æ”¾å‹¤åŠ³çš„äººæ°‘å¤§ä¼—ï¼Œå³ä¸ºäº†å–å¾—ä¸å‰¥å‰Šé˜¶çº§æ–—äº‰çš„èƒœåˆ©è€Œå¿…é¡»é‡‡ç”¨çš„æ‰‹æ®µã€‚ ä½†æ˜¯ï¼Œåæ¥æˆ‘æ„è¯†åˆ°ï¼Œè™šä¼ªä¸æ¬ºéª—å·²ç»ä¸ç‹¬è£è€…çš„åˆ©å·±ä¸»ä¹‰ç»“åˆèµ·æ¥ã€‚ç‹¬è£è€…çš„åˆ©å·±ä¸»ä¹‰é›†ä¸­ä½“ç°ä¸ºä¸ªäººå´‡æ‹œæ€æƒ³ï¼ŒåŒ—æœé²œæ˜¯å…¨ä¸–ç•Œä¸ªäººå´‡æ‹œå’Œé˜¶çº§ä¸»ä¹‰æœ€ä¸¥é‡çš„å›½å®¶ã€‚ æˆ‘èº«å¤„åŒ—æœé²œç»Ÿæ²»ä½“åˆ¶çš„ä¸­æ¢ï¼Œæ˜¯æ•´ä¸ªè™šä¼ªå®£ä¼ çš„åŠ¨å‘˜å’Œç»„ç»‡è€…ï¼ˆä½œè€…æ˜¯åŒ—æœé²œé©¬å…‹æ€ä¸»ä¹‰å’Œæ„è¯†å½¢æ€é¢†åŸŸçš„æƒå¨ï¼Œè¯‘è€…æ³¨ï¼‰ã€‚è™šä¼ªæ›¾ç»ä¸€åº¦å–ä»£çœŸç†å æ®ä¸€ä¸ªå­¦è€…çš„è‰¯å¿ƒï¼Œä¸å­¦è€…çš„çµé­‚å¯¹ç«‹ã€‚ æˆ‘ï¼ˆåœ¨ä¹¦ä¸­ï¼‰ä¸ä¼šå› ä¸ºè®¨åŒæˆ‘å’Œè®©æˆ‘è®¨åŒçš„äººè€Œå¤¸å¤§ã€ä¸‘åŒ–äº‹å®ï¼Œä¹Ÿä¸ä¼šå› ä¸ºçˆ±æˆ‘å’Œè®©æˆ‘çˆ±çš„äººè€Œæ¯«æ— åŸåˆ™çš„ç¾åŒ–ç°å®ã€‚ å†å²å°±æ‘†åœ¨é‚£é‡Œï¼Œå¯¹å†å²æ¥è¯´ï¼Œæ­ªæ›²æ˜¯æœ€å¤§çš„çŠ¯ç½ªã€‚æˆ‘ä¸è®¤ä¸ºæˆ‘è¯´çš„å°±æ˜¯ç»å¯¹ï¼ˆæ­£ç¡®ï¼‰ï¼Œæˆ‘åå€’æ›´å¸Œæœ›è¯»è€…å¸¦ç€æ‰¹åˆ¤çš„æ€åº¦æ¥é˜…è¯»æœ¬ä¹¦ã€‚ å¯¹äºä¸å¤§ä¼—åˆ©ç›Šæ¯«æ— å…³ç³»çš„ä¸ªäººç”Ÿæ´»ï¼Œæˆ–è€…æœ‰å¹²æ¶‰å®ƒå›½å†…æ”¿ä¹‹å«Œçš„è¨€è®ºï¼Œæˆ‘ä¼šå°½é‡é¿å…ã€‚æ¥åˆ°éŸ©å›½ä¹‹åï¼Œæˆ‘åœ¨åŠªåŠ›å­¦ä¹ æ–°äº‹ç‰©ï¼Œå¼€å§‹æ–°çš„ä½“éªŒã€‚ ä½†æ˜¯ï¼Œæˆ‘å·²ç»è€äº†ï¼Œå­¦åˆ°çš„æ–°çŸ¥è¯†å’Œæ–°ç»éªŒå¯¹æˆ‘æ€è€ƒæ–¹æ³•çš„å½±å“æœ‰é™ã€‚åœ¨æœ¬ä¹¦ä¸­ï¼Œæˆ‘è¿˜æ˜¯æƒ³å°†åœ¨åŒ—æœé²œç»å†è¿‡çš„ã€ä½“éªŒè¿‡çš„å†™å‡ºæ¥ã€‚</p></blockquote><p>æ‘˜æŠ„<a href="https://t.co/LWaF4VeGVq" target="_blank" rel="noopener">æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—æœé²œäººæ°‘çš„çœŸå®ç”Ÿæ´»</a></p><h3 id="å“ˆç»´å°”æ–‡é›†"><a href="#å“ˆç»´å°”æ–‡é›†" class="headerlink" title="å“ˆç»´å°”æ–‡é›†"></a>å“ˆç»´å°”æ–‡é›†</h3><p>ä¸‰æœˆä»½åœ¨è¯»ã€Šæˆ‘æ— ç½ªï¼šåˆ˜æ™“æ³¢ä¼ ã€‹çš„æ—¶å€™æ„å¤–æ”¶è·åˆ°çš„è¿™æœ¬ä¹¦ã€‚è¿™æœ¬ä¹¦å¹¶æ²¡æœ‰åœ¨å¤§é™†å…¬å¼€å‡ºç‰ˆï¼Œåªèƒ½æ‰¾åˆ°ä¸€ç‚¹ç”µå­ç‰ˆçš„æ¥çœ‹ã€‚æœ¬ä¹¦çš„ä½œè€…æ˜¯å“ˆç»´å°”ï¼Œå¤§é™†çš„è¯‘è€…æ˜¯å´”å«å¹³ã€‚å…ˆè¯´ä¸€ä¸‹ä½œè€…å“ˆç»´å°”ï¼Œä»–æ˜¯ä¸œæ¬§äººæ°‘æˆ˜èƒœå…±äº§ä¸»ä¹‰ä¹‹åï¼Œ1989å¹´12æœˆå½“é€‰çš„æ€»ç»Ÿã€‚åœ¨ä»–ä¸»æŒä¸‹ï¼Œæ·å…‹å’Œæ–¯æ´›ä¼å…‹å’Œå¹³åˆ†ç¦»ï¼Œä»–åˆå½“é€‰ä¸ºæ·å…‹å…±å’Œå›½é¦–ä»»æ€»ç»Ÿï¼Œç›´åˆ°2003å¹´è¿ä»»æœŸæ»¡ï¼Œæ‰å¸ä»»æ€»ç»ŸèŒåŠ¡ã€‚</p><p>ä½œä¸ºä¸€ä½æˆå‰§å®¶ã€ä½œå®¶å’Œå“²å­¦å®¶ï¼Œä»–æ˜¯è‘—åã€Šä¸ƒä¸ƒå®ªç« ã€‹è¿åŠ¨çš„å‘èµ·è€…å’Œæœ€æ—©çš„å‘è¨€äººä¹‹ä¸€ï¼Œä»–çš„æ€æƒ³æ·±åˆ»åœ°å½±å“äº†ä¸­å›½è‡ªç”±çŸ¥è¯†ç•Œã€‚1998å¹´ä¸€æ‰¹ä¸­å›½çš„è‡ªç”±çŸ¥è¯†åˆ†å­ï¼Œè¦å‡ºç‰ˆã€Šå“ˆç»´å°”æ–‡é›†ã€‹ï¼Œå…«ä¹æ°‘ä¸»è¿åŠ¨ä¸­â€œä¸åœ¨æªå£ä¸‹åšå®˜â€çš„å‰ä¸­å›½ç¤¾ä¼šç§‘å­¦é™¢å‰¯é™¢é•¿ <a href="https://zh.wikipedia.org/wiki/%E6%9D%8E%E6%85%8E%E4%B9%8B" target="_blank" rel="noopener">ææ…ä¹‹</a>ï¼Œä¸ºè¯¥ä¹¦å†™äº†åºâ€”â€”<a href="http://www.aisixiang.com/data/1724.html" target="_blank" rel="noopener">ã€Šæ— æƒè€…çš„æƒåŠ›å’Œåæ”¿æ²»çš„æ”¿æ²»ï¼šåææƒä¸»ä¹‰æ—¶ä»£çš„äººç”Ÿå“²å­¦ã€‹</a>ã€‚</p><p>ææ…ä¹‹ç§°å“ˆç»´å°”æ˜¯â€œæˆ‘ä»¬æ—¶ä»£æ°å‡ºçš„æ€æƒ³å®¶â€ã€‚ å“ˆç»´å°”æå‡ºâ€œæ— æƒè€…çš„æƒåˆ©â€çš„å“²å­¦å‘½é¢˜ï¼Œæ­ç¤ºäº†â€œ<strong>å› ä¸ºææƒ§ï¼Œæ•´ä¸ªç¤¾ä¼šçš„è°è¨€æœ‰äº†æœ€ç°å®ä¹Ÿæœ€å¦¥å½“çš„ç†ç”±ï¼Œå…¶ç»“æœå°±æ˜¯è´£ä»»æ„Ÿï¼Œå¯¹è‡ªå·±çš„è‰¯çŸ¥çš„è´£ä»»æ„Ÿï¼Œå¯¹ç¤¾ä¼šæ­£ä¹‰çš„è´£ä»»æ„Ÿçš„ä¸§å¤±</strong>ã€‚â€ææ…ä¹‹è®¤ä¸ºå“ˆç»´å°”çš„è¿™ä¸€å­¦è¯´â€œè‡³ä»Šä»æ—§æ˜¯å¯¹ææƒåˆ¶åº¦æœ€æ·±åˆ»çš„æ‰¹åˆ¤ã€‚â€å“ˆç»´å°”å‘åŠ¨çš„ã€Šä¸ƒä¸ƒå®ªç« ã€‹è¿åŠ¨ï¼Œå°±æ˜¯å…¬æ°‘è¡Œä½¿è‡ªå·±çš„æƒåˆ©ï¼Œæ•¢äºè®²çœŸè¯çš„è¿åŠ¨ã€‚ææ…ä¹‹ç§°èµå“ˆç»´å°”ï¼šâ€œä»–æœ€å¤§çš„åŠŸç»©å°±åœ¨äºæ•™å¯¼äººä»¬å¦‚ä½•åœ¨åææƒä¸»ä¹‰ç¤¾ä¼šå°Šä¸¥åœ°ç”Ÿæ´»ï¼Œåšä¸€ä¸ªçœŸæ­£çš„äººã€‚â€</p><blockquote><p>  å› ä¸ºææƒ§ã€‚æ¯ä¸ªäººéƒ½æœ‰ä¸œè¥¿å¯ä»¥å¤±å»ï¼Œå› æ­¤æ¯ä¸ªäººéƒ½æœ‰ç†ç”±ææƒ§ï¼šâ€œå› ä¸ºå®³æ€•å¤±å»è‡ªå·±çš„å·¥ä½œã€‚ä¸­å­¦è€å¸ˆè®²æˆä»–è‡ªå·±å¹¶ä¸ç›¸ä¿¡çš„ä¸œè¥¿ï¼Œå› ä¸ºæ€•è‡ªå·±çš„å‰é€”ä¸ç¨³ï¼›å­¦ç”Ÿè·Ÿåœ¨è€å¸ˆåé¢é‡å¤ä»–çš„è¯ï¼Œå› ä¸ºæ€•è‡ªå·±ä¸è¢«å…è®¸ç»§ç»­å­¦ä¸šï¼›é’å¹´äººåŠ å…¥å…±é’å›¢ï¼Œå‚åŠ ä¸è®ºæ˜¯å¦å¿…è¦çš„æ´»åŠ¨ã€‚åœ¨è¿™ç§ç•¸å½¢çš„åˆ¶åº¦ä¸‹ï¼Œå› ä¸ºææƒ§è‡ªå·±çš„å„¿å­æˆ–å¥³å„¿æ— æ³•åœ¨å­¦æ ¡é‡Œå–å¾—å¿…è¦çš„å‡å­¦æ€»åˆ†ï¼Œä½¿å¾—çˆ¶äº²é‡‡ç”¨â€˜è‡ªæ„¿â€™çš„æ–¹å¼å»åšæ¯ä¸€ä»¶è¢«è¦æ±‚çš„äº‹ã€‚ææƒ§çš„ç»“æœï¼Œå¯¼è‡´äººä»¬å‚åŠ é€‰ä¸¾ã€ç»™æ¨èå‡ºæ¥çš„å€™é€‰äººæŠ•ç¥¨ï¼Œå¹¶ä¸”å‡è£…ä»–ä»¬è®¤ä¸ºè¿™ç§å½¢åŒè™šè®¾çš„èµ°è¿‡åœºæ˜¯çœŸæ­£çš„é€‰ä¸¾ã€‚å‡ºäºå¯¹ç”Ÿè®¡ã€åœ°ä½æˆ–è€…å‰ç¨‹çš„ææƒ§ï¼Œä»–ä»¬æŠ•ç¥¨èµæˆæ¯ä¸€é¡¹å†³è®®ï¼Œæˆ–è€…è‡³å°‘ä¿æŒæ²‰é»˜â€¦â€¦ã€‚â€</p><p>  æ€æ ·æ‰èƒ½æ‰“ç ´è¿™ç§å› å¤„äºææƒ§ä¹‹ä¸­è€Œå‡­å€Ÿè°è¨€ç”Ÿæ´»çš„ç°å®å‘¢?å“ˆç»´å°”çš„ç­”æ¡ˆååˆ†ç®€å•ï¼Œå³â€œåœ¨çœŸå®ä¸­ç”Ÿæ´»â€ï¼Œæˆ–æ›°â€œåœ¨çœŸç†ä¸­ç”Ÿæ´»â€ï¼Œè‹±æ–‡æ˜¯Living in Truth!è¿™å¥è¯çœ‹èµ·æ¥å¤ªç†æƒ³ã€å¤ªè™šæ— é£˜æ¸ºï¼Œä½†æ˜¯æˆ‘å€’ä¹Ÿä¸æƒ³å»ºè®®è¯‘è€…æ”¹å˜è¯‘æ–‡ï¼Œå› ä¸ºå¦‚æœç”¨å¤§ç™½è¯æ¥è¯´ï¼Œå®ƒæ— éæ˜¯æŒ‡â€œè¿‡è¯´çœŸè¯çš„æ—¥å­â€æˆ–è€…æ˜¯â€œç”Ÿæ´»åœ¨çœŸè¯ä¸­â€ã€â€œåšä¸€ä¸ªè¯´çœŸè¯çš„äººâ€è€Œå·²ã€‚</p></blockquote><p>æ‘˜æŠ„<a href="https://t.co/3yjW5T3OW4" target="_blank" rel="noopener">å“ˆç»´å°”æ–‡é›†</a></p><h3 id="å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ"><a href="#å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ" class="headerlink" title="å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ"></a>å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ</h3><p>åœ¨äºŒæœˆä»½çš„æ—¶å€™å‰©ä½™ä»·å€¼é‡Œçš„ä¸€æœŸèŠ‚ç›®ä¸­æåˆ°è¿‡ã€Šå¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆã€‹ã€‚æœ¬ä¹¦é€šè¿‡å†·æˆ˜æ—¶æœŸåŒˆç‰™åˆ©ç§˜å¯†è­¦å¯Ÿé•¿è¾¾20å¹´çš„æ¡£æ¡ˆï¼Œæ‰€æ­å¼€çš„æ˜¯ä¸€éƒ¨éšè—äº†å‡ åå¹´çš„å®¶åº­å†å²å’Œæ—¶ä»£ä¾§è®°ã€‚</p><p>å†·æˆ˜æ—¶æœŸï¼Œè‹è”é›†å›¢ä¸­çš„åŒˆç‰™åˆ©ï¼Œç§˜å¯†è­¦å¯Ÿé€šè¿‡åºå¤§çš„å‘Šå¯†ç½‘ï¼Œè¯•å›¾å…¨é¢æ¸—é€æ§åˆ¶åŒˆç‰™åˆ©çš„æ”¿æ²»ç”Ÿæ´»ã€‚ä½œè€…çš„çˆ¶æ¯åŸæ˜¯åŒˆç‰™åˆ©è‘—åè®°è€…ï¼Œä»–ä»¬çš„æŠ¥é“æ˜¯è¥¿æ–¹äº†è§£åŒˆç‰™åˆ©çš„é‡è¦ä¿¡æ¯æ¥æºã€‚å› æ­¤ä»–ä»¬è¢«è§†ä¸ºâ€œäººæ°‘çš„æ•Œäººâ€ï¼Œé•¿æœŸå—ç§˜å¯†è­¦å¯Ÿçš„ç›‘æ§ï¼Œç»ˆå› å›å›½å’Œé—´è°ç½ªè€Œå…ˆåå…¥ç‹±ã€‚ä¸€å®¶ç§»å±…ç¾å›½åï¼ŒåŒˆç‰™åˆ©æ”¿åºœå´åˆå¼‚æƒ³å¤©å¼€åœ°è¯•å›¾æ‹›å‹Ÿä»–ä»¬å½“é—´è°ï¼Œè€Œç¾å›½ä¹Ÿå¯¹ä»–ä»¬è¿›è¡Œäº†å‡ å¹´çš„ç›‘æ§ã€‚ä¹¦ä¸­ä¸åªè¿˜åŸäº†é©¬é¡¿å¤«å¦‡è¢«å‘Šå¯†è€…åŒ…å›´çš„ç»å†å’Œé­é‡ï¼Œä»–ä»¬çš„æŠ—äº‰ã€åšå®ˆã€è„†å¼±å’Œå‹‡æ°”ï¼Œä¹Ÿå±•ç°äº†ä»–ä»¬æƒ…æ„Ÿå’Œå†…å¿ƒçš„çŸ›ç›¾â€”â€”å¤«å¦»ä¹‹é—´ç›¸äº’çš„æ„Ÿæƒ…èƒŒå›ä¸ç¾éš¾ä¸­çš„æ”¯æ’‘ï¼Œçˆ¶æ¯å­å¥³ä¹‹é—´çš„çˆ±ä¸äº²æƒ…ï¼Œäººæ€§çš„åšå¼ºä¸è½¯å¼±ï¼Œä»è€Œä½¿å¾—è¿™æœ¬ä¹¦æ›´ä¸ºä¸°å¯Œã€å¤æ‚ï¼Œå…·æœ‰è¡€è‚‰ã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯è¿™æœ¬ä¹¦ï¼Œè€Œè¿™æœ¬ä¹¦çš„åºè¨€æ­£æ˜¯å¾è´²è€å¸ˆå†™çš„ã€‚</p><blockquote><p>  è¿™ç§ç»Ÿæ²»ä¸‹çš„ææƒ§ã€å±ˆè¾±ã€å‹æŠ‘å’Œç»æœ›ï¼Œè¿™æ ·çš„è‹¦éš¾è®©ç†¬è¿‡æ¥çš„å’Œè¿˜æœªç†¬è¿‡æ¥çš„äººä»¬éƒ½æ›´åŠ æœŸå¾…ä¸€ä¸ªèƒ½è®©æ‰€æœ‰äººè‡ªç”±ã€å¹³ç­‰ã€æœ‰å°Šä¸¥çš„ç”Ÿæ´»ä¸–ç•Œï¼Œä¹Ÿæ›´åŠ æœŸå¾…ä¸€ç§äººä¸äººèƒ½å¤Ÿå½¼æ­¤ä¿¡ä»»ï¼Œè€Œä¸æ˜¯ç›¸äº’èƒŒå›ã€å‡ºå–çš„ç”Ÿå­˜æ–¹å¼ã€‚è¿™ç§æœŸå¾…ä¸­åŒ…å«ç€å¯¹äººç±»æœªæ¥çš„å¸Œæœ›ï¼Œã€Šå¸ƒè¾¾ä½©æ–¯å¾€äº‹ã€‹ä¹‹æ‰€ä»¥æ„Ÿäººï¼Œæ­£æ˜¯å› ä¸ºå®ƒä¼ é€’äº†è¿™æ ·çš„å¸Œæœ›è®¯æ¯ã€‚</p></blockquote><p>æ‘˜æŠ„ <a href="https://t.co/NmRoJATcau" target="_blank" rel="noopener">å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ</a></p><h3 id="äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†"><a href="#äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†" class="headerlink" title="äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†"></a>äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†</h3><p>ä¹‹å‰æˆ‘ä¹Ÿè¯»è¿‡å¾è´²çš„è®ºæ–‡ <a href="https://matters.news/@philosophia1979/å¾è´²-ä¸­å›½çš„-æ–°ææƒä¸»ä¹‰-åŠå…¶æœ«ä¸–æ™¯è±¡-é‡å…½èè¯»-bafyreiegbg5tti3ljc7newaah5wp36ncf7fvb2oaovd6p7elc4xqfhbcd4" target="_blank" rel="noopener">ã€Šä¸­å›½çš„â€œæ–°ææƒä¸»ä¹‰â€åŠå…¶æœ«ä¸–æ™¯è±¡ã€‹</a>) ï¼Œæ‰€ä»¥å¯¹ä»–å…³æ³¨çš„å†…å®¹ä¹Ÿæœ‰æ‰€äº†è§£ã€‚æ€»æ„Ÿè§‰è¿™æœ¬ä¹¦æ›´åƒæ˜¯é˜¿ä¼¦ç‰¹ã€åŠ ç¼ªã€è¨ç‰¹ã€å“ˆç»´å°”ç­‰äººå¯¹äºææƒä¸»ä¹‰è‘—ä½œåŠæ€æƒ³çš„è§£æã€‚å°±åƒåœ¨å‰©ä½™ä»·å€¼é‡Œæåˆ°çš„ï¼Œæˆ‘ä»¬è¯»è¿™äº›å†å²çš„æ—¶å€™ï¼Œè€Œå½“ä¸‹å°±ä»¿ä½›ç½®èº«äºå†å²ä¹‹ä¸­ä¸€æ ·ã€‚ä¹¦ä¸­è®°å½•è‹è”å’Œçº³ç²¹å¾·å›½ææƒç»Ÿæ²»æ”¹é€ äººæ€§çš„è¨€è®ºå®¡æŸ¥ã€ç§˜å¯†è­¦å¯Ÿã€é›†ä¸­è¥ã€æ— è¨€è®ºè‡ªç”±å’Œæ–°é—»è‡ªç”±ã€å…šåª’æ„šæ°‘æ´—è„‘ç­‰ï¼Œè¿™äº›æè¿°ææƒç»Ÿæ²»çš„å†å²ï¼Œå†çœ‹ä¸€çœ‹å½“ä¸‹ï¼Œæˆ‘ä»¬ä¸æ­£ç½®èº«äºå…¶ä¸­å—ï¼Ÿ</p><ul><li><strong>æ¯”ç˜Ÿç–«æ›´å¯æ€•çš„æ˜¯è¬Šè¨€ï¼Œæ¯”ç½é›£æ›´å¯æ€•çš„æ˜¯éºå¿˜</strong></li></ul><blockquote><p>  <strong>å‰©ä½™ä»·å€¼ï¼š</strong> ææµ·é¹ä¹‹å‰å‘äº†ä¸€æ¡å¾®åšï¼Œå¤§æ¦‚æ˜¯è¯´ï¼Œä¸€ä¸ªä¸¾å›½ä½“åˆ¶çš„éšæ‚£åˆ°æœ€åå¯èƒ½åˆä¼šå˜æˆä¸€ä¸ªä¸¾å›½ä½“åˆ¶çš„èƒœåˆ©ã€‚</p><p>  <strong>ç½—æ–°ï¼š</strong>å†å²å­¦è€…è®¤ä¸ºï¼Œåœ¨è¥¿æ–¹ï¼Œä½ çœ‹åˆ°æ‰€æœ‰çš„æˆ˜äº‰ã€ç¾éš¾æ€§çš„é©å‘½æˆ–è€…æ˜¯ä½“åˆ¶æ€§çš„å´©æºƒï¼Œå…¶åæœå¯èƒ½æ˜¯å¼•èµ·äº†ä¸€æ³¢æ–°çš„å†å²ä¸Šå‡æœŸã€‚æ¯”å¦‚ç¾å›½åœ¨ç»æµå¤§è§æ¡ä¹‹åï¼Œç»æµåè€Œæœ‰æ‰€å›å‡ï¼Œåè€Œå¼€é€šäº†ä¸€æ¡å‘ä¸Šçˆ¬çš„æ–°çš„é“è·¯ã€‚ä½†æ˜¯ç ”ç©¶è€…ä¹Ÿå‘ç°ï¼Œåœ¨ä¸œæ–¹ä¸ä¸€å®šæ˜¯è¿™æ ·ï¼Œç¾éš¾ä¹‹åå¯èƒ½æ˜¯æ›´å¤§çš„ç¾éš¾ï¼Œæ›´å¤§çš„ç¾éš¾åé¢è¿˜æœ‰æ›´å¤§çš„ç¾éš¾ï¼Œå¼•å‘ç¾éš¾çš„é‚£äº›å› ç´ ä¸ä»…å¾—ä¸åˆ°ä¿®æ­£ï¼Œè¿˜å¾—åˆ°äº†åŠ å¼ºåŒ–ã€‚è¿™æ˜¯æˆ‘ä»¬è¦æ³¨æ„çš„ã€‚äººä»¬è¯´ï¼Œéƒ½å‘ç”Ÿäº†è¿™ä¹ˆå¤§çš„äº‹ï¼Œæˆ‘ä»¬è¯¥ä¸è¯¥åæ€äº†ï¼Ÿè¦å°å¿ƒï¼Œå¯èƒ½æ²¡æœ‰åæ€ï¼Œå¯èƒ½æ˜¯å¼ºåŒ–ã€‚</p></blockquote><p>ä¸€åœºç¾éš¾å˜æˆäº†ä¸€åœºä¸¾å›½ä½“åˆ¶çš„èƒœåˆ©ï¼Œæ˜¯æˆ‘ä»¬çš„æ‚²å“€ä¹Ÿæ˜¯å…¨ä¸–ç•Œè¢«æ–°å† ç—…æ¯’æŠ˜ç£¨äººçš„ä¸å¹¸ã€‚ä¸€äº›æ— è€»çš„äººä¸§å°½å¤©è‰¯è¿˜åœ¨å®£ä¼ ä»€ä¹ˆæ­£ç¡®çš„é›†ä½“è®°å¿†ï¼ŒæŠ—ç–«ä¸»æ—‹å¾‹ï¼Œå¥½å¤šäººçš„ç”Ÿå‘½å°±è¿™æ ·è¢«å®å¤§å™äº‹æŠ¹æ€æ‰äº†ã€‚</p><blockquote><p>  å› ä¸ºæŠ—ç–«å™äº‹ä¸èƒ½è¢«è°è¨€è¯¯å¯¼ç·æ±¡ï¼Œè€Œåº”ç•™ä¸‹æ­£ç¡®çš„äººç±»é›†ä½“è®°å¿†</p></blockquote><p><img src="img/image-20210106235706623.png" alt="image-20210106235706623"></p><p><img src="img/image-20210106235547786.png" alt="image-20210106235547786"></p><blockquote><p>  â€œå¯¹äºä¸€ä¸ªæ°‘æ—æ¥è¯´ï¼Œè®°å¿†å¯¹é—å¿˜çš„æŠ—æ‹’ï¼Œé¦–å…ˆæ˜¯çŸ¥è¯†ç²¾è‹±çš„è‰¯çŸ¥å¯¹å¼ºæƒçš„æŠ—æ‹’ã€‚å¦åˆ™çš„è¯ï¼Œæˆ‘ä»¬éä½†æ— æ³•æŠŠå…­å››å¤§å± æ€çš„çœŸç›¸ã€è¿›è€ŒæŠŠç‹¬è£åˆ¶åº¦çš„ç½ªæ¶å˜æˆæ°‘ä¼—çš„å†å²å¸¸è¯†ï¼Œä¹Ÿæ— æ³•é˜²æ­¢ç±»ä¼¼å¤§æ‚²å‰§çš„é‡æ¼”ã€‚éš¾é“ä¸­å›½å†å²åœ¨ä¸“åˆ¶ä¸‹æ¶æ€§å¾ªç¯çš„æ—¶é—´è¿˜ä¸å¤Ÿé•¿å—ï¼Ÿâ€</p></blockquote><p>æœ€ç»ˆï¼Œå› ä¸ºé—å¿˜ç½ªæ¶å†å²è€Œå—å®³çš„ï¼Œåªä¼šæ˜¯ä¸­å›½äººè‡ªå·±ã€‚</p><p><strong>â€œç”¨æ°‘é—´è®°å¿†æŠ—æ‹’å®˜æ–¹çš„å¼ºåˆ¶é—å¿˜ï¼Œå°±æ˜¯ä¸ºæˆ‘ä»¬è¿™ä¸ªå†å°½è‹¦éš¾çš„æ°‘æ—ä¿å­˜è®°å¿†å’Œè‰¯çŸ¥ã€‚â€</strong></p><blockquote><p>  äººæ°‘â€œè·å¾—â€çš„â€œå›½å®¶å†å²â€æ˜¯é‚£äº›è®°å½•ä¸‹æ¥ï¼Œæˆ–è€…è¯´è¢«æƒåŠ›å…è®¸è®°å½•ä¸‹æ¥çš„â€œäº‹ä»¶â€ï¼Œè€Œé‚£äº›æ²¡æœ‰è¢«è®°å½•æˆ–ä¸è¢«å…è®¸è®°å½•ä¸‹æ¥çš„äº‹ä»¶ï¼Œå°±æ­¤è¢«æ­¦æ–­åœ°ä»å›½å®¶å†å²ä¸­å‰”é™¤ï¼Œä¹Ÿä»æ—ç¾¤è®°å¿†ä¸­æ’æ–¥å‡ºå»äº†ã€‚å› æ­¤ï¼Œå¯¹å†å²çœŸå®ä¿æŒæ²‰é»˜ï¼Œè™½ç„¶æ˜¯ä»æ”¹å†™å†å²å¼€å§‹ï¼Œä½†æœ€ç»ˆå´è¡¨ç°ä¸ºæ—ç¾¤çš„é›†ä½“å¿˜å´ã€‚æ¯ä¸ªæ²‰é»˜çš„ä¸ªäººï¼Œæ¯ä¸ªåœ¨æ—ç¾¤ä¸­æŒ‰æƒåŠ›æ„å¿—æ¥è®°å¿†æˆ–å¿˜å´çš„äººï¼Œéƒ½å‚ä¸åœ¨ä»¥æ²‰é»˜ä»£æ›¿çœŸå®ï¼Œä»¥æ²‰é»˜ç»´æŒè°è¨€çš„å…±è°‹ä¹‹ä¸­ã€‚</p></blockquote><p>æƒ³èµ·äº† ã€Š1984ã€‹ é‡Œçš„ä¸€æ®µè¯ï¼Œæˆ–è®¸ç”¨ææƒä¸»ä¹‰æ¥è§£é‡Šå½“ä¸‹æœ€é€‚åˆä¸è¿‡äº†ï¼š<strong>ææƒæœ€æœ‰æ•ˆçš„ç»Ÿæ²»æœ¯æ˜¯ä»‡æ¨æ•™è‚²ï¼Œå¡‘é€ ä¸€ä¸ªè¿œåœ¨å¤©è¾¹çš„å¤–åœ¨æ•Œäººï¼Œäººä»¬å°±ä¼šå¿˜è®°èº«è¾¹çš„ç—›è‹¦ã€‚</strong></p><p>æ‘˜æŠ„ <a href="https://t.co/qZ2ID5XeuR" target="_blank" rel="noopener">äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†</a></p><h3 id="é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–"><a href="#é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–" class="headerlink" title="é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–"></a>é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–</h3><p>æ°å¥½è¯»å®Œè¿™æœ¬ä¹¦ä¹‹åä¸ä¹… B ç«™å°±ä¸Šæ˜ äº†åæµªæ´—è„‘å®£ä¼ ç‰‡ï¼Œä¸æ–™å¾®åšè¯„è®ºåŒºä¹Ÿæ˜¯ç¿»è½¦ç°åœºğŸ¤£</p><p>ç¬¬ä¸€æ¬¡å¬è¯´åˆ°åæµªçš„æ—¶å€™æˆ‘å°±è§‰ç€ï¼Œè¿™ç±»èº«å±…é«˜ä½çš„çŠ¬å„’çŸ¥è¯†ä»½å­ï¼Œå¦‚èƒ¡é”¡è¿›ã€èƒ¡éé’¢ã€é‡‘ç¿è£ã€å¼ ç»´ä¸ºè¿™ç±»ï¼Œä¸ºå½“æƒè€…æ­ŒåŠŸèµå¾·ã€æ‹é©¬æºœé¡»ã€è°„åªšçŒ®åªšã€é˜¿è°€å¥‰æ‰¿ã€‚è¿™ç±»äººåº”è¯¥æ¯”ä»»ä½•äººéƒ½æ¸…æ¥šåœ¨è¿™å¤ªå¹³ç››ä¸–çš„èƒŒåï¼ŒæŠ“æ•äº†å¤šå°‘ç»´æƒå¾‹å¸ˆã€è¿«å®³äº†å¤šå°‘å¼‚è®®äººå£«ã€å…³æŠ¼äº†å¤šå°‘å…¬æ°‘è®°è€…ã€å¤„åˆ†äº†å¤šå°‘ç›´è¨€æ•™å¸ˆã€‚ç„¶è¿™äº›çŸ¥è¯†åˆ†å­ã€æ•™æˆã€ä¸“å®¶åœ¨è¯´å‡è¯ï¼Œç”¨æ‰€è°“çš„â€å­¦æœ¯â€æ¥å–æ‚¦å’ŒæŠ•é æƒåŠ›å’Œå½“æƒè€…,è°‹å–ç§åˆ©ï¼Œä»¥è²Œä¼¼é«˜æ·±ã€æ¸Šåšã€ç²¾è‡´çš„ç†è®ºåŒ…è£…æ™®é€šäººç”¨å¸¸è¯†å°±èƒ½çœ‹ç©¿çš„æ…Œè¨€ï¼Œæœ‰çš„ç”šè‡³è¿˜ç›¸å½“â€å¯Œæœ‰åˆ›æ„â€ï¼Œå–„äºâ€ç†è®ºæ›´æ–°â€,æˆ–æœ‰â€ç†è®ºå»ºæ ‘â€ã€‚</p><p><img src="img/image-20210106235133212.png" alt="image-20210106235133212"></p><p>åœ¨æ”¿æ²»æ„è¯†å½¢æ€ä¸»å¯¼ä¸€åˆ‡,æƒåŠ›å¯ä»¥æ“æ§ä¸€åˆ‡çš„ç¤¾ä¼šé‡Œ,ä¸å­˜åœ¨æ‰€è°“çš„â€ç‹¬ç«‹å­¦æœ¯â€,å°¤å…¶ä¸å­˜åœ¨ç‹¬ç«‹çš„äººæ–‡å­¦æœ¯ã€‚ä¸€äº›çŸ¥è¯†åˆ†å­å› ä¸ºä¸å¾—å·²è€Œåšâ€çº¯å­¦é—®â€,æ˜¯ä¸€ç§æ†‹å±ˆçš„å­¦æœ¯â€è‡ªå®«â€ã€‚æƒåŠ›çš„å’¸èƒä¸åˆ©è¯±é€ å°±ä½“åˆ¶æ€§çš„â€å­¦æœ¯ä¹‰å„’â€,å®ƒå¾€å¾€æ˜¯ä¸€ç§åœ¨æ¸…é†’çŠ¶æ€ä¸‹çš„è£…å‚»â€”â€”ä¸€é¢è‡ªå˜²,ä¸€é¢é…åˆä½“åˆ¶,ç§¯æè‡ªæˆ‘å®¡æŸ»ï¼›ä¸€é¢å’’éª‚,ä¸€é¢è¿åˆä½“åˆ¶çš„æ— ç†è¦æ±‚ï¼›ä¸€é¢é„™è§†ä¸æ‡‚å­¦æœ¯çš„é¡¶å¤´ä¸Šå¸,ä¸€é¢é¡ºä»ä»–ä»¬çš„é¢†å¯¼æƒå¨ï¼›ä¸€é¢å˜²ç¬‘,ä¸€é¢å‚ä¸ä¸ºå®˜å‘˜æˆäºˆå„ç§çœŸçš„å‡å­¦ä½å’Œå‡å¤´è¡”ã€‚</p><blockquote><p>  é˜¿ä¼¦ç‰¹åœ¨1963å¹´7æœˆ24æ—¥ç»™å‹äººå¡æ–¯è´å°”ï¼ˆGerhard Casperï¼‰çš„ä¿¡é‡Œå†™é“:â€äººä»¬ç»å¸¸å‘ç°,æ´—è„‘æ¬ºéª—æœ€è‚¯å®šçš„é•¿æœŸåæœå°±æ˜¯é€ æˆçŠ¬å„’ä¸»ä¹‰â€”â€”ç»å¯¹ä¸ç›¸ä¿¡ä»»ä½•äº‹æƒ…å¯èƒ½æ˜¯çœŸçš„,å“ªæ€•æ˜¯ç¡®æœ‰å®æ®çš„çœŸå®,ä¹Ÿç…§æ ·ä¸ç›¸ä¿¡ã€‚æ¢è¨€ä¹‹,å®Œå…¨ç”¨è°è¨€æ¥ä»£æ›¿äº‹å®çœŸç›¸çš„ç»“æœä¸æ˜¯äººä»¬ä¼šæŠŠè°è¨€å½“ä½œçœŸå®,æˆ–è€…çœŸå®ä¼šè¢«å½“ä½œä¸ºè°è¨€,è€Œæ˜¯æˆ‘ä»¬èµ–ä»¥åœ¨çœŸå®ä¸–ç•Œé‡Œå­˜åœ¨çš„çŸ¥è§‰ä¼šè¢«å®Œå…¨æ‘§æ¯ã€‚äººç±»ä¸ºäº†ç”Ÿå­˜,å¿…é¡»å…·å¤‡åŸºæœ¬çŸ¥è§‰,å…¶ä¸­å°±æœ‰å¯¹çœŸå’Œå‡çš„è¯†åˆ«ã€‚â€</p></blockquote><blockquote><p>  é˜¿ä¼¦ç‰¹è®¤ä¸º,ç¤¾ä¼šä¸­çš„å¤šæ•°äººé›†ä½“æŠ•å‘çŠ¬å„’ä¸»ä¹‰,æ˜¯å› ä¸ºæ”¿æ²»æƒåŠ›é•¿æœŸç”¨è°è¨€æ¥ä»£æ›¿çœŸå®,å¤§è§„æ¨¡åœ°å¯¹ç¾¤ä¼—è¿›è¡Œæ´—è„‘å¹¶æ¬ºéª—ä»–ä»¬ã€‚è¿™æ˜¯20ä¸–çºªæ‰æœ‰çš„ç»Ÿæ²»æ–¹å¼,æœ€å…¸å‹çš„ä¾‹å­å°±æ˜¯æ–¯å¤§æ—ç»Ÿæ²»æ—¶æœŸå¦è®¤æ‰˜æ´›èŒ¨åŸºæ›¾å¯¹ä¿„ç½—æ–¯é©å‘½æœ‰è¿‡ä»»ä½•è´¡çŒ®ã€‚é˜¿ä¼¦ç‰¹ç§°æ­¤ä¸ºâ€ææƒè°è¨€â€,å®ƒè¦ç¼–é€ çš„æ˜¯ä¸€ç§å®Œå…¨è™šå‡çš„,å› æ­¤å½»åº•é¢ è¦†çœŸä¼ªåŒºåˆ«çš„â€çœŸå®â€ã€‚</p></blockquote><p><strong>çŠ¬å„’ä¸»ä¹‰ï¼š</strong></p><ul><li>ï¼ˆ1ï¼‰å¨±ä¹è‡³æ­»ï¼ˆæ²¡æœ‰ç›®æ ‡æˆ–ä¿¡ä»°,å¾—è¿‡ä¸”è¿‡ï¼‰ï¼›</li><li>ï¼ˆ2ï¼‰çœ‹å®¢å¿ƒæ€ï¼ˆçœ‹ç©¿ã€å†·æ¼ ã€å›´è§‚,ç®¡äº†ä¹Ÿæ²¡ç”¨,ä¸å¦‚ä¸ç®¡ï¼‰ï¼›</li><li>ï¼ˆ3ï¼‰ä¹ æƒ¯æ€§æ€€ç–‘ï¼ˆä¸Šè‡³æ”¿åºœ,ä¸‹è‡³æœ‹å‹,å¯¹è°éƒ½ä¸ä¿¡ä»»,éƒ½ä¸ç›¸ä¿¡ï¼‰ï¼›</li><li>ï¼ˆ4ï¼‰å®¡ä¸‘å¿ƒç†ï¼ˆåœ¨ä¸€ä¸ªæ˜¯éä¸åˆ†çš„ç¯å¢ƒé‡Œ,ç¾ä¸‘ã€å–„æ¶ã€çœŸå‡ä¹Ÿæ— æ³•è¾¨åˆ«,ä½•å¿…è¦åšæŒçœŸã€å–„ã€ç¾ï¼‰ï¼›</li><li>ï¼ˆ8ï¼‰â€é¸µé¸Ÿå¿ƒæ€â€ï¼ˆå¤šä¸€äº‹ä¸å¦‚å°‘ä¸€äº‹,è¢«å®£ä¼ çš„ç°å®åæ­£æ˜¯å‡çš„,ä¸å¦‚â€èº²è¿›å°æ¥¼æˆä¸€ç»Ÿâ€ï¼‰;</li><li>ï¼ˆ9ï¼‰æ€è€ƒææƒ§ç—‡ï¼ˆå¤šæ€å¤šæƒ¹äº‹,æœ‰çš„æ˜¯å‰è½¦ä¹‹é‰´,ä½ è¦æˆ‘æ€ä¹ˆè¯´,æˆ‘å°±æ€ä¹ˆè¯´,è¿™æ‰æ˜¯å®‰èº«ä¿å‘½ä¹‹é“ï¼‰ï¼›</li><li>ï¼ˆ11ï¼‰ç‚«å¯Œå¿ƒæ€ï¼ˆçœ‹ç©¿ä¸€äº›é“å¾·ã€ç†æƒ³ã€æœªæ¥å±•æœ›çš„è™šå¦„,åªæœ‰é’±æ‰æ˜¯å®åœ¨çš„,æ‰æ˜¯ä¸–äººè®¤å¯çš„å”¯ä¸€ä»·å€¼ï¼‰ï¼›</li><li>ï¼ˆ12ï¼‰åˆè€ç—‡ï¼ˆæ²¡æœ‰å‰é€”ã€æ²¡æœ‰æœªæ¥ã€æ²¡æœ‰è¿½æ±‚,è¿‡ä¸€å¤©ç®—ä¸€å¤©,ååƒç­‰æ­»ï¼‰ï¼›</li><li>ï¼ˆ13ï¼‰è‡ªè™å¿ƒæ€ï¼ˆè¿™ä¸ªè¯´æ³•å¹¶ä¸ç¡®å®,å› ä¸ºä¸€èˆ¬äººæ—¢éå…±äº§å…šåˆéä½“åˆ¶,ä¸æ˜¯â€è‡ªè™â€,è¿™ç§é¡¾å·¦å³è€Œè¨€ä»–çš„è¯´æ³•,æ˜ç™½äººè¯´ç³Šæ¶‚è¯,æ—¢ä¸è¯šå®,ä¹Ÿä¸çœŸå®,å®ƒæœ¬èº«å°±æ˜¯çŠ¬å„’ä¸»ä¹‰çš„ï¼‰ã€‚</li></ul><blockquote><p>  å¯¹çŠ¬å„’çš„ç°ä»£å®šä¹‰æ˜¯æœ‰ä»£è¡¨æ€§çš„:ä¸€ã€æŒ‘åˆºã€å˜²ç¬‘ã€è®½åˆºï¼›äºŒã€ä¸ç›¸ä¿¡æˆ–è£…ç€ä¸ç›¸ä¿¡æ™®é€šäººæ¥å—çš„é“å¾·ä»·å€¼è§‚å’Œäººç±»è¡Œä¸ºçœŸè¯šçš„å–„è‰¯åŠ¨æœº,æŠŠè‡ªç§è‡ªåˆ©è®¤ä½œå”¯ä¸€å¯èƒ½çš„åŠ¨æœºï¼›è½»è”‘ã€é„™è§†ã€å˜²è®½çš„æ€€ç–‘å’Œä¸ç›¸ä¿¡ã€‚</p></blockquote><p>åˆ˜æ™“æ³¢æ›¾åœ¨ <a href="http://www.liu-xiaobo.org/blog/archives/12412" target="_blank" rel="noopener">åˆ˜æ™“æ³¢ï¼šåœ¨åˆ€é”‹ä¸Šè¡Œèµ°â€”â€”ç‹±ä¸­è¯»ã€Šå¸ƒæ‹‰æ ¼ç²¾ç¥ã€‹</a> å†™è¿‡ï¼š</p><blockquote><p>  æ®å…‹é‡Œç›çš„ä»‹ç»ï¼Œåœ¨å‰è‹ä¸œææƒä¸‹çš„æ·å…‹çŸ¥è¯†åˆ†å­ç¾¤ä½“ä¸­ï¼Œä¸ä»…å‡ºç°äº†å“ˆç»´å°”è¿™æ ·çš„é“ä¹‰ç¤ºèŒƒï¼Œè€Œä¸”æœ‰95ï¼…ä»¥ä¸Šçš„äººä¸ºäº†è‡ªç”±å’Œè‰¯çŸ¥è€Œè¿›è¡Œç€å„ç§å½¢å¼çš„æ‹’ç»ï¼Œåªæœ‰ä¸åˆ°5%çš„äººç”˜æ„¿å •è½ä¸ºå–èº«æŠ•é è€…ã€‚è¿™å½“ç„¶æ˜¯è®©ä¸­å›½çŸ¥è¯†åˆ†å­è‡ªè§‰ç¾æ„§çš„è¡¨ç°ã€‚æˆ‘ä»¬æ²¡æœ‰æ·å…‹äººé‚£ç§æ¸…é†’å’ŒåšéŸ§ï¼Œä»…ä»…åå¹´çš„æ—¶é—´ï¼Œå…­å››çš„ä¼¤å£ä¾¿è¢«é—å¿˜ï¼Œè¿™ä¸å…‰æ˜¯å› ä¸ºå®˜æ–¹çš„å¼ºåˆ¶ï¼Œä¹Ÿæ˜¯æ°‘æ—çµé­‚çš„å†·æ¼ ã€‚çŸ¥è¯†åˆ†å­ç¾¤ä½“ä¸èƒ½ä»¥è¨€è¡Œæ¥æ´—åˆ·è€»è¾±ï¼Œæ—¢æºäºå¤–åœ¨çš„æ”¿æ²»ææ€–ï¼Œæ›´æºäºä»–ä»¬ç”Ÿå‘½ä¸­æ´—åˆ·è€»è¾±çš„å†²åŠ¨å·²ç»æ­»äº¡ã€‚</p></blockquote><p>æ‘˜æŠ„<a href="https://t.co/3C2OUjki3P" target="_blank" rel="noopener">é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–</a></p><h3 id="ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘"><a href="#ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘" class="headerlink" title="ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘"></a>ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘</h3><blockquote><p>  ææƒæ”¿ä½“å½»åº•æ§åˆ¶ä¸æ€æƒ³ã€è¨€è®ºã€æ–°é—»æœ‰å…³çš„è¦å®³é¢†åŸŸï¼Œæ•™è‚²æ˜¯è¢«ç®¡åˆ¶å¾—æœ€ä¸¥å‰çš„é¢†åŸŸä¹‹ä¸€ï¼Œå’Œå®£ä¼ ä¸€æ ·ï¼Œè¢«ä¸¥æ ¼æ§åˆ¶ã€‚è¿™æ ·çš„æ•™è‚²è™½ç„¶ä¸æ°‘ä¸»å›½å®¶çš„æ•™è‚²ä¸€æ ·è¢«ç§°ä¸ºâ€œæ•™è‚²â€ï¼Œä½†å®é™…ä¸Šå·²ç»æˆä¸ºæ”¿æ²»æƒåŠ›æ§åˆ¶å›½æ°‘æ€æƒ³å’ŒåŸ¹å…»å­æ°‘çš„å·¥å…·ã€‚è¿™ä¸æ°‘ä¸»å›½å®¶ä¸­å­¦æ ¡æ•™è‚²ä½œä¸ºå…¬æ°‘ç¤¾ä¼šæ–‡åŒ–æœºåˆ¶çš„ä¸€éƒ¨åˆ†ï¼Œèµ·åˆ°åŸ¹å…»æ°‘ä¸»å…¬æ°‘çš„ä½œç”¨ï¼Œæ˜¯å®Œå…¨ä¸åŒçš„ã€‚</p></blockquote><blockquote><p>  çº³ç²¹ç»Ÿæ²»å¾·å›½ï¼Œä¾é çš„ä¸ä»…æ˜¯å®Œå…¨ç”±çº³ç²¹æ§åˆ¶å’Œæ“çºµçš„å›½å®¶æœºå™¨ï¼Œæ”¿åºœã€å„çº§çº³ç²¹å…šç»„ç»‡ã€å…šå«å†›ã€å†²é”‹é˜Ÿã€è­¦å¯Ÿç­‰ï¼Œè€Œä¸”æ›´æ˜¯æ— å¤„ä¸åœ¨çš„çº³ç²¹æ„è¯†å½¢æ€ï¼Œå®ƒæ¸—é€åˆ°å¾·å›½ç¤¾ä¼šã€æ–‡åŒ–ã€æ•™è‚²å’Œå®¶åº­ç”Ÿæ´»çš„æ¯ä¸€ä¸ªè§’è½ï¼Œç¡®ä¿çº³ç²¹æ”¿å…šæˆä¸ºå¾·å›½ä¸»æƒçš„å†…æ ¸ã€‚æ­£æ˜¯ç”±äºçº³ç²¹æ”¿å…šå®é™…ä¸Šå·²ç»æˆä¸ºå¾·å›½ä¸»æƒçš„å†…æ ¸ï¼Œå¾·å›½çš„å›½å®¶ä¸»ä¹‰æ‰ä¼šæŒ‰ç…§çº³ç²¹çš„æ„å¿—è½¬å˜ä¸ºç¬¦åˆçº³ç²¹å…šåˆ©ç›Šï¼Œå¹¶ä¸ºå®ƒçš„åˆ©ç›ŠæœåŠ¡çš„å…šå›½ä¸»ä¹‰ã€‚</p></blockquote><blockquote><p>  åœ¨çº³ç²¹çš„ææƒç»Ÿæ²»åˆ¶åº¦ä¸­ï¼Œå­¦æ ¡è¿›è¡Œçš„æ˜¯ä¸€ç§ç”±ç»Ÿæ²»æ”¿å…šæ„è¯†å½¢æ€æŒ‡æŒ¥çš„å…šåŒ–æ•™è‚²ã€‚è¿™ç§å…šåŒ–æ•™è‚²æ¸—é€åˆ°æ•™è‚²çš„æ¯ä¸€ä¸ªç¯èŠ‚ä¹‹ä¸­ï¼Œè€Œåœ¨æ¯ä¸€ä¸ªç¯èŠ‚ä¸­ä½¿è¿™ç§å…šåŒ–æ„è¯†å½¢æ€é¡ºåˆ©å‘ç”Ÿä½œç”¨çš„æ­£æ˜¯æ— æ•°ç›´æ¥ä»äº‹æ•™å­¦å·¥ä½œçš„æ•™å¸ˆã€‚å…šåŒ–æ•™è‚²è¿«ä½¿äººä»¬ä¸æ–­è¿›è¡Œæ€æƒ³çš„ç›¸äº’çº¯æ´å’Œè‡ªæˆ‘çº¯æ´ï¼Œå®ƒåœ¨è¯¾å ‚é‡Œå‘ç”Ÿä¹‹å‰ï¼Œæ—©å°±å…ˆå·²ç»åœ¨è®¸å¤šæ•™å¸ˆçš„å¤´è„‘ä¸­å‘ç”Ÿäº†ï¼Œå¹¶æˆä¸ºä»–ä»¬çš„æ€ç»´å’Œè¡Œä¸ºä¹ æƒ¯ã€‚æ²¡æœ‰è¿™æ ·çš„æ•™å¸ˆï¼Œå…šåŒ–æ•™è‚²æ˜¯ä¸å¯èƒ½åœ¨å­¦æ ¡é‡Œæœ‰æ•ˆè´¯å½»çš„ã€‚</p></blockquote><blockquote><p>  åœ¨ææƒå›½å®¶é‡Œï¼Œå›½æ°‘å¿…é¡»æœ‰ç›¸åŒçš„æ­£ç¡®è¡¨ç°ï¼Œæ•™å¸ˆåœ¨å­¦æ ¡é‡Œçš„è¡Œä¸ºè¢«å®Œå…¨æ¨¡å¼åŒ–äº†ã€‚æ•™å¸ˆä»¬éƒ½å¿ äºå…šï¼ŒæŒ‰å…šçš„è¦æ±‚å»åšï¼Œä»–ä»¬åœ¨å­¦æ ¡çš„è¡Œä¸ºå¹¶ä¸ä»…ä»…æ˜¯â€œå¥½æ•™å¸ˆâ€è¡Œä¸ºï¼ŒåŒæ—¶ä¹Ÿæ˜¯â€œå¥½å›½æ°‘â€è¡Œä¸ºã€‚å½“ä¸€ä¸ªâ€œå¥½å›½æ°‘â€ï¼Œå°±æ˜¯åƒæ‰€æœ‰å…¶ä»–å›½æ°‘ä¸€æ ·å¯¹é¢†è¢–ã€å…šå’Œå…šå›½è¡¨ç°ç»å¯¹çš„å¿ è¯šã€‚â€œ</p></blockquote><blockquote><p>  çº³ç²¹å¾·å›½å®è¡Œçš„æ˜¯ä¸€ç§å½»åº•çš„ä»¥å›½å®¶ä¸»ä¹‰ä¸ºæ——å·çš„å…šåŒ–æ•™è‚²ï¼Œè¿™ç§æ•™è‚²ä»å„¿ç«¥å¼€å§‹ï¼Œåœ¨è¯¾ç¨‹ã€æ•™å­¦ã€æ•™æã€å¸ˆç”Ÿå…³ç³»çš„æ¯ä¸€ä¸ªç¯èŠ‚ä¸Šéƒ½è´¯å½»çº³ç²¹çš„ææƒç»Ÿæ²»åŸåˆ™ã€‚</p></blockquote><blockquote><p>  åœ¨ã€Šææƒä¸»ä¹‰çš„èµ·æºã€‹ä¸€ä¹¦ä¸­ï¼Œæ±‰å¨œÂ·é˜¿ä¼¦ç‰¹ä»ææƒä¸»ä¹‰åŸå‹çš„ç‰¹ç‚¹ä¸­æ¦‚æ‹¬å‡ºå®ƒæˆåŠŸç»Ÿæ²»çš„ä¸‰å¤§è¦ç´ ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯æš´åŠ›å’Œææƒ§çš„ç»Ÿæ²»ï¼Œè¿«ä½¿äººæ°‘æˆä¸ºç›¸äº’éš”ç»çš„ã€æ— åŠ©æ— æ´çš„æ•£æ²™ä¸ªä½“ï¼Œä»¥åŠå……åˆ†è¿ç”¨â€œç»„ç»‡â€å’Œâ€œå®£ä¼ â€çš„åŠ›é‡ã€‚é˜¿ä¼¦ç‰¹äº²èº«ç»å†è¿‡å¥¹æ‰€æ€è€ƒçš„ææƒä¸»ä¹‰ä¸­æœ€ä¸ºæˆåŠŸçš„ä¸€ç§ï¼Œé‚£å°±æ˜¯å¾·å›½çº³ç²¹çš„ææƒã€‚å¥¹å¯¹ææƒä¸»ä¹‰ä¸‰è¦ç´ çš„æ€»ç»“ä¾¿æ˜¯ä»å¥¹çš„ç›´æ¥ç»éªŒä¸­è§‚å¯Ÿå¾—å‡ºçš„ã€‚</p></blockquote><blockquote><p>  å…šçš„å®£ä¼ è¦æ±‚æ–°é—»ä»â€œæ­£é¢æŠ¥é“â€ï¼Œæ‰€ä»¥æ€»æ˜¯å°½é‡ä¸è®©åæ¶ˆæ¯æ›å…‰ã€‚å®ƒè®¤ä¸ºï¼Œåæ¶ˆæ¯ä¸åˆ©äºç¨³å®šäººå¿ƒï¼Œä¹Ÿå¯èƒ½è¢«åˆ«äººåˆ©ç”¨ï¼Œæ‰€ä»¥ï¼Œåæ¶ˆæ¯ä¹Ÿæˆä¸ºä¸€ç§ä¸èƒ½æ³„éœ²çš„â€œå›½å®¶æœºå¯†â€ã€‚</p></blockquote><p>æ‘˜æŠ„ <a href="https://t.co/PoWTqUQOQ7" target="_blank" rel="noopener">ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘</a></p><h3 id="æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³"><a href="#æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³" class="headerlink" title="æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³"></a>æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³</h3><p>è¿™æœ¬ä¹¦æ˜¯æˆ‘åœ¨ <a href="https://twitter.com/linyujing" target="_blank" rel="noopener">æ—æ„ˆéœ</a> ç«‹åœºæ–°é—»çš„æ–‡ç« é‡Œä¸Šå‘ç°çš„ã€‚ä¹‹å‰æˆ‘æ˜¯çŸ¥é“åˆ˜æ™“æ³¢æ˜¯è¯ºè´å°”å’Œå¹³å¥–å¾—ä¸»ï¼Œä¹ŸçŸ¥é“ä»–çš„ä¸€äº›äº‹è¿¹ï¼Œä½†é€šè¿‡è¿™æœ¬ä¼ è®°æ‰çœŸçœŸåˆ‡åˆ‡åœ°äº†è§£åˆ°åˆ˜æ™“æ³¢æ˜¯ä¸€ä½å¤šä¹ˆåšå¼ºçš„çŸ¥è¯†ä»½å­ã€‚åŒ…æ‹¬ç‹¬ç«‹ä¸­æ–‡ç¬”ä¼šçš„å‘å±•ï¼Œéƒ½ç¦»ä¸å¼€åˆ˜æ™“æ³¢å…ˆç”Ÿçš„ä»˜å‡ºã€‚</p><blockquote><p>åŠ‰æ›‰æ³¢æ‰¿èªï¼šã€Œé¡ä¼¼çš„æ®˜å¿è¡Œç‚ºä»¥åŠå°æ®˜å¿çš„è‡ªå¾—å…¶æ¨‚ï¼Œæˆ‘å°æ™‚å€™æ²’å°‘å¹¹ã€‚é€™ç¨®è¡Œç‚ºèˆ‡å°ˆé–€æ‰“ç ¸æ¶ã€æªé¬¥åˆ¥äººçš„ç´…è¡›å…µæ²’æœ‰ä»€éº¼å¯¦è³ªçš„å€åˆ¥ã€‚æˆ‘å€‘é€™äº›äººï¼Œåœ¨ä¸€ç¨®é‡è »çš„åˆ¶åº¦å’Œæ•™è‚²ä¹‹ä¸‹é•·å¤§ï¼Œå®ƒå´‡å°šæš´åŠ›ã€åŸ¹é¤Šä»‡æ¨ã€é¼“å‹µæ®˜å¿ã€ç¸±å®¹ç„¡æƒ…ï¼Œæ•™çµ¦å­©å­å€‘ä¸€ç¨®å¾å¨˜èƒè£¡å¸¶å‡ºä¾†çš„ä¸æ‹¿äººç•¶äººçš„æ®˜æš´å…‡ç‹ ã€‚åœ¨è¦–ç”Ÿå‘½å¦‚è‰èŠ¥çš„å¹´ä»£ï¼Œæˆ‘å€‘éƒ½åœ¨ä¸åŒçš„ç¨‹åº¦ä¸Šå……ç•¶éåŠŠå­æ‰‹å’Œå¹«å…‡ï¼Œèª°ä¹Ÿè„«ä¸æ‰è²¬ä»»ï¼Œæ´—ä¸æ¸…è‡ªå·±ï¼ã€</p></blockquote><blockquote><p>æˆ‘çš„æ•´å€‹é’æ˜¥æœŸç”Ÿé•·æ–¼æ–‡åŒ–æ²™æ¼ ä¹‹ä¸­ï¼Œæˆ‘æ‰€è³´ä»¥å¯«ä½œçš„æ–‡åŒ–æ»‹é¤Šï¼Œé™¤äº†ä»‡æ¨ã€æš´åŠ›ã€ç‹‚å¦„ï¼Œå°±æ˜¯èªªè¬Šã€ç„¡è³´ã€çŠ¬å„’ï¼Œé€™äº›é»¨æ–‡åŒ–çš„æ¯’ç´ é¤µé¤Šäº†æ•´æ•´å¹¾ä»£äººï¼Œæˆ‘ä¾¿æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œå³ä¾¿åœ¨æ€æƒ³è§£æ”¾çš„å…«â—‹å¹´ä»£ï¼Œä¹Ÿä¸¦æ²’æœ‰å®Œå…¨æ“ºè„«é»¨æ–‡åŒ–ã€‚</p></blockquote><blockquote><p>åŠ‰æ›‰æ³¢å¼·èª¿äº†è¨€è«–è‡ªç”±çš„é‡è¦æ€§ï¼šã€Œä¸€å€‹æ”¿æ¬Šä¸å¯èƒ½é å£“æŠ‘ä¸åŒæ”¿è¦‹ä¾†å»ºç«‹åˆæ³•æ€§ï¼Œä¹Ÿä¸å¯èƒ½é æ–‡å­—ç„ä¾†é”æˆé•·æ²»ä¹…å®‰ã€‚ã€ä»–å‘¼ç±²ä¸­åœ‹æ—©æ—¥å‘Šåˆ¥æ–‡å­—ç„ï¼šã€Œåªæœ‰å¾åˆ¶åº¦ä¸Šæ ¹çµ•æ–‡å­—ç„ï¼Œæ†²æ³•æ‰€è¦å®šçš„è¨€è«–è‡ªç”±æ¬Šåˆ©æ‰èƒ½è½å¯¦åˆ°æ¯ä¸€ä½åœ‹æ°‘èº«ä¸Šï¼›åªæœ‰ç•¶åœ‹æ°‘çš„è¨€è«–è‡ªç”±æ¬Šåˆ©å¾—åˆ°åˆ¶åº¦åŒ–çš„ç¾å¯¦ä¿éšœï¼Œæ–‡å­—ç„æ‰æœƒåœ¨ä¸­åœ‹å¤§åœ°ä¸Šæ»…çµ•ã€‚ã€</p></blockquote><p><code>æ‘˜æŠ„</code> <a href="https://t.co/eefs4gZspV" target="_blank" rel="noopener">æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³</a></p><h3 id="Age-of-Ambition"><a href="#Age-of-Ambition" class="headerlink" title="Age of Ambition"></a>Age of Ambition</h3><p><code>æ‘˜æŠ„</code> <a href="https://t.co/uvCqxbUb0i" target="_blank" rel="noopener">Age of Ambition</a></p><h3 id="è‡ªç”±å®ªç« "><a href="#è‡ªç”±å®ªç« " class="headerlink" title="è‡ªç”±å®ªç« "></a>è‡ªç”±å®ªç« </h3><p>ã€Šè‡ªç”±å®ªç« ã€‹æ˜¯è¿™å¤§åŠå¹´æ¥æœ€éš¾å•ƒçš„ä¹¦ï¼Œå“ˆè€¶å…‹çš„ä¹¦å¯¹äºæœ¨å­è¿™ç§èœé¸¡æ¥è¯´è¯»èµ·æ¥å°±æ˜¯å¤´å¤§å•Šï¼Œå’Œæˆ‘åœ¨ä¸€æœˆä»½è¯»çš„ã€Šè‡ªç”±ä¸ç¹è£çš„å›½åº¦ã€‹å‘³é“ä¸€æ ·ã€‚</p><p><strong>å¼—é‡Œå¾·é‡Œå¸ŒÂ·å“ˆè€¶å…‹</strong>ï¼ˆFriedrich AÂ·Hayekï¼‰æ˜¯å¥¥åœ°åˆ©ç»æµå­¦å®¶å’Œæ”¿æ²»å“²å­¦å®¶ã€‚èº«ä¸º1974å¹´çš„è¯ºè´å°”ç»æµå­¦å¥–çš„è·å¾—è€…ä¹‹ä¸€ï¼Œä»–ä¸»å¼ ä»¥å¸‚åœºä¸ºåŸºç¡€çš„è‡ªç”±èµ„æœ¬ä¸»ä¹‰å’Œæœ‰é™çš„æ”¿åºœã€‚æ­¤å¤–ï¼Œä»–è¿˜äº1991å¹´è·å¾—äº†æ€»ç»Ÿè‡ªç”±å‹‹ç« ã€‚</p><p>åœ¨è¿™æœ¬ä¹¦ä¸­ï¼Œå•å•æ³•æ²»æ¦‚å¿µçš„å«ä¹‰ï¼Œå“ˆè€¶å…‹æœ¬äººå°±ç½—åˆ—å¼•ç”¨äº† 30 å¤šæœ¬è‘—ä½œï¼å¯è§å½“æ—¶å“ˆè€¶å…‹æœ¬äººçš„å­¦æœ¯æ°´å¹³ç›¸å½“é«˜æ»´ï¼</p><blockquote><ul><li>ã€Šæ³•å¾‹ä¸ç§©åºã€‹</li><li>ã€Šæ•™ä¼šã€å›½å®¶ä¸ç ”ç©¶ã€‹</li><li>ã€Šæ–°åˆ©ç»´å¦ã€‹</li><li>ã€Šç¾å›½çš„è¡Œæ”¿å¸æ³•åŠæ³•å¾‹çš„æœ€é«˜åœ°ä½ã€‹</li><li>ã€Šå®ªæ”¿æ”¿æ²»ä¸æ°‘ä¸»ã€‹</li><li>ã€Šæ”¿æ²»ä¸è¡Œæ”¿ã€‹</li><li>ã€Šç°ä»£å…±åŒä½“çš„åŸºç¡€ã€‹</li><li>ã€Šå¯¹è‰¯å¥½ç¤¾ä¼šåŸåˆ™æ¢ç´¢ã€‹</li><li>ã€Šå®ªæ”¿ä¸å˜åŠ¨ä¸­çš„ä¸–ç•Œã€‹</li><li>ã€Šæ°‘ä¸»å›½å®¶ä¸é›†æƒå›½å®¶ã€‹</li><li>ã€Šè¡Œæ”¿ä¸æ³•æ²»ã€‹</li><li>ã€Šç°ä»£æ”¿æ²»è¯¸è¦ç´ ã€‹</li><li>ã€Šæ³•æ²»ï¼šä¿å®ˆçš„ä¼¦æ•¦å¾‹å¸ˆå…¬ä¼šä¸å·¥ä¼šåä¼šè¿›è¡Œçš„ç ”ç©¶ã€‹</li><li>ã€Šæ³•å¾‹ï¼šæœ‰å…³æ°‘ä¸»ä¹‹ä¸­çš„æƒå¨çš„ç†è®ºçš„è®ºæ–‡ã€‹</li><li>ã€Šä¸ªäººä¸»ä¹‰ä¸æ³•å¾‹ã€‹</li><li>ã€Šå®ªæ³•å­¦ã€‹</li><li>ã€Šå®ªæ³•ä¹‹ä¿å«è€…ã€‹</li><li>ã€Šæ³•æ²»å›½å®¶ï¼Œè¿˜æ˜¯ç‹¬è£ï¼Ÿã€‹</li><li>ã€Šæ”¿æ²»å­¦ã€‹ã€Šæ³•æ²»å›½å®¶æœ‰æ•ˆæ€§çš„ç•Œé™ã€‹</li><li>ã€Šæ³•æ²»å›½å®¶è¿˜æ˜¯å¨æƒå›½å®¶ï¼Ÿã€‹</li><li>ã€Šè‡ªç”±ä¸»ä¹‰ä½œä¸ºä¸€ç§æ„è¯†å½¢æ€çš„æ²¡è½ã€‹</li><li>ã€Šæ³¢æ©åŸºæœ¬æ³•ä¸­çš„ç¤¾ä¼šæ³•æ²»å›½å®¶æ¦‚å¿µã€‹</li><li>ã€Šä½œä¸ºåˆ‘æ³•æœ€æ–°å‘å±•çš„ä¸­å¿ƒæ¦‚å¿µçš„æ³•æ²»å›½å®¶ã€‹</li><li>ã€Šæ³•ã€å›½å®¶ã€ç»æµã€‹</li><li>ã€Šä»æ³•å¾‹å›½å®¶åˆ°æ³•å®˜å›½å®¶ã€‹</li><li>ã€Šç‘å£«è”é‚¦å›½å®¶æ³•ã€‹</li><li>ã€Šå¾·å›½è¡Œæ”¿æ³•çš„ä½“åˆ¶ã€‹</li><li>ã€Šç‘å£«è”é‚¦æ³•é™¢çš„å®ªæ³•ç®¡è¾–æƒã€‹</li><li>ã€Šæ³•åˆ¶å›½å®¶æ°‘ä¸»åˆ¶ã€‹</li><li>ã€Šç¾å›½ä¸ç‘å£«å®ªæ³•ç®¡è¾–æƒçš„æ”¿æ²»æ„è¯†å½¢æ€ä¸Šä¸æ³•å¾‹æ„è¯†å½¢æ€ä¸Šçš„æ ¹æ®ã€‹</li><li>ã€Šä½œä¸ºå›½å®¶æ ¹æœ¬æ³•å¾‹ç§©åºçš„å®ªæ³•ã€‹</li><li>ã€Šç‘å£«æ³•å¾‹ä¸­çš„å…¬æ°‘è‡ªç”±ã€‹</li><li>ã€Šæ³•æ²»å›½å®¶çš„ç§©åºã€‹</li><li>ã€Š1955å¹´é›…å…¸å›½é™…æ³•å­¦å®¶å¤§ä¼šæŠ¥å‘Šã€‹</li></ul></blockquote><p>è™½ç„¶è¿™æœ¬ä¹¦æ—©åœ¨1960å¹´å°±å·²å‡ºç‰ˆï¼Œä½†å…¶æ·±åˆ»çš„è§è§£æ—¶è‡³ä»Šæ—¥ä»ç„¶ç››è¡Œã€‚ä»–æ‰€å€¡å¯¼çš„ç»æµå’Œä¸ªäººè‡ªç”±ç†è®ºé€‚ç”¨äºå¾ˆå¤šå½“ä»Šçš„çƒ­è®®è¯é¢˜ï¼Œä»ç‰©ä»·ä¸Šæ¶¨åˆ°ç´¯è¿›ç¨åˆ¶ã€‚åœ¨ä¹¦ä¸­ï¼Œä½œè€…å¯¹æ¯”äº†å»ºç«‹æœ‰é™æ”¿åºœçš„ç›Šå¤„å’Œå®æ–½ä¸­å¤®è®¡åˆ’ç»æµçš„å¼Šç«¯ã€‚é™åˆ¶æ”¿åºœæƒåŠ›å°†ä¼šæœ‰åˆ©äºæå‡ä¸ªä½“èƒ½åŠ¨æ€§å’Œåˆ›é€ åŠ›ï¼Œè¿›è€Œæ¨åŠ¨äººç±»çŸ¥è¯†å’Œæ–‡æ˜çš„è¿›æ­¥ã€‚å“ˆè€¶å…‹è®ºè¯äº†æ³•å¾‹æ³•è§„ã€åˆæ³•ç¨‹åºå’Œå®ªæ³•æ”¿åºœå¯¹è‡ªç”±çš„ç§¯æä½œç”¨ï¼Œå¹¶æŒ‡å‡ºä¸ªäººè‡ªç”±æ‰€é¢ä¸´çš„ä¸¥å³»çš„æ½œåœ¨å¨èƒã€‚ä»¥ä¸‹æ˜¯æœ¬ä¹¦çš„å‡ ä¸ªè¦ç‚¹ï¼š</p><ul><li>æœ‰é™çš„æ”¿åºœé€šè¿‡æ¿€å‘äººçš„ä¸ªä½“ä¸»åŠ¨æ€§æ¥æ¨åŠ¨ç¤¾ä¼šçš„è¿›æ­¥ã€‚</li><li>è´¢äº§æƒåˆ©å’Œä¸ªäººè‡ªç”±è¿™ä¸€å®½æ³›çš„æ”¿æ²»æ¦‚å¿µæœ‰ç€å¯†åˆ‡çš„è”ç³»ã€‚</li><li>åªæœ‰é‚£äº›ä¸çº¦å®šä¿—æˆçš„é“å¾·è§‚å¿µç›¸ç¬¦çš„æ³•å¾‹æ‰èƒ½ç»å¾—ä½æ—¶é—´çš„è€ƒéªŒã€‚</li><li>å¤šæ•°è£å®šåŸåˆ™è‡ªç„¶å¾ˆæœ‰å¿…è¦ï¼Œä½†ä»…ä»…ä¾é å®ƒè¿˜ä¸è¶³ä»¥å»ºç«‹ä¸€ä¸ªè‡ªç”±ç¤¾ä¼šã€‚</li><li>å®ªæ”¿æ˜¯ç¾å›½è¿½æ±‚è‡ªç”±äº‹ä¸šæœ€æœ‰åŠ›çš„æ­¦å™¨ã€‚</li><li>ç¤¾ä¼šä¸»ä¹‰æ˜¯ä¸€ç§å¤±è´¥çš„æ”¿åºœå½¢å¼ï¼Œä½†å®ƒè‡³ä»Šä¾ç„¶å½±å“ç€å…¬å…±æ”¿ç­–çš„åˆ¶å®šã€‚</li><li>é€šè¿‡æ”¶å…¥å†åˆ†é…æ¥ç¼“è§£è´«å›°ä¼šå¸¦æ¥æ„æƒ³ä¸åˆ°çš„è´Ÿé¢æ•ˆåº”ï¼Œæ¯”å¦‚â€œç¦åˆ©å›½å®¶â€çš„å‡ºç°ã€‚</li><li>åŸºäºå¸‚åœºçŠ¶å†µçš„å¥–åŠ±åˆ¶åº¦æ¯”åŸºäºä¸ªäººä¼˜ç‚¹çš„å¥–åŠ±åˆ¶åº¦æ›´åŠ æœ‰æ•ˆã€‚</li><li>æ¯”èµ·é€šè´§ç´§ç¼©ï¼Œæ”¿åºœæ›´å€¾å‘äºé€šè´§è†¨èƒ€ã€‚ä½†è¿‡åº¦çš„è†¨èƒ€ä¼šå¨èƒåˆ°è‡ªç”±ã€‚</li><li>é™åˆ¶æ”¿åºœå¯¹æ•™è‚²çš„å¹²æ¶‰æœ‰åˆ©äºç¤¾ä¼šä¿æŒæ€æƒ³æ´»åŠ›ã€‚</li></ul><p><img src="img/image-20210106235239532.png" alt="image-20210106235239532"></p><p>æ‘˜æŠ„ <a href="https://t.co/t1GhiJgIsa" target="_blank" rel="noopener">è‡ªç”±å®ªç« </a></p><h3 id="ä¸€æƒ³åˆ°è¿˜æœ‰ç™¾åˆ†ä¹‹ä¹åäº”çš„é—®é¢˜ç•™ç»™äººç±»-æˆ‘å°±æ”¾å¿ƒäº†"><a href="#ä¸€æƒ³åˆ°è¿˜æœ‰ç™¾åˆ†ä¹‹ä¹åäº”çš„é—®é¢˜ç•™ç»™äººç±»-æˆ‘å°±æ”¾å¿ƒäº†" class="headerlink" title="ä¸€æƒ³åˆ°è¿˜æœ‰ç™¾åˆ†ä¹‹ä¹åäº”çš„é—®é¢˜ç•™ç»™äººç±»,æˆ‘å°±æ”¾å¿ƒäº†"></a>ä¸€æƒ³åˆ°è¿˜æœ‰ç™¾åˆ†ä¹‹ä¹åäº”çš„é—®é¢˜ç•™ç»™äººç±»,æˆ‘å°±æ”¾å¿ƒäº†</h3><p><code>æ‘˜æŠ„</code> <a href="https://t.co/HX1EXtz2oZ" target="_blank" rel="noopener">ä¸€æƒ³åˆ°è¿˜æœ‰ç™¾åˆ†ä¹‹ä¹åäº”çš„é—®é¢˜ç•™ç»™äººç±»,æˆ‘å°±æ”¾å¿ƒäº†</a></p><h3 id="è¢«è®¨åŒçš„å‹‡æ°”"><a href="#è¢«è®¨åŒçš„å‹‡æ°”" class="headerlink" title="è¢«è®¨åŒçš„å‹‡æ°”"></a>è¢«è®¨åŒçš„å‹‡æ°”</h3><p>æ— æ„é—´åœ¨ <a href="https://sanshiliuxiao.top/talkSelf/20191212/" target="_blank" rel="noopener">æ¤å’²è‰¯ç”°|æƒ³ä¸åˆ°å•¥æ ‡é¢˜</a> å‘ç°äº†è¿™æœ¬ä¹¦ã€‚</p><blockquote><p>ä¹¦é‡Œé¢æœ‰å¾ˆå¤šçš„è§‚ç‚¹ä¸€å¼€å§‹éƒ½æŒºè®©äººéš¾ä»¥æ¥å—çš„ï¼Œå°±åƒé‚£ä½å»å¯»æ±‚å“²äººå¸®åŠ©çš„é’å¹´ï¼Œä¸å»æ¥å—å“²äººçš„è§‚ç‚¹ï¼Œå¿ƒé‡Œæƒ³ç€æ ¹æœ¬å°±ä¸æ˜¯å“²äººè¯´çš„é‚£æ ·ï¼Œå†³å®šè¦å»å¥½å¥½åé©³ä»–ã€‚å¯æ˜¯ä»”ç»†æƒ³æƒ³ï¼Œå“²äººè¯´çš„è¯ä¹Ÿç®—æ˜¯è›®æœ‰é“ç†çš„ã€‚æ•´æœ¬ä¹¦ä¸­å“²äººè¯´çš„ä¸€äº›è¨€è®ºï¼Œå¦‚æœå•å•åªæ‹†å‡ºä¸€æ®µæˆ–ä¸€å¥ï¼Œå°±ä¼šè§‰å¾—è¿™ä¸ªå“²äººæ˜¯åœ¨å¼ºè¯å¤ºç†ï¼Œå¯æ˜¯ä»–çš„è¯é‡Œé¢æœ‰ç€æ˜¯æœ‰å¾ˆå¤šçš„å‰ç½®æ¡ä»¶ï¼Œå¦‚ä½•ç»“åˆç€ä¸€èµ·çœ‹ï¼Œé‚£å°±ä¼šæ„Ÿè§‰ä¸ä¸€æ ·ã€‚</p></blockquote><p>å…ˆè¯´ä¸€ä¸‹æˆ‘è‡ªå·±çš„æ„Ÿå—å§ï¼Œè¯»å®Œè¿™æœ¬ä¹¦ç¡®å®æ”¹å˜äº†æˆ‘ä¸€äº›æ ¹æ·±è’‚å›ºçš„è§‚å¿µã€‚æˆ‘æ‰¿è®¤æˆ‘æœ‰ç‚¹æç«¯å¿ƒç†ï¼Œå¹¶ä¸”æˆ‘å¾ˆé•¿æ—¶é—´æŠŠå®ƒå½’å› äºç«¥å¹´æ—¶æœŸçš„å®¶åº­æš´åŠ›ï¼Œæˆ‘è§‰ç€æ˜¯è€çˆ¸çš„æš´è„¾æ°”å½±å“äº†æˆ‘çš„æ€§æ ¼ï¼Œä»¥è‡³äºæ€§æ ¼åæ¿€ã€å¯¡è¨€å°‘è¯­ã€ä¸å–„ç¤¾äº¤ã€è‡ªå‘å†…å‘ç­‰ã€‚å¾ˆé•¿å¾ˆé•¿ä¸€æ®µæ—¶é—´æˆ‘éƒ½æŠŠè¿™ä¸€åˆ‡å½’è´£äºè€çˆ¸å¯¹æˆ‘çš„å®¶åº­æš´åŠ›ï¼Œé•¿ä¹…ä¸èƒ½é‡Šæ€€ã€‚å°±åœ¨ä»Šå¹´è¿‡å¹´æ—¶åœ¨å®¶è¿˜å’Œè€çˆ¸äº‰åµæ€ªä»–å°æ—¶å€™æ‰“æˆ‘æ‰å¯¼è‡´æˆ‘æ€§æ ¼åæ¿€ã€‚</p><p>ç›´åˆ°è¯»å®Œè¿™æœ¬ä¹¦ï¼Œæˆ‘æ‰æ”¹å˜äº†è¿™ç§å¹¼ç¨šçš„æƒ³æ³•ã€‚<strong>æˆ‘ä»¬å¹¶éå› ä¸ºè‡ªèº«ç»å†ä¸­çš„åˆºæ¿€â€”â€”æ‰€è°“çš„å¿ƒç†åˆ›ä¼¤â€”â€”è€Œç—›è‹¦ï¼Œäº‹å®ä¸Šæˆ‘ä»¬ä¼šä»ç»å†ä¸­å‘ç°ç¬¦åˆè‡ªå·±ç›®çš„çš„å› ç´ ã€‚å†³å®šæˆ‘ä»¬è‡ªèº«çš„ä¸æ˜¯è¿‡å»çš„ç»å†ï¼Œè€Œæ˜¯æˆ‘ä»¬è‡ªå·±èµ‹äºˆç»å†çš„æ„ä¹‰ã€‚</strong>ç»å†æœ¬èº«ä¸ä¼šå†³å®šä»€ä¹ˆã€‚æˆ‘ä»¬ç»™è¿‡å»çš„ç»å†â€œèµ‹äºˆäº†ä»€ä¹ˆæ ·çš„æ„ä¹‰â€ï¼Œè¿™ç›´æ¥å†³å®šäº†æˆ‘ä»¬çš„ç”Ÿæ´»ã€‚ä¸å¯ä»¥ä»è¿‡å»ä¸­æ‰¾åŸå› ï¼›è¦å¦å®šç²¾ç¥åˆ›ä¼¤ï¼›äººä¸æ˜¯å—è¿‡å»åŸå› æ”¯é…çš„å­˜åœ¨ï¼Œäººæ˜¯ä¸ºäº†è¾¾æˆæŸç§ç›®çš„è€Œé‡‡å–è¡ŒåŠ¨çš„ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/o6cc1csJI2" target="_blank" rel="noopener">è¢«è®¨åŒçš„å‹‡æ°”</a></p><h3 id="å¸ƒæ‹‰æ ¼ç²¾ç¥"><a href="#å¸ƒæ‹‰æ ¼ç²¾ç¥" class="headerlink" title="å¸ƒæ‹‰æ ¼ç²¾ç¥"></a>å¸ƒæ‹‰æ ¼ç²¾ç¥</h3><p>æœ¬ä¹¦çš„ä½œè€…æ˜¯è¿™æœ¬ä¹¦çš„è¯‘è€…åŒæ ·ä¹Ÿæ˜¯ã€Šå“ˆç»´å°”æ–‡é›†ã€‹çš„è¯‘è€…å´”å«å¹³ã€‚æåˆ°å¸ƒæ‹‰æ ¼å°±ä¸å¾—ä¸æ <a href="https://zh.wikipedia.org/zh-hans/%E5%B8%83%E6%8B%89%E6%A0%BC%E4%B9%8B%E6%98%A5" target="_blank" rel="noopener">å¸ƒæ‹‰æ ¼ä¹‹æ˜¥</a> </p><p>æ¨èé˜…è¯» <a href="http://www.liu-xiaobo.org/blog/archives/5381" target="_blank" rel="noopener">åˆ˜æ™“æ³¢ï¼šè¯»ã€Šå¸ƒæ‹‰æ ¼ç²¾ç¥ã€‹â€”â€”ç‹±ä¸­è¯»ä¹¦ç¬”è®°</a> å’Œ <a href="http://www.liu-xiaobo.org/blog/archives/12412" target="_blank" rel="noopener">åˆ˜æ™“æ³¢ï¼šåœ¨åˆ€é”‹ä¸Šè¡Œèµ°â€”â€”ç‹±ä¸­è¯»ã€Šå¸ƒæ‹‰æ ¼ç²¾ç¥ã€‹</a></p><h2 id="è‡ªç„¶-ç§‘å­¦"><a href="#è‡ªç„¶-ç§‘å­¦" class="headerlink" title="è‡ªç„¶/ç§‘å­¦"></a>è‡ªç„¶/ç§‘å­¦</h2><h3 id="ç—…æ¯’æ˜Ÿçƒ"><a href="#ç—…æ¯’æ˜Ÿçƒ" class="headerlink" title="ç—…æ¯’æ˜Ÿçƒ"></a>ç—…æ¯’æ˜Ÿçƒ</h3><p>æä¸ºç®€çŸ­çš„ä¸€æœ¬ç§‘æ™®ï¼Œå¤§æ¦‚ç”¨äº†ä¸¤ä¸ªå°æ—¶çš„æ—¶é—´å°±è¯»å®Œäº†ã€‚ä¸»è¦ç§‘æ™®äº†ä¸€ä¸‹ç—…çš„æ€§è´¨ä»¥åŠå…¥ä¾µäººä½“ç»†èƒçš„æœºç†ç­‰ã€‚æ„Ÿè§‰è¯»èµ·æ¥æµ·æ˜Ÿå§ï¼Œæ²¡æœ‰å¤ªå¤šç²¾å½©çš„åœ°æ–¹ï¼Œå°±åƒå›é¡¾äº†ä¸€ä¸‹é«˜ä¸­ç”Ÿç‰©å­¦ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/Op5GTfaOch" target="_blank" rel="noopener">ç—…æ¯’æ˜Ÿçƒ</a></p><h3 id="ç—…æ¯’æ¥è¢­"><a href="#ç—…æ¯’æ¥è¢­" class="headerlink" title="ç—…æ¯’æ¥è¢­"></a>ç—…æ¯’æ¥è¢­</h3><p>æ„Ÿè§‰æ²¡ã€Šç—…æ¯’æ˜Ÿçƒã€‹è¦å¥½ä¸€äº›ï¼Œæ€»ä¹‹æ¨èå‰ä¸€æœ¬ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/kfTZIY7Zt0" target="_blank" rel="noopener">ç—…æ¯’æ¥è¢­</a></p><h3 id="è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹"><a href="#è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹" class="headerlink" title="è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹"></a>è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹</h3><p>ç–«æƒ…æœŸé—´åœ¨å®¶çœ‹å®Œçš„ä¹¦ï¼Œä¹Ÿæœ‰åŒåçš„çºªå½•ç‰‡ï¼Œæ¨èä¸¤è€…éƒ½çœ‹ä¸€ä¸‹ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://kindle.502.li/" target="_blank" rel="noopener">è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹</a></p><h3 id="è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½"><a href="#è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½" class="headerlink" title="è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½"></a>è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½</h3><p>è¿™æœ¬ä¹¦ä¸»è¦è®²äº†æ¤ç‰©çš„èµ·æºã€å…‰åˆä½œç”¨ã€å¶ç»¿ä½“ã€å­¢å­ç”Ÿæ®–ä»¥åŠä¸€äº›è¿œå¤æ—¶æœŸçš„ç”Ÿæ€ç¯å¢ƒç­‰ã€‚æ€»ä¹‹å¯¹äºå’±è¿™ç§å¯¹å¤ç”Ÿç‰©å­¦æ„Ÿå…´è¶£çš„æ¥è¯´ç®—æ˜¯ä¸€é¡¿ç§‘æ™®ç››å®´ï¼Œå­¦åˆ°å¾ˆå¤šçŸ¥è¯†è€¶ï¼Œæå¤§å¾—æ»¡è¶³äº†å’±çš„å¥½å¥‡å¿ƒğŸ˜‚ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/5KOfa96qlr" target="_blank" rel="noopener">è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½</a></p><h3 id="å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹"><a href="#å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹" class="headerlink" title="å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹"></a>å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹</h3><p>è¯¾æœ¬æ•™æï¼Œæ¯ç‡¥ã€åªæ˜¯äº†è§£äº†ä¸€ä¸‹åŸºæœ¬çš„æ¦‚å¿µï¼Œæ„Ÿè§‰æˆ‘ä¸é€‚åˆè¯»è¿™ç§æ¯ç‡¥çš„è¯¾æœ¬(ï¿£â–½ï¿£)â€</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/G6oMMnAAji" target="_blank" rel="noopener">å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹</a></p><h3 id="æœ±é’¦å£«çš„ä¸ªäººåšå®¢"><a href="#æœ±é’¦å£«çš„ä¸ªäººåšå®¢" class="headerlink" title="æœ±é’¦å£«çš„ä¸ªäººåšå®¢"></a>æœ±é’¦å£«çš„ä¸ªäººåšå®¢</h3><p>è¿™å¹¶ä¸æ˜¯ä¸€æœ¬ä¹¦ï¼Œè€Œæ˜¯æˆ‘åœ¨ <a href="http://blog.sciencenet.cn/home.php?mod=space&uid=582158" target="_blank" rel="noopener">æœ±é’¦å£« </a>åšå£«çš„ä¸ªäººåšå®¢ä¸Šå¤åˆ¶ä¸‹æ¥æ•´ç†æˆçš„ç”µå­ä¹¦ï¼Œåœ¨ kindle ä¸Šè¯»èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ã€‚å¯¹äºåªå…·å¤‡é«˜ä¸­ç”Ÿç‰©çŸ¥è¯†å¾—å’±æ¥è¯´ï¼Œè¯»èµ·æœ±é™¢å£«å†™çš„æ–‡ç« è¿˜æ˜¯æœ‰äº›åƒåŠ›çš„ï¼Œæ„Ÿè§‰è¿™åŸºæœ¬ä¸Šå°±æ˜¯è®ºæ–‡çš„æ³¨é‡Šç‰ˆã€‚é‡Œé¢çš„ä¸€äº›å­¦æœ¯ç”¨è¯­æœ‰å¾ˆå¤šéƒ½ä¸æ‡‚ï¼Œåªèƒ½è‡ªå·±æœç´¢äº†è§£ä¸€ä¸‹ã€‚è®²åˆ°äº†çœŸæ ¸ç”Ÿç‰©çš„èµ·æºï¼Œä»¥åŠåŠ¨ç‰©ç»†èƒå’Œæ¤ç‰©ç»†èƒçš„èµ·æºã€‚å’±ä»¬äººç±»ï¼ˆåŠ¨ç‰©ï¼‰æ˜¯ä»å•é­æ¯›çš„åŸç”Ÿç”Ÿç‰©é¢†é­æ¯›è™«ï¼ˆChoanoflagellateï¼‰æ¼”åŒ–è€Œæ¥ï¼Œè€Œæ¤ç‰©åˆ™ç”±åŒé­æ¯›åŸç”Ÿç”Ÿç‰©ä¸­çš„åŒæ˜Ÿè—»ï¼ˆZygmematalesï¼‰æ¼”åŒ–è€Œæ¥ï¼ŒåŸæ¥å’±ä»¬çš„ç¥–å…ˆæ˜¯åªé­æ¯›è™«ğŸ˜‚ï¼Ÿ</p><p>æ‘˜æŠ„ <a href="https://t.co/50HX5FvBPk" target="_blank" rel="noopener">æœ±é’¦å£«çš„ä¸ªäººåšå®¢</a></p><h3 id="ç”Ÿå‘½é€šå²"><a href="#ç”Ÿå‘½é€šå²" class="headerlink" title="ç”Ÿå‘½é€šå²"></a>ç”Ÿå‘½é€šå²</h3><p>ç”Ÿå‘½é€šå²è¿™æœ¬ä¹¦æ˜¯ä»Šå¹´èŠ±äº†ç›¸å½“é•¿çš„æ—¶é—´æ¥è¯»å®Œçš„ï¼Œä¹‹å‰åœ¨ <a href="http://blog.sciencenet.cn/home.php?mod=space&uid=582158" target="_blank" rel="noopener">æœ±é’¦å£« </a>åšå£«çš„ä¸ªäººåšå®¢ä¸Šè¯»äº†å¾ˆå¤šæ–‡ç« ä¸€ç›´ä¸çŠ¹æœªå°½ã€‚</p><p>çœŸæ ¸ç»†èƒæ˜¯æ€æ ·å½¢æˆçš„å‘¢ï¼Œä¹¦ä¸­è§£é‡Šä¸ºï¼šçœŸæ ¸ç»†èƒæ˜¯å…ˆè·å¾—çº¿ç²’ä½“ï¼Œå†å‘å±•å‡ºç»†èƒæ ¸ã€‚çº¿ç²’ä½“çš„å‡ºç°ç»™çœŸæ ¸ç”Ÿç‰©å¸¦æ¥å……è¶³èƒ½æºçš„åŒæ—¶ï¼Œä¹Ÿå¸¦æ¥äº†å†…å«å­çš„å…¥ä¾µã€‚ä¸ºè›‹ç™½è´¨ç¼–ç çš„åŸºå› ä¸­å†…å«å­çš„å‡ºç°ï¼Œåˆè¿«ä½¿ç»†èƒå½¢æˆç»†èƒæ ¸ä»¥æŠŠDNAå’Œæ ¸ç³–ä½“åˆ†éš”å¼€æ¥ã€‚è¿™å¤§æ¦‚å°±æ˜¯çœŸæ ¸ç»†èƒå‡ºç°çš„æ ¹æœ¬åŸå› ã€‚å…¶å®ƒçš„æ”¹å˜éƒ½æ˜¯åœ¨è¿™ä¸ªåŸºç¡€ä¸Šè¿›è¡Œçš„ã€‚è½¬å½•å’Œè›‹ç™½è´¨åˆæˆå¿…é¡»åœ¨ç©ºé—´ä¸Šåˆ†å¼€ï¼Œè€Œè¿™æ­£æ˜¯ç»†èƒæ ¸çš„ä½œç”¨ã€‚ç»†èƒæ ¸çš„è†œèƒ½å¤Ÿé˜²æ­¢å®Œæ•´çš„æ ¸ç³–ä½“è¿›å…¥ç»†èƒï¼Œè€ŒmRNAåœ¨å‰ªæ¥å®Œæˆå‰ï¼Œåˆä¸ä¼šç¦»å¼€ç»†èƒæ ¸ï¼Œè¿™æ ·æ ¸ç³–ä½“èƒ½å¤Ÿæ¥è§¦çš„ï¼Œå°±åªèƒ½æ˜¯åŠ å·¥å®Œæ¯•çš„ mRNAã€‚</p><p>è¯»è¿™æœ¬ä¹¦åªéœ€è¦åŸºæœ¬çš„é«˜ä¸­ç”Ÿç‰©å’ŒåŒ–å­¦çŸ¥è¯†å°±èƒ½è¯»æ‡‚ã€‚ä»åˆ†å­ç”Ÿç‰©å­¦å’ŒåŸºå› è§’åº¦è§£é‡Šä¸€äº›å®è§‚çš„ç”Ÿå‘½ç°è±¡ï¼Œæ¯”å¦‚æœ‰æ°§å‘¼å¸ç”µå­çš„ä¼ é€’ï¼›çº¿ç²’ä½“å’Œå¶ç»¿ä½“å¦‚ä½•å·¥ä½œï¼›ä¸‰ç¾§é…¸å¾ªç¯ï¼›åŸºå› è¡¨è¾¾å¦‚ä½•æ§åˆ¶æ§åˆ¶ä¸ªä½“çš„å½¢æˆç­‰ç­‰ï¼Œéƒ½åˆ†æçš„ååˆ†ç²¾å½©ï¼Œæ€»ä¹‹ç›¸å½“äºä¸€æœ¬ç”Ÿå‘½ç§‘å­¦çš„â€œæºç åˆ†æâ€ã€‚</p><p>å¦å¤–å€¼å¾—ä»¤äººå€¾ä½©çš„æ˜¯ã€Šç”Ÿå‘½é€šå²ã€‹è¿™æœ¬ä¹¦å¹¶æ²¡æœ‰ä»»ä½•äººçš„æ¨èåºï¼Œæ²¡æœ‰èŠ±é‡Œèƒ¡å“¨çš„å¹å˜˜åªæœ‰ä¸¥è°¨åŠ¡å®çš„å­¦æœ¯çŸ¥è¯†ï¼Œåœ¨è¿™æµ®èºçš„å¹´ä»£ï¼Œå¾ˆå°‘èƒ½è§åˆ°è¿™æ ·çš„ä¹¦äº†ã€‚è¿™æœ¬ä¹¦åœ¨æˆ‘å¿ƒä¸­çš„åœ°ä½è¿œé«˜äºã€Šäººç±»ç®€å²ã€‹ç­‰ç•…é”€ä¹¦ï¼Œå› ä¸ºè¿™çœŸçš„æ˜¯ä¸€æœ¬é€‚åˆè‡ªå·±æ¥è¯»çš„ä¹¦ğŸ˜€ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/6PBLon5t09" target="_blank" rel="noopener">æœ±é’¦å£«çš„ä¸ªäººåšå®¢</a></p><h3 id="ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥"><a href="#ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥" class="headerlink" title="ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥"></a>ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥</h3><p>è¯»å®Œäº†æœ±é™¢å£«çš„åšå®¢ä¸Šçš„æ–‡ç« ï¼Œå°±åƒæ‰“å¼€äº†æˆ‘çš„å¥½å¥‡å¿ƒæ½˜å¤šæ‹‰é­”ç›’ï¼Œè¶Šæ¥è¶ŠåƒçŸ¥é“å…³äºç”Ÿå‘½ç§‘å­¦çš„çŸ¥è¯†ï¼Œå°±åœ¨ Amazon ä¸Šæœäº†ä¸€ä¸‹ä»–çš„ä¹¦ï¼Œè¿˜çœŸçš„æœ‰ä¸€æœ¬ï¼Œå°± get åˆ°å•¦ã€‚</p><blockquote><p>è¿™æ˜¯ä¸€æœ¬ä»åˆ†å­ç»†èƒå°ºåº¦ä¸Šè®²è§£ç”Ÿå‘½å¥¥ç§˜çš„ç§‘æ™®å°ä¹¦ã€‚ç”¨å¹³å®æµ…æ˜¾çš„è¯­è¨€è§£é‡Šäº†å¤æ‚ç”Ÿå‘½ç³»ç»Ÿçš„ä¸€äº›åŸºæœ¬çŸ¥è¯†ã€‚ è®©æˆ‘äº†è§£äº†äººä½“æ˜¯ç”±60ä¸‡äº¿ä¸ªç»†èƒç»„æˆçš„å¤æ‚ç³»ç»Ÿï¼Œè›‹ç™½è´¨å¯¹ç”Ÿå‘½ä½“çš„é‡è¦æ„ä¹‰ï¼Œäº†è§£äº†æ‰€æœ‰ç”Ÿç‰©ä»åˆ†å­å±‚é¢ä¸Šæ˜¯åŸºæœ¬ä¸€è‡´çš„ã€å…·æœ‰å…±åŒçš„ç¥–å…ˆã€‚ä¹¦ä¸­è§£é‡Šäº†å…ˆæœ‰è›‹å†æœ‰é¸¡çš„ç»“è®ºï¼Œè§£é‡Šäº†å¯¹ç‰›å¼¹ç´çš„ç§‘å­¦ä¾æ®ã€‚ç»™è¿™äº›â€œåƒå¤å¥‡æ¡ˆâ€ä»¥â€œç§‘å­¦å®šè®ºâ€ã€‚è¿˜æœ‰å¾ˆå¤šå¹³æ—¶æˆ‘ä»¬ä½“ä¼šåˆ°äº†ä½†æ˜¯æ²¡æœ‰æ·±æƒ³çš„ç”Ÿå‘½ç°è±¡ï¼Œä½œè€…éƒ½ç»™å‡ºäº†æœ‰æ„æ€çš„æè¿°å’Œè§£é‡Šã€‚ æœ€åä¸€ç« è§£é‡Šäº†ç¥ç»ç³»ç»Ÿçš„å¤æ‚ç¨‹åº¦ï¼Œè®©æˆ‘ä»ç”Ÿç‰©å­¦æ„ä¹‰ä¸Šäº†è§£äº†æ—¶ä¸‹å¤§çƒ­çš„äººå·¥æ™ºèƒ½æ·±åº¦å­¦ä¹ æŠ€æœ¯çš„ç”Ÿç‰©å­¦åŸºç¡€ã€‚ ä¸è¿‡ï¼Œæœ€åä¸€ç« åœ¨å…¨ä¹¦ä¸­å äº†å¤§çº¦å››åˆ†ä¹‹ä¸€çš„ç¯‡å¹…ï¼Œä¸ªäººæ„Ÿè§‰ç”¨åŠ›ä¸å‡ã€‚æˆ‘æ˜¯è·³ç€çœ‹äº†äº›ç‰‡æ®µã€‚ ç„¶è€Œç‘•ä¸æ©ç‘œï¼Œå¯¹äºç”Ÿç‰©å­¦å°ç™½æ¥è¯´ï¼Œä¼šè®©ä½ å…¥è¿·çš„ã€‚æ„Ÿè°¢ä½œè€…ï¼</p></blockquote><p>çœ‹è¿™æœ¬ä¹¦å’Œä»–çš„åšå®¢ä¸€æ ·ç²¾å½©ï¼Œå¦å¤–è¿˜å‡ºäº†å¦ä¸€æœ¬ä¹¦ã€Šç”Ÿå‘½é€šå²ã€‹ï¼Œçœ‹äº†ä¸€ä¸‹ç›®å½•å’Œä»–åšå®¢é‡Œå†™çš„å†…å®¹åŠå…¶ç›¸ä¼¼ï¼Œç­‰åˆ°ä»¥åå†ä¹°æœ¬çº¸è´¨ç‰ˆçš„çœ‹ã€‚æƒ³èµ·æ¥äº†å¤§å­¦æ—¶æ›¾è¯»è¿‡çš„ä¸€æœ¬ä¹¦ã€Šç”Ÿå‘½çš„è·ƒå‡ã€‹ï¼Œæˆ‘è§‰ç€äºŒè€…ä¹‹é—´æ¯”è¾ƒç›¸ä¼¼ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/tjOSuGPhu7" target="_blank" rel="noopener">ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥</a></p><h3 id="ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ"><a href="#ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ" class="headerlink" title="ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ"></a>ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ</h3><p>ç‰›æ´¥é€šè¯†è¯»æœ¬ç³»åˆ—çš„ä¹¦ç±å¤§æ¦‚æœ‰ä¸‰åå‡ æœ¬ï¼Œåœ¨ Amazon ä¸Š Kindle Unlimited ä¼šå‘˜æ˜¯å¯ä»¥å…è´¹å€Ÿé˜…ã€‚åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸€äº›ä¸€ä¸¤ç™¾é¡µå­ã€‚è¿™æœ¬å…³äºåœ°çƒç§‘æ™®å°å†Œå­ç®€å•åœ°ä»‹ç»äº†ä¸€ä¸‹åœ°çƒçš„åœ°çƒçš„å½¢æˆã€å†…æ ¸ã€åœ°ç£åœºã€ç«å±±è¿åŠ¨ç­‰çŸ¥è¯†ã€‚æ€»ä¹‹è¯»èµ·æ¥å¯ä»¥æ»¡è¶³ä¸€ä¸‹è‡ªå·±çš„å¥½å¥‡å¿ƒå•¦ğŸ˜‹</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/ExJxAKtv8d" target="_blank" rel="noopener">ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ</a></p><h3 id="ä¸ƒå ‚æç®€ç‰©ç†è¯¾"><a href="#ä¸ƒå ‚æç®€ç‰©ç†è¯¾" class="headerlink" title="ä¸ƒå ‚æç®€ç‰©ç†è¯¾"></a>ä¸ƒå ‚æç®€ç‰©ç†è¯¾</h3><p>è™½ç„¶è¢«æ§å¾—å¾ˆå¥½ï¼Œä½†è§‰ç€æ²¡å•¥å¥½çœ‹çš„â€¦â€¦ğŸ™„</p><h3 id="é¸Ÿç°å¤æ–‡æ˜"><a href="#é¸Ÿç°å¤æ–‡æ˜" class="headerlink" title="é¸Ÿç°å¤æ–‡æ˜"></a>é¸Ÿç°å¤æ–‡æ˜</h3><p>è¿™æœ¬ä¹¦æ˜¯æœ‹å‹é€çš„ï¼Œä¹Ÿæ˜¯ 2020 å¹´è¯»è¿‡æœ€å–œæ¬¢çš„ä¹¦ï¼Œä¹¦ä¸­çš„æ’å›¾ç›¸å½“ç²¾ç¾</p><p>ä¹¦ä¸­æåˆ°è¿‡åºè´å¤åŸï¼Œå½“æ—¶æ‰¾äº†ä¸¤æœŸçºªå½•ç‰‡æ¥çœ‹ï¼š</p><ul><li><a href="https://www.bilibili.com/video/BV1aK4y1e7k7" target="_blank" rel="noopener">ã€çºªå½•ç‰‡ã€‘åºè´å¤åŸ æ­ç§˜è¢«å†»ç»“äºæ—¶å…‰ä¸­çš„äººã€åŒè¯­ç‰¹æ•ˆå­—å¹•ã€‘ã€çºªå½•ç‰‡ä¹‹å®¶å­—å¹•ç»„ã€‘</a></li><li><a href="https://www.bilibili.com/video/BV1jT4y1373W" target="_blank" rel="noopener">ã€çºªå½•ç‰‡ã€‘åºè´ å°˜åŸƒè½å®šã€1080pã€‘ã€åŒè¯­ç‰¹æ•ˆå­—å¹•ã€‘ã€çºªå½•ç‰‡ä¹‹å®¶å­—å¹•ç»„ã€‘</a></li></ul><blockquote><p>  130å¹…åŸå¸‚å¤åŸå›¾ï¼Œé‡ç°å¤æ–‡æ˜å…¨æ™¯</p><p>  å€Ÿç”±ç»†è…»ç”»ç¬”ï¼Œæº¯ç€æ—¶é—´ä¹‹æµï¼Œè§¦ç¢°åƒå¹´å‰çš„ç¹åå·¨æ¢¦</p><p>  ä»¥åœ°ä¸­æµ·æ²¿å²¸ä¸ºä¸­å¿ƒï¼Œæ¨ªè·¨ä¹å¤§åœ°åŸŸï¼Œè¿‘ç™¾åº§å»ºç­‘ç¾¤è·ƒç„¶çœ¼å‰</p><p>  å®ƒä»¬æ˜¯å¤ä»£ç»Ÿæ²»è€…é›„å¿ƒä¸æŠ±è´Ÿçš„è§è¯</p><p>  ä¹Ÿæ˜¯æˆ‘ä»¬ç†è§£å¤å¸Œè…Šã€ç½—é©¬ã€åŸƒåŠæ–‡æ˜çš„æœ€ä½³é€”å¾„</p><p>  ğŸŒŸ æ‰€æœ‰ä¼Ÿå¤§çš„åŸå¸‚ï¼Œéƒ½æ˜¯åœ¨ä¿¡å¿µä¸æ¢¦æƒ³ä¸­å»ºæ„è€Œæˆã€‚</p><p>  å®ƒä»¬å¹¶ä¸åªè¾‰ç…Œäºå†å²ï¼Œå…¶å…‰èŠ’ä¹Ÿç…§è€€äº†åä¸–å‰è¿›ä¹‹è·¯ã€‚</p><p>  ğŸŒŸ å¤ä»£åŸå¸‚å¤åŸé¢†åŸŸå·¨æ“˜è®©-å…‹åŠ³å¾·Â·æˆˆå°”ä¸‡å‡­å€Ÿé›†ç»˜ç”»ã€å»ºç­‘ä¸è€ƒå¤å­¦äºä¸€èº«çš„å¤©èµ‹ï¼Œ å°†é‚£äº›åŒ–ä¸ºå°˜åœŸï¼Œé¢“æˆæ®‹å£çš„å¤è€åºŸå¢Ÿé‡æ–°ä¿®è‘ºã€‚</p></blockquote><p><img src="img/20200403_043253117_iOS.jpg" alt=""><br><img src="img/20200405_162332630_iOS.jpg" alt=""><br><img src="img/20200405_162437116_iOS.jpg" alt=""><br><img src="img/20200406_101134106_iOS.jpg" alt=""><br><img src="img/20200406_102610423_iOS.jpg" alt=""></p><h3 id="å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾"><a href="#å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾" class="headerlink" title="å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾"></a>å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾</h3><p>ä¸é”™çš„å¤©ä½“ç‰©ç†å­¦ç§‘æ™®ï¼Œæ˜¯è‘—åçš„å…¨çƒç•…é”€ä¹¦ä½œå®¶å¸ƒè±æ©Â·è€ƒå…‹æ–¯å’Œæ°å¤«Â·ç¦ä¿®çš„å…¨æ–°åŠ›ä½œã€‚è¿™æ˜¯ä¸€æœ¬å…³äºå®‡å®™å†å²çš„ç§‘æ™®è¯»ç‰©ã€‚å…¨ä¹¦åˆ†ä¸ºå®‡å®™çš„æ•…äº‹ã€å¤ªé˜³æœ‰å¤šè€ã€ç»™åœ°çƒç§°é‡ã€åˆ°æ’æ˜Ÿçš„è·ç¦»ã€çˆ±å› æ–¯å¦å¼•åŠ›è®ºã€å¤§çˆ†ç‚¸ã€ç»™å®‡å®™ç§¤é‡ã€å¤§çˆ†ç‚¸ä¹‹å‰å‘ç”Ÿäº†ä»€ä¹ˆã€æˆ‘ä»¬çš„ä¸–ç•Œä¹éƒ¨åˆ†ç»„æˆã€‚ä¹¦ä¸­ç”¨åˆ°çš„æ–¹æ³•è€¶ååˆ†æœ‰è¶£ï¼Œä¾‹å¦‚åˆ©ç”¨å¸†å¸ƒèƒŒåŒ…é‡Œè£…ä¸Šä¸¤ä¸ªGPS æ¥æ”¶å™¨æ¥æµ‹é‡å¤ªé˜³æœ‰å¤šè€ï¼›åˆ©ç”¨åœ¨å¸ƒé‡Œæ–¯æ‰˜å°”æµ·å³¡çš„æµ·å¹³é¢ä¸Šçš„ä¸€ä¸ªæµ®æ ‡ï¼Œæ¥ç»™åœ°çƒçš„å¤§å°åšä¸€ä¸ªå¤§è‡´çš„æµ‹é‡ğŸ˜‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/qDg3uQqKW5" target="_blank" rel="noopener">å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾</a></p><h3 id="å®‡å®™ä»èµ·æºåˆ°æœªæ¥"><a href="#å®‡å®™ä»èµ·æºåˆ°æœªæ¥" class="headerlink" title="å®‡å®™ä»èµ·æºåˆ°æœªæ¥"></a>å®‡å®™ä»èµ·æºåˆ°æœªæ¥</h3><p><code>æ‘˜æŠ„</code> <a href="https://t.co/zDlbJOshP1" target="_blank" rel="noopener">å®‡å®™ä»èµ·æºåˆ°æœªæ¥</a></p><h3 id="Life-ç”Ÿå‘½"><a href="#Life-ç”Ÿå‘½" class="headerlink" title="Life ç”Ÿå‘½"></a>Life ç”Ÿå‘½</h3><p><code>æ‘˜æŠ„</code> <a href="https://t.co/d1FD3UtnXV" target="_blank" rel="noopener">Life ç”Ÿå‘½</a></p><h3 id="å¤æ‚ç”Ÿå‘½çš„èµ·æº"><a href="#å¤æ‚ç”Ÿå‘½çš„èµ·æº" class="headerlink" title="å¤æ‚ç”Ÿå‘½çš„èµ·æº"></a>å¤æ‚ç”Ÿå‘½çš„èµ·æº</h3><p>è¿™æœ¬ä¹¦æ˜¯ä» Twitter ä¸Šå‘ç°çš„ï¼Œ2020 å¹´ 11 æœˆä»½åˆšå‡ºç‰ˆï¼ŒKindle å•†åº—é‡Œæœ‰ç”µå­ç‰ˆï¼Œçœ‹åˆ°ä½œè€…æ˜¯<strong>å°¼å…‹Â·è±æ©</strong>æ—¶å°±æƒ³åˆ°ä¹‹å‰è¯»è¿‡ä»–çš„ã€Šç”Ÿå‘½çš„è·ƒå‡ã€‹ï¼Œå°±æ¯«ä¸çŠ¹è±«åœ°ä¹°äº†èŠ±äº†ä¸€å‘¨çš„æ—¶é—´è¯»å®Œäº†ã€‚å› ä¸ºè¯»è¿‡ä»–çš„ã€Šç”Ÿå‘½çš„è·ƒå‡ã€‹ï¼Œåœ¨è¯»è¯»è¿™æœ¬ä¹¦çš„æ—¶å€™å¾ˆå¤šå†…å®¹å°±ä¼¼æ›¾ç›¸è¯†ã€‚</p><ul><li>çº¿ç²’ä½“æœçœŸæ˜¯åå‰¯å…¶å®çš„â€œå‘ç”µæœºâ€ğŸ˜‚</li></ul><blockquote><p>  è´¨å­è¿˜æ˜¯å¸¦ç”µç²’å­ï¼Œå¸¦ä¸€ä¸ªå•ä½çš„æ­£ç”µè·ã€‚æ‰€ä»¥æŠŠè´¨å­æ³µè¿‡ä¸€å±‚å°é—­çš„è†œäº§ç”Ÿäº†ä¸¤ä¸ªæ•ˆæœï¼šç¬¬ä¸€ï¼Œåœ¨è†œçš„ä¸¤è¾¹åˆ¶é€ äº†è´¨å­çš„æµ“åº¦å·®ï¼›ç¬¬äºŒï¼Œè†œçš„ä¸¤è¾¹å½¢æˆäº†ç”µä½å·®ï¼Œå¤–éƒ¨ç¯å¢ƒç›¸å¯¹äºå†…éƒ¨æ˜¯æ­£ç”µä½ï¼Œè†œå†…è†œå¤–çš„ç”µä½å·®æ˜¯150ï½200æ¯«ä¼ã€‚ä¸è¦å°çœ‹è¿™ä¸ªæ•°å­—ï¼Œå› ä¸ºè†œæœ¬èº«éå¸¸è–„ï¼ˆåšåº¦ä¸º6çº³ç±³å·¦å³ï¼‰ï¼Œåœ¨è¿™ä¹ˆçŸ­çš„è·ç¦»ä¸Šï¼Œè¿™æ˜¯éå¸¸å¼ºå¤§çš„ç”µåŠ¿èƒ½åœºã€‚ä½ å¯ä»¥å†æ¬¡å˜å›ATPçš„å¤§å°å»ä½“éªŒä¸€ä¸‹ã€‚å¦‚æœå¾…åœ¨è†œé™„è¿‘ï¼Œä½ æ„Ÿå—åˆ°çš„ç”µåœºå¼ºåº¦æ˜¯æ¯ç±³ä¸‰åƒä¸‡ä¼ç‰¹ï¼Œç›¸å½“äºä¸€é“é—ªç”µï¼Œæˆ–è€…æ˜¯æ™®é€šå®¶ç”¨ç”µçš„1,000å€ã€‚</p></blockquote><ul><li>åœ¨è¯»ã€Šç”Ÿå‘½é€šå²ã€‹çš„æ—¶å€™é‡Œé¢ä¹Ÿè°ˆåˆ°è¿‡çœŸæ ¸ç»†èƒæ¼”åŒ–å‡ºç»†èƒæ ¸çš„åŸå› ï¼š</li></ul><blockquote><p>  ç»†èƒæ ¸è†œå°±æ˜¯è¿™é“éšœç¢ï¼Œå¯ä»¥æŠŠè½¬å½•å’Œè½¬è¯‘ä¸¤ä¸ªè¿‡ç¨‹åˆ†å¼€ã€‚åœ¨ç»†èƒæ ¸ä¸­ï¼ŒåŸºå› è¢«è½¬å½•æˆRNAè½¬å½•æœ¬ï¼›åœ¨ç»†èƒæ ¸å¤–ï¼Œæ ¸ç³–ä½“ä¼šè¯»å–RNAï¼Œå†è½¬è¯‘æˆè›‹ç™½è´¨ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œç¼“æ…¢çš„å‰ªæ¥è¿‡ç¨‹åœ¨ç»†èƒæ ¸å†…è¿›è¡Œï¼Œåœ¨æ ¸ç³–ä½“æœ‰æœºä¼šæ¥è§¦åˆ°RNAä¹‹å‰å·²ç»å¤„ç†å®Œæ¯•ã€‚è¿™å°±æ˜¯ç»†èƒæ ¸çœŸæ­£çš„æ„ä¹‰ï¼šæŠŠå¹²åŠ²å†²å¤©çš„æ ¸ç³–ä½“æŒ¡åœ¨å¤–é¢ã€‚è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆçœŸæ ¸ç”Ÿç‰©éœ€è¦ç»†èƒæ ¸ï¼Œè€ŒåŸæ ¸ç”Ÿç‰©ä¸éœ€è¦ã€‚åŸæ ¸ç”Ÿç‰©æ ¹æœ¬æ²¡æœ‰å†…å«å­çš„éº»çƒ¦ã€‚</p></blockquote><blockquote class="twitter-tweet"><p lang="zh" dir="ltr"><a href="https://twitter.com/hashtag/%E9%89%B4%E4%B9%A6?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#é‰´ä¹¦</a> ç»ˆäºå‡ºä¸­æ–‡ç‰ˆäº†ï¼æˆ‘è¿˜æ²¡æœ‰è¯»è¿‡ï¼Œä¸çŸ¥é“ç¿»è¯‘å¾—æ€æ ·ã€‚åŸä¹¦çš„è‹±æ–‡ç‰ˆæ˜¯æˆ‘è¯»è¿‡çš„æœ€æ£’çš„ç§‘æ™®ä¹¦ä¹‹ä¸€ï¼Œåœ¨æˆ‘å¿ƒç›®ä¸­çš„åœ°ä½å’Œã€Šè‡ªç§çš„åŸºå› ã€‹ã€ã€Šæªç‚®ç—…èŒä¸é’¢é“ã€‹å’Œã€Šæ— ç©·çš„å¼€å§‹ã€‹å·®ä¸å¤šã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™4æœ¬ä¹¦æ˜¯ç°ä»£çŸ¥è¯†åˆ†å­çš„å¿…è¯»ä¹¦ï¼Œç¼ºä¸€æœ¬ä½ éƒ½ä¸å®Œæ•´ã€‚ <a href="https://t.co/ohO7iID6be" target="_blank" rel="noopener">pic.twitter.com/ohO7iID6be</a></p>&mdash; immusoul (@ayuan1000) <a href="https://twitter.com/ayuan1000/status/1332641409510215680?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">November 28, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>å¦å¤–æ¨èä¸‹é¢å‡ æœŸè§†é¢‘èŠ‚ç›®ï¼Œä¹Ÿä¸è¿™æœ¬ä¹¦çš„å†…å®¹æœ‰å¾ˆå¤§å…³ç³»ã€‚</p><ul><li><a href="https://www.bilibili.com/video/BV185411h79H" target="_blank" rel="noopener">ã€é¬¼è°·é—²è°ˆã€‘åœ¨é‚£å……æ»¡æ¯’ä¸ç«çš„æ·±æ¸Šä¸­ï¼Œç§‘å­¦å®¶å‘ç°äº†ç”Ÿå‘½æœ¬æºçš„çº¿ç´¢</a></li><li><a href="https://www.bilibili.com/video/BV1Qh411R7Zf" target="_blank" rel="noopener">ã€é¬¼è°·é—²è°ˆã€‘ç´«è‰²åœ°çƒï¼šä¸€ä¸ªæ€ç”Ÿä»¥æŠ¤ç”Ÿçš„æ•…äº‹</a></li><li><a href="https://www.bilibili.com/video/BV1NT4y1w7vD" target="_blank" rel="noopener">ã€é¬¼è°·é—²è°ˆã€‘ä¸€æ¬¡æ”¹å†™ç”Ÿå‘½æ¼”åŒ–çš„é‚‚é€…</a></li><li><a href="https://www.youtube.com/watch?v=GPYn1vJh1Q0" target="_blank" rel="noopener">ç§‘å­¦å£°éŸ³ï¼šç”Ÿå‘½èµ·æº</a></li><li><a href="https://www.bilibili.com/video/BV1N54y1R7CM" target="_blank" rel="noopener">ã€Šå®‡å®™æ—¶ç©ºä¹‹æ—…ï¼šæœªçŸ¥ä¸–ç•Œã€‹03ï¼šå¤±è½çš„ç”Ÿå‘½ä¹‹åŸ</a> å¢™è£‚æ¨èğŸ˜Š</li></ul><p>å¦å¤–å†æ¨èè±†ç“£å°ç»„ä¸Šçš„ç¯‡æ–‡ç«  <a href="https://www.douban.com/group/topic/33656795/" target="_blank" rel="noopener">1978å¹´åŒ–å­¦è¯ºå¥–ï¼šATPã€çº¿ç²’ä½“ç»“æ„å’Œæœ‰æ°§å‘¼å¸</a></p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/soPnC8gnbs" target="_blank" rel="noopener">å¤æ‚ç”Ÿå‘½çš„èµ·æº</a></p><h3 id="ç”Ÿå‘½çš„è·ƒå‡"><a href="#ç”Ÿå‘½çš„è·ƒå‡" class="headerlink" title="ç”Ÿå‘½çš„è·ƒå‡"></a>ç”Ÿå‘½çš„è·ƒå‡</h3><p>è¿™æœ¬ä¹¦åœ¨å¤§å­¦çš„æ—¶å€™è¯»è¿‡ä¸€éï¼Œé‚£æ—¶å€™æ˜¯çœ‹çš„ <a href="https://www.bilibili.com/video/BV1wx41177Tm" target="_blank" rel="noopener">æŸ´çŸ¥é“ï¼šå…­åˆ†é’Ÿé€Ÿè¯»ã€Šç”Ÿå‘½çš„è·ƒå‡ã€‹</a> æ‰è®¤è¯†åˆ°è¿™æœ¬ä¹¦ï¼Œåœ¨è¯»å®Œ </p><p>ã€Šå¤æ‚ç”Ÿå‘½çš„èµ·æºã€‹çš„èµ·æºååˆå†³å®šé‡æ–°å›é¡¾ä¸€ä¸‹è¿™æœ¬ä¹¦ï¼Œé‡è¯»äº†ä¸€éã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/50bSWvIOAd" target="_blank" rel="noopener">ç”Ÿå‘½çš„è·ƒå‡</a></p><p>å…³äºä½œè€…å°¼å…‹Â·è±æ©ï¼Œå‰½çªƒä¸€æ®µè±†ç“£ä¸Šçš„ç®€ä»‹ï¼š</p><blockquote><p>  å°¼å…‹Â·è±æ©ï¼ˆNick Laneï¼‰ï¼Œæ¼”åŒ–ç”Ÿç‰©å­¦å®¶ï¼Œè‹±å›½ä¼¦æ•¦å¤§å­¦å­¦é™¢æ•™æˆã€‚ä»–çš„ç ”ç©¶æ–¹å‘ä¸ºæ¼”åŒ–ç”Ÿç‰©å­¦ä¸ç”Ÿç‰©èƒ½é‡å­¦ï¼Œèšç„¦äºç”Ÿå‘½çš„èµ·æºä¸å¤æ‚ç»†èƒçš„æ¼”åŒ–ã€‚ä»–è¿˜æ˜¯ä¼¦æ•¦å¤§å­¦å­¦é™¢çº¿ç²’ä½“ç ”ç©¶å­¦ä¼šçš„åˆ›å§‹æˆå‘˜ï¼Œä¹Ÿæ˜¯ç”Ÿå‘½èµ·æºç ”ç©¶è®¡åˆ’çš„é¡¹ç›®é¢†å¤´äººã€‚2010å¹´ï¼Œä»–ä»¥ã€Šç”Ÿå‘½çš„è·ƒå‡ã€‹è£è·è‹±å›½çš‡å®¶å­¦ä¼šç§‘å­¦å›¾ä¹¦å¥–ã€‚å°¼å…‹æœ¬äººå› ä¸ºåœ¨åˆ†å­ç”Ÿç‰©å­¦ç ”ç©¶ä¸Šçš„å“è¶Šè´¡çŒ®ï¼Œäº2015å¹´è£è·è‹±å›½ç”Ÿç‰©åŒ–å­¦å­¦ä¼šå¥–ã€‚ä»–ä¸ä»…æ·±è€•è‡ªå·±çš„å­¦æœ¯ç ”ç©¶é¢†åŸŸï¼Œè¿˜å­œå­œä¸å€¦åœ°å‚ä¸å…¬ä¼—ç§‘å­¦æ™®åŠã€‚2016å¹´ï¼Œå°¼å…‹å› ä¸ºåœ¨ç§‘å­¦ä¼ æ’­ä¸Šçš„æ·±å…¥ä»˜å‡ºè€Œè£è·è‹±å›½çš‡å®¶å­¦ä¼šè¿ˆå…‹å°”Â·æ³•æ‹‰ç¬¬å¥–ç« ã€‚</p></blockquote><p>æœ€è¿‘ä¹Ÿåœ¨è¯»ä»–çš„<a href="https://search.books.com.tw/redirect/move/key/å°¼å…‹â€§é€£æ©/area/mid/item/0010730616/page/1/idx/2/cat/001/pdf/1" target="_blank" rel="noopener">ç”Ÿå‘½ä¹‹æºï¼šèƒ½é‡ã€æ¼”åŒ–èˆ‡è¤‡é›œç”Ÿå‘½çš„èµ·æº</a>ï¼Œå°æ¹¾è²“é ­é·¹å‡ºç‰ˆå‡ºç‰ˆçš„ï¼Œå¤§é™†è¿˜æ²¡æœ‰ï¼Œåªèƒ½ä¹°ç¹ä½“çš„çº¸è´¨ä¹¦æ¥çœ‹ã€‚å¦å¤–è¿˜æœ‰ä¸€æœ¬ã€Š<a href="https://search.books.com.tw/redirect/move/key/å°¼å…‹â€§é€£æ©/area/mid/item/0010874343/page/1/idx/1/cat/001/pdf/1" target="_blank" rel="noopener">èƒ½é‡ã€æ€§ã€æ­»äº¡ï¼šç²’ç·šé«”èˆ‡æˆ‘å€‘çš„ç”Ÿå‘½(15å‘¨å¹´æ–°ç‰ˆ)</a>ã€‹ã€‚è¿™ä¸¤æœ¬éƒ½èƒ½åœ¨æŸå®ä¸Šä»£è´­ä¹°åˆ°ï¼Œæˆ–è€…é€šè¿‡ <a href="https://www.books.com.tw/products/0010730616?sloc=main" target="_blank" rel="noopener">åšå®¢æ¥</a> ä»£è´­ä¹°åˆ°ã€‚</p><p><img src="img/image-20210109225801483.png" alt="image-20210109225801483"></p><h3 id="æ¶ˆå¤±çš„å¾®ç”Ÿç‰©ï¼šæ»¥ç”¨æŠ—ç”Ÿç´ å¼•å‘çš„å±æœº"><a href="#æ¶ˆå¤±çš„å¾®ç”Ÿç‰©ï¼šæ»¥ç”¨æŠ—ç”Ÿç´ å¼•å‘çš„å±æœº" class="headerlink" title="æ¶ˆå¤±çš„å¾®ç”Ÿç‰©ï¼šæ»¥ç”¨æŠ—ç”Ÿç´ å¼•å‘çš„å±æœº"></a>æ¶ˆå¤±çš„å¾®ç”Ÿç‰©ï¼šæ»¥ç”¨æŠ—ç”Ÿç´ å¼•å‘çš„å±æœº</h3><p>å½“èƒå„¿é€šè¿‡é˜´é“çš„æ—¶å€™ï¼Œåè€…å°±åƒä¸€åªå¯Œæœ‰å¼¹æ€§çš„æ‰‹æŒï¼Œç´§ç´§åœ°åŒ…è£¹ä½å©´å„¿æŸ”è½¯çš„èº«ä½“ï¼ŒæŠšæ‘¸è¿‡æ¯ä¸€å¯¸è‚Œè‚¤ã€‚å°±æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç»†èŒè½¬ç§»å‘ç”Ÿäº†ã€‚å©´å„¿çš„çš®è‚¤å°±åƒæµ·ç»µï¼Œå¸æ”¶äº†å®ƒå‘¨å›´çš„ä¹³é…¸æ†èŒã€‚èƒå„¿çš„è„‘è¢‹æœä¸‹ï¼Œè€Œä¸”é¢å¯¹ç€æ¯äº²çš„èƒŒéƒ¨ï¼Œæ°å¥½è´´åˆç€äº§é“ã€‚å©´å„¿å¸å…¥çš„ç¬¬ä¸€å£æ±æ¶²åŒ…å«äº†æ¯äº²é˜´é“é‡Œçš„å¾®ç”Ÿç‰©ï¼Œä¹Ÿä¸æ’é™¤æœ‰ä¸€å®šçš„è‚ é“å¾®ç”Ÿç‰©ã€‚å¤©ç„¶çš„åˆ†å¨©å¹¶ä¸æ˜¯ä¸€ä¸ªæ— èŒçš„è¿‡ç¨‹ï¼Œä½†æ˜¯å®ƒä»æ¥éƒ½æ˜¯è¿™ç§çŠ¶æ€â€”â€”ä»æˆ‘ä»¬æœ€æ—©çš„å“ºä¹³åŠ¨ç‰©ç¥–å…ˆç®—èµ·ï¼Œè‡³å°‘7000ä¸‡å¹´äº†ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/CpTb1LusIP" target="_blank" rel="noopener">æ¶ˆå¤±çš„å¾®ç”Ÿç‰©ï¼šæ»¥ç”¨æŠ—ç”Ÿç´ å¼•å‘çš„å±æœº</a></p><h2 id="æ¼«ç”»-å°è¯´"><a href="#æ¼«ç”»-å°è¯´" class="headerlink" title="æ¼«ç”»/å°è¯´"></a>æ¼«ç”»/å°è¯´</h2><h3 id="å¿ƒé‡Œæµ‹é‡è€…"><a href="#å¿ƒé‡Œæµ‹é‡è€…" class="headerlink" title="å¿ƒé‡Œæµ‹é‡è€…"></a>å¿ƒé‡Œæµ‹é‡è€…</h3><p>è¯»åæ„Ÿå¯ä»¥å‚è§ <a href="https://blog.k8s.li/PSYCHO-PASS-booklist.html">PSYCHO-PASS å¿ƒç†æµ‹é‡è€…å°è¯´è¯»åæ„Ÿ</a>ï¼Œè¿™éƒ¨æ”¹ç¼–è‡ªåŠ¨æ¼«çš„å°è¯´åŸºæœ¬ä¸Šè¿˜åŸäº†æ•´ä¸ªç¬¬ä¸€éƒ¨åŠ¨ç”»å®Œæ•´çš„å‰§æƒ…ï¼Œæ€»ä¹‹ä¹Ÿæ˜¯å…³äºä¸€ä¸ªå¦‚ä½•æ„å»ºäººç±»ç¤¾ä¼šé¢˜æçš„å°è¯´ã€‚å°è¯´ä¸­ä¹Ÿæåˆ°äº†å¾ˆå¤šä¹¦ç±ï¼Œä¹Ÿæœ‰ç½‘å‹æ€»ç»“äº†ä¸€ä»½å¿ƒç†æµ‹é‡è€…ä¸­æåˆ°çš„ä¹¦ç±ï¼Œä¹¦å•å¦‚ä¸‹:</p><p>å…¶ä¸­å¢æ¢­çš„ä¹¦ä¹Ÿæ˜¯æˆ‘çœ‹äº†è¿™éƒ¨å°è¯´ä¹‹åæ‰å¼€å§‹è¯»çš„ï¼Œè¿˜æœ‰ä¸€æœ¬æ˜¯ç¦æŸ¯çš„ã€Šè§„è®­ä¸æƒ©ç½šï¼šç›‘ç‹±çš„è¯ç”Ÿã€‹ï¼Œå‰©ä½™ä»·å€¼é‚£æœŸè¢«å°æ€çš„èŠ‚ç›®é‡Œç½—æ–°è€å¸ˆä¹Ÿæåˆ°è¿‡è¿™æœ¬ä¹¦ã€‚é©¬å…‹æ€Â·éŸ¦ä¼¯çš„ä¹¦åœ¨ã€Šä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶ã€‹ä¸­æåˆ°ä¸å°‘ï¼Œå°¤å…¶æ˜¯å…³äºå®˜åƒšæ”¿æ²»çš„ï¼Œè€Œä¸”é©¬å…‹æ€Â·éŸ¦ä¼¯è¿˜å’Œå‰æ–‡æåˆ°çš„è·¯å¾·ç»´å¸ŒÂ·å†¯Â·ç±³å¡æ–¯ä¹Ÿæ˜¯ä¸€å¯¹å­¦æœ¯ä¸Šçš„å¥½åŸºå‹ã€‚</p><p><code>æ‘˜æŠ„</code> <a href="https://t.co/gp1upTv3IK" target="_blank" rel="noopener">å¿ƒé‡Œæµ‹é‡è€…</a></p><h3 id="è´¹é©¬æœ€ç»ˆå®šç†"><a href="#è´¹é©¬æœ€ç»ˆå®šç†" class="headerlink" title="è´¹é©¬æœ€ç»ˆå®šç†"></a>è´¹é©¬æœ€ç»ˆå®šç†</h3><p>æ—¥ç³»ç‹—ç²®å°è¯´ğŸ•ï¼Œç¬¬ä¸€æ¬¡è¯»è¿™æœ¬ä¹¦è¿˜æ˜¯å¤§ä¸‰çš„æ—¶å€™ï¼Œ<del>é‚£æ—¶å€™å’±åˆšåˆšå¼€å§‹äº†äººç”Ÿçš„ç¬¬ä¸€æ¬¡åˆæ‹ï¼Œå¹¶æŠŠè¿™æœ¬ä¹¦é€ç»™äº†å‰å¥³å‹</del>ğŸ¤£ã€‚åŒæ ·çš„å°è¯´è¿˜æœ‰ã€Šæ•°å­¦å¥³å­©ã€‹ï¼Œåè€…çš„è¯„ä»·å¾ˆé«˜ï¼Œä½†æƒ³è¦é€šè¿‡å°è¯´æ¥å­¦ä¹ æ•°å­¦æ˜¯ç—´å¿ƒå¦„æƒ³å•¦ã€‚å˜›ï¼Œå°è¯´å°±æ˜¯å…´è¶£è¯»ç‰©ï¼Œç»™è¿™äº›æ¯ç‡¥ä¼šè‰²çš„æ•°å­¦å…¬å¼å¢åŠ ä¸€ç‚¹è‰²å½©~~</p><p>è™½ç„¶å¯¹äºæ•°å­¦æ¥è®²ï¼Œå’±æœ¨å­ç®€ç›´æ˜¯ä¸ªå­¦è„†ğŸ˜­ï¼Œé«˜è€ƒæ•°å­¦è€ƒäº† 60 å‡ åˆ†ï¼Œè¿™ä¹Ÿè®©å’±ä¸åç‰Œå¤§å­¦å¤±ä¹‹äº¤è‡‚ï¼Œåªèƒ½å»è¯»ç¬¬å…­çº§æœ¬ç§‘é™¢æ ¡ğŸ˜‘ï¼Œå¤šå°‘æœ‰ç‚¹é—æ†¾å§ã€‚ä¸è¿‡çº³ï¼Œå¯¹äºé‚£äº›æ¯ç‡¥æ— æ¯”çš„è®¡ç®—å…¬å¼æ±‚ç§¯åˆ†è§£å¾®åˆ†æ–¹ç¨‹ç­‰ï¼Œå’±æ›´å–œæ¬¢çŸ¥é“æ•°å­¦è¿™æœ¬å­¦ç§‘èƒŒåçš„å†å²ï¼šæƒ³çŸ¥é“ç‰›é¡¿å’Œè±å¸ƒå°¼èŒ¨ä¹‹é—´çš„æ’•é€¼å¤§æˆ˜ï¼Œæƒ³çŸ¥é“ä¼¯åŠªåŠ›å®¶æ—çš„æ©ä»‡æ€¨æ¨ï¼Œæƒ³çŸ¥é“ç¬›å¡å°”ä¸å…¬ä¸»çš„çˆ±æƒ…æ•…äº‹ï¼Œæƒ³çŸ¥é“æ¬§æ‹‰å¥‹ç¬”ç–¾ä¹¦éå‡¡çš„ä¸€ç”Ÿï¼Œæƒ³çŸ¥é“åºåŠ è±çŒœæƒ³ä¸<code>å®‡å®™çš„å½¢çŠ¶</code>ç­‰ç­‰ã€‚è¿™ä¹Ÿæ˜¯å’±å³ä¾¿æ¯•ä¸šç¦»å¼€å¤§å­¦ä¹‹åï¼Œä¸å†æ˜¯ä¸€åå­¦ç”Ÿä½†ä¹Ÿæ˜¯åƒå­¦ç”Ÿæ—¶ä»£çš„è‡ªå·±é‚£æ ·å¥½å¥‡å¿ƒå¦‚æ­¤åœ°æ—ºç››ğŸ˜‚</p><blockquote><p>ã€æˆ‘ä¸€ç›´è§‰å¾—ï¼Œè´¹é©¬ã€æ¬§æ‹‰ã€å“¥å¾·å·´èµ«ç­‰äººä¸ç°ä»£äººç›¸æ¯”ï¼Œä»–ä»¬å…·æœ‰æ ¼å¤–æ—ºç››çš„å¥½å¥‡å¿ƒå’Œä¸°å¯Œçš„æƒ³è±¡åŠ›ï¼Œå¹¶ä¸”å……æ»¡äº†ç”Ÿæœºä¸æ´»åŠ›ã€‚éšç€ç¤¾ä¼šå‘å±•çš„æ—¥ç›Šæˆç†Ÿï¼Œå¥½å¥‡å¿ƒå’Œæƒ³è±¡åŠ›ä¸å¯é¿å…åœ°ä¸æ–­é™ä½ï¼Œä½†å¹¶ä¸ä»£è¡¨ç°ä»£ç¤¾ä¼šä¸å†éœ€è¦å¥½å¥‡å¿ƒå’Œæƒ³è±¡åŠ›ã€‚ã€</p></blockquote><p><code>æ‘˜æŠ„</code> <a href="https://t.co/UqDfbYRjs7" target="_blank" rel="noopener">è´¹é©¬æœ€ç»ˆå®šç†</a></p><h3 id="æ¥è‡ªæ–°ä¸–ç•Œ"><a href="#æ¥è‡ªæ–°ä¸–ç•Œ" class="headerlink" title="æ¥è‡ªæ–°ä¸–ç•Œ"></a>æ¥è‡ªæ–°ä¸–ç•Œ</h3><p>å…ˆæ˜¯çœ‹å®Œçš„ TV åŠ¨ç”»ï¼Œåˆçœ‹çš„åŸåˆ›å°è¯´ã€‚è™½ç„¶å°è¯´ç§°ä¹‹ä¸ºæ˜¯åä¹Œæ‰˜é‚¦ä¹‹ä½œï¼Œä½†å®ƒä¸ã€Š1984ã€‹ã€ã€Šç¾ä¸½æ–°ä¸–ç•Œã€‹è¿™ç±»ä¹¦æœ‰ç€å¾ˆå¤§çš„ä¸åŒã€‚ä¹¦ä¸­å¹¶æ²¡æœ‰ç¬¦å·åŒ–ä¸€ä¸ªå¼ºåŠ¿çš„æ”¿åºœå½¢è±¡ï¼Œä¹Ÿæ²¡æœ‰ç»å¯¹çš„â€åäººâ€œã€‚</p><p><a href="https://t.co/JbLvSP4cP0" target="_blank" rel="noopener">æ¥è‡ªæ–°ä¸–ç•Œ</a></p><h3 id="æ¨±èŠ±åº„çš„å® ç‰©å¥³å­©"><a href="#æ¨±èŠ±åº„çš„å® ç‰©å¥³å­©" class="headerlink" title="æ¨±èŠ±åº„çš„å® ç‰©å¥³å­©"></a>æ¨±èŠ±åº„çš„å® ç‰©å¥³å­©</h3><p>å¤§å­¦çš„æ—¶å€™çœ‹è¿‡ TV åŠ¨ç”»ï¼ŒèŠ±äº†å‡ ä¸ªé€šå®µæ—¶é—´åˆè¯»å®Œäº†è¿™éƒ¨å°è¯´ã€‚</p><h3 id="æ˜Ÿé™…ç©¿è¶Š"><a href="#æ˜Ÿé™…ç©¿è¶Š" class="headerlink" title="æ˜Ÿé™…ç©¿è¶Š"></a>æ˜Ÿé™…ç©¿è¶Š</h3><p>å’Œæœ‹å‹ä¸€å—å»çœ‹å®Œæ˜Ÿé™…ç©¿è¶Šçš„ç”µå½±ååˆè¡¥çœ‹çš„å°è¯´ï¼Œæ€»ä½“ä¸Šä¸é”™ï¼Œé«˜åº¦è¿˜åŸäº†ç”µå½±ä¸­çš„æƒ…èŠ‚ã€‚</p><blockquote><p>  äº‹å®è¿˜ä¸æ­¢äºæ­¤ã€‚äººç±»ä¸æ˜¯ä¸€ç¾¤å­¤ç‹¬çš„ç”Ÿç‰©æœ‰æœºä½“ï¼Œè€Œæ˜¯ä¸€ä¸ªç§æ—å‘å±•ä¸Šç™¾ä¸‡å¹´çš„æœ€ç»ˆç»“æœï¼Œè•´å«ç€ä¸Šç™¾ä¸‡å¹´çš„æ¢ç´¢ã€ç¥è¯ã€ç¤¾ç¾¤ã€æˆ–é‡è¦æˆ–è’è°¬çš„æƒ³æ³•ã€è¯—æ­Œã€å“²å­¦ã€å·¥ç¨‹ã€ç§‘å­¦ã€‚</p></blockquote><blockquote><p>  è¯šç„¶ï¼Œå€ŸåŠ©è¿™ä»¶ä¸œè¥¿ï¼Œä»–å’Œå¸ƒå…°å¾·æ•™æˆèƒ½è®©æ•°åƒä¸ªç”Ÿç‰©å­¦æ„ä¹‰ä¸Šçš„äººç±»é™ç”Ÿäºä¸–ï¼Œä½†ä»–ä»¬ä¸¤äººå°±èƒ½çœŸæ­£æ›¿ä»£é”™ç»¼äº¤ç»‡çš„ä¼ æ‰¿å’Œå½’å±â€”â€”æ›¿ä»£çˆ±å—ï¼Ÿè¿™çœŸçš„æ˜¯åœ¨æ‹¯æ•‘äººç±»å—ï¼Ÿåœ¨æ£®æ—è¢«çƒ§ä¸ºå¹³åœ°ä¹‹å‰æŠ¢æ•‘å‡ºä¸€ç²’ç§å­ï¼Œå¹¶ä¸æ„å‘³ç€æ‹¯æ•‘äº†æ£®æ—ã€‚ç¹å¤è€Œç‹¬ç‰¹çš„ç”Ÿæ€ç³»ç»Ÿæ°¸è¿œæ— æ³•å¤åˆ¶ã€‚è§£å†»äººç±»èƒšèƒä¹Ÿç®—ä¸ä¸Šâ€œæ‹¯æ•‘â€äººç±»ã€‚</p></blockquote><p>æ‘˜æŠ„ <a href="https://t.co/Hmv8cWVB80" target="_blank" rel="noopener">æ˜Ÿé™…ç©¿è¶Š</a></p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;é¦–å…ˆç»™å„ä½å…³æ³¨æˆ‘åšå®¢çš„å°ä¼™ä¼´è¯´å£°æŠ±æ­‰ï¼Œå·²ç»å¾ˆé•¿æ—¶é—´ï¼ˆå°†è¿‘
        
      
    
    </summary>
    
    
      <category term="æ€è€ƒ" scheme="https://blog.k8s.li/categories/%E6%80%9D%E8%80%83/"/>
    
    
      <category term="é˜…è¯»" scheme="https://blog.k8s.li/tags/%E9%98%85%E8%AF%BB/"/>
    
      <category term="è¯»ä¹¦ç¬”è®°" scheme="https://blog.k8s.li/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>è½»é‡çº§å®¹å™¨ä¼˜åŒ–å‹ Linux å‘è¡Œç‰ˆ Photon OS</title>
    <link href="https://blog.k8s.li/Photon-OS.html"/>
    <id>https://blog.k8s.li/Photon-OS.html</id>
    <published>2020-09-24T16:00:00.000Z</published>
    <updated>2020-09-24T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‰æ®µæ—¶é—´æ¡åƒåœ¾ä¸œæ‹¼è¥¿å‡‘æäº†å° Homelab ğŸ‘‡ç©ç© ğŸ‘‰<a href="https://blog.k8s.li/homelab.html">ã€Šåƒåœ¾ä½¬çš„ Homelab æŠ˜è…¾è®°å½•ã€‹</a> ã€‚</p><p><img src="img/20200913_esxi_01.png" alt=""></p><p>æ€»ä½“æ¥è®²æ€§ä»·æ¯”é«˜ï¼ŒIntel i5-6600T çš„æ€§èƒ½å’Œ i5-6600 æŒå¹³ï¼Œæ¯”é‚£ç§ 8250U ä¹‹ç±»çš„ä½å‹ U è¦é«˜å¾ˆå¤šï¼Œè·‘ä¸€å †è™šæ‹Ÿæœºä¹Ÿä¸æˆé—®é¢˜ï¼Œç”šè‡³è·‘ä¸ªä¸‰ master + ä¸¤ node çš„ kubernetes é›†ç¾¤ä¹Ÿæ˜¯å¯ä»¥ğŸ˜‚ã€‚è‡³äºåŠŸè€—ï¼Œæ•´æœºå¾…æœºæ—¶ä¸åˆ° 30W ï¼Œä¸€å¤©ä¸åˆ° 1 åº¦ç”µï¼Œä¸ç”¨æ‹…å¿ƒç”µè´¹çˆ†è¡¨äº†ï¼›è‡³äºä»·æ ¼ï¼Œä¸€é¢— Intel i5-6600T  ä¸åˆ° 450 å—é’±ï¼Œè¿˜ä¸é¦™å˜›ğŸ™ƒã€‚</p><p>åœ¨ ESXi è¿è¡Œç€ä¸€äº›è™šæ‹Ÿæœºï¼Œæ¯”å¦‚ç”¨ WireGuard æ‰“é€š VPS ä¹‹é—´çš„ç½‘ç»œï¼Œè¿è¡Œåœ¨ä¸€ä¸ª alpine è™šæ‹Ÿæœºé‡Œä½œä¸ºç½‘å…³æœºä½¿ç”¨ï¼›æ¯”å¦‚ä½¿ç”¨ <a href="https://pi-hole.net/" target="_blank" rel="noopener">Pi-holeÂ®</a> æ¥æ„å»ºè‡ªå·±çš„ DNS æœåŠ¡å™¨ï¼Œç”¨æ¥æ‹¦æˆªå±è”½åŸŸåï¼›æ¯”å¦‚è¿è¡Œ time-machine æœåŠ¡ç”¨æ¥å®šæ—¶å¤‡ä»½ MacBook ï¼›æ¯”å¦‚ Windows è™šæ‹Ÿæœºé‡Œè¿è¡Œç€ä¸€äº›å›½äº§æ¯’ç˜¤è½¯ä»¶ğŸ˜¡ï¼›æ¯”å¦‚ä½¿ç”¨ <a href="https://docs.drone.io/" target="_blank" rel="noopener">Drone</a> è·‘ä¸€å¥—è½»é‡çº§çš„ CI æµæ°´çº¿ç³»ç»Ÿï¼Œæ€»ä¹‹å¯ç©æ€§éå¸¸é«˜å“¦ï¼Œåªè¦ä½ åˆæ—¶é—´çæŠ˜è…¾ï¼Œæ€»èƒ½æ‰¾ç‚¹ä¹å­ç©ğŸ˜‚ã€‚</p><h2 id="Linux-Container-OS"><a href="#Linux-Container-OS" class="headerlink" title="Linux Container OS ?"></a>Linux Container OS ?</h2><p>æœ‰äº†ä¸€å°è¿è¡Œç€ ESXi çš„ Homelab ï¼Œä»Šå¤©å°±ç©ä¸€ä¸‹ Linux container OS ï¼Œå³ Linux å®¹å™¨  OS ã€å®¹å™¨ä¼˜åŒ–å‹ OSï¼Œè¿™æ˜¯ä¸€ç±»ä¸“é—¨é’ˆå¯¹è¿è¡Œå®¹å™¨å®šåˆ¶åŒ–å¼€å‘çš„ Linux å‘è¡Œç‰ˆï¼Œè£å‰ªæ‰ä¸€äº›ä¸å¿…è¦çš„è½¯ä»¶å’Œå†…æ ¸æ¨¡å—ï¼Œä½¿ç³»ç»Ÿæ›´åŠ è½»é‡ä¸€äº›ã€‚è™½ç„¶æ¥è¯´æ°‘ç”¨çº§çš„ Intel i5-6600T æ€§èƒ½ä¹Ÿä¸ç®—å¤ªå·®ï¼Œä½†å’Œ E3  å°ç‹å­ï¼ŒE5 è€å¤§å“¥æ¯”è¿˜æ˜¯å·®ä¸ªåä¸‡å…«åƒé‡Œã€‚å› æ­¤ä¸ºäº†èŠ‚çœä¸€äº› CPU èµ„æºï¼Œå‡å°‘è™šæ‹ŸåŒ–å¸¦æ¥çš„å¼€é”€ï¼Œå°±é€‰æ‹©äº†å®¹å™¨åŒ–è¿è¡Œä¸€äº›åº”ç”¨ï¼ŒåŒæ—¶å†ä¸ºè¿™äº›å®¹å™¨æ‰¾ä¸€ä¸ªè½»é‡çº§çš„å®¿ä¸»æœº OS ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæƒ³è¦ä½¿ç”¨ Linux container OS çš„åŸå› ã€‚</p><h3 id="GKE-çš„-Container-Optimized-OS"><a href="#GKE-çš„-Container-Optimized-OS" class="headerlink" title="GKE çš„ Container-Optimized OS"></a>GKE çš„ <a href="https://cloud.google.com/container-optimized-os/docs/" target="_blank" rel="noopener">Container-Optimized OS</a></h3><p>Kubernetes çš„äº²çˆ¸çˆ¸ Google å®¶çš„ <a href="https://cloud.google.com/kubernetes-engine" target="_blank" rel="noopener">Google Kubernetes Engine</a> å³ GKE é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä½¿ç”¨ <a href="https://cloud.google.com/container-optimized-os/docs/" target="_blank" rel="noopener">Container-Optimized OS</a> æ¥è¿è¡Œå·¥ä½œè´Ÿè½½ï¼Œä¸è¿‡ä»…ä»…æ˜¯é’ˆå¯¹ GCE æ¥è¿›è¡Œä¼˜åŒ–çš„ï¼Œå¯èƒ½åœ¨ OpenStack æˆ–è€… vSphere ä¸Šè¿è¡Œä¸èµ·æ¥ï¼Œ(ççŒœğŸ˜‚ã€‚</p><blockquote><p>  Container-Optimized OS æ˜¯é€‚ç”¨äº <a href="https://cloud.google.com/compute" target="_blank" rel="noopener">Compute Engine</a> è™šæ‹Ÿæœºçš„æ“ä½œç³»ç»Ÿæ˜ åƒï¼Œä¸“ä¸ºè¿è¡Œ Docker å®¹å™¨è€Œä¼˜åŒ–ã€‚å€ŸåŠ© Container-Optimized OSï¼Œæ‚¨å¯ä»¥å¿«é€Ÿã€é«˜æ•ˆã€å®‰å…¨åœ°åœ¨ Google Cloud Platform ä¸Šå¯åŠ¨ Docker å®¹å™¨ã€‚Container-Optimized OS ç”± Google ç»´æŠ¤ï¼ŒåŸºäº <a href="https://www.chromium.org/chromium-os" target="_blank" rel="noopener">Chromium OS</a> å¼€æ”¾æºä»£ç é¡¹ç›®ã€‚</p></blockquote><p>ç‰¹ç‚¹å°±æ˜¯ä¸åŒäºå…¶ä»–çš„ Linux å‘è¡Œç‰ˆï¼Œè¿™ä¸ªæ˜¯åŸºäº <a href="https://www.chromium.org/chromium-os" target="_blank" rel="noopener">Chromium OS</a> å®šåˆ¶åŒ–å¼€å‘çš„ï¼Œå¯¹å†…æ ¸ç‰ˆæœ¬é€‰ç”¨çš„ä¹Ÿæ¯”è¾ƒæ¿€è¿›ï¼Œä¸€èˆ¬æ˜¯ <code>4.19.112+</code> æˆ–è€… <code>5.x</code> ç‰ˆæœ¬ï¼Œè¿™æ ·ä½ å°±ä¸ç”¨å†æ‹…å¿ƒåƒ CentOS 7.x ç³»åˆ—é‚£æ ·å„ç§å†…æ ¸ bug äº†ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">items:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Node</span></span><br><span class="line">  <span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">nodeInfo:</span></span><br><span class="line">      <span class="attr">architecture:</span> <span class="string">amd64</span></span><br><span class="line">      <span class="attr">bootID:</span> <span class="string">0c517083-aaf6-75fc4b2204ba</span></span><br><span class="line">      <span class="attr">containerRuntimeVersion:</span> <span class="string">docker://19.3.1</span></span><br><span class="line">      <span class="attr">kernelVersion:</span> <span class="number">4.19</span><span class="number">.112</span><span class="string">+</span></span><br><span class="line">      <span class="attr">kubeProxyVersion:</span> <span class="string">v1.16.13-gke.1</span></span><br><span class="line">      <span class="attr">kubeletVersion:</span> <span class="string">v1.16.13-gke.1</span></span><br><span class="line">      <span class="attr">machineID:</span> <span class="string">33a96ff3203d88c0a542</span></span><br><span class="line">      <span class="attr">operatingSystem:</span> <span class="string">linux</span></span><br><span class="line">      <span class="attr">osImage:</span> <span class="string">Container-Optimized</span> <span class="string">OS</span> <span class="string">from</span> <span class="string">Google</span></span><br><span class="line">      <span class="attr">systemUUID:</span> <span class="string">33a96ff33d88c0a542</span></span><br></pre></td></tr></table></figure><p>Chromium OS å°±æ˜¯ Google åŸºäº Linux å†…æ ¸å¼€å‘çš„æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥ Google ä¹Ÿæœ‰è¿™ä¸ªå®åŠ›é’ˆå¯¹è‡ªå®¶çš„ GCP äº‘å¹³å°è¿›è¡Œå®šåˆ¶åŒ–å¼€å‘ä¸ª OS å‡ºæ¥ï¼Œä¸“é—¨ç»™ kubernetes é›†ç¾¤è¿è¡Œä½¿ç”¨ï¼Œå®šåˆ¶åŒ–å¼€å‘çš„å¥½å¤„å°±æ˜¯å¯ä»¥å¸¦æ¥æ›´å¤šçš„æ–°ç‰¹æ€§ï¼ŒäºŒä¸å—åˆ¶äºä¸Šæ¸¸çš„ Linux å‘è¡Œç‰ˆçš„é™åˆ¶ã€‚æ¯”å¦‚ä¸ä¹…å‰ Google å®£å¸ƒå°†ä½¿ç”¨ <a href="https://cilium.io/" target="_blank" rel="noopener">Cilium</a> ä½œä¸º GKE çš„ä¸‹ä¸€ä»£æ•°æ®é¢ï¼Œ<a href="https://cloud.google.com/blog/products/containers-kubernetes/bringing-ebpf-and-cilium-to-google-kubernetes-engine" target="_blank" rel="noopener">New GKE Dataplane V2 increases security and visibility for containers</a> ï¼Œè€Œ Cilium è¿™é¡¹æŠ€æœ¯æ˜¯ä¾èµ–äºå¯¹ eBPF æŠ€æœ¯ï¼Œè€Œ eBPF åˆä¾èµ–äºå†…æ ¸ç‰¹æ€§çš„æ”¯æŒã€‚</p><h3 id="AWS-çš„-Bottlerocket-OS"><a href="#AWS-çš„-Bottlerocket-OS" class="headerlink" title="AWS çš„ Bottlerocket OS"></a>AWS çš„ <a href="https://github.com/bottlerocket-os/bottlerocket" target="_blank" rel="noopener">Bottlerocket OS</a></h3><p>è¿™ä¸ªæ˜¯ AWS æœ€è¿‘å¼€æºä¸“é—¨é’ˆå¯¹  EC2 è¿›è¡Œä¼˜åŒ–çš„ Linux Container OSï¼Œå’Œ GKE ä¸€æ ·ï¼Œåªæ˜¯é’ˆå¯¹äºè‡ªå®¶çš„ AWS å…¬æœ‰äº‘ï¼Œç”±äºæ˜¯æœ€è¿‘åˆšåˆšæ¨å‡ºçš„ï¼Œè¿˜æ²¡æ¥å¾—åŠå…³æ³¨ï¼Œæ‰€ä»¥å°±ä¸ä»‹ç»äº†ã€‚åŒ GKE çš„ Container-Optimized OS ä¸€æ ·ï¼Œä¸€èˆ¬å…¬æœ‰äº‘å®šåˆ¶åŒ–å¼€å‘çš„ Container OS ä»…ä»…åªé’ˆå¯¹è‡ªå®¶çš„äº‘å¹³å°ã€‚</p><blockquote><h3 id="Optimized-performance-through-AWS-integrations"><a href="#Optimized-performance-through-AWS-integrations" class="headerlink" title="Optimized performance through AWS integrations"></a>Optimized performance through AWS integrations</h3><p>  AWS provided builds of Bottlerocket are optimized to run on Amazon EC2 and include support for the latest Amazon EC2 instance capabilities. They also have built-in integrations with AWS services for container orchestration, registries, and observability.</p></blockquote><h3 id="CoreOS-Container-Linux"><a href="#CoreOS-Container-Linux" class="headerlink" title="CoreOS Container Linux"></a>CoreOS Container Linux</h3><p>æ¥è‡ª CoreOS å›¢é˜Ÿçš„ CoreOS Container Linux ï¼Œå®ƒåº”è¯¥æ˜¯æœ€å¤è€çš„ Linux Container OS ï¼Œæ—©åœ¨ 2013 å¹´ 10 æœˆå°±å·²ç» release ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œé‚£æ—¶å€™çš„ docker è¿˜æ²¡æœ‰åœ¨ 0.x.x ç‰ˆæœ¬ã€‚</p><blockquote><p>  <a href="https://github.com/coreos/manifest/releases/tag/v94.0.0" target="_blank" rel="noopener">v94.0.0</a></p><ul><li>Git is now included by default as a number of people use it for shipping around assets, code, etc like a distributed rsync</li><li>Docker is upgraded to 0.6.3</li><li>xz is included to support new compression types</li><li>Custom OEMs can be provided via the cpio on PXE images</li></ul></blockquote><p>å®ƒæ²¡æœ‰åƒ yum æˆ– apt è¿™æ ·çš„åŒ…ç®¡ç†å™¨æ¥å®‰è£…è½¯ä»¶ï¼Œåœ¨ CoreOS ä¸­ä½ ä¸éœ€è¦å®‰è£…è½¯ä»¶ï¼Œå› ä¸ºæ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½è¦ä½¿ç”¨ docker æ¥æ‰“åŒ…ã€‚</p><ul><li>æœ€å°åŒ–çš„æ“ä½œç³»ç»Ÿï¼š å ç”¨å†…å­˜å¾ˆå°‘ï¼Œæ¯”å…¸å‹çš„æœåŠ¡å™¨ç‰ˆæœ¬ Linux å°‘å  40%çš„å†…å­˜ã€‚</li><li>æ˜“äºå‡çº§ï¼š CoreOS é‡‡ç”¨åŒç³»ç»Ÿåˆ†åŒºï¼ˆä¸»åŠ¨åˆ†åŒº/è¢«åŠ¨åˆ†åŒºï¼‰è®¾è®¡è€Œä¸æ˜¯é‡‡ç”¨ä¼ ç»Ÿçš„é€šè¿‡å‡çº§åŒ…æ¥å‡çº§ç³»ç»Ÿï¼Œè¿™ä½¿å¾—æ¯æ¬¡å‡çº§æ›´åŠ å¿«é€Ÿï¼Œå¯é å’Œæ˜“äºå›æ»šã€‚è¿™ä¸€ç‚¹æœ‰ç‚¹åƒ Android çš„ A/B åˆ†åŒºï¼Ÿ</li><li>é›†æˆ Dockerï¼š CoreOS é»˜è®¤é›†æˆ Docker å¹¶ä½œäº†å¾ˆå¥½çš„æ”¯æŒå’Œä¼˜åŒ–ï¼Œçœå»ç”¨æˆ·å®‰è£…ï¼Œé…ç½®ï¼Œä¼˜åŒ– Docker çš„æ—¶é—´ï¼Œæå¤§åœ°æ–¹ä¾¿äº†ç”¨æˆ·ã€‚</li><li>æ˜“äºé›†ç¾¤åŒ–ï¼š CoreOS æœ¬èº«æä¾›äº†å¤§å‹ Docker å®¹å™¨é›†ç¾¤çš„æ•´ä½“è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡å†…ç½®çš„ fleet å·¥å…·åœ¨å¤šå°ç³»ç»Ÿä¸­éƒ¨ç½²å®¹å™¨å¹¶è¿›è¡Œé›†ç¾¤åŒ–ç®¡ç†ã€‚åŒæ—¶é€šè¿‡æä¾› Discovery Serviceï¼Œä¾¿äºåŠ¨æ€éƒ¨ç½²å’Œç®¡ç†é›†ç¾¤ï¼Œè§£å†³æ–¹æ¡ˆæ¯”è¾ƒæˆç†Ÿã€‚</li><li>è‡ªåŠ¨åŒ–çš„å¤§è§„æ¨¡éƒ¨ç½²ï¼š CoreOS è‡ªèº«æä¾›çš„è§£å†³æ–¹æ¡ˆèƒ½å¤Ÿè‡ªåŠ¨åœ°å¤§è§„æ¨¡æ‰¹é‡éƒ¨ç½²å¹¶æ“ä½œç³»ç»Ÿï¼Œæå¤§åœ°å‡å°‘ç”¨æˆ·å·¥ä½œé‡ã€‚</li><li>ä½¿ç”¨ systemd åšä¸ºç³»ç»ŸæœåŠ¡ç®¡ç†å·¥å…·ï¼Œæ€§èƒ½æ¯”è¾ƒå¥½ï¼Œsystemd æœ‰ç°ä»£åŒ–çš„æ—¥å¿—åŠŸèƒ½ï¼ŒåŒæ—¶é‡‡ç”¨ socket å¼ä¸ D-Bus æ€»çº¿å¼æ¿€æ´»æœåŠ¡.</li></ul><p>ä¸è¿‡ CoreOS æ—©åœ¨ä»Šå¹´å››æœˆä»½å°±å·²ç» EOF äº†ï¼Œ<a href="https://getfedora.org/coreos/" target="_blank" rel="noopener">Fedora CoreOS</a> æˆä¸º CoreOS çš„ç»§ä»»è€…ï¼š</p><blockquote><p>  As weâ€™ve <a href="https://groups.google.com/d/msg/coreos-user/zgqkG88DS3U/PFP9yrKbAgAJ" target="_blank" rel="noopener">previously announced</a>, <a href="https://getfedora.org/coreos/" target="_blank" rel="noopener">Fedora CoreOS</a> is the official successor to CoreOS Container Linux. Fedora CoreOS is a <a href="https://fedoramagazine.org/fedora-coreos-out-of-preview/" target="_blank" rel="noopener">new Fedora Edition</a> built specifically for running containerized workloads securely and at scale. It combines the provisioning tools and automatic update model of Container Linux with the packaging technology, OCI support, and SELinux security of Atomic Host. For more on the Fedora CoreOS philosophy, goals, and design, see the <a href="https://fedoramagazine.org/introducing-fedora-coreos/" target="_blank" rel="noopener">announcement of the preview release</a> and the <a href="https://docs.fedoraproject.org/en-US/fedora-coreos/" target="_blank" rel="noopener">Fedora CoreOS documentation</a>.</p></blockquote><h3 id="çº¢å¸½çš„-RHCOS"><a href="#çº¢å¸½çš„-RHCOS" class="headerlink" title="çº¢å¸½çš„ RHCOS"></a>çº¢å¸½çš„ <a href="https://docs.openshift.com/container-platform/4.1/architecture/architecture-rhcos.html" target="_blank" rel="noopener">RHCOS</a></h3><p>æ¥è‡ªçº¢å¸½å­å®¶çš„ <a href="https://docs.openshift.com/container-platform/4.1/architecture/architecture-rhcos.html" target="_blank" rel="noopener">Red Hat Enterprise Linux CoreOS (RHCOS)</a>ï¼Œæ˜¯åŸºäºä¸è¿‡è¿™ä¸ª OS ä»…ä»…é€‚ç”¨äºå®ƒè‡ªå®¶çš„ <a href="https://docs.openshift.com/" target="_blank" rel="noopener">OpenShift</a>ï¼Œè€Œä¸”å®¹å™¨è¿è¡Œæ—¶ä»…æ”¯æŒ CRI-Oã€‚</p><blockquote><p>  At the moment, CRI-O is only available as a container engine within OpenShift Container Platform clusters.</p></blockquote><p>å› ä¸º CoreOS å›¢é˜Ÿç°å¦‚ä»Šå·²ç»è¢« Red HatÂ® æ”¶è´­äº†ï¼Œæ­£å¦‚åœ¨ <a href="https://access.redhat.com/documentation/zh-cn/openshift_container_platform/4.2/html/architecture/architecture-rhcos" target="_blank" rel="noopener">OpenShift æ–‡æ¡£</a> ä¸­æåˆ°çš„ï¼š Red Hat Enterprise Linux CoreOS (RHCOS) ä»£è¡¨äº†ä¸‹ä¸€ä»£å•ç”¨é€”å®¹å™¨æ“ä½œç³»ç»ŸæŠ€æœ¯ã€‚RHCOS ç”±åˆ›å»ºäº† Red Hat Enterprise Linux Atomic Host å’Œ CoreOS Container Linux çš„åŒä¸€å¼€å‘å›¢é˜Ÿæ‰“é€ ï¼Œå®ƒå°† Red Hat Enterprise Linux (RHEL) çš„è´¨é‡æ ‡å‡†ä¸ Container Linux çš„è‡ªåŠ¨åŒ–è¿œç¨‹å‡çº§åŠŸèƒ½ç»“åˆåœ¨ä¸€èµ·ã€‚</p><h3 id="RancherOS"><a href="#RancherOS" class="headerlink" title="RancherOS"></a>RancherOS</h3><p>RancherOS æ˜¯ Rancher å›¢é˜Ÿæ‰€ç»´æŠ¤çš„å¼€æºé¡¹ç›®ï¼Œä¹Ÿæ˜¯å¯¹æ ‡ CoreOS ä¸€æ ·ï¼Œä¸“é—¨ç”¨æ¥è¿è¡Œå®¹å™¨ï¼Œå¹¶ä¸”å¯ä»¥è¿è¡Œåœ¨ç”Ÿäº§ç¯å¢ƒï¼ˆè‡³å°‘å®˜æ–¹åšäº†è¿™ä¹ˆæ ·çš„æ‰¿è¯ºï¼Œå’±ä¹Ÿæ²¡åœ¨ç”Ÿäº§ç”¨è¿‡ï¼Œä¸å¥½è¯´ã€‚åœ¨ RancherOS ä¸­æ‰€æœ‰çš„è¿›ç¨‹ï¼ˆåŒ…æ‹¬ç³»ç»Ÿæ‰€æœ‰çš„æœåŠ¡ï¼Œæ¯”å¦‚ udev å’Œ syslogï¼‰éƒ½æ˜¯ç”¨ docker æ¥ç®¡ç†ï¼Œè¿™ä¸€ç‚¹è¦æ¯” CoreOS æ›´åŠ æ¿€è¿›ä¸€äº›ï¼Œè€Œ CoreOS è¿˜æ˜¯ä½¿ç”¨ä¼ ç»Ÿ Linux å‘è¡Œç‰ˆä¸­çš„ systemd æ¥ç®¡ç†ç³»ç»Ÿä¸­çš„æœåŠ¡ã€‚RancherOS é€šè¿‡ç§»é™¤ä¼ ç»Ÿ Linux å‘è¡Œç‰ˆä¸­ä¸å¿…è¦çš„æœåŠ¡å’Œåº“æ¥æœ€å°åŒ–ç³»ç»Ÿï¼Œä½¿ä»–ä¸“æ³¨å•ä¸€çš„åŠŸèƒ½ï¼Œå³è¿è¡Œ docker å®¹å™¨ã€‚ä¸è¿‡ä¹‹å‰ä½“éªŒäº†ä¸€ç•ªï¼Œå ç”¨èµ„æºæ¯”è¾ƒå¤šğŸ˜‚ï¼Œå¥½åƒå¹¶æ²¡æœ‰å¤ªå¤§çš„ä¼˜åŠ¿ï¼ˆ</p><p><code>Everything in RancherOS is a Docker container.</code> æ„Ÿè§‰è¿™ä¸ªè¦æ¯” CoreOS æ›´åŠ å®¹å™¨åŒ–ï¼Œç”šè‡³ä½¿ç”¨ docker å–ä»£äº† systemd æ¥ç®¡ç†ç³»ç»Ÿçš„å„ç§æœåŠ¡ã€‚ç³»ç»Ÿå¯åŠ¨åè¿è¡Œä¸¤ä¸ª docker æœåŠ¡è¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯ç³»ç»Ÿ docker ï¼Œåœ¨æ­¤ä¹‹ä¸Šåœ¨è¿è¡Œç³»ç»ŸæœåŠ¡å®¹å™¨ï¼Œå’Œç”¨æˆ·å±‚é¢çš„ docker ã€‚ä¸è¿‡çœ‹ä¸€ä¸‹ä¸‹é¢çš„è¿™å¼ å›¾ä½ å°±ä¼šæ˜ç™½ã€‚æ€»çš„æ¥è®² RancherOS æ˜¯ä½¿ç”¨ docker æ¥ç®¡ç†æ•´ä¸ªç³»ç»Ÿçš„æœåŠ¡çš„ï¼ŒåŒ…æ‹¬ç”¨æˆ·å±‚é¢çš„ docker ã€‚</p><p><img src="img/rancheroshowitworks.png" alt="How it works"></p><h3 id="VMware-çš„-Photon-OS"><a href="#VMware-çš„-Photon-OS" class="headerlink" title="VMware çš„ Photon OS"></a>VMware çš„ <a href="https://vmware.github.io/photon/" target="_blank" rel="noopener">Photon OS</a></h3><p>ä»Šå¤©çš„ä¸»è§’ï¼ŒVMware  å¼€æºçš„ Photon OSï¼Œè¿™ä¸ª OS ä½ å¯èƒ½æ²¡å¬è¯´è¿‡ï¼Œä½† VMware å¼€æºçš„ Harbor æƒ³å¿…å¾ˆç†Ÿæ‚‰ï¼Œè€Œ Harbor çš„åŸºç¡€é•œåƒä½¿ç”¨çš„å°±æ˜¯ä»–å®¶çš„ Photon OSğŸ˜‚ã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root [ /harbor ]# cat /etc/os-release</span><br><span class="line"><span class="attr">NAME</span>=<span class="string">"VMware Photon OS"</span></span><br><span class="line"><span class="attr">VERSION</span>=<span class="string">"2.0"</span></span><br><span class="line"><span class="attr">ID</span>=photon</span><br><span class="line"><span class="attr">VERSION_ID</span>=<span class="number">2.0</span></span><br><span class="line"><span class="attr">PRETTY_NAME</span>=<span class="string">"VMware Photon OS/Linux"</span></span><br><span class="line"><span class="attr">ANSI_COLOR</span>=<span class="string">"1;34"</span></span><br><span class="line"><span class="attr">HOME_URL</span>=<span class="string">"https://vmware.github.io/photon/"</span></span><br><span class="line"><span class="attr">BUG_REPORT_URL</span>=<span class="string">"https://github.com/vmware/photon/issues"</span></span><br></pre></td></tr></table></figure><p>åœ¨ Photon OS çš„æ„å»ºè„šæœ¬ <a href="https://github.com/vmware/photon/blob/master/build.py" target="_blank" rel="noopener">build.py</a> ä¸­å¯ä»¥çœ‹åˆ°å®ƒæ„å»ºçš„äº§ç‰©æ”¯æŒ ISO å’Œ docker é•œåƒï¼Œä»¥åŠä¼—å¤šå…¬æœ‰äº‘çš„è™šæ‹Ÿæœºæ ¼å¼ï¼Œä¸¤è€…éƒ½æ˜¯æ¥è‡ªç›¸åŒçš„æºç ï¼Œæ ¹æ®æ„å»ºå‡ºæ¥çš„æ˜¯å½¢å¼ä¸åŒï¼Œæ‰€åŒ…å«çš„è½¯ä»¶ä¹Ÿä¸åŒã€‚å› ä¸ºè£å‰ªæ‰äº†ä¸€äº›ä¸å¿…è¦çš„ç³»ç»ŸæœåŠ¡ï¼Œ docker é•œåƒæ ¼å¼çš„è¦æ›´ç²¾ç®€ä¸€äº›ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">targetList = &#123;</span><br><span class="line">        "image":["iso", "ami", "gce", "azure", "rpi3", "ova", "ova_uefi", "all", "src-iso",</span><br><span class="line">                "photon-docker-image", "k8s-docker-images", "all-images", "minimal-iso", "rt-iso"],</span><br><span class="line"></span><br><span class="line">        "rpmBuild": ["packages", "packages-minimal", "packages-initrd", "packages-docker",</span><br><span class="line">                "updated-packages", "tool-chain-stage1", "tool-chain-stage2", "check",</span><br><span class="line">                "ostree-repo", "generate-yaml-files", "create-repo", "distributed-build"],</span><br><span class="line"></span><br><span class="line">        "buildEnvironment": ["packages-cached", "sources", "sources-cached", "publish-rpms",</span><br><span class="line">                "publish-x-rpms", "publish-rpms-cached", "publish-x-rpms-cached", "photon-stage"]</span><br></pre></td></tr></table></figure><p>æ€»çš„æ¥è®²ï¼Œä¸Šé¢æåˆ°çš„å‡ ç§å®¹å™¨ä¼˜åŒ–å‹ OS ä¸­ ï¼ŒPhoton OS æ¯”è¾ƒå¼€æ”¾ä¸€äº›ï¼Œè™½ç„¶æ¥è¯´æ˜¯é’ˆå¯¹äºè‡ªå®¶ vSphere è¿›è¡Œä¼˜åŒ–çš„ï¼Œä½†å…¶ä»–å…¬æœ‰äº‘å’Œç§æœ‰äº‘ä¹Ÿæ˜¯æ”¯æŒï¼Œç”šè‡³è¿˜æ”¯æŒæ ‘è“æ´¾ğŸ“ï¼æ‰€ä»¥ä¸ªäººç”¨æˆ·æƒ³æ‹¿æ¥ç©ç©ï¼Œè¿˜æ˜¯ä¸é”™æ»´ã€‚å°¤å…¶æ˜¯é’ˆå¯¹å’±è¿™ç§ç© ESXi è½¯è·¯ç”±çš„åƒåœ¾ä½¬ï¼Œåœ¨ Photon OS ä¸Šè·‘ä¸€äº›å®¹å™¨åº”ç”¨ï¼Œå†é€‚åˆä¸è¿‡äº†ã€‚</p><h2 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h2><table><thead><tr><th align="center">Providers</th><th align="center">Name</th><th align="center">STAR</th><th align="center">FORK</th></tr></thead><tbody><tr><td align="center">Google</td><td align="center"><a href="https://github.com/GoogleCloudPlatform/cos-customizer" target="_blank" rel="noopener">Container-Optimized OS</a></td><td align="center">-</td><td align="center">-</td></tr><tr><td align="center">Amazon</td><td align="center"><a href="https://github.com/bottlerocket-os/bottlerocket" target="_blank" rel="noopener">Bottlerocket OS</a></td><td align="center">4.8K</td><td align="center">185</td></tr><tr><td align="center">CoreOS</td><td align="center">CoreOS Container Linux</td><td align="center">-</td><td align="center">-</td></tr><tr><td align="center">Red Hat</td><td align="center">RHCOS</td><td align="center">-</td><td align="center">-</td></tr><tr><td align="center">Rancher</td><td align="center"><a href="https://github.com/rancher/os" target="_blank" rel="noopener">Rancher OS</a></td><td align="center">6k</td><td align="center">625</td></tr><tr><td align="center">Flatcar</td><td align="center"><a href="https://github.com/flatcar-linux/Flatcar" target="_blank" rel="noopener">Flatcar Linux</a></td><td align="center">117</td><td align="center">3</td></tr><tr><td align="center">VMware</td><td align="center"><a href="https://github.com/vmware/photon" target="_blank" rel="noopener">Photon OS</a></td><td align="center">2.1k</td><td align="center">591</td></tr></tbody></table><table><thead><tr><th align="center">Providers</th><th align="center">Name</th><th align="center">Runtime</th><th align="center">Support Platform</th></tr></thead><tbody><tr><td align="center">Google</td><td align="center">Container-Optimized OS</td><td align="center">docker</td><td align="center">GCP</td></tr><tr><td align="center">Amazon</td><td align="center">Bottlerocket OS</td><td align="center">docker</td><td align="center">AWS</td></tr><tr><td align="center">CoreOS</td><td align="center">CoreOS Container Linux</td><td align="center">docker</td><td align="center">AWS/GCP/OpenStack/VMware<BR>Alibaba Cloud/Azure/DigitalOcean</td></tr><tr><td align="center">Red Hat</td><td align="center">RHCOS</td><td align="center">CRI-O</td><td align="center">AWS/vSphere/Bare Metal</td></tr><tr><td align="center">Rancher</td><td align="center">Rancher OS</td><td align="center">docker</td><td align="center">AWS/GCP/OpenStack/VMware<BR>Alibaba Cloud/Azure/DigitalOcean</td></tr><tr><td align="center">Flatcar</td><td align="center">Flatcar Linux</td><td align="center">docker</td><td align="center">AWS/GCP/OpenStack/VMware<BR>Alibaba Cloud/Azure/DigitalOcean</td></tr><tr><td align="center">VMware</td><td align="center">Photon OS</td><td align="center">docker</td><td align="center">AWS/GCE/Azure/OpenStack<br>vSphere/bare metal/Raspberry Pi 3</td></tr></tbody></table><p>ç›®å‰æ¥è®² Photon OS ä½œä¸º Harbor çš„åŸºç¡€é•œåƒï¼Œåœ¨å®¹å™¨æ–¹é¢æ¯”è¾ƒçªå‡ºä¸€äº›ï¼Œä½†ä½œä¸ºå®¹å™¨çš„å®¿ä¸»æœº OS ï¼Œè¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚ç”±äºæˆ‘æ˜¯ä½¿ç”¨çš„ VMware å®¶çš„ ESXi è™šæ‹ŸåŒ–ï¼Œé‚£ä¹ˆé€‰æ‹©ä»–å®¶çš„ Photon OS æ˜¯æœ€å¥½çš„å–½ï¼Œè€Œä¸” Photon OS æ˜¯é’ˆå¯¹ ESXi åšè¿‡ä¼˜åŒ–çš„ï¼Œå†…æ ¸éƒ½æ˜¯é’ˆå¯¹ ESXi è™šæ‹ŸåŒ–è¿›è¡Œäº†å®šåˆ¶åŒ–çš„å¼€å‘ï¼Œæ‰€ä»¥ç†è®ºä¸Šé€‰æ‹© Photon OS åº”è¯¥æ˜¯æœ€åˆé€‚çš„ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="Download-Format"><a href="#Download-Format" class="headerlink" title="Download Format"></a><a href="https://github.com/vmware/photon/wiki/Downloading-Photon-OS" target="_blank" rel="noopener">Download Format</a></h3><table><thead><tr><th>Format</th><th>Description</th></tr></thead><tbody><tr><td>ISO Image</td><td>Contains everything needed to install either the minimal or full installation of Photon OS. The bootable ISO has a manual installer or can be used with PXE/kickstart environments for automated installations.</td></tr><tr><td>OVA</td><td>Pre-installed minimal environment, customized for VMware hypervisor environments. These customizations include a highly sanitized and optimized kernel to give improved boot and runtime performance for containers and Linux applications. Since an OVA is a complete virtual machine definition, weâ€™ve made available a Photon OS OVA that has virtual hardware version 11; this will allow for compatibility with several versions of VMware platforms or allow for the latest and greatest virtual hardware enhancements.</td></tr><tr><td>Amazon AMI</td><td>Pre-packaged and tested version of Photon OS made ready to deploy in your Amazon EC2 cloud environment. Previously, weâ€™d published documentation on how to create an Amazon compatible instance, but, now weâ€™ve done the work for you.</td></tr><tr><td>Google GCE Image</td><td>Pre-packaged and tested Google GCE image that is ready to deploy in your Google Compute Engine Environment, with all modifications and package requirements for running Photon OS in GCE.</td></tr><tr><td>Azure VHD</td><td>Pre-packaged and tested Azure HD image that is ready to deploy in your Microsoft Azure Cloud, with all modifications and package requirements for running Photon OS in Azure.</td></tr><tr><td>Raspberry Pi3 Image</td><td>Pre-packaged and tested Raspberry Pi3 Image (Version 3.0 onwards) on ARM64 architecture.</td></tr></tbody></table><p>Photon OS æä¾›äº†å¤šç§å®‰è£…æ–¹å¼ï¼Œå…¶ä¸­ ISO æ˜¯é€šç”¨æ€§çš„ï¼Œå°±å’Œå®‰è£…å…¶ä»– Linux å‘è¡Œç‰ˆçš„è¿‡ç¨‹å·®ä¸å¤šï¼ŒOVA æ˜¯è™šæ‹Ÿæœºæ¨¡æ¿ï¼Œå¯ä»¥å¯¼å…¥åˆ° VMware è™šæ‹ŸåŒ–å¹³å°ä¸Šä½¿ç”¨ï¼ŒçœåŒºå®‰è£…çš„æ­¥éª¤ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚OVA è™šæ‹Ÿæœºæ¨¡æ¿çš„ç‰ˆæœ¬ä¸º 11 ï¼Œæ ¹æ® <a href="https://kb.vmware.com/s/article/1003746" target="_blank" rel="noopener">Virtual machine hardware versions</a> ä¸­çš„å®šä¹‰ï¼Œéœ€è¦ ESXi 6.0 Fusion 7.x Workstation 11.x Player 7.x ç‰ˆæœ¬ä»¥ä¸Šçš„è™šæ‹ŸåŒ–æ”¯æŒã€‚</p><table><thead><tr><th><strong>Virtual Hardware Version</strong></th><th><strong>Products</strong></th></tr></thead><tbody><tr><td>18</td><td>ESXi 7.0.1</td></tr><tr><td>17</td><td>ESXi 7.0.0</td></tr><tr><td>16</td><td>Fusion 11.x Workstation Pro 15.x Workstation Player 15.x</td></tr><tr><td>15</td><td>VMware Cloud on AWS ESXi 6.7 U2</td></tr><tr><td>14</td><td>ESXi 6.7 Fusion 10.x Workstation Pro 14.x Workstation Player 14.x</td></tr><tr><td>13</td><td>ESXi 6.5</td></tr><tr><td>12</td><td>Fusion 8.x Workstation Pro 12.x Workstation Player 12.x</td></tr><tr><td>11</td><td>ESXi 6.0 Fusion 7.x Workstation 11.x Player 7.x</td></tr><tr><td>10</td><td>ESXi 5.5 Fusion 6.x Workstation 10.x Player 6.x</td></tr></tbody></table><p>å¦å¤–è¿˜æ”¯æŒ <code>Raspberry Pi 3</code> ï¼Œä¸è¿‡éœ€è¦æ‹¿æºç è‡ªè¡Œç¼–è¯‘é•œåƒï¼Œç„¶ååˆ·åˆ°æ ‘è“æ´¾ä¸Šï¼Œä½ åƒç°çš„æ ‘è“æ´¾åˆæœ‰ç”¨é€”å•¦ğŸ˜‚ã€‚</p><p><a href="https://github.com/vmware/photon/wiki/Downloading-Photon-OS" target="_blank" rel="noopener">ä¸‹è½½æ–¹å¼</a> ğŸ‘‡</p><h3 id="Photon-OS-3-0-Revision-2-Update3-Binaries"><a href="#Photon-OS-3-0-Revision-2-Update3-Binaries" class="headerlink" title="Photon OS 3.0 Revision 2 Update3 Binaries"></a>Photon OS 3.0 Revision 2 Update3 Binaries</h3><p>Aug 14, 2020 An update to 3.0 revision 2 Update3 binaries are now available.</p><table><thead><tr><th>Download</th><th>Size</th><th>md5 checksum</th></tr></thead><tbody><tr><td><a href="https://packages.vmware.com/photon/3.0/Rev3/iso/photon-3.0-a383732.iso" target="_blank" rel="noopener">Full ISO x86_64</a></td><td>5.2G</td><td>2dd9f18c5162a7367f2463f4a9bb4890</td></tr><tr><td><a href="https://packages.vmware.com/photon/3.0/Rev3/iso/photon-minimal-3.0-a383732.iso" target="_blank" rel="noopener">Minimal ISO x86_64</a></td><td>299M</td><td>0119f0f275f246fd382d419ff41898a4</td></tr><tr><td><a href="https://packages.vmware.com/photon/3.0/Rev3/iso/photon-rt-3.0-a383732.iso" target="_blank" rel="noopener">ISO x86_64 Real-Time flavour</a></td><td>489M</td><td>d2bfce95b54a29174b5beaef9962dbc1</td></tr><tr><td><a href="https://packages.vmware.com/photon/3.0/Rev3/ova/photon-hw11-3.0-a383732.ova" target="_blank" rel="noopener">OVA-hw11</a></td><td>188M</td><td>ba52abd88c5b22cd4498cf0e88457f28</td></tr><tr><td><a href="https://packages.vmware.com/photon/3.0/Rev3/ova/photon-hw13_uefi-3.0-a383732.ova" target="_blank" rel="noopener">OVA-hw13_uefi</a></td><td>214M</td><td>95614f3b08c1a93306ababcc826572df</td></tr></tbody></table><p>åœ¨æ­¤ä½¿ç”¨ OVA-hw11 æ ¼å¼çš„ OVA è™šæ‹Ÿæœºæ¨¡æ¿ï¼Œåé¢é‚£ä¸ªå¸¦ uefi çš„éœ€è¦è®¾ç½®è™šæ‹Ÿæœºä¸º EFI æ¨¡å¼å¯åŠ¨ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚</p><ul><li>åˆ›å»ºè™šæ‹Ÿæœºçš„æ—¶å€™ä½¿ç”¨ OVA æ–‡ä»¶å¯¼å…¥</li></ul><p><img src="img/20200922-esxi_ova_01.png" alt=""></p><ul><li>é»˜è®¤çš„ç”¨æˆ·åä¸º <code>root</code> ï¼Œå¯†ç ä¸º <code>changeme</code>ï¼Œç™»å½•ä¹‹åå†è¾“å…¥ä¸€é <code>changeme</code>ï¼Œç„¶åä¿®æ”¹ä¸ºæ–°çš„å¯†ç ã€‚</li></ul><p><img src="img/20200922-esxi_photonos-01.png" alt=""></p><h2 id="ç³»ç»Ÿä¿¡æ¯"><a href="#ç³»ç»Ÿä¿¡æ¯" class="headerlink" title="ç³»ç»Ÿä¿¡æ¯"></a>ç³»ç»Ÿä¿¡æ¯</h2><ul><li>å†…æ ¸ç‰ˆæœ¬ä¸º <code>4.19.132-5.ph3-esx</code>ï¼Œ4.19 æ˜¯ä¸ª LTS ç‰ˆæœ¬çš„å†…æ ¸ï¼Œç»“å°¾çš„ <code>esx</code> åˆ™ä»£è¡¨ç€ä¸º <code>ESXi</code> è™šæ‹ŸåŒ–å®šåˆ¶çš„å†…æ ¸ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Linux photon-machine 4.19.132-5.ph3-esx #1-photon SMP Wed Aug 12 21:02:13 UTC 2020 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure><ul><li>rpm åŒ…æ•°é‡ä»…ä»…ä¸º 146 ä¸ªï¼Œä¸€èˆ¬çš„ CentOS å‘è¡Œç‰ˆè‡ªå¸¦çš„ rpm åŒ…æ•°é‡ä¸º 300 ä¸ªå·¦å³ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# rpm -qa | wc</span><br><span class="line">    146     146    4307</span><br></pre></td></tr></table></figure><ul><li>ç³»ç»Ÿè¿›ç¨‹ä¿¡æ¯ï¼Œè¿˜æ˜¯é‡‡ç”¨ systemd æ¥ç®¡ç†è¿›ç¨‹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# systemctl status</span><br><span class="line">â— photon-machine</span><br><span class="line">    State: running</span><br><span class="line">     Jobs: 0 queued</span><br><span class="line">   Failed: 0 units</span><br><span class="line">    Since: Tue 2020-09-22 08:07:29 UTC; 10min ago</span><br><span class="line">   CGroup: /</span><br><span class="line">           â”œâ”€user.slice</span><br><span class="line">           â”‚   â”œâ”€session-c2.scope</span><br><span class="line">           â”‚   â”‚ â”œâ”€413 sshd: root@pts/0</span><br><span class="line">           â”‚   â”‚ â”œâ”€420 -bash</span><br><span class="line">           â”‚   â”‚ â”œâ”€443 systemctl status</span><br><span class="line">           â”‚   â”‚ â””â”€444 systemctl status</span><br><span class="line">           â”‚   â””â”€user@0.service</span><br><span class="line">           â”‚     â””â”€init.scope</span><br><span class="line">           â”‚       â”œâ”€393 /lib/systemd/systemd --user</span><br><span class="line">           â”‚       â””â”€394 (sd-pam)</span><br><span class="line">           â”œâ”€init.scope</span><br><span class="line">           â”‚ â””â”€1 /lib/systemd/systemd</span><br><span class="line">           â””â”€system.slice</span><br><span class="line">             â”œâ”€systemd-networkd.service</span><br><span class="line">             â”‚ â””â”€245 /lib/systemd/systemd-networkd</span><br><span class="line">             â”œâ”€systemd-udevd.service</span><br><span class="line">             â”‚ â””â”€124 /lib/systemd/systemd-udevd</span><br><span class="line">             â”œâ”€vgauthd.service</span><br><span class="line">             â”‚ â””â”€159 /usr/bin/VGAuthService -s</span><br><span class="line">             â”œâ”€systemd-journald.service</span><br><span class="line">             â”‚ â””â”€97 /lib/systemd/systemd-journald</span><br><span class="line">             â”œâ”€sshd.service</span><br><span class="line">             â”‚ â””â”€352 /usr/sbin/sshd -D</span><br><span class="line">             â”œâ”€vmtoolsd.service</span><br><span class="line">             â”‚ â””â”€161 /usr/bin/vmtoolsd</span><br><span class="line">             â”œâ”€systemd-resolved.service</span><br><span class="line">             â”‚ â””â”€247 /lib/systemd/systemd-resolved</span><br><span class="line">             â”œâ”€dbus.service</span><br><span class="line">             â”‚ â””â”€157 /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only</span><br><span class="line">             â”œâ”€systemd-timesyncd.service</span><br><span class="line">             â”‚ â””â”€151 /lib/systemd/systemd-timesyncd</span><br><span class="line">             â””â”€systemd-logind.service</span><br><span class="line">               â””â”€158 /lib/systemd/systemd-logind</span><br></pre></td></tr></table></figure><ul><li>ç£ç›˜æ ¹ç›®å½•åªä½¿ç”¨äº†ä¸åˆ° 600M</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# df -h</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">&#x2F;dev&#x2F;root        16G  577M   15G   4% &#x2F;</span><br></pre></td></tr></table></figure><ul><li>å†…å­˜ä¹Ÿåªä½¿ç”¨äº† 43Miï¼Œå¯åŠ¨ dockerd ä¹‹åå†…å­˜å ç”¨ 108Miï¼Œæ¢æˆ containerd å°†ä¼šå°ä¸€äº›ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:          2.0Gi        43Mi       1.8Gi       0.0Ki       103Mi       1.8Gi</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨ dockerd å®ˆæŠ¤è¿›ç¨‹ä¹‹åå†…å­˜å ç”¨ 108Mi</span></span><br><span class="line">root@photon-machine [ ~ ]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:          2.0Gi       108Mi       1.6Gi       0.0Ki       298Mi       1.8Gi</span><br></pre></td></tr></table></figure><ul><li>å†…æ ¸æ¨¡å—çš„æ•°é‡ä¹Ÿæ¯”è¾ƒå°‘ 30 ä¸ªå·¦å³ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ä¸€äº›ç½‘ç»œç›¸å…³çš„å†…æ ¸æ¨¡å—ã€‚å¸¸è§„çš„ Linux å‘è¡Œç‰ˆçš„å†…æ ¸æ¨¡å—å¾€å¾€åœ¨ 60 ä¸ªä»¥ä¸Šã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# lsmod</span><br><span class="line">Module                  Size  Used by</span><br><span class="line">xt_conntrack           16384  2</span><br><span class="line">ip6table_mangle        16384  0</span><br><span class="line">ip6table_nat           16384  0</span><br><span class="line">nf_nat_ipv6            16384  1 ip6table_nat</span><br><span class="line">iptable_mangle         16384  0</span><br><span class="line">iptable_nat            16384  0</span><br><span class="line">nf_nat_ipv4            16384  1 iptable_nat</span><br><span class="line">nf_nat                 28672  2 nf_nat_ipv6,nf_nat_ipv4</span><br><span class="line">ip6table_filter        16384  1</span><br><span class="line">ip6_tables             24576  3 ip6table_filter,ip6table_nat,ip6table_mangle</span><br><span class="line">iptable_filter         16384  1</span><br><span class="line">xt_LOG                 16384  0</span><br><span class="line">nf_conntrack           90112  4 xt_conntrack,nf_nat,nf_nat_ipv6,nf_nat_ipv4</span><br><span class="line">nf_defrag_ipv6         20480  1 nf_conntrack</span><br><span class="line">nf_defrag_ipv4         16384  1 nf_conntrack</span><br><span class="line">mousedev               20480  0</span><br><span class="line">vfat                   20480  1</span><br><span class="line">fat                    61440  1 vfat</span><br><span class="line">evdev                  20480  1</span><br><span class="line">vmwgfx                253952  1</span><br><span class="line">psmouse                90112  0</span><br><span class="line">drm_kms_helper        106496  1 vmwgfx</span><br><span class="line">ttm                    86016  1 vmwgfx</span><br><span class="line">drm                   323584  4 vmwgfx,drm_kms_helper,ttm</span><br><span class="line">sr_mod                 24576  0</span><br><span class="line">i2c_core               40960  2 drm_kms_helper,drm</span><br><span class="line">cdrom                  49152  1 sr_mod</span><br><span class="line">rdrand_rng             16384  0</span><br><span class="line">rng_core               16384  1 rdrand_rng</span><br><span class="line">ipv6                  368640  16 nf_nat_ipv6,ip6table_mangle</span><br><span class="line">root@photon-machine [ ~ ]# lsmod | wc</span><br><span class="line">     31     109    1273</span><br></pre></td></tr></table></figure><ul><li>ç³»ç»Ÿè‡ªå¸¦çš„ docker ç‰ˆæœ¬ä¸º <code>19.03.10</code>ï¼Œå­˜å‚¨é©±åŠ¨ä½¿ç”¨çš„æ˜¯ <code>overlay2</code></li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">Client:</span><br><span class="line"> Debug Mode: false</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Containers: 0</span><br><span class="line">  Running: 0</span><br><span class="line">  Paused: 0</span><br><span class="line">  Stopped: 0</span><br><span class="line"> Images: 0</span><br><span class="line"> Server Version: 19.03.10</span><br><span class="line"> Storage Driver: overlay2</span><br><span class="line">  Backing Filesystem: extfs</span><br><span class="line">  Supports d_type: true</span><br><span class="line">  Native Overlay Diff: true</span><br><span class="line"> Logging Driver: json-file</span><br><span class="line"> Cgroup Driver: cgroupfs</span><br><span class="line"> Plugins:</span><br><span class="line">  Volume: local</span><br><span class="line">  Network: bridge host ipvlan macvlan null overlay</span><br><span class="line">  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog</span><br><span class="line"> Swarm: inactive</span><br><span class="line"> Runtimes: runc</span><br><span class="line"> Default Runtime: runc</span><br><span class="line"> Init Binary: docker-init</span><br><span class="line"> containerd version: b34a5c8af56e510852c35414db4c1f4fa6172339</span><br><span class="line"> runc version: d736ef14f0288d6993a1845745d6756cfc9ddd5a</span><br><span class="line"> init version: fec3683</span><br><span class="line"> Security Options:</span><br><span class="line">  apparmor</span><br><span class="line">  seccomp</span><br><span class="line">   Profile: default</span><br><span class="line"> Kernel Version: 4.19.132-5.ph3-esx</span><br><span class="line"> Operating System: VMware Photon OS/Linux</span><br><span class="line"> OSType: linux</span><br><span class="line"> Architecture: x86_64</span><br><span class="line"> CPUs: 1</span><br><span class="line"> Total Memory: 1.951GiB</span><br><span class="line"> Name: photon-machine</span><br><span class="line"> ID: HXBT:Z4LZ:4HZM:3YII:U7ZA:RVOH:Z7CL:L4FA:YGA4:Y2V6:DSVR:NWPD</span><br><span class="line"> Docker Root Dir: /var/lib/docker</span><br><span class="line"> Debug Mode: false</span><br><span class="line"> Registry: https://index.docker.io/v1/</span><br><span class="line"> Labels:</span><br><span class="line"> Experimental: false</span><br><span class="line"> Insecure Registries:</span><br><span class="line">  127.0.0.0/8</span><br><span class="line"> Live Restore Enabled: false</span><br><span class="line"> Product License: Community Engine</span><br></pre></td></tr></table></figure><h2 id="ç³»ç»Ÿç®¡ç†"><a href="#ç³»ç»Ÿç®¡ç†" class="headerlink" title="ç³»ç»Ÿç®¡ç†"></a>ç³»ç»Ÿç®¡ç†</h2><h3 id="ç½‘ç»œç®¡ç†"><a href="#ç½‘ç»œç®¡ç†" class="headerlink" title="ç½‘ç»œç®¡ç†"></a>ç½‘ç»œç®¡ç†</h3><ul><li>æŸ¥çœ‹ç½‘å¡çŠ¶æ€ï¼Œå¯ä½¿ç”¨è‡ªå¸¦çš„ <code>networkctl</code> å‘½ä»¤è¡Œå·¥å…·ï¼Œåƒ ifconfigã€ipã€ss ç­‰å‘½ä»¤éƒ½å·²ç»é»˜è®¤å®‰è£…ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ /mnt/RPMS ]# networkctl status eth0</span><br><span class="line">â— 2: eth0</span><br><span class="line">       Link File: /usr/lib/systemd/network/99-default.link</span><br><span class="line">    Network File: /etc/systemd/network/99-dhcp-en.network</span><br><span class="line">            Type: ether</span><br><span class="line">           State: routable (configured)</span><br><span class="line">            Path: pci-0000:0b:00.0</span><br><span class="line">          Driver: vmxnet3</span><br><span class="line">          Vendor: VMware</span><br><span class="line">           Model: VMXNET3 Ethernet Controller</span><br><span class="line">      HW Address: 00:0c:29:74:13:16 (VMware, Inc.)</span><br><span class="line">         Address: 192.168.0.235</span><br><span class="line">                  fe80::20c:29ff:fe74:1316</span><br><span class="line">         Gateway: 192.168.0.1 (NETGEAR)</span><br><span class="line">             DNS: 119.29.29.29</span><br><span class="line">                  223.6.6.6</span><br><span class="line">        CLIENTID: ffb6220feb00020000ab113bc2c88225c0d29b</span><br><span class="line">    Connected To: n/a on port 00:e0:4c:68:54:12</span><br><span class="line">                  n/a on port 00:e0:4c:68:54:13</span><br><span class="line">                  n/a on port 00:e0:4c:68:54:15</span><br></pre></td></tr></table></figure><ul><li>ç³»ç»Ÿå®‰è£…æ—¶é»˜è®¤ä½¿ç”¨çš„ DHCP è·å– IP ï¼Œå¯ä»¥ä½¿ç”¨ systemd æ¥è®¾ç½®é™æ€ IP</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> é¦–å…ˆä¿®æ”¹ DHCP çš„ systemd æ–‡ä»¶ï¼Œå…³é—­ DHCP</span></span><br><span class="line">sed -i 's/yes/no/' /etc/systemd/network/99-dhcp-en.network</span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºé™æ€ IP çš„ systemd æ–‡ä»¶</span></span><br><span class="line">cat &gt; /etc/systemd/network/10-static-en.network &lt;&lt; "EOF"</span><br><span class="line"></span><br><span class="line">[Match]</span><br><span class="line">Name=eth0</span><br><span class="line"></span><br><span class="line">[Network]</span><br><span class="line">Address=198.168.0.235/24</span><br><span class="line">Gateway=198.168.0.1</span><br><span class="line">DNS=192.168.0.100</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶æƒé™ä¸º 644 ï¼Œä¸ç„¶å¯åŠ¨çš„æ—¶å€™ä¼šæŠ¥é”™æç¤ºæƒé™é—®é¢˜</span></span><br><span class="line">chmod 644 /etc/systemd/network/10-static-en.network</span><br><span class="line"><span class="meta">#</span><span class="bash"> é‡å¯ä¸€ä¸‹ç½‘ç»œ</span></span><br><span class="line">systemctl restart systemd-networkd</span><br></pre></td></tr></table></figure><ul><li>æŒ‚è½½ NFS æ–‡ä»¶ç³»ç»Ÿéœ€è¦å®‰è£… <code>nfs-utils</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tdnf install nfs-utils -y</span><br><span class="line">mount 192.168.0.100:/nfs /mnt/nfs</span><br></pre></td></tr></table></figure><h3 id="åŒ…ç®¡ç†"><a href="#åŒ…ç®¡ç†" class="headerlink" title="åŒ…ç®¡ç†"></a>åŒ…ç®¡ç†</h3><p>Photon OS ä½¿ç”¨çš„æ˜¯ yum/tdnf ä½œä¸ºåŒ…ç®¡ç†å™¨ï¼Œä½¿ç”¨æ–¹æ³•å’Œ RedHat ç³»çš„å‘è¡Œç‰ˆåŸºæœ¬ç›¸åŒï¼Œrepo ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ls /etc/yum.repos.d/</span><br><span class="line">lightwave.repo</span><br><span class="line">photon-extras.repo</span><br><span class="line">photon-iso.repo</span><br><span class="line">photon-updates.repo</span><br><span class="line">photon.repo</span><br></pre></td></tr></table></figure><h3 id="æºç ç¼–è¯‘"><a href="#æºç ç¼–è¯‘" class="headerlink" title="æºç ç¼–è¯‘"></a>æºç ç¼–è¯‘</h3><h2 id="è¿è¡Œå®¹å™¨"><a href="#è¿è¡Œå®¹å™¨" class="headerlink" title="è¿è¡Œå®¹å™¨"></a>è¿è¡Œå®¹å™¨</h2><h3 id="Pi-hole"><a href="#Pi-hole" class="headerlink" title="Pi-hole"></a>Pi-hole</h3><blockquote><p>  Pi-hole æ˜¯ä¸€æ¬¾å¼€æºä¸”å…è´¹çš„ DNS æ²‰æ´æœåŠ¡å™¨ï¼ˆDNS sinkholeï¼‰ï¼Œèƒ½å¤Ÿåœ¨ä¸å®‰è£…ä»»ä½•å®¢æˆ·ç«¯ä¾§è½¯ä»¶çš„å‰æä¸‹ä¸ºè®¾å¤‡æä¾›ç½‘ç»œå†…å®¹å±è”½æœåŠ¡ï¼Œéå¸¸è½»é‡æ˜“ç”¨ã€‚æ­é…ä¸Šå®¶ä¸­åƒç°å·²ä¹…çš„æ ‘è“æ´¾ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿè½»æ¾æ‰“é€ å±äºè‡ªå·±çš„å¹¿å‘Šå±è”½åŠ©æ‰‹ã€‚<br>  åœ¨<a href="https://pi-hole.net/" target="_blank" rel="noopener">å®˜ç½‘</a>çš„ä»‹ç»ä¸­ï¼ŒPi-hole ä¸»è¦å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li>æ˜“äºå®‰è£…å’Œé…ç½®ï¼ˆå·ç§° 10 åˆ†é’Ÿå®‰è£…é…ç½®ä¸€æ¡é¾™ï¼‰ã€‚</li><li>å…¨å¹³å°ï¼Œå¹¿å‘Šå±è”½æœåŠ¡å¯ä½œç”¨äºä»»ä½•è®¾å¤‡ï¼ŒåŒ…æ‹¬PCã€æ‰‹æœºã€å¹³æ¿ç”µè„‘ã€‚</li><li>è½»é‡ï¼Œå¯¹ç¡¬ä»¶è¦æ±‚æä½ã€‚</li><li>åŠŸèƒ½ç¨³å®šä¸”å¼ºå¤§ï¼Œèƒ½è½»æ¾ hold ä½ç™¾ä¸‡çº§åˆ«çš„è¯·æ±‚ã€‚</li><li>æä¾›äº†ç¾è§‚çš„ Web æ•°æ®ç›‘æ§ä»ªè¡¨ç›˜ã€‚</li><li>å¼€æºä¸”å…è´¹ã€‚</li></ul></blockquote><ul><li>é¦–å…ˆéœ€è¦å…³é—­ systemd è‡ªå¸¦çš„ DNS æœåŠ¡ï¼Œä¸ç„¶ Pi-hole åšæŒºçš„ 53 ç«¯å£ä¼šè¢«å ç”¨</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop systemd-resolved</span><br><span class="line">systemctl disable systemd-resolved</span><br></pre></td></tr></table></figure><ul><li>å®‰è£… docker-composeï¼Œä¿®æ”¹ docker-compose.yaml æ–‡ä»¶</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3"</span></span><br><span class="line"><span class="comment"># More info at https://github.com/pi-hole/docker-pi-hole/ and https://docs.pi-hole.net/</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">pihole:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">pihole</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">pihole/pihole:latest</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"53:53/tcp"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"53:53/udp"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"67:67/udp"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"80:80/tcp"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"443:443/tcp"</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">'Asia/Shanghai'</span></span><br><span class="line">      <span class="attr">WEBPASSWORD:</span> <span class="string">'changeme'</span></span><br><span class="line">    <span class="comment"># Volumes store your data between container upgrades</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'./etc-pihole/:/etc/pihole/'</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'./etc-dnsmasq.d/:/etc/dnsmasq.d/'</span></span><br><span class="line">    <span class="comment"># Recommended but not required (DHCP needs NET_ADMIN)</span></span><br><span class="line">    <span class="comment">#   https://github.com/pi-hole/docker-pi-hole#note-on-capabilities</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br></pre></td></tr></table></figure><ul><li>docker-compose up èµ°èµ·ï¼</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">root@PhotonOS [ /opt/docker/pihole ]# docker-compose up</span><br><span class="line">Creating network "pihole_default" with the default driver</span><br><span class="line">Creating pihole ... done</span><br><span class="line">Attaching to pihole</span><br><span class="line">pihole    | [s6-init] making user provided files available at /var/run/s6/etc...exited 0.</span><br><span class="line">pihole    | [s6-init] ensuring user provided files have correct perms...exited 0.</span><br><span class="line">pihole    | [fix-attrs.d] applying ownership &amp; permissions fixes...</span><br><span class="line">pihole    | [fix-attrs.d] 01-resolver-resolv: applying...</span><br><span class="line">pihole    | [fix-attrs.d] 01-resolver-resolv: exited 0.</span><br><span class="line">pihole    | [fix-attrs.d] done.</span><br><span class="line">pihole    | [cont-init.d] executing container initialization scripts...</span><br><span class="line">pihole    | [cont-init.d] 20-start.sh: executing...</span><br><span class="line">pihole    |  ::: Starting docker specific checks &amp; setup for docker pihole/pihole</span><br><span class="line">  [âœ“] Update local cache of available packages</span><br><span class="line">pihole    |   [i] Existing PHP installation detected : PHP version 7.0.33-0+deb9u8</span><br><span class="line">pihole    |</span><br><span class="line">pihole    |   [i] Installing configs from /etc/.pihole...</span><br><span class="line">pihole    |   [i] Existing dnsmasq.conf found... it is not a Pi-hole file, leaving alone!</span><br><span class="line">  [âœ“] Copying 01-pihole.conf to /etc/dnsmasq.d/01-pihole.conf</span><br><span class="line">pihole    | chown: cannot access '': No such file or directory</span><br><span class="line">pihole    | chmod: cannot access '': No such file or directory</span><br><span class="line">pihole    | chown: cannot access '/etc/pihole/dhcp.leases': No such file or directory</span><br><span class="line">pihole    | ::: Pre existing WEBPASSWORD found</span><br><span class="line">pihole    | Using default DNS servers: 8.8.8.8 &amp; 8.8.4.4</span><br><span class="line">pihole    | DNSMasq binding to default interface: eth0</span><br><span class="line">pihole    | Added ENV to php:</span><br><span class="line">pihole    |                     "PHP_ERROR_LOG" =&gt; "/var/log/lighttpd/error.log",</span><br><span class="line">pihole    |                     "ServerIP" =&gt; "0.0.0.0",</span><br><span class="line">pihole    |                     "VIRTUAL_HOST" =&gt; "0.0.0.0",</span><br><span class="line">pihole    | Using IPv4 and IPv6</span><br><span class="line">pihole    | ::: Preexisting ad list /etc/pihole/adlists.list detected ((exiting setup_blocklists early))</span><br><span class="line">pihole    | https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts</span><br><span class="line">pihole    | https://mirror1.malwaredomains.com/files/justdomains</span><br><span class="line">pihole    | ::: Testing pihole-FTL DNS: FTL started!</span><br><span class="line">pihole    | ::: Testing lighttpd config: Syntax OK</span><br><span class="line">pihole    | ::: All config checks passed, cleared for startup ...</span><br><span class="line">pihole    |  ::: Docker start setup complete</span><br><span class="line">pihole    |   [i] Neutrino emissions detected...</span><br><span class="line">  [âœ“] Pulling blocklist source list into range</span><br><span class="line">pihole    |</span><br><span class="line">  [âœ“] Preparing new gravity database</span><br><span class="line">pihole    |   [i] Target: https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts</span><br><span class="line">pihole    |   [i] Received 55654 domains</span><br><span class="line">pihole    |   [i] Target: https://mirror1.malwaredomains.com/files/justdomains</span><br><span class="line">  [âœ“] Status: No changes detected</span><br><span class="line">pihole    |   [i] Received 26854 domains</span><br><span class="line">  [âœ“] Storing downloaded domains in new gravity database</span><br><span class="line">  [âœ“] Building tree</span><br><span class="line">  [âœ“] Swapping databases</span><br><span class="line">pihole    |   [i] Number of gravity domains: 82508 (82465 unique domains)</span><br><span class="line">pihole    |   [i] Number of exact blacklisted domains: 0</span><br><span class="line">pihole    |   [i] Number of regex blacklist filters: 0</span><br><span class="line">pihole    |   [i] Number of exact whitelisted domains: 0</span><br><span class="line">pihole    |   [i] Number of regex whitelist filters: 0</span><br><span class="line">  [âœ“] Cleaning up stray matter</span><br><span class="line">pihole    |</span><br><span class="line">pihole    |   [âœ“] DNS service is running</span><br><span class="line">pihole    |   [âœ“] Pi-hole blocking is Enabled</span><br><span class="line">pihole    |   Pi-hole version is v5.1.2 (Latest: v5.1.2)</span><br><span class="line">pihole    |   AdminLTE version is v5.1.1 (Latest: v5.1.1)</span><br><span class="line">pihole    |   FTL version is v5.2 (Latest: v5.2)</span><br><span class="line">pihole    | [cont-init.d] 20-start.sh: exited 0.</span><br><span class="line">pihole    | [cont-init.d] done.</span><br><span class="line">pihole    | [services.d] starting services</span><br><span class="line">pihole    | Starting pihole-FTL (no-daemon) as root</span><br><span class="line">pihole    | Starting lighttpd</span><br><span class="line">pihole    | Starting crond</span><br><span class="line">pihole    | [services.d] done.</span><br></pre></td></tr></table></figure><ul><li>æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ <code>http://ip:port/admin</code> å³å¯è¿›å…¥ Pi-hole çš„åå°ç®¡ç†é¡µé¢ï¼Œåœ¨è¿™é‡Œå¯ä»¥æŸ¥çœ‹åˆ° DNS è§£æçš„è¯¦ç»†è®°å½•ï¼Œå…³äº Pi-hole çš„ä½¿ç”¨å¯ä»¥å‚è€ƒä¸€äº›å¤§ä½¬çš„åšå®¢ï¼Œæ¯”å¦‚ <a href="https://wzyboy.im/post/1372.html" target="_blank" rel="noopener">æ­å»º Pi-Hole ä¸ºç½‘ä¸Šå†²æµªä¿é©¾æŠ¤èˆª</a>ã€‚</li></ul><p><img src="img/20200925-pihole.png" alt=""></p><p>å¦‚æœæƒ³è¦è®©å†…ç½‘çš„æœºå™¨éƒ½èµ° Pi-hole æ¥è¿›è¡Œ DNS ï¼Œå¯ä»¥å°†è·¯ç”±å™¨çš„ DHCP çš„  DNS çš„ IP è®¾ç½®ä¸º Pi-hole çš„ IPã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://cloud.google.com/blog/products/containers-kubernetes/bringing-ebpf-and-cilium-to-google-kubernetes-engine" target="_blank" rel="noopener">New GKE Dataplane V2 increases security and visibility for containers</a></li><li><a href="https://moelove.info/2020/09/02/%E8%A2%AB-Google-%E9%80%89%E6%8B%A9%E7%9A%84%E4%B8%8B%E4%B8%80%E4%BB%A3%E6%95%B0%E6%8D%AE%E9%9D%A2-Cilium-%E6%98%AF%E4%BB%80%E4%B9%88/" target="_blank" rel="noopener">è¢« Google é€‰æ‹©çš„ä¸‹ä¸€ä»£æ•°æ®é¢ Cilium æ˜¯ä»€ä¹ˆ</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;å‰æ®µæ—¶é—´æ¡åƒåœ¾ä¸œæ‹¼è¥¿å‡‘æäº†å° Homelab ğŸ‘‡ç©ç©
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="å®¹å™¨" scheme="https://blog.k8s.li/tags/%E5%AE%B9%E5%99%A8/"/>
    
      <category term="PhotonOS" scheme="https://blog.k8s.li/tags/PhotonOS/"/>
    
      <category term="Linux" scheme="https://blog.k8s.li/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ç»™é˜µåˆ—å¡åˆ·ä¸ªæœºï¼ŒIR æ¨¡å¼è½¬ IT æ¨¡å¼</title>
    <link href="https://blog.k8s.li/lsi-9211-4i-ir-to-it.html"/>
    <id>https://blog.k8s.li/lsi-9211-4i-ir-to-it.html</id>
    <published>2020-09-07T16:00:00.000Z</published>
    <updated>2020-09-07T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åˆ·æœºï¼Ÿ"><a href="#åˆ·æœºï¼Ÿ" class="headerlink" title="åˆ·æœºï¼Ÿ"></a>åˆ·æœºï¼Ÿ</h2><p>ä¸ä¹…å‰æ¡åƒåœ¾æäº†ä¸€å°ä½åŠŸè€— Homelab ä¸»æœºç©ç©ï¼Œç”±äºä¸»æ¿ SATA å£çš„é™åˆ¶ï¼Œä¸èƒ½ä½¿ç”¨å¤§äº 2TB çš„ç¡¬ç›˜ï¼Œå¯¹äºå’±æ¢¦æƒ³ç€è¿™ç§æ‹¥æœ‰å‡ å TB å­˜å‚¨æ¥å­˜æ”¾è€å©†çš„æ­»è‚¥å®…æ¥è¯´ï¼Œ2TB æ€ä¹ˆå¤Ÿäº†ã€‚äºæ˜¯æƒ³è¦çªç ´é™åˆ¶ï¼Œå†ç»™ Homelab ä¸»æœºå¢åŠ ä¸€å— 6TB çš„ç£ç›˜ã€‚äºæ˜¯ï¼Œåœ¨æ´‹åƒåœ¾å †é‡ŒèŠ±äº† 50 å—é’±æ¡äº†è¿™å—é˜µåˆ—å¡ğŸ‘‡ã€‚</p><p><img src="img/20200830_9211-4i-01.jpg" alt=""></p><p>ä¹°çš„è¿™å—é˜µåˆ—å¡å‹å·æ˜¯ <a href="https://lenovopress.com/tips0831-serveraid-h1110" target="_blank" rel="noopener">ServeRAID H1110 SAS/SATA Controller for IBM System x </a> ï¼Œå–å®¶è¯´æ˜¯ <code>IBM H1110</code> ï¼Œå…¶å®éƒ½å·®ä¸å¤šå•¦ã€‚ç”±äºæ˜¯ç¬¬ä¸€æ¬¡ç©å„¿é˜µåˆ—å¡ï¼Œå¯¹è¿™ç§å‹å·ä¹Ÿä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œä¹‹ååˆ·äº†æ–°çš„å›ºä»¶åˆå˜æˆäº† <code>LSI 9211-4i</code> ã€‚</p><h2 id="ç¿»è½¦ï¼Ÿ"><a href="#ç¿»è½¦ï¼Ÿ" class="headerlink" title="ç¿»è½¦ï¼Ÿ"></a>ç¿»è½¦ï¼Ÿ</h2><p>æ”¶åˆ°è´§åï¼Œè¿«ä¸åŠå¾…åœ°å°†å­˜æ»¡è€å©†çš„ç¡¬ç›˜æ¥åˆ°é˜µåˆ—å¡ä¸Šï¼Œå¼€æœºçš„æ—¶å€™ï¼Œä¸€ç›´å¡åœ¨é˜µåˆ—å¡ BIOS åˆå§‹åŒ–é¡µé¢å¾ˆä¹…å¾ˆä¹…ã€‚é¡¿æ—¶è§‰ç€ï¼Œå®Œè›‹ç¿»è½¦äº†ï¼Œæ­£å‡†å¤‡å»æ€¼ä¸€æ³¢å–å®¶ï¼Œé˜µåˆ—å¡å¯åŠ¨ç­‰äº†äº”å…­åˆ†é’Ÿåè¿›å…¥äº†ä¹…è¿çš„  ESXi çš„å¯åŠ¨é¡µé¢ã€‚è¿™å°¼ç›ï¼Œå‘æˆ‘å•Šï¼Œä½ ä¸€ä¸ªå·´æŒå¤§çš„é˜µåˆ—å¡å¯åŠ¨ç«Ÿç„¶éœ€è¦äº”åˆ†é’Ÿï¼Ÿå†…å¿ƒä¸€ä¸‡åŒ¹è‰æ³¥é©¬å¥”è…¾è€Œè¿‡ã€‚</p><p><img src="img/20200830_9211-4i-02.png" alt=""></p><h2 id="IR-æ¨¡å¼ï¼Ÿ"><a href="#IR-æ¨¡å¼ï¼Ÿ" class="headerlink" title="IR æ¨¡å¼ï¼Ÿ"></a>IR æ¨¡å¼ï¼Ÿ</h2><p>åœ¨ç½‘ä¸Šçœ‹æ¥ä¸€ä¸‹å¤§ä½¬ä»¬çš„è¯„è®ºï¼Œè¯´é˜µåˆ—å¡ IR æ¨¡å¼çš„å¯åŠ¨é€Ÿåº¦è¦æ…¢ä¸€äº›ï¼Ÿç„¶ååˆæ‰¾åˆ°äº† <a href="https://wiki2.xbits.net:4430/hardware:lsi:h1110-it-firmware" target="_blank" rel="noopener">IBM H1110å¡åˆ·ä¸ºLSI 9211-4i ITå›ºä»¶</a> ï¼Œé‡Œé¢æåˆ°çš„å¯ä»¥å°† IR æ¨¡å¼åˆ·ä¸º IT ç›´é€šæ¨¡å¼ã€‚è‡³äº IR æ¨¡å¼å’Œ IT æ¨¡å¼ï¼Œè‡ªå·±å¤ªèœæ²¡æ‰¾åˆ°ç¡®åˆ‡çš„èµ„æ–™ã€‚å¤§æ¦‚å¯ä»¥ç†è§£ä¸º IR æ¨¡å¼é€‚ç”¨äºä½¿ç”¨é˜µåˆ—å¡ç»„ RAID é˜µåˆ—ï¼Œè€Œ IT æ¨¡å¼å°±æ˜¯æ‰€è°“çš„ç›´é€šæ¨¡å¼ï¼Œä¸é€‚ç”¨ RAID ï¼Œåªä½¿ç”¨é˜µåˆ—å¡çš„ç£ç›˜æ§åˆ¶å™¨ï¼Ÿç›¸å½“äºä¸»æ¿ä¸Šçš„ SATA æ¥å£ã€‚ä½•å†µæˆ‘è¿™ä¸ªæ˜¯å°ä¸»æœºï¼Œé‡Œé¢ä¹Ÿå¡ä¸ä¸‹é‚£ä¹ˆå¤šçš„ç£ç›˜ï¼Œæ‰€ä»¥é˜µåˆ—å¡ä½¿ç”¨ IT ç›´é€šæ¨¡å¼æ— ç–‘æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚</p><p><img src="img/20200828_9211-4i-03.jpg" alt=""></p><h2 id="ä¸‡ç‰©çš†å¯åˆ·ï¼Ÿ"><a href="#ä¸‡ç‰©çš†å¯åˆ·ï¼Ÿ" class="headerlink" title="ä¸‡ç‰©çš†å¯åˆ·ï¼Ÿ"></a>ä¸‡ç‰©çš†å¯åˆ·ï¼Ÿ</h2><p>å‚ç…§å¤§ä½¬ä»¬çš„åšå®¢ï¼Œå’±ä¹Ÿè¦ä½“éªŒä¸€æŠŠåˆ·<del>æœº</del>å¡çš„ç—›å¿«äº†ï¼Œæ¯•ç«ŸæŠ˜è…¾è¿™äº›æ²¡ç”¨çš„ç©æ„å„¿ä¹Ÿæ˜¯å’±çš„ä¸€å¤§ä¹è¶£ã€‚</p><blockquote><p>  æˆ‘é’å¹´æ—¶ä»£å°±åˆ·è¿‡ï¼šè¯ºåŸºäºšã€æ‘©æ‰˜ç½—æ‹‰ã€ä¸‰æ˜Ÿã€é»‘è“ã€Lumiaã€HTCï¼Œæˆ‘è¿˜åˆ·è¿‡ï¼šè·¯ç”±å™¨ã€äº¤æ¢æœºã€é˜µåˆ—å¡ã€ç”µè§†ç›’å­â€¦â€¦</p></blockquote><p>å®‰å“<del>åŸº</del>æœºä½¬ä»¬æƒ³å¿…å¯¹ twrp å†ç†Ÿæ‚‰ä¸è¿‡äº†ï¼Œå®ƒæ˜¯æˆ‘ä»¬åˆ·æœºï¼Œåˆ·å„ç§ ROM åŒ…æœ€å¸¸ç”¨çš„ç³»ç»Ÿï¼Œç›¸å½“äº Windows ä¸­çš„ PE ç³»ç»Ÿï¼Œå¯¹ç³»ç»Ÿåˆ†åŒºåˆ·ä¸Š ROM æ¥è¾¾åˆ°åˆ·æœºçš„ç›®çš„ã€‚åˆ·é˜µåˆ—å¡çš„å›ºä»¶å’Œåˆ·æœºä¹Ÿå·®ä¸å¤šï¼Œä¹Ÿæ˜¯éœ€è¦ä¸€ä¸ªåº•å±‚çš„ç³»ç»Ÿè¿›å»å¯¹é˜µåˆ—å¡ä¸Šçš„å­˜å‚¨èŠ¯ç‰‡è¿›è¡Œæ“ä½œã€‚æœ€å¸¸è§çš„å°±æ˜¯ Dos å’Œ EFI Shell ï¼Œç”±äº Dos å¹´ä»£ä¹…è¿œï¼Œä¸”æˆ‘çš„ä¸»æ¿å¯¹ EFI æ”¯æŒæ¯”è¾ƒå‹å¥½ï¼Œåœ¨è¿›è¡Œåˆ·æœºçš„æ—¶å€™ä¸ºäº†ç¨³å¦¥èµ·è§é€‰æ‹© EFI shellã€‚</p><h3 id="è®°å½•-SAS-åœ°å€"><a href="#è®°å½•-SAS-åœ°å€" class="headerlink" title="è®°å½• SAS åœ°å€"></a>è®°å½• SAS åœ°å€</h3><p>åœ¨åˆ·é˜µåˆ—å¡ä¹‹å‰è¦çº¿è®°å½•ä¸‹ SAS çš„ Address ï¼Œè¿›å…¥åˆ°é˜µåˆ—å¡çš„ BIOS ä¸­ä¼šæœ‰è¿™ä¸ªä¿¡æ¯ã€‚</p><h3 id="æ‰¾å¥½å›ºä»¶å’Œæ–‡æ¡£"><a href="#æ‰¾å¥½å›ºä»¶å’Œæ–‡æ¡£" class="headerlink" title="æ‰¾å¥½å›ºä»¶å’Œæ–‡æ¡£"></a>æ‰¾å¥½å›ºä»¶å’Œæ–‡æ¡£</h3><p>ç”±äºæˆ‘è¦åˆ·å…¥çš„å›ºä»¶ä¸æ˜¯é˜µåˆ—å¡åŸå‚çš„å›ºä»¶ï¼Œåªæ‰¾åˆ°äº†ç°æˆçš„å›ºä»¶ï¼Œç›´æ¥å°±æ‹¿æ¥ç”¨äº†ï¼Œåº”è¯¥é—®é¢˜ä¸å¤§ã€‚è€Œä¸”åˆ·å…¥çš„æµç¨‹ä¹Ÿæ˜¯æ¯”è¾ƒç®€ç­”ã€‚<a href="https://wiki2.xbits.net:4430/hardware:lsi:h1110-it-firmware" target="_blank" rel="noopener">IBM H1110å¡åˆ·ä¸ºLSI 9211-4i ITå›ºä»¶</a> :</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¤‡ä»½åŸå¡ä¿¡æ¯å’Œsbr</span></span><br><span class="line">MegaCli.exe -AdpAllInfo -aAll -ApplogFile bak.txt</span><br><span class="line">MegaRec.exe -readsbr 0 orig.sbr</span><br><span class="line"><span class="meta">#</span><span class="bash">æ“¦å†™sbrå’Œflashä¸€éèƒ½åˆ·å…¥LSIåŸå‚å›ºä»¶</span></span><br><span class="line">MegaRec -writesbr 0 sbrempty.bin</span><br><span class="line">MegaRec -cleanflash 0</span><br><span class="line"><span class="meta">#</span><span class="bash">é‡å¯å†æ¬¡è¿›å…¥DOS</span></span><br><span class="line">reboot</span><br><span class="line"><span class="meta">#</span><span class="bash">åˆ·å…¥å¯¹åº”ITå›ºä»¶å’ŒROM</span></span><br><span class="line">sas2flsh -o -f 2114it.bin -b mptsas2.rom</span><br><span class="line"><span class="meta">#</span><span class="bash">æ¢å¤åŸæ¥çš„SASåœ°å€</span></span><br><span class="line">sas2flsh -o -sasadd xxxxxxxx</span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹æœ€æ–°çŠ¶æ€</span></span><br><span class="line">sas2flsh -list</span><br><span class="line"><span class="meta">#</span><span class="bash">é‡å¯ï¼Œå®Œæˆ</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><p>ä¸€äº›å®˜æ–¹çš„æ–‡æ¡£<a href="https://www.broadcom.cn/support/knowledgebase/1211161495925/flash-upgrading-firmware-on-lsi-sas-hbas-upgraded-firmware-on-92" target="_blank" rel="noopener">Flash upgrading firmware on LSI SAS HBAs; Upgraded firmware on 9211-8i to P8, now duplicated drives</a>ï¼š</p><blockquote><p>  Advanced users:</p><p>  To delete the firmware and BIOS in your 9211, then reflash it, follow these steps:</p><ol><li><p>Check to see if there is an also an onboard SATA controller with disk in the system before running the commands below.<br>Run sas2flsh -listall<br>If you see only the 9211, then run the commands as shown below.<br>If you see two controllers (e.g. c0 and c1, then add -c 1 to all of the commands belowâ€“&gt; sas2flsh -c 1 -o -e 6</p></li><li><p>Record the SAS address of the 9211 in case you need it later.  To display it, type:<br>sas2flsh -list</p><p>and write down the SAS address.  You can run the is DOS, Windows, Linux, etc.</p></li><li><p>Download 9211_8i_Package_for_P9_Firmware_BIOS_on_MSDOS_and_Windows.zip for the 9211-8i</p></li><li><p>Boot to DOS (create a DOS bootable USB stick from <a href="http://www.bootdisk.com" target="_blank" rel="noopener">http://www.bootdisk.com</a> or <a href="http://www.gocoding.com" target="_blank" rel="noopener">www.gocoding.com</a>).</p></li><li><p>Run from DOS sas2flsh -o -e 6 (this will erase the controller firmware and BIOS).</p></li><li><p>Turn the system off.</p></li><li><p>Turn the system on and boot to DOS (note:  the BIOS wonâ€™t post, as you will reflash it in step 8 below).</p></li><li><p>Run from DOS, with files sas2flsh.exe, the .bin and .rom files in the same directory:</p><p>For IR firmware:  sas2flsh -f 9211IRP9.bin -b mptsas2.rom<br>For IT firmware:  sas2flsh -f 9211itp9.bin -b mptsas2.rom</p><p>Note:  you will need to rename 9211-8i_IR_P9.bin to 9211IRP9.bin and 9211-8i-IT_ph9.bin to 9211itp9.bin</p></li><li><p>The controller will now work normally, with the P9 firmware and BIOS.</p></li><li><p>Check to make sure you have a SAS address:<br>sas2flsh -list<br>If you see the same SAS address that you had in step 2, then you are done.<br>If you donâ€™t see the same SAS address, or you donâ€™t see a SAS address, type:<br>sas2flsh -o -sasadd <SAS address></p></li></ol></blockquote><p>ä¸Šé¢æåˆ°çš„éƒ½æ˜¯åŸºäº Dos ç³»ç»Ÿä¸Šæ“ä½œçš„ï¼Œä¸è¿‡æˆ‘è¯•äº†ä¸€ä¸‹éƒ½ç¿»è½¦äº†ğŸ¤£</p><h3 id="åˆ¶ä½œ-EFI-shell-ç³»ç»Ÿ"><a href="#åˆ¶ä½œ-EFI-shell-ç³»ç»Ÿ" class="headerlink" title="åˆ¶ä½œ EFI shell ç³»ç»Ÿ"></a>åˆ¶ä½œ EFI shell ç³»ç»Ÿ</h3><p>å¦‚æœä¸»æ¿æ”¯æŒ EFI çš„è¯ï¼Œå»ºè®®ä½¿ç”¨ EFI shell åˆ·å…¥å›ºä»¶ï¼Œåœ¨ Dos ä¸‹ä¼šæœ‰äº›å¥‡æ€ªçš„é—®é¢˜ã€‚</p><p>æŒ‰ç…§ <a href="https://superuser.com/questions/1057446/how-do-i-boot-to-uefi-shell" target="_blank" rel="noopener">How do I â€œBoot to UEFI shellâ€?</a> ä¸­æåˆ°çš„ï¼š</p><blockquote><p>It depends on whether your UEFI has a shell builtin. If it does, there should be an option in its settings / boot menu for you to launch it. Some motherboard also provide an option to launch a shell from the EFI System Partition (ESP). You should consult the manual of your motherboard for the path it will look for (the instruction is often vague though). Usually they are looking for a file named <code>Shell.efi</code> in the ESP root folder.</p><p>Another way is to launch it just like you launch any other EFI binary (e.g. bootloader). Since itâ€™s not really accessible to register a EFI binary to your UEFI or put the shell binary to your ESP in Windows, so the easiest way is probably to put it as <code>\EFI\Boot\bootx64.efi</code> <strong>(also put the <code>update.nsh</code> you need to run and the files it requires under <code>\EFI\Boot\</code>)</strong> in a FAT(32)-formatted USB drive (It shouldnâ€™t matter whether itâ€™s MBR or GPT as long as your UEFI is standard-conforming enough). <strong>Then reboot and boot the USB in UEFI mode from your UEFI boot menu.</strong></p><p>You can obtain the EFI shell binary from the EDK2 project repo:</p><ul><li><p><a href="https://github.com/tianocore/edk2/releases/download/edk2-stable202002/ShellBinPkg.zip" target="_blank" rel="noopener">version 2</a></p></li><li><p><a href="https://github.com/tianocore/edk2/blob/UDK2018/EdkShellBinPkg/FullShell/X64/Shell_Full.efi?raw=true" target="_blank" rel="noopener">version 1 (no longer updated, only for old UEFI that does not work with v2)</a></p><p>(<strong>Note:</strong> some older EFI tools like [sas2flash.efi](<a href="https://www.broadcom.com/site-search?q=Installer" target="_blank" rel="noopener">https://www.broadcom.com/site-search?q=Installer</a> for UEFI) only work with such an old EFI shell (which works on current mainboards with current UEFI))</p></li></ul></blockquote><p>é¦–å…ˆéœ€è¦ä¸€ä¸ª U ç›˜ï¼Œå¯¹å®¹é‡æ²¡æœ‰é—²ç½®ï¼Œå‡ åå…†è¶³å¤Ÿï¼ŒæŠŠåˆ†åŒºæ ¼å¼åŒ–ä¸º FAT32 æ–‡ä»¶ç³»ç»Ÿæ ¼å¼ï¼Œç„¶åä¸‹è½½ä¸€ä¸ª EFI shell çš„ efi æ–‡ä»¶ <a href="https://github.com/tianocore/edk2/blob/UDK2018/EdkShellBinPkg/FullShell/X64/Shell_Full.efi?raw=true" target="_blank" rel="noopener">version 1 </a>ï¼ŒæŠŠè¯¥æ–‡ä»¶ä¿å­˜åœ¨ FAT32 åˆ†åŒºä¸‹çš„ <code>\EFI\Boot\bootx64.efi</code> è·¯å¾„ä¸‹ã€‚</p><blockquote><p>  Download from Github Tianocore the precompiled UEFI version 1 Shell: <a href="https://github.com/tianocore/edk2/tree/master/EdkShellBinPkg/FullShell/X64" target="_blank" rel="noopener">Shell_Full.efi</a>. (Only v1 is applicable, later versions are not compatible with the flash tool and end up with the message: â€œInitShellApp: Application not started from Shellâ€.)</p></blockquote><p>ç”±äºåˆ·å›ºä»¶çš„å·¥å…· <code>sas2flash.efi</code> åªå’Œ EFI shell v1 ç‰ˆæœ¬çš„å…¼å®¹ï¼Œæˆ‘ç¬¬ä¸€æ¬¡åˆ·çš„æ—¶å€™æ—¶ä½¿ç”¨çš„ v2 ç‰ˆæœ¬ï¼Œæç¤º <code>â€œInitShellApp: Application not started from Shellâ€</code> é”™è¯¯ğŸ˜‚</p><p>ç„¶åè¿˜éœ€è¦æŠŠå›ºä»¶ <code>2114it.bin</code> ï¼Œä»¥åŠåˆ·å›ºä»¶ç”¨åˆ°çš„å·¥å…· <code>sas2flash.efi</code> æ”¾å…¥åˆ° FAT32 è·Ÿç›®å½•ä¸‹ï¼Œå…¶ä¸­å›ºä»¶æ ¹æ®é˜µåˆ—å¡çš„å‹å·ä¸åŒéœ€è¦è‡ªè¡Œæ‰¾åˆ°ç›¸åº”çš„å›ºä»¶ç‰ˆæœ¬ï¼Œæˆ‘è¿™ä¸ªè™½ç„¶æ˜¯ IBM H1110 å‹å·çš„ï¼Œä½†æ˜¯å¯ä»¥åˆ·æˆ LSI 9211 çš„ï¼Œæ‰€ä»¥å°±æ²¡å»æ‰¾åŸå‚çš„å›ºä»¶ã€‚</p><h3 id="è¿›å…¥-EFI-shell-åˆ·å…¥æ–°çš„å›ºä»¶"><a href="#è¿›å…¥-EFI-shell-åˆ·å…¥æ–°çš„å›ºä»¶" class="headerlink" title="è¿›å…¥ EFI shell åˆ·å…¥æ–°çš„å›ºä»¶"></a>è¿›å…¥ EFI shell åˆ·å…¥æ–°çš„å›ºä»¶</h3><p>ä» <a href="https://www.ixsystems.com/community/threads/how-to-flash-lsi-9211-8i-using-efi-shell.50902/" target="_blank" rel="noopener">How-to: Flash LSI 9211-8i using EFI shell</a> å¤§ä½¬é‚£é‡Œå¤åˆ¶ç²˜è´´è¿‡æ¥çš„çš„æ•™ç¨‹ï¼š</p><blockquote><ol><li>Insert the controller card in a PCIe slot. (Iâ€™ve used the slot Nr. 3. In case of troubles recognizing the card in your desktop PC try different slots.)</li><li>Boot the PC and prepare the USB stick:</li><li>In the USB stick create and format a FAT or FAT32 partition &gt;= 10 MB. (Iâ€™ve created 500 MB FAT32 partition. I wouldnâ€™t recommend large partitions, who knows if the EFI shell will read every big partition.)</li><li>Create the sub-folders for EFI boot. In the web there are two different structures: <code>/boot/efi</code> and <code>/efi/boot</code>. For time saving Iâ€™ve created both groups, it works.</li><li>Download from Broadcom following packages: <a href="https://docs.broadcom.com/docs/12350820" target="_blank" rel="noopener">Installer_P20_for_UEFI</a> and <a href="https://docs.broadcom.com/docs/12350530" target="_blank" rel="noopener">9211-8i_Package_P20_IR_IT_Firmware_BIOS_for_MSDOS_Windows</a> and extract them on your PCâ€™s HDD.</li><li>Copy from the downloaded packages three files to the USB stick root folder:</li><li>from the first package the file <code>sas2flash.efi</code> (it is in sub-folder <code>/sas2flash_efi_ebc_rel/</code>);</li><li>from the second package: <code>2118it.bin</code> (it is in sub-folder <code>/Firmware/HBA_9211_8i_IT/</code>) and <code>mptsas2.rom</code> (it is in sub-folder <code>/sasbios_rel/</code>).</li><li>Download from Github Tianocore the precompiled UEFI version 1 Shell: <a href="https://github.com/tianocore/edk2/tree/master/EdkShellBinPkg/FullShell/X64" target="_blank" rel="noopener">Shell_Full.efi</a>. (Only v1 is applicable, later versions are not compatible with the flash tool and end up with the message: â€œInitShellApp: Application not started from Shellâ€.)</li><li>Rename the <code>Shell_Full.efi</code> in <code>ShellX64.efi</code> and copy this file to following three USB stick destinations: root folder, <code>/boot/efi/</code>, <code>/efi/boot/</code>. (Again, there are different advices, for time saving it easier to use all three choices.)</li><li>The creative part is completed, itâ€™s time for action. Restart the PC and enter the BIOS. If you use ASUS UEFI BIOS Utility in advanced mode, mouse click on the Exit (not by using keyboard â€œEscâ€), in the next dialog select â€œLaunch EFI Shell from filesystem deviceâ€. Other BIOS should behave similarly.</li><li>Next you should see starting shell execution, ending with a prompt: â€œShell&gt;â€ (not the â€œ2.0 Shell&gt;â€!).</li><li>Type the command: <code>map â€“b</code> (+Enter) for listing of available disks. Locate which one is your USB stick. In my case it is the fs6:<br>â€œfs6 :Removable HardDisk - â€¦ USB(â€¦)â€</li><li>You can break further execution of the map command by <code>q</code>.</li><li>Switch to the located USB stick by command <code>fsN:</code> (+Enter) (N=6 â€“ in my example = â€œfs6:â€, set N to your USB stick ID).</li><li><code>Dir</code> shows the file list:<br>2118IT.BIN<br>MPTSAS2.ROM<br>sas2flash.efi<DIR> BOOT<DIR> EFIShellX64.efi</li><li>The action can start. During it the power shall not be brocken!</li><li>Erase the controller flash memory: <code>sas2flash.efi -o -e 6</code>.</li><li>Write the new firmware to the flash: <code>sas2flash.efi -o -f 2118it.bin -b mptsas2.rom</code>.</li><li>After a while youâ€™ll see the success message. You can restart the PC and check if the controller BIOS reports the new â€œITâ€-firmware.</li><li>The card is ready to use.</li></ol></blockquote><ul><li>ä½¿ç”¨ <code>map -b</code> å‘½ä»¤æŸ¥çœ‹ U ç›˜çš„è·¯å¾„ï¼Œä¸€èˆ¬ä¸º <code>fsX</code> ç„¶åæŒ‰ä¸‹ <code>fs0:</code> è·¯å¾„å°±åˆ‡æ¢åˆ°äº† U ç›˜çš„ FAT32 åˆ†åŒºä¸‹ã€‚</li></ul><p><img src="img/20200828_9211-4i-04.jpg" alt=""></p><ul><li>ç„¶åä½¿ç”¨ <code>sas2flash.efi -o -e 6</code> å‘½ä»¤æ¸…ç©ºé˜µåˆ—å¡çš„  <code>flash memory</code>ã€‚</li><li>æ¥ç€ä½¿ç”¨ <code>sas2flsh -o -f 2114it.bin -b mptsas2.rom</code> å‘½ä»¤åˆ·å…¥æ–°çš„å›ºä»¶ã€‚</li></ul><p><img src="img/20200828_9211-4i-05.jpg" alt=""></p><ul><li>æ¢å¤ SAS åœ°å€ <code>sas2flsh -o -sasadd xxxxxxxx</code> </li></ul><p>æ“ä½œå®Œä»¥ä¸Šæ­¥éª¤åå°±å¯ä»¥é‡å¯äº†</p><h2 id="IT-æ¨¡å¼ï¼Ÿ"><a href="#IT-æ¨¡å¼ï¼Ÿ" class="headerlink" title="IT æ¨¡å¼ï¼Ÿ"></a>IT æ¨¡å¼ï¼Ÿ</h2><p>åˆ·å®Œä¹‹åé˜µåˆ—å¡çš„å‹å·å°±è«åå…¶å¦™åœ°å˜æˆäº† <code>LSIÂ® SAS 9211-4i PCI ExpressÂ® to 6Gb/s Serial Attached SCSI (SAS) Host Bus Adapter</code> ï¼Œå›ºä»¶çš„ç‰ˆæœ¬ä¹Ÿå˜æˆäº†  IT æ¨¡å¼ï¼Œå¼€æœºçš„é€Ÿåº¦æ¯”ä»¥å‰å¿«äº†å¾ˆå¤šï¼Œåªéœ€è¦ä¸åˆ° 5s å°±è‡ªæ£€å®Œæˆè¿›å…¥ ESXi çš„å¯åŠ¨æµç¨‹ï¼Œç»ˆäºå‘Šåˆ«åŸå…ˆçš„é¾Ÿé€Ÿå¯åŠ¨äº†ã€‚</p><p><img src="img/20200828_9211-4i-06.jpg" alt=""></p><p>åœ¨ ESXi ä¸­ï¼Œé˜µåˆ—å¡ä¹Ÿè¢«è¯†åˆ«ä¸ºäº† <code>LSI2004</code> ï¼Œçœ‹æ¥æ˜¯æ²¡é—®é¢˜äº†ï¼Œæ’ä¸Šç¡¬ç›˜ä¹Ÿéƒ½æ˜¯è¯†åˆ«å‡ºæ¥äº†ã€‚</p><p><img src="img/20200908_9211-4i-07.png" alt=""></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>ç”±äºæ˜¯æ˜¯ç¬¬ä¸€æ¬¡ç»™é˜µåˆ—å¡åˆ·å›ºä»¶ï¼Œåœ¨ç½‘ä¸Šæ‰¾åˆ°äº†å†™èµ„æ–™å¯ä»¥åšå‚è€ƒã€‚</p><ul><li><a href="https://wiki2.xbits.net:4430/hardware:lsi:h1110-it-firmware" target="_blank" rel="noopener">IBM H1110å¡åˆ·ä¸ºLSI 9211-4i ITå›ºä»¶</a></li><li><a href="https://www.tfir.io/easiest-way-to-flash-lsi-sas-9211-8i-on-motherboards-without-efi-shell/" target="_blank" rel="noopener">Easiest Way To Flash LSI SAS 9211-8i on Motherboards without EFI Shell</a></li><li><a href="https://www.broadcom.cn/support/knowledgebase/1211161495925/flash-upgrading-firmware-on-lsi-sas-hbas-upgraded-firmware-on-92" target="_blank" rel="noopener">Flash upgrading firmware on LSI SAS HBAs; Upgraded firmware on 9211-8i to P8, now duplicated drives</a></li><li><a href="chrome-extension://ikhdkkncnoglghljlkmcimlnlhkeamad/pdf-viewer/web/viewer.html?file=https%3A%2F%2Fdocs.broadcom.com%2Fdoc%2F12353332">LSIÂ® SAS 9211-4i PCI ExpressÂ® to 6Gb/s Serial Attached SCSI (SAS) Host Bus Adapter </a></li><li><a href="https://www.ixsystems.com/community/threads/how-to-flash-lsi-9211-8i-using-efi-shell.50902/" target="_blank" rel="noopener">How-to: Flash LSI 9211-8i using EFI shell</a></li><li><a href="https://github.com/bsodmike/s5clouds8-lsi9211-8i-IR-to-IT-EFI-bootable-usb" target="_blank" rel="noopener">s5clouds8-lsi9211-8i-IR-to-IT-EFI-bootable-usb</a></li><li><a href="https://superuser.com/questions/1057446/how-do-i-boot-to-uefi-shell" target="_blank" rel="noopener">How do I â€œBoot to UEFI shellâ€?</a></li><li><a href="https://forums.laptopvideo2go.com/topic/29059-sas2008-lsi92409211-firmware-files/" target="_blank" rel="noopener">SAS2008 (LSI9240/9211) Firmware files</a></li><li><a href="https://www.servethehome.com/ibm-serveraid-m1015-part-4/" target="_blank" rel="noopener">IBM ServeRAID M1015 Part 4: Cross flashing to a LSI9211-8i in IT or IR mode</a></li><li><a href="https://web.archive.org/web/20200423162708/http://brycv.com/blog/2012/flashing-it-firmware-to-lsi-sas9211-8i/" target="_blank" rel="noopener">Flashing IT Firmware to the LSI SAS9211-8i HBA</a></li><li><a href="https://forum.openmediavault.org/index.php?thread/2310-ibm-m1015-ir-vs-it/" target="_blank" rel="noopener">IBM M1015 - IR vs. IT</a></li><li><a href="https://marcan.st/2016/05/crossflashing-the-fujitsu-d2607/" target="_blank" rel="noopener">Crossflashing the Fujitsu D2607</a></li><li><a href="https://kc.mcafee.com/corporate/index?page=content&id=KB90801&locale=en_US" target="_blank" rel="noopener">How to create a bootable USB media to access the default EFI shell</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;åˆ·æœºï¼Ÿ&quot;&gt;&lt;a href=&quot;#åˆ·æœºï¼Ÿ&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="åˆ·æœº" scheme="https://blog.k8s.li/tags/%E5%88%B7%E6%9C%BA/"/>
    
      <category term="é˜µåˆ—å¡" scheme="https://blog.k8s.li/tags/%E9%98%B5%E5%88%97%E5%8D%A1/"/>
    
  </entry>
  
  <entry>
    <title>åƒåœ¾ä½¬çš„ Homelab æŠ˜è…¾è®°å½•</title>
    <link href="https://blog.k8s.li/homelab.html"/>
    <id>https://blog.k8s.li/homelab.html</id>
    <published>2020-08-20T16:00:00.000Z</published>
    <updated>2021-02-24T13:40:34.691Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ¡åƒåœ¾"><a href="#æ¡åƒåœ¾" class="headerlink" title="æ¡åƒåœ¾"></a>æ¡åƒåœ¾</h2><p>æ¥è‡ª <a href="https://space.bilibili.com/1292029" target="_blank" rel="noopener">@awpak78 </a>çš„å›¾ğŸ‘‡</p><p><img src="img/20200801_150112.jpg" alt="20200801_150112"></p><p>ä½œä¸ºä¸€åè¿ç»´å·¥ç¨‹å¸ˆï¼Œç™½å¤©åœ¨å·¥åœ°ä¸Šæ¬ç –å…»å®¶ç³Šå£ï¼Œæ™šä¸Šä¸‹ç­å›å®¶åå°±å¼€å§‹æŠ˜è…¾ä¸€å †ç ´é“œçƒ‚é“è‡ªå¨±è‡ªä¹ğŸ˜‚ã€‚æœ€è¿‘ä¸œæ‹¼è¥¿å‡‘èŠ±äº† 2000 æ¥å—é’±æ¡åƒåœ¾æ•´äº†å° HomeLab ç©ç©ï¼ŒæŠ˜è…¾ä¸€äº›æ²¡ç”¨çš„ä¸œè¥¿ğŸ™ƒ</p><p>å…¶å®å¾ˆæ—©ä¹‹å‰å°±æƒ³æä¸€å°ä½åŠŸè€—çš„ HomeLab ä¸»æœºç©å„¿äº†ï¼Œæœ€æ—©å¼€å§‹é€‰æ‹©çš„æ˜¯ Dell T1700 SFF + E3-1271V3 +32GB DDR3ï¼Œä½†æ˜¯å‘¢ï¼ŒE3 V3 ç³»åˆ—æ˜¯ Intel ç¬¬å››ä»£  CPU ï¼Œ1150 èŠ¯ç‰‡ç»„æ— æ³•ä» M.2 å¯åŠ¨ï¼Œç£ç›˜é€Ÿåº¦åªèƒ½è¾¾åˆ° SATA III ä¹Ÿå°±æ˜¯é¡¶å¤š 600 MB/s çš„è¯»å†™é€Ÿåº¦ï¼Œè€Œç›®å‰éšä¾¿ä¸€å—æ”¯æŒ  PCI-e M.2 NVMe çš„ä¸»æ¿æ™®ééƒ½èƒ½è¾¾åˆ° 3000MB/s äº†ã€‚æ‰€ä»¥è¿™ä¸€ç‚¹æ¥è®² E3 V3 å·²ç»ä¸å€¼å¾—æ¡äº†ã€‚è€Œä¸”æˆ‘æƒ³æŠŠæˆ‘å°å¼æœºä¸Š SN750 500GB æ¢åˆ°è¿™å°æœºå™¨ä¸Šï¼Œæ‰€ä»¥è¿˜æ˜¯è¦é€‰æ‹©ä¸€ä¸ªæ”¯æŒ PCI-e M.2 NVMe çš„ä¸»æ¿ã€‚</p><table><thead><tr><th align="center">ç¡¬ä»¶</th><th>é…ç½®</th><th align="center">ä»·æ ¼</th></tr></thead><tbody><tr><td align="center">CPU</td><td>Intel(R) Core(TM) i5-6600T CPU @ 2.70GHz 35w</td><td align="center">480</td></tr><tr><td align="center">ä¸»æ¿</td><td>Dell OptiPlex 7040 å‡†ç³»ç»Ÿï¼šIntel Â®Q170</td><td align="center">400</td></tr><tr><td align="center">å†…å­˜</td><td>é•å…‰ DDR4 16GB 2666MHz</td><td align="center">310</td></tr><tr><td align="center">æ˜¾å¡</td><td>è‹±ç‰¹å°”Â® æ ¸èŠ¯æ˜¾å¡ 530</td><td align="center">0</td></tr><tr><td align="center">æœºç®±</td><td>Dell OptiPlex 7040 å‡†ç³»ç»Ÿ</td><td align="center">0</td></tr><tr><td align="center">ç”µæº</td><td>Dell OptiPlex 7040 å‡†ç³»ç»Ÿï¼š290W å¼€å…³ç”µæº</td><td align="center">0</td></tr><tr><td align="center">UPS</td><td>æŸæ‚ç‰Œ UPS 650VA360W</td><td align="center">160</td></tr><tr><td align="center">å›ºæ€</td><td>ä¸‰æ˜Ÿ 970PRO 512GB</td><td align="center">820</td></tr><tr><td align="center">æ€»ä»·</td><td></td><td align="center">2170</td></tr></tbody></table><h3 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h3><p>è‡³äº 6600T çš„æ€§èƒ½ï¼Œåœ¨ 500 å—é’±çš„ä»·ä½å†… 35Wä½åŠŸè€—çš„ 6600T è¿˜ç®—å¯ä»¥èƒ½æ¥å—ï¼Œä¸ºä»€ä¹ˆä¸ä¹° 7200U è¿™ç§ä½å‹ U å‘¢ï¼Ÿï¼Œä¸€æ˜¯ä½å‹ U çš„è£…æœºæˆæœ¬å¤ªé«˜ï¼Œè€Œä¸”æ€§ä»·æ¯”å¾ˆä½ï¼Œæˆ‘è¿˜è¦åœ¨ä¸Šé¢è·‘ä¸€å †è™šæ‹Ÿæœºï¼Œä½å‹ U ææ€•æ‰›ä¸ä½ï¼Œæ‰€ä»¥ä¸€å¼€å§‹å°±æ”¾å¼ƒäº†ä½å‹ U çš„è£…æœºæ–¹æ¡ˆã€‚</p><p><img src="img/HomeLab-1.jpg" alt=""></p><h3 id="ä¸»æ¿"><a href="#ä¸»æ¿" class="headerlink" title="ä¸»æ¿"></a>ä¸»æ¿</h3><p>ç”±äº Dell SFF ç³»åˆ—çš„æœºç®±æ˜¯å®šåˆ¶çš„ï¼Œå’Œæ™®é€šçš„ä¸»æ¿ä¸å¤ªä¸€æ ·ï¼Œä¹Ÿåªæœ‰è¿™æ ·æ‰èƒ½å¡è¿›è¿™ä¹ˆå°çš„ç©ºé—´ï¼Œå¯¹äº MFF ç³»åˆ—çš„åˆ™æ›´å°ä¸€ç‚¹ã€‚å¯¹äºè¿™ç§å°æœºç®±è€Œè¨€ï¼Œæ‹¥æœ‰ 2ä¸ª PCI-e*4 å’Œä¸€ä¸ª PIC-e*16 æ˜¯ç›¸å½“ä¸é”™äº†ï¼ŒPCI-e*4å¯ä»¥è£…ä¸€ä¸ªé˜µåˆ—å¡ä¸ªä¸€ä¸ªå››ç½‘å£çš„ç½‘å¡ï¼ŒPIC-e*16åˆå¯ä»¥è£…ä¸€ä¸ªä½åŠŸè€—çš„åˆ€å¡æ˜¾å¡ã€‚ç­‰åˆ°ä»¥åå°å¼æœºå‡çº§çš„ç¡¬ä»¶çš„æ—¶å€™å†æŠŠå°å¼æœºä¸Šçš„ GT1030 äº®æœºå¡æ”¾ä¸Šå»ã€‚ä¸‰ä¸ª SATA ä¸€ä¸ª M.2 æœ‰ç‚¹æ‰è¥Ÿè§è‚˜ï¼Œæœºç®±ç©ºé—´å°±é‚£ä¹ˆç‚¹ï¼Œå£å­å¤šäº†ç¡¬ç›˜ä¹Ÿå¡ä¸ä¸‹å‘€ğŸ˜‚ã€‚</p><table><thead><tr><th>Model:</th><th><a href="https://www.dell.com/support/manuals/us/en/04/optiplex-7040-desktop/opti7040_sff_om/specifications?guid=guid-f058d593-d332-479e-9d55-6c6031fa6cba&lang=en-us" target="_blank" rel="noopener"><em>Dell OptiPlex 7040 SFF</em></a></th></tr></thead><tbody><tr><td>Form factor:</td><td>Small Form Factor</td></tr><tr><td>CPU options:</td><td>Intel Gen6 i3/i5/i7</td></tr><tr><td>Chipset:</td><td><a href="https://ark.intel.com/content/www/us/en/ark/products/90587/intel-q170-chipset.html" target="_blank" rel="noopener">Intel Q170</a></td></tr><tr><td>RAM slots:</td><td>(4x) DIMM DDR4-2133</td></tr><tr><td>Max RAM:</td><td>64 GB</td></tr><tr><td>USB Ports:</td><td>(6x) USB3.0; (4x) USB2.0;</td></tr><tr><td>Video Ports:</td><td>(2x) Display Port 1.2; HDMI 1.4;</td></tr><tr><td>Other Ports:</td><td>Serial; (2x) PS2; RJ45; Headset; Line-Out;</td></tr><tr><td>Optional Ports:</td><td>VGA; Media Card Reader;</td></tr><tr><td>SATA:</td><td>(3x) SATA 3.0*</td></tr><tr><td>PCIe:</td><td>PCIe 3.0 x16 (low profile); PCIe 3.0 x4 (low profile);</td></tr><tr><td>M.2 slots:</td><td>M.2 2280 M-key (PCIe 3.0 x4, SATA 3.0)</td></tr><tr><td>Drive bays:</td><td>3.5-inch/(2x)2.5-inch; 5.25-inch (slim);</td></tr><tr><td>Hard Drive:</td><td>max 2TB; RAID 0 &amp; 1;</td></tr><tr><td>PSU:</td><td>180 W</td></tr><tr><td>Weight:</td><td>6.00 kg (13.22 lb)</td></tr></tbody></table><ul><li>ä» <a href="https://www.hardware-corner.net/guides/difference-optiplex-3040-vs-5040-vs-7040/" target="_blank" rel="noopener">The difference between Dell OptiPlex 3040 vs. 5040 vs. 7040</a> å·æ¥çš„ä¸€å¼ å›¾ç‰‡ğŸ‘‡</li></ul><p><img src="img/OptiPlex_5040SFF_motherboard.jpg" alt="img"></p><h3 id="å†…å­˜"><a href="#å†…å­˜" class="headerlink" title="å†…å­˜"></a>å†…å­˜</h3><p>ä¸¤æ¡ 8GB DDR4 å†…ä»ä»æˆ‘å°å¼æœºä¸Šæ‹†ä¸‹æ¥çš„ï¼ŒåˆèŠ±äº† 300 å—é’±ä¹°äº†ä¸ªé•å…‰çš„ 16GB DDR4 è£…äº†ä¸Šå»ï¼Œè¿«äº æˆ‘çš„å°å¼æœº B350M-K çš„ç¼©æ°´æ¿åªæœ‰ä¸¤ä¸ªå†…å­˜æ’æ§½è€Œä¸”æ”¯æŒåˆ° 32GBï¼Œæš‚æ—¶è£…ä¸€ä¸ª 16GB çš„å§ï¼Œèƒ½ä»¥åå†è£…ä¸€ä¸ªä¸Šå»ã€‚</p><h3 id="å›ºæ€"><a href="#å›ºæ€" class="headerlink" title="å›ºæ€"></a>å›ºæ€</h3><p>å…¶å®æœ¬æ¥çš„é¢„ç®—ä¸‰æ˜Ÿ 970PRO 512GBæ²¡æ‰“ç®—ä¹°ï¼Œæ˜¯æˆ‘åœ¨æ‰¾ Dell OptiPlex 7040 æ—¶æ„å¤–ç¢°åˆ°çš„ä¸€ä¸ªè€å“¥ï¼Œè€Œä¸”è¿™å—å›ºæ€æ˜¯å¾·äºšçš„ï¼Œè¿˜ç®—é è°±ä¸€äº›ï¼Œäºæ˜¯å‰æ‰‹ä¹°äº†è¿™ä¸ªå—å›ºæ€ã€‚970PRO ç³»åˆ—çš„éƒ½æ˜¯ MLC çš„é¢—ç²’çš„å›ºæ€ç¡¬ç›˜ï¼Œé€š SM961 ä¸€æ ·æ˜¯å±äºä¼ å®¶å®ç³»åˆ—ğŸ˜‚ï¼Œä½†æ˜¯ SM961 æ·˜å®ä¸Šæ°´å¤ªæ·±ï¼Œæ¸…é›¶ç›˜å æ®å¤šæ•°ï¼Œæ‰€ä»¥ä¸å»ºè®®ä¹°ã€‚</p><p>æ­£å¥½æŠŠè¿™å— 970PRO æ¢åˆ°æˆ‘çš„å°å¼æœºä¸Šï¼ŒæŠŠå°å¼æœºä¸Šçš„ SN750 512GB æ¢åˆ° HomeLab æœºå™¨ä¸Šï¼Œç»™ ESXi ä¸Šçš„è™šæ‹Ÿæœºç”¨ã€‚åœ¨ç©å„¿è™šæ‹ŸåŒ–çš„æ—¶å€™æ·±æœ‰æ„Ÿè§¦ï¼Œå®¿ä¸»æœºçš„ç£ç›˜æ˜¯æœºæ¢°ç¡¬ç›˜çš„è¯ï¼Œä¸Šé¢çš„è™šæ‹Ÿæœºè¾¾åˆ°ä¸€å®šæ•°é‡æ—¶ï¼Œè™šæ‹Ÿæœºä¼šå¾ˆå¡ï¼Œæ‰€ä»¥ç© ESXi è™šæ‹ŸåŒ–ï¼Œæœ‰å—å›ºæ€çš„ä½“éªŒæ˜¯éå¸¸çˆ½æ»´ğŸ˜‹ã€‚</p><h2 id="è£…æœº"><a href="#è£…æœº" class="headerlink" title="è£…æœº"></a>è£…æœº</h2><p>å…¶å®è£…æœºå¾ˆå¿«ï¼Œç”±äºæ˜¯ä¹°çš„ Dell OptiPlex 7040 å‡†ç³»ç»Ÿï¼Œæ‰€ä»¥åªéœ€è¦æŠŠ CPU ã€å†…å­˜ã€ç¡¬ç›˜è£…ä¸Šå»å°±å®Œäº‹å„¿äº†ã€‚</p><p>æ”¶åˆ°å‡†ç³»ç»Ÿåå‘ç°æ²¡æœ‰å¸¦ M.2 èºä¸ï¼Œåªèƒ½ä¸´æ—¶æ‹¿èƒ¶å¸¦ç²˜ç³Šä¸Šå»ï¼Œå‹‰å¼ºæ’‘äº†ä¸¤å¤©ï¼Œåæ¥ä¹°äº†ä¸ªèºä¸å’Œæ•£çƒ­ç‰‡å®Œç¾åœ°è§£å†³äº†ã€‚</p><p><img src="img/HomeLab-5.jpg" alt=""></p><p>ä»ä»¥å‰æ—§ç¬”è®°æœ¬æ·˜æ±°ä¸‹æ¥çš„ 2TB 5400RPM çš„çŸ³å¤´ç›˜ï¼Œå·²ç»å‡ºç°åé“äº†ï¼Œä¸´æ—¶å½“ä¸ªä¸‹è½½ç›˜å§ï¼Œåœ¨å®ƒè¿˜æ²¡å½»åº•å´©ç›˜ä¹‹å‰å†å‹æ¦¨ä¸€ä¸‹å®ƒå§ğŸ˜‚ã€‚åé¢æ‰“ç®—å†æ·»åŠ ä¸€å—12TBçš„æ°¦æ°”ç›˜å½“ä»“åº“ç›˜å’Œå¤‡ä»½æ•°æ®ä½¿ç”¨ï¼Œæœ‰äº† UPS å’Œè¿™å°ä¸»æœº 7*24 å°æ—¶å¼€æœºä¹Ÿæ²¡å•¥é—®é¢˜äº†ã€‚</p><p><img src="img/HomeLab-3.jpg" alt=""></p><p>åé¢é‚£å°æ˜¯æˆ‘çš„å°å¼æœºï¼Œä¹Ÿæ˜¯å»å¹´è¿™æ—¶å€™ä¹°çš„ï¼Œä¸¤è€…æ¯”è¾ƒèµ·æ¥ SFF çš„å‹å·ç¡®å®å°å¾ˆå¤šã€‚Dell çš„è¿™ç§ä¸»æœºè¿˜æœ‰ä¸€ç§ MFF å‹å·çš„ï¼Œé‚£ç§æ›´å°ä¸€äº›ï¼Œå·®ä¸å¤šæ¯”è·¯ç”±å™¨å¤§ä¸€äº›è€Œå·²ï¼Œä¸è¿‡æ‰©å±•æ€§ä¸å¥½ï¼Œè€Œä¸”è¿˜éœ€è¦å¤–ç½®ç”µæºï¼Œä¹Ÿå°±æ²¡è€ƒè™‘ï¼Œä¸è¿‡ç°åœ¨æƒ³æƒ³æœ‰ç‚¹åæ‚”äº†ï¼Œå½“åˆåº”è¯¥å¤šåŠ ç‚¹é’±ä¹° SFF çš„ï¼Œä¸è¿‡è¿˜å¥½ä¹Ÿèƒ½æ¥å—ï¼Œåªä¸è¿‡ä½“ç§¯å¤§äº†äº›ï¼Œæ¬å®¶çš„æ—¶å€™ä¸å¤ªæ–¹ä¾¿ã€‚</p><p><img src="img/HomeLab-4.jpg" alt=""></p><h2 id="ESXi"><a href="#ESXi" class="headerlink" title="ESXi"></a>ESXi</h2><p>è£…å®Œæœºå™¨ä¹‹åå°±å¼€å§‹è£… ESXi ï¼Œå¯¹äºè™šæ‹ŸåŒ–ï¼ŒESXi ç®—æ˜¯æ¯”è¾ƒç†Ÿæ‚‰çš„äº†ï¼Œå¬è¯´ Proxmox VE ä¹Ÿä¸é”™ğŸ¤”ï¼Œç­‰åˆ°åé¢ç¡¬ç›˜åˆ°äº†å†æŠ˜è…¾ä¸€ä¸‹ Proxmox VEã€‚çœ‹åˆ°éš”å£ <a href="https://wzyboy.im/post/1293.html" target="_blank" rel="noopener">Proxmox VEï¼šä¼˜ç§€çš„è‡ªå»ºè™šæ‹ŸåŒ–æ–¹æ¡ˆ</a> æ„ˆå‘æƒ³ç©ç©äº†ã€‚</p><blockquote><p>  è´¯å½»ã€Œä¸é‡å¤é€ è½®å­ã€çš„åŸåˆ™ï¼Œå½“å‰ç‰ˆæœ¬çš„ PVE åŸºäºæˆç†Ÿç¨³å®šçš„ Debian 9 â€œStretchâ€ æ„å»ºã€‚åœ¨ç†Ÿæ‚‰å’Œä½¿ç”¨ PVE çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘è¶Šå‘å–œæ¬¢å®ƒã€Œä¸é‡å¤é€ è½®å­ã€çš„ç‰¹æ€§ã€‚ç›¸è¾ƒä¹‹å‰ç”¨è¿‡çš„å…¶ä»–è™šæ‹ŸåŒ–æ–¹æ¡ˆï¼ŒPVE çš„å†…éƒ¨æ„é€ å’Œå·¥ä½œåŸç†å¯¹æˆ‘æ¥è¯´ä¸å†æ˜¯ä¸€ä¸ªé»‘ç›’ï¼Œæˆ‘å¯ä»¥æ¸…æ™°åœ°è§‚æµ‹åˆ°å®ƒåœ¨å¹²ä»€ä¹ˆâ€”â€”æ¯”å¦‚è¦è¿ç§»ä¸€å°è™šæ‹Ÿæœºåˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘å°±å¯ä»¥é€šè¿‡ <code>ps</code> è§‚å¯Ÿåˆ°å®ƒå¯åŠ¨äº†ä¸€ä¸ª <code>dd</code> è¿›ç¨‹ï¼Œå¯¹æ¥ <code>ssh</code> ç®¡é“ï¼Œå°†ç£ç›˜æ•°æ®é€šè¿‡ç½‘ç»œå¤åˆ¶åˆ°ç›®æ ‡æœºå™¨â€”â€”è¿™ç§ä»¿ä½›é€æ˜æ‰‹è¡¨ä¸€æ ·èƒ½çœ‹åˆ°å†…éƒ¨å·¥ä½œåŸç†çš„æ„Ÿè§‰çœŸæ˜¯å¤ªæ£’äº†ï¼</p></blockquote><p>ä» VMware å®¶ä¸‹è½½å¥½ <code>VMware-VMvisor-Installer-7.0.0-15843807.x86_64.iso</code> é•œåƒï¼Œæ‰¾äº†ä¸¤ä¸ª U ç›˜ï¼Œä¸€ä¸ªç”¨äº ESXi çš„å®‰è£…ç›˜ï¼Œä¸€ä¸ªç”¨äº ESXi çš„ç³»ç»Ÿç›˜ï¼Œå…¶ä¸­ä¸€ä¸ª U ç›˜è¿˜æ˜¯æˆ‘ç”¨è¯»å¡å™¨+16GBå†…å­˜å¡æ‹¼å‡‘è€Œæˆçš„ï¼Œç›®çš„æ˜¯ä¸ºäº†æŠŠ ESXi è£…åˆ° U ç›˜é‡Œæ–¹ä¾¿è¿ç§»æ•°æ®ä¹‹ç±»çš„ï¼Œä¹‹ååœ¨ç½‘ä¸Šæ‰¾ä¸€ä¸ªç¥ KEY æ¿€æ´»ä¸€ä¸‹ï¼ˆğŸ¤«å°å£°</p><p><img src="img/HomeLab-6.jpg" alt=""></p><h3 id="Ubuntu-20-04"><a href="#Ubuntu-20-04" class="headerlink" title="Ubuntu 20.04"></a>Ubuntu 20.04</h3><p>å½“ä½œç½‘å…³æœºä½¿ç”¨ï¼Œå’Œæˆ‘æ‰€æœ‰çš„ äº‘ä¸»æœºæ‰“é€šç½‘ç»œï¼Œä½¿ç”¨ WireGuard ç»„æˆä¸€ä¸ªå°å†…ç½‘ï¼Œå…³äº WireGuard çš„ä½¿ç”¨å»ºè®®é˜…è¯»å¤§ä½¬å†™å¾—åšå®¢ <a href="https://fuckcloudnative.io/posts/wireguard-docs-practice/" target="_blank" rel="noopener">WireGuard æ•™ç¨‹ï¼šWireGuard çš„æ­å»ºä½¿ç”¨ä¸é…ç½®è¯¦è§£</a> ä»¥åŠ <a href="https://fuckcloudnative.io/posts/wireguard-docs-theory/" target="_blank" rel="noopener">WireGuard æ•™ç¨‹ï¼šWireGuard çš„å·¥ä½œåŸç†</a>ã€‚</p><p>é¡ºå¸¦ç”¨ <a href="https://github.com/Aniverse/ZBench" target="_blank" rel="noopener">ZBench</a> æµ‹äº†ä¸€ä¸‹è™šæ‹Ÿæœºçš„ç£ç›˜æ€§èƒ½ï¼Œè¿˜ç®—å‹‰å¼ºè¯´çš„è¿‡å»ï¼Œå®é™…ä¸Š SN750 512GB åªæœ‰ 2GB å·¦å³çš„ç¼“å­˜ï¼Œå†™æ»¡æ¢ç²—ä¹‹åï¼Œå†™å…¥çš„æ€§èƒ½ä¼šç›´çº¿ä¸‹é™åˆ° 800MB/sï¼Œè¯»çš„æ€§èƒ½å€’æ˜¯å¯ä»¥è¾¾åˆ° 3200MB/s ä»¥ä¸Šï¼Œæˆ–è®¸æ˜¯ä¸»æ¿çš„é™åˆ¶ï¼Œæ²¡èƒ½è¾¾åˆ°ç†æƒ³çš„è¯»å†™æ€§èƒ½ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------------------------------------------------</span><br><span class="line">CPU model            : Intel(R) Core(TM) i5-6600T CPU @ 2.70GHz</span><br><span class="line">Number of cores      : 4</span><br><span class="line">CPU frequency        : 2712.000 MHz</span><br><span class="line">Total size of Disk   : 33.3 GB (7.7 GB Used)</span><br><span class="line">Total amount of Mem  : 3935 MB (306 MB Used)</span><br><span class="line">Total amount of Swap : 3934 MB (0 MB Used)</span><br><span class="line">System uptime        : 4 days, 19 hour 47 min</span><br><span class="line">Load average         : 0.13, 0.08, 0.03</span><br><span class="line">OS                   : Ubuntu 20.04 LTS</span><br><span class="line">Arch                 : x86_64 (64 Bit)</span><br><span class="line">Kernel               : 5.4.0-42-generic</span><br><span class="line">Virt                 : vmware</span><br><span class="line">--------------------------------------------------------------------------</span><br><span class="line">I/O speed(1st run)   :1.3 GB/s</span><br><span class="line">I/O speed(2nd run)   :1.3 GB/s</span><br><span class="line">I/O speed(3rd run)   :1.3 GB/s</span><br></pre></td></tr></table></figure><h3 id="PhotonOS"><a href="#PhotonOS" class="headerlink" title="PhotonOS"></a>PhotonOS</h3><p>è¿™ä¸ªæ˜¯ç³»ç»Ÿåœ¨æˆ‘å¦ä¸€ç¯‡åšå®¢ <a href="https://blog.k8s.li/container-linux-os.html">Container Linux OS ä»å…¥å‘åˆ°çˆ¬å‡ºæ¥</a> é‡Œæåˆ°è¿‡ï¼ŒPhoton OSâ„¢ æ˜¯é’ˆå¯¹ VMware vSphereÂ® è™šæ‹ŸåŒ–å¹³å°è¿›è¡Œå†…æ ¸ä¼˜åŒ–çš„å®¹å™¨ä¸“ç”¨æ“ä½œç³»ç»Ÿï¼Œå°±å’Œ CoreOS ä¸€æ ·ã€‚ååˆ†é€‚åˆä¸“é—¨ç”¨æ¥è¿è¡Œå®¹å™¨ï¼Œå½“ä½œ Kubernetes é›†ç¾¤ä¸­çš„å·¥ä½œè´Ÿè½½æ¥ä½¿ç”¨ã€‚</p><ul><li>ç³»ç»Ÿåˆå§‹åŒ–å¯åŠ¨ä¹‹åå†…å­˜ä»…ä»…ä½¿ç”¨äº† 45Mi</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:          2.0Gi        45Mi       1.8Gi       0.0Ki        93Mi       1.8Gi</span><br><span class="line">Swap:            0B          0B          0B</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨ docker è¿›ç¨‹ä¹‹åçš„å ç”¨æƒ…å†µï¼Œä¹Ÿä»…ä»… 109Mi</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:          2.0Gi       109Mi       1.6Gi       0.0Ki       238Mi       1.8Gi</span><br><span class="line">Swap:            0B          0B          0B</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ OVA è™šæ‹Ÿæœºæ¨¡æ¿å¯åŠ¨åçš„è™šæ‹Ÿæœºï¼Œç£ç›˜ä»…ä»…å ç”¨äº† 515MB ï¼Œç¡®å®æ˜¯ç›¸å½“è½»é‡åŒ–ï¼Œè¿™è¿˜æ˜¯åŒ…å«äº† dockerã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# df -h</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/root        16G  515M   15G   4% /</span><br><span class="line">devtmpfs        998M     0  998M   0% /dev</span><br><span class="line">tmpfs          1000M     0 1000M   0% /dev/shm</span><br><span class="line">tmpfs          1000M  532K  999M   1% /run</span><br><span class="line">tmpfs          1000M     0 1000M   0% /sys/fs/cgroup</span><br><span class="line">tmpfs          1000M     0 1000M   0% /tmp</span><br><span class="line">/dev/sda2        10M  2.2M  7.9M  22% /boot/efi</span><br><span class="line">tmpfs           200M     0  200M   0% /run/user/0</span><br></pre></td></tr></table></figure><p>æ€»ä¹‹ï¼ŒPhotonOS æ˜¯ä¸ªå¾ˆè½»é‡çš„ OS ï¼Œé€‚åˆä¸“é—¨ç”¨æ¥è¿è¡Œä¸€äº›å®¹å™¨åŒ–çš„æœåŠ¡ï¼Œè¿™æ­£å¥½ç¬¦åˆæˆ‘çš„éœ€æ±‚ã€‚åˆ«é—®æˆ‘ä¸ºä»€ä¹ˆä¸ç”¨ CoreOS ï¼ŒCoreOS å·²ç»å‡‰äº†ã€‚</p><h3 id="Alpine-NFS"><a href="#Alpine-NFS" class="headerlink" title="Alpine NFS"></a>Alpine NFS</h3><p>æŠŠæˆ‘ä¸€å—ç£ç›˜ç›´é€šç»™è¿™ä¸ªè™šæ‹Ÿæœºï¼Œä¸»è¦ç”¨æ¥ç»™ k8s é›†ç¾¤ä¸­çš„ Pod æŒ‚è½½ PVC æŒä¹…åŒ–å­˜å‚¨ä½¿ç”¨ã€‚</p><h3 id="Debian"><a href="#Debian" class="headerlink" title="Debian"></a>Debian</h3><p>ä¸»è¦æ˜¯ç”¨æ¥è¿è¡Œ K8s é›†ç¾¤ï¼Œç›®å‰åªæœ‰ä¸€ä¸ª  master å’Œä¸€ä¸ª node ç©ç©å„¿ï¼Œè·‘äº†ä¸€äº›è‡ªç”¨çš„æœåŠ¡ã€‚</p><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>å½“ä¸‹è½½æœºä½¿ç”¨ï¼Œå¤–åŠ è¿è¡Œä¸€äº›ä¸å¾—ä¸ä½¿ç”¨çš„å›½äº§æ¯’ç˜¤è½¯ä»¶ğŸ˜¡</p><h2 id="é¢å¤–ç¡¬ä»¶"><a href="#é¢å¤–ç¡¬ä»¶" class="headerlink" title="é¢å¤–ç¡¬ä»¶"></a>é¢å¤–ç¡¬ä»¶</h2><p>æ¡åƒåœ¾çš„ä¹è¶£å°±åœ¨äºè¶ŠæŠ˜è…¾è¶Šå¥½ç©ï¼Œäºæ˜¯åˆå¼€å§‹æ‰“ç®—æŠ˜è…¾ä¸€äº›</p><h3 id="UPS"><a href="#UPS" class="headerlink" title="UPS"></a>UPS</h3><p>ç”±äºæœ€è¿‘æˆ¿ä¸œå®¶é‡Œç»å¸¸æ–­ç”µï¼Œæœ‰æ—¶ä¸€å¤©æ–­ç”µå…«ä¹æ¬¡ï¼Œæ¯æ¬¡æ–­ç”µæˆ‘éƒ½æ‹…å¿ƒç€ç¡¬ç›˜é‡Œçš„è€å©†ä»¬ä¼šä¸ä¼šæŒ‚æ‰ï¼Œç´¢æ€§è¿˜æ˜¯ä¹°äº† UPS ï¼Œåœ¨é©¬äº‘å®¶çœ‹äº†çœ‹ï¼Œå¸¦ç»™ NAS è‡ªåŠ¨æ–­ç”µçš„ UPS æ™®éåœ¨ 400å—é’±ä»¥ä¸Šï¼Œè€Œä¸”æˆ‘è¿™ä¸ªè¿˜æ˜¯ä¸ªå‡çš„ NAS ï¼ŒUPS ä¸Šçš„ USB å£ä¸ä¸€å®šæ”¯æŒæˆ‘çš„ä¸»æœºã€‚æœ€åä¸ºäº†èŠ‚çœä¸€ä¸‹é¢„ç®—èŠ±å„¿ 160 å—é’±ä¹°äº†ä¸ªä¸æ”¯æŒ USB çš„ UPS ï¼Œä½†æ˜¯åˆä¸èƒ½æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œå› ä¸ºå®¶é‡Œçš„ 220V å¸‚ç”µæ–­ç”µä¹‹åï¼ŒUPS çš„ç”µé‡åªèƒ½ç»™ä¸»æœºç»­å‘½ 10~20min å·¦å³ï¼ŒUPS çš„ç”µé‡ç”¨å®Œä¹‹åå°±å—å±äº†ï¼Œç…§é˜³è¿˜æ˜¯æ–­ç”µã€‚æ‰€ä»¥åœ¨ UPS ç”¨å°½ç”µé‡è¿˜æ˜¯æ²¡æœ‰æ¥ç”µä¹‹å‰ï¼Œä¸€å®šè¦æƒ³åŠæ³•æŠŠä¸»æœºé€šè¿‡ poweroff çš„æ–¹å¼å®‰å…¨ä¼˜é›…æ»´å…³æœºã€‚</p><p>é¦–å…ˆè¦è€ƒè™‘çš„æ˜¯æ€ä¹ˆçŸ¥é“ 220V å¸‚ç”µæ–­ç”µäº†ï¼Œèµ·åˆæƒ³æœ‰æ²¡æœ‰ä¸ª 220V çš„ä¼ æ„Ÿå™¨ï¼Œæˆ‘å»ï¼Œæœ‰ç‚¹éš¾åº¦è¿˜æ˜¯ç®—äº†å§ã€‚æœ€åä¸€æƒ³ï¼Œå¯ä»¥é€šè¿‡ ping æˆ¿ä¸œå®¶å…‰çŒ«çš„æ–¹å¼ã€‚æˆ‘çš„è·¯ç”±å™¨å’Œä¸»æœºç­‰è®¾å¤‡è¿æ¥ UPS ï¼Œæˆ¿ä¸œå®¶çš„å…‰çŒ«å¹¶æ²¡æœ‰è¿æ¥ UPS ï¼Œæˆ‘åœ¨è·¯ç”±å™¨ä¸Šè®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯åˆ†é’Ÿå» ping æˆ¿ä¸œå®¶çš„å…‰çŒ«ï¼Œæ²¡æœ‰ ping é€šè¯´æ˜å°±æ˜¯æ–­ç”µäº†ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ç½‘çº¿è¢«æ‹”æ‰äº†ï¼Œä½†æ¦‚ç‡å¾ˆå°ã€‚<code>! ping -c 8 A &amp;&amp; ssh B &quot;poweroff&quot;</code> ä¸€è¡Œç®€å•çš„å‘½ä»¤å°±æ»¡è¶³äº†æˆ‘çš„éœ€æ±‚ï¼Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">echo "start" &gt;&gt; /tmp/power_status</span><br><span class="line">if ! ping -c 32 192.168.1.1</span><br><span class="line">then</span><br><span class="line">    sleep 300</span><br><span class="line">    ping -c 32 192.168.1.1 &amp;&amp; exit 0</span><br><span class="line">    sshpass -p "pwd" ssh root@192.168.0.210 "net rpc shutdown -I 192.168.0.240 -U admin%poweroff"</span><br><span class="line">    sshpass -p "pwd" ssh root@192.168.0.200 "sh -c /suspend_vm.sh"</span><br><span class="line">    echo "220v poweroff" &gt;&gt; /tmp/power_status</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>å¯¹äº ESXi ä¸Šçš„è™šæ‹Ÿæœºï¼Œè¿˜æ˜¯é‡‡ç”¨äº†æŒ‚èµ·çš„æ–¹å¼ï¼Œå°†è™šæ‹Ÿæœºçš„å†…å­˜çŠ¶æ€ä¿å­˜åœ¨æ•°æ®å­˜å‚¨çš„ç£ç›˜é‡Œï¼Œè¿™æ ·é‡æ–°å¼€å¯è™šæ‹Ÿæœºåå°±èƒ½æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼Œè¿™ä¸€ç‚¹æœ‰ç‚¹åƒ Windows çš„ä¼‘çœ ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">for vm in $(/sbin/vmdumper -l | grep -v Alpine |  awk '&#123;print $1&#125;' | sed 's/wid=//g')</span><br><span class="line">do</span><br><span class="line">     /sbin/vmdumper $&#123;vm&#125; suspend_vm</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h3 id="ç½‘ç®¡äº¤æ¢æœº"><a href="#ç½‘ç®¡äº¤æ¢æœº" class="headerlink" title="ç½‘ç®¡äº¤æ¢æœº"></a>ç½‘ç®¡äº¤æ¢æœº</h3><p>å½“æˆ‘ä»å°å¼æœºå‘ ESXI é‡Œçš„è™šæ‹Ÿæœºä¼ è¾“æ–‡ä»¶çš„æ—¶å€™ï¼Œå‘ç°ç½‘ç»œé€Ÿåº¦æœ€å¿«åªèƒ½è¾¾åˆ° 700Mbits/sec ï¼Œçœ‹æ¥åº”è¯¥æ˜¯è·¯ç”±å™¨çš„æ€§èƒ½ç“¶é¢ˆï¼Œäºæ˜¯æƒ³ç€å‡çº§ä¸€ä¸‹ç½‘ç»œè®¾å¤‡ï¼ŒæŠŠ R6300V2 è·¯ç”±å™¨å½“ä½œ AP æ¥ç”¨ï¼Œå°†æµé‡éƒ½æ±‡èšåˆ°ç½‘ç®¡äº¤æ¢æœºä¸Šã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[  4] local 192.168.0.240 port 50718 connected to 192.168.0.123 port 5201</span><br><span class="line">[ ID] Interval           Transfer     Bandwidth</span><br><span class="line">[  4]   0.00-1.00   sec  83.8 MBytes   702 Mbits/sec</span><br><span class="line">[  4]   1.00-2.00   sec  83.4 MBytes   700 Mbits/sec</span><br><span class="line">[  4]   2.00-3.00   sec  83.6 MBytes   701 Mbits/sec</span><br><span class="line">[  4]   3.00-4.00   sec  82.9 MBytes   695 Mbits/sec</span><br><span class="line">[  4]   4.00-5.00   sec  83.8 MBytes   702 Mbits/sec</span><br><span class="line">[  4]   5.00-6.00   sec  83.6 MBytes   701 Mbits/sec</span><br><span class="line">[  4]   6.00-7.00   sec  83.5 MBytes   701 Mbits/sec</span><br><span class="line">[  4]   7.00-8.00   sec  83.8 MBytes   703 Mbits/sec</span><br><span class="line">[  4]   8.00-9.00   sec  83.8 MBytes   702 Mbits/sec</span><br><span class="line">[  4]   9.00-10.00  sec  83.8 MBytes   702 Mbits/sec</span><br><span class="line">[  4]  10.00-11.00  sec  83.8 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  11.00-12.00  sec  83.8 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  12.00-13.00  sec  83.9 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  13.00-14.00  sec  83.8 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  14.00-15.00  sec  83.8 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  15.00-16.00  sec  83.9 MBytes   704 Mbits/sec</span><br><span class="line">[  4]  16.00-17.00  sec  83.4 MBytes   699 Mbits/sec</span><br><span class="line">[  4]  17.00-18.00  sec  83.9 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  18.00-19.00  sec  83.6 MBytes   702 Mbits/sec</span><br><span class="line">[  4]  19.00-20.00  sec  83.8 MBytes   702 Mbits/sec</span><br><span class="line">[  4]  20.00-21.00  sec  83.9 MBytes   704 Mbits/sec</span><br><span class="line">[  4]  21.00-22.00  sec  83.8 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  22.00-23.00  sec  83.9 MBytes   704 Mbits/sec</span><br><span class="line">[  4]  23.00-24.00  sec  83.9 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  24.00-25.00  sec  83.9 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  25.00-25.20  sec  16.6 MBytes   698 Mbits/sec</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€debian@debian ~</span><br><span class="line">â•°â”€$ qperf 192.168.0.123 -t 30 -vvu tcp_lat udp_lat tcp_bw udp_bw conf</span><br><span class="line">tcp_lat:</span><br><span class="line">    latency   =  98.7 us</span><br><span class="line">    msg_size  =     1 bytes</span><br><span class="line">    time      =    30 sec</span><br><span class="line">    timeout   =     5 sec</span><br><span class="line">udp_lat:</span><br><span class="line">    latency   =  98 us</span><br><span class="line">    msg_size  =   1 bytes</span><br><span class="line">    time      =  30 sec</span><br><span class="line">    timeout   =   5 sec</span><br><span class="line">tcp_bw:</span><br><span class="line">    bw        =  87.9 MB/sec</span><br><span class="line">    msg_size  =    64 KiB (65,536)</span><br><span class="line">    time      =    30 sec</span><br><span class="line">    timeout   =     5 sec</span><br><span class="line">udp_bw:</span><br><span class="line">    send_bw   =  56.7 MB/sec</span><br><span class="line">    recv_bw   =  56.7 MB/sec</span><br><span class="line">    msg_size  =    32 KiB (32,768)</span><br><span class="line">    time      =    30 sec</span><br><span class="line">    timeout   =     5 sec</span><br><span class="line">conf:</span><br><span class="line">    loc_node   =  debian</span><br><span class="line">    loc_cpu    =  16 Cores: AMD Ryzen 7 1700 Eight-Core   3.0GHz</span><br><span class="line">    loc_os     =  Linux 4.4.0-18362</span><br><span class="line">    loc_qperf  =  0.4.11</span><br><span class="line">    rem_node   =  gateway</span><br><span class="line">    rem_cpu    =  4 Cores: Intel Core i5-6600T @ 2.70GHz</span><br><span class="line">    rem_os     =  Linux 5.4.0-42-generic</span><br><span class="line">    rem_qperf  =  0.4.11</span><br></pre></td></tr></table></figure><p>å‡†å¤‡ä¹° GS108E V2 æˆ–è€… GS105E V2ï¼Œ</p><h3 id="å››ç½‘å£ç½‘å¡"><a href="#å››ç½‘å£ç½‘å¡" class="headerlink" title="å››ç½‘å£ç½‘å¡"></a>å››ç½‘å£ç½‘å¡</h3><p>ä¸ºäº†æŠ˜è…¾ä¸€ä¸‹ç½‘å¡ç›´é€šã€ç«¯å£æ±‡èšã€overlay ç½‘ç»œå¸è½½ç­‰ç‰¹æ€§ï¼Œåé¢è¿˜è¦æ·»åŠ ä¸€å— <a href="https://www.intel.cn/content/www/cn/zh/products/docs/network-io/ethernet/10-25-40-gigabit-adapters/ethernet-i350-server-adapter-brief.html" target="_blank" rel="noopener">intel I350 T4 V2</a> ï¼Œé—²é±¼ä¸Šçš„ä»·æ ¼ä¹Ÿä¸æ˜¯å¾ˆè´µã€‚</p><p><img src="img/20200822195450798.png" alt="image-20200822195450798"></p><h3 id="é˜µåˆ—å¡"><a href="#é˜µåˆ—å¡" class="headerlink" title="é˜µåˆ—å¡"></a>é˜µåˆ—å¡</h3><p>ç”±äºä¸»æ¿çš„ SATA æ¥å£æœ€å¤§åªæ”¯æŒåˆ° 2TB ï¼Œä¸ºäº†æ‰©å±•ä¸€ä¸‹å­˜å‚¨ï¼Œåªèƒ½é¢å¤–æ·»åŠ ä¸€å—é˜µåˆ—å¡äº†ï¼Œç”±äºä¸»æ¿çš„ PCIe æœ‰é™ï¼Œè€Œä¸”è¿™ä¹ˆå¤§ç‚¹çš„æœºç®±æœ€å¤šä¹Ÿå°±èƒ½å¡ä¸‹ 1 å— 3.5 å¯¸ç¡¬ç›˜å’Œ 3 å— 2.5 å¯¸ç¡¬ç›˜ï¼Œæ‰€ä»¥æ‰¾ä¸€å—å…¥é—¨çº§çš„é˜µåˆ—å¡å°±å¤Ÿäº†ï¼Œæœ€ç»ˆèŠ±äº† 50 å—é’±æ¡äº†ä¸€å— <a href="https://lenovopress.com/tips0831-serveraid-h1110" target="_blank" rel="noopener">ServeRAID H1110 SAS/SATA Controller</a> é˜µåˆ—å¡ï¼Œçœ‹æ¥ä¸€ä¸‹æ‰‹å†Œé‡Œçš„å‚æ•°ï¼Œå¤§æ¦‚ä¹Ÿèƒ½æš‚æ—¶æ»¡è¶³æˆ‘çš„éœ€æ±‚ã€‚</p><blockquote><ul><li>Four internal 6 Gbps SAS/SATA ports</li><li>One x4 mini-SAS internal connector (SFF-8087)</li><li>6 Gbps throughput per port</li><li>Based on LSI SAS2004 6 Gbps RAID on Chip (ROC) controller</li><li>x4 PCI Express 2.0 host interface</li><li>Supports RAID 0, 1, 1E, and 10</li><li>Connects to up to four SAS or SATA drives</li><li>SAS and SATA drives are supported, but the mixing of SAS and SATA in the same integrated volume is not supported</li><li>Supports simple-swap SATA and hot-swap SAS and SATA drives</li><li>Supports up to two integrated volumes</li><li>Supports up to two global hot-spare drives</li><li>Supports drive sizes greater than 2 TB for RAID 0, 1E, and 10 (not RAID 1)</li><li>Fixed stripe size of 64 KB</li><li>Compliant with Disk Data Format (DDF)</li><li>S.M.A.R.T. support</li></ul></blockquote><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>æ‡’å¾—å†™äº†</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;æ¡åƒåœ¾&quot;&gt;&lt;a href=&quot;#æ¡åƒåœ¾&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="æ¡åƒåœ¾" scheme="https://blog.k8s.li/tags/%E6%8D%A1%E5%9E%83%E5%9C%BE/"/>
    
      <category term="NAS" scheme="https://blog.k8s.li/tags/NAS/"/>
    
  </entry>
  
  <entry>
    <title>docker registry GC åŸç†åˆ†æ</title>
    <link href="https://blog.k8s.li/registry-gc.html"/>
    <id>https://blog.k8s.li/registry-gc.html</id>
    <published>2020-07-10T16:00:00.000Z</published>
    <updated>2021-02-24T13:40:34.691Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å¥½ä¹…æ²¡æ›´æ–°åšå®¢äº†ï¼Œåœ¨å®¶æ‘¸é±¼èµ¶ç´§æ¥æ°´ä¸€ç¯‡ğŸ˜‚</p></blockquote><h2 id="registry-GC-åŸç†ğŸ¤”"><a href="#registry-GC-åŸç†ğŸ¤”" class="headerlink" title="registry GC åŸç†ğŸ¤”"></a>registry GC åŸç†ğŸ¤”</h2><p>åœ¨å’±ä¸Šä¸ªæœˆå†™çš„<a href="https://blog.k8s.li/Exploring-container-image.html">ã€Šæ·±å…¥æµ…å‡ºå®¹å™¨é•œåƒçš„ä¸€ç”Ÿã€‹</a>ä¸­ç®€å•æåˆ°äº†å®¹å™¨é•œåƒçš„ä¸€äº›çŸ¥è¯†ï¼Œä¹Ÿç®€å•ä»‹ç»äº†é•œåƒåœ¨ registry ä¸­å­˜å‚¨çš„ç›®å½•ç»“æ„ã€‚ä»Šå¤©è¿˜æ˜¯ä»æ–‡ä»¶ç³»ç»Ÿå±‚é¢åˆ†æä¸€ä¸‹ registry GC çš„åŸç†ï¼Œæ¯”ä»æºç æ¥åˆ†ææ›´ç›´è§‚ä¸€äº›ã€‚</p><h3 id="éƒ¨ç½²-registry-å®¹å™¨"><a href="#éƒ¨ç½²-registry-å®¹å™¨" class="headerlink" title="éƒ¨ç½² registry å®¹å™¨"></a>éƒ¨ç½² registry å®¹å™¨</h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨æœ¬åœ°éƒ¨ç½²ä¸€ä¸ª registry å®¹å™¨ï¼ŒåŒæ—¶ä¸ºäº†æ“ä½œçš„æ–¹ä¾¿è¿˜éœ€è¦ä½¿ç”¨åˆ° skopeo è¿™ä¸ªå·¥å…·æ¥æ›¿ä»£ docker å‘½ä»¤è¡Œå®¢æˆ·ç«¯è¿›è¡Œ copy é•œåƒå’Œ delete é•œåƒã€‚å…³äº skopeo è¿™ä¸ªå·¥å…·çš„å®‰è£…å’Œä½¿ç”¨å¯ä»¥å‚è€ƒå’±ä¹‹å‰å†™è¿‡çš„<a href="https://blog.k8s.li/skopeo.html">ã€Šé•œåƒæ¬è¿å·¥ skopeo ã€‹</a>ã€‚</p><h4 id="è‡ªç­¾-SSL-è¯ä¹¦"><a href="#è‡ªç­¾-SSL-è¯ä¹¦" class="headerlink" title="è‡ªç­¾ SSL è¯ä¹¦"></a>è‡ªç­¾ SSL è¯ä¹¦</h4><p>è¿™ä¸€æ­¥ä¸ºäº†æ–¹ä¾¿åœ¨ä½¿ç”¨ skopeo çš„æ—¶å€™ä¸ç”¨åŠ ä¸€å †é¢å¤–çš„å‚æ•°ğŸ˜‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">set -e</span><br><span class="line">set -o nounset</span><br><span class="line">cat &gt;ca.conf &lt;&lt;EOF</span><br><span class="line">[ req ]</span><br><span class="line">default_bits  = 2048</span><br><span class="line">distinguished_name = req_distinguished_name</span><br><span class="line">prompt   = no</span><br><span class="line">encrypt_key  = no</span><br><span class="line">x509_extensions  = v3_ca</span><br><span class="line">[ req_distinguished_name ]</span><br><span class="line">CN         = localhost</span><br><span class="line">[ CA_default ]</span><br><span class="line">copy_extensions = copy</span><br><span class="line">[ alternate_names ]</span><br><span class="line">DNS.2=localhost</span><br><span class="line">[ v3_ca ]</span><br><span class="line">subjectAltName=@alternate_names</span><br><span class="line">subjectKeyIdentifier=hash</span><br><span class="line">authorityKeyIdentifier=keyid:always,issuer:always</span><br><span class="line">basicConstraints = critical,CA:true</span><br><span class="line">keyUsage=keyCertSign,cRLSign,digitalSignature,keyEncipherment,nonRepudiation</span><br><span class="line">EOF</span><br><span class="line">mkdir -p certs</span><br><span class="line">openssl req -days 365 -x509 -config ca.conf \</span><br><span class="line">    -new -keyout certs/domain.key -out certs/domain.crt</span><br></pre></td></tr></table></figure><ul><li>ä¿¡ä»»è¯ä¹¦ï¼Œæ ¹æ®ä¸åŒçš„å‘è¡Œç‰ˆé€‰æ‹©ç›¸åº”çš„è·¯å¾„å’Œå‘½ä»¤è¡Œå³å¯ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> CentOS</span></span><br><span class="line">update-ca-trust force-enable</span><br><span class="line">cp certs/domain.crt /etc/pki/ca-trust/source/anchors/localhost.crt</span><br><span class="line">update-ca-trust</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Ubuntu</span></span><br><span class="line">cp certs/domain.crt /usr/local/share/ca-certificates/localhost.crt</span><br><span class="line"><span class="meta">$</span><span class="bash"> update-ca-certificates</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian</span></span><br><span class="line">cp certs/domain.crt /usr/share/ca-certificates/localhost.crt</span><br><span class="line">echo localhost.crt &gt;&gt; /etc/ca-certificates.conf</span><br><span class="line">update-ca-certificates</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºå¯†ç -auth-è®¤è¯-auth-htpasswd-æ–‡ä»¶"><a href="#åˆ›å»ºå¯†ç -auth-è®¤è¯-auth-htpasswd-æ–‡ä»¶" class="headerlink" title="åˆ›å»ºå¯†ç  auth è®¤è¯  auth.htpasswd æ–‡ä»¶"></a>åˆ›å»ºå¯†ç  auth è®¤è¯  auth.htpasswd æ–‡ä»¶</h4><p>ç”±äº PUSH é•œåƒå’Œ DELETE é•œåƒæ˜¯é€šè¿‡ HTTP è¯·æ±‚ registry çš„ API å®Œæˆçš„ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦ä¸€ä¸ª token æ‰èƒ½å®Œæˆæ“ä½œï¼Œè¿™ä¸ª token éœ€è¦ä½¿ç”¨è¿™ä¸ª AUTH æ–‡ä»¶æ¥è¿›è¡Œé‰´æƒï¼Œä½¿ç”¨ <code>htpasswd</code> æ¥ç”Ÿæˆä¸€ä¸ªæ˜æ–‡çš„ç”¨æˆ·/å¯†ç å³å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htpasswd -cB -b auth.htpasswd root 123456</span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨-registry-å®¹å™¨ï¼Œdocker-run-èµ°èµ·ï¼"><a href="#å¯åŠ¨-registry-å®¹å™¨ï¼Œdocker-run-èµ°èµ·ï¼" class="headerlink" title="å¯åŠ¨ registry å®¹å™¨ï¼Œdocker run èµ°èµ·ï¼"></a>å¯åŠ¨ registry å®¹å™¨ï¼Œdocker run èµ°èµ·ï¼</h4><ul><li><code>-v /var/lib/registry:/var/lib/registry</code> ï¼Œå°†æœ¬åœ°çš„å­˜å‚¨ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…çš„ registry å­˜å‚¨ç›®å½•ä¸‹ã€‚</li><li><code>-v pwd/certs:/certs</code>ï¼Œå°†ç”Ÿæˆçš„ SSL è¯ä¹¦æŒ‚è½½åˆ°å®¹å™¨å†…ã€‚</li><li><code>-e REGISTRY_STORAGE_DELETE_ENABLED=true</code>ï¼Œæ·»åŠ è¯¥å‚æ•°æ‰èƒ½è¿›è¡Œ DELETE é•œåƒæ“ä½œï¼Œä¸ç„¶çš„è¯ä¼šæç¤º <a href="https://github.com/docker/distribution/issues/1573" target="_blank" rel="noopener">Error in deleting repository in a private registry V2 #1573</a> è¿™ç§é”™è¯¯ï¼ˆï¼ï¹ï¼œï¼‰ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 127.0.0.1:443:5000 --name registry \</span><br><span class="line">    -v /var/lib/registry:/var/lib/registry \</span><br><span class="line">    -v `pwd`/certs:/certs \</span><br><span class="line">    -v $(pwd)/auth.htpasswd:/etc/docker/registry/auth.htpasswd \</span><br><span class="line">    -e REGISTRY_AUTH="&#123;htpasswd: &#123;realm: localhost, path: /etc/docker/registry/auth.htpasswd&#125;&#125;" \</span><br><span class="line">    -e REGISTRY_HTTP_ADDR=0.0.0.0:5000 \</span><br><span class="line">    -e REGISTRY_HTTP_TLS_CERTIFICATE=/certs/domain.crt \</span><br><span class="line">    -e REGISTRY_HTTP_TLS_KEY=/certs/domain.key \</span><br><span class="line">    -e REGISTRY_STORAGE_DELETE_ENABLED=true \</span><br><span class="line">    registry</span><br></pre></td></tr></table></figure><h4 id="docker-login"><a href="#docker-login" class="headerlink" title="docker login"></a>docker login</h4><p>è¿™ä¸€æ­¥æ˜¯ä¸ºäº†åœ¨ <code>~/.docker/.config.json</code> ï¼Œä¸­æ·»åŠ ä¸Š auth è®¤è¯ï¼Œåé¢ä½¿ç”¨ skopeo çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~/registry</span><br><span class="line">â•°â”€# docker login localhost -u root -p 123456</span><br><span class="line">]WARNING! Using --password via the CLI is insecure. Use --password-stdin.</span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line">â•­â”€root@sg-02 ~/registry</span><br><span class="line">â•°â”€# cat ~/.docker/config.json</span><br><span class="line">&#123;</span><br><span class="line">        "auths": &#123;</span><br><span class="line">                "https://registry.k8s.li/v2": &#123;</span><br><span class="line">                        "auth": "VlJFpmQE43Sw=="</span><br><span class="line">                &#125;,</span><br><span class="line">                "localhost": &#123;</span><br><span class="line">                        "auth": "cm9vdDoxMjM0NTY="</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "HttpHeaders": &#123;</span><br><span class="line">                "User-Agent": "Docker-Client/19.03.5 (linux)"</span><br><span class="line">        &#125;,</span><br><span class="line">        "experimental": "enabled"</span><br><span class="line">&#125;#</span><br></pre></td></tr></table></figure><h3 id="COPY-é•œåƒåˆ°-registry"><a href="#COPY-é•œåƒåˆ°-registry" class="headerlink" title="COPY é•œåƒåˆ° registry"></a>COPY é•œåƒåˆ° registry</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~/registry</span><br><span class="line">â•°â”€# skopeo copy docker://alpine:3.10 docker://localhost/library/alpine:3.10</span><br><span class="line">Getting image source signatures</span><br><span class="line">Copying blob 21c83c524219 done</span><br><span class="line">Copying config be4e4bea2c done</span><br><span class="line">Writing manifest to image destination</span><br><span class="line">Storing signatures</span><br></pre></td></tr></table></figure><h3 id="registry-å­˜å‚¨ç›®å½•é•¿ä»€ä¹ˆæ ·ğŸ¤”"><a href="#registry-å­˜å‚¨ç›®å½•é•¿ä»€ä¹ˆæ ·ğŸ¤”" class="headerlink" title="registry å­˜å‚¨ç›®å½•é•¿ä»€ä¹ˆæ ·ğŸ¤”"></a>registry å­˜å‚¨ç›®å½•é•¿ä»€ä¹ˆæ ·ğŸ¤”</h3><p><img src="img/registry-storage.jpeg" alt="img"></p><p>registry å®¹å™¨å†…çš„<code>/var/lib/registry/docker/registry/v2</code> å­˜å‚¨ç›®å½•ï¼Œç»“åˆä¸Šé¢è¿™å¼ å›¾ï¼Œé€šè¿‡ tree ç›®å½•æˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ï¼šregistry å­˜å‚¨ç›®å½•ä¸‹åªæœ‰ä¸¤ç§æ–‡ä»¶åçš„æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯ <code>data</code> æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯ <code>link</code> æ–‡ä»¶ã€‚å…¶ä¸­ link æ–‡ä»¶æ˜¯æ™®é€šçš„æ–‡æœ¬æ–‡ä»¶ï¼Œå­˜æ”¾åœ¨ <code>repositories</code> ç›®å½•ä¸‹ï¼Œå…¶å†…å®¹æ˜¯æŒ‡å‘ data æ–‡ä»¶çš„ sha256 digest å€¼ã€‚link æ–‡ä»¶æ˜¯ä¸æ˜¯æœ‰ç‚¹åƒ C è¯­è¨€ä¸­çš„æŒ‡é’ˆğŸ˜‚ï¼ˆå¤§é›¾ã€‚</p><p>data æ–‡ä»¶å­˜æ”¾åœ¨ <code>blobs</code> ç›®å½•ä¸‹æ–‡ä»¶åˆåˆ†ä¸ºäº†ä¸‰ç§æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯é•œåƒæ¯ä¸€å±‚çš„ <code>layer</code> æ–‡ä»¶å’Œé•œåƒçš„ <code>config</code> æ–‡ä»¶ï¼Œä»¥åŠé•œåƒçš„ <code>manifest</code> æ–‡ä»¶ã€‚</p><p>åœ¨ <code>repositories</code> ç›®å½•ä¸‹æ¯ä¸ªé•œåƒçš„ <code>_layers/sha256</code> ç›®å½•ä¸‹çš„æ–‡ä»¶å¤¹åæ˜¯é•œåƒçš„ layer å’Œ config æ–‡ä»¶çš„ digest ï¼Œè¯¥ç›®å½•ä¸‹çš„ link æ–‡ä»¶å°±æ˜¯æŒ‡å‘å¯¹åº” blobs ç›®å½•ä¸‹çš„ data æ–‡ä»¶ã€‚å½“æˆ‘ä»¬ pull ä¸€ä¸ªé•œåƒçš„ layer æ—¶ï¼Œæ˜¯é€šè¿‡ link æ–‡ä»¶æ‰¾åˆ° layer åœ¨ registry ä¸­å®é™…çš„å­˜å‚¨ä½ç½®çš„ã€‚</p><p>åœ¨ <code>_manifests</code> æ–‡ä»¶å¤¹ä¸‹çš„ tags å’Œ revisions ç›®å½•ä¸‹çš„ link æ–‡ä»¶åˆ™æŒ‡å‘è¯¥é•œåƒçš„ manifest æ–‡ä»¶ï¼Œä¿å­˜åœ¨æ‰€æœ‰å†å²é•œåƒ tag çš„ manifest æ–‡ä»¶ çš„ linkã€‚å½“åˆ é™¤ä¸€ä¸ªé•œåƒæ—¶ï¼Œåªä¼šåˆ é™¤è¯¥é•œåƒæœ€æ–°çš„ tag çš„ link æ–‡ä»¶ã€‚</p><p>tags ç›®å½•ä¸‹çš„æ–‡ä»¶å¤¹åä¾‹å¦‚ 3.10 ï¼Œå°±æ˜¯è¯¥é•œåƒçš„ tag ï¼Œåœ¨å®ƒçš„å­ç›®å½•ä¸‹çš„ current/link æ–‡ä»¶åˆ™è®°å½•äº†å½“å‰ tag æŒ‡å‘çš„ manifest æ–‡ä»¶çš„ä½ç½®ã€‚æ¯”å¦‚æˆ‘ä»¬çš„ alpine:latest é•œåƒï¼Œæ¯æ¬¡ push æ–°çš„ latest é•œåƒæ—¶ï¼Œcurrent/link éƒ½ä¼šæ›´æ–°æˆæŒ‡å‘æœ€æ–°é•œåƒçš„ manifest æ–‡ä»¶ã€‚</p><p>æˆ‘ä»¬åé¢è§‚å¯Ÿä¸€ä¸‹å½“åˆ é™¤ä¸€ä¸ªé•œåƒæ—¶ï¼Œè¿™äº›æ–‡ä»¶æ˜¯æ€ä¹ˆå˜åŒ–çš„ï¼Œå°±å¯ä»¥å¾—çŸ¥é€šè¿‡ registry API è¿›è¡Œ DELETE æ“ä½œå¯ä»¥è½¬æ¢æˆæ–‡ä»¶ç³»ç»Ÿå±‚é¢ä¸Šå¯¹ link æ–‡ä»¶çš„åˆ é™¤æ“ä½œã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~/registry</span><br><span class="line">â•°â”€# cd /var/lib/registry/docker/registry/v2</span><br><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ blobs</span><br><span class="line">â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 21</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ a1</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â””â”€â”€ be</span><br><span class="line">â”‚Â Â          â””â”€â”€ be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">â”‚Â Â              â””â”€â”€ data</span><br><span class="line">â””â”€â”€ repositories</span><br><span class="line">    â””â”€â”€ library</span><br><span class="line">        â””â”€â”€ alpine</span><br><span class="line">            â”œâ”€â”€ _layers</span><br><span class="line">            â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">            â”‚Â Â      â”œâ”€â”€ 21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â””â”€â”€ link</span><br><span class="line">            â”‚Â Â      â””â”€â”€ be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">            â”‚Â Â          â””â”€â”€ link</span><br><span class="line">            â”œâ”€â”€ _manifests</span><br><span class="line">            â”‚Â Â  â”œâ”€â”€ revisions</span><br><span class="line">            â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">            â”‚Â Â  â”‚Â Â      â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">            â”‚Â Â  â”‚Â Â          â””â”€â”€ link</span><br><span class="line">            â”‚Â Â  â””â”€â”€ tags</span><br><span class="line">            â”‚Â Â      â””â”€â”€ 3.10</span><br><span class="line">            â”‚Â Â          â”œâ”€â”€ current</span><br><span class="line">            â”‚Â Â          â”‚Â Â  â””â”€â”€ link</span><br><span class="line">            â”‚Â Â          â””â”€â”€ index</span><br><span class="line">            â”‚Â Â              â””â”€â”€ sha256</span><br><span class="line">            â”‚Â Â                  â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">            â”‚Â Â                      â””â”€â”€ link</span><br><span class="line">            â””â”€â”€ _uploads</span><br><span class="line"></span><br><span class="line">26 directories, 8 files</span><br></pre></td></tr></table></figure><ul><li><code>blobs</code> å­˜å‚¨ç›®å½•ï¼Œå­˜æ”¾äº†é•œåƒçš„ä¸‰ä¸ªå¿…é¡»æ–‡ä»¶ï¼Œ<code>layer</code>ï¼Œ<code>manifest</code>ï¼Œ<code>config</code>ã€‚é€šè¿‡æ–‡ä»¶å¤§å°æˆ‘ä»¬å¯ä»¥å¤§è‡´åœ°æ¨ç®—å‡ºæœ€å¤§çš„ 2.7M æ˜¯é•œåƒçš„ layer ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# find . -name "data" -exec ls -sh &#123;&#125; \;</span><br><span class="line">2.7M ./blobs/sha256/21/21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d/data</span><br><span class="line">4.0K ./blobs/sha256/a1/a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590/data</span><br><span class="line">4.0K ./blobs/sha256/be/be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c/data</span><br></pre></td></tr></table></figure><ul><li><code>image layer</code> æ–‡ä»¶ï¼Œæ˜¯ gzip æ ¼å¼çš„ tar åŒ…ï¼Œæ˜¯é•œåƒå±‚çœŸå®å†…å®¹çš„ <code>tar.gzip</code> æ ¼å¼å­˜å‚¨å½¢å¼ã€‚</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./blobs/sha256/21/21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d/data: gzip compressed data</span><br></pre></td></tr></table></figure><ul><li><code>image manifest</code> æ–‡ä»¶ï¼Œjson æ–‡ä»¶æ ¼å¼çš„ï¼Œå­˜æ”¾è¯¥é•œåƒ <code>layer</code> å’Œ  <code>image config</code> æ–‡ä»¶çš„ç´¢å¼•ã€‚</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# cat ./blobs/sha256/a1/a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590/data</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">   <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.container.image.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">1509</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">2795580</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;#</span><br></pre></td></tr></table></figure><ul><li><code>image config</code> æ–‡ä»¶ï¼Œjson æ ¼å¼çš„ã€‚æ˜¯æ„å»ºæ—¶ç”Ÿæˆçš„ï¼Œæ ¹æ® <code>Dockerfile</code> å’Œå®¿ä¸»æœºçš„ä¸€äº›ä¿¡æ¯ï¼Œä»¥åŠä¸€äº›æ„å»ºè¿‡ç¨‹ä¸­çš„å®¹å™¨å¯ä»¥ç”Ÿæˆ digest å”¯ä¸€çš„ <code>image config</code> æ–‡ä»¶ã€‚ä»”ç»†çœ‹è¿™ä¸ª image config æ–‡ä»¶æ˜¯ä¸æ˜¯æœ‰ç‚¹ç–‘æƒ‘ï¼Œæ— è®ºæ˜¯ manifest è¿˜æ˜¯ config æ–‡ä»¶é‡Œé¢çš„å†…å®¹å‹æ ¹å°±æ²¡æœ‰é•œåƒçš„åç§°å’Œ tag ã€‚å…¶å®ï¼Œé•œåƒå°±å¥½æ¯”ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶çš„å†…å®¹å’Œæ–‡ä»¶åæ¯«æ— å…³ç³»ã€‚åœ¨ registry ä¸­ï¼Œæ˜¯é€šè¿‡è·¯å¾„åçš„æ–¹å¼æ¥å¯¹ä¸€ä¸ªé•œåƒè¿›è¡Œå‘½åçš„ã€‚å½“æˆ‘ä»¬å¾€ registry ä¸­ PUSH ä¸€ä¸ªé•œåƒæ—¶ï¼Œä»¥<code>localhost/library/alpine:3.10</code>ä¸ºä¾‹ï¼Œ<code>localhost</code>ï¼Œå°±æ˜¯è¯¥ registry çš„åŸŸåæˆ–è€… URL ï¼Œ<code>library</code>å°±æ˜¯ project ï¼Œ<code>alpine:3.10</code>å°±æ˜¯é•œåƒåå’Œé•œåƒçš„ tagã€‚registry ä¼šæ ¹æ® <code>localhost/library/alpine:3.10</code> åœ¨<code>repositories</code> ç›®å½•ä¸‹ä¾æ¬¡åˆ›å»ºç›¸åº”çš„ç›®å½•ã€‚</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# cat ./blobs/sha256/be/be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c/data | jq "."</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">  <span class="attr">"config"</span>: &#123;</span><br><span class="line">    <span class="attr">"Hostname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"User"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"/bin/sh"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"ArgsEscaped"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"Image"</span>: <span class="string">"sha256:d928e20e1fbe5142bb5cdf594862271673133c5354950d6a8f74afed24df4c23"</span>,</span><br><span class="line">    <span class="attr">"Volumes"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Entrypoint"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OnBuild"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"Labels"</span>: <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"container"</span>: <span class="string">"37e3972c75360676982c8f6591b66a9097719e5ad4cecd5fa63ad4f06472825f"</span>,</span><br><span class="line">  <span class="attr">"container_config"</span>: &#123;</span><br><span class="line">    <span class="attr">"Hostname"</span>: <span class="string">"37e3972c7536"</span>,</span><br><span class="line">    <span class="attr">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"User"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"/bin/sh"</span>,</span><br><span class="line">      <span class="string">"-c"</span>,</span><br><span class="line">      <span class="string">"#(nop) "</span>,</span><br><span class="line">      <span class="string">"CMD [\"/bin/sh\"]"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"ArgsEscaped"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"Image"</span>: <span class="string">"sha256:d928e20e1fbe5142bb5cdf594862271673133c5354950d6a8f74afed24df4c23"</span>,</span><br><span class="line">    <span class="attr">"Volumes"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Entrypoint"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OnBuild"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"Labels"</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"created"</span>: <span class="string">"2020-04-24T01:05:21.571691552Z"</span>,</span><br><span class="line">  <span class="attr">"docker_version"</span>: <span class="string">"18.09.7"</span>,</span><br><span class="line">  <span class="attr">"history"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-04-24T01:05:21.178437685Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop) ADD file:66a440394c2442570f1f060e25c86613cb2d88a8af0c71c5a4154b3570e9a805 in / "</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-04-24T01:05:21.571691552Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop)  CMD [\"/bin/sh\"]"</span>,</span><br><span class="line">      <span class="attr">"empty_layer"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">  <span class="attr">"rootfs"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"layers"</span>,</span><br><span class="line">    <span class="attr">"diff_ids"</span>: [</span><br><span class="line">      <span class="string">"sha256:1b3ee35aacca9866b01dd96e870136266bde18006ac2f0d6eb706c798d1fa3c3"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æˆ‘ä»¬å†å¾€ registry ä¸­ COPY ä¸€ä¸ªé•œåƒï¼Œæ–¹ä¾¿åé¢çš„åˆ†æè¿‡ç¨‹ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">skopeo copy docker://debian:buster-slim docker://localhost/library/debian:buster-slim</span><br></pre></td></tr></table></figure><ul><li>è¿™æ˜¯ registry ä¸­å°±åªæœ‰ <code>alpine:3.10</code> å’Œ <code>debian:buster-slim</code>è¿™ä¸¤ä¸ªåŸºç¡€é•œåƒï¼Œæ­¤æ—¶çš„ registry å­˜å‚¨ç›®å½•çš„ç»“æ„å¦‚ä¸‹ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ blobs</span><br><span class="line">â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 21</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 43</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 43e3995ee54ac008271bfcf2d8ac7278c33f4c5e83d2f02bfcddd350034e3357</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 7c</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 7c459309b9a5ec1683ef3b137f39ce5888f5ad0384e488ad73c94e0243bc77d4</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 85</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 8559a31e96f442f2c7b6da49d6c84705f98a39d8be10b3f5f14821d0ee8417df</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ a1</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â””â”€â”€ be</span><br><span class="line">â”‚Â Â          â””â”€â”€ be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">â”‚Â Â              â””â”€â”€ data</span><br><span class="line">â””â”€â”€ repositories</span><br><span class="line">    â””â”€â”€ library</span><br><span class="line">        â”œâ”€â”€ alpine</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ _layers</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â”‚Â Â  â””â”€â”€ link</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â””â”€â”€ be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">        â”‚Â Â  â”‚Â Â          â””â”€â”€ link</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ _manifests</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”œâ”€â”€ revisions</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”‚Â Â      â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”‚Â Â          â””â”€â”€ link</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â””â”€â”€ tags</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â””â”€â”€ 3.10</span><br><span class="line">        â”‚Â Â  â”‚Â Â          â”œâ”€â”€ current</span><br><span class="line">        â”‚Â Â  â”‚Â Â          â”‚Â Â  â””â”€â”€ link</span><br><span class="line">        â”‚Â Â  â”‚Â Â          â””â”€â”€ index</span><br><span class="line">        â”‚Â Â  â”‚Â Â              â””â”€â”€ sha256</span><br><span class="line">        â”‚Â Â  â”‚Â Â                  â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">        â”‚Â Â  â”‚Â Â                      â””â”€â”€ link</span><br><span class="line">        â”‚Â Â  â””â”€â”€ _uploads</span><br><span class="line">        â””â”€â”€ debian</span><br><span class="line">            â”œâ”€â”€ _layers</span><br><span class="line">            â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">            â”‚Â Â      â”œâ”€â”€ 43e3995ee54ac008271bfcf2d8ac7278c33f4c5e83d2f02bfcddd350034e3357</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â””â”€â”€ link</span><br><span class="line">            â”‚Â Â      â””â”€â”€ 8559a31e96f442f2c7b6da49d6c84705f98a39d8be10b3f5f14821d0ee8417df</span><br><span class="line">            â”‚Â Â          â””â”€â”€ link</span><br><span class="line">            â”œâ”€â”€ _manifests</span><br><span class="line">            â”‚Â Â  â”œâ”€â”€ revisions</span><br><span class="line">            â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">            â”‚Â Â  â”‚Â Â      â””â”€â”€ 7c459309b9a5ec1683ef3b137f39ce5888f5ad0384e488ad73c94e0243bc77d4</span><br><span class="line">            â”‚Â Â  â”‚Â Â          â””â”€â”€ link</span><br><span class="line">            â”‚Â Â  â””â”€â”€ tags</span><br><span class="line">            â”‚Â Â      â””â”€â”€ buster-slim</span><br><span class="line">            â”‚Â Â          â”œâ”€â”€ current</span><br><span class="line">            â”‚Â Â          â”‚Â Â  â””â”€â”€ link</span><br><span class="line">            â”‚Â Â          â””â”€â”€ index</span><br><span class="line">            â”‚Â Â              â””â”€â”€ sha256</span><br><span class="line">            â”‚Â Â                  â””â”€â”€ 7c459309b9a5ec1683ef3b137f39ce5888f5ad0384e488ad73c94e0243bc77d4</span><br><span class="line">            â”‚Â Â                      â””â”€â”€ link</span><br><span class="line">            â””â”€â”€ _uploads</span><br><span class="line"></span><br><span class="line">48 directories, 16 files</span><br></pre></td></tr></table></figure><h3 id="DELETE-é•œåƒ"><a href="#DELETE-é•œåƒ" class="headerlink" title="DELETE é•œåƒ"></a>DELETE é•œåƒ</h3><ul><li>é€šè¿‡ <code>skopeo delete</code> åˆ é™¤é•œåƒï¼Œæ³¨æ„ï¼Œé€šè¿‡ registry çš„ API åˆ é™¤é•œåƒæ¯æ¬¡åªèƒ½åˆ é™¤ä¸€ä¸ª tag çš„é•œåƒã€‚</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# skopeo delete docker://localhost/library/alpine:3.10 --debug</span><br><span class="line">DEBU[0000] Returning credentials from /run/containers/0/auth.json</span><br><span class="line">DEBU[0000] Using registries.d directory /etc/containers/registries.d for sigstore configuration</span><br><span class="line">DEBU[0000]  No signature storage configuration found for localhost/library/alpine:3.10</span><br><span class="line">DEBU[0000] Looking for TLS certificates and private keys in /etc/docker/certs.d/localhost</span><br><span class="line">DEBU[0000] Loading registries configuration "/etc/containers/registries.conf"</span><br><span class="line">DEBU[0000] GET https://localhost/v2/</span><br><span class="line">DEBU[0000] Ping https://localhost/v2/ status 401</span><br><span class="line">DEBU[0000] GET https://localhost/v2/library/alpine/manifests/3.10</span><br><span class="line">DEBU[0000] DELETE https://localhost/v2/library/alpine/manifests/sha256:a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br></pre></td></tr></table></figure><ul><li>å†çœ‹ä¸€ä¸‹åˆ é™¤åçš„ registry å­˜å‚¨ç›®å½•ä¸‹çš„ alpine ç›®å½•é‡Œéƒ½å°‘äº†å“ªäº›ä¸œä¸œï¼Ÿ</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ blobs</span><br><span class="line">â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 21</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 43</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 43e3995ee54ac008271bfcf2d8ac7278c33f4c5e83d2f02bfcddd350034e3357</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 7c</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 7c459309b9a5ec1683ef3b137f39ce5888f5ad0384e488ad73c94e0243bc77d4</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 85</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 8559a31e96f442f2c7b6da49d6c84705f98a39d8be10b3f5f14821d0ee8417df</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ a1</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â””â”€â”€ be</span><br><span class="line">â”‚Â Â          â””â”€â”€ be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">â”‚Â Â              â””â”€â”€ data</span><br><span class="line">â””â”€â”€ repositories</span><br><span class="line">    â””â”€â”€ library</span><br><span class="line">        â”œâ”€â”€ alpine</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ _layers</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â”‚Â Â  â””â”€â”€ link</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â””â”€â”€ be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">        â”‚Â Â  â”‚Â Â          â””â”€â”€ link</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ _manifests</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”œâ”€â”€ revisions</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”‚Â Â      â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â””â”€â”€ tags</span><br><span class="line">        â”‚Â Â  â””â”€â”€ _uploads</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ skopeo delete ä¸€ä¸ªé•œåƒçš„æ—¶å€™ï¼Œåªå¯¹ <code>_manifests</code> ä¸‹çš„ link æ–‡ä»¶è¿›è¡Œäº†æ“ä½œï¼Œåˆ é™¤çš„éƒ½æ˜¯å¯¹è¯¥ tag é•œåƒ manifest æ–‡ä»¶å¤¹ä¸‹çš„ link æ–‡ä»¶ï¼Œå®é™…ä¸Š manifest æ–‡ä»¶å¹¶æ²¡æœ‰ä» blobs ç›®å½•ä¸‹åˆ é™¤ï¼Œåªæ˜¯åˆ é™¤äº†è¯¥é•œåƒçš„ manifest æ–‡ä»¶çš„å¼•ç”¨ã€‚åˆ é™¤ä¸€ä¸ªé•œåƒåï¼Œtags ç›®å½•ä¸‹çš„ tag åç›®å½•å°±è¢«åˆ é™¤äº†ï¼Œ_manifests/revisions ç›®å½•ä¸‹çš„ link æ–‡ä»¶ä¹Ÿè¢«åˆ é™¤äº†ã€‚å®é™…ä¸Šä¸¤è€…åˆ é™¤çš„æ˜¯åŒä¸€ä¸ªå†…å®¹ï¼Œå³å¯¹è¯¥é•œåƒ manifest æ–‡ä»¶çš„ link æ–‡ä»¶ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DEBU[0000] DELETE https://localhost/v2/library/alpine/manifests/sha256:a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢æ–‡ä»¶çš„å˜åŒ–å¯ä»¥å¾—å‡ºï¼Œé€šè¿‡ registry API æ¥ DELETE ä¸€ä¸ªé•œåƒå®è´¨ä¸Šæ˜¯åˆ é™¤ repositories å…ƒæ•°æ®æ–‡ä»¶å¤¹ä¸‹çš„ tag åæ–‡ä»¶å¤¹å’Œè¯¥ tag çš„ revisions ä¸‹çš„ link æ–‡ä»¶ã€‚</p><h2 id="registry-GC-åŸç†"><a href="#registry-GC-åŸç†" class="headerlink" title="registry GC åŸç†"></a>registry GC åŸç†</h2><p>ä¸Šé¢å·´æ‹‰å·´æ‹‰æ‰¯äº†ä¸€é€šä¹Ÿè®¸ä½ ç°åœ¨ä¸€å¤´é›¾æ°´ï¼Œè¿™å’Œä»Šå¤©çš„ä¸»é¢˜ registry GC åŸç†æ¯›å…³ç³»ï¼ŸğŸ˜‚ï¼Œå…¶å®æƒ³è¦ä»æ–‡ä»¶ç³»ç»Ÿå±‚é¢æ¥ç†è§£ registry GC ï¼Œä¸Šé¢çš„çŸ¥è¯†æ˜¯å¿…å¤‡çš„ï¼ˆ<em>^____^</em>ï¼‰ã€‚</p><h3 id="GC-æ˜¯å¼„å•¥å’§ï¼ŸğŸ¤”"><a href="#GC-æ˜¯å¼„å•¥å’§ï¼ŸğŸ¤”" class="headerlink" title="GC æ˜¯å¼„å•¥å’§ï¼ŸğŸ¤”"></a>GC æ˜¯å¼„å•¥å’§ï¼ŸğŸ¤”</h3><p>GC å˜›ï¼Œå°±æ˜¯åƒåœ¾å›æ”¶çš„æ„æ€ï¼Œä» docker å®˜æ–¹æ–‡æ¡£ <a href="https://docs.docker.com/registry/garbage-collection/" target="_blank" rel="noopener">Garbage collection</a> å·æ¥çš„ example ğŸ˜‚æ¥è§£é‡Šä¸€ä¸‹å§ã€‚</p><ul><li>å‡å¦‚é•œåƒ A å’Œé•œåƒ B ï¼Œä»–ä¿©åˆ†åˆ«å¼•ç”¨äº†layer aï¼Œbå’Œ aï¼Œcã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A -----&gt; a &lt;----- B</span><br><span class="line">    \--&gt; b     |</span><br><span class="line">         c &lt;--&#x2F;</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡ registry API åˆ é™¤é•œåƒ B ä¹‹åï¼Œlayer c å¹¶æ²¡æœ‰åˆ æ‰ï¼Œåªæ˜¯åˆ æ‰äº†å¯¹å®ƒçš„å¼•ç”¨ï¼Œæ‰€ä»¥ c æ˜¯å¤šä½™çš„ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A -----&gt; a     B</span><br><span class="line">    \--&gt; b</span><br><span class="line">         c</span><br></pre></td></tr></table></figure><ul><li>GC ä¹‹åï¼Œlayer c å°±è¢«åˆ æ‰äº†ï¼Œç°åœ¨å°±æ²¡æœ‰æ— ç”¨çš„ layer äº†ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A -----&gt; a</span><br><span class="line">    \--&gt; b</span><br></pre></td></tr></table></figure><h3 id="GC-çš„è¿‡ç¨‹"><a href="#GC-çš„è¿‡ç¨‹" class="headerlink" title="GC çš„è¿‡ç¨‹"></a>GC çš„è¿‡ç¨‹</h3><p>ç¿»ä¸€ä¸‹ registry  GC çš„æºç  <a href="https://github.com/docker/distribution/blob/master/registry/storage/garbagecollect.go" target="_blank" rel="noopener">garbagecollect.go</a>ï¼Œå¯ä»¥çœ‹åˆ° GC çš„ä¸»è¦åˆ†ä¸¤ä¸ªé˜¶æ®µï¼Œmarking å’Œ sweepã€‚</p><h4 id="marking"><a href="#marking" class="headerlink" title="marking"></a>marking</h4><p>marking é˜¶æ®µæ˜¯æ‰«ææ‰€æœ‰çš„ manifest æ–‡ä»¶ï¼Œæ ¹æ®ä¸Šæ–‡æˆ‘ä»¬æåˆ°çš„ link æ–‡ä»¶ï¼Œé€šè¿‡æ‰«ææ‰€æœ‰é•œåƒ tags ç›®å½•ä¸‹çš„ link æ–‡ä»¶å°±å¯ä»¥å¾—åˆ°è¿™äº›é•œåƒçš„ manifestï¼Œåœ¨ manifest ä¸­ä¿å­˜åœ¨è¯¥é•œåƒæ‰€æœ‰çš„ layer å’Œ config æ–‡ä»¶çš„ digest å€¼ï¼ŒæŠŠè¿™äº›å€¼æ ‡è®°ä¸º<strong>ä¸èƒ½æ¸…é™¤</strong>ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mark</span></span><br><span class="line">markSet := <span class="built_in">make</span>(<span class="keyword">map</span>[digest.Digest]<span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">manifestArr := <span class="built_in">make</span>([]ManifestDel, <span class="number">0</span>)</span><br><span class="line">err := repositoryEnumerator.Enumerate(ctx, <span class="function"><span class="keyword">func</span><span class="params">(repoName <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">emit(repoName)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> err error</span><br><span class="line">named, err := reference.WithName(repoName)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">"failed to parse repo name %s: %v"</span>, repoName, err)</span><br><span class="line">&#125;</span><br><span class="line">repository, err := registry.Repository(ctx, named)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">"failed to construct repository: %v"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">manifestService, err := repository.Manifests(ctx)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">"failed to construct manifest service: %v"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">manifestEnumerator, ok := manifestService.(distribution.ManifestEnumerator)</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">"unable to convert ManifestService into ManifestEnumerator"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€é˜¶æ®µç”¨ shell è„šæœ¬æ¥å®ç°çš„è¯å¤§è‡´å¯ä»¥è¿™æ ·æ¥æï¼Œä½¿ç”¨ shell å»éå†è¿™äº› manifest ï¼Œç„¶åå† grep å‡ºæ‰€æœ‰çš„ sha256 å€¼å°±èƒ½å¾—åˆ°è¿™ä¸ªé•œåƒæ‰€æœ‰çš„ blobs ç›®å½•ä¸‹çš„ data æ–‡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">set -x</span><br><span class="line">v2=$&#123;v2:="/var/lib/registry/docker/registry/v2"&#125;</span><br><span class="line">cd $&#123;v2&#125;</span><br><span class="line">all_blobs=/tmp/all_blobs.list</span><br><span class="line">echo "" &gt; $&#123;all_blobs&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> marking all the blob by all images manifest</span></span><br><span class="line">for tag in $(find repositories -name "link" | grep current)</span><br><span class="line">do</span><br><span class="line">    link=$(cat $&#123;tag&#125; | cut -c8-71)</span><br><span class="line">    mfs=blobs/sha256/$&#123;link:0:2&#125;/$&#123;link&#125;/data</span><br><span class="line">    echo $&#123;link&#125; &gt;&gt; $&#123;all_blobs&#125;</span><br><span class="line">    grep sha256 $&#123;mfs&#125; |cut -d "\"" -f4 | cut -c8-71 &gt;&gt; $&#123;all_blobs&#125;</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h4 id="sweep"><a href="#sweep" class="headerlink" title="sweep"></a>sweep</h4><p>ç¬¬äºŒé˜¶æ®µå°±æ˜¯åˆ é™¤æ“ä½œå•¦ï¼Œmarking å®Œä¹‹åï¼Œæ²¡æœ‰æ ‡è®° blobï¼ˆ layer å’Œ config æ–‡ä»¶ï¼‰å°±ä¼šè¢«æ¸…é™¤æ‰ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sweep</span></span><br><span class="line">vacuum := NewVacuum(ctx, storageDriver)</span><br><span class="line"><span class="keyword">if</span> !opts.DryRun &#123;</span><br><span class="line"><span class="keyword">for</span> _, obj := <span class="keyword">range</span> manifestArr &#123;</span><br><span class="line">err = vacuum.RemoveManifest(obj.Name, obj.Digest, obj.Tags)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">"failed to delete manifest %s: %v"</span>, obj.Digest, err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">blobService := registry.Blobs()</span><br><span class="line">deleteSet := <span class="built_in">make</span>(<span class="keyword">map</span>[digest.Digest]<span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">err = blobService.Enumerate(ctx, <span class="function"><span class="keyword">func</span><span class="params">(dgst digest.Digest)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="comment">// check if digest is in markSet. If not, delete it!</span></span><br><span class="line"><span class="keyword">if</span> _, ok := markSet[dgst]; !ok &#123;</span><br><span class="line">deleteSet[dgst] = <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="img/registry-gc.png" alt=""></p><h3 id="GC-éƒ½å¹²äº†å•¥ï¼Ÿ"><a href="#GC-éƒ½å¹²äº†å•¥ï¼Ÿ" class="headerlink" title="GC éƒ½å¹²äº†å•¥ï¼Ÿ"></a>GC éƒ½å¹²äº†å•¥ï¼Ÿ</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¿›è¡Œå®é™…çš„ GC æ“ä½œï¼Œè¿›å…¥åˆ° registry å®¹å™¨ä¸­ï¼Œä½¿ç”¨ registry garbage-collect è¿™ä¸ªå­å‘½ä»¤è¿›è¡Œæ“ä½œã€‚</p><h4 id="marking-1"><a href="#marking-1" class="headerlink" title="marking"></a>marking</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-<span class="number">02</span> /<span class="keyword">var</span>/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# docker exec -it registry sh</span><br><span class="line">/ # registry garbage-collect -m --delete-untagged=true /etc/docker/registry/<span class="keyword">config</span><span class="variable">.yml</span></span><br><span class="line"><span class="keyword">library</span>/alpine</span><br><span class="line"><span class="keyword">library</span>/debian</span><br><span class="line"><span class="keyword">library</span>/debian: marking manifest sha256:<span class="number">7</span>c459309b9a5ec1683ef3b137f39ce5888f5ad0384e488ad73c94e0243bc77d4</span><br><span class="line"><span class="keyword">library</span>/debian: marking blob sha256:<span class="number">43</span>e3995ee54ac008271bfcf2d8ac7278c33f4c5e83d2f02bfcddd350034e3357</span><br><span class="line"><span class="keyword">library</span>/debian: marking blob sha256:<span class="number">8559</span>a31e96f442f2c7b6da49d6c84705f98a39d8be10b3f5f14821d0ee8417df</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> blobs marked, <span class="number">3</span> blobs <span class="keyword">and</span> <span class="number">0</span> manifests eligible <span class="keyword">for</span> deletion</span><br></pre></td></tr></table></figure><h4 id="sweep-1"><a href="#sweep-1" class="headerlink" title="sweep"></a>sweep</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">blob eligible for deletion: sha256:a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">INFO[0000] Deleting blob: &#x2F;docker&#x2F;registry&#x2F;v2&#x2F;blobs&#x2F;sha256&#x2F;a1&#x2F;a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590  go.version&#x3D;go1.11.2 instance.id&#x3D;3ad15352-7cb7-46ca-a5ae-e5e16c6485a5 service&#x3D;registry</span><br><span class="line">blob eligible for deletion: sha256:be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">INFO[0000] Deleting blob: &#x2F;docker&#x2F;registry&#x2F;v2&#x2F;blobs&#x2F;sha256&#x2F;be&#x2F;be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c  go.version&#x3D;go1.11.2 instance.id&#x3D;3ad15352-7cb7-46ca-a5ae-e5e16c6485a5 service&#x3D;registry</span><br><span class="line">blob eligible for deletion: sha256:21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">INFO[0000] Deleting blob: &#x2F;docker&#x2F;registry&#x2F;v2&#x2F;blobs&#x2F;sha256&#x2F;21&#x2F;21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d  go.version&#x3D;go1.11.2 instance.id&#x3D;3ad15352-7cb7-46ca-a5ae-e5e16c6485a5 service&#x3D;registry</span><br></pre></td></tr></table></figure><h4 id="GC-ä¹‹åçš„-registry-å­˜å‚¨ç›®å½•é•¿ä»€ä¹ˆæ ·ï¼Ÿ"><a href="#GC-ä¹‹åçš„-registry-å­˜å‚¨ç›®å½•é•¿ä»€ä¹ˆæ ·ï¼Ÿ" class="headerlink" title="GC ä¹‹åçš„ registry å­˜å‚¨ç›®å½•é•¿ä»€ä¹ˆæ ·ï¼Ÿ"></a>GC ä¹‹åçš„ registry å­˜å‚¨ç›®å½•é•¿ä»€ä¹ˆæ ·ï¼Ÿ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# tree                                                                                     </span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ blobs</span><br><span class="line">â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 21</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 43</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 43e3995ee54ac008271bfcf2d8ac7278c33f4c5e83d2f02bfcddd350034e3357</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 7c</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 7c459309b9a5ec1683ef3b137f39ce5888f5ad0384e488ad73c94e0243bc77d4</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 85</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 8559a31e96f442f2c7b6da49d6c84705f98a39d8be10b3f5f14821d0ee8417df</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ a1</span><br><span class="line">â”‚Â Â      â””â”€â”€ be</span><br><span class="line">â””â”€â”€ repositories</span><br><span class="line">    â””â”€â”€ library</span><br><span class="line">        â”œâ”€â”€ alpine</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ _layers</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â”‚Â Â  â””â”€â”€ link</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â””â”€â”€ be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">        â”‚Â Â  â”‚Â Â          â””â”€â”€ link</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ _manifests</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”œâ”€â”€ revisions</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”‚Â Â      â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â””â”€â”€ tags</span><br><span class="line">        â”‚Â Â  â””â”€â”€ _uploads</span><br><span class="line">        â””â”€â”€ debian</span><br><span class="line">            â”œâ”€â”€ _layers</span><br><span class="line">            â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">            â”‚Â Â      â”œâ”€â”€ 43e3995ee54ac008271bfcf2d8ac7278c33f4c5e83d2f02bfcddd350034e3357</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â””â”€â”€ link</span><br><span class="line">            â”‚Â Â      â””â”€â”€ 8559a31e96f442f2c7b6da49d6c84705f98a39d8be10b3f5f14821d0ee8417df</span><br><span class="line">            â”‚Â Â          â””â”€â”€ link</span><br><span class="line">            â”œâ”€â”€ _manifests</span><br><span class="line">            â”‚Â Â  â”œâ”€â”€ revisions</span><br><span class="line">            â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">            â”‚Â Â  â”‚Â Â      â””â”€â”€ 7c459309b9a5ec1683ef3b137f39ce5888f5ad0384e488ad73c94e0243bc77d4</span><br><span class="line">            â”‚Â Â  â”‚Â Â          â””â”€â”€ link</span><br><span class="line">            â”‚Â Â  â””â”€â”€ tags</span><br><span class="line">            â”‚Â Â      â””â”€â”€ buster-slim</span><br><span class="line">            â”‚Â Â          â”œâ”€â”€ current</span><br><span class="line">            â”‚Â Â          â”‚Â Â  â””â”€â”€ link</span><br><span class="line">            â”‚Â Â          â””â”€â”€ index</span><br><span class="line">            â”‚Â Â              â””â”€â”€ sha256</span><br><span class="line">            â”‚Â Â                  â””â”€â”€ 7c459309b9a5ec1683ef3b137f39ce5888f5ad0384e488ad73c94e0243bc77d4</span><br><span class="line">            â”‚Â Â                      â””â”€â”€ link</span><br><span class="line">            â””â”€â”€ _uploads</span><br><span class="line"></span><br><span class="line">40 directories, 10 files</span><br></pre></td></tr></table></figure><p>æ ¹æ® GC åçš„ registry å­˜å‚¨ç›®å½•æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒåŸæœ¬ blobs ç›®å½•ä¸‹æœ‰ 6 ä¸ª data æ–‡ä»¶ï¼Œç°åœ¨å·²ç»å˜æˆäº† 3 ä¸ªï¼Œalpine:3.10 è¿™ä¸ªé•œåƒç›¸å…³çš„ layerã€configã€manifest è¿™ä¸‰ä¸ªæ–‡ä»¶éƒ½å·²ç»è¢« GC æ‰äº†ã€‚ä½†æ˜¯åœ¨ repositories ç›®å½•ä¸‹ï¼Œè¯¥é•œåƒçš„ _layers ä¸‹çš„ link æ–‡ä»¶ä¾æ—§å­˜åœ¨ğŸ¤”ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ€»ç»“ä»¥ä¸Šï¼Œç”¨ä¸‹é¢è¿™ä¸‰å¼ å›¾ç‰‡å°±èƒ½ç›´è§‚åœ°ç†è§£è¿™äº›è¿‡ç¨‹å•¦ã€‚</p><h4 id="delete-é•œåƒä¹‹å‰çš„-registry-å­˜å‚¨ç›®å½•ç»“æ„"><a href="#delete-é•œåƒä¹‹å‰çš„-registry-å­˜å‚¨ç›®å½•ç»“æ„" class="headerlink" title="delete é•œåƒä¹‹å‰çš„ registry å­˜å‚¨ç›®å½•ç»“æ„"></a>delete é•œåƒä¹‹å‰çš„ registry å­˜å‚¨ç›®å½•ç»“æ„</h4><p><img src="img/registry-gc-1.jpeg" alt="REGISTRY"></p><h4 id="delete-é•œåƒä¹‹åçš„-registry-å­˜å‚¨ç›®å½•ç»“æ„"><a href="#delete-é•œåƒä¹‹åçš„-registry-å­˜å‚¨ç›®å½•ç»“æ„" class="headerlink" title="delete é•œåƒä¹‹åçš„ registry å­˜å‚¨ç›®å½•ç»“æ„"></a>delete é•œåƒä¹‹åçš„ registry å­˜å‚¨ç›®å½•ç»“æ„</h4><p><img src="img/registry-gc-2.jpeg" alt=""></p><h4 id="GC-ä¹‹åçš„-registry-å­˜å‚¨ç›®å½•ç»“æ„"><a href="#GC-ä¹‹åçš„-registry-å­˜å‚¨ç›®å½•ç»“æ„" class="headerlink" title="GC ä¹‹åçš„ registry å­˜å‚¨ç›®å½•ç»“æ„"></a>GC ä¹‹åçš„ registry å­˜å‚¨ç›®å½•ç»“æ„</h4><p><img src="img/registry-gc-3.jpeg" alt=""></p><h3 id="shell-å¤§æ³•å¥½ï¼"><a href="#shell-å¤§æ³•å¥½ï¼" class="headerlink" title="shell å¤§æ³•å¥½ï¼"></a>shell å¤§æ³•å¥½ï¼</h3><p>æ ¹æ®ä¸Šé¢çš„ GC åŸç†å’Œè¿‡ç¨‹ï¼Œå®é™…ä¸Šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸åˆ° 25 è¡Œçš„ shell è„šæœ¬æ¥å®ç°ä¸€ä¸ªç²—æš´çš„  GC ğŸ˜‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">set -x</span><br><span class="line">v2=$1</span><br><span class="line">v2=$&#123;v2:="/var/lib/registry/docker/registry/v2"&#125;</span><br><span class="line">cd $&#123;v2&#125;</span><br><span class="line">all_blobs=/tmp/all_blobs.list</span><br><span class="line">: &gt; $&#123;all_blobs&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> marking all the blob by all images manifest</span></span><br><span class="line">for tag in $(find repositories -name "link" | grep current)</span><br><span class="line">do</span><br><span class="line">    link=$(cat $&#123;tag&#125; | cut -c8-71)</span><br><span class="line">    mfs=blobs/sha256/$&#123;link:0:2&#125;/$&#123;link&#125;/data</span><br><span class="line">    echo $&#123;link&#125; &gt;&gt; $&#123;all_blobs&#125;</span><br><span class="line">    grep sha256 $&#123;mfs&#125; |cut -d "\"" -f4 | cut -c8-71 &gt;&gt; $&#123;all_blobs&#125;</span><br><span class="line">done</span><br><span class="line"><span class="meta">#</span><span class="bash"> delete blob <span class="keyword">if</span> the blob doesn<span class="string">'t exist in all_blobs.list</span></span></span><br><span class="line">for blob in $(find blobs -name "data" | cut -d "/" -f4)</span><br><span class="line">do</span><br><span class="line">    grep $&#123;blob&#125; $&#123;all_blobs&#125;</span><br><span class="line">    if [[ $? != 0 ]]; then</span><br><span class="line">    rm -rf blobs/sha256/$&#123;blob:0:2&#125;/$&#123;blob&#125;</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure><ol><li><p>éå†æ‰€æœ‰é•œåƒçš„ tag ä¸‹æœ€æ–°çš„ link æ–‡ä»¶æŒ‡å‘çš„ manifest</p></li><li><p>æ ¹æ® manifest æ–‡ä»¶ grep å‡º sha256 å€¼çš„ image config å’Œ layer æ–‡ä»¶ï¼Œä¿å­˜åˆ° <code>all_blobs.list</code> æ–‡ä»¶ä¸­ã€‚</p></li><li><p>ä½¿ç”¨ <code>find</code> å’Œ <code>for</code> å¾ªç¯éå†æ‰€æœ‰ blobs ä¸‹çš„çš„ data æ–‡ä»¶ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦åœ¨ <code>all_blobs.list</code> ä¸­ï¼Œä¸å†çš„è¯ç›´æ¥ <code>rm -rf</code> å¹²æ‰å®ƒï¼</p></li><li><p>æœ€åé‡å¯ä¸€ä¸‹ registry å®¹å™¨ã€‚</p></li></ol><p>å°±æ˜¯è¿™ä¹ˆç®€å•ç²—æš´ï¼å“ˆå“ˆï¼Œ<code>rm -rf</code> ç”¨èµ·æ¥çœŸçˆ½ï¼ˆæ‰‹åŠ¨æ»‘ç¨½ ã€‚å¦‚æœè¿˜æƒ³æŠŠè¿™ä¸ªè„šæœ¬å†ä¼˜åŒ–ä¸€ä¸‹çš„è¯ï¼Œå¯ä»¥å°† æ‰€æœ‰çš„ blob çš„ sha256 å€¼æˆªå–å‰ 12 ä½ä¿å­˜åœ¨ä¸€ä¸ªå˜é‡ä¸­ã€‚é€šè¿‡ <code>=~</code> æ¥åˆ¤æ–­åŒ…å«å…³ç³»æ¥æ›¿ä»£ grepã€‚</p><h2 id="è¸©å‘ï¼"><a href="#è¸©å‘ï¼" class="headerlink" title="è¸©å‘ï¼"></a>è¸©å‘ï¼</h2><h3 id="The-operation-is-unsupported-405-Method-Not-Allowed"><a href="#The-operation-is-unsupported-405-Method-Not-Allowed" class="headerlink" title="The operation is unsupported.(405 Method Not Allowed)"></a>The operation is unsupported.(405 Method Not Allowed)</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~/registry</span><br><span class="line">â•°â”€# skopeo delete docker://localhost/library/alpine:3.10 --debug</span><br><span class="line">DEBU[0000] Returning credentials from /run/containers/0/auth.json</span><br><span class="line">DEBU[0000] Using registries.d directory /etc/containers/registries.d for sigstore configuration</span><br><span class="line">DEBU[0000]  No signature storage configuration found for localhost/library/alpine:3.10</span><br><span class="line">DEBU[0000] Looking for TLS certificates and private keys in /etc/docker/certs.d/localhost</span><br><span class="line">DEBU[0000] Loading registries configuration "/etc/containers/registries.conf"</span><br><span class="line">DEBU[0000] GET https://localhost/v2/</span><br><span class="line">DEBU[0000] Ping https://localhost/v2/ status 401</span><br><span class="line">DEBU[0000] GET https://localhost/v2/library/alpine/manifests/3.10</span><br><span class="line">DEBU[0000] DELETE https://localhost/v2/library/alpine/manifests/sha256:a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">FATA[0000] Failed to delete /v2/library/alpine/manifests/sha256:a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590: &#123;"errors":[&#123;"code":"UNSUPPORTED","message":"The operation is unsupported."&#125;]&#125;</span><br><span class="line"> (405 Method Not Allowed)</span><br></pre></td></tr></table></figure><p>åœ¨ registry å®¹å™¨å¯åŠ¨çš„æ—¶å€™æ·»åŠ å˜é‡å¼€å¯ <code>REGISTRY_STORAGE_DELETE_ENABLED=true</code> å³å¯ï¼Œæˆ–è€…ä¿®æ”¹å®¹å™¨å†…çš„é…ç½®æ–‡ä»¶ <code>/etc/docker/registry/config.yml</code>ï¼Œåœ¨ <code>storage:</code> ä¸‹æ·»åŠ ä¸Š ä¸‹é¢çš„å‚æ•°ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">storage:</span></span><br><span class="line">  <span class="attr">delete:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="GC-ä¸å½»åº•ï¼Œæ®‹ç•™-link-æ–‡ä»¶"><a href="#GC-ä¸å½»åº•ï¼Œæ®‹ç•™-link-æ–‡ä»¶" class="headerlink" title="GC ä¸å½»åº•ï¼Œæ®‹ç•™ link æ–‡ä»¶"></a>GC ä¸å½»åº•ï¼Œæ®‹ç•™ link æ–‡ä»¶</h3><p>ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œregistry æ— è®ºæ˜¯åˆ é™¤ä¸€ä¸ªé•œåƒè¿˜æ˜¯è¿›è¡Œ GC æ“ä½œï¼Œéƒ½ä¸ä¼šåˆ é™¤ repositories ç›®å½•ä¸‹çš„ <code>_layers/sha256/digest/link</code> æ–‡ä»¶ï¼Œåœ¨è¿›è¡Œ GC ä¹‹åï¼Œä¸€äº›é•œåƒ layer å’Œ config æ–‡ä»¶å·²ç»åœ¨ blobs å­˜å‚¨ç›®å½•ä¸‹åˆ é™¤äº†ï¼Œä½†æŒ‡å‘å®ƒçš„ layers/link æ–‡ä»¶ä¾æ—§ä¿å­˜åœ¨ repositories ç›®å½•ä¸‹ğŸ™„ã€‚GitHub ä¸Šæœ‰ä¸ª PR <a href="https://github.com/docker/distribution/issues/2288" target="_blank" rel="noopener">Remove the layerâ€™s link by garbage-collect #2288</a> å°±æ˜¯ä¸“é—¨æ¥æ¸…ç†è¿™äº›æ— ç”¨çš„ layer link æ–‡ä»¶çš„ï¼Œæœ€æ—©çš„ä¸€ä¸ªæ˜¯ä¸‰å¹´å‰çš„ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰åˆå¹¶ğŸ˜‚ã€‚</p><p>ç•™ç€å·²ç»è¢« GC æ‰ blob çš„ layer link ä¹Ÿæ²¡å•¥ç”¨ï¼Œä½¿ç”¨ä¸‹é¢è¿™ä¸ªè„šæœ¬å°±èƒ½åˆ æ‰æ— ç”¨çš„ layer link æ–‡ä»¶ã€‚æ ¹æ® layer link çš„å€¼å» blobs ç›®å½•ä¸‹çœ‹çœ‹è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨çš„è¯å°± rm -rf æ‰ï¼Œå­˜åœ¨çš„è¯å°±ç•™ç€ã€‚è¿™æ ·å°±èƒ½æ¸…ç†å¹²å‡€å•¦ğŸ˜ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">cd /var/lib/registry/docker/registry/v2</span><br><span class="line">for link in $(find repositories -name "link" | grep -E "_layers")</span><br><span class="line">do</span><br><span class="line">    link_sha256=$(echo $&#123;link&#125; | awk -F "/" '&#123;print $6&#125;')</span><br><span class="line">    link_short=$(echo $&#123;link&#125; | awk -F "/" '&#123;print $6&#125;' | cut -c1-2)</span><br><span class="line">    data_file=blobs/sha256/$&#123;link_short&#125;/$&#123;link_sha256&#125;</span><br><span class="line">    dir_link=$(echo $&#123;link&#125; | sed s'/link//g')</span><br><span class="line">    if [[ ! -d "$&#123;data_file&#125;" ]]; then</span><br><span class="line">    rm -rf $&#123;dir_link&#125;</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h3 id="GC-åè¦é‡å¯ï¼"><a href="#GC-åè¦é‡å¯ï¼" class="headerlink" title="GC åè¦é‡å¯ï¼"></a>GC åè¦é‡å¯ï¼</h3><p>GC ä¹‹åä¸€å®šè¦é‡å¯ï¼Œå› ä¸º registry å®¹å™¨ç¼“å­˜äº†é•œåƒ layer çš„ä¿¡æ¯ï¼Œå½“åˆ é™¤æ‰ä¸€ä¸ªé•œåƒ A ï¼Œåè¾¹ GC æ‰è¯¥é•œåƒçš„ layer ä¹‹åï¼Œå¦‚æœä¸é‡å¯ registry å®¹å™¨ï¼Œå½“é‡æ–° PUSH é•œåƒ A çš„æ—¶å€™å°±ä¼šæç¤ºé•œåƒ layer å·²ç»å­˜åœ¨ï¼Œä¸ä¼šé‡æ–°ä¸Šä¼  layer ï¼Œä½†å®é™…ä¸Šå·²ç»è¢« GC æ‰äº†ï¼Œæœ€ç»ˆä¼šå¯¼è‡´é•œåƒ A ä¸å®Œæ•´ï¼Œæ— æ³• pull åˆ°è¯¥é•œåƒã€‚</p><h3 id="GC-ä¸æ˜¯äº‹åŠ¡æ€§æ“ä½œ"><a href="#GC-ä¸æ˜¯äº‹åŠ¡æ€§æ“ä½œ" class="headerlink" title="GC ä¸æ˜¯äº‹åŠ¡æ€§æ“ä½œ"></a>GC ä¸æ˜¯äº‹åŠ¡æ€§æ“ä½œ</h3><p>GC çš„æ—¶å€™æœ€å¥½æš‚åœ PUSH é•œåƒï¼Œä»¥å…æŠŠæ­£åœ¨ä¸Šä¼ çš„é•œåƒ layer ç»™ GC æ‰ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;blockquote&gt;
&lt;p&gt;å¥½ä¹…æ²¡æ›´æ–°åšå®¢äº†ï¼Œåœ¨å®¶æ‘¸é±¼èµ¶ç´§æ¥
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="docker" scheme="https://blog.k8s.li/tags/docker/"/>
    
      <category term="registry" scheme="https://blog.k8s.li/tags/registry/"/>
    
      <category term="é•œåƒ" scheme="https://blog.k8s.li/tags/%E9%95%9C%E5%83%8F/"/>
    
  </entry>
  
  <entry>
    <title>2020 é˜…è¯»è®°å½•ï¼ˆäºŒï¼‰</title>
    <link href="https://blog.k8s.li/Q2-reading.html"/>
    <id>https://blog.k8s.li/Q2-reading.html</id>
    <published>2020-06-19T16:00:00.000Z</published>
    <updated>2020-06-29T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>  è¦‹è­‰äº†é€™æ®µæ­·å²ä¹Ÿè¶Šä¾†è¶Šèƒ½é«”æœƒæ„Ÿè§¸åˆ°ï¼šç•¶ä»Šä¸–ç•Œï¼Œå°ˆåˆ¶çš„æ¬ŠåŠ›é‚„åœ¨å¥´å½¹äººçš„è‡ªç”±ï¼›æ¥µæ¬Šçš„çµ±æ²»é‚„åœ¨æ§åˆ¶äººçš„æ€æƒ³ï¼›ç¿’æ…£æ€§çš„ä¸æ€è€ƒå’Œç„¡åˆ¤æ–·å°‡äººå‚¾å‘æ„šæ˜§å’Œè‡ªæˆ‘æ¬ºé¨™ï¼Œæ–¼æ˜¯æˆ‘å€‘å…±åŒé€ å°±äº†é€™å°æ¥µæ¬Šå°ˆåˆ¶çš„æ©Ÿå™¨ï¼Œæˆ‘å€‘æœå¾é€™è€å¤§å“¥çš„æ€æƒ³ï¼Œä¸€åˆ‡éƒ½è¦æ”¿æ²»æ­£ç¢ºã€‚</p></blockquote><p>æ‚„æ— å£°æ¯åœ°æ¸¡è¿‡äº† 2020 å¹´çš„ä¸€åŠï¼Œå’Œä¸Šä¸€ç¯‡è¯»ä¹¦è®°å½•<a href="https://blog.k8s.li/spring-reading-note.html">ã€Šæ˜¥å­£è¯»ä¹¦ç¬”è®°ã€‹</a>ä¸€æ ·ï¼Œè¿™ç¯‡ä¹Ÿæ˜¯ä¸ªäººå›é¡¾ä¸€ä¸‹æœ€è¿‘ä¸‰ä¸ªæœˆçš„è¯»ä¹¦è®°å½•ï¼Œåœ¨æ­¤åšä¸ªæ€»ç»“ï¼Œä»¥æ­¤æ¥ç£ä¿ƒè‡ªå·±æ¯å¤©éƒ½è¦åšæŒé˜…è¯»ï¼ŒåšæŒè®°å½•ä¸‹å»ã€‚</p><h3 id="åœ¨è¯»"><a href="#åœ¨è¯»" class="headerlink" title="åœ¨è¯»"></a>åœ¨è¯»</h3><ul><li>å¸ƒæ‹‰æ ¼ç²¾ç¥</li><li>å¤§è¯å­˜å‚¨</li><li>ç”Ÿå‘½é€šå²</li><li>å¾è´²æ–‡é›†</li><li>é€šå¾€å°Šä¸¥çš„å…¬å…±ç”Ÿæ´»</li></ul><h3 id="2020-è¯»å®Œ"><a href="#2020-è¯»å®Œ" class="headerlink" title="2020 è¯»å®Œ"></a>2020 è¯»å®Œ</h3><p>å›é¡¾è¿™å¤§åŠå¹´æ¥ä¸€å…±å®Œæ•´è¯»å®Œäº† 48 æœ¬ä¹¦ğŸ˜‚</p><table><thead><tr><th align="center">ä¹¦å</th><th align="center">ä½œè€…</th><th align="center">æ—¶é—´</th><th align="center">é˜…è¯»æ—¶é•¿</th></tr></thead><tbody><tr><td align="center">è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€</td><td align="center">[æ³•]è®©-é›…å…‹Â·å¢æ¢­</td><td align="center">01-01</td><td align="center">5h</td></tr><tr><td align="center">ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ</td><td align="center">[å¥¥] è·¯å¾·ç»´å¸ŒÂ·å†¯Â·ç±³ç‘Ÿæ–¯</td><td align="center">01-01</td><td align="center">10h</td></tr><tr><td align="center">å¿ƒç†æµ‹é‡è€…</td><td align="center">[æ—¥]æ·±çœŸè§</td><td align="center">01-03</td><td align="center">6h</td></tr><tr><td align="center">è®ºé©å‘½</td><td align="center">[å¾·] æ±‰å¨œÂ·é˜¿ä¼¦ç‰¹</td><td align="center">01-05</td><td align="center">12h</td></tr><tr><td align="center">æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨å’Œåæœ</td><td align="center">å¼ é›ªå¿ </td><td align="center">01-15</td><td align="center">4h</td></tr><tr><td align="center">è®ºç§‘å­¦ä¸è‰ºæœ¯</td><td align="center">[æ³•]è®©-é›…å…‹Â·å¢æ¢­</td><td align="center">01-21</td><td align="center">2h</td></tr><tr><td align="center">åœ°çƒè„‰åŠ¨ï¼šå‰æ‰€æœªè§çš„è‡ªç„¶ä¹‹ç¾</td><td align="center">[è‹±]é˜¿æ‹‰æ–¯æ³°å°”Â·ç¦ç‘Ÿå‰å°”</td><td align="center">01-22</td><td align="center">2h</td></tr><tr><td align="center">ç¤¾ä¼šå¥‘çº¦è®º (è¯‘æ—äººæ–‡ç²¾é€‰)</td><td align="center">[æ³•]è®©-é›…å…‹Â·å¢æ¢­</td><td align="center">01-23</td><td align="center">4h</td></tr><tr><td align="center">ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶</td><td align="center">å‘¨é›ªå…‰</td><td align="center">01-28</td><td align="center">8h</td></tr><tr><td align="center">ç—…æ¯’æ˜Ÿçƒ</td><td align="center">[ç¾]å¡å°”Â·é½é»˜</td><td align="center">01-28</td><td align="center">4h</td></tr><tr><td align="center">ç—…æ¯’æ¥è¢­</td><td align="center">[ç¾]å†…æ£®â€¢æ²ƒå°”å¤«</td><td align="center">01-29</td><td align="center">2h</td></tr><tr><td align="center">è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹</td><td align="center">ç†æŸ¥å¾·Â·æ™®é›·æ–¯é¡¿</td><td align="center">02-01</td><td align="center">8h</td></tr><tr><td align="center">è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½</td><td align="center">å‘¨å¿—ç‚</td><td align="center">02-05</td><td align="center">4h</td></tr><tr><td align="center">å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹</td><td align="center">æœ±æ‰ä¼</td><td align="center">02-06</td><td align="center">3h</td></tr><tr><td align="center">ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥</td><td align="center">æœ±é’¦å£«</td><td align="center">02-07</td><td align="center">6h</td></tr><tr><td align="center">æœ±é’¦å£«çš„ä¸ªäººåšå®¢</td><td align="center">æœ±é’¦å£«</td><td align="center">02-08</td><td align="center">8h</td></tr><tr><td align="center">è¿œå¤çš„è¾‰ç…Œï¼šç”Ÿç‰©å¤§å¹…å°„</td><td align="center">æˆå˜‰ä½™</td><td align="center">02-13</td><td align="center">6h</td></tr><tr><td align="center">ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ</td><td align="center">[è‹±]é©¬ä¸Â·é›·å¾·èŠ¬</td><td align="center">02-13</td><td align="center">6h</td></tr><tr><td align="center">ç”Ÿå‘½æ´»åŠ¨çš„æ‘‡ç¯®ï¼šç»†èƒ</td><td align="center">ç‹è€€å‘</td><td align="center">02-16</td><td align="center">4h</td></tr><tr><td align="center">åœ°çƒè„‰åŠ¨2ï¼šå¥‡è¿¹ä¸–ç•Œ</td><td align="center">èƒ¡Â·ç§‘é‡Œ</td><td align="center">02-24</td><td align="center">3h</td></tr><tr><td align="center">ä¸€æƒ³åˆ°è¿˜æœ‰95<em>%çš„</em>é—®é¢˜ç•™ç»™äººç±»ï¼Œæˆ‘å°±æ”¾å¿ƒäº†</td><td align="center">è±ªå°”èµ«â€¢é™ˆ</td><td align="center">03-07</td><td align="center">4h</td></tr><tr><td align="center">å†å²çš„ç»ˆç»“åŠæœ€åä¹‹äºº</td><td align="center">[ç¾]å¼—æœ—è¥¿æ–¯Â·ç¦å±±</td><td align="center">03-03</td><td align="center">10h</td></tr><tr><td align="center">æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³</td><td align="center">ä½™æ°</td><td align="center">03-13</td><td align="center">8h</td></tr><tr><td align="center">ç¥å¥‡çš„ç”Ÿç‰©åŒ–å­¦</td><td align="center">ç¥å¥‡çš„ç”Ÿç‰©åŒ–å­¦</td><td align="center">03-23</td><td align="center">4h</td></tr><tr><td align="center">è´¹é©¬æœ€ç»ˆå®šç†</td><td align="center">[æ—¥]æ—¥å†²æ¨±çš®</td><td align="center">03-26</td><td align="center">3h</td></tr><tr><td align="center">è¢«è®¨åŒçš„å‹‡æ°”</td><td align="center">[æ—¥]å²¸è¦‹ä¸€éƒ</td><td align="center">03-28</td><td align="center">4h</td></tr><tr><td align="center">é¸Ÿç°å¤æ–‡æ˜</td><td align="center">[æ³•] è®©-å…‹åŠ³å¾·Â·æˆˆå°”ä¸‡</td><td align="center">04-03</td><td align="center">8h</td></tr><tr><td align="center">ç¼–ç ï¼šéšåŒ¿åœ¨è®¡ç®—æœºè½¯ç¡¬ä»¶èƒŒåçš„è¯­è¨€</td><td align="center">[ç¾]æŸ¥å°”æ–¯â€¢ä½©æªå°”å¾·</td><td align="center">04-10</td><td align="center">8h</td></tr><tr><td align="center">è‡ªç”±å®ªç« </td><td align="center">[å¥¥]å¼—é‡Œå¾·é‡Œå¸ŒÂ·å“ˆè€¶å…‹</td><td align="center">04-01</td><td align="center">16h</td></tr><tr><td align="center">æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—éŸ©äººæ°‘çš„çœŸå®ç”Ÿæ´»</td><td align="center">[ç¾]èŠ­èŠ­æ‹‰Â·å¾·ç±³å…‹</td><td align="center">04-23</td><td align="center">6h</td></tr><tr><td align="center">å“ˆç»´å°”æ–‡é›†</td><td align="center">[æ·å…‹]å“ˆç»´å°”</td><td align="center">04-24</td><td align="center">8h</td></tr><tr><td align="center">å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ</td><td align="center">[ç¾] å¡è’‚Â·é©¬é¡¿</td><td align="center">04-26</td><td align="center">6h</td></tr><tr><td align="center">è‡´å‘½çš„è‡ªè´Ÿï¼šç¤¾ä¼šä¸»ä¹‰çš„è°¬è¯¯</td><td align="center">[å¥¥]å¼—é‡Œå¾·é‡Œå¸ŒÂ·å“ˆè€¶å…‹</td><td align="center">05-01</td><td align="center">10h</td></tr><tr><td align="center">åœ°çƒçš„æ¼”å˜æ•…äº‹</td><td align="center">å§šå»ºæ˜</td><td align="center">05-02</td><td align="center">4h</td></tr><tr><td align="center">å›¾è§£ç§‘æŠ€è¯‘ä¸›ï¼šæ¼«ç”»å…ƒç´ 118</td><td align="center">[æ—¥]æ–‹è…¾èƒœè£•</td><td align="center">05-02</td><td align="center">2h</td></tr><tr><td align="center">é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–</td><td align="center">å¾è´²</td><td align="center">05-02</td><td align="center">4h</td></tr><tr><td align="center">ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘</td><td align="center">å¾è´²</td><td align="center">05-03</td><td align="center">8h</td></tr><tr><td align="center">ä¸‰è§’è·ç¦»æ— é™ä¸ºé›¶1-4</td><td align="center">[æ—¥]å²¬é¹­å®«</td><td align="center">05-05</td><td align="center">10h</td></tr><tr><td align="center">è¢«ç¦é”¢çš„å¤´è„‘</td><td align="center">[ç«‹]åˆ‡æ–¯ç“¦å¤«Â·ç±³æ²ƒä»€</td><td align="center">05-05</td><td align="center">6h</td></tr><tr><td align="center">äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†</td><td align="center">å¾è´²</td><td align="center">05-02</td><td align="center">10h</td></tr><tr><td align="center">å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾</td><td align="center">[è‹±]å¸ƒè±æ©â€¢è€ƒå…‹æ–¯</td><td align="center">05-25</td><td align="center">5h</td></tr><tr><td align="center">é€šå¾€å°Šä¸¥çš„å…¬å…±ç”Ÿæ´»</td><td align="center">å¾è´²</td><td align="center">05-25</td><td align="center">10h</td></tr><tr><td align="center">å®‡å®™ä»èµ·æºåˆ°æœªæ¥</td><td align="center">[[ç¾]çº¦ç¿°Â·å¸ƒç½—å…‹æ›¼</td><td align="center">06-18</td><td align="center">5h</td></tr><tr><td align="center">kubernetes ç½‘ç»œæƒå¨æŒ‡å—</td><td align="center">æœå†›</td><td align="center">06-20</td><td align="center">6h</td></tr><tr><td align="center">Linuxå¼€æºç½‘ç»œå…¨æ ˆè¯¦è§£ï¼šä»DPDKåˆ°OpenFlow</td><td align="center">è‹±ç‰¹å°”äºšå¤ªç ”å‘æœ‰é™å…¬å¸</td><td align="center">06-20</td><td align="center">3h</td></tr><tr><td align="center">å¤§è¯å¤„ç†å™¨</td><td align="center">ä¸‡æœ¨æ¨</td><td align="center">06-21</td><td align="center">1h</td></tr><tr><td align="center">ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶5</td><td align="center">[æ—¥]å²¬é¹­å®«</td><td align="center">06-24</td><td align="center">2.5h</td></tr></tbody></table><h2 id="4-æœˆ"><a href="#4-æœˆ" class="headerlink" title="4 æœˆ"></a>4 æœˆ</h2><h3 id="è‡ªç”±å®ªç« "><a href="#è‡ªç”±å®ªç« " class="headerlink" title="è‡ªç”±å®ªç« "></a>è‡ªç”±å®ªç« </h3><p>ã€Šè‡ªç”±å®ªç« ã€‹æ˜¯è¿™å¤§åŠå¹´æ¥æœ€éš¾å•ƒçš„ä¹¦ï¼Œå“ˆè€¶å…‹çš„ä¹¦å¯¹äºæœ¨å­è¿™ç§èœé¸¡æ¥è¯´è¯»èµ·æ¥å°±æ˜¯å¤´å¤§å•ŠğŸ˜‚ï¼Œå’Œæˆ‘åœ¨ä¸€æœˆä»½è¯»çš„ã€Šè‡ªç”±ä¸ç¹è£çš„å›½åº¦ã€‹å‘³é“ä¸€æ ·ã€‚</p><h4 id="ä½œè€…"><a href="#ä½œè€…" class="headerlink" title="ä½œè€…"></a>ä½œè€…</h4><p><strong>å¼—é‡Œå¾·é‡Œå¸ŒÂ·å“ˆè€¶å…‹</strong>ï¼ˆFriedrich AÂ·Hayekï¼‰æ˜¯å¥¥åœ°åˆ©ç»æµå­¦å®¶å’Œæ”¿æ²»å“²å­¦å®¶ã€‚èº«ä¸º1974å¹´çš„è¯ºè´å°”ç»æµå­¦å¥–çš„è·å¾—è€…ä¹‹ä¸€ï¼Œä»–ä¸»å¼ ä»¥å¸‚åœºä¸ºåŸºç¡€çš„è‡ªç”±èµ„æœ¬ä¸»ä¹‰å’Œæœ‰é™çš„æ”¿åºœã€‚æ­¤å¤–ï¼Œä»–è¿˜äº1991å¹´è·å¾—äº†æ€»ç»Ÿè‡ªç”±å‹‹ç« ã€‚</p><p>åœ¨è¿™æœ¬ä¹¦ä¸­ï¼Œå•å•æ³•æ²»æ¦‚å¿µçš„å«ä¹‰ï¼Œå“ˆè€¶å…‹æœ¬äººå°±ç½—åˆ—å¼•ç”¨äº† 30 å¤šæœ¬è‘—ä½œï¼å¯è§å½“æ—¶å“ˆè€¶å…‹æœ¬äººçš„å­¦æœ¯æ°´å¹³ç›¸å½“é«˜æ»´ï¼</p><blockquote><ul><li>ã€Šæ³•å¾‹ä¸ç§©åºã€‹</li><li>ã€Šæ•™ä¼šã€å›½å®¶ä¸ç ”ç©¶ã€‹</li><li>ã€Šæ–°åˆ©ç»´å¦ã€‹</li><li>ã€Šç¾å›½çš„è¡Œæ”¿å¸æ³•åŠæ³•å¾‹çš„æœ€é«˜åœ°ä½ã€‹</li><li>ã€Šå®ªæ”¿æ”¿æ²»ä¸æ°‘ä¸»ã€‹</li><li>ã€Šæ”¿æ²»ä¸è¡Œæ”¿ã€‹</li><li>ã€Šç°ä»£å…±åŒä½“çš„åŸºç¡€ã€‹</li><li>ã€Šå¯¹è‰¯å¥½ç¤¾ä¼šåŸåˆ™æ¢ç´¢ã€‹</li><li>ã€Šå®ªæ”¿ä¸å˜åŠ¨ä¸­çš„ä¸–ç•Œã€‹</li><li>ã€Šæ°‘ä¸»å›½å®¶ä¸é›†æƒå›½å®¶ã€‹</li><li>ã€Šè¡Œæ”¿ä¸æ³•æ²»ã€‹</li><li>ã€Šç°ä»£æ”¿æ²»è¯¸è¦ç´ ã€‹</li><li>ã€Šæ³•æ²»ï¼šä¿å®ˆçš„ä¼¦æ•¦å¾‹å¸ˆå…¬ä¼šä¸å·¥ä¼šåä¼šè¿›è¡Œçš„ç ”ç©¶ã€‹</li><li>ã€Šæ³•å¾‹ï¼šæœ‰å…³æ°‘ä¸»ä¹‹ä¸­çš„æƒå¨çš„ç†è®ºçš„è®ºæ–‡ã€‹</li><li>ã€Šä¸ªäººä¸»ä¹‰ä¸æ³•å¾‹ã€‹</li><li>ã€Šå®ªæ³•å­¦ã€‹</li><li>ã€Šå®ªæ³•ä¹‹ä¿å«è€…ã€‹</li><li>ã€Šæ³•æ²»å›½å®¶ï¼Œè¿˜æ˜¯ç‹¬è£ï¼Ÿã€‹</li><li>ã€Šæ”¿æ²»å­¦ã€‹ã€Šæ³•æ²»å›½å®¶æœ‰æ•ˆæ€§çš„ç•Œé™ã€‹</li><li>ã€Šæ³•æ²»å›½å®¶è¿˜æ˜¯å¨æƒå›½å®¶ï¼Ÿã€‹</li><li>ã€Šè‡ªç”±ä¸»ä¹‰ä½œä¸ºä¸€ç§æ„è¯†å½¢æ€çš„æ²¡è½ã€‹</li><li>ã€Šæ³¢æ©åŸºæœ¬æ³•ä¸­çš„ç¤¾ä¼šæ³•æ²»å›½å®¶æ¦‚å¿µã€‹</li><li>ã€Šä½œä¸ºåˆ‘æ³•æœ€æ–°å‘å±•çš„ä¸­å¿ƒæ¦‚å¿µçš„æ³•æ²»å›½å®¶ã€‹</li><li>ã€Šæ³•ã€å›½å®¶ã€ç»æµã€‹</li><li>ã€Šä»æ³•å¾‹å›½å®¶åˆ°æ³•å®˜å›½å®¶ã€‹</li><li>ã€Šç‘å£«è”é‚¦å›½å®¶æ³•ã€‹</li><li>ã€Šå¾·å›½è¡Œæ”¿æ³•çš„ä½“åˆ¶ã€‹</li><li>ã€Šç‘å£«è”é‚¦æ³•é™¢çš„å®ªæ³•ç®¡è¾–æƒã€‹</li><li>ã€Šæ³•åˆ¶å›½å®¶æ°‘ä¸»åˆ¶ã€‹</li><li>ã€Šç¾å›½ä¸ç‘å£«å®ªæ³•ç®¡è¾–æƒçš„æ”¿æ²»æ„è¯†å½¢æ€ä¸Šä¸æ³•å¾‹æ„è¯†å½¢æ€ä¸Šçš„æ ¹æ®ã€‹</li><li>ã€Šä½œä¸ºå›½å®¶æ ¹æœ¬æ³•å¾‹ç§©åºçš„å®ªæ³•ã€‹</li><li>ã€Šç‘å£«æ³•å¾‹ä¸­çš„å…¬æ°‘è‡ªç”±ã€‹</li><li>ã€Šæ³•æ²»å›½å®¶çš„ç§©åºã€‹</li><li>ã€Š1955å¹´é›…å…¸å›½é™…æ³•å­¦å®¶å¤§ä¼šæŠ¥å‘Šã€‹</li></ul></blockquote><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>è™½ç„¶è¿™æœ¬ä¹¦æ—©åœ¨1960å¹´å°±å·²å‡ºç‰ˆï¼Œä½†å…¶æ·±åˆ»çš„è§è§£æ—¶è‡³ä»Šæ—¥ä»ç„¶ç››è¡Œã€‚ä»–æ‰€å€¡å¯¼çš„ç»æµå’Œä¸ªäººè‡ªç”±ç†è®ºé€‚ç”¨äºå¾ˆå¤šå½“ä»Šçš„çƒ­è®®è¯é¢˜ï¼Œä»ç‰©ä»·ä¸Šæ¶¨åˆ°ç´¯è¿›ç¨åˆ¶ã€‚åœ¨ä¹¦ä¸­ï¼Œä½œè€…å¯¹æ¯”äº†å»ºç«‹æœ‰é™æ”¿åºœçš„ç›Šå¤„å’Œå®æ–½ä¸­å¤®è®¡åˆ’ç»æµçš„å¼Šç«¯ã€‚é™åˆ¶æ”¿åºœæƒåŠ›å°†ä¼šæœ‰åˆ©äºæå‡ä¸ªä½“èƒ½åŠ¨æ€§å’Œåˆ›é€ åŠ›ï¼Œè¿›è€Œæ¨åŠ¨äººç±»çŸ¥è¯†å’Œæ–‡æ˜çš„è¿›æ­¥ã€‚å“ˆè€¶å…‹è®ºè¯äº†æ³•å¾‹æ³•è§„ã€åˆæ³•ç¨‹åºå’Œå®ªæ³•æ”¿åºœå¯¹è‡ªç”±çš„ç§¯æä½œç”¨ï¼Œå¹¶æŒ‡å‡ºä¸ªäººè‡ªç”±æ‰€é¢ä¸´çš„ä¸¥å³»çš„æ½œåœ¨å¨èƒã€‚ä»¥ä¸‹æ˜¯æœ¬ä¹¦çš„å‡ ä¸ªè¦ç‚¹ï¼š</p><ul><li>æœ‰é™çš„æ”¿åºœé€šè¿‡æ¿€å‘äººçš„ä¸ªä½“ä¸»åŠ¨æ€§æ¥æ¨åŠ¨ç¤¾ä¼šçš„è¿›æ­¥ã€‚</li><li>è´¢äº§æƒåˆ©å’Œä¸ªäººè‡ªç”±è¿™ä¸€å®½æ³›çš„æ”¿æ²»æ¦‚å¿µæœ‰ç€å¯†åˆ‡çš„è”ç³»ã€‚</li><li>åªæœ‰é‚£äº›ä¸çº¦å®šä¿—æˆçš„é“å¾·è§‚å¿µç›¸ç¬¦çš„æ³•å¾‹æ‰èƒ½ç»å¾—ä½æ—¶é—´çš„è€ƒéªŒã€‚</li><li>å¤šæ•°è£å®šåŸåˆ™è‡ªç„¶å¾ˆæœ‰å¿…è¦ï¼Œä½†ä»…ä»…ä¾é å®ƒè¿˜ä¸è¶³ä»¥å»ºç«‹ä¸€ä¸ªè‡ªç”±ç¤¾ä¼šã€‚</li><li>å®ªæ”¿æ˜¯ç¾å›½è¿½æ±‚è‡ªç”±äº‹ä¸šæœ€æœ‰åŠ›çš„æ­¦å™¨ã€‚</li><li>ç¤¾ä¼šä¸»ä¹‰æ˜¯ä¸€ç§å¤±è´¥çš„æ”¿åºœå½¢å¼ï¼Œä½†å®ƒè‡³ä»Šä¾ç„¶å½±å“ç€å…¬å…±æ”¿ç­–çš„åˆ¶å®šã€‚</li><li>é€šè¿‡æ”¶å…¥å†åˆ†é…æ¥ç¼“è§£è´«å›°ä¼šå¸¦æ¥æ„æƒ³ä¸åˆ°çš„è´Ÿé¢æ•ˆåº”ï¼Œæ¯”å¦‚â€œç¦åˆ©å›½å®¶â€çš„å‡ºç°ã€‚</li><li>åŸºäºå¸‚åœºçŠ¶å†µçš„å¥–åŠ±åˆ¶åº¦æ¯”åŸºäºä¸ªäººä¼˜ç‚¹çš„å¥–åŠ±åˆ¶åº¦æ›´åŠ æœ‰æ•ˆã€‚</li><li>æ¯”èµ·é€šè´§ç´§ç¼©ï¼Œæ”¿åºœæ›´å€¾å‘äºé€šè´§è†¨èƒ€ã€‚ä½†è¿‡åº¦çš„è†¨èƒ€ä¼šå¨èƒåˆ°è‡ªç”±ã€‚</li><li>é™åˆ¶æ”¿åºœå¯¹æ•™è‚²çš„å¹²æ¶‰æœ‰åˆ©äºç¤¾ä¼šä¿æŒæ€æƒ³æ´»åŠ›ã€‚</li></ul><h3 id="æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—æœé²œäººæ°‘çš„çœŸå®ç”Ÿæ´»"><a href="#æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—æœé²œäººæ°‘çš„çœŸå®ç”Ÿæ´»" class="headerlink" title="æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—æœé²œäººæ°‘çš„çœŸå®ç”Ÿæ´»"></a>æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—æœé²œäººæ°‘çš„çœŸå®ç”Ÿæ´»</h3><p>è¯»å®Œè¿™æœ¬ä¹¦å°±æ„Ÿè§‰åˆ°å½“ä»Šçš„æœé²œå°±å¦‚ä¸Šä¸–çºªçš„ä¸­å›½<strong>åå¹´æ–‡é©åŸºç¡€ä¸Šå†åŠ ä¸Šä¸‰å¹´å¤§é¥¥è’</strong>ä¸€æ ·æ‚²æƒ¨ï¼Œè¿™ç§çºªå®ç±»çš„å†™ä½œå’Œã€Šåˆ‡å°”è¯ºè´åˆ©çš„æ‚²é¸£ã€‹ä»¥åŠã€Šåä¸ªäººçš„ä¸€ç™¾å¹´ã€‹ä¸€æ ·ï¼Œæ²‰é‡çš„å†å²æ„Ÿã€‚æˆ‘ä»¬éƒ½æ˜¯è¢«å…±äº§ä¸»ä¹‰çš„ææƒä¸“åˆ¶ç‹¬è£æš´æ”¿ç»Ÿæ²»è¹‚èºè¿‡çš„æ°‘æ—ï¼Œæ„ŸåŒèº«å—çš„å†å²è®°å¿†ï¼Œå½·ä½›å°±åœ¨æ˜ å°„ç€å½“ä¸‹ä¸€æ ·ï¼Œè®©äººæœ‰ç§èº«åœ¨å†å²ä¸­æ„Ÿå—å®ƒçš„å­˜åœ¨ä¸€æ ·ã€‚çœ‹çœ‹ä¸‹é¢è¿™å‡ æ®µæ‘˜æŠ„ï¼Œå’Œæ–‡é©æ—¶æœŸçš„æˆ‘ä»¬ä»¥åŠå½“ä¸‹çš„æˆ‘ä»¬åˆæ˜¯ä½•å…¶çš„ç›¸ä¼¼ï¼š</p><blockquote><p>  ç”±äºåŒ—éŸ©å¤ªè´«å›°ï¼Œç”µåŠ›ä¾›åº”ä¸è¶³ä»¥ç»´æŒç”µå­ç›‘æ§ï¼Œæ‰€ä»¥å›½å®¶å®‰å…¨å¿…é¡»ä»°èµ–äººåŠ›æƒ…æŠ¥â€”â€”å‘Šå¯†ã€‚æŠ¥çº¸å¶å°”ä¼šå‡ºç°æ–‡æƒ…å¹¶èŒ‚çš„æŠ¥å¯¼ï¼Œæè¿°å‹‡æ•¢çš„å­©å­çº ä¸¾çˆ¶æ¯çš„è¿æ³•è¡Œä¸ºã€‚ç”±æ­¤çœ‹æ¥ï¼Œå› å‘è¡¨å¯¹å½“å±€ä¸æ»¡çš„è¨€è®ºè€Œè¢«é‚»å±…å‘Šå‘ä¹Ÿå°±ä¸è§‰å¾—å¥‡æ€ªäº†ã€‚</p></blockquote><blockquote><p>  åŒ—éŸ©äººå­¦ä¼šåä¸‹è‡ªå·±çš„è‡ªå°Šä¸æä½è‡ªå·±çš„é¼»å­ã€‚ä»–ä»¬ä»å†œæ‘åŠ¨ç‰©çš„æ’æ³„ç‰©ä¸­æŒ‘å‡ºæ¥æœªè¢«æ¶ˆåŒ–çš„ç‰ç±³ç²’ã€‚èˆ¹å‚å·¥äººå‘å±•å¤„ä¸€ç§æŠ€æœ¯ï¼ŒåŸæœ¬å‚¨å­˜ç²®é£Ÿçš„è´§ä»“åº•éƒ¨æ®‹ç•™ç€è…è‡­é»è…»çš„ä¸œè¥¿ï¼Œä»–ä»¬å°†è¿™äº›ä¸œè¥¿åˆ®èµ·äº†ï¼Œæ”¾åœ¨åœ°é¢æ™¾å¹²ï¼Œä»ä¸­å¯ä»¥æ‹¾å–ä¸€ç‚¹æœªçƒ¹ç…®è¿‡çš„ç¨»ç±³ä¸å…¶ä»–å¯é£Ÿç”¨çš„è°·ç‰©ã€‚</p></blockquote><blockquote><p>  å­©å­ç¡è§‰æ—¶è¦æé˜²å…¶ä»–å¸®æ´¾å·èµ°ä»–ä»¬çš„å°‘è®¸ä½™ç²®ã€‚æ­¤å¤–ä¹Ÿæµä¼ ç€è®¸å¤šè¯¡å¼‚çš„æ•…äº‹ï¼Œæåˆ°æˆå¹´äººæŠŠå­©å­å½“æˆçŒç‰©ã€‚ä¸åªç”¨æ¥å‘æ³„æ€§æ¬²ï¼Œä¹Ÿå½“æˆé£Ÿç‰©ã€‚é‡‘èµ«å¬è¯´æœ‰äººå¯¹å­©å­ä¸‹æ¯’ï¼Œæ€æ­»å­©å­ï¼Œå¤§å¸å…«å—åƒä¸‹è‚šã€‚åœ¨ç«è½¦ç«™åé¢ï¼Œé è¿‘é“é“è¾¹ï¼Œæœ‰äº›å°è´©åœ¨å°ç«ç‚‰ä¸Šç…®æ±¤ç…®é¢ï¼Œæ®è¯´æµ®åœ¨ä¸Šé¢çš„ç°è‰²è‚‰å—å°±æ˜¯äººè‚‰ã€‚</p></blockquote><blockquote><p>  å„çº§ç£å¯¼ä¾‹è¡Œæ€§åœ°æé€ å†œä¸šç”Ÿäº§ä¸å·¥ä¸šäº§å‡ºçš„ç»Ÿè®¡æ•°æ®ï¼Œå› ä¸ºä»–ä»¬ä¸æ•¢å‘Šè¯‰é•¿å®˜å®æƒ…ã€‚ä¸ºäº†åœ†è°ï¼Œåªå¥½è¯´æ›´å¤šçš„è°ï¼Œä»åŸºå±‚ä¼ è¾¾åˆ°é«˜å±‚çš„è®¯æ¯æ²¡æœ‰ä¸€ä»¶æ˜¯çœŸçš„ï¼Œæ‰€ä»¥å¯ä»¥æƒ³è§é‡‘æ—¥æˆæœ¬äººææ€•å®Œå…¨ä¸çŸ¥é“ç»æµçš„çŠ¶å†µæœ‰å¤šç³Ÿã€‚</p></blockquote><h4 id="ä½œè€…-1"><a href="#ä½œè€…-1" class="headerlink" title="ä½œè€…"></a>ä½œè€…</h4><p><strong>èŠ­èŠ­æ‹‰Â·å¾·ç±³å…‹</strong></p><h4 id="åˆ«ç¬‘ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆå¹¸ç¦"><a href="#åˆ«ç¬‘ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆå¹¸ç¦" class="headerlink" title="åˆ«ç¬‘ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆå¹¸ç¦"></a>åˆ«ç¬‘ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆå¹¸ç¦</h4><p><img src="img/2020-06-27_17-12-28.jpg" alt="img"></p><p>çœ‹å®Œè¿™æœ¬ä¹¦ä¹Ÿå¯ä»¥å»çœ‹å¦å¤–ä¸€æœ¬ä¹¦ã€Šé»„é•¿çƒ¨å›å¿†å½•ã€‹</p><blockquote><p>  æˆ‘åœ¨ä¸€ä¸ªå……æ»¡äº†è™šä¼ªå’Œæ¬ºéª—çš„ç¤¾ä¼šç”Ÿæ´»äº†å¾ˆä¹…ï¼Œä¸€å¼€å§‹æˆ‘ä»¥ä¸ºè™šä¼ªå’Œæ¬ºéª—æ˜¯ä¸ºäº†è§£æ”¾å‹¤åŠ³çš„äººæ°‘å¤§ä¼—ï¼Œå³ä¸ºäº†å–å¾—ä¸å‰¥å‰Šé˜¶çº§æ–—äº‰çš„èƒœåˆ©è€Œå¿…é¡»é‡‡ç”¨çš„æ‰‹æ®µã€‚ ä½†æ˜¯ï¼Œåæ¥æˆ‘æ„è¯†åˆ°ï¼Œè™šä¼ªä¸æ¬ºéª—å·²ç»ä¸ç‹¬è£è€…çš„åˆ©å·±ä¸»ä¹‰ç»“åˆèµ·æ¥ã€‚ç‹¬è£è€…çš„åˆ©å·±ä¸»ä¹‰é›†ä¸­ä½“ç°ä¸ºä¸ªäººå´‡æ‹œæ€æƒ³ï¼ŒåŒ—æœé²œæ˜¯å…¨ä¸–ç•Œä¸ªäººå´‡æ‹œå’Œé˜¶çº§ä¸»ä¹‰æœ€ä¸¥é‡çš„å›½å®¶ã€‚ æˆ‘èº«å¤„åŒ—æœé²œç»Ÿæ²»ä½“åˆ¶çš„ä¸­æ¢ï¼Œæ˜¯æ•´ä¸ªè™šä¼ªå®£ä¼ çš„åŠ¨å‘˜å’Œç»„ç»‡è€…ï¼ˆä½œè€…æ˜¯åŒ—æœé²œé©¬å…‹æ€ä¸»ä¹‰å’Œæ„è¯†å½¢æ€é¢†åŸŸçš„æƒå¨ï¼Œè¯‘è€…æ³¨ï¼‰ã€‚è™šä¼ªæ›¾ç»ä¸€åº¦å–ä»£çœŸç†å æ®ä¸€ä¸ªå­¦è€…çš„è‰¯å¿ƒï¼Œä¸å­¦è€…çš„çµé­‚å¯¹ç«‹ã€‚ æˆ‘ï¼ˆåœ¨ä¹¦ä¸­ï¼‰ä¸ä¼šå› ä¸ºè®¨åŒæˆ‘å’Œè®©æˆ‘è®¨åŒçš„äººè€Œå¤¸å¤§ã€ä¸‘åŒ–äº‹å®ï¼Œä¹Ÿä¸ä¼šå› ä¸ºçˆ±æˆ‘å’Œè®©æˆ‘çˆ±çš„äººè€Œæ¯«æ— åŸåˆ™çš„ç¾åŒ–ç°å®ã€‚ å†å²å°±æ‘†åœ¨é‚£é‡Œï¼Œå¯¹å†å²æ¥è¯´ï¼Œæ­ªæ›²æ˜¯æœ€å¤§çš„çŠ¯ç½ªã€‚æˆ‘ä¸è®¤ä¸ºæˆ‘è¯´çš„å°±æ˜¯ç»å¯¹ï¼ˆæ­£ç¡®ï¼‰ï¼Œæˆ‘åå€’æ›´å¸Œæœ›è¯»è€…å¸¦ç€æ‰¹åˆ¤çš„æ€åº¦æ¥é˜…è¯»æœ¬ä¹¦ã€‚ å¯¹äºä¸å¤§ä¼—åˆ©ç›Šæ¯«æ— å…³ç³»çš„ä¸ªäººç”Ÿæ´»ï¼Œæˆ–è€…æœ‰å¹²æ¶‰å®ƒå›½å†…æ”¿ä¹‹å«Œçš„è¨€è®ºï¼Œæˆ‘ä¼šå°½é‡é¿å…ã€‚æ¥åˆ°éŸ©å›½ä¹‹åï¼Œæˆ‘åœ¨åŠªåŠ›å­¦ä¹ æ–°äº‹ç‰©ï¼Œå¼€å§‹æ–°çš„ä½“éªŒã€‚ ä½†æ˜¯ï¼Œæˆ‘å·²ç»è€äº†ï¼Œå­¦åˆ°çš„æ–°çŸ¥è¯†å’Œæ–°ç»éªŒå¯¹æˆ‘æ€è€ƒæ–¹æ³•çš„å½±å“æœ‰é™ã€‚åœ¨æœ¬ä¹¦ä¸­ï¼Œæˆ‘è¿˜æ˜¯æƒ³å°†åœ¨åŒ—æœé²œç»å†è¿‡çš„ã€ä½“éªŒè¿‡çš„å†™å‡ºæ¥ã€‚</p></blockquote><h3 id="å“ˆç»´å°”æ–‡é›†"><a href="#å“ˆç»´å°”æ–‡é›†" class="headerlink" title="å“ˆç»´å°”æ–‡é›†"></a>å“ˆç»´å°”æ–‡é›†</h3><p>ä¸‰æœˆä»½åœ¨è¯»ã€Šæˆ‘æ— ç½ªï¼šåˆ˜æ™“æ³¢ä¼ ã€‹çš„æ—¶å€™æ„å¤–æ”¶è·åˆ°çš„è¿™æœ¬ä¹¦ï¼Œåˆ˜æ™“æ³¢å’Œå“ˆç»´å°”è‡³äºæ·å…‹</p><p>å¦å¤–æ¨èé˜…è¯»ææ…ä¹‹å…ˆç”Ÿä¸ºè¿™æœ¬ä¹¦é¢˜çš„åºçš„<a href="http://www.aisixiang.com/data/1724.html" target="_blank" rel="noopener">ã€Šæ— æƒè€…çš„æƒåŠ›å’Œåæ”¿æ²»çš„æ”¿æ²»ï¼šåææƒä¸»ä¹‰æ—¶ä»£çš„äººç”Ÿå“²å­¦ã€‹</a></p><h3 id="å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ"><a href="#å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ" class="headerlink" title="å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ"></a>å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ</h3><p>åœ¨äºŒæœˆä»½çš„æ—¶å€™å‰©ä½™ä»·å€¼é‡Œçš„ä¸€æœŸèŠ‚ç›®ä¸­æåˆ°è¿‡ã€Šå¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆã€‹è¿™æœ¬ä¹¦ï¼Œè€Œè¿™æœ¬ä¹¦çš„åºè¨€æ­£æ˜¯å¾è´²è€å¸ˆå†™çš„ï¼Œåæ¥é™†ç»­åˆè¯»äº†äº”å…­æœ¬å¾è´²è€å¸ˆçš„ä¹¦ã€‚</p><h4 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><blockquote><p>  æœ¬ä¹¦é€šè¿‡å†·æˆ˜æ—¶æœŸåŒˆç‰™åˆ©ç§˜å¯†è­¦å¯Ÿé•¿è¾¾20å¹´çš„æ¡£æ¡ˆï¼Œæ‰€æ­å¼€çš„æ˜¯ä¸€éƒ¨éšè—äº†å‡ åå¹´çš„å®¶åº­å†å²å’Œæ—¶ä»£ä¾§è®°ã€‚</p><p>  å†·æˆ˜æ—¶æœŸï¼Œè‹è”é›†å›¢ä¸­çš„åŒˆç‰™åˆ©ï¼Œç§˜å¯†è­¦å¯Ÿé€šè¿‡åºå¤§çš„å‘Šå¯†ç½‘ï¼Œè¯•å›¾å…¨é¢æ¸—é€æ§åˆ¶åŒˆç‰™åˆ©çš„æ”¿æ²»ç”Ÿæ´»ã€‚ä½œè€…çš„çˆ¶æ¯åŸæ˜¯åŒˆç‰™åˆ©è‘—åè®°è€…ï¼Œä»–ä»¬çš„æŠ¥é“æ˜¯è¥¿æ–¹äº†è§£åŒˆç‰™åˆ©çš„é‡è¦ä¿¡æ¯æ¥æºã€‚å› æ­¤ä»–ä»¬è¢«è§†ä¸ºâ€œäººæ°‘çš„æ•Œäººâ€ï¼Œé•¿æœŸå—ç§˜å¯†è­¦å¯Ÿçš„ç›‘æ§ï¼Œç»ˆå› å›å›½å’Œé—´è°ç½ªè€Œå…ˆåå…¥ç‹±ã€‚ä¸€å®¶ç§»å±…ç¾å›½åï¼ŒåŒˆç‰™åˆ©æ”¿åºœå´åˆå¼‚æƒ³å¤©å¼€åœ°è¯•å›¾æ‹›å‹Ÿä»–ä»¬å½“é—´è°ï¼Œè€Œç¾å›½ä¹Ÿå¯¹ä»–ä»¬è¿›è¡Œäº†å‡ å¹´çš„ç›‘æ§ã€‚ä¹¦ä¸­ä¸åªè¿˜åŸäº†é©¬é¡¿å¤«å¦‡è¢«å‘Šå¯†è€…åŒ…å›´çš„ç»å†å’Œé­é‡ï¼Œä»–ä»¬çš„æŠ—äº‰ã€åšå®ˆã€è„†å¼±å’Œå‹‡æ°”ï¼Œä¹Ÿå±•ç°äº†ä»–ä»¬æƒ…æ„Ÿå’Œå†…å¿ƒçš„çŸ›ç›¾â€”â€”å¤«å¦»ä¹‹é—´ç›¸äº’çš„æ„Ÿæƒ…èƒŒå›ä¸ç¾éš¾ä¸­çš„æ”¯æ’‘ï¼Œçˆ¶æ¯å­å¥³ä¹‹é—´çš„çˆ±ä¸äº²æƒ…ï¼Œäººæ€§çš„åšå¼ºä¸è½¯å¼±ï¼Œä»è€Œä½¿å¾—è¿™æœ¬ä¹¦æ›´ä¸ºä¸°å¯Œã€å¤æ‚ï¼Œå…·æœ‰è¡€è‚‰ã€‚</p></blockquote><h2 id="5-æœˆ"><a href="#5-æœˆ" class="headerlink" title="5 æœˆ"></a>5 æœˆ</h2><h3 id="è‡´å‘½çš„è‡ªè´Ÿï¼šç¤¾ä¼šä¸»ä¹‰çš„è°¬è¯¯"><a href="#è‡´å‘½çš„è‡ªè´Ÿï¼šç¤¾ä¼šä¸»ä¹‰çš„è°¬è¯¯" class="headerlink" title="è‡´å‘½çš„è‡ªè´Ÿï¼šç¤¾ä¼šä¸»ä¹‰çš„è°¬è¯¯"></a>è‡´å‘½çš„è‡ªè´Ÿï¼šç¤¾ä¼šä¸»ä¹‰çš„è°¬è¯¯</h3><p>åœ°çƒçš„æ¼”å˜æ•…äº‹</p><h3 id="å›¾è§£ç§‘æŠ€è¯‘ä¸›ï¼šæ¼«ç”»å…ƒç´ 118"><a href="#å›¾è§£ç§‘æŠ€è¯‘ä¸›ï¼šæ¼«ç”»å…ƒç´ 118" class="headerlink" title="å›¾è§£ç§‘æŠ€è¯‘ä¸›ï¼šæ¼«ç”»å…ƒç´ 118"></a>å›¾è§£ç§‘æŠ€è¯‘ä¸›ï¼šæ¼«ç”»å…ƒç´ 118</h3><h3 id="äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†"><a href="#äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†" class="headerlink" title="äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†"></a>äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†</h3><h4 id="ä½œè€…-2"><a href="#ä½œè€…-2" class="headerlink" title="ä½œè€…"></a>ä½œè€…</h4><p><strong>å¾è´²</strong></p><h4 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>ä¹‹å‰æˆ‘ä¹Ÿè¯»è¿‡ä»–çš„è®ºæ–‡ <a href="https://matters.news/@philosophia1979/å¾è´²-ä¸­å›½çš„-æ–°ææƒä¸»ä¹‰-åŠå…¶æœ«ä¸–æ™¯è±¡-é‡å…½èè¯»-bafyreiegbg5tti3ljc7newaah5wp36ncf7fvb2oaovd6p7elc4xqfhbcd4" target="_blank" rel="noopener">ã€Šä¸­å›½çš„â€œæ–°ææƒä¸»ä¹‰â€åŠå…¶æœ«ä¸–æ™¯è±¡ã€‹</a>) ï¼Œæ‰€ä»¥å¯¹ä»–å…³æ³¨çš„å†…å®¹ä¹Ÿæœ‰æ‰€äº†è§£ã€‚æ€»æ„Ÿè§‰è¿™æœ¬ä¹¦æ›´åƒæ˜¯é˜¿ä¼¦ç‰¹ã€åŠ ç¼ªã€è¨ç‰¹ã€å“ˆç»´å°”ç­‰äººå¯¹äºææƒä¸»ä¹‰è‘—ä½œåŠæ€æƒ³çš„è§£æã€‚å°±åƒåœ¨å‰©ä½™ä»·å€¼é‡Œæåˆ°çš„ï¼Œæˆ‘ä»¬è¯»è¿™äº›å†å²çš„æ—¶å€™ï¼Œè€Œå½“ä¸‹å°±ä»¿ä½›ç½®èº«äºå†å²ä¹‹ä¸­ä¸€æ ·ã€‚ä¹¦ä¸­è®°å½•è‹è”å’Œçº³ç²¹å¾·å›½ææƒç»Ÿæ²»æ”¹é€ äººæ€§çš„è¨€è®ºå®¡æŸ¥ã€ç§˜å¯†è­¦å¯Ÿã€é›†ä¸­è¥ã€æ— è¨€è®ºè‡ªç”±å’Œæ–°é—»è‡ªç”±ã€å…šåª’æ„šæ°‘æ´—è„‘ç­‰ï¼Œè¿™äº›æè¿°ææƒç»Ÿæ²»çš„å†å²ï¼Œå†çœ‹ä¸€çœ‹å½“ä¸‹ï¼Œæˆ‘ä»¬ä¸æ­£ç½®èº«äºå…¶ä¸­å—ï¼Ÿ</p><ul><li><strong>æ¯”ç˜Ÿç–«æ›´å¯æ€•çš„æ˜¯è¬Šè¨€ï¼Œæ¯”ç½é›£æ›´å¯æ€•çš„æ˜¯éºå¿˜</strong></li></ul><p><img src="img/20200618225156768.png" alt="image-20200618225156768"></p><p><img src="img/2020-06-09_15-46-37.jpg" alt=""></p><p><img src="img/2020-06-09_15-46-372.jpg" alt=""></p><p><img src="img/2020-06-09_15-46-373.jpg" alt=""></p><p>è¯ºè´å°”å’Œå¹³å¥–å¾—ä¸» <a href="https://www.rfa.org/mandarin/pinglun/liuxiaobopinglunzhuanji/64-06022008113911.html" target="_blank" rel="noopener">åˆ˜æ™“æ³¢æ›¾ç»è¯´è¿‡ï¼Œ</a>â€œé—å¿˜ç½ªæ¶å†å²çš„æ°‘æ—ï¼Œå†³ä¸ä¼šæœ‰çœŸæ­£çš„æœªæ¥ã€‚â€</p><blockquote><p>  â€œå¯¹äºä¸€ä¸ªæ°‘æ—æ¥è¯´ï¼Œè®°å¿†å¯¹é—å¿˜çš„æŠ—æ‹’ï¼Œé¦–å…ˆæ˜¯çŸ¥è¯†ç²¾è‹±çš„è‰¯çŸ¥å¯¹å¼ºæƒçš„æŠ—æ‹’ã€‚å¦åˆ™çš„è¯ï¼Œæˆ‘ä»¬éä½†æ— æ³•æŠŠå…­å››å¤§å± æ€çš„çœŸç›¸ã€è¿›è€ŒæŠŠç‹¬è£åˆ¶åº¦çš„ç½ªæ¶å˜æˆæ°‘ä¼—çš„å†å²å¸¸è¯†ï¼Œä¹Ÿæ— æ³•é˜²æ­¢ç±»ä¼¼å¤§æ‚²å‰§çš„é‡æ¼”ã€‚éš¾é“ä¸­å›½å†å²åœ¨ä¸“åˆ¶ä¸‹æ¶æ€§å¾ªç¯çš„æ—¶é—´è¿˜ä¸å¤Ÿé•¿å—ï¼Ÿâ€</p></blockquote><p>æœ€ç»ˆï¼Œå› ä¸ºé—å¿˜ç½ªæ¶å†å²è€Œå—å®³çš„ï¼Œåªä¼šæ˜¯ä¸­å›½äººè‡ªå·±ã€‚</p><p>å°±åƒåˆ˜æ™“æ³¢æ‰€è¯´çš„é‚£æ ·ï¼š</p><p><strong>â€œç”¨æ°‘é—´è®°å¿†æŠ—æ‹’å®˜æ–¹çš„å¼ºåˆ¶é—å¿˜ï¼Œå°±æ˜¯ä¸ºæˆ‘ä»¬è¿™ä¸ªå†å°½è‹¦éš¾çš„æ°‘æ—ä¿å­˜è®°å¿†å’Œè‰¯çŸ¥ã€‚â€</strong></p><blockquote><p>  äººæ°‘â€œè·å¾—â€çš„â€œå›½å®¶å†å²â€æ˜¯é‚£äº›è®°å½•ä¸‹æ¥ï¼Œæˆ–è€…è¯´è¢«æƒåŠ›å…è®¸è®°å½•ä¸‹æ¥çš„â€œäº‹ä»¶â€ï¼Œè€Œé‚£äº›æ²¡æœ‰è¢«è®°å½•æˆ–ä¸è¢«å…è®¸è®°å½•ä¸‹æ¥çš„äº‹ä»¶ï¼Œå°±æ­¤è¢«æ­¦æ–­åœ°ä»å›½å®¶å†å²ä¸­å‰”é™¤ï¼Œä¹Ÿä»æ—ç¾¤è®°å¿†ä¸­æ’æ–¥å‡ºå»äº†ã€‚å› æ­¤ï¼Œå¯¹å†å²çœŸå®ä¿æŒæ²‰é»˜ï¼Œè™½ç„¶æ˜¯ä»æ”¹å†™å†å²å¼€å§‹ï¼Œä½†æœ€ç»ˆå´è¡¨ç°ä¸ºæ—ç¾¤çš„é›†ä½“å¿˜å´ã€‚æ¯ä¸ªæ²‰é»˜çš„ä¸ªäººï¼Œæ¯ä¸ªåœ¨æ—ç¾¤ä¸­æŒ‰æƒåŠ›æ„å¿—æ¥è®°å¿†æˆ–å¿˜å´çš„äººï¼Œéƒ½å‚ä¸åœ¨ä»¥æ²‰é»˜ä»£æ›¿çœŸå®ï¼Œä»¥æ²‰é»˜ç»´æŒè°è¨€çš„å…±è°‹ä¹‹ä¸­ã€‚</p></blockquote><h3 id="é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–"><a href="#é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–" class="headerlink" title="é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–"></a>é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–</h3><p>æ°å¥½è¯»å®Œè¿™æœ¬ä¹¦ä¹‹åä¸ä¹… B ç«™å°±ä¸Šæ˜ äº†åæµªæ´—è„‘å®£ä¼ ç‰‡ï¼Œä¸æ–™å¾®åšè¯„è®ºåŒºä¹Ÿæ˜¯ç¿»è½¦ç°åœºğŸ¤£</p><p><img src="img/2020-05-04_17-31-222.jpg" alt=""></p><p><img src="img/2020-05-04_17-31-223.jpg" alt=""></p><p>ç¬¬ä¸€æ¬¡å¬è¯´åˆ°åæµªçš„æ—¶å€™æˆ‘å°±è§‰ç€ï¼Œè¿™ç±»èº«å±…é«˜ä½çš„çŠ¬å„’çŸ¥è¯†ä»½å­ï¼Œå¦‚èƒ¡é”¡è¿›ã€èƒ¡éé’¢ã€é‡‘ç¿è£ã€å¼ ç»´ä¸ºè¿™ç±»ï¼Œä¸ºå½“æƒè€…æ­ŒåŠŸèµå¾·ã€æ‹é©¬æºœé¡»ã€è°„åªšçŒ®åªšã€é˜¿è°€å¥‰æ‰¿ï¼Œè¿™ç±»äººåº”è¯¥æ¯”ä»»ä½•äººéƒ½æ¸…æ¥šåœ¨è¿™å¤ªå¹³ç››ä¸–çš„èƒŒåï¼ŒæŠ“æ•äº†å¤šå°‘ç»´æƒå¾‹å¸ˆã€è¿«å®³äº†å¤šå°‘å¼‚è®®äººå£«ã€å…³æŠ¼äº†å¤šå°‘å…¬æ°‘è®°è€…ã€å¤„åˆ†äº†å¤šå°‘ç›´è¨€æ•™å¸ˆã€‚ç„¶è¿™äº›çŸ¥è¯†åˆ†å­ã€æ•™æˆã€ä¸“å®¶åœ¨è¯´å‡è¯ï¼Œç”¨æ‰€è°“çš„â€å­¦æœ¯â€æ¥å–æ‚¦å’ŒæŠ•é æƒåŠ›å’Œå½“æƒè€…,è°‹å–ç§åˆ©ï¼Œä»¥è²Œä¼¼é«˜æ·±ã€æ¸Šåšã€ç²¾è‡´çš„ç†è®ºåŒ…è£…æ™®é€šäººç”¨å¸¸è¯†å°±èƒ½çœ‹ç©¿çš„æ…Œè¨€ï¼Œæœ‰çš„ç”šè‡³è¿˜ç›¸å½“â€å¯Œæœ‰åˆ›æ„â€ï¼Œå–„äºâ€ç†è®ºæ›´æ–°â€,æˆ–æœ‰â€ç†è®ºå»ºæ ‘â€ã€‚</p><p>åœ¨æ”¿æ²»æ„è¯†å½¢æ€ä¸»å¯¼ä¸€åˆ‡,æƒåŠ›å¯ä»¥æ“æ§ä¸€åˆ‡çš„ç¤¾ä¼šé‡Œ,ä¸å­˜åœ¨æ‰€è°“çš„â€ç‹¬ç«‹å­¦æœ¯â€,å°¤å…¶ä¸å­˜åœ¨ç‹¬ç«‹çš„äººæ–‡å­¦æœ¯ã€‚ä¸€äº›çŸ¥è¯†åˆ†å­å› ä¸ºä¸å¾—å·²è€Œåšâ€çº¯å­¦é—®â€,æ˜¯ä¸€ç§æ†‹å±ˆçš„å­¦æœ¯â€è‡ªå®«â€ã€‚æƒåŠ›çš„å’¸èƒä¸åˆ©è¯±é€ å°±ä½“åˆ¶æ€§çš„â€å­¦æœ¯ä¹‰å„’â€,å®ƒå¾€å¾€æ˜¯ä¸€ç§åœ¨æ¸…é†’çŠ¶æ€ä¸‹çš„è£…å‚»â€”â€”ä¸€é¢è‡ªå˜²,ä¸€é¢é…åˆä½“åˆ¶,ç§¯æè‡ªæˆ‘å®¡æŸ»ï¼›ä¸€é¢å’’éª‚,ä¸€é¢è¿åˆä½“åˆ¶çš„æ— ç†è¦æ±‚ï¼›ä¸€é¢é„™è§†ä¸æ‡‚å­¦æœ¯çš„é¡¶å¤´ä¸Šå¸,ä¸€é¢é¡ºä»ä»–ä»¬çš„é¢†å¯¼æƒå¨ï¼›ä¸€é¢å˜²ç¬‘,ä¸€é¢å‚ä¸ä¸ºå®˜å‘˜æˆäºˆå„ç§çœŸçš„å‡å­¦ä½å’Œå‡å¤´è¡”ã€‚</p><blockquote><p>  é˜¿ä¼¦ç‰¹åœ¨1963å¹´7æœˆ24æ—¥ç»™å‹äººå¡æ–¯è´å°”ï¼ˆGerhard Casperï¼‰çš„ä¿¡é‡Œå†™é“:â€äººä»¬ç»å¸¸å‘ç°,æ´—è„‘æ¬ºéª—æœ€è‚¯å®šçš„é•¿æœŸåæœå°±æ˜¯é€ æˆçŠ¬å„’ä¸»ä¹‰â€”â€”ç»å¯¹ä¸ç›¸ä¿¡ä»»ä½•äº‹æƒ…å¯èƒ½æ˜¯çœŸçš„,å“ªæ€•æ˜¯ç¡®æœ‰å®æ®çš„çœŸå®,ä¹Ÿç…§æ ·ä¸ç›¸ä¿¡ã€‚æ¢è¨€ä¹‹,å®Œå…¨ç”¨è°è¨€æ¥ä»£æ›¿äº‹å®çœŸç›¸çš„ç»“æœä¸æ˜¯äººä»¬ä¼šæŠŠè°è¨€å½“ä½œçœŸå®,æˆ–è€…çœŸå®ä¼šè¢«å½“ä½œä¸ºè°è¨€,è€Œæ˜¯æˆ‘ä»¬èµ–ä»¥åœ¨çœŸå®ä¸–ç•Œé‡Œå­˜åœ¨çš„çŸ¥è§‰ä¼šè¢«å®Œå…¨æ‘§æ¯ã€‚äººç±»ä¸ºäº†ç”Ÿå­˜,å¿…é¡»å…·å¤‡åŸºæœ¬çŸ¥è§‰,å…¶ä¸­å°±æœ‰å¯¹çœŸå’Œå‡çš„è¯†åˆ«ã€‚â€</p></blockquote><blockquote><p>  é˜¿ä¼¦ç‰¹è®¤ä¸º,ç¤¾ä¼šä¸­çš„å¤šæ•°äººé›†ä½“æŠ•å‘çŠ¬å„’ä¸»ä¹‰,æ˜¯å› ä¸ºæ”¿æ²»æƒåŠ›é•¿æœŸç”¨è°è¨€æ¥ä»£æ›¿çœŸå®,å¤§è§„æ¨¡åœ°å¯¹ç¾¤ä¼—è¿›è¡Œæ´—è„‘å¹¶æ¬ºéª—ä»–ä»¬ã€‚è¿™æ˜¯20ä¸–çºªæ‰æœ‰çš„ç»Ÿæ²»æ–¹å¼,æœ€å…¸å‹çš„ä¾‹å­å°±æ˜¯æ–¯å¤§æ—ç»Ÿæ²»æ—¶æœŸå¦è®¤æ‰˜æ´›èŒ¨åŸºæ›¾å¯¹ä¿„ç½—æ–¯é©å‘½æœ‰è¿‡ä»»ä½•è´¡çŒ®ã€‚é˜¿ä¼¦ç‰¹ç§°æ­¤ä¸ºâ€ææƒè°è¨€â€,å®ƒè¦ç¼–é€ çš„æ˜¯ä¸€ç§å®Œå…¨è™šå‡çš„,å› æ­¤å½»åº•é¢ è¦†çœŸä¼ªåŒºåˆ«çš„â€çœŸå®â€ã€‚</p></blockquote><h4 id="çŠ¬å„’ä¸»ä¹‰"><a href="#çŠ¬å„’ä¸»ä¹‰" class="headerlink" title="çŠ¬å„’ä¸»ä¹‰"></a>çŠ¬å„’ä¸»ä¹‰</h4><ul><li>ï¼ˆ1ï¼‰å¨±ä¹è‡³æ­»ï¼ˆæ²¡æœ‰ç›®æ ‡æˆ–ä¿¡ä»°,å¾—è¿‡ä¸”è¿‡ï¼‰ï¼›</li><li>ï¼ˆ2ï¼‰çœ‹å®¢å¿ƒæ€ï¼ˆçœ‹ç©¿ã€å†·æ¼ ã€å›´è§‚,ç®¡äº†ä¹Ÿæ²¡ç”¨,ä¸å¦‚ä¸ç®¡ï¼‰ï¼›</li><li>ï¼ˆ3ï¼‰ä¹ æƒ¯æ€§æ€€ç–‘ï¼ˆä¸Šè‡³æ”¿åºœ,ä¸‹è‡³æœ‹å‹,å¯¹è°éƒ½ä¸ä¿¡ä»»,éƒ½ä¸ç›¸ä¿¡ï¼‰ï¼›</li><li>ï¼ˆ4ï¼‰å®¡ä¸‘å¿ƒç†ï¼ˆåœ¨ä¸€ä¸ªæ˜¯éä¸åˆ†çš„ç¯å¢ƒé‡Œ,ç¾ä¸‘ã€å–„æ¶ã€çœŸå‡ä¹Ÿæ— æ³•è¾¨åˆ«,ä½•å¿…è¦åšæŒçœŸã€å–„ã€ç¾ï¼‰ï¼›</li><li>ï¼ˆ8ï¼‰â€é¸µé¸Ÿå¿ƒæ€â€ï¼ˆå¤šä¸€äº‹ä¸å¦‚å°‘ä¸€äº‹,è¢«å®£ä¼ çš„ç°å®åæ­£æ˜¯å‡çš„,ä¸å¦‚â€èº²è¿›å°æ¥¼æˆä¸€ç»Ÿâ€ï¼‰;</li><li>ï¼ˆ9ï¼‰æ€è€ƒææƒ§ç—‡ï¼ˆå¤šæ€å¤šæƒ¹äº‹,æœ‰çš„æ˜¯å‰è½¦ä¹‹é‰´,ä½ è¦æˆ‘æ€ä¹ˆè¯´,æˆ‘å°±æ€ä¹ˆè¯´,è¿™æ‰æ˜¯å®‰èº«ä¿å‘½ä¹‹é“ï¼‰ï¼›</li><li>ï¼ˆ11ï¼‰ç‚«å¯Œå¿ƒæ€ï¼ˆçœ‹ç©¿ä¸€äº›é“å¾·ã€ç†æƒ³ã€æœªæ¥å±•æœ›çš„è™šå¦„,åªæœ‰é’±æ‰æ˜¯å®åœ¨çš„,æ‰æ˜¯ä¸–äººè®¤å¯çš„å”¯ä¸€ä»·å€¼ï¼‰ï¼›</li><li>ï¼ˆ12ï¼‰åˆè€ç—‡ï¼ˆæ²¡æœ‰å‰é€”ã€æ²¡æœ‰æœªæ¥ã€æ²¡æœ‰è¿½æ±‚,è¿‡ä¸€å¤©ç®—ä¸€å¤©,ååƒç­‰æ­»ï¼‰ï¼›</li><li>ï¼ˆ13ï¼‰è‡ªè™å¿ƒæ€ï¼ˆè¿™ä¸ªè¯´æ³•å¹¶ä¸ç¡®å®,å› ä¸ºä¸€èˆ¬äººæ—¢éå…±äº§å…šåˆéä½“åˆ¶,ä¸æ˜¯â€è‡ªè™â€,è¿™ç§é¡¾å·¦å³è€Œè¨€ä»–çš„è¯´æ³•,æ˜ç™½äººè¯´ç³Šæ¶‚è¯,æ—¢ä¸è¯šå®,ä¹Ÿä¸çœŸå®,å®ƒæœ¬èº«å°±æ˜¯çŠ¬å„’ä¸»ä¹‰çš„ï¼‰ã€‚</li></ul><blockquote><p>  å¯¹çŠ¬å„’çš„ç°ä»£å®šä¹‰æ˜¯æœ‰ä»£è¡¨æ€§çš„:ä¸€ã€æŒ‘åˆºã€å˜²ç¬‘ã€è®½åˆºï¼›äºŒã€ä¸ç›¸ä¿¡æˆ–è£…ç€ä¸ç›¸ä¿¡æ™®é€šäººæ¥å—çš„é“å¾·ä»·å€¼è§‚å’Œäººç±»è¡Œä¸ºçœŸè¯šçš„å–„è‰¯åŠ¨æœº,æŠŠè‡ªç§è‡ªåˆ©è®¤ä½œå”¯ä¸€å¯èƒ½çš„åŠ¨æœºï¼›è½»è”‘ã€é„™è§†ã€å˜²è®½çš„æ€€ç–‘å’Œä¸ç›¸ä¿¡ã€‚</p></blockquote><p>åˆ˜æ™“æ³¢æ›¾åœ¨ <a href="http://www.liu-xiaobo.org/blog/archives/12412" target="_blank" rel="noopener">åˆ˜æ™“æ³¢ï¼šåœ¨åˆ€é”‹ä¸Šè¡Œèµ°â€”â€”ç‹±ä¸­è¯»ã€Šå¸ƒæ‹‰æ ¼ç²¾ç¥ã€‹</a> å†™è¿‡ï¼š</p><blockquote><p>  æ®å…‹é‡Œç›çš„ä»‹ç»ï¼Œåœ¨å‰è‹ä¸œææƒä¸‹çš„æ·å…‹çŸ¥è¯†åˆ†å­ç¾¤ä½“ä¸­ï¼Œä¸ä»…å‡ºç°äº†å“ˆç»´å°”è¿™æ ·çš„é“ä¹‰ç¤ºèŒƒï¼Œè€Œä¸”æœ‰95ï¼…ä»¥ä¸Šçš„äººä¸ºäº†è‡ªç”±å’Œè‰¯çŸ¥è€Œè¿›è¡Œç€å„ç§å½¢å¼çš„æ‹’ç»ï¼Œåªæœ‰ä¸åˆ°5%çš„äººç”˜æ„¿å •è½ä¸ºå–èº«æŠ•é è€…ã€‚è¿™å½“ç„¶æ˜¯è®©ä¸­å›½çŸ¥è¯†åˆ†å­è‡ªè§‰ç¾æ„§çš„è¡¨ç°ã€‚æˆ‘ä»¬æ²¡æœ‰æ·å…‹äººé‚£ç§æ¸…é†’å’ŒåšéŸ§ï¼Œä»…ä»…åå¹´çš„æ—¶é—´ï¼Œå…­å››çš„ä¼¤å£ä¾¿è¢«é—å¿˜ï¼Œè¿™ä¸å…‰æ˜¯å› ä¸ºå®˜æ–¹çš„å¼ºåˆ¶ï¼Œä¹Ÿæ˜¯æ°‘æ—çµé­‚çš„å†·æ¼ ã€‚çŸ¥è¯†åˆ†å­ç¾¤ä½“ä¸èƒ½ä»¥è¨€è¡Œæ¥æ´—åˆ·è€»è¾±ï¼Œæ—¢æºäºå¤–åœ¨çš„æ”¿æ²»ææ€–ï¼Œæ›´æºäºä»–ä»¬ç”Ÿå‘½ä¸­æ´—åˆ·è€»è¾±çš„å†²åŠ¨å·²ç»æ­»äº¡ã€‚</p></blockquote><h3 id="ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘"><a href="#ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘" class="headerlink" title="ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘"></a>ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘</h3><blockquote><p>  ææƒæ”¿ä½“å½»åº•æ§åˆ¶ä¸æ€æƒ³ã€è¨€è®ºã€æ–°é—»æœ‰å…³çš„è¦å®³é¢†åŸŸï¼Œæ•™è‚²æ˜¯è¢«ç®¡åˆ¶å¾—æœ€ä¸¥å‰çš„é¢†åŸŸä¹‹ä¸€ï¼Œå’Œå®£ä¼ ä¸€æ ·ï¼Œè¢«ä¸¥æ ¼æ§åˆ¶ã€‚è¿™æ ·çš„æ•™è‚²è™½ç„¶ä¸æ°‘ä¸»å›½å®¶çš„æ•™è‚²ä¸€æ ·è¢«ç§°ä¸ºâ€œæ•™è‚²â€ï¼Œä½†å®é™…ä¸Šå·²ç»æˆä¸ºæ”¿æ²»æƒåŠ›æ§åˆ¶å›½æ°‘æ€æƒ³å’ŒåŸ¹å…»å­æ°‘çš„å·¥å…·ã€‚è¿™ä¸æ°‘ä¸»å›½å®¶ä¸­å­¦æ ¡æ•™è‚²ä½œä¸ºå…¬æ°‘ç¤¾ä¼šæ–‡åŒ–æœºåˆ¶çš„ä¸€éƒ¨åˆ†ï¼Œèµ·åˆ°åŸ¹å…»æ°‘ä¸»å…¬æ°‘çš„ä½œç”¨ï¼Œæ˜¯å®Œå…¨ä¸åŒçš„ã€‚</p></blockquote><blockquote><p>  çº³ç²¹ç»Ÿæ²»å¾·å›½ï¼Œä¾é çš„ä¸ä»…æ˜¯å®Œå…¨ç”±çº³ç²¹æ§åˆ¶å’Œæ“çºµçš„å›½å®¶æœºå™¨ï¼Œæ”¿åºœã€å„çº§çº³ç²¹å…šç»„ç»‡ã€å…šå«å†›ã€å†²é”‹é˜Ÿã€è­¦å¯Ÿç­‰ï¼Œè€Œä¸”æ›´æ˜¯æ— å¤„ä¸åœ¨çš„çº³ç²¹æ„è¯†å½¢æ€ï¼Œå®ƒæ¸—é€åˆ°å¾·å›½ç¤¾ä¼šã€æ–‡åŒ–ã€æ•™è‚²å’Œå®¶åº­ç”Ÿæ´»çš„æ¯ä¸€ä¸ªè§’è½ï¼Œç¡®ä¿çº³ç²¹æ”¿å…šæˆä¸ºå¾·å›½ä¸»æƒçš„å†…æ ¸ã€‚æ­£æ˜¯ç”±äºçº³ç²¹æ”¿å…šå®é™…ä¸Šå·²ç»æˆä¸ºå¾·å›½ä¸»æƒçš„å†…æ ¸ï¼Œå¾·å›½çš„å›½å®¶ä¸»ä¹‰æ‰ä¼šæŒ‰ç…§çº³ç²¹çš„æ„å¿—è½¬å˜ä¸ºç¬¦åˆçº³ç²¹å…šåˆ©ç›Šï¼Œå¹¶ä¸ºå®ƒçš„åˆ©ç›ŠæœåŠ¡çš„å…šå›½ä¸»ä¹‰ã€‚</p></blockquote><blockquote><p>  åœ¨çº³ç²¹çš„ææƒç»Ÿæ²»åˆ¶åº¦ä¸­ï¼Œå­¦æ ¡è¿›è¡Œçš„æ˜¯ä¸€ç§ç”±ç»Ÿæ²»æ”¿å…šæ„è¯†å½¢æ€æŒ‡æŒ¥çš„å…šåŒ–æ•™è‚²ã€‚è¿™ç§å…šåŒ–æ•™è‚²æ¸—é€åˆ°æ•™è‚²çš„æ¯ä¸€ä¸ªç¯èŠ‚ä¹‹ä¸­ï¼Œè€Œåœ¨æ¯ä¸€ä¸ªç¯èŠ‚ä¸­ä½¿è¿™ç§å…šåŒ–æ„è¯†å½¢æ€é¡ºåˆ©å‘ç”Ÿä½œç”¨çš„æ­£æ˜¯æ— æ•°ç›´æ¥ä»äº‹æ•™å­¦å·¥ä½œçš„æ•™å¸ˆã€‚å…šåŒ–æ•™è‚²è¿«ä½¿äººä»¬ä¸æ–­è¿›è¡Œæ€æƒ³çš„ç›¸äº’çº¯æ´å’Œè‡ªæˆ‘çº¯æ´ï¼Œå®ƒåœ¨è¯¾å ‚é‡Œå‘ç”Ÿä¹‹å‰ï¼Œæ—©å°±å…ˆå·²ç»åœ¨è®¸å¤šæ•™å¸ˆçš„å¤´è„‘ä¸­å‘ç”Ÿäº†ï¼Œå¹¶æˆä¸ºä»–ä»¬çš„æ€ç»´å’Œè¡Œä¸ºä¹ æƒ¯ã€‚æ²¡æœ‰è¿™æ ·çš„æ•™å¸ˆï¼Œå…šåŒ–æ•™è‚²æ˜¯ä¸å¯èƒ½åœ¨å­¦æ ¡é‡Œæœ‰æ•ˆè´¯å½»çš„ã€‚</p></blockquote><blockquote><p>  åœ¨ææƒå›½å®¶é‡Œï¼Œå›½æ°‘å¿…é¡»æœ‰ç›¸åŒçš„æ­£ç¡®è¡¨ç°ï¼Œæ•™å¸ˆåœ¨å­¦æ ¡é‡Œçš„è¡Œä¸ºè¢«å®Œå…¨æ¨¡å¼åŒ–äº†ã€‚æ•™å¸ˆä»¬éƒ½å¿ äºå…šï¼ŒæŒ‰å…šçš„è¦æ±‚å»åšï¼Œä»–ä»¬åœ¨å­¦æ ¡çš„è¡Œä¸ºå¹¶ä¸ä»…ä»…æ˜¯â€œå¥½æ•™å¸ˆâ€è¡Œä¸ºï¼ŒåŒæ—¶ä¹Ÿæ˜¯â€œå¥½å›½æ°‘â€è¡Œä¸ºã€‚å½“ä¸€ä¸ªâ€œå¥½å›½æ°‘â€ï¼Œå°±æ˜¯åƒæ‰€æœ‰å…¶ä»–å›½æ°‘ä¸€æ ·å¯¹é¢†è¢–ã€å…šå’Œå…šå›½è¡¨ç°ç»å¯¹çš„å¿ è¯šã€‚â€œ</p></blockquote><blockquote><p>  çº³ç²¹å¾·å›½å®è¡Œçš„æ˜¯ä¸€ç§å½»åº•çš„ä»¥å›½å®¶ä¸»ä¹‰ä¸ºæ——å·çš„å…šåŒ–æ•™è‚²ï¼Œè¿™ç§æ•™è‚²ä»å„¿ç«¥å¼€å§‹ï¼Œåœ¨è¯¾ç¨‹ã€æ•™å­¦ã€æ•™æã€å¸ˆç”Ÿå…³ç³»çš„æ¯ä¸€ä¸ªç¯èŠ‚ä¸Šéƒ½è´¯å½»çº³ç²¹çš„ææƒç»Ÿæ²»åŸåˆ™ã€‚</p></blockquote><blockquote><p>  åœ¨ã€Šææƒä¸»ä¹‰çš„èµ·æºã€‹ä¸€ä¹¦ä¸­ï¼Œæ±‰å¨œÂ·é˜¿ä¼¦ç‰¹ä»ææƒä¸»ä¹‰åŸå‹çš„ç‰¹ç‚¹ä¸­æ¦‚æ‹¬å‡ºå®ƒæˆåŠŸç»Ÿæ²»çš„ä¸‰å¤§è¦ç´ ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯æš´åŠ›å’Œææƒ§çš„ç»Ÿæ²»ï¼Œè¿«ä½¿äººæ°‘æˆä¸ºç›¸äº’éš”ç»çš„ã€æ— åŠ©æ— æ´çš„æ•£æ²™ä¸ªä½“ï¼Œä»¥åŠå……åˆ†è¿ç”¨â€œç»„ç»‡â€å’Œâ€œå®£ä¼ â€çš„åŠ›é‡ã€‚é˜¿ä¼¦ç‰¹äº²èº«ç»å†è¿‡å¥¹æ‰€æ€è€ƒçš„ææƒä¸»ä¹‰ä¸­æœ€ä¸ºæˆåŠŸçš„ä¸€ç§ï¼Œé‚£å°±æ˜¯å¾·å›½çº³ç²¹çš„ææƒã€‚å¥¹å¯¹ææƒä¸»ä¹‰ä¸‰è¦ç´ çš„æ€»ç»“ä¾¿æ˜¯ä»å¥¹çš„ç›´æ¥ç»éªŒä¸­è§‚å¯Ÿå¾—å‡ºçš„ã€‚</p></blockquote><blockquote><p>  å…šçš„å®£ä¼ è¦æ±‚æ–°é—»ä»â€œæ­£é¢æŠ¥é“â€ï¼Œæ‰€ä»¥æ€»æ˜¯å°½é‡ä¸è®©åæ¶ˆæ¯æ›å…‰ã€‚å®ƒè®¤ä¸ºï¼Œåæ¶ˆæ¯ä¸åˆ©äºç¨³å®šäººå¿ƒï¼Œä¹Ÿå¯èƒ½è¢«åˆ«äººåˆ©ç”¨ï¼Œæ‰€ä»¥ï¼Œåæ¶ˆæ¯ä¹Ÿæˆä¸ºä¸€ç§ä¸èƒ½æ³„éœ²çš„â€œå›½å®¶æœºå¯†â€ã€‚</p></blockquote><h3 id="ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶1-4"><a href="#ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶1-4" class="headerlink" title="ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶1-4"></a>ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶1-4</h3><h3 id="ä¸ƒå ‚æç®€ç‰©ç†è¯¾"><a href="#ä¸ƒå ‚æç®€ç‰©ç†è¯¾" class="headerlink" title="ä¸ƒå ‚æç®€ç‰©ç†è¯¾"></a>ä¸ƒå ‚æç®€ç‰©ç†è¯¾</h3><p>è™½ç„¶è¢«æ§å¾—å¾ˆå¥½ï¼Œä½†è§‰ç€æ²¡å•¥å¥½çœ‹çš„â€¦â€¦ğŸ™„</p><h2 id="6-æœˆ"><a href="#6-æœˆ" class="headerlink" title="6 æœˆ"></a>6 æœˆ</h2><h3 id="è¢«ç¦é”¢çš„å¤´è„‘"><a href="#è¢«ç¦é”¢çš„å¤´è„‘" class="headerlink" title="è¢«ç¦é”¢çš„å¤´è„‘"></a>è¢«ç¦é”¢çš„å¤´è„‘</h3><h3 id="å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾"><a href="#å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾" class="headerlink" title="å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾"></a>å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾</h3><p>ä¸é”™çš„å¤©ä½“ç‰©ç†å­¦ç§‘æ™®ï¼Œç®€å•è®²äº†ä¸‹å¤§çˆ†ç‚¸ã€æš´æ¶¨ã€é‡å­åŠ›å­¦ç­‰çŸ¥è¯†ï¼Œä»¥åŠå¦‚ä½•ç»™åœ°çƒç§°é‡é‡ã€å¦‚ä½•æµ‹é‡å¤©ä½“ä¹‹é—´çš„è·ç¦»ç­‰ã€‚</p><h3 id="å®‡å®™ä»èµ·æºåˆ°æœªæ¥"><a href="#å®‡å®™ä»èµ·æºåˆ°æœªæ¥" class="headerlink" title="å®‡å®™ä»èµ·æºåˆ°æœªæ¥"></a>å®‡å®™ä»èµ·æºåˆ°æœªæ¥</h3><p>ä½œè€…é˜µå®¹å¾ˆå¼º</p><h3 id="kubernetes-ç½‘ç»œæƒå¨æŒ‡å—"><a href="#kubernetes-ç½‘ç»œæƒå¨æŒ‡å—" class="headerlink" title="kubernetes ç½‘ç»œæƒå¨æŒ‡å—"></a>kubernetes ç½‘ç»œæƒå¨æŒ‡å—</h3><p>è¿™æ˜¯ä¸€æœ¬æŠ€æœ¯å¹²è´§ï¼Œå†™ä½œé£æ ¼å’Œåšå®¢æä¸ºç›¸ä¼¼ï¼Œä¸»è¦æ˜¯è®²äº†äº› kubernetes åŠå…¶å®¹å™¨ç½‘è·¯çš„åº•å±‚åŸç†ï¼Œæ˜¯å®¹å™¨ç½‘ç»œé‡Œéš¾å¾—çš„ä¸­æ–‡èµ„æ–™ï¼Œå€¼å¾—æ¨èã€‚</p><h3 id="å¤§è¯å¤„ç†å™¨"><a href="#å¤§è¯å¤„ç†å™¨" class="headerlink" title="å¤§è¯å¤„ç†å™¨"></a>å¤§è¯å¤„ç†å™¨</h3><h3 id="Linux-å¼€æºç½‘ç»œå…¨æ ˆè¯¦è§£ï¼šä»-DPDK-åˆ°-OpenFlow"><a href="#Linux-å¼€æºç½‘ç»œå…¨æ ˆè¯¦è§£ï¼šä»-DPDK-åˆ°-OpenFlow" class="headerlink" title="Linux å¼€æºç½‘ç»œå…¨æ ˆè¯¦è§£ï¼šä» DPDK åˆ° OpenFlow"></a>Linux å¼€æºç½‘ç»œå…¨æ ˆè¯¦è§£ï¼šä» DPDK åˆ° OpenFlow</h3><h3 id="ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶5"><a href="#ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶5" class="headerlink" title="ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶5"></a>ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶5</h3>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;blockquote&gt;
&lt;p&gt; 
        
      
    
    </summary>
    
    
    
      <category term="life" scheme="https://blog.k8s.li/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>æ·±å…¥æµ…å‡ºå®¹å™¨é•œåƒçš„ä¸€ç”ŸğŸ¤”</title>
    <link href="https://blog.k8s.li/Exploring-container-image.html"/>
    <id>https://blog.k8s.li/Exploring-container-image.html</id>
    <published>2020-06-13T16:00:00.000Z</published>
    <updated>2020-06-13T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸Šå‘¨åœ¨å†™<a href="https://blog.k8s.li/skopeo.html">ã€Šé•œåƒæ¬è¿å·¥ skopeo ã€‹</a> çš„æ—¶å€™çœ‹äº†å¾ˆå¤šå…³äºå®¹å™¨é•œåƒç›¸å…³çš„åšå®¢ï¼Œä»å¤§ä½¬ä»¬é‚£é‡Œå·å·å­¦äº†ä¸å°‘çŸ¥è¯†ï¼Œå¯¹å®¹å™¨é•œåƒæœ‰äº†ä¸€ç‚¹ç‚¹æ·±å…¥çš„äº†è§£ã€‚è¿™å‘¨æœ«ä¸€ä¸ªäººé—²ç€å®…åœ¨å®¶é‡Œæ²¡äº‹å°±æŠŠæœ€è¿‘æ‰€å­¦çš„çŸ¥è¯†æ•´ç†ä¸€ä¸‹åˆ†äº«å‡ºæ¥ï¼Œä¾›å¤§å®¶ä¸€èµ·æ¥é£Ÿç”¨ã€‚å†…å®¹æ¯”è¾ƒå¤šï¼Œè€å¿ƒçœ‹å®Œçš„è¯ï¼Œè¿˜æ˜¯èƒ½æ”¶è·ä¸€äº›<del>æ²¡ç”¨çš„</del>çŸ¥è¯†æ»´ğŸ˜‚ã€‚</p><h2 id="æ›´æ–°è®°å½•"><a href="#æ›´æ–°è®°å½•" class="headerlink" title="æ›´æ–°è®°å½•"></a>æ›´æ–°è®°å½•</h2><ul><li>2020-06-13ï¼šè¿˜æœ‰ä¸€äº›æ²¡æœ‰å†™å®Œï¼Œåç»­è¡¥å……</li><li>2020-06-06ï¼š åˆç¨¿</li><li>2020-09-02ï¼šè¡¥å……</li></ul><h2 id="é•œåƒæ˜¯æ€æ ·ç‚¼æˆçš„ğŸ¤”"><a href="#é•œåƒæ˜¯æ€æ ·ç‚¼æˆçš„ğŸ¤”" class="headerlink" title="é•œåƒæ˜¯æ€æ ·ç‚¼æˆçš„ğŸ¤”"></a>é•œåƒæ˜¯æ€æ ·ç‚¼æˆçš„ğŸ¤”</h2><p>æ‰€è°“ç‚¼æˆåƒå°±æ˜¯æ„å»ºé•œåƒå•¦ï¼Œä¸‹é¢ç”¨åˆ°çš„<strong>æ“</strong>å’Œ<strong>ç‚¼åˆ¶</strong>éƒ½æ˜¯æŒ‡çš„æ„å»ºé•œåƒå•¦ï¼Œåªæ˜¯ä¸ªäººä¹ æƒ¯ç”¨è¯­è€Œå·²ğŸ˜‚ã€‚</p><p>æåˆ°å®¹å™¨é•œåƒå°±ä¸å¾—ä¸æä¸€ä¸‹ OCI ï¼Œå³ Open Container Initiative æ—¨åœ¨å›´ç»•å®¹å™¨æ ¼å¼å’Œè¿è¡Œæ—¶åˆ¶å®šä¸€ä¸ªå¼€æ”¾çš„å·¥ä¸šåŒ–æ ‡å‡†ã€‚ç›®å‰ OCI ä¸»è¦æœ‰ä¸‰ä¸ªè§„èŒƒï¼šè¿è¡Œæ—¶è§„èŒƒ <a href="https://github.com/opencontainers/runtime-spec" target="_blank" rel="noopener">runtime-spec</a> ï¼Œé•œåƒè§„èŒƒ <a href="http://www.github.com/opencontainers/image-spec" target="_blank" rel="noopener">image-spec</a> ä»¥åŠä¸å¸¸è§çš„é•œåƒä»“åº“è§„èŒƒ <a href="https://github.com/opencontainers/distribution-spec" target="_blank" rel="noopener">distribution-spec</a> ã€‚å…³äº OCI è¿™äº›è§„èŒƒçš„ä½œç”¨çš„ä½œç”¨ï¼Œå°±å¼•ç”¨ä¸€ä¸‹ <a href="https://wilhelmguo.cn/blog/post/william/%E5%AE%B9%E5%99%A8%E5%BC%80%E6%94%BE%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83%EF%BC%88CRI-OCI%EF%BC%89-2" target="_blank" rel="noopener">å®¹å™¨å¼€æ”¾æ¥å£è§„èŒƒï¼ˆCRI OCIï¼‰</a> ä¸­çš„å†…å®¹ï¼Œæˆ‘ä¹Ÿå°±æ‡’å¾—è‡ªå·±ç»„ç»‡è¯­è¨€çŒæ°´äº†ğŸ˜‚ï¼ˆå‡‘å­—æ•°</p><blockquote><p>åˆ¶å®šå®¹å™¨æ ¼å¼æ ‡å‡†çš„å®—æ—¨æ¦‚æ‹¬æ¥è¯´å°±æ˜¯ä¸å—ä¸Šå±‚ç»“æ„çš„ç»‘å®šï¼Œå¦‚ç‰¹å®šçš„å®¢æˆ·ç«¯ã€ç¼–æ’æ ˆç­‰ï¼ŒåŒæ—¶ä¹Ÿä¸å—ç‰¹å®šçš„ä¾›åº”å•†æˆ–é¡¹ç›®çš„ç»‘å®šï¼Œå³ä¸é™äºæŸç§ç‰¹å®šæ“ä½œç³»ç»Ÿã€ç¡¬ä»¶ã€CPUæ¶æ„ã€å…¬æœ‰äº‘ç­‰ã€‚</p><p>è¿™ä¸¤ä¸ªåè®®é€šè¿‡ OCI runtime filesytem bundle çš„æ ‡å‡†æ ¼å¼è¿æ¥åœ¨ä¸€èµ·ï¼ŒOCI é•œåƒå¯ä»¥é€šè¿‡å·¥å…·è½¬æ¢æˆ bundleï¼Œç„¶å OCI å®¹å™¨å¼•æ“èƒ½å¤Ÿè¯†åˆ«è¿™ä¸ª bundle æ¥è¿è¡Œå®¹å™¨</p><ul><li>æ“ä½œæ ‡å‡†åŒ–ï¼šå®¹å™¨çš„æ ‡å‡†åŒ–æ“ä½œåŒ…æ‹¬ä½¿ç”¨æ ‡å‡†å®¹å™¨åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢å®¹å™¨ï¼Œä½¿ç”¨æ ‡å‡†æ–‡ä»¶ç³»ç»Ÿå·¥å…·å¤åˆ¶å’Œåˆ›å»ºå®¹å™¨å¿«ç…§ï¼Œä½¿ç”¨æ ‡å‡†åŒ–ç½‘ç»œå·¥å…·è¿›è¡Œä¸‹è½½å’Œä¸Šä¼ ã€‚</li><li>å†…å®¹æ— å…³ï¼šå†…å®¹æ— å…³æŒ‡ä¸ç®¡é’ˆå¯¹çš„å…·ä½“å®¹å™¨å†…å®¹æ˜¯ä»€ä¹ˆï¼Œå®¹å™¨æ ‡å‡†æ“ä½œæ‰§è¡Œåéƒ½èƒ½äº§ç”ŸåŒæ ·çš„æ•ˆæœã€‚å¦‚å®¹å™¨å¯ä»¥ç”¨åŒæ ·çš„æ–¹å¼ä¸Šä¼ ã€å¯åŠ¨ï¼Œä¸ç®¡æ˜¯PHPåº”ç”¨è¿˜æ˜¯MySQLæ•°æ®åº“æœåŠ¡ã€‚</li><li>åŸºç¡€è®¾æ–½æ— å…³ï¼šæ— è®ºæ˜¯ä¸ªäººçš„ç¬”è®°æœ¬ç”µè„‘è¿˜æ˜¯AWS S3ï¼Œäº¦æˆ–æ˜¯OpenStackï¼Œæˆ–è€…å…¶å®ƒåŸºç¡€è®¾æ–½ï¼Œéƒ½åº”è¯¥å¯¹æ”¯æŒå®¹å™¨çš„å„é¡¹æ“ä½œã€‚</li><li>ä¸ºè‡ªåŠ¨åŒ–é‡èº«å®šåˆ¶ï¼šåˆ¶å®šå®¹å™¨ç»Ÿä¸€æ ‡å‡†ï¼Œæ˜¯çš„æ“ä½œå†…å®¹æ— å…³åŒ–ã€å¹³å°æ— å…³åŒ–çš„æ ¹æœ¬ç›®çš„ä¹‹ä¸€ï¼Œå°±æ˜¯ä¸ºäº†å¯ä»¥ä½¿å®¹å™¨æ“ä½œå…¨å¹³å°è‡ªåŠ¨åŒ–ã€‚</li><li>å·¥ä¸šçº§äº¤ä»˜ï¼šåˆ¶å®šå®¹å™¨æ ‡å‡†ä¸€å¤§ç›®æ ‡ï¼Œå°±æ˜¯ä½¿è½¯ä»¶åˆ†å‘å¯ä»¥è¾¾åˆ°å·¥ä¸šçº§äº¤ä»˜æˆä¸ºç°å®</li></ul></blockquote><p>å…¶å® OCI è§„èŒƒå°±æ˜¯ä¸€å † markdown æ–‡ä»¶å•¦ï¼Œå†…å®¹ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œä¸åƒ RFC å’Œ ISO é‚£ä¹ˆé«˜æ·±è«æµ‹ï¼Œæ‰€ä»¥æ±æƒ³å¯¹å®¹å™¨é•œåƒæœ‰ä¸ªæ·±å…¥çš„äº†è§£è¿˜æ˜¯æ¨èå¤§å®¶å»è¯»ä¸€ä¸‹è¿™äº› markdown æ–‡ä»¶ğŸ˜‚ã€‚OCI è§„èŒƒæ˜¯å…è´¹çš„å“¦ï¼Œä¸åƒå¤§å¤šæ•° ISO è§„èŒƒè¿˜è¦äº¤é’±æ‰èƒ½çœ‹ï¼ˆï¸¶^ï¸¶ï¼‰å“¼ã€‚</p><h3 id="OCI-image-spec"><a href="#OCI-image-spec" class="headerlink" title="OCI image-spec"></a>OCI image-spec</h3><p>OCI è§„èŒƒä¸­çš„é•œåƒè§„èŒƒ <a href="http://www.github.com/opencontainers/image-spec" target="_blank" rel="noopener">image-spec</a> å†³å®šäº†æˆ‘ä»¬çš„é•œåƒæŒ‰ç…§ä»€ä¹ˆæ ‡å‡†æ¥æ„å»ºï¼Œä»¥åŠæ„å»ºå®Œé•œåƒä¹‹åå¦‚ä½•å­˜æ”¾ï¼Œæ¥ç€ä¸‹æ–‡æåˆ°çš„ Dockerfile åˆ™å†³å®šäº†é•œåƒçš„ layer å†…å®¹ä»¥åŠé•œåƒçš„ä¸€äº›å…ƒæ•°æ®ä¿¡æ¯ã€‚ä¸€ä¸ªé•œåƒè§„èŒƒ image-spec å’Œä¸€ä¸ª Dockerfile å°±æŒ‡å¯¼ç€æˆ‘ä»¬æ„å»ºä¸€ä¸ªé•œåƒï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±ç®€å•äº†è§£ä¸€ä¸‹è¿™ä¸ªé•œåƒè§„èŒƒï¼Œçœ‹çœ‹é•œåƒæ˜¯é•¿ä»€ä¹ˆæ ·å­çš„ï¼Œå¯¹é•œåƒæœ‰ä¸ªå¤§ä½“çš„ä¸»è§‚è®¤è¯†ã€‚</p><p>æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„æè¿°ï¼ŒOCI é•œåƒè§„èŒƒçš„ä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ª markdown æ–‡ä»¶ç»„æˆï¼š</p><blockquote><ul><li><a href="https://github.com/opencontainers/image-spec/blob/master/manifest.md" target="_blank" rel="noopener">Image Manifest</a> - a document describing the components that make up a container image</li><li><a href="https://github.com/opencontainers/image-spec/blob/master/image-index.md" target="_blank" rel="noopener">Image Index</a> - an annotated index of image manifests</li><li><a href="https://github.com/opencontainers/image-spec/blob/master/image-layout.md" target="_blank" rel="noopener">Image Layout</a> - a filesystem layout representing the contents of an image</li><li><a href="https://github.com/opencontainers/image-spec/blob/master/layer.md" target="_blank" rel="noopener">Filesystem Layer</a> - a changeset that describes a containerâ€™s filesystem</li><li><a href="https://github.com/opencontainers/image-spec/blob/master/config.md" target="_blank" rel="noopener">Image Configuration</a> - a document determining layer ordering and configuration of the image suitable for translation into a <a href="https://github.com/opencontainers/runtime-spec" target="_blank" rel="noopener">runtime bundle</a></li><li><a href="https://github.com/opencontainers/image-spec/blob/master/conversion.md" target="_blank" rel="noopener">Conversion</a> - a document describing how this translation should occur</li><li><a href="https://github.com/opencontainers/image-spec/blob/master/descriptor.md" target="_blank" rel="noopener">Descriptor</a> - a reference that describes the type, metadata and content address of referenced content</li></ul></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ annotations.md         # æ³¨è§£è§„èŒƒ</span><br><span class="line">â”œâ”€â”€ config.md              # image config æ–‡ä»¶è§„èŒƒ</span><br><span class="line">â”œâ”€â”€ considerations.md      # æ³¨æ„äº‹é¡¹</span><br><span class="line">â”œâ”€â”€ conversion.md          # è½¬æ¢ä¸º OCI è¿è¡Œæ—¶</span><br><span class="line">â”œâ”€â”€ descriptor.md          # OCI Content Descriptors å†…å®¹æè¿°</span><br><span class="line">â”œâ”€â”€ image-index.md         # manifest list æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ image-layout.md        # é•œåƒçš„å¸ƒå±€</span><br><span class="line">â”œâ”€â”€ implementations.md     # ä½¿ç”¨ OCI è§„èŒƒçš„é¡¹ç›®</span><br><span class="line">â”œâ”€â”€ layer.md               # é•œåƒå±‚ layer è§„èŒƒ</span><br><span class="line">â”œâ”€â”€ manifest.md            # manifest è§„èŒƒ</span><br><span class="line">â”œâ”€â”€ media-types.md         # æ–‡ä»¶ç±»å‹</span><br><span class="line">â”œâ”€â”€ README.md              # README æ–‡æ¡£</span><br><span class="line">â”œâ”€â”€ spec.md                # OCI é•œåƒè§„èŒƒçš„æ¦‚è§ˆ</span><br></pre></td></tr></table></figure><p>æ€»ç»“ä»¥ä¸Šå‡ ä¸ª markdown æ–‡ä»¶ï¼Œ OCI å®¹å™¨é•œåƒè§„èŒƒä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ å—å†…å®¹ï¼š</p><h4 id="layer"><a href="#layer" class="headerlink" title="layer"></a>layer</h4><p><a href="https://github.com/opencontainers/image-spec/blob/master/layer.md" target="_blank" rel="noopener">æ–‡ä»¶ç³»ç»Ÿ</a>ï¼šä»¥ layer ï¼ˆé•œåƒå±‚ï¼‰ä¿å­˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯ä¸ª layer ä¿å­˜äº†å’Œä¸Šå±‚ä¹‹é—´å˜åŒ–çš„éƒ¨åˆ†ï¼Œlayer åº”è¯¥ä¿å­˜å“ªäº›æ–‡ä»¶ï¼Œæ€ä¹ˆè¡¨ç¤ºå¢åŠ ã€ä¿®æ”¹å’Œåˆ é™¤çš„æ–‡ä»¶ç­‰ã€‚</p><h4 id="image-config"><a href="#image-config" class="headerlink" title="image config"></a>image config</h4><p><a href="https://github.com/opencontainers/image-spec/blob/master/config.md" target="_blank" rel="noopener">image config æ–‡ä»¶</a>ï¼šä¿å­˜äº†æ–‡ä»¶ç³»ç»Ÿçš„å±‚çº§ä¿¡æ¯ï¼ˆæ¯ä¸ªå±‚çº§çš„ hash å€¼ï¼Œä»¥åŠå†å²ä¿¡æ¯ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡Œæ—¶éœ€è¦çš„ä¸€äº›ä¿¡æ¯ï¼ˆæ¯”å¦‚ç¯å¢ƒå˜é‡ã€å·¥ä½œç›®å½•ã€å‘½ä»¤å‚æ•°ã€mount åˆ—è¡¨ï¼‰ï¼ŒæŒ‡å®šäº†é•œåƒåœ¨æŸä¸ªç‰¹å®šå¹³å°å’Œç³»ç»Ÿçš„é…ç½®ï¼Œæ¯”è¾ƒæ¥è¿‘æˆ‘ä»¬ä½¿ç”¨ <code>docker inspect &lt;image_id&gt;</code> çœ‹åˆ°çš„å†…å®¹ã€‚</p><ul><li>example</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">  <span class="attr">"config"</span>: &#123;</span><br><span class="line">    <span class="attr">"Hostname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"User"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"bash"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Image"</span>: <span class="string">"sha256:ba8f577813c7bdf6b737f638dffbc688aa1df2ff28a826a6c46bae722977b549"</span>,</span><br><span class="line">    <span class="attr">"Volumes"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Entrypoint"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OnBuild"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"Labels"</span>: <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"container"</span>: <span class="string">"38501d5aa48c080884f4dc6fd4b1b6590ff1607d9e7a12e1cef1d86a3fdc32df"</span>,</span><br><span class="line">  <span class="attr">"container_config"</span>: &#123;</span><br><span class="line">    <span class="attr">"Hostname"</span>: <span class="string">"38501d5aa48c"</span>,</span><br><span class="line">    <span class="attr">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"User"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"/bin/sh"</span>,</span><br><span class="line">      <span class="string">"-c"</span>,</span><br><span class="line">      <span class="string">"#(nop) "</span>,</span><br><span class="line">      <span class="string">"CMD [\"bash\"]"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Image"</span>: <span class="string">"sha256:ba8f577813c7bdf6b737f638dffbc688aa1df2ff28a826a6c46bae722977b549"</span>,</span><br><span class="line">    <span class="attr">"Volumes"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Entrypoint"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OnBuild"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"Labels"</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"created"</span>: <span class="string">"2020-06-07T01:59:47.348924716Z"</span>,</span><br><span class="line">  <span class="attr">"docker_version"</span>: <span class="string">"19.03.5"</span>,</span><br><span class="line">  <span class="attr">"history"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-06-07T01:59:46.877600299Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop) ADD file:a82014afc29e7b364ac95223b22ebafad46cc9318951a85027a49f9ce1a99461 in / "</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-06-07T01:59:47.348924716Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop)  CMD [\"bash\"]"</span>,</span><br><span class="line">      <span class="attr">"empty_layer"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">  <span class="attr">"rootfs"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"layers"</span>,</span><br><span class="line">    <span class="attr">"diff_ids"</span>: [</span><br><span class="line">      <span class="string">"sha256:d1b85e6186f67d9925c622a7a6e66faa447e767f90f65ae47cdc817c629fa956"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="manifest"><a href="#manifest" class="headerlink" title="manifest"></a>manifest</h4><p><a href="https://github.com/opencontainers/image-spec/blob/master/manifest.md" target="_blank" rel="noopener">manifest æ–‡ä»¶</a> ï¼šé•œåƒçš„ config æ–‡ä»¶ç´¢å¼•ï¼Œæœ‰å“ªäº› layerï¼Œé¢å¤–çš„ annotation ä¿¡æ¯ï¼Œmanifest æ–‡ä»¶ä¸­ä¿å­˜äº†å¾ˆå¤šå’Œå½“å‰å¹³å°æœ‰å…³çš„ä¿¡æ¯ã€‚å¦å¤– manifest ä¸­çš„ layer å’Œ config ä¸­çš„ layer è¡¨è¾¾çš„è™½ç„¶éƒ½æ˜¯é•œåƒçš„ layer ï¼Œä½†äºŒè€…ä»£è¡¨çš„æ„ä¹‰ä¸å¤ªä¸€æ ·ï¼Œç¨åä¼šè®²åˆ°ã€‚manifest æ–‡ä»¶æ˜¯å­˜æ”¾åœ¨ registry ä¸­ï¼Œå½“æˆ‘ä»¬æ‹‰å–é•œåƒçš„æ—¶å€™ï¼Œä¼šæ ¹æ®è¯¥æ–‡ä»¶æ‹‰å–ç›¸åº”çš„ layer ã€‚æ ¹æ® OCI image-spec è§„èŒƒä¸­ <a href="https://github.com/opencontainers/image-spec/blob/master/manifest.md" target="_blank" rel="noopener">OCI Image Manifest Specification</a> çš„å®šä¹‰å¯ä»¥å¾—çŸ¥ï¼Œé•œåƒçš„ manifest æ–‡ä»¶ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªç›®æ ‡ï¼šï¼ˆè‹±è¯­ä¸å¥½å°±ä¸ç¿»è¯‘äº†ğŸ˜¥</p><blockquote><p>There are three main goals of the Image Manifest Specification.</p><ul><li>The first goal is content-addressable images, by supporting an image model where the imageâ€™s configuration can be hashed to generate a unique ID for the image and its components.</li><li>The second goal is to allow multi-architecture images, through a â€œfat manifestâ€ which references image manifests for platform-specific versions of an image. In OCI, this is codified in an <a href="https://github.com/opencontainers/image-spec/blob/master/image-index.md" target="_blank" rel="noopener">image index</a>.</li><li>The third goal is to be <a href="https://github.com/opencontainers/image-spec/blob/master/conversion.md" target="_blank" rel="noopener">translatable</a> to the <a href="https://github.com/opencontainers/runtime-spec" target="_blank" rel="noopener">OCI Runtime Specification</a>.</li></ul></blockquote><p>å¦å¤– manifest ä¹Ÿåˆ†å¥½å‡ ä¸ªç‰ˆæœ¬ï¼Œç›®å‰ä¸»æµçš„ç‰ˆæœ¬æ˜¯  <code>Manifest Version 2, Schema 2</code> ï¼Œå¯ä»¥å‚è€ƒ docker çš„å®˜æ–¹æ–‡æ¡£ <a href="https://github.com/docker/distribution/blob/master/docs/spec/manifest-v2-2.md" target="_blank" rel="noopener">Image Manifest Version 2, Schema 2</a> ã€‚registry ä¸­ä¼šæœ‰ä¸ª <code>Manifest List</code> æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æ˜¯ä¸ºä¸åŒå¤„ç†å™¨ä½“ç³»æ¶æ„è€Œè®¾è®¡çš„ï¼Œé€šè¿‡è¯¥æ–‡ä»¶æŒ‡å‘ä¸è¯¥å¤„ç†å™¨ä½“ç³»æ¶æ„ç›¸å¯¹åº”çš„ Image Manifest ï¼Œè¿™ä¸€ç‚¹ä¸è¦ææ··ã€‚</p><ul><li>Example Manifest List</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.list.v2+json"</span>,</span><br><span class="line">  <span class="attr">"manifests"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">7143</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:e692418e4cbaf90ca69d05a66403747baa33ee08806650b51fab815ad7fc331f"</span>,</span><br><span class="line">      <span class="attr">"platform"</span>: &#123;</span><br><span class="line">        <span class="attr">"architecture"</span>: <span class="string">"ppc64le"</span>,</span><br><span class="line">        <span class="attr">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">7682</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:5b0bcabd1ed22e9fb1310cf6c2dec7cdef19f0ad69efa1f392e94a4333501270"</span>,</span><br><span class="line">      <span class="attr">"platform"</span>: &#123;</span><br><span class="line">        <span class="attr">"architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">        <span class="attr">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">        <span class="attr">"features"</span>: [</span><br><span class="line">          <span class="string">"sse4"</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Image Manifest</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "schemaVersion": 2,</span><br><span class="line">  "mediaType": "application/vnd.docker.distribution.manifest.v2+json",</span><br><span class="line">  "config": &#123;</span><br><span class="line">    "mediaType": "application/vnd.docker.container.image.v1+json",</span><br><span class="line">    "size": 1509,</span><br><span class="line">    "digest": "sha256:a24bb4013296f61e89ba57005a7b3e52274d8edd3ae2077d04395f806b63d83e"</span><br><span class="line">  &#125;,</span><br><span class="line">  "layers": [</span><br><span class="line">    &#123;</span><br><span class="line">      "mediaType": "application/vnd.docker.image.rootfs.diff.tar.gzip",</span><br><span class="line">      "size": 5844992,</span><br><span class="line">      "digest": "sha256:50644c29ef5a27c9a40c393a73ece2479de78325cae7d762ef3cdc19bf42dd0a"</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åå†è¡¥å……ä¸€æ®µé«˜ç­–å¤§ä½¬çš„ <a href="http://gaocegege.com/Blog/ormb" target="_blank" rel="noopener">è§£é‡Š</a> ï¼š</p><blockquote><p>Manifest æ˜¯ä¸€ä¸ª JSON æ–‡ä»¶ï¼Œå…¶å®šä¹‰åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ <a href="https://github.com/opencontainers/image-spec/blob/master/config.md" target="_blank" rel="noopener">Config</a> å’Œ <a href="https://github.com/opencontainers/image-spec/blob/master/layer.md" target="_blank" rel="noopener">Layers</a>ã€‚Config æ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼ŒLayers æ˜¯ä¸€ä¸ªç”± JSON å¯¹è±¡ç»„æˆçš„æ•°ç»„ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒConfig ä¸ Layers ä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡çš„ç»“æ„ç›¸åŒï¼Œéƒ½åŒ…æ‹¬ä¸‰ä¸ªå­—æ®µï¼Œåˆ†åˆ«æ˜¯ digestã€mediaType å’Œ sizeã€‚å…¶ä¸­ digest å¯ä»¥ç†è§£ä¸ºæ˜¯è¿™ä¸€å¯¹è±¡çš„ IDã€‚mediaType è¡¨æ˜äº†è¿™ä¸€å†…å®¹çš„ç±»å‹ã€‚size æ˜¯è¿™ä¸€å†…å®¹çš„å¤§å°ã€‚</p><p>å®¹å™¨é•œåƒçš„ Config æœ‰ç€å›ºå®šçš„ mediaType <code>application/vnd.oci.image.config.v1+json</code>ã€‚ä¸€ä¸ª Config çš„ç¤ºä¾‹é…ç½®å¦‚ä¸‹ï¼Œå®ƒè®°å½•äº†å…³äºå®¹å™¨é•œåƒçš„é…ç½®ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯é•œåƒçš„å…ƒæ•°æ®ã€‚é€šå¸¸å®ƒä¼šè¢«é•œåƒä»“åº“ç”¨æ¥åœ¨ UI ä¸­å±•ç¤ºä¿¡æ¯ï¼Œä»¥åŠåŒºåˆ†ä¸åŒæ“ä½œç³»ç»Ÿçš„æ„å»ºç­‰ã€‚</p><p>è€Œå®¹å™¨é•œåƒçš„ Layers æ˜¯ç”±å¤šå±‚ mediaType ä¸º <code>application/vnd.oci.image.layer.v1.*</code>ï¼ˆå…¶ä¸­æœ€å¸¸è§çš„æ˜¯ <code>application/vnd.oci.image.layer.v1.tar+gzip</code>) çš„å†…å®¹ç»„æˆçš„ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œå®¹å™¨é•œåƒæ˜¯åˆ†å±‚æ„å»ºçš„ï¼Œæ¯ä¸€å±‚å°±å¯¹åº”ç€ Layers ä¸­çš„ä¸€ä¸ªå¯¹è±¡ã€‚</p><p>å®¹å™¨é•œåƒçš„ Configï¼Œå’Œ Layers ä¸­çš„æ¯ä¸€å±‚ï¼Œéƒ½æ˜¯ä»¥ Blob çš„æ–¹å¼å­˜å‚¨åœ¨é•œåƒä»“åº“ä¸­çš„ï¼Œå®ƒä»¬çš„ digest ä½œä¸º Key å­˜åœ¨ã€‚å› æ­¤ï¼Œåœ¨è¯·æ±‚åˆ°é•œåƒçš„ Manifest åï¼ŒDocker ä¼šåˆ©ç”¨ digest å¹¶è¡Œä¸‹è½½æ‰€æœ‰çš„ Blobsï¼Œå…¶ä¸­å°±åŒ…æ‹¬ Config å’Œæ‰€æœ‰çš„ Layersã€‚</p></blockquote><h4 id="image-manifest-index"><a href="#image-manifest-index" class="headerlink" title="image manifest index"></a>image manifest index</h4><p><a href="https://github.com/opencontainers/image-spec/blob/master/image-index.md" target="_blank" rel="noopener">index æ–‡ä»¶</a> ï¼šå…¶å®å°±æ˜¯æˆ‘ä»¬ä¸Šé¢æåˆ°çš„ Manifest List å•¦ã€‚åœ¨ docker çš„ <a href="https://github.com/docker/distribution" target="_blank" rel="noopener">distribution</a> ä¸­ç§°ä¹‹ä¸º <code>Manifest List</code> åœ¨ OCI ä¸­å°±å« <a href="https://github.com/opencontainers/image-spec/blob/master/image-index.md" target="_blank" rel="noopener">OCI Image Index Specification</a> ã€‚å…¶å®ä¸¤è€…æ˜¯æŒ‡çš„åŒä¸€ä¸ªæ–‡ä»¶ï¼Œç”šè‡³ä¸¤è€… GitHub ä¸Šæ–‡æ¡£ç»™çš„ example éƒ½ä¸€ä¸€æ¨¡æ ·ğŸ¤£ï¼Œåº”è¯¥æ˜¯ OCI å¤åˆ¶ç²˜è´´ Docker çš„æ–‡æ¡£ğŸ˜‚ã€‚index æ–‡ä»¶æ˜¯ä¸ªå¯é€‰çš„æ–‡ä»¶ï¼ŒåŒ…å«ç€ä¸€ä¸ªåˆ—è¡¨ä¸ºåŒä¸€ä¸ªé•œåƒä¸åŒçš„å¤„ç†å™¨ arch æŒ‡å‘ä¸åŒå¹³å°çš„ manifest æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶èƒ½ä¿è¯ä¸€ä¸ªé•œåƒå¯ä»¥è·¨å¹³å°ä½¿ç”¨ï¼Œæ¯ä¸ªå¤„ç†å™¨ arch å¹³å°æ‹¥æœ‰ä¸åŒçš„ manifest æ–‡ä»¶ï¼Œä½¿ç”¨ index ä½œä¸ºç´¢å¼•ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ arm æ¶æ„çš„å¤„ç†å™¨æ—¶è¦é¢å¤–æ³¨æ„ï¼Œåœ¨æ‹‰å–é•œåƒçš„æ—¶å€™è¦æ‹‰å– arm æ¶æ„çš„é•œåƒï¼Œä¸€èˆ¬å¤„ç†å™¨çš„æ¶æ„éƒ½æ¥åœ¨é•œåƒçš„ tag åé¢ï¼Œé»˜è®¤ latest tag çš„é•œåƒæ˜¯ x86 çš„ï¼Œåœ¨ arm å¤„ç†å™¨çš„æœºå™¨è¿™äº›é•œåƒä¸Šæ˜¯è·‘ä¸èµ·æ¥çš„ã€‚</p><h3 id="å„ç§-id-åˆ†ä¸æ¸…ï¼Ÿ"><a href="#å„ç§-id-åˆ†ä¸æ¸…ï¼Ÿ" class="headerlink" title="å„ç§ id åˆ†ä¸æ¸…ï¼Ÿ"></a>å„ç§ id åˆ†ä¸æ¸…ï¼Ÿ</h3><p>çœ‹å®Œ  <a href="http://www.github.com/opencontainers/image-spec" target="_blank" rel="noopener">image-spec</a> é‡Œé¢æåˆ°çš„å„ç§ id ç›¸ä¿¡ä½ åˆå¾ˆå¤šç–‘æƒ‘ï¼Œåœ¨æ­¤æ€»ç»“ä¸€ä¸‹è¿™äº› id çš„ä½œç”¨ï¼š</p><table><thead><tr><th align="center">image-id</th><th>image config çš„ sha256 å“ˆå¸Œå€¼ï¼Œåœ¨æœ¬åœ°é•œåƒå­˜å‚¨ä¸­ç”±å®ƒå”¯ä¸€æ ‡è¯†ä¸€ä¸ªé•œåƒ</th></tr></thead><tbody><tr><td align="center">image digest</td><td>åœ¨ registry ä¸­çš„ image manifest çš„ sha256 å“ˆå¸Œå€¼ï¼Œåœ¨ registry ä¸­ç”±å®ƒå”¯ä¸€æ ‡è¯†ä¸€ä¸ªé•œåƒ</td></tr><tr><td align="center">diff_ids</td><td>é•œåƒæ¯ä¸€å±‚çš„ id ï¼Œæ˜¯å¯¹ layer çš„æœªå‹ç¼©çš„ tar åŒ…çš„ sha256 å“ˆå¸Œå€¼</td></tr><tr><td align="center">layer digest</td><td>é•œåƒåœ¨ registry å­˜å‚¨ä¸­çš„ id ï¼Œæ˜¯å¯¹ layerå‹ç¼©åçš„ tar åŒ…çš„ sha256 å“ˆå¸Œå€¼</td></tr></tbody></table><p>é•œåƒçš„ image config ä¸­çš„ <code>rootfs</code> å­—æ®µè®°å½•äº†æ¯ä¸€å±‚ layer çš„ idï¼Œè€Œé•œåƒçš„ layer id åˆ™æ˜¯ layer tar åŒ…çš„ sha256 å€¼ï¼Œå¦‚æœé•œåƒçš„ layer æ”¹å˜ï¼Œåˆ™è¿™ä¸ª layer id ä¼šæ”¹å˜ï¼Œè€Œè®°å½•å®ƒçš„ image config å†…å®¹ä¹Ÿä¼šæ”¹å˜ï¼Œimage config å†…å®¹å˜äº†ï¼Œimage config æ–‡ä»¶çš„ sha256 å€¼ä¹Ÿå°±ä¼šæ”¹å˜ï¼Œè¿™æ ·å°±å¯ä»¥ç”± image id å’Œ image digest å”¯ä¸€æ ‡è¯†ä¸€ä¸ªé•œåƒï¼Œè¾¾åˆ°é˜²æ²»ç¯¡æ”¹çš„å®‰å…¨ç›®çš„ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">"rootfs": &#123;</span><br><span class="line">    "type": "layers",</span><br><span class="line">    "diff_ids": [</span><br><span class="line">      <span class="string">"sha256:d1b85e6186f67d9925c622a7a6e66faa447e767f90f65ae47cdc817c629fa956"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><p>ä¼—æ‰€å‘¨çŸ¥ docker é•œåƒéœ€è¦ä¸€ä¸ª Dockerfile æ¥æ„å»ºè€Œæˆï¼Œå½“æˆ‘ä»¬å¯¹ OCI é•œåƒè§„èŒƒæœ‰äº†ä¸ªå¤§è‡´çš„äº†è§£ä¹‹åï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±æ‹¿ç€ Dockerfile è¿™ä¸ª â€å›¾çº¸â€œ å»ä¸€æ­¥æ­¥æ„å»ºé•œåƒã€‚æœ¬æ–‡ä¸å†ç»†è®² Dockerfile çš„è¯¦ç»†ä¹¦å†™å’ŒæŠ€å·§ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šä¼—æ‰€å‘¨çŸ¥çš„å…³äºå†™å¥½ Dockerfile çš„æŠ€å·§ï¼Œæ¯”å¦‚æˆ‘ä¹‹å‰æ°´è¿‡çš„ä¸€ç¯‡ <a href="https://blog.k8s.li/dockerfile-tips.html">Dockerfile æ“é•œåƒçš„å°æŠ€å·§</a> ã€‚</p><p>ä¸‹é¢å°±æ˜¯ <a href="https://webp.sh" target="_blank" rel="noopener">webp server go</a> Dockerfile çš„ä¾‹å­ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> golang:alpine as builder</span><br><span class="line"><span class="keyword">ARG</span> IMG_PATH=/opt/pics</span><br><span class="line"><span class="keyword">ARG</span> EXHAUST_PATH=/opt/exhaust</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apk update ;\</span></span><br><span class="line"><span class="bash">    apk add alpine-sdk ;\</span></span><br><span class="line"><span class="bash">    git <span class="built_in">clone</span> https://github.com/webp-sh/webp_server_go /build ;\</span></span><br><span class="line"><span class="bash">    <span class="built_in">cd</span> /build ;\</span></span><br><span class="line"><span class="bash">    sed -i <span class="string">"s|.\/pics|<span class="variable">$&#123;IMG_PATH&#125;</span>|g"</span> config.json ;\</span></span><br><span class="line"><span class="bash">    sed -i <span class="string">"s|\"\"|\"<span class="variable">$&#123;EXHAUST_PATH&#125;</span>\"|g"</span> config.json ;\</span></span><br><span class="line"><span class="bash">    sed -i <span class="string">'s/127.0.0.1/0.0.0.0/g'</span> config.json</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /build</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> go build -o webp-server .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> alpine</span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> --from=builder /build/webp-server  /usr/bin/webp-server</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> --from=builder /build/config.json /etc/config.json</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /opt</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /opt/exhaust</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"/usr/bin/webp-server"</span>, <span class="string">"--config"</span>, <span class="string">"/etc/config.json"</span>]</span></span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ RUN æŒ‡ä»¤çš„æ¯è¡Œç»“å°¾æˆ‘ä½¿ç”¨çš„æ˜¯ <code>;\</code> æ¥æ¥ä¸‹ä¸€è¡Œ shell ï¼Œå¦ä¸€ç§å†™æ³•æ˜¯ <code>&amp;&amp;</code> ã€‚äºŒè€…æœ‰æœ¬è´¨çš„åŒºåˆ«ï¼Œæ¯”å¦‚ COMMAND 1;COMMAND 2 ï¼Œå½“ COMMAND 1 è¿è¡Œå¤±è´¥æ—¶ä¼šç»§ç»­è¿è¡Œ COMMAND2 ï¼Œå¹¶ä¸ä¼šé€€å‡ºã€‚è€Œ COMMAND 1&amp;&amp; COMMAND 2ï¼Œæ—¶ COMMAND 1 è¿è¡ŒæˆåŠŸæ—¶æ‰æ¥ç€è¿è¡Œ COMMAND 2 ï¼ŒCOMMAND 1 è¿è¡Œå¤±è´¥ä¼šé€€å‡ºã€‚å¦‚æœæ²¡æœ‰åè¶³çš„æŠŠæ¡ä¿è¯æ¯ä¸€è¡Œ shell éƒ½èƒ½æ¯æ¬¡è¿è¡ŒæˆåŠŸå»ºè®®ç”¨ <code>&amp;&amp;</code> ï¼Œè¿™æ ·å¤±è´¥äº†å°±é€€å‡ºæ„å»ºé•œåƒï¼Œä¸ç„¶æ„å»ºå‡ºæ¥çš„é•œåƒä¼šæœ‰é—®é¢˜ã€‚å¦‚æœæ˜¯è€å¸æœºğŸš— çš„è¯å»ºè®®ç”¨ <code>;</code> ï¼Œé€›äº†ä¸€åœˆ docker hub å®˜æ–¹é•œåƒä¸­ç”¨ <code>;</code> è¾ƒå¤šä¸€äº›ï¼Œå› ä¸º <code>;</code> æ¯” <code>&amp;&amp;</code> è¦ç¾è§‚ä¸€äº›ï¼ˆå¤§é›¾ğŸ˜‚ã€‚</p><ul><li>é£æ ¼ä¸€ï¼šæ¯”å¦‚ <a href="https://github.com/nginxinc/docker-nginx/blob/master/stable/buster/Dockerfile" target="_blank" rel="noopener">nginx</a> å®˜æ–¹é•œåƒæ˜¯ç”¨çš„ <code>&amp;&amp;</code>ï¼Œè²Œä¼¼ä¹Ÿæ··å…¥äº† <code>;</code>ğŸ¤£</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">RUN set -x \</span><br><span class="line"><span class="meta">#</span><span class="bash"> create nginx user/group first, to be consistent throughout docker variants</span></span><br><span class="line">    &amp;&amp; addgroup --system --gid 101 nginx \</span><br><span class="line">    &amp;&amp; adduser --system --disabled-login --ingroup nginx --no-create-home --home /nonexistent --gecos "nginx user" --shell /bin/false --uid 101 nginx \</span><br><span class="line">    &amp;&amp; apt-get update \</span><br><span class="line">    &amp;&amp; apt-get install --no-install-recommends --no-install-suggests -y gnupg1 ca-certificates \</span><br><span class="line">    &amp;&amp; \</span><br><span class="line">    NGINX_GPGKEY=573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62; \</span><br><span class="line">    found=''; \</span><br><span class="line">    for server in \</span><br><span class="line">        ha.pool.sks-keyservers.net \</span><br><span class="line">        hkp://keyserver.ubuntu.com:80 \</span><br><span class="line">        hkp://p80.pool.sks-keyservers.net:80 \</span><br><span class="line">        pgp.mit.edu \</span><br><span class="line">    ; do \</span><br></pre></td></tr></table></figure><ul><li>é£æ ¼äºŒï¼šæ¯”å¦‚ <a href="https://github.com/docker-library/redis/blob/23af5b6adb271bcebbcebc93308884438512a4af/6.0/Dockerfile" target="_blank" rel="noopener">redis</a> å®˜æ–¹é•œåƒå°±æ¸…ä¸€è‰²ä½¿ç”¨çš„ <code>;</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">RUN set -eux; \</span><br><span class="line">savedAptMark="$(apt-mark showmanual)"; \</span><br><span class="line">apt-get update; \</span><br><span class="line">apt-get install -y --no-install-recommends ca-certificates dirmngr gnupg wget; \</span><br><span class="line">rm -rf /var/lib/apt/lists/*; \</span><br><span class="line">dpkgArch="$(dpkg --print-architecture | awk -F- '&#123; print $NF &#125;')"; \</span><br><span class="line">wget -O /usr/local/bin/gosu "https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch"; \</span><br><span class="line">wget -O /usr/local/bin/gosu.asc "https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc"; \</span><br><span class="line">export GNUPGHOME="$(mktemp -d)"; \</span><br><span class="line">gpg --batch --keyserver hkps://keys.openpgp.org --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4; \</span><br><span class="line">gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu; \</span><br><span class="line">gpgconf --kill all; \</span><br><span class="line">rm -rf "$GNUPGHOME" /usr/local/bin/gosu.asc; \</span><br><span class="line">apt-mark auto '.*' &gt; /dev/null; \</span><br><span class="line">[ -z "$savedAptMark" ] || apt-mark manual $savedAptMark &gt; /dev/null; \</span><br><span class="line">apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \</span><br><span class="line">chmod +x /usr/local/bin/gosu; \</span><br><span class="line">gosu --version; \</span><br><span class="line">gosu nobody true</span><br></pre></td></tr></table></figure><p>æ±å–œæ¬¢å“ªç§é£æ ¼å‘¢ï¼Ÿå¿«åœ¨è¯„è®ºåŒºç•™è¨€å§ğŸ˜‹</p><h4 id="é•œåƒå·¥å‚ğŸ› "><a href="#é•œåƒå·¥å‚ğŸ› " class="headerlink" title="é•œåƒå·¥å‚ğŸ› "></a>é•œåƒå·¥å‚ğŸ› </h4><blockquote><p>Docker æ˜¯ä¸€ä¸ªå…¸å‹çš„ C/S æ¶æ„çš„åº”ç”¨ï¼Œåˆ†ä¸º Docker å®¢æˆ·ç«¯ï¼ˆå³å¹³æ—¶æ•²çš„ docker å‘½ä»¤ï¼‰ Docker æœåŠ¡ç«¯ï¼ˆdockerd å®ˆæŠ¤è¿›ç¨‹ï¼‰ã€‚</p><p>Docker å®¢æˆ·ç«¯é€šè¿‡ REST API å’ŒæœåŠ¡ç«¯è¿›è¡Œäº¤äº’ï¼Œdocker å®¢æˆ·ç«¯æ¯å‘é€ä¸€æ¡æŒ‡ä»¤ï¼Œåº•å±‚éƒ½ä¼šè½¬åŒ–æˆ REST API è°ƒç”¨çš„å½¢å¼å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å¤„ç†å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚å¹¶ç»™å‡ºå“åº”ã€‚</p><p>Docker é•œåƒçš„æ„å»ºã€å®¹å™¨åˆ›å»ºã€å®¹å™¨è¿è¡Œç­‰å·¥ä½œéƒ½æ˜¯ Docker æœåŠ¡ç«¯æ¥å®Œæˆçš„ï¼ŒDocker å®¢æˆ·ç«¯åªæ˜¯æ‰¿æ‹…å‘é€æŒ‡ä»¤çš„è§’è‰²ã€‚</p><p>Docker å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯ä»¥åœ¨åŒä¸€ä¸ªå®¿ä¸»æœºï¼Œä¹Ÿå¯ä»¥åœ¨ä¸åŒçš„å®¿ä¸»æœºï¼Œå¦‚æœåœ¨åŒä¸€ä¸ªå®¿ä¸»æœºçš„è¯ï¼ŒDocker å®¢æˆ·ç«¯é»˜è®¤é€šè¿‡ UNIX å¥—æ¥å­—(<code>/var/run/docker.sock</code>)å’ŒæœåŠ¡ç«¯é€šä¿¡ã€‚</p></blockquote><p>ç±»æ¯”äºé’¢é“æ˜¯æ€æ ·ç‚¼æˆçš„ï¼Œå¦‚æœè¯´ç‚¼åˆ¶é•œåƒä¹Ÿéœ€è¦ä¸ªå·¥å‚çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ dockerd è¿™ä¸ªå®ˆæŠ¤è¿›ç¨‹å°±æ˜¯ä¸ªç”Ÿäº§é•œåƒçš„å·¥å‚ã€‚èƒ½ç”Ÿäº§é•œåƒçš„ä¸æ­¢ docker ä¸€å®¶ï¼Œçº¢å¸½å­å®¶çš„ <a href="https://buildah.io/" target="_blank" rel="noopener">buildah</a> ä¹Ÿèƒ½ç”Ÿäº§é•œåƒï¼Œä¸è¿‡ç”¨çš„äººå¹¶ä¸å¤šã€‚äºŒè€…çš„æœ€å¤§åŒºåˆ«åœ¨äº buildah å¯ä»¥ä¸ç”¨ root æƒé™æ¥æ„å»ºé•œåƒï¼Œè€Œä½¿ç”¨ docker æ„å»ºé•œåƒæ—¶éœ€è¦ç”¨åˆ° root æƒé™ï¼Œæ²¡æœ‰ root æƒé™çš„ç”¨æˆ·æ„å»ºé•œåƒä¼šå½“åœºç¿»è½¦ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock:</span><br></pre></td></tr></table></figure><p>ä¸è¿‡ buildah æ„å»ºå‡ºæ¥çš„é•œåƒæœ‰ä¸€å †å †çš„å…¼å®¹æ€§é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ docker æ¥æ„å»ºé•œåƒå§ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ docker build å‘½ä»¤æ„å»ºä¸€ä¸ªé•œåƒçš„æ—¶å€™ç¬¬ä¸€è¡Œæ—¥å¿—å°±æ˜¯ <code>Sending build context to Docker daemon xx MB</code>ã€‚è¿™ä¸€æ­¥æ˜¯ docker cli è¿™ä¸ªå‘½ä»¤è¡Œå®¢æˆ·ç«¯å°†æˆ‘ä»¬å½“å‰ç›®å½•ï¼ˆå³æ„å»ºä¸Šä¸‹æ–‡ï¼‰ <code>build context</code> æ‰“åŒ…å‘é€ <code>Docker daemon</code> å®ˆæŠ¤è¿›ç¨‹ ï¼ˆå³ dockerdï¼‰çš„è¿‡ç¨‹ã€‚</p><p><img src="img/docker-architecture.png" alt="img"></p><p>docker build æ„å»ºé•œåƒçš„æµç¨‹å¤§æ¦‚å°±æ˜¯ï¼š</p><ul><li>æ‰§è¡Œ <code>docker build -t &lt;imageName:Tag&gt; .</code>ï¼Œå¯ä»¥ä½¿ç”¨ <code>-f</code>å‚æ•°æ¥æŒ‡å®š Dockerfile æ–‡ä»¶ï¼›</li><li>docker å®¢æˆ·ç«¯ä¼šå°†æ„å»ºå‘½ä»¤åé¢æŒ‡å®šçš„è·¯å¾„(<code>.</code>)ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ª tar åŒ…ï¼Œå‘é€ç»™ Docker æœåŠ¡ç«¯;</li><li>docker æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„ tar åŒ…ï¼Œç„¶åè§£å‹ï¼Œæ¥ä¸‹æ¥æ ¹æ® Dockerfile é‡Œé¢çš„æŒ‡ä»¤è¿›è¡Œé•œåƒçš„åˆ†å±‚æ„å»ºï¼›</li><li>docker ä¸‹è½½ FROM è¯­å¥ä¸­æŒ‡å®šçš„åŸºç¡€é•œåƒï¼Œç„¶åå°†åŸºç¡€é•œåƒçš„ layer è”åˆæŒ‚è½½ä¸ºä¸€å±‚ï¼Œå¹¶åœ¨ä¸Šé¢åˆ›å»ºä¸€ä¸ªç©ºç›®å½•ï¼›</li><li>æ¥ç€å¯åŠ¨ä¸€ä¸ªä¸´æ—¶çš„å®¹å™¨å¹¶åœ¨ chroot ä¸­å¯åŠ¨ä¸€ä¸ª bashï¼Œè¿è¡Œ <code>RUN</code> è¯­å¥ä¸­çš„å‘½ä»¤ï¼š<code>RUN: chroot . /bin/bash -c &quot;apt get updateâ€¦â€¦&quot;</code>ï¼›</li><li>ä¸€æ¡ <code>RUN</code> å‘½ä»¤ç»“æŸåï¼Œä¼šæŠŠä¸Šå±‚ç›®å½•å‹ç¼©ï¼Œå½¢æˆæ–°é•œåƒä¸­çš„æ–°çš„ä¸€å±‚ï¼›</li><li>å¦‚æœ Dockerfile ä¸­åŒ…å«å…¶å®ƒå‘½ä»¤ï¼Œå°±ä»¥ä¹‹å‰æ„å»ºçš„å±‚æ¬¡ä¸ºåŸºç¡€ï¼Œä»ç¬¬äºŒæ­¥å¼€å§‹é‡å¤åˆ›å»ºæ–°å±‚ï¼Œç›´åˆ°å®Œæˆæ‰€æœ‰è¯­å¥åé€€å‡ºï¼›</li><li>æ„å»ºå®Œæˆä¹‹åä¸ºè¯¥é•œåƒæ‰“ä¸Š tagï¼›</li></ul><p>ä»¥ä¸Šå°±æ˜¯æ„å»ºé•œåƒçš„å¤§è‡´æµç¨‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ <code>docker history &lt;imageName:Tag&gt;</code> å‘½ä»¤æ¥é€†å‘æ¨ç®—å‡º docker build çš„è¿‡ç¨‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker history webpsh/webps</span><br><span class="line">IMAGE               CREATED             CREATED BY          SIZE                COMMENT</span><br><span class="line">30d9679b0b1c        2 weeks ago         /bin/sh -c #(nop)  CMD ["/usr/bin/webp-serveâ€¦   0B</span><br><span class="line">&lt;missing&gt;           2 weeks ago         /bin/sh -c #(nop)  VOLUME [/opt/exhaust]        0B</span><br><span class="line">&lt;missing&gt;           2 weeks ago         /bin/sh -c #(nop) WORKDIR /opt                  0B</span><br><span class="line">&lt;missing&gt;           2 weeks ago         /bin/sh -c #(nop) COPY file:1497d882aeef5f77â€¦   168B</span><br><span class="line">&lt;missing&gt;           2 weeks ago         /bin/sh -c #(nop) COPY file:327020918e4dc998â€¦   14.9MB</span><br><span class="line">&lt;missing&gt;           6 weeks ago         /bin/sh -c #(nop)  CMD ["/bin/sh"]              0B</span><br><span class="line">&lt;missing&gt;           6 weeks ago         /bin/sh -c #(nop) ADD file:b91adb67b670d3a6fâ€¦   5.61MB</span><br><span class="line"></span><br><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker history debian:v2</span><br><span class="line">IMAGE               CREATED             CREATED BY           SIZE                COMMENT</span><br><span class="line">e6e782a57a51        38 hours ago        /bin/sh -c #(nop)  CMD ["bash"]                 0B</span><br><span class="line">ba8f577813c7        38 hours ago        /bin/sh -c #(nop) ADD file:a82014afc29e7b364â€¦   69.2MB</span><br></pre></td></tr></table></figure><h4 id="base-image"><a href="#base-image" class="headerlink" title="base image"></a>base image</h4><p>å½“æˆ‘ä»¬åœ¨å†™ Dockerfile çš„æ—¶å€™éƒ½éœ€è¦ç”¨ <code>FROM</code> è¯­å¥æ¥æŒ‡å®šä¸€ä¸ªåŸºç¡€é•œåƒï¼Œè¿™äº›åŸºç¡€é•œåƒå¹¶ä¸æ˜¯æ— ä¸­ç”Ÿæœ‰ï¼Œä¹Ÿéœ€è¦ä¸€ä¸ª Dockerfile æ¥æ„å»ºæˆé•œåƒã€‚ä¸‹é¢æˆ‘ä»¬æ‹¿æ¥ <a href="https://hub.docker.com/_/debian" target="_blank" rel="noopener">debian:buster</a> è¿™ä¸ªåŸºç¡€é•œåƒçš„ <a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/18cb4d0418be1c80fb19141b69ac2e0600b2d601/buster/Dockerfile" target="_blank" rel="noopener">Dockerfile</a> æ¥çœ‹ä¸€ä¸‹åŸºç¡€é•œåƒæ˜¯å¦‚ä½•ç‚¼æˆçš„ã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> scratch</span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> rootfs.tar.xz /</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"bash"</span>]</span></span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªåŸºç¡€é•œåƒçš„ Dockerfile ä¸€èˆ¬ä»…æœ‰ä¸‰è¡Œã€‚ç¬¬ä¸€è¡Œ <code>FROM scratch</code> ä¸­çš„<code>scratch</code> è¿™ä¸ªé•œåƒå¹¶ä¸çœŸå®çš„å­˜åœ¨ã€‚å½“ä½ ä½¿ç”¨ <code>docker pull scratch</code> å‘½ä»¤æ¥æ‹‰å–è¿™ä¸ªé•œåƒçš„æ—¶å€™ä¼šç¿»è½¦å“¦ï¼Œæç¤º <code>Error response from daemon: &#39;scratch&#39; is a reserved name</code>ã€‚è¿™æ˜¯å› ä¸ºè‡ªä» docker 1.5 ç‰ˆæœ¬å¼€å§‹ï¼Œåœ¨ Dockerfile ä¸­ <code>FROM scratch</code> æŒ‡ä»¤å¹¶ä¸è¿›è¡Œä»»ä½•æ“ä½œï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šåˆ›å»ºä¸€ä¸ªé•œåƒå±‚ï¼›æ¥ç€ç¬¬äºŒè¡Œçš„ <code>ADD rootfs.tar.xz /</code> ä¼šè‡ªåŠ¨æŠŠ <code>rootfs.tar.xz</code>  è§£å‹åˆ° <code>/</code> ç›®å½•ä¸‹ï¼Œç”±æ­¤äº§ç”Ÿçš„ä¸€å±‚é•œåƒå°±æ˜¯æœ€ç»ˆæ„å»ºçš„é•œåƒçœŸå®çš„ layer å†…å®¹ï¼›ç¬¬ä¸‰è¡Œ <code>CMD [&quot;bash&quot;]</code> æŒ‡å®šè¿™é•œåƒåœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™æ‰§è¡Œçš„åº”ç”¨ç¨‹åºï¼Œä¸€èˆ¬åŸºç¡€é•œåƒçš„ CMD é»˜è®¤ä¸º bash æˆ–è€… sh ã€‚</p><blockquote><p>As of Docker 1.5.0 (specifically, <a href="https://github.com/docker/docker/pull/8827" target="_blank" rel="noopener"><code>docker/docker#8827</code></a>), <code>FROM scratch</code> is a no-op in the Dockerfile , and will not create an extra layer in your image (so a previously 2-layer image will be a 1-layer image instead).</p></blockquote><p><code>ADD rootfs.tar.xz /</code> ä¸­ï¼Œè¿™ä¸ª <code>rootfs.tar.xz</code> å°±æ˜¯æˆ‘ä»¬ç»è¿‡ä¸€ç³»åˆ—éªšæ“ä½œï¼ˆä¸€èˆ¬æ˜¯å‘è¡Œç‰ˆæºç ç¼–è¯‘ï¼‰æ“å‡ºæ¥çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™ä¸ªæ“ä½œæ¯”è¾ƒå¤æ‚ï¼Œæœ¨å­å¤ªèœäº†ğŸ¥¬å°±ä¸åœ¨è¿™é‡Œçæ°æ°äº†ğŸ™ƒï¼Œå¦‚æœæ±å¯¹æºç æ„å»º <code>rootfs.tar.xz</code> è¿™ä¸ªè¿‡ç¨‹æ„Ÿå…´è¶£å¯ä»¥å»çœ‹ä¸€ä¸‹æ„å»º debian åŸºç¡€é•œåƒçš„ Jenkins æµæ°´çº¿ä»»åŠ¡ <a href="https://doi-janky.infosiftr.net/job/tianon/job/debuerreotype/" target="_blank" rel="noopener">debuerreotype</a>ï¼Œä¸Šé¢æœ‰æ„å»ºè¿™ä¸ª <code>rootfs.tar.xz</code> å®Œæ•´è¿‡ç¨‹ï¼Œæˆ–è€…å‚è€ƒ Debian å®˜æ–¹çš„ <a href="https://github.com/debuerreotype/docker-debian-artifacts" target="_blank" rel="noopener">docker-debian-artifacts</a> è¿™ä¸ª repo é‡Œçš„ shell è„šæœ¬ã€‚</p><p>éœ€è¦é¢å¤–æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨è¿™é‡Œå¾€é•œåƒé‡Œæ·»åŠ  <code>rootfs.tar.xz</code> æ—¶ä½¿ç”¨çš„æ˜¯ <code>ADD</code> è€Œä¸æ˜¯ <code>COPY</code> ï¼Œå› ä¸ºåœ¨ Dockerfile ä¸­çš„ ADD æŒ‡ä»¤ src æ–‡ä»¶å¦‚æœæ˜¯ä¸ª tar åŒ…ï¼Œåœ¨æ„å»ºçš„æ—¶å€™ docker ä¼šå¸®æˆ‘ä»¬æŠŠ tar åŒ…è§£å¼€åˆ°æŒ‡å®šç›®å½•ï¼Œä½¿ç”¨ copy æŒ‡ä»¤åˆ™ä¸ä¼šè§£å¼€ tar åŒ…ã€‚å¦å¤–ä¸€ç‚¹åŒºåˆ«å°±æ˜¯ ADD æŒ‡ä»¤æ˜¯æ·»åŠ ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥æ˜¯æ„å»ºä¸Šä¸‹æ–‡ç¯å¢ƒä¸­çš„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸ª URLï¼Œè€Œ COPY åˆ™åªèƒ½æ·»åŠ æ„å»ºä¸Šä¸‹æ–‡ä¸­çš„æ–‡ä»¶ï¼Œæ‰€è°“çš„æ„å»ºä¸Šä¸‹æ–‡å°±æ˜¯æˆ‘ä»¬æ„å»ºé•œåƒçš„æ—¶å€™æœ€åä¸€ä¸ªå‚æ•°å•¦ã€‚</p><blockquote><p>PSï¼šé¢è¯•çš„æ—¶å€™ç»å¸¸è¢«é—® ADD ä¸ COPY çš„åŒºåˆ«ï¼›CMD ä¸ ENTRYPOINT çš„åŒºåˆ«ğŸ˜‚ã€‚</p></blockquote><p>æ“è¿™ä¸ª <code>rootfs.tar.xz</code> ä¸åŒçš„å‘è¡Œç‰ˆæ–¹æ³•å¯èƒ½ä¸å¤ªä¸€æ ·ï¼ŒDebian å‘è¡Œç‰ˆçš„ <code>rootfs.tar.xz</code> å¯ä»¥åœ¨ <a href="https://github.com/debuerreotype/docker-debian-artifacts" target="_blank" rel="noopener">docker-debian-artifacts</a> è¿™ä¸ª repo ä¸Šæ‰¾åˆ°ï¼Œæ ¹æ®ä¸åŒå¤„ç†å™¨ arch é€‰æ‹©ç›¸åº”çš„ branch ï¼Œç„¶åè¿™ä¸ª branch ä¸‹çš„ç›®å½•å°±å¯¹åº”ç€è¯¥å‘è¡Œç‰ˆçš„ä¸åŒçš„ç‰ˆæœ¬çš„ä»£å·ã€‚æ„å¤–å‘ç° Debian å®˜æ–¹æ˜¯å°†æ‰€æœ‰ arch å’Œæ‰€æœ‰ç‰ˆæœ¬çš„ <code>rootfs.tar.xz</code> éƒ½æ”¾åœ¨è¿™ä¸ª repo é‡Œçš„ï¼Œä»¥è‡³äºè¿™ä¸ª repo çš„å¤§å°æ¥è¿‘ 2.88 GiB ğŸ˜¨ï¼Œå½“ç½‘ç›˜æ¥ç”¨çš„å˜›ğŸ¤£ï¼ˆï¼šæ‰‹åŠ¨æ»‘ç¨½</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~</span><br><span class="line">â•°â”€# git clone https://github.com/debuerreotype/docker-debian-artifacts</span><br><span class="line">Cloning into 'docker-debian-artifacts'...</span><br><span class="line">remote: Enumerating objects: 278, done.</span><br><span class="line">remote: Counting objects: 100% (278/278), done.</span><br><span class="line">Receiving objects:  67% (443/660), 1.60 GiB | 16.96 MiB/s</span><br><span class="line">remote: Total 660 (delta 130), reused 244 (delta 97), pack-reused 382</span><br><span class="line">Receiving objects: 100% (660/660), 2.88 GiB | 16.63 MiB/s, done.</span><br><span class="line">Resolving deltas: 100% (267/267), done.</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠè¿™ä¸ª <code>rootfs.tar.xz</code> è§£å¼€å°±å¯ä»¥çœ‹åˆ°ï¼Œè¿™å°±æ˜¯ä¸€ä¸ª Linux çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œä¸åŒäºæˆ‘ä»¬ä½¿ç”¨ ISO å®‰è£…ç³»ç»Ÿçš„é‚£ä¸ªæ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™ä¸ªæ ¹æ–‡ä»¶ç³»ç»Ÿæ˜¯ç»è¿‡ä¸€ç³»åˆ—çš„è£å‰ªï¼Œå»æ‰äº†ä¸€äº›åœ¨å®¹å™¨è¿è¡Œä¸­ä¸å¿…è¦çš„æ–‡ä»¶ï¼Œä½¿ä¹‹æ›´åŠ è½»é‡é€‚ç”¨äºå®¹å™¨è¿è¡Œçš„åœºæ™¯ï¼Œæ•´ä¸ªæ ¹æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°ä¸º 125Mï¼Œå¦‚æœä½¿ç”¨ slim çš„<code>rootfs.tar.xz</code> ä¼šæ›´å°ä¸€äº›ï¼Œä»…ä»… 76Mã€‚å½“ç„¶ç›¸æ¯”äºä»…ä»…å‡  M çš„ <code>alpine</code> ï¼Œè¿™ç®—æ˜¯å¤Ÿå¤§çš„äº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# git checkout dist-amd64</span><br><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# cd buster</span><br><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# mkdir rootfs</span><br><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# tar -xvf rootfs.tar.xz -C !$</span><br><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# ls rootfs/</span><br><span class="line">bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# du -sh rootfs</span><br><span class="line">125M    rootfs</span><br><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# du -sh slim/rootfs</span><br><span class="line">76M     slim/rootfs</span><br></pre></td></tr></table></figure><p>æƒ³è¦è‡ªå·±æ„å»ºä¸€ä¸ª <code>debian:buster</code> åŸºç¡€é•œåƒå…¶å®å¾ˆç®€å•ï¼Œå°±åƒä¸‹é¢è¿™æ ·ä¸€æŠŠæ¢­æ“ä½œä¸‹æ¥å°±è¡ŒğŸ˜‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/debuerreotype/docker-debian-artifacts debian</span><br><span class="line">cd !$</span><br><span class="line">git checkout dist-amd64</span><br><span class="line">cd buster</span><br><span class="line">docker build -t debian:buster .</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å°±æ˜¯æ„å»º Debian åŸºç¡€é•œåƒçš„è¿‡ç¨‹ï¼Œæ­£å¦‚ Dockerfile ä¸­çš„é‚£æ ·ï¼Œæœ€ç»ˆåªäº§ç”Ÿäº†ä¸€å±‚é•œåƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker build -t debian:buster .</span><br><span class="line">Sending build context to Docker daemon  30.12MB</span><br><span class="line">Step 1/3 : FROM scratch</span><br><span class="line"><span class="meta"> ---&gt;</span></span><br><span class="line">Step 2/3 : ADD rootfs.tar.xz /</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 1756d6a585ae</span></span><br><span class="line">Step 3/3 : CMD ["bash"]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> c86a8b6deb3d</span></span><br><span class="line">Removing intermediate container c86a8b6deb3d</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 04948daa3c2e</span></span><br><span class="line">Successfully built 04948daa3c2e</span><br><span class="line">Successfully tagged debian:buster</span><br></pre></td></tr></table></figure><h2 id="é•œåƒæ˜¯æ€æ ·å­˜æ”¾çš„-ï¼ˆä¸€ï¼‰æœ¬åœ°å­˜å‚¨-ğŸ™„"><a href="#é•œåƒæ˜¯æ€æ ·å­˜æ”¾çš„-ï¼ˆä¸€ï¼‰æœ¬åœ°å­˜å‚¨-ğŸ™„" class="headerlink" title="é•œåƒæ˜¯æ€æ ·å­˜æ”¾çš„ ï¼ˆä¸€ï¼‰æœ¬åœ°å­˜å‚¨ ğŸ™„"></a>é•œåƒæ˜¯æ€æ ·å­˜æ”¾çš„ ï¼ˆä¸€ï¼‰æœ¬åœ°å­˜å‚¨ ğŸ™„</h2><p>å½“æˆ‘ä»¬æ„å»ºå®Œä¸€ä¸ªé•œåƒä¹‹åï¼Œé•œåƒå°±å­˜å‚¨åœ¨äº†æˆ‘ä»¬ docker æœ¬åœ°å­˜å‚¨ç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸º <code>/var/lib/docker</code> ï¼Œä¸‹é¢å°±æ¢å¯»ä¸€ä¸‹é•œåƒæ˜¯ä»¥ä»€ä¹ˆæ ·çš„ç›®å½•ç»“æ„å­˜æ”¾çš„ã€‚åœ¨å¼€å§‹ hack ä¹‹å‰æˆ‘ä»¬å…ˆç»Ÿä¸€ä¸€ä¸‹ç¯å¢ƒä¿¡æ¯ï¼Œæˆ‘ä½¿ç”¨çš„æœºå™¨æ˜¯ Ubuntu 1804ï¼Œ<code>docker info</code> ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">â•­â”€root@sg-02</span> <span class="string">/var/lib/docker</span></span><br><span class="line"><span class="string">â•°â”€#</span> <span class="string">docker</span> <span class="string">info</span></span><br><span class="line"><span class="attr">Client:</span></span><br><span class="line"> <span class="attr">Debug Mode:</span> <span class="literal">false</span></span><br><span class="line"> <span class="attr">Plugins:</span></span><br><span class="line">  <span class="attr">buildx:</span> <span class="string">Build</span> <span class="string">with</span> <span class="string">BuildKit</span> <span class="string">(Docker</span> <span class="string">Inc.,</span> <span class="string">v0.3.1-tp-docker)</span></span><br><span class="line">  <span class="attr">app:</span> <span class="string">Docker</span> <span class="string">Application</span> <span class="string">(Docker</span> <span class="string">Inc.,</span> <span class="string">v0.8.0)</span></span><br><span class="line"><span class="attr">Server:</span></span><br><span class="line"> <span class="attr">Containers:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Running:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Paused:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Stopped:</span> <span class="number">0</span></span><br><span class="line"> <span class="attr">Images:</span> <span class="number">2</span></span><br><span class="line"> <span class="attr">Server Version:</span> <span class="number">19.03</span><span class="number">.5</span></span><br><span class="line"> <span class="attr">Storage Driver:</span> <span class="string">overlay2</span></span><br><span class="line">  <span class="attr">Backing Filesystem:</span> <span class="string">extfs</span></span><br><span class="line">  <span class="attr">Supports d_type:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">Native Overlay Diff:</span> <span class="literal">true</span></span><br><span class="line"> <span class="attr">Logging Driver:</span> <span class="string">json-file</span></span><br><span class="line"> <span class="attr">Cgroup Driver:</span> <span class="string">cgroupfs</span></span><br><span class="line"> <span class="attr">Plugins:</span></span><br><span class="line">  <span class="attr">Volume:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">Network:</span> <span class="string">bridge</span> <span class="string">host</span> <span class="string">ipvlan</span> <span class="string">macvlan</span> <span class="literal">null</span> <span class="string">overlay</span></span><br><span class="line">  <span class="attr">Log:</span> <span class="string">awslogs</span> <span class="string">fluentd</span> <span class="string">gcplogs</span> <span class="string">gelf</span> <span class="string">journald</span> <span class="string">json-file</span> <span class="string">local</span> <span class="string">logentries</span> <span class="string">splunk</span> <span class="string">syslog</span></span><br><span class="line"> <span class="attr">Swarm:</span> <span class="string">inactive</span></span><br><span class="line"> <span class="attr">Runtimes:</span> <span class="string">runc</span></span><br><span class="line"> <span class="attr">Default Runtime:</span> <span class="string">runc</span></span><br><span class="line"> <span class="attr">Init Binary:</span> <span class="string">docker-init</span></span><br><span class="line"> <span class="attr">containerd version:</span> <span class="string">b34a5c8af56e510852c35414db4c1f4fa6172339</span></span><br><span class="line"> <span class="attr">runc version:</span> <span class="string">3e425f80a8c931f88e6d94a8c831b9d5aa481657</span></span><br><span class="line"> <span class="attr">init version:</span> <span class="string">fec3683</span></span><br><span class="line"> <span class="attr">Security Options:</span></span><br><span class="line">  <span class="string">apparmor</span></span><br><span class="line">  <span class="string">seccomp</span></span><br><span class="line">   <span class="attr">Profile:</span> <span class="string">default</span></span><br><span class="line"> <span class="attr">Kernel Version:</span> <span class="number">4.15</span><span class="number">.0</span><span class="number">-1052</span><span class="string">-aws</span></span><br><span class="line"> <span class="attr">Operating System:</span> <span class="string">Ubuntu</span> <span class="number">18.04</span><span class="number">.1</span> <span class="string">LTS</span></span><br><span class="line"> <span class="attr">OSType:</span> <span class="string">linux</span></span><br><span class="line"> <span class="attr">Architecture:</span> <span class="string">x86_64</span></span><br><span class="line"> <span class="attr">CPUs:</span> <span class="number">1</span></span><br><span class="line"> <span class="attr">Total Memory:</span> <span class="number">983.</span><span class="string">9MiB</span></span><br><span class="line"> <span class="attr">Name:</span> <span class="string">sg-02</span></span><br><span class="line"> <span class="attr">ID:</span> <span class="string">B7J5:Y7ZM:Y477:7AS6:WMYI:6NLV:YOMA:W32Y:H4NZ:UQVD:XHDX:Y5EF</span></span><br><span class="line"> <span class="attr">Docker Root Dir:</span> <span class="string">/opt/docker</span></span><br><span class="line"> <span class="attr">Debug Mode:</span> <span class="literal">false</span></span><br><span class="line"> <span class="attr">Username:</span> <span class="string">webpsh</span></span><br><span class="line"> <span class="attr">Registry:</span> <span class="string">https://index.docker.io/v1/</span></span><br><span class="line"> <span class="attr">Labels:</span></span><br><span class="line"> <span class="attr">Experimental:</span> <span class="literal">false</span></span><br><span class="line"> <span class="attr">Insecure Registries:</span></span><br><span class="line">  <span class="number">127.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/8</span></span><br><span class="line"> <span class="attr">Registry Mirrors:</span></span><br><span class="line">  <span class="string">https://registry.k8s.li/</span></span><br><span class="line"> <span class="attr">Live Restore Enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿åˆ†æï¼Œæˆ‘å°†å…¶ä»–çš„ docker image å…¨éƒ¨æ¸…ç©ºæ‰ï¼Œåªä¿ç•™ <code>debian:v1</code> å’Œ <code>debian:v2</code> è¿™ä¸¤ä¸ªé•œåƒï¼Œè¿™ä¸¤ä¸ªé•œåƒè¶³å¤Ÿå¸®åŠ©æˆ‘ä»¬ç†è§£å®¹å™¨é•œåƒæ˜¯å¦‚ä½•å­˜æ”¾çš„ï¼Œé•œåƒå¤šäº†å¤šè¯åˆ†æä¸‹é¢å­˜å‚¨ç›®å½•çš„æ—¶å€™å¯èƒ½ä¸å¤ªæ–¹ä¾¿ï¼ˆï¼ï¹ï¼œï¼‰ï¼Œè¿™ä¸¤ä¸ªé•œåƒæ˜¯æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨ Debian çš„ <code>rootfs.tar.xz</code> æ„å»ºå‡ºæ¥çš„åŸºç¡€é•œåƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/docker</span><br><span class="line">â•°â”€# docker images</span><br><span class="line">REPOSITORY       TAG         IMAGE ID            CREATED             SIZE</span><br><span class="line">debian           v2          e6e782a57a51        22 hours ago        69.2MB</span><br><span class="line">debian           v1          cfba37fd24f8        22 hours ago        69.2MB</span><br></pre></td></tr></table></figure><h3 id="docker-var-lib-docker"><a href="#docker-var-lib-docker" class="headerlink" title="docker (/var/lib/docker)"></a>docker (/var/lib/docker)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/docker</span><br><span class="line">â•°â”€# tree -d -L 1</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ builder</span><br><span class="line">â”œâ”€â”€ buildkit</span><br><span class="line">â”œâ”€â”€ containers</span><br><span class="line">â”œâ”€â”€ image</span><br><span class="line">â”œâ”€â”€ network</span><br><span class="line">â”œâ”€â”€ overlay2</span><br><span class="line">â”œâ”€â”€ plugins</span><br><span class="line">â”œâ”€â”€ runtimes</span><br><span class="line">â”œâ”€â”€ swarm</span><br><span class="line">â”œâ”€â”€ tmp</span><br><span class="line">â”œâ”€â”€ trust</span><br><span class="line">â””â”€â”€ volumes</span><br><span class="line"></span><br><span class="line">12 directories</span><br></pre></td></tr></table></figure><p>æ ¹æ®ç›®å½•çš„åå­—æˆ‘ä»¬å¯ä»¥å¤§è‡´æ¨æ–­å‡ºå…³äºå®¹å™¨é•œåƒçš„å­˜å‚¨ï¼Œæˆ‘ä»¬åªå…³å¿ƒ image å’Œ overlay2 è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹å³å¯ï¼Œå®¹å™¨çš„å…ƒæ•°æ®å­˜æ”¾åœ¨ image ç›®å½•ä¸‹ï¼Œå®¹å™¨çš„ layer æ•°æ®åˆ™å­˜æ”¾åœ¨ overlay2 ç›®å½•ä¸‹ã€‚</p><h3 id="var-lib-docker-image"><a href="#var-lib-docker-image" class="headerlink" title="/var/lib/docker/image"></a>/var/lib/docker/image</h3><p>overlay2 ä»£è¡¨ç€æœ¬åœ° docker å­˜å‚¨ä½¿ç”¨çš„æ˜¯ overlay2 è¯¥å­˜å‚¨é©±åŠ¨ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬çš„ docker é»˜è®¤ä¼˜å…ˆé‡‡ç”¨ <strong>overlay2</strong> ä½œä¸ºå­˜å‚¨é©±åŠ¨ï¼Œå¯¹äºå·²æ”¯æŒè¯¥é©±åŠ¨çš„ Linux å‘è¡Œç‰ˆï¼Œä¸éœ€è¦ä»»ä½•è¿›è¡Œä»»ä½•é¢å¤–çš„é…ç½®ï¼Œå¯ä½¿ç”¨ lsmod å‘½ä»¤æŸ¥çœ‹å½“å‰ç³»ç»Ÿå†…æ ¸æ˜¯å¦æ”¯æŒ overlay2 ã€‚</p><p>å¦å¤–å€¼å¾—ä¸€æçš„æ˜¯<code>devicemapper</code> å­˜å‚¨é©±åŠ¨å·²ç»åœ¨ docker 18.09 ç‰ˆæœ¬ä¸­è¢«åºŸå¼ƒï¼Œdocker å®˜æ–¹æ¨èä½¿ç”¨ <code>overlay2</code> æ›¿ä»£<code>devicemapper</code>ã€‚ï¼ˆä¹‹å‰æˆ‘è€ä¸œå®¶ç”¨çš„ docker 1.13 ç‰ˆæœ¬ï¼Œ<code>devicemapper</code>çš„å­˜å‚¨é©±åŠ¨åœ¨ç”Ÿäº§ç¯å¢ƒç¿»è¿‡è½¦ğŸ˜‚ã€‚æ‰€ä»¥å‘¢ï¼Œéƒ½ 2020 å¹´äº†ï¼Œå½“ä½ ä½¿ç”¨ baidu è¿™ç§åƒåœ¾æœç´ å¼•æ“å»æœç´¢ â€œCentOS å®‰è£… dockerâ€ æ—¶å®ƒä¼šç»™ä½ ä¸€å †åƒåœ¾çš„æ•™ç¨‹ï¼Œå«ä½ å»å®‰è£… <code>device-mapper-persistent-data lvm2</code>ï¼Œå¯¹äºè¿™ç§æŠ„æ¥æŠ„å»çš„åšå®¢å¹³å°ï¼Œç¦»å¾—è¶Šè¿œè¶Šå¥½ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">image</span><br><span class="line">â””â”€â”€ overlay2</span><br><span class="line">    â”œâ”€â”€ distribution</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ diffid-by-digest</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 039b991354af4dcbc534338f687e27643c717bb57e11b87c2e81d50bdd0b2376</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 09a4142c5c9dde2fbf35e7a6e6475eba75a8c28540c375c80be7eade4b7cb438</span><br><span class="line">    â”‚Â Â  â””â”€â”€ v2metadata-by-diffid</span><br><span class="line">    â”‚Â Â      â””â”€â”€ sha256</span><br><span class="line">    â”‚Â Â          â”œâ”€â”€ 0683de2821778aa9546bf3d3e6944df779daba1582631b7ea3517bb36f9e4007</span><br><span class="line">    â”‚Â Â          â”œâ”€â”€ 0f7493e3a35bab1679e587b41b353b041dca1e7043be230670969703f28a1d83</span><br><span class="line">    â”œâ”€â”€ imagedb</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ content</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 708bc6af7e5e539bdb59707bbf1053cc2166622f5e1b17666f0ba5829ca6aaea</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â””â”€â”€ f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span><br><span class="line">    â”‚Â Â  â””â”€â”€ metadata</span><br><span class="line">    â”‚Â Â      â””â”€â”€ sha256</span><br><span class="line">    â”œâ”€â”€ layerdb</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ mounts</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ sha256</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ b9835d6a62886d4e85b65abb120c0ea44ff1b3d116d7a707620785d4664d8c1a</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ cache-id</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ parent</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ size</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ tar-split.json.gz</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â””â”€â”€ d9b567b77bcdb9d8944d3654ea9bb5f6f4f7c4d07a264b2e40b1bb09af171dd3</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ cache-id</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ diff</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ parent</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ size</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â””â”€â”€ tar-split.json.gz</span><br><span class="line">    â”‚Â Â  â””â”€â”€ tmp</span><br><span class="line">    â””â”€â”€ repositories.json</span><br><span class="line">21 directories, 119 files</span><br></pre></td></tr></table></figure><ul><li><code>repositories.json</code></li></ul><p>repositories.json å°±æ˜¯å­˜å‚¨é•œåƒå…ƒæ•°æ®ä¿¡æ¯ï¼Œä¸»è¦æ˜¯ image name å’Œ image id çš„å¯¹åº”ï¼Œdigest å’Œ image id çš„å¯¹åº”ã€‚å½“ pull å®Œä¸€ä¸ªé•œåƒçš„æ—¶å€™ docker ä¼šæ›´æ–°è¿™ä¸ªæ–‡ä»¶ã€‚å½“æˆ‘ä»¬ docker run ä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ä¹Ÿç”¨åˆ°è¿™ä¸ªæ–‡ä»¶å»ç´¢å¼•æœ¬åœ°æ˜¯å¦å­˜åœ¨è¯¥é•œåƒï¼Œæ²¡æœ‰é•œåƒçš„è¯å°±è‡ªåŠ¨å» pull è¿™ä¸ªé•œåƒã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/docker/image/overlay2</span><br><span class="line">â•°â”€# jq "." repositories.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"Repositories"</span>: &#123;</span><br><span class="line">    <span class="attr">"debian"</span>: &#123;</span><br><span class="line">      <span class="attr">"debian:v1"</span>: <span class="string">"sha256:cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d"</span>,</span><br><span class="line">      <span class="attr">"debian:v2"</span>: <span class="string">"sha256:e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"localhost:5000/library/debian"</span>: &#123;</span><br><span class="line">      <span class="attr">"localhost:5000/library/debian:v1"</span>: <span class="string">"sha256:cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d"</span>,</span><br><span class="line">      <span class="attr">"localhost:5000/library/debian:v2"</span>: <span class="string">"sha256:e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df"</span>,</span><br><span class="line">      <span class="attr">"localhost:5000/library/debian@sha256:b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239"</span>: <span class="string">"sha256:cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d"</span>,</span><br><span class="line">      <span class="attr">"localhost:5000/library/debian@sha256:c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11"</span>: <span class="string">"sha256:e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"registry"</span>: &#123;</span><br><span class="line">      <span class="attr">"registry:latest"</span>: <span class="string">"sha256:708bc6af7e5e539bdb59707bbf1053cc2166622f5e1b17666f0ba5829ca6aaea"</span>,</span><br><span class="line">      <span class="attr">"registry@sha256:7d081088e4bfd632a88e3f3bcd9e007ef44a796fddfe3261407a3f9f04abe1e7"</span>: <span class="string">"sha256:708bc6af7e5e539bdb59707bbf1053cc2166622f5e1b17666f0ba5829ca6aaea"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>distribution ç›®å½•ä¸‹</li></ul><p>å­˜æ”¾ç€ layer çš„ diff_id å’Œ digest çš„å¯¹åº”å…³ç³»</p><p>diffid-by-digest :å­˜æ”¾ <code>digest</code> åˆ° <code>diffid</code> çš„å¯¹åº”å…³ç³»</p><p>v2metadata-by-diffid : å­˜æ”¾ <code>diffid</code> åˆ° <code>digest</code> çš„å¯¹åº”å…³ç³»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ distribution</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diffid-by-digest</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 039b991354af4dcbc534338f687e27643c717bb57e11b87c2e81d50bdd0b2376</span><br><span class="line">â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 09a4142c5c9dde2fbf35e7a6e6475eba75a8c28540c375c80be7eade4b7cb438</span><br><span class="line">â”‚Â Â  â””â”€â”€ v2metadata-by-diffid</span><br><span class="line">â”‚Â Â      â””â”€â”€ sha256</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ 0683de2821778aa9546bf3d3e6944df779daba1582631b7ea3517bb36f9e4007</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ 0f7493e3a35bab1679e587b41b353b041dca1e7043be230670969703f28a1d83</span><br></pre></td></tr></table></figure><ul><li>imagedb</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ imagedb</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ content</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 708bc6af7e5e539bdb59707bbf1053cc2166622f5e1b17666f0ba5829ca6aaea</span><br><span class="line">â”‚Â Â  â”‚Â Â      â””â”€â”€ f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span><br><span class="line">â”‚Â Â  â””â”€â”€ metadata</span><br><span class="line">â”‚Â Â      â””â”€â”€ sha256</span><br></pre></td></tr></table></figure><ul><li>layerdb</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ layerdb</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ mounts</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ sha256</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ b9835d6a62886d4e85b65abb120c0ea44ff1b3d116d7a707620785d4664d8c1a</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ cache-id  # docker ä¸‹è½½é•œåƒæ—¶éšæœºç”Ÿæˆçš„ id</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ diff # å­˜æ”¾ layer çš„ diffid</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ parent # æ”¾å½“å‰ layer çš„çˆ¶ layer çš„ diffidï¼Œæœ€åº•å±‚çš„ layer æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ size # è¯¥ layer çš„å¤§å°</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ tar-split.json.gz</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼štar-split.json.gz æ–‡ä»¶æ˜¯ layer tar åŒ…çš„ split æ–‡ä»¶ï¼Œè®°å½•äº† layer è§£å‹åçš„æ–‡ä»¶åœ¨ tar åŒ…ä¸­çš„ä½ç½®ï¼ˆåç§»é‡ï¼‰ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶å¯ä»¥è¿˜åŸ layer çš„ tar åŒ…ï¼Œåœ¨ docker save å¯¼å‡º image çš„æ—¶å€™ä¼šç”¨åˆ°ï¼Œç”±æ ¹æ®å®ƒå¯ä»¥å¼€å€’è½¦æŠŠè§£å‹çš„ layer è¿˜åŸå› tar åŒ…ã€‚è¯¦æƒ…å¯å‚è€ƒ <a href="https://github.com/vbatts/tar-split" target="_blank" rel="noopener">tar-split</a></p><h3 id="var-lib-docker-overlay2"><a href="#var-lib-docker-overlay2" class="headerlink" title="/var/lib/docker/overlay2"></a>/var/lib/docker/overlay2</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">overlay2</span><br><span class="line">â”œâ”€â”€ 259cf6934509a674b1158f0a6c90c60c133fd11189f98945c7c3a524784509ff</span><br><span class="line">â”‚Â Â  â””â”€â”€ diff</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ bin</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ dev</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ etc</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ home</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ media</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ mnt</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ opt</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ proc</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ root</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ run</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ sbin</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ srv</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ sys</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ tmp</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ usr</span><br><span class="line">â”‚Â Â      â””â”€â”€ var</span><br><span class="line">â”œâ”€â”€ 27f9e9b74a88a269121b4e77330a665d6cca4719cb9a58bfc96a2b88a07af805</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”œâ”€â”€ a0df3cc902cfbdee180e8bfa399d946f9022529d12dba3bc0b13fb7534120015</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ bin</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”œâ”€â”€ b2fbebb39522cb6f1f5ecbc22b7bec5e9bc6ecc25ac942d9e26f8f94a028baec</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ etc</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ usr</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ var</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”œâ”€â”€ be8c12f63bebacb3d7d78a09990dce2a5837d86643f674a8fd80e187d8877db9</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ etc</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”œâ”€â”€ e8f6e78aa1afeb96039c56f652bb6cd4bbd3daad172324c2172bad9b6c0a968d</span><br><span class="line">â”‚Â Â  â””â”€â”€ diff</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ bin</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ dev</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ etc</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ home</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ media</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ mnt</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ proc</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ root</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ run</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ sbin</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ srv</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ sys</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ tmp</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ usr</span><br><span class="line">â”‚Â Â      â””â”€â”€ var</span><br><span class="line">â””â”€â”€ l</span><br><span class="line">    â”œâ”€â”€ 526XCHXRJMZXRIHN4YWJH2QLPY -&gt; ../b2fbebb39522cb6f1f5ecbc22b7bec5e9bc6ecc25ac942d9e26f8f94a028baec/diff</span><br><span class="line">    â”œâ”€â”€ 5RZOXYR35NSGAWTI36CVUIRW7U -&gt; ../be8c12f63bebacb3d7d78a09990dce2a5837d86643f674a8fd80e187d8877db9/diff</span><br><span class="line">    â”œâ”€â”€ LBWRL4ZXGBWOTN5JDCDZVNOY7H -&gt; ../a0df3cc902cfbdee180e8bfa399d946f9022529d12dba3bc0b13fb7534120015/diff</span><br><span class="line">    â”œâ”€â”€ MYRYBGZRI4I76MJWQHN7VLZXLW -&gt; ../27f9e9b74a88a269121b4e77330a665d6cca4719cb9a58bfc96a2b88a07af805/diff</span><br><span class="line">    â”œâ”€â”€ PCIS4FYUJP4X2D4RWB7ETFL6K2 -&gt; ../259cf6934509a674b1158f0a6c90c60c133fd11189f98945c7c3a524784509ff/diff</span><br><span class="line">    â””â”€â”€ XK5IA4BWQ2CIS667J3SXPXGQK5 -&gt; ../e8f6e78aa1afeb96039c56f652bb6cd4bbd3daad172324c2172bad9b6c0a968d/diff</span><br></pre></td></tr></table></figure><p>åœ¨ <code>/var/lib/docker/overlay2</code> ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé•œåƒ layer çš„å†…å®¹éƒ½å­˜æ”¾åœ¨ä¸€ä¸ª <code>diff</code> çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œdiff çš„ä¸Šçº§ç›®å½•å°±æ˜¯ä»¥é•œåƒ layer çš„ digest ä¸ºåçš„ç›®å½•ã€‚å…¶ä¸­è¿˜æœ‰ä¸ª <code>l</code> æ–‡ä»¶å¤¹ï¼Œä¸‹é¢æœ‰ä¸€å¨å¨çš„ç¡¬é“¾æ¥æ–‡ä»¶æŒ‡å‘ä¸Šçº§ç›®å½•çš„ layer ç›®å½•ã€‚è¿™ä¸ª l å…¶å®å°±æ˜¯ link çš„ç¼©å†™ï¼Œl ä¸‹çš„æ–‡ä»¶éƒ½æ˜¯ä¸€äº›æ¯” digest æ–‡ä»¶å¤¹åçŸ­ä¸€äº›çš„ï¼Œæ–¹é¢ä¸è‡³äº mount çš„å‚æ•°è¿‡é•¿ã€‚</p><h2 id="é•œåƒæ˜¯æ€ä¹ˆæ¬è¿çš„ğŸ¤£"><a href="#é•œåƒæ˜¯æ€ä¹ˆæ¬è¿çš„ğŸ¤£" class="headerlink" title="é•œåƒæ˜¯æ€ä¹ˆæ¬è¿çš„ğŸ¤£"></a>é•œåƒæ˜¯æ€ä¹ˆæ¬è¿çš„ğŸ¤£</h2><p>å½“æˆ‘ä»¬åœ¨æœ¬åœ°æ„å»ºå®Œæˆä¸€ä¸ªé•œåƒä¹‹åï¼Œå¦‚ä½•ä¼ é€’ç»™ä»–äººå‘¢ï¼Ÿè¿™å°±æ¶‰åŠåˆ°é•œåƒæ˜¯æ€ä¹ˆæ¬è¿çš„ä¸€äº›çŸ¥è¯†ï¼Œæ¬è¿é•œåƒå°±åƒæˆ‘ä»¬åœ¨ GitHub ä¸Šæ¬è¿ä»£ç ä¸€æ ·ï¼Œdocker ä¹Ÿæœ‰ç±»ä¼¼äº git clone å’Œ git push çš„æ¬è¿æ–¹å¼ã€‚docker push å°±å’Œæˆ‘ä»¬ä½¿ç”¨ git push ä¸€æ ·ï¼Œå°†æœ¬åœ°çš„é•œåƒæ¨é€åˆ°ä¸€ä¸ªç§°ä¹‹ä¸º registry çš„é•œåƒä»“åº“ï¼Œè¿™ä¸ª registry é•œåƒä»“åº“å°±åƒ GitHub ç”¨æ¥å­˜æ”¾å…¬å…±/ç§æœ‰çš„é•œåƒï¼Œä¸€ä¸ªä¸­å¿ƒåŒ–çš„é•œåƒä»“åº“æ–¹ä¾¿å¤§å®¶æ¥è¿›è¡Œäº¤æµå’Œæ¬è¿é•œåƒã€‚docker pull å°±åƒæˆ‘ä»¬ä½¿ç”¨ git pull ä¸€æ ·ï¼Œå°†è¿œç¨‹çš„é•œåƒæ‹‰æ‹‰å–æœ¬åœ°ã€‚</p><h3 id="docker-pull"><a href="#docker-pull" class="headerlink" title="docker pull"></a>docker pull</h3><p>ç†è§£ docker pull ä¸€ä¸ªé•œåƒçš„æµç¨‹æœ€å¥½çš„åŠæ³•æ˜¯æŸ¥çœ‹ OCI registry è§„èŒƒä¸­çš„è¿™æ®µæ–‡æ¡£ <a href="https://github.com/opencontainers/distribution-spec/blob/master/spec.md#pulling-an-image" target="_blank" rel="noopener">pulling-an-image</a> ï¼Œåœ¨è¿™é‡Œæˆ‘ç»“åˆå¤§ä½¬çš„åšå®¢ç®€å•æ¢³ç†ä¸€ä¸‹ pull ä¸€ä¸ªé•œåƒçš„å¤§è‡´æµç¨‹ã€‚ä¸‹é¢è¿™å¼ å›¾æ˜¯ä» <a href="https://github.com/helios741/myblog/blob/new/learn_go/src/2019/20191206_docker_disk_storage/README.md" target="_blank" rel="noopener">æµ…è°ˆdockerä¸­é•œåƒå’Œå®¹å™¨åœ¨æœ¬åœ°çš„å­˜å‚¨)</a> å€Ÿæ¥çš„ğŸ˜‚</p><p><img src="https://user-images.githubusercontent.com/12036324/70367494-646d2380-18db-11ea-992a-d2bca4cbfeb0.png" alt="image"></p><p>docker pull å°±å’Œæˆ‘ä»¬ä½¿ç”¨ git clone ä¸€æ ·æ•ˆæœï¼Œå°†è¿œç¨‹çš„é•œåƒä»“åº“æ‹‰å–åˆ°æœ¬åœ°æ¥ç»™å®¹å™¨è¿è¡Œæ—¶ä½¿ç”¨ï¼Œç»“åˆä¸Šå›¾å¤§è‡´çš„æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ä¸€æ­¥åº”è¯¥æ˜¯ä½¿ç”¨<code>~/.docker/config.json</code> ä¸­çš„ auth è®¤è¯ä¿¡æ¯åœ¨ registry é‚£é‡Œè¿›è¡Œé‰´æƒæˆæƒï¼Œæ‹¿åˆ°ä¸€ä¸ª tokenï¼Œåé¢çš„æ‰€æœ‰çš„ HTTP è¯·æ±‚ä¸­éƒ½è¦åŒ…å«ç€è¯¥ token æ‰èƒ½æœ‰æƒé™è¿›è¡Œæ“ä½œã€‚</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# cat ~/.docker/config.json</span><br><span class="line">&#123;</span><br><span class="line">        <span class="attr">"auths"</span>: &#123;</span><br><span class="line">                <span class="attr">"https://registry.k8s.li/v2/"</span>: &#123;</span><br><span class="line">                        <span class="attr">"auth"</span>: <span class="string">"d2VicH855828WM7bSVsslJFpmQE43Sw=="</span></span><br><span class="line">                &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"HttpHeaders"</span>: &#123;</span><br><span class="line">                <span class="attr">"User-Agent"</span>: <span class="string">"Docker-Client/19.03.5 (linux)"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"experimental"</span>: <span class="string">"enabled"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>dockerd å®ˆæŠ¤è¿›ç¨‹è§£æ docker å®¢æˆ·ç«¯å‚æ•°ï¼Œç”±é•œåƒå + tag å‘ registry è¯·æ±‚ Manifest æ–‡ä»¶ï¼ŒHTTP è¯·æ±‚ä¸º<code>GET /v2/&lt;name&gt;/manifests/&lt;reference&gt;</code>ã€‚registry ä¸­ä¸€ä¸ªé•œåƒæœ‰å¤šä¸ª tag æˆ–è€…å¤šä¸ªå¤„ç†å™¨ä½“ç³»æ¶æ„çš„é•œåƒï¼Œåˆ™æ ¹æ®è¿™ä¸ª tag æ¥è¿”å›ç»™å®¢æˆ·ç«¯ä¸ä¹‹å¯¹åº”çš„  manifest æ–‡ä»¶ï¼›</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET /v2/&lt;name&gt;/manifests/&lt;reference&gt;</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"annotations"</span>: &#123;</span><br><span class="line">      <span class="attr">"com.example.key1"</span>: <span class="string">"value1"</span>,</span><br><span class="line">      <span class="attr">"com.example.key2"</span>: <span class="string">"value2"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:6f4e69a5ff18d92e7315e3ee31c62165ebf25bfa05cad05c0d09d8f412dae401"</span>,</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.oci.image.config.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">452</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:6f4e69a5ff18d92e7315e3ee31c62165ebf25bfa05cad05c0d09d8f412dae401"</span>,</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.oci.image.layer.v1.tar+gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">78343</span></span><br><span class="line">      &#125;</span><br><span class="line">   ],</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>dockerd å¾—åˆ° <code>manifest</code> åï¼Œè¯»å–é‡Œé¢ image config æ–‡ä»¶çš„ <code>digest</code>ï¼Œè¿™ä¸ª sha256 å€¼å°±æ˜¯ image çš„ <code>ID</code></li><li>æ ¹æ® <code>ID</code> åœ¨æœ¬åœ°çš„ <code>repositories.json</code>ä¸­æŸ¥æ‰¾æ‰¾æœ‰æ²¡æœ‰å­˜åœ¨åŒæ · <code>ID</code> çš„ imageï¼Œæœ‰çš„è¯å°±ä¸ç”¨ä¸‹è½½äº†</li><li>å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆä¼šç»™ registry æœåŠ¡å™¨å‘è¯·æ±‚æ‹¿åˆ°  image config æ–‡ä»¶</li><li>æ ¹æ® image config æ–‡ä»¶ä¸­çš„ <code>diff_ids</code>åœ¨æœ¬åœ°æ‰¾å¯¹åº”çš„ layer æ˜¯å¦å­˜åœ¨</li><li>å¦‚æœ layer ä¸å­˜åœ¨ï¼Œåˆ™æ ¹æ® <code>manifest</code> é‡Œé¢ layer çš„ <code>sha256</code> å’Œ <code>media type</code> å»æœåŠ¡å™¨æ‹¿ç›¸åº”çš„ layerï¼ˆç›¸å½“å»æ‹¿å‹ç¼©æ ¼å¼çš„åŒ…ï¼‰</li><li>dockerd å®ˆæŠ¤è¿›ç¨‹å¹¶è¡Œä¸‹è½½å„ layer ï¼ŒHTTP è¯·æ±‚ä¸º<code>GET /v2/&lt;name&gt;/blobs/&lt;digest&gt;</code>ã€‚ </li><li>æ‹¿åˆ°åè¿›è¡Œè§£å‹ï¼Œå¹¶æ£€æŸ¥è§£å‹(gzip -d)å tar åŒ…çš„ sha256 æ˜¯å¦å’Œ image config ä¸­çš„ <code>diff_id</code> ç›¸åŒï¼Œä¸ç›¸åŒå°±ç¿»è½¦äº†</li><li>ç­‰æ‰€æœ‰çš„ layer éƒ½ä¸‹è½½å®Œæˆåï¼Œæ•´ä¸ª image çš„ layer å°±ä¸‹è½½å®Œæˆï¼Œæ¥ç€å¼€å§‹è¿›è¡Œè§£å‹(tar -xf) layer çš„ tar åŒ…ã€‚</li><li>dockerd èµ·ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ <code>docker-untar</code> æ¥ gzip è§£å‹ç¼©å·²ç»ä¸‹è½½å®Œæˆçš„ layer æ–‡ä»¶ï¼›å¯¹äºæœ‰äº›æ¯”è¾ƒå¤§çš„é•œåƒï¼ˆæ¯”å¦‚å‡ å GB çš„é•œåƒï¼‰ï¼Œå¾€å¾€é•œåƒçš„ layer å·²ç»ä¸‹è½½å®Œæˆäº†ï¼Œä½†è¿˜æ²¡æœ‰è§£å‹å®ŒğŸ˜‚ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-untar /var/lib/docker/overlay2/a076db6567c7306f3cdab6040cd7d083ef6a39d125171353eedbb8bde7f203b4/diff</span><br></pre></td></tr></table></figure><ul><li>éªŒè¯ image config ä¸­çš„ RootFS.DiffIDs æ˜¯å¦ä¸ä¸‹è½½ï¼ˆè§£å‹åï¼‰hash ç›¸åŒï¼›</li></ul><h3 id="docker-push"><a href="#docker-push" class="headerlink" title="docker push"></a>docker push</h3><p>push æ¨é€ä¸€ä¸ªé•œåƒåˆ°è¿œç¨‹çš„ registry æµç¨‹æ°å¥½å’Œ pull æ‹‰å–é•œåƒåˆ°æœ¬åœ°çš„æµç¨‹ç›¸åã€‚æˆ‘ä»¬ pull ä¸€ä¸ªé•œåƒçš„æ—¶å€™å¾€å¾€éœ€è¦å…ˆè·å–åŒ…å«ç€é•œåƒ layer ä¿¡æ¯çš„ Manifest æ–‡ä»¶ï¼Œç„¶åæ ¹æ®è¿™ä¸ªæ–‡ä»¶ä¸­çš„ layer ä¿¡æ¯å– pull ç›¸åº”çš„ layerã€‚push ä¸€ä¸ªé•œåƒï¼Œéœ€è¦å…ˆå°†é•œåƒçš„å„ä¸ª layer æ¨é€åˆ° registry ï¼Œå½“æ‰€æœ‰çš„é•œåƒ layer ä¸Šä¼ å®Œæ¯•ä¹‹åæœ€åå† push Image Manifest åˆ° registryã€‚å¤§ä½“çš„æµç¨‹å¦‚ä¸‹ï¼š</p><blockquote><p>  All layer uploads use two steps to manage the upload process. The first step starts the upload in the registry service, returning a url to carry out the second step. The second step uses the upload url to transfer the actual data. Uploads are started with a POST request which returns a url that can be used to push data and check upload status.</p></blockquote><ul><li><p>ç¬¬ä¸€æ­¥å’Œ pull ä¸€ä¸ªé•œåƒä¸€æ ·ä¹Ÿæ˜¯è¿›è¡Œé‰´æƒæˆæƒï¼Œæ‹¿åˆ°ä¸€ä¸ª tokenï¼›</p></li><li><p>å‘ registry å‘é€ <code>POST /v2/&lt;name&gt;/blobs/uploads/</code>è¯·æ±‚ï¼Œregistry è¿”å›ä¸€ä¸ªä¸Šä¼ é•œåƒ layer æ—¶è¦åº”åˆ°çš„ URLï¼›</p></li><li><p>å®¢æˆ·ç«¯é€šè¿‡ <code>HEAD /v2/&lt;name&gt;/blobs/&lt;digest&gt;</code> è¯·æ±‚æ£€æŸ¥ registry ä¸­æ˜¯å¦å·²ç»å­˜åœ¨é•œåƒçš„ layerã€‚</p></li><li><p>å®¢æˆ·ç«¯é€šè¿‡URL ä½¿ç”¨ POST æ–¹æ³•æ¥å®æ—¶ä¸Šä¼  layer æ•°æ®ï¼Œä¸Šä¼ é•œåƒ layer åˆ†ä¸º <code>Monolithic Upload</code> ï¼ˆæ•´ä½“ä¸Šä¼ ï¼‰å’Œ<code>Chunked Upload</code>ï¼ˆåˆ†å—ä¸Šä¼ ï¼‰ä¸¤ç§æ–¹å¼ã€‚</p><ul><li>Monolithic Upload </li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PUT /v2/&lt;name&gt;/blobs/uploads/&lt;session_id&gt;?digest=&lt;digest&gt;</span><br><span class="line"><span class="attribute">Content-Length</span>: &lt;size of layer&gt;</span><br><span class="line"><span class="attribute">Content-Type</span>: application/octet-stream</span><br><span class="line"></span><br><span class="line">&lt;Layer Binary Data&gt;</span><br></pre></td></tr></table></figure><ul><li>Chunked Upload</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PATCH /v2/&lt;name&gt;/blobs/uploads/&lt;session_id&gt;</span><br><span class="line"><span class="attribute">Content-Length</span>: &lt;size of chunk&gt;</span><br><span class="line"><span class="attribute">Content-Range</span>: &lt;start of range&gt;-&lt;end of range&gt;</span><br><span class="line"><span class="attribute">Content-Type</span>: application/octet-stream</span><br><span class="line"></span><br><span class="line">&lt;Layer Chunk Binary Data&gt;</span><br></pre></td></tr></table></figure></li><li><p>é•œåƒçš„ layer ä¸Šä¼ å®Œæˆä¹‹åï¼Œå®¢æˆ·ç«¯éœ€è¦å‘ registry å‘é€ä¸€ä¸ª PUT HTTP è¯·æ±‚å‘ŠçŸ¥è¯¥ layer å·²ç»ä¸Šä¼ å®Œæ¯•ã€‚</p></li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT /v2/&lt;name&gt;/blobs/uploads/&lt;session_id&gt;?digest=&lt;digest&gt;</span><br><span class="line"><span class="attribute">Content-Length</span>: &lt;size of chunk&gt;</span><br><span class="line"><span class="attribute">Content-Range</span>: &lt;start of range&gt;-&lt;end of range&gt;</span><br><span class="line"><span class="attribute">Content-Type</span>: application/octet-stream</span><br><span class="line"></span><br><span class="line">&lt;Last Layer Chunk Binary Data&gt;</span><br></pre></td></tr></table></figure><ul><li>æœ€åå½“æ‰€æœ‰çš„ layer ä¸Šä¼ å®Œä¹‹åï¼Œå®¢æˆ·ç«¯å†å°† manifest æ¨é€ä¸Šå»å°±å®Œäº‹å„¿äº†ã€‚</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">PUT /v2/&lt;name&gt;/manifests/&lt;reference&gt;</span><br><span class="line">Content-Type: &lt;manifest media type&gt;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"annotations"</span>: &#123;</span><br><span class="line">      <span class="attr">"com.example.key1"</span>: <span class="string">"value1"</span>,</span><br><span class="line">      <span class="attr">"com.example.key2"</span>: <span class="string">"value2"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:6f4e69a5ff18d92e7315e3ee31c62165ebf25bfa05cad05c0d09d8f412dae401"</span>,</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.oci.image.config.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">452</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:6f4e69a5ff18d92e7315e3ee31c62165ebf25bfa05cad05c0d09d8f412dae401"</span>,</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.oci.image.layer.v1.tar+gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">78343</span></span><br><span class="line">      &#125;</span><br><span class="line">   ],</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Python-docker-drag"><a href="#Python-docker-drag" class="headerlink" title="Python docker-drag"></a>Python <a href="https://github.com/NotGlop/docker-drag" target="_blank" rel="noopener">docker-drag</a></h3><p>è¿™æ˜¯ä¸€ä¸ªå¾ˆç®€å•ç²—æš´çš„ Python è„šæœ¬ï¼Œä½¿ç”¨ request åº“è¯·æ±‚ registry API æ¥ä»é•œåƒä»“åº“ä¸­æ‹‰å–é•œåƒï¼Œå¹¶ä¿å­˜ä¸ºä¸€ä¸ª tar åŒ…ï¼Œæ‹‰å®Œä¹‹åä½¿ç”¨ docker load åŠ è½½ä¸€ä¸‹å°±èƒ½é£Ÿç”¨å•¦ã€‚è¯¥ python è„šæœ¬ç®€å•åˆ°å»æ‰ç©ºè¡Œå’Œæ³¨é‡Šä¸åˆ° 200 è¡Œï¼Œå¦‚æœæŠŠè¿™ä¸ªè„šæœ¬æºç è¯»ä¸€éçš„è¯å°±èƒ½å¤§æ¦‚çŸ¥é“ docker pull å’Œ skopeo copy çš„ä¸€äº›åŸç†ï¼Œä»–ä»¬éƒ½æ˜¯å»è°ƒç”¨ registry çš„ API ï¼Œæ‰€ä»¥è¿˜æ˜¯æ¨èå»è¯»ä¸€ä¸‹è¿™ä¸ªå®ƒçš„æºç ã€‚</p><p>é£Ÿç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•ç›´æ¥ <code>python3 docker_pull.py [image name]</code>ï¼Œè²Œä¼¼åªèƒ½æ‹‰å– docker.io ä¸Šçš„é•œåƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# wget https://raw.githubusercontent.com/NotGlop/docker-drag/master/docker_pull.py</span><br><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# python3 docker_pull.py nginx</span><br><span class="line">Creating image structure in: tmp_nginx_latest</span><br><span class="line">afb6ec6fdc1c: Pull complete [27098756]</span><br><span class="line">dd3ac8106a0b: Pull complete [26210578]                                       ]</span><br><span class="line">8de28bdda69b: Pull complete [538]</span><br><span class="line">a2c431ac2669: Pull complete [900]</span><br><span class="line">e070d03fd1b5: Pull complete [669]</span><br><span class="line">Docker image pulled: library_nginx.tar</span><br><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# docker load -i library_nginx.tar</span><br><span class="line">ffc9b21953f4: Loading layer [==================================================&gt;]  72.49MB/72.49MB</span><br><span class="line">d9c0b16c8d5b: Loading layer [==================================================&gt;]  63.81MB/63.81MB</span><br><span class="line">8c7fd6263c1f: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">077ae58ac205: Loading layer [==================================================&gt;]  4.096kB/4.096kB</span><br><span class="line">787328500ad5: Loading layer [==================================================&gt;]  3.584kB/3.584kB</span><br><span class="line">Loaded image: nginx:latest</span><br></pre></td></tr></table></figure><h3 id="skopeo"><a href="#skopeo" class="headerlink" title="skopeo"></a>skopeo</h3><p>è¿™ä¸ªå·¥å…·æ˜¯çº¢å¸½å­å®¶çš„ï¼Œæ˜¯ Podmanã€Skopeo å’Œ Buildah ï¼ˆç®€ç§° PSB ï¼‰ä¸‹ä¸€ä»£å®¹å™¨æ–°æ¶æ„ä¸­çš„ä¸€å‘˜ï¼Œä¸è¿‡æœ¨å­è§‰ç€ Podman æƒ³è¦å–ä»£ docker å’Œ containerd å®¹å™¨è¿è¡Œæ—¶è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ï¼Œè™½ç„¶å®ƒç¬¦åˆ OCI è§„èŒƒï¼Œä½†å¯¹äºä¼ä¸šæ¥è®²ï¼Œæ›¿æ¢çš„æˆæœ¬å¹¶ä¸å€¼å¾—ä»–ä»¬å»æ¢åˆ° PSB ä¸Šå»ã€‚</p><p>å…¶ä¸­çš„ skopeo è¿™ä¸ªé•œåƒæ¬è¿å·¥å…·ç®€ç›´æ˜¯ä¸ªç¥å™¨ï¼Œå°¤å…¶æ˜¯åœ¨ CI/CD æµæ°´çº¿ä¸­æ¬è¿ä¸¤ä¸ªé•œåƒä»“åº“é‡Œçš„é•œåƒç®€ç›´çˆ½çš„ä¸å¾—äº†ã€‚æˆ‘å…¥èŒæ–°å…¬å¸ååšçš„ä¸€ä¸ªå·¥ä½œå°±æ˜¯ä¼˜åŒ–æˆ‘ä»¬çš„ Jenkins æµæ°´çº¿ä¸­åŒæ­¥ä¸¤ä¸ªé•œåƒä»“åº“çš„è¿‡ç¨‹ï¼Œä½¿ç”¨ äº†skopeo æ›¿ä»£ docker æ¥åŒæ­¥ä¸¤ä¸ªé•œåƒä»“åº“ä¸­çš„é•œåƒï¼Œå°†åŸæ¥éœ€è¦ 2h å°æ—¶ç¼©çŸ­åˆ°äº† 25min ğŸ˜€ã€‚</p><p>å…³äºè¿™ä¸ªå·¥å…·çš„è¯¦ç»†ä½¿ç”¨æ¨èå¤§å®¶å»è¯»ä¸€ä¸‹æˆ‘ä¹‹å‰å†™çš„ä¸€ç¯‡åšå®¢ <a href="https://blog.k8s.li/skopeo.html">é•œåƒæ¬è¿å·¥ skopeo åˆä½“éªŒ</a> ã€‚åœ¨è¿™é‡Œåªè®²ä¸¤ä¸ªæœ¨å­æœ€å¸¸ç”¨çš„åŠŸèƒ½ã€‚</p><h4 id="skopeo-copy"><a href="#skopeo-copy" class="headerlink" title="skopeo copy"></a>skopeo copy</h4><p>ä½¿ç”¨ skopeo copy ä¸¤ä¸ª registry ä¸­çš„é•œåƒæ—¶ï¼Œskopeo è¯·æ±‚ä¸¤ä¸ª registry API ç›´æ¥ copy <code>original blob</code> åˆ°å¦ä¸€ä¸ª registry ï¼Œè¿™æ ·å…å»äº†åƒ docker pull â€“&gt; docker tag â€“&gt; docker push é‚£æ · pull é•œåƒå¯¹é•œåƒè¿›è¡Œè§£å‹ç¼©ï¼Œpush é•œåƒè¿›è¡Œå‹ç¼©ã€‚å°¤å…¶æ˜¯åœ¨æ¬è¿ä¸€äº›è¾ƒå¤§çš„é•œåƒï¼ˆå‡ GB æˆ–è€…å‡ å GBçš„é•œåƒï¼Œæ¯”å¦‚ <code>nvidia/cuda</code> ï¼‰ï¼Œä½¿ç”¨ skopeo copy çš„åŠ é€Ÿæ•ˆæœååˆ†æ˜æ˜¾ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">DEBU[0000] Detected compression format gzip</span><br><span class="line">DEBU[0000] Using original blob without modification</span><br><span class="line"></span><br><span class="line">Getting image source signatures</span><br><span class="line">Copying blob 09a9f6a07669 done</span><br><span class="line">Copying blob f8cdeb3c6c18 done</span><br><span class="line">Copying blob 22c4d5853f25 done</span><br><span class="line">Copying blob 76abc3f50d9b done</span><br><span class="line">Copying blob 3386b7c9ccd4 done</span><br><span class="line">Copying blob b9207193f1af [==============================&gt;-------] 224.2MiB / 271.2MiB</span><br><span class="line">Copying blob 2f32d819e6ce done</span><br><span class="line">Copying blob 5dbc3047e646 done</span><br><span class="line">Copying blob f8dfcc3265c3 [==================&gt;-------------------] 437.1MiB / 864.3MiB</span><br><span class="line">Copying blob 13d3556105d1 done</span><br><span class="line">Copying blob f9b7fa6a027e [=========================&gt;------------] 84.0MiB / 124.3MiB</span><br><span class="line">Copying blob a1a0f6abe73b [====================&gt;-----------------] 417.9MiB / 749.1MiB</span><br><span class="line">Copying blob bcc9947fc8a4 done</span><br><span class="line">Copying blob 9563b2824fef done</span><br><span class="line">Copying blob a1b8faa0044b [===&gt;----------------------------------] 88.0MiB / 830.1MiB</span><br><span class="line">Copying blob 9917e218edfd [===============&gt;----------------------] 348.6MiB / 803.6MiB</span><br><span class="line">Copying blob 776b9ff2f788 done</span><br><span class="line">Copying config d0c3cfd730 done</span><br><span class="line">Writing manifest to image destination</span><br><span class="line">Storing signatures</span><br></pre></td></tr></table></figure><h4 id="skopeo-inspect"><a href="#skopeo-inspect" class="headerlink" title="skopeo inspect"></a>skopeo inspect</h4><p>ç”¨ skopeo inspect å‘½ä»¤å¯ä»¥å¾ˆæ–¹æ–¹ä¾¿åœ°é€šè¿‡ registry çš„ API æ¥æŸ¥çœ‹é•œåƒçš„ manifest æ–‡ä»¶ï¼Œä»¥å‰æˆ‘éƒ½æ˜¯ç”¨ curl å‘½ä»¤çš„ï¼Œè¦ token è¿˜è¦åŠ ä¸€å †å‚æ•°ï¼Œæ‰€ä»¥æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥åæ¥å°±ç”¨ä¸Šäº†  skopeo inspectğŸ˜€ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@deploy:/root # skopeo inspect docker://index.docker.io/webpsh/webps:latest --raw</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">   <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.container.image.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">2534</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:30d9679b0b1ca7e56096eca0cdb7a6eedc29b63968f25156ef60dec27bc7d206"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">2813316</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">8088920</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:54335262c2ed2d4155e62b45b187a1394fbb6f39e0a4a171ab8ce0c93789e6b0"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">262</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:31555b34852eddc7c01f26fa9c0e5e577e36b4e7ccf1b10bec977eb4593a376b"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é•œåƒæ˜¯æ€ä¹ˆå­˜æ”¾çš„-äºŒ-registry-å­˜å‚¨ğŸ™„"><a href="#é•œåƒæ˜¯æ€ä¹ˆå­˜æ”¾çš„-äºŒ-registry-å­˜å‚¨ğŸ™„" class="headerlink" title="é•œåƒæ˜¯æ€ä¹ˆå­˜æ”¾çš„ (äºŒ) registry å­˜å‚¨ğŸ™„"></a>é•œåƒæ˜¯æ€ä¹ˆå­˜æ”¾çš„ (äºŒ) registry å­˜å‚¨ğŸ™„</h2><p>æ–‡ç« çš„å¼€å¤´æˆ‘ä»¬æåˆ°è¿‡ OCI è§„èŒƒä¸­çš„é•œåƒä»“åº“è§„èŒƒ <a href="https://github.com/opencontainers/distribution-spec" target="_blank" rel="noopener">distribution-spec</a>ï¼Œè¯¥è§„èŒƒå°±å®šä¹‰ç€å®¹å™¨é•œåƒå¦‚ä½•å­˜å‚¨åœ¨è¿œç«¯ï¼ˆå³ registryï¼‰ä¸Šã€‚æˆ‘ä»¬å¯ä»¥æŠŠ registry çœ‹ä½œé•œåƒçš„ä»“åº“ï¼Œä½¿ç”¨è¯¥è§„èŒƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠŠè¿™äº›é•œåƒæŒ‰ç…§çº¦å®šä¿—æˆçš„æ ¼å¼æ¥å­˜æ”¾ï¼Œç›®å‰å®ç°è¯¥è§„èŒƒçš„ registry å°± docker å®¶çš„ registry ä½¿ç”¨çš„å¤šä¸€äº›ã€‚å…¶ä»–çš„ registry æ¯”å¦‚ harbor ï¼Œquay.io ä½¿ç”¨çš„ä¹Ÿæ¯”è¾ƒå¤šã€‚</p><h3 id="registry-registry-docker-v2"><a href="#registry-registry-docker-v2" class="headerlink" title="registry (/registry/docker/v2)"></a>registry (/registry/docker/v2)</h3><p>æƒ³è¦åˆ†æä¸€ä¸‹é•œåƒæ˜¯å¦‚ä½•å­˜æ”¾åœ¨ registry ä¸Šçš„ï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°ä½¿ç”¨ docker run æ¥èµ· registry çš„å®¹å™¨å³å¯ï¼Œæˆ‘ä»¬ä»…ä»…æ˜¯æ¥åˆ†æ registry ä¸­é•œåƒæ—¶å¦‚ä½•å­˜å‚¨çš„ï¼Œè¿™ç§åœºæ™¯ä¸‹ä¸å¤ªé€‚åˆç”¨ harbor è¿™ç§é‡é‡çº§çš„ registry ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# docker run -d --name registry -p 5000:5000 -v /var/lib/registry:/var/lib/registry registry</span><br><span class="line">335ea763a2fa4508ebf3ec6f8b11f3b620a11bdcaa0ab43176b781427e0beee6</span><br></pre></td></tr></table></figure><p>å¯åŠ¨å®Œ registry å®¹å™¨ä¹‹åæˆ‘ä»¬ç»™ä¹‹å‰å·²ç»æ„å»ºå¥½çš„é•œåƒé‡æ–°æ‰“ä¸Šæ”¹ registry çš„ tag æ–¹ä¾¿åç»­ push åˆ° registry ä¸Šã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker tag debian:v1  localhost:5000/library/debian:v1</span><br><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# ^v1^v2</span><br><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker tag debian:v2  localhost:5000/library/debian:v2</span><br><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker images</span><br><span class="line">REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">debian                          v2                  e6e782a57a51        5 minutes ago       69.2MB</span><br><span class="line">localhost:5000/library/debian   v2                  e6e782a57a51        5 minutes ago       69.2MB</span><br><span class="line">debian                          v1                  cfba37fd24f8        9 minutes ago       69.2MB</span><br><span class="line">localhost:5000/library/debian   v1                  cfba37fd24f8        9 minutes ago       69.2MB</span><br><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker push localhost:5000/library/debian:v1</span><br><span class="line">The push refers to repository [localhost:5000/library/debian]</span><br><span class="line">d1b85e6186f6: Pushed</span><br><span class="line">v1: digest: sha256:b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239 size: 529</span><br><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker push localhost:5000/library/debian:v2</span><br><span class="line">The push refers to repository [localhost:5000/library/debian]</span><br><span class="line">d1b85e6186f6: Layer already exists</span><br><span class="line">v2: digest: sha256:c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11 size: 529</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬åœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ª registry å®¹å™¨ä¹‹åï¼Œå®¹å™¨å†…é»˜è®¤çš„å­˜å‚¨ä½ç½®ä¸º <code>/var/lib/registry</code> ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å¯åŠ¨çš„æ—¶å€™åŠ äº†å‚æ•° <code>-v /var/lib/registry:/var/lib/registry</code> å°†æœ¬æœºçš„è·¯å¾„æŒ‚è½½åˆ°å®¹å™¨å†…ã€‚è¿›å…¥è¿™é‡Œè·¯å¾„æˆ‘ä»¬ä½¿ç”¨ tree å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªç›®å½•çš„å­˜å‚¨ç»“æ„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# tree -h</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ [4.0K]  blobs</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  aa</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ [ 26M]  data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  b9</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ [ 529]  data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  c8</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ [ 529]  data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  cf</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ [1.4K]  data</span><br><span class="line">â”‚Â Â      â””â”€â”€ [4.0K]  e6</span><br><span class="line">â”‚Â Â          â””â”€â”€ [4.0K]  e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df</span><br><span class="line">â”‚Â Â              â””â”€â”€ [1.4K]  data</span><br><span class="line">â””â”€â”€ [4.0K]  repositories</span><br><span class="line">    â””â”€â”€ [4.0K]  library</span><br><span class="line">        â””â”€â”€ [4.0K]  debian</span><br><span class="line">            â”œâ”€â”€ [4.0K]  _layers</span><br><span class="line">            â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">            â”‚Â Â      â”œâ”€â”€ [4.0K]  aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â      â”œâ”€â”€ [4.0K]  cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â      â””â”€â”€ [4.0K]  e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df</span><br><span class="line">            â”‚Â Â          â””â”€â”€ [  71]  link</span><br><span class="line">            â”œâ”€â”€ [4.0K]  _manifests</span><br><span class="line">            â”‚Â Â  â”œâ”€â”€ [4.0K]  revisions</span><br><span class="line">            â”‚Â Â  â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">            â”‚Â Â  â”‚Â Â      â”œâ”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">            â”‚Â Â  â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â  â”‚Â Â      â””â”€â”€ [4.0K]  c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11</span><br><span class="line">            â”‚Â Â  â”‚Â Â          â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â  â””â”€â”€ [4.0K]  tags</span><br><span class="line">            â”‚Â Â      â”œâ”€â”€ [4.0K]  v1</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â”œâ”€â”€ [4.0K]  current</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  index</span><br><span class="line">            â”‚Â Â      â”‚Â Â      â””â”€â”€ [4.0K]  sha256</span><br><span class="line">            â”‚Â Â      â”‚Â Â          â””â”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">            â”‚Â Â      â”‚Â Â              â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â      â””â”€â”€ [4.0K]  v2</span><br><span class="line">            â”‚Â Â          â”œâ”€â”€ [4.0K]  current</span><br><span class="line">            â”‚Â Â          â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â          â””â”€â”€ [4.0K]  index</span><br><span class="line">            â”‚Â Â              â””â”€â”€ [4.0K]  sha256</span><br><span class="line">            â”‚Â Â                  â””â”€â”€ [4.0K]  c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11</span><br><span class="line">            â”‚Â Â                      â””â”€â”€ [  71]  link</span><br><span class="line">            â””â”€â”€ [4.0K]  _uploads</span><br><span class="line"></span><br><span class="line">37 directories, 14 files</span><br></pre></td></tr></table></figure><p>æ ‘å½¢çš„ç»“æ„çœ‹ç€ä¸å¤ªç›´è§‚ï¼Œæœ¨å­å°±ç”»äº†ä¸€å¼ å±‚çº§ç»“æ„çš„å›¾ï¼š</p><p><img src="img/registry-storage.jpeg" alt="img"></p><h3 id="blobs-ç›®å½•"><a href="#blobs-ç›®å½•" class="headerlink" title="blobs ç›®å½•"></a>blobs ç›®å½•</h3><p>ä¹‹å‰æˆ‘ä»¬å‘ registry ç§æ¨é€äº†ä¸¤ä¸ªé•œåƒï¼Œè¿™ä¸¤ä¸ªé•œåƒçš„ layer ç›¸åŒä½†ä¸æ˜¯ç”¨ä¸€ä¸ªé•œåƒï¼Œåœ¨æˆ‘ä»¬ä¹‹å‰ push image çš„æ—¶å€™ä¹Ÿçœ‹åˆ°äº† <code>d1b85e6186f6: Layer already exists</code>ã€‚ä¹Ÿå°±å¯ä»¥è¯æ˜äº†ï¼Œè™½ç„¶ä¸¤ä¸ªé•œåƒä¸åŒï¼Œä½†å®ƒä»¬çš„ layer åœ¨ registry ä¸­å­˜å‚¨çš„æ—¶å€™å¯èƒ½æ˜¯ç›¸åŒçš„ã€‚</p><p>åœ¨ <code>blobs/sha256</code> ç›®å½•ä¸‹ä¸€å…±æœ‰ 5 ä¸ªåä¸º data çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æµ‹ä¸€ä¸‹æœ€å¤§çš„é‚£ä¸ª <code>[ 26M]</code> åº”è¯¥æ˜¯é•œåƒçš„ layer ï¼Œæœ€å°çš„ <code>[ 529]</code> é‚£ä¸ªåº”è¯¥æ˜¯ manifestï¼Œå‰©ä¸‹çš„é‚£ä¸ª <code>[1.4K]</code> åº”è¯¥å°±æ˜¯ image config æ–‡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/blobs/sha256</span><br><span class="line">â•°â”€# tree -h</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ [4.0K]  aa</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb</span><br><span class="line">â”‚Â Â      â””â”€â”€ [ 26M]  data</span><br><span class="line">â”œâ”€â”€ [4.0K]  b9</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â”‚Â Â      â””â”€â”€ [ 529]  data</span><br><span class="line">â”œâ”€â”€ [4.0K]  c8</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11</span><br><span class="line">â”‚Â Â      â””â”€â”€ [ 529]  data</span><br><span class="line">â”œâ”€â”€ [4.0K]  cf</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d</span><br><span class="line">â”‚Â Â      â””â”€â”€ [1.4K]  data</span><br><span class="line">â””â”€â”€ [4.0K]  e6</span><br><span class="line">    â””â”€â”€ [4.0K]  e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df</span><br><span class="line">        â””â”€â”€ [1.4K]  data</span><br></pre></td></tr></table></figure><p>åœ¨ <code>registry</code> çš„å­˜å‚¨ç›®å½•ä¸‹ï¼Œ<code>blobs</code> ç›®å½•ç”¨æ¥å­˜æ”¾é•œåƒçš„ä¸‰ç§æ–‡ä»¶ï¼š layer çš„çœŸå®æ•°æ®ï¼Œé•œåƒçš„ manifest æ–‡ä»¶ï¼Œé•œåƒçš„ image config æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶éƒ½æ˜¯ä»¥ <code>data</code> ä¸ºåçš„æ–‡ä»¶å­˜æ”¾åœ¨äºè¯¥æ–‡ä»¶ <code>sha256</code> ç›¸å¯¹åº”çš„ç›®å½•ä¸‹ã€‚ ä½¿ç”¨ä»¥å†…å®¹å¯»å€çš„ <code>sha256</code> æ•£åˆ—å­˜å‚¨æ–¹ä¾¿ç´¢å¼•æ–‡ä»¶ï¼Œåœ¨ <code>blob digest</code> ç›®å½•ä¸‹æœ‰ä¸€ä¸ªåä¸º <code>data</code>çš„æ–‡ä»¶ï¼Œå¯¹äº layer æ¥è®²ï¼Œè¿™æ˜¯ä¸ª <code>data</code> æ–‡ä»¶çš„æ ¼å¼æ˜¯ <code>vnd.docker.image.rootfs.diff.tar.gzip</code> ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>tar -xvf</code> å‘½ä»¤å°†è¿™ä¸ª layer è§£å¼€ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ docker pull å‘½ä»¤æ‹‰å–é•œåƒçš„æ—¶å€™ï¼Œä¹Ÿæ˜¯å»ä¸‹è½½è¿™ä¸ª <code>data</code>æ–‡ä»¶ï¼Œä¸‹è½½å®Œæˆä¹‹åä¼šæœ‰ä¸€ä¸ª <code>docker-untar</code>çš„è¿›ç¨‹å°†è¿™ä¸ª <code>data</code>æ–‡ä»¶è§£å¼€å­˜æ”¾åœ¨<code>/var/lib/docker/overlay2/${digest}/diff</code> ç›®å½•ä¸‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ [4.0K]  blobs</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  aa</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ [ 26M]  data</span><br></pre></td></tr></table></figure><h4 id="manifest-æ–‡ä»¶"><a href="#manifest-æ–‡ä»¶" class="headerlink" title="manifest æ–‡ä»¶"></a>manifest æ–‡ä»¶</h4><p>å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ json æ–‡ä»¶å•¦ï¼Œè®°å½•äº†ä¸€ä¸ªé•œåƒæ‰€åŒ…å«çš„ layer ä¿¡æ¯ï¼Œå½“æˆ‘ä»¬ pull é•œåƒçš„æ—¶å€™ä¼šä½¿ç”¨åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/blobs/sha256/b9/b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â•°â”€# cat data</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">   <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.container.image.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">1462</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">27097859</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;#</span><br></pre></td></tr></table></figure><h4 id="image-config-æ–‡ä»¶"><a href="#image-config-æ–‡ä»¶" class="headerlink" title="image config æ–‡ä»¶"></a>image config æ–‡ä»¶</h4><p>image config æ–‡ä»¶é‡Œå¹¶æ²¡æœ‰åŒ…å«é•œåƒçš„ tag ä¿¡æ¯ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/blobs/sha256/e6/e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df</span><br><span class="line">â•°â”€# cat data | jq "."</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">  <span class="attr">"config"</span>: &#123;</span><br><span class="line">    <span class="attr">"Hostname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"User"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"bash"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Image"</span>: <span class="string">"sha256:ba8f577813c7bdf6b737f638dffbc688aa1df2ff28a826a6c46bae722977b549"</span>,</span><br><span class="line">    <span class="attr">"Volumes"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Entrypoint"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OnBuild"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"Labels"</span>: <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"container"</span>: <span class="string">"38501d5aa48c080884f4dc6fd4b1b6590ff1607d9e7a12e1cef1d86a3fdc32df"</span>,</span><br><span class="line">  <span class="attr">"container_config"</span>: &#123;</span><br><span class="line">    <span class="attr">"Hostname"</span>: <span class="string">"38501d5aa48c"</span>,</span><br><span class="line">    <span class="attr">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"User"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"/bin/sh"</span>,</span><br><span class="line">      <span class="string">"-c"</span>,</span><br><span class="line">      <span class="string">"#(nop) "</span>,</span><br><span class="line">      <span class="string">"CMD [\"bash\"]"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Image"</span>: <span class="string">"sha256:ba8f577813c7bdf6b737f638dffbc688aa1df2ff28a826a6c46bae722977b549"</span>,</span><br><span class="line">    <span class="attr">"Volumes"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Entrypoint"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OnBuild"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"Labels"</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"created"</span>: <span class="string">"2020-06-07T01:59:47.348924716Z"</span>,</span><br><span class="line">  <span class="attr">"docker_version"</span>: <span class="string">"19.03.5"</span>,</span><br><span class="line">  <span class="attr">"history"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-06-07T01:59:46.877600299Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop) ADD file:a82014afc29e7b364ac95223b22ebafad46cc9318951a85027a49f9ce1a99461 in / "</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-06-07T01:59:47.348924716Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop)  CMD [\"bash\"]"</span>,</span><br><span class="line">      <span class="attr">"empty_layer"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">  <span class="attr">"rootfs"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"layers"</span>,</span><br><span class="line">    <span class="attr">"diff_ids"</span>: [</span><br><span class="line">      <span class="string">"sha256:d1b85e6186f67d9925c622a7a6e66faa447e767f90f65ae47cdc817c629fa956"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="uploads-æ–‡ä»¶å¤¹"><a href="#uploads-æ–‡ä»¶å¤¹" class="headerlink" title="_uploads æ–‡ä»¶å¤¹"></a>_uploads æ–‡ä»¶å¤¹</h4><p>_uploads æ–‡ä»¶å¤¹æ˜¯ä¸ªä¸´æ—¶çš„æ–‡ä»¶å¤¹ï¼Œä¸»è¦ç”¨æ¥å­˜æ”¾ push é•œåƒè¿‡ç¨‹ä¸­çš„æ–‡ä»¶æ•°æ®ï¼Œå½“é•œåƒ <code>layer</code> ä¸Šä¼ å®Œæˆä¹‹åä¼šæ¸…ç©ºè¯¥æ–‡ä»¶å¤¹ã€‚å…¶ä¸­çš„ <code>data</code> æ–‡ä»¶ä¸Šä¼ å®Œæ¯•åä¼šç§»åŠ¨åˆ° <code>blobs</code> ç›®å½•ä¸‹ï¼Œæ ¹æ®è¯¥æ–‡ä»¶çš„ <code>sha256</code> å€¼æ¥è¿›è¡Œæ•£åˆ—å­˜å‚¨åˆ°ç›¸åº”çš„ç›®å½•ä¸‹ã€‚</p><p>ä¸Šä¼ è¿‡ç¨‹ä¸­çš„ç›®å½•ç»“æ„ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">_uploads</span><br><span class="line">â”œâ”€â”€ [  53]  0d6c996e-638f-4436-b2b6-54fa7ad430d2</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ [198M]  data</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ [  20]  hashstates</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ [  15]  sha256</span><br><span class="line">â”‚Â Â  â”‚Â Â      â””â”€â”€ [ 108]  0</span><br><span class="line">â”‚Â Â  â””â”€â”€ [  20]  startedat</span><br><span class="line">â””â”€â”€ [  53]  ba31818e-4217-47ef-ae46-2784c9222614</span><br><span class="line">    â”œâ”€â”€ [571M]  data</span><br><span class="line">    â”œâ”€â”€ [  20]  hashstates</span><br><span class="line">    â”‚Â Â  â””â”€â”€ [  15]  sha256</span><br><span class="line">    â”‚Â Â      â””â”€â”€ [ 108]  0</span><br><span class="line">    â””â”€â”€ [  20]  startedat</span><br><span class="line"></span><br><span class="line">6 directories, 6 files</span><br></pre></td></tr></table></figure><ul><li>ä¸Šä¼ å®Œé•œåƒä¹‹åï¼Œ<code>_uploads</code> æ–‡ä»¶å¤¹å°±ä¼šè¢«æ¸…ç©ºï¼Œæ­£å¸¸æƒ…å†µä¸‹è¿™ä¸ªæ–‡ä»¶å¤¹æ˜¯ç©ºçš„ã€‚ä½†ä¹Ÿæœ‰å¼‚å¸¸çš„æ—¶å€™ğŸ˜‚ï¼Œæ¯”å¦‚ç½‘ç»œæŠ–åŠ¨å¯¼è‡´ä¸Šä¼ æ„å¤–ä¸­æ–­ï¼Œè¯¥æ–‡ä»¶å¤¹å°±å¯èƒ½ä¸ä¸ºç©ºã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_uploads</span><br><span class="line"></span><br><span class="line">0 directories, 0 files</span><br></pre></td></tr></table></figure><h4 id="manifests-æ–‡ä»¶å¤¹"><a href="#manifests-æ–‡ä»¶å¤¹" class="headerlink" title="_manifests æ–‡ä»¶å¤¹"></a>_manifests æ–‡ä»¶å¤¹</h4><p><code>_manifests</code> æ–‡ä»¶å¤¹æ˜¯é•œåƒä¸Šä¼ å®Œæˆä¹‹åç”± registry æ¥ç”Ÿæˆçš„ï¼Œå¹¶ä¸”è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªåä¸º <code>link</code>çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå®ƒçš„å€¼æŒ‡å‘ blobs ç›®å½•ä¸‹ä¸ä¹‹å¯¹åº”çš„ç›®å½•ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/repositories/library</span><br><span class="line">â•°â”€# find . -type f</span><br><span class="line">./debian/_layers/sha256/aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb/link</span><br><span class="line">./debian/_layers/sha256/e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df/link</span><br><span class="line">./debian/_layers/sha256/cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d/link</span><br><span class="line">./debian/_manifests/tags/v2/current/link</span><br><span class="line">./debian/_manifests/tags/v2/index/sha256/c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11/link</span><br><span class="line">./debian/_manifests/tags/v1/current/link</span><br><span class="line">./debian/_manifests/tags/v1/index/sha256/b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239/link</span><br><span class="line">./debian/_manifests/revisions/sha256/b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239/link</span><br><span class="line">./debian/_manifests/revisions/sha256/c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11/link</span><br></pre></td></tr></table></figure><p><code>_manifests</code> æ–‡ä»¶å¤¹ä¸‹åŒ…å«ç€é•œåƒçš„ <code>tags</code> å’Œ <code>revisions</code> ä¿¡æ¯ï¼Œæ¯ä¸€ä¸ªé•œåƒçš„æ¯ä¸€ä¸ª tag å¯¹åº”ç€äº tag åç›¸åŒçš„ç›®å½•ã€‚é•œåƒçš„ tag å¹¶ä¸å­˜å‚¨åœ¨ image config ä¸­ï¼Œè€Œæ˜¯ä»¥ç›®å½•çš„å½¢å¼æ¥å½¢æˆé•œåƒçš„ tagï¼Œè¿™ä¸€ç‚¹æ¯”è¾ƒå¥‡å¦™ï¼Œè¿™å’Œæˆ‘ä»¬ Dockerfile ä¸­å¹¶ä¸åŒ…å«é•œåƒåå’Œ tag ä¸€ä¸ªé“ç†ï¼Ÿ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ [4.0K]  _layers</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â      â””â”€â”€ [4.0K]  e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df</span><br><span class="line">â”‚Â Â          â””â”€â”€ [  71]  link</span><br><span class="line">â”œâ”€â”€ [4.0K]  _manifests</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ [4.0K]  revisions</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â  â”‚Â Â      â”œâ”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â”‚Â Â  â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â  â”‚Â Â      â””â”€â”€ [4.0K]  c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11</span><br><span class="line">â”‚Â Â  â”‚Â Â          â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  tags</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  v1</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ [4.0K]  current</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  index</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â      â”‚Â Â          â””â”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â”‚Â Â      â”‚Â Â              â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â      â””â”€â”€ [4.0K]  v2</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ [4.0K]  current</span><br><span class="line">â”‚Â Â          â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â          â””â”€â”€ [4.0K]  index</span><br><span class="line">â”‚Â Â              â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â                  â””â”€â”€ [4.0K]  c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11</span><br><span class="line">â”‚Â Â                      â””â”€â”€ [  71]  link</span><br><span class="line">â””â”€â”€ [4.0K]  _uploads</span><br><span class="line"></span><br><span class="line">22 directories, 9 files</span><br></pre></td></tr></table></figure><h4 id="é•œåƒçš„-tag"><a href="#é•œåƒçš„-tag" class="headerlink" title="é•œåƒçš„ tag"></a>é•œåƒçš„ tag</h4><p> æ¯ä¸ª <code>tag</code>åç›®å½•ä¸‹é¢æœ‰ <code>current</code> ç›®å½•å’Œ <code>index</code> ç›®å½•ï¼Œ <code>current</code> ç›®å½•ä¸‹çš„ link æ–‡ä»¶ä¿å­˜äº†è¯¥ tag ç›®å‰çš„ manifest æ–‡ä»¶çš„ sha256 ç¼–ç ï¼Œå¯¹åº”åœ¨ <code>blobs</code> ä¸­çš„ <code>sha256</code> ç›®å½•ä¸‹çš„ <code>data</code> æ–‡ä»¶ï¼Œè€Œ <code>index</code> ç›®å½•åˆ™åˆ—å‡ºäº†è¯¥ <code>tag</code> å†å²ä¸Šä¼ çš„æ‰€æœ‰ç‰ˆæœ¬çš„ <code>sha256</code> ç¼–ç ä¿¡æ¯ã€‚<code>_revisions</code> ç›®å½•é‡Œå­˜æ”¾äº†è¯¥ <code>repository</code> å†å²ä¸Šä¸Šä¼ ç‰ˆæœ¬çš„æ‰€æœ‰ sha256 ç¼–ç ä¿¡æ¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/repositories/library/debian/_manifests/tags/v1</span><br><span class="line">â•°â”€# cat current/link</span><br><span class="line">sha256:b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/blobs/sha256</span><br><span class="line">â•°â”€# tree -h</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ [4.0K]  aa</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb</span><br><span class="line">â”‚Â Â      â””â”€â”€ [ 26M]  data</span><br><span class="line">â”œâ”€â”€ [4.0K]  b9</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â”‚Â Â      â””â”€â”€ [ 529]  data</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ <code>pull</code> é•œåƒçš„æ—¶å€™å¦‚æœä¸æŒ‡å®šé•œåƒçš„ <code>tag</code>åï¼Œé»˜è®¤å°±æ˜¯ latestï¼Œregistry ä¼šä» HTTP è¯·æ±‚ä¸­è§£æåˆ°è¿™ä¸ª tag åï¼Œç„¶åæ ¹æ® tag åç›®å½•ä¸‹çš„ link æ–‡ä»¶æ‰¾åˆ°è¯¥é•œåƒçš„ manifest çš„ä½ç½®è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ¥ç€å»è¯·æ±‚è¿™ä¸ª manifest æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯æ ¹æ®è¿™ä¸ª manifest æ–‡ä»¶æ¥ pull ç›¸åº”çš„é•œåƒ layer ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/repositories/library/debian/_manifests/tags/v1</span><br><span class="line">â•°â”€# cat  /var/lib/registry/docker/registry/v2/blobs/sha256/b9/b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239/data</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">   <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.container.image.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">1462</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">27097859</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åå†è¡¥å……ä¸€ç‚¹å°±æ˜¯ï¼ŒåŒä¸€ä¸ªé•œåƒåœ¨ registry ä¸­å­˜å‚¨çš„ä½ç½®æ˜¯ç›¸åŒçš„ï¼Œå…·ä½“çš„åˆ†æå¯ä»¥å‚è€ƒ <a href="https://supereagle.github.io/2018/04/24/docker-registry/" target="_blank" rel="noopener">é•œåƒä»“åº“ä¸­é•œåƒå­˜å‚¨çš„åŸç†è§£æ</a> è¿™ç¯‡åšå®¢ã€‚</p><blockquote><ul><li>é€šè¿‡ Registry API è·å¾—çš„ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ manifest ä¿¡æ¯å®Œå…¨ç›¸åŒã€‚</li><li>ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ manifest ä¿¡æ¯çš„å­˜å‚¨è·¯å¾„å’Œå†…å®¹å®Œå…¨ç›¸åŒã€‚</li><li>ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ blob ä¿¡æ¯çš„å­˜å‚¨è·¯å¾„å’Œå†…å®¹å®Œå…¨ç›¸åŒã€‚</li></ul></blockquote><p>ä»ä¸Šé¢è¿™ä¸‰ä¸ªç»“è®ºä¸­æˆ‘ä»¬å¯ä»¥æ¨æ–­å‡º registry å­˜å‚¨ç›®å½•é‡Œå¹¶ä¸ä¼šå­˜å‚¨ä¸è¯¥ registry ç›¸å…³çš„ä¿¡æ¯ï¼Œæ¯”æˆ‘ä»¬ push é•œåƒçš„æ—¶å€™éœ€è¦ç»™é•œåƒåŠ ä¸Š <code>localhost:5000</code> è¿™ä¸ªå‰ç¼€ï¼Œè¿™ä¸ªå‰ç¼€å¹¶ä¸ä¼šå­˜å‚¨åœ¨ registry å­˜å‚¨ä¸­ã€‚åŠ å…¥æˆ‘è¦è¿ç§»ä¸€ä¸ªå¾ˆå¤§çš„ registry é•œåƒä»“åº“ï¼Œé•œåƒçš„æ•°é‡åœ¨ 5k ä»¥ä¸Šã€‚æœ€ä¾¿æ·çš„åŠæ³•å°±æ˜¯æ‰“åŒ…è¿™ä¸ª registry å­˜å‚¨ç›®å½•ï¼Œå°†è¿™ä¸ª tar åŒ… rsync åˆ°å¦ä¸€å°æœºå™¨å³å¯ã€‚éœ€è¦å¼ºè°ƒä¸€ç‚¹ï¼Œæ‰“åŒ… registry å­˜å‚¨ç›®å½•çš„æ—¶å€™ä¸éœ€è¦è¿›è¡Œå‹ç¼©ï¼Œç›´æ¥ <code>tar -cvf</code> å³å¯ã€‚å› ä¸º registry å­˜å‚¨çš„é•œåƒ layer å·²ç»æ˜¯ä¸ª <code>tar.gzip</code> æ ¼å¼çš„æ–‡ä»¶ï¼Œå†è¿›è¡Œå‹ç¼©çš„è¯æ•ˆæœç”šå¾®è€Œä¸”è¿˜æµªè´¹ CPU æ—¶é—´å¾—ä¸å¿å¤±ã€‚</p><h3 id="docker-archive"><a href="#docker-archive" class="headerlink" title="docker-archive"></a>docker-archive</h3><p>æœ¬æ¥æˆ‘æƒ³ç€ docker save å‡ºæ¥çš„å¹¶ä¸æ˜¯ä¸€ä¸ªé•œåƒï¼Œè€Œæ˜¯ä¸€ä¸ª <code>.tar</code> æ–‡ä»¶ï¼Œä½†æˆ‘æƒ³äº†åˆæƒ³ï¼Œè¿˜æ˜¯è§‰ç€å®ƒæ˜¯ä¸€ä¸ªé•œåƒï¼Œåªä¸è¿‡å­˜åœ¨çš„æ–¹å¼ä¸åŒè€Œå·²ã€‚äºåœ¨ docker å’Œ registry ä¸­å­˜æ”¾çš„æ–¹å¼ä¸åŒï¼Œä½¿ç”¨ docker save å‡ºæ¥çš„é•œåƒæ˜¯ä¸€ä¸ªå­¤ç«‹çš„å­˜åœ¨ã€‚å°±åƒæ˜¯ä»è›‹ç³•åº—é‡Œæ‹¿å‡ºæ¥çš„è›‹ç³•ï¼Œå¤–é¢è‚¯å®šè¦æœ‰ä¸ªç²¾ç¾çš„åŒ…è£…æ˜¯å§ï¼Œä½ æ€»æ²¡è§è¿‡ã€‚æ”¾åœ¨å“ªé‡Œéƒ½å¯ä»¥ï¼Œä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬ä½¿ç”¨ docker load æ‹†å¼€å¤–åŒ…è£…(<code>.tar</code>)å°±å¯ã€‚æ¯”å¦‚æˆ‘ä»¬ç¦»çº¿éƒ¨ç½² harbor çš„æ—¶å€™å°±æ˜¯ä½¿ç”¨å®˜æ–¹çš„é•œåƒ tar åŒ…æ¥è¿›è¡ŒåŠ è½½é•œåƒå¯åŠ¨å®¹å™¨çš„ã€‚</p><h2 id="é•œåƒæ˜¯æ€ä¹ˆé£Ÿç”¨çš„ğŸ˜‹"><a href="#é•œåƒæ˜¯æ€ä¹ˆé£Ÿç”¨çš„ğŸ˜‹" class="headerlink" title="é•œåƒæ˜¯æ€ä¹ˆé£Ÿç”¨çš„ğŸ˜‹"></a>é•œåƒæ˜¯æ€ä¹ˆé£Ÿç”¨çš„ğŸ˜‹</h2><p>å½“æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªé•œåƒä¹‹åï¼Œå¦‚æœç”¨å®ƒæ¥å¯åŠ¨ä¸€ä¸ªå®¹å™¨å‘¢ï¼Ÿè¿™é‡Œå°±æ¶‰åŠåˆ°äº† OCI è§„èŒƒä¸­çš„å¦ä¸€ä¸ªè§„èŒƒå³è¿è¡Œæ—¶è§„èŒƒ <a href="https://github.com/opencontainers/runtime-spec" target="_blank" rel="noopener">runtime-spec</a> ã€‚å®¹å™¨è¿è¡Œæ—¶é€šè¿‡ä¸€ä¸ªå« <a href="https://github.com/opencontainers/runtime-spec/blob/master/bundle.md" target="_blank" rel="noopener"> OCI runtime filesytem bundle</a> çš„æ ‡å‡†æ ¼å¼å°† OCI é•œåƒé€šè¿‡å·¥å…·è½¬æ¢ä¸º bundle ï¼Œç„¶å OCI å®¹å™¨å¼•æ“èƒ½å¤Ÿè¯†åˆ«è¿™ä¸ª bundle æ¥è¿è¡Œå®¹å™¨ã€‚</p><blockquote><p>filesystem bundle æ˜¯ä¸ªç›®å½•ï¼Œç”¨äºç»™ runtime æä¾›å¯åŠ¨å®¹å™¨å¿…å¤‡çš„é…ç½®æ–‡ä»¶å’Œæ–‡ä»¶ç³»ç»Ÿã€‚æ ‡å‡†çš„å®¹å™¨ bundle åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>config.json: è¯¥æ–‡ä»¶åŒ…å«äº†å®¹å™¨è¿è¡Œçš„é…ç½®ä¿¡æ¯ï¼Œè¯¥æ–‡ä»¶å¿…é¡»å­˜åœ¨ bundle çš„æ ¹ç›®å½•ï¼Œä¸”åå­—å¿…é¡»ä¸º config.json</li><li>å®¹å™¨çš„æ ¹ç›®å½•ï¼Œå¯ä»¥ç”± config.json ä¸­çš„ root.path æŒ‡å®š</li></ul></blockquote><p><img src="img/20200609_oci-04.jpg" alt="img"></p><h3 id="docker-run"><a href="#docker-run" class="headerlink" title="docker run"></a>docker run</h3><p>å½“æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªå®¹å™¨ä¹‹åæˆ‘ä»¬ä½¿ç”¨ tree å‘½ä»¤æ¥åˆ†æä¸€ä¸‹ overlay2 å°±ä¼šå‘ç°ï¼Œè¾ƒä¹‹å‰çš„ç›®å½•ï¼Œå®¹å™¨å¯åŠ¨ä¹‹å overlay2 ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ª <code>merged</code> çš„æ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹å°±æ˜¯å®¹å™¨å†…çœ‹åˆ°çš„ã€‚docker é€šè¿‡ overlayfs è”åˆæŒ‚è½½çš„æŠ€æœ¯å°†é•œåƒçš„å¤šå±‚ layer æŒ‚è½½ä¸ºä¸€å±‚ï¼Œè¿™å±‚çš„å†…å®¹å°±æ˜¯å®¹å™¨é‡Œæ‰€çœ‹åˆ°çš„ï¼Œä¹Ÿå°±æ˜¯ merged æ–‡ä»¶å¤¹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/docker</span><br><span class="line">â•°â”€# tree overlay2 -d -L 3</span><br><span class="line">overlay2</span><br><span class="line">â”œâ”€â”€ 259cf6934509a674b1158f0a6c90c60c133fd11189f98945c7c3a524784509ff</span><br><span class="line">â”‚Â Â  â””â”€â”€ diff</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ bin</span><br><span class="line">|</span><br><span class="line">â”‚Â Â      â””â”€â”€ var</span><br><span class="line">â”œâ”€â”€ 27f9e9b74a88a269121b4e77330a665d6cca4719cb9a58bfc96a2b88a07af805</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”œâ”€â”€ 5f85c914c55220ec2635bce0080d2ad677f739dcfac4fd266b773625e3051844</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ var</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ merged</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ bin</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ dev</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ etc</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ home</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ media</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ mnt</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ proc</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ root</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ run</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ sbin</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ srv</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ sys</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ tmp</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ usr</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ var</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”‚Â Â      â””â”€â”€ work</span><br><span class="line">â”œâ”€â”€ 5f85c914c55220ec2635bce0080d2ad677f739dcfac4fd266b773625e3051844-init</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ dev</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ etc</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”‚Â Â      â””â”€â”€ work</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">overlay on / type overlay (rw,relatime,lowerdir=/opt/docker/overlay2/l/4EPD2X5VF62FH5PZOZHZDKAKGL:/opt/docker/overlay2/l/MYRYBGZRI4I76MJWQHN7VLZXLW:/opt/docker/overlay2/l/5RZOXYR35NSGAWTI36CVUIRW7U:/opt/docker/overlay2/l/LBWRL4ZXGBWOTN5JDCDZVNOY7H:/opt/docker/overlay2/l/526XCHXRJMZXRIHN4YWJH2QLPY:/opt/docker/overlay2/l/XK5IA4BWQ2CIS667J3SXPXGQK5,upperdir=/opt/docker/overlay2/f913d81219134e23eb0827a1c27668494dfaea2f1b5d1d0c70382366eabed629/diff,workdir=/opt/docker/overlay2/f913d81219134e23eb0827a1c27668494dfaea2f1b5d1d0c70382366eabed629/work)</span><br></pre></td></tr></table></figure><p>ä» docker å®˜æ–¹æ–‡æ¡£ <a href="https://docs.docker.com/storage/storagedriver/overlayfs-driver/" target="_blank" rel="noopener">Use the OverlayFS storage driver</a> é‡Œå·æ¥çš„ä¸€å¼ å›¾ç‰‡</p><p><img src="img/overlay_constructs.jpg" alt="overlayfs lowerdir, upperdir, merged"></p><p>å…³äºä¸Šå›¾ä¸­è¿™äº› Dir çš„ä½œç”¨ï¼Œä¸‹é¢æ˜¯ä¸€æ®µä» <a href="https://stackoverflow.com/questions/56550890/docker-image-merged-diff-work-lowerdir-components-of-graphdriver" target="_blank" rel="noopener">StackOverflow</a> ä¸Šæ¬è¿è¿‡æ¥çš„è§£é‡Šã€‚</p><blockquote><p><strong>LowerDir</strong>: these are the read-only layers of an overlay filesystem. For docker, these are the image layers assembled in order.</p><p><strong>UpperDir</strong>: this is the read-write layer of an overlay filesystem. For docker, that is the equivalent of the container specific layer that contains changes made by that container.</p><p><strong>WorkDir</strong>: this is a required directory for overlay, it needs an empty directory for internal use.</p><p><strong>MergedDir</strong>: this is the result of the overlay filesystem. Docker effectively chrootâ€™s into this directory when running the container.</p></blockquote><p>å¦‚æœæƒ³å¯¹ overlayfs æ–‡ä»¶ç³»ç»Ÿæœ‰è¯¦ç»†çš„äº†è§£ï¼Œå¯ä»¥å‚è€ƒ Linux å†…æ ¸å®˜ç½‘ä¸Šçš„è¿™ç¯‡æ–‡æ¡£ <a href="https://www.kernel.org/doc/Documentation/filesystems/overlayfs.txt" target="_blank" rel="noopener">overlayfs.txt</a> ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><h3 id="å®˜æ–¹æ–‡æ¡£"><a href="#å®˜æ–¹æ–‡æ¡£" class="headerlink" title="å®˜æ–¹æ–‡æ¡£"></a>å®˜æ–¹æ–‡æ¡£</h3><ul><li><a href="https://docs.docker.com/develop/develop-images/baseimages/" target="_blank" rel="noopener">Create a base image</a></li><li><a href="https://hub.docker.com/_/scratch" target="_blank" rel="noopener">FROM scratch</a></li><li><a href="https://docs.docker.com/registry/" target="_blank" rel="noopener">Docker Registry</a></li><li><a href="https://github.com/docker/distribution/blob/master/docs/spec/manifest-v2-2.md" target="_blank" rel="noopener">Image Manifest Version 2, Schema 2</a></li><li><a href="https://docs.docker.com/registry/spec/api/" target="_blank" rel="noopener">Docker Registry HTTP API V2</a></li><li><a href="https://github.com/containers/image" target="_blank" rel="noopener">image</a></li><li><a href="https://github.com/opencontainers/image-spec" target="_blank" rel="noopener">OCI Image Manifest Specification</a></li><li><a href="https://github.com/opencontainers/distribution-spec" target="_blank" rel="noopener">distribution-spec</a></li><li><a href="https://doi-janky.infosiftr.net/job/tianon/job/debuerreotype/" target="_blank" rel="noopener">debuerreotype/</a></li><li><a href="https://www.kernel.org/doc/Documentation/filesystems/overlayfs.txt" target="_blank" rel="noopener">overlayfs.txt</a></li></ul><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><ul><li><a href="https://github.com/docker-library/oi-janky-groovy" target="_blank" rel="noopener">oi-janky-groovy</a></li><li><a href="https://github.com/debuerreotype/docker-debian-artifacts" target="_blank" rel="noopener">docker-debian-artifacts</a></li><li><a href="https://github.com/NotGlop/docker-drag" target="_blank" rel="noopener">docker-drag</a></li><li><a href="https://github.com/deislabs/oras" target="_blank" rel="noopener">oras</a></li><li><a href="https://github.com/containers/skopeo" target="_blank" rel="noopener">skopeo</a></li><li><a href="https://github.com/vbatts/tar-split" target="_blank" rel="noopener">tar-split</a></li></ul><h3 id="åšå®¢"><a href="#åšå®¢" class="headerlink" title="åšå®¢"></a>åšå®¢</h3><ul><li><a href="https://supereagle.github.io/2018/04/24/docker-registry/" target="_blank" rel="noopener">é•œåƒä»“åº“ä¸­é•œåƒå­˜å‚¨çš„åŸç†è§£æ</a></li><li><a href="https://fuckcloudnative.io/posts/how-manage-image/" target="_blank" rel="noopener">docker åœ¨æœ¬åœ°å¦‚ä½•ç®¡ç† imageï¼ˆé•œåƒï¼‰?</a></li><li><a href="http://gaocegege.com/Blog/ormb" target="_blank" rel="noopener">ormbï¼šåƒç®¡ç† Docker å®¹å™¨é•œåƒä¸€æ ·ç®¡ç†æœºå™¨å­¦ä¹ æ¨¡å‹</a></li><li><a href="https://blog.fleeto.us/post/how-are-docker-images-built/" target="_blank" rel="noopener">é•œåƒæ˜¯æ€æ ·ç‚¼æˆçš„</a></li><li><a href="https://duyanghao.github.io/docker-registry-pull-manifest-v2/" target="_blank" rel="noopener">docker pullåˆ†æ</a></li><li><a href="https://github.com/helios741/myblog/blob/new/learn_go/src/2019/20191206_docker_disk_storage/README.md" target="_blank" rel="noopener">æµ…è°ˆdockerä¸­é•œåƒå’Œå®¹å™¨åœ¨æœ¬åœ°çš„å­˜å‚¨</a></li><li><a href="https://www.qedev.com/cloud/103860.html" target="_blank" rel="noopener">å®¹å™¨OCIè§„èŒƒ é•œåƒè§„èŒƒ</a></li><li><a href="https://xuanwo.io/2019/08/06/oci-intro/" target="_blank" rel="noopener">å¼€æ”¾å®¹å™¨æ ‡å‡†(OCI) å†…éƒ¨åˆ†äº«</a></li><li><a href="https://wilhelmguo.cn/blog/post/william/%E5%AE%B9%E5%99%A8%E5%BC%80%E6%94%BE%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83%EF%BC%88CRI-OCI%EF%BC%89-2" target="_blank" rel="noopener">å®¹å™¨å¼€æ”¾æ¥å£è§„èŒƒï¼ˆCRI OCIï¼‰</a></li><li><a href="https://segmentfault.com/a/1190000014284289" target="_blank" rel="noopener">Dockeré•œåƒçš„å­˜å‚¨æœºåˆ¶</a></li><li><a href="http://open.daocloud.io/docker-source-code-analysis-part10/" target="_blank" rel="noopener">Dockeræºç åˆ†æï¼ˆåï¼‰ï¼šDockeré•œåƒä¸‹è½½</a></li><li><a href="http://open.daocloud.io/docker-source-code-analysis-part9/" target="_blank" rel="noopener">Dockeræºç åˆ†æï¼ˆä¹ï¼‰ï¼šDockeré•œåƒ</a></li><li><a href="https://www.twblogs.net/a/5b8aab392b71775d1ce86eca" target="_blank" rel="noopener">docker push éç¨‹ distributionæºç¢¼ åˆ†æ</a></li><li><a href="http://open.daocloud.io/tag/allen-tan-docker/" target="_blank" rel="noopener">Allen è°ˆ Docker</a></li><li><a href="http://open.daocloud.io/shen-ru-li-jie-dockerjing-xiang-jsonwen-jian-2/" target="_blank" rel="noopener">æ·±å…¥ç†è§£ Docker é•œåƒ json æ–‡ä»¶</a></li><li><a href="http://open.daocloud.io/docker-jing-xiang-nei-you-sha-cun-na-ntitled/" target="_blank" rel="noopener">Docker é•œåƒå†…æœ‰å•¥ï¼Œå­˜å“ªï¼Ÿ</a></li><li><a href="http://open.daocloud.io/allen-tan-docker-xi-lie-zhi-shen-ke-li-jie-docker-jing-xiang-da-xiao/" target="_blank" rel="noopener">ç†è§£ Docker é•œåƒå¤§å°</a></li><li><a href="http://open.daocloud.io/allen-tan-docker-xi-lie-zhi-tu-kan-jin-docker-rong-qi-wen-jian-xi-tong/" target="_blank" rel="noopener">çœ‹å°½ docker å®¹å™¨æ–‡ä»¶ç³»ç»Ÿ</a></li><li><a href="https://qhh.me/2019/02/17/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-Docker-%E6%9E%84%E5%BB%BA%E4%B8%8A%E4%B8%8B%E6%96%87/" target="_blank" rel="noopener">æ·±å…¥ç†è§£ Docker æ„å»ºä¸Šä¸‹æ–‡</a></li><li><a href="https://cizixs.com/2017/11/05/oci-and-runc/" target="_blank" rel="noopener">OCI å’Œ runcï¼šå®¹å™¨æ ‡å‡†åŒ–å’Œ docker</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;ä¸Šå‘¨åœ¨å†™&lt;a
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="docker" scheme="https://blog.k8s.li/tags/docker/"/>
    
      <category term="registry" scheme="https://blog.k8s.li/tags/registry/"/>
    
      <category term="image" scheme="https://blog.k8s.li/tags/image/"/>
    
  </entry>
  
  <entry>
    <title>mount å‘½ä»¤ä¹‹ --bind æŒ‚è½½å‚æ•°</title>
    <link href="https://blog.k8s.li/mount-bind.html"/>
    <id>https://blog.k8s.li/mount-bind.html</id>
    <published>2020-06-01T16:00:00.000Z</published>
    <updated>2021-02-24T13:40:34.691Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¿»è½¦ï¼ˆï¼š"><a href="#ç¿»è½¦ï¼ˆï¼š" class="headerlink" title="ç¿»è½¦ï¼ˆï¼š"></a>ç¿»è½¦ï¼ˆï¼š</h2><p>ç”±äºæˆ‘çš„ VPS ä¸æ˜¯å¤§ç›˜é¸¡(å°±æ˜¯å¤§å®¹é‡ç£ç›˜æœºå™¨å•¦ğŸ˜‚)ï¼Œ docker å­˜å‚¨ç›®å½• <code>/var/lib/docker</code> æ‰€åœ¨çš„åˆ†åŒºä¸¥é‡ä¸è¶³ï¼Œäºæ˜¯å°±æƒ³ç€åœ¨ä¸æ”¹å˜ docker é…ç½®çš„ä¸‹å°† <code>/opt</code> ç›®å½•ä¸‹çš„åˆ†åŒºåˆ†é…ç»™ <code>/var/lib/docker</code> ç›®å½•ã€‚é¦–å…ˆæƒ³åˆ°çš„æ˜¯æŠŠ <code>/var/lib/docker</code> å¤åˆ¶åˆ° <code>/opt/docker</code>ï¼Œç„¶åå†å°† <code>/opt/docker</code> è½¯é“¾æ¥åˆ° <code>/var/lib/docker</code> ã€‚</p><p>äºæ˜¯æˆ‘å°±ä¸€é¡¿æ“ä½œçŒ›å¦‚è™ï¼Œ<code>mv /var/lib/docker /opt/docker &amp;&amp; ln -s /opt/docker /var/lib/docker</code> ä¸€æŠŠæ¢­ï¼Œç„¶åæˆ‘å¯åŠ¨ä¸€ä¸ªå®¹å™¨çš„æ—¶å€™å½“åœºå°±ç¿»è½¦äº†ğŸ¤£ã€‚</p><p>åŸæ¥æœ‰äº›ç¨‹åºæ˜¯ä¸æ”¯æŒè½¯é“¾æ¥ç›®å½•çš„ï¼Œè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯è½¯é“¾æ¥çš„è·¯å¾„ä¹Ÿæœ‰ç‚¹å‘ã€‚æ¯”å¦‚æˆ‘å°† <code>/opt/docker -&gt; /var/lib/docker/</code> ï¼Œåœ¨ <code>/var/lib/docker</code> ç›®å½•ä¸‹æ‰§è¡Œ <code>ls ../</code> å³å®ƒçš„ä¸Šä¸€çº§ç›®å½•æ˜¯ <code>/opt</code> è€Œä¸æ˜¯ <code>/var/lib</code> ï¼Œå¯¹äºä¸€äº›ä¾èµ–ç›¸å¯¹è·¯å¾„çš„åº”ç”¨ï¼ˆå°¤å…¶æ˜¯ shell è„šæœ¬ï¼‰æ¥è®²è¿™æ ·ä½¿ç”¨è½¯é“¾æ¥çš„æ–¹å¼ä¹Ÿå®¹æ˜“ç¿»è½¦ğŸ˜‚ã€‚</p><p>é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ›´å¥½çš„åŠæ³•å°†ä¸¤ä¸ªç›®å½•è¿›è¡Œâ€œç¡¬é“¾æ¥â€å‘¢ï¼Œæ³¨æ„æˆ‘åœ¨æ­¤ç”¨çš„æ˜¯åŒå¼•å·ï¼Œå¹¶éæ˜¯çœŸæ­£çš„â€ç¡¬é“¾æ¥â€œï¼Œæœäº†ä¸€åœˆå‘ç° mount â€“bind è¿™ç§éªšæ“ä½œã€‚æ— è®ºæˆ‘ä»¬å¯¹æ–‡ä»¶ä½¿ç”¨è½¯é“¾æ¥/ç¡¬é“¾æ¥/bindï¼Œè¿˜æ˜¯å¯¹ç›®å½•ä½¿ç”¨è½¯é“¾æ¥ï¼Œå…¶å®éƒ½æ˜¯å¸Œæœ›æ“ä½œçš„ <code>src</code> å’Œ <code>dest</code> ä»–ä»¬äºŒè€…éƒ½èƒ½ä¿æŒä¸€è‡´ã€‚é€šè¿‡ bind æŒ‚è½½çš„æ–¹å¼å…·æœ‰ç€æŒ‚è½½ç‚¹çš„ä¸€äº›ç‰¹æ€§ï¼Œè¿™æ˜¯é“¾æ¥æ˜¯ä¸å…·æœ‰çš„ï¼Œå¯¹ä¸€äº›ä¸æ”¯æŒé“¾æ¥çš„åº”ç”¨æ¥è®²ï¼Œbind çš„æ–¹å¼è¦å‹å¥½ä¸€äº›ã€‚</p><h2 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h2><p>å…¶å® bind è¿™ä¸ªæŒ‚è½½é€‰é¡¹æˆ‘ä»¬åœ¨ä½¿ç”¨ docker æˆ–è€… kubernetes å¤šå°‘éƒ½ä¼šç”¨åˆ°çš„ï¼Œå°¤å…¶æ˜¯å½“ä½¿ç”¨ kubernetes  æ—¶ kubelet åœ¨å¯åŠ¨å®¹å™¨æŒ‚è½½å­˜å‚¨çš„æ—¶å€™åº•å±‚æ˜¯å°† node èŠ‚ç‚¹æœ¬æœºçš„ <code>/var/lib/kubelet/pods/&lt;Podçš„ID&gt;/volumes/kubernetes.io~&lt;Volumeç±»å‹&gt;/&lt;Volumeåå­—&gt;</code> ç›®å½•é€šè¿‡ bind çš„æ–¹å¼æŒ‚è½½åˆ°å®¹å™¨ä¸­çš„ï¼Œè¯¦ç»†çš„åˆ†æå¯ä»¥å‚è€ƒä¹‹å‰æˆ‘å†™çš„ä¸€ç¯‡åšå®¢ <a href="https://blog.k8s.li/kubelet-mount-volumes-analysis.html">kubelet æŒ‚è½½ volume åŸç†åˆ†æ</a> ã€‚</p><blockquote><ul><li><strong>Volumes</strong> are stored in a part of the host filesystem which is <em>managed by Docker</em> (<code>/var/lib/docker/volumes/</code> on Linux). Non-Docker processes should not modify this part of the filesystem. Volumes are the best way to persist data in Docker.</li><li><strong>Bind mounts</strong> may be stored <em>anywhere</em> on the host system. They may even be important system files or directories. Non-Docker processes on the Docker host or a Docker container can modify them at any time.</li><li><strong><code>tmpfs</code> mounts</strong> are stored in the host systemâ€™s memory only, and are never written to the host systemâ€™s filesystem.</li></ul></blockquote><p>ä¸è¿‡é‚£æ—¶å€™å¹¶æ²¡æœ‰è¯¦ç»†åœ°å»äº†è§£ bind çš„åŸç†ï¼Œç›´åˆ°æœ€è¿‘ç¿»äº†ä¸€æ¬¡è½¦æ‰æƒ³èµ·æ¥ bind ï¼Œäºæ˜¯æ¥ä¸‹æ¥å°±è¯¦ç»†åœ°åˆ†æä»¥ä¸‹ mount â€“bind æŒ‚è½½å‚æ•°ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨è½¯é“¾æ¥é“¾æ¥ç›®å½•</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls -i æ˜¾ç¤ºæ–‡ä»¶/ç›®å½•çš„ inode å·</span></span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ln -s /opt/docker /var/lib/docker</span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ls -i /opt | grep docker</span><br><span class="line">2304916 docker</span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ls -i /var/lib | grep docker</span><br><span class="line">    211 docker</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨ç¡¬é“¾æ¥é“¾æ¥ä¸¤ä¸ªæ–‡ä»¶</span></span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ln /usr/local/bin/docker-compose /usr/bin/docker-compose</span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ls -i /usr/bin/docker-compose</span><br><span class="line">112 /usr/bin/docker-compose</span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ls -i /usr/bin/docker-compose</span><br><span class="line">112 /usr/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨ --<span class="built_in">bind</span> æŒ‚è½½ç›®å½•</span></span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# mount --bind /opt/docker /var/lib/docker</span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ls -i /var/lib | grep docker</span><br><span class="line">2304916 docker</span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ls -i /opt | grep docker</span><br><span class="line">2304916 docker</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“ä½¿ç”¨ä½¿ç”¨ç¡¬é“¾æ¥æˆ– bind æŒ‚è½½ç›®å½•æ—¶ï¼Œä¸¤ä¸ªæ–‡ä»¶ inode å·æ˜¯ç›¸åŒçš„ï¼Œä½¿ç”¨è½¯é“¾æ¥çš„ä¸¤ä¸ªæ–‡ä»¶çš„ inode å·æ˜¯ä¸åŒçš„ã€‚ä½†ç›®å½•åˆä¸èƒ½ä½¿ç”¨ç¡¬é“¾æ¥ï¼Œè€Œä¸”ç¡¬é“¾æ¥ä¸æ”¯æŒè·¨åˆ†åŒºã€‚æˆ‘ä»¬æ˜¯å¦å¯ä»¥å°† bind çš„æ•ˆæœå’Œ<br>â€œç¡¬é“¾æ¥ç›®å½•â€œ æ ·æ¥ä½¿ç”¨å‘¢ï¼Ÿå…¶å®å¯ä»¥è¿™æ ·ç”¨ï¼Œä½†è¿™æ ·ç±»æ¯”å¹¶ä¸ä¸¥è°¨ã€‚</p><p>å½“æˆ‘ä»¬ä½¿ç”¨ bind çš„æ—¶å€™ï¼Œæ˜¯å°†ä¸€ä¸ªç›®å½• A  æŒ‚è½½åˆ°å¦ä¸€ä¸ªç›®å½• B ï¼Œç›®å½• B åŸæœ‰çš„å†…å®¹å°±è¢«å±â€è”½æ‰â€œäº†ï¼Œç›®å½• B é‡Œé¢çš„å†…å®¹å°±æ˜¯ç›®å½• A é‡Œé¢çš„å†…å®¹ã€‚è¿™å’Œæˆ‘ä»¬æŒ‚åœ¨å…¶ä»–åˆ†åŒºåˆ°æŒ‚è½½ç‚¹ç›®å½•ä¸€æ ·ï¼Œç›®å½• B çš„å†…å®¹è¿˜æ˜¯å­˜åœ¨çš„ï¼Œåªä¸è¿‡æ˜¯è¢«â€å±è”½â€œæ‰äº†ï¼Œå½“æˆ‘ä»¬ umount B åï¼ŒåŸå†…å®¹å°±ä¼šå¤ç°ã€‚</p><p>å½“æˆ‘ä»¬ä½¿ç”¨ <code>docker run -v PATH:PATH</code> å¯åŠ¨ä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ï¼Œå®è´¨ä¸Šä¹Ÿæ˜¯ä¼šç”¨åˆ° <code>bind</code>ï¼Œdocker ä¼šå°†ä¸»æœºçš„ç›®å½•é€šè¿‡ <code>bind</code> çš„æ–¹å¼æŒ‚è½½åˆ°å®¹å™¨ç›®å½•ã€‚ä¸‹é¢æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ª alpine å®¹å™¨æ¥å®éªŒä¸€ä¸‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run --name alpine -v /opt/bind/:/var --privileged --rm -it alpine sh</span><br><span class="line">docker inspect alpine</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">"Mounts": [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"Type"</span>: <span class="string">"bind"</span>,</span><br><span class="line">        <span class="attr">"Source"</span>: <span class="string">"/opt/bind"</span>,</span><br><span class="line">        <span class="attr">"Destination"</span>: <span class="string">"/var"</span>,</span><br><span class="line">        <span class="attr">"Mode"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="attr">"RW"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"Propagation"</span>: <span class="string">"rprivate"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>åœ¨å®¹å™¨å†…ä½¿ç”¨ umount å‘½ä»¤å¸è½½æ‰ <code>/var</code> ï¼Œumount æ“ä½œéœ€è¦ root æƒé™ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™åŠ ä¸Š <code>--privileged</code> å‚æ•°æ¥å¯åŠ¨ä¸€ä¸ªç‰¹æƒå®¹å™¨çš„åŸå› ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/ # ls /var/</span><br><span class="line">74898710_p21.jpg    MJSTEALEY.md        docker-compose.yml  letsencrypt         resolv.conf</span><br><span class="line">CONSOLE.md          README.md           hostname            logs                stop-and-remove.sh</span><br><span class="line">LICENSE             config              hosts               nginx               webp-server</span><br><span class="line">/ # umount /var/</span><br><span class="line"><span class="meta">#</span><span class="bash"> umount ä¹‹åå®¹å™¨å†…åŸæ¥çš„ /var ç›®å½•å†…å®¹<span class="string">"æ¢å¤"</span>äº†</span></span><br><span class="line">/ # ls /var/</span><br><span class="line">cache  empty  lib    local  lock   log    mail   opt    run    spool  tmp</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–ç”¨å¤„ğŸ¤”"><a href="#å…¶ä»–ç”¨å¤„ğŸ¤”" class="headerlink" title="å…¶ä»–ç”¨å¤„ğŸ¤”"></a>å…¶ä»–ç”¨å¤„ğŸ¤”</h2><h3 id="æ— ç¼æ›´æ–°-Webp-Server-Go"><a href="#æ— ç¼æ›´æ–°-Webp-Server-Go" class="headerlink" title="æ— ç¼æ›´æ–° Webp Server Go"></a>æ— ç¼æ›´æ–° Webp Server Go</h3><p>åœ¨ <a href="">å°åœŸè±†</a>ã€<a href="">Nona</a> å¤§ä½¬è®¨è®º <a href="">Webp Server Go</a> æ— ç¼æ›´æ–°çš„æ—¶å€™æˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªæ€è·¯ï¼š</p><blockquote><ul><li><p>åœ¨æ›´æ–°ä¹‹å‰å…ˆå¯¹ nginx é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œå»æ‰ webp server çš„ location å­—æ®µï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~* \.(png|jpg|jpeg)$</span> &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://127.0.0.1:3333;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> HOST <span class="variable">$http_host</span>;</span><br><span class="line">    <span class="attribute">add_header</span> Cache-Control <span class="string">'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç„¶åå† nginx -s reload ä¸ä¸­æ–­ reload ä¸€</p></li><li><p>æ¥ç€åœæ‰ webp server æœåŠ¡ <code>systemctl stop webps</code></p></li><li><p>mv webp-server{.bak,}</p></li><li><p>mv ./upload/webp-server-linux-amd64 webp-server</p></li><li><p>æ¥ç€å¯åŠ¨ webp server æœåŠ¡ <code>systemctl start webps</code></p></li><li><p>ç„¶åå¼€å€’è½¦æŠŠ nginx é…ç½®æ–‡ä»¶å†æ”¹å›å»ğŸ</p></li></ul></blockquote><p>åœ¨æ­¤éœ€è¦æå‡ ç‚¹ï¼Œæˆ‘ä»¬å¸Œæœ›<strong>æ— ç¼æ›´æ–°</strong>ï¼Œå³åœ¨æ›´æ–°çš„è¿‡ç¨‹ä¸­ä¸ä¼šå¯¼è‡´ç”¨æˆ·è¯·æ±‚å›¾ç‰‡èµ„æºå¤±è´¥ï¼Œé‚£æ€• <code>+1s</code>éƒ½ä¸è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æš‚æ—¶æ€§åœ°åœ¨ nginx é…ç½®æ–‡ä»¶é‡Œå»æ‰ webp server ï¼Œä½¿å®ƒå»è¯·æ±‚åŸå›¾ç‰‡ï¼Œç­‰æ›´æ–°å®Œ webp server ä¹‹åå†æ·»åŠ ä¸Šå»ã€‚</p><p>å¯¹äºæœ¨å­è¿™ç§ç»å¸¸åˆ åº“è·‘è·¯çš„æ‰‹æ®‹èœé¸Ÿæ¥è®²ï¼Œå¯¹ä¸€ä¸ªé…ç½®æ–‡ä»¶æ”¹æ¥æ”¹å»ä¸æ˜¯å¥½æ–¹æ³•ï¼Œä¸‡ä¸€ nginx é…ç½®æ–‡ä»¶æ”¹æ¥æ”¹å»æ²¡æ”¹å¥½ï¼Œ nginx -s reload ä¸€ä¸‹ nginx æœåŠ¡å°±ç‚¸äº†ğŸ˜‚ã€‚é‚£ä¹ˆä½¿ç”¨ cp å’Œ mv æ€ä¹ˆæ ·ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cp blog.conf&#123;,.bak&#125;</span><br><span class="line">vim blog.conf</span><br><span class="line">nginx -s reload</span><br><span class="line">- update webp server</span><br><span class="line">mv blog.conf&#123;,.bak2&#125;</span><br><span class="line">mv blog.conf&#123;.bak,&#125;</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ bind å‘¢ï¼Ÿå¥½åƒå°‘äº†ä¸€æ­¥ï¼Œä¸‹æ¬¡æ›´æ–° webp server çš„æ—¶å€™åªéœ€è¦ umount ä¸€ä¸‹ï¼Œæ›´æ–°å®Œä¹‹åå† mount ä¸€ä¸‹å°±å¯ä»¥å•¦ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cp blog.conf&#123;,.bak&#125;</span><br><span class="line">vim blog.conf</span><br><span class="line">nginx -s reload</span><br><span class="line">- update webp server</span><br><span class="line">mount --bind blog.conf.bak blohg.conf</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><h3 id="VPS-æ¬å®¶åŠ©æ‰‹"><a href="#VPS-æ¬å®¶åŠ©æ‰‹" class="headerlink" title="VPS æ¬å®¶åŠ©æ‰‹"></a>VPS æ¬å®¶åŠ©æ‰‹</h3><p>å…¶å®è¿˜æœ‰å¾ˆå¤šç”¨é€”å•¦ï¼Œè¿™é‡Œå°±ä¸ç½—åˆ—äº†</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;ç¿»è½¦ï¼ˆï¼š&quot;&gt;&lt;a href=&quot;#ç¿»è½¦ï¼ˆï¼š&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="docker" scheme="https://blog.k8s.li/tags/docker/"/>
    
      <category term="linux" scheme="https://blog.k8s.li/tags/linux/"/>
    
      <category term="overlay2" scheme="https://blog.k8s.li/tags/overlay2/"/>
    
  </entry>
  
</feed>
