<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æœ¨å­</title>
  <icon>https://blog.k8s.li/icon.png</icon>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://blog.k8s.li/"/>
  <updated>2020-09-24T16:00:00.000Z</updated>
  <id>https://blog.k8s.li/</id>
  
  <author>
    <name>æœ¨å­</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>è½»é‡çº§å®¹å™¨ä¼˜åŒ–å‹ Linux å‘è¡Œç‰ˆ Photon OS</title>
    <link href="https://blog.k8s.li/Photon-OS.html"/>
    <id>https://blog.k8s.li/Photon-OS.html</id>
    <published>2020-09-24T16:00:00.000Z</published>
    <updated>2020-09-24T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‰æ®µæ—¶é—´æ¡åƒåœ¾ä¸œæ‹¼è¥¿å‡‘æäº†å° Homelab ğŸ‘‡ç©ç© ğŸ‘‰<a href="https://blog.k8s.li/homelab.html">ã€Šåƒåœ¾ä½¬çš„ Homelab æŠ˜è…¾è®°å½•ã€‹</a> ã€‚</p><p><img src="img/20200913_esxi_01.png" alt=""></p><p>æ€»ä½“æ¥è®²æ€§ä»·æ¯”é«˜ï¼ŒIntel i5-6600T çš„æ€§èƒ½å’Œ i5-6600 æŒå¹³ï¼Œæ¯”é‚£ç§ 8250U ä¹‹ç±»çš„ä½å‹ U è¦é«˜å¾ˆå¤šï¼Œè·‘ä¸€å †è™šæ‹Ÿæœºä¹Ÿä¸æˆé—®é¢˜ï¼Œç”šè‡³è·‘ä¸ªä¸‰ master + ä¸¤ node çš„ kubernetes é›†ç¾¤ä¹Ÿæ˜¯å¯ä»¥ğŸ˜‚ã€‚è‡³äºåŠŸè€—ï¼Œæ•´æœºå¾…æœºæ—¶ä¸åˆ° 30W ï¼Œä¸€å¤©ä¸åˆ° 1 åº¦ç”µï¼Œä¸ç”¨æ‹…å¿ƒç”µè´¹çˆ†è¡¨äº†ï¼›è‡³äºä»·æ ¼ï¼Œä¸€é¢— Intel i5-6600T  ä¸åˆ° 450 å—é’±ï¼Œè¿˜ä¸é¦™å˜›ğŸ™ƒã€‚</p><p>åœ¨ ESXi è¿è¡Œç€ä¸€äº›è™šæ‹Ÿæœºï¼Œæ¯”å¦‚ç”¨ WireGuard æ‰“é€š VPS ä¹‹é—´çš„ç½‘ç»œï¼Œè¿è¡Œåœ¨ä¸€ä¸ª alpine è™šæ‹Ÿæœºé‡Œä½œä¸ºç½‘å…³æœºä½¿ç”¨ï¼›æ¯”å¦‚ä½¿ç”¨ <a href="https://pi-hole.net/" target="_blank" rel="noopener">Pi-holeÂ®</a> æ¥æ„å»ºè‡ªå·±çš„ DNS æœåŠ¡å™¨ï¼Œç”¨æ¥æ‹¦æˆªå±è”½åŸŸåï¼›æ¯”å¦‚è¿è¡Œ time-machine æœåŠ¡ç”¨æ¥å®šæ—¶å¤‡ä»½ MacBook ï¼›æ¯”å¦‚ Windows è™šæ‹Ÿæœºé‡Œè¿è¡Œç€ä¸€äº›å›½äº§æ¯’ç˜¤è½¯ä»¶ğŸ˜¡ï¼›æ¯”å¦‚ä½¿ç”¨ <a href="https://docs.drone.io/" target="_blank" rel="noopener">Drone</a> è·‘ä¸€å¥—è½»é‡çº§çš„ CI æµæ°´çº¿ç³»ç»Ÿï¼Œæ€»ä¹‹å¯ç©æ€§éå¸¸é«˜å“¦ï¼Œåªè¦ä½ åˆæ—¶é—´çæŠ˜è…¾ï¼Œæ€»èƒ½æ‰¾ç‚¹ä¹å­ç©ğŸ˜‚ã€‚</p><h2 id="Linux-Container-OS"><a href="#Linux-Container-OS" class="headerlink" title="Linux Container OS ?"></a>Linux Container OS ?</h2><p>æœ‰äº†ä¸€å°è¿è¡Œç€ ESXi çš„ Homelab ï¼Œä»Šå¤©å°±ç©ä¸€ä¸‹ Linux container OS ï¼Œå³ Linux å®¹å™¨  OS ã€å®¹å™¨ä¼˜åŒ–å‹ OSï¼Œè¿™æ˜¯ä¸€ç±»ä¸“é—¨é’ˆå¯¹è¿è¡Œå®¹å™¨å®šåˆ¶åŒ–å¼€å‘çš„ Linux å‘è¡Œç‰ˆï¼Œè£å‰ªæ‰ä¸€äº›ä¸å¿…è¦çš„è½¯ä»¶å’Œå†…æ ¸æ¨¡å—ï¼Œä½¿ç³»ç»Ÿæ›´åŠ è½»é‡ä¸€äº›ã€‚è™½ç„¶æ¥è¯´æ°‘ç”¨çº§çš„ Intel i5-6600T æ€§èƒ½ä¹Ÿä¸ç®—å¤ªå·®ï¼Œä½†å’Œ E3  å°ç‹å­ï¼ŒE5 è€å¤§å“¥æ¯”è¿˜æ˜¯å·®ä¸ªåä¸‡å…«åƒé‡Œã€‚å› æ­¤ä¸ºäº†èŠ‚çœä¸€äº› CPU èµ„æºï¼Œå‡å°‘è™šæ‹ŸåŒ–å¸¦æ¥çš„å¼€é”€ï¼Œå°±é€‰æ‹©äº†å®¹å™¨åŒ–è¿è¡Œä¸€äº›åº”ç”¨ï¼ŒåŒæ—¶å†ä¸ºè¿™äº›å®¹å™¨æ‰¾ä¸€ä¸ªè½»é‡çº§çš„å®¿ä¸»æœº OS ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæƒ³è¦ä½¿ç”¨ Linux container OS çš„åŸå› ã€‚</p><h3 id="GKE-çš„-Container-Optimized-OS"><a href="#GKE-çš„-Container-Optimized-OS" class="headerlink" title="GKE çš„ Container-Optimized OS"></a>GKE çš„ <a href="https://cloud.google.com/container-optimized-os/docs/" target="_blank" rel="noopener">Container-Optimized OS</a></h3><p>Kubernetes çš„äº²çˆ¸çˆ¸ Google å®¶çš„ <a href="https://cloud.google.com/kubernetes-engine" target="_blank" rel="noopener">Google Kubernetes Engine</a> å³ GKE é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä½¿ç”¨ <a href="https://cloud.google.com/container-optimized-os/docs/" target="_blank" rel="noopener">Container-Optimized OS</a> æ¥è¿è¡Œå·¥ä½œè´Ÿè½½ï¼Œä¸è¿‡ä»…ä»…æ˜¯é’ˆå¯¹ GCE æ¥è¿›è¡Œä¼˜åŒ–çš„ï¼Œå¯èƒ½åœ¨ OpenStack æˆ–è€… vSphere ä¸Šè¿è¡Œä¸èµ·æ¥ï¼Œ(ççŒœğŸ˜‚ã€‚</p><blockquote><p>  Container-Optimized OS æ˜¯é€‚ç”¨äº <a href="https://cloud.google.com/compute" target="_blank" rel="noopener">Compute Engine</a> è™šæ‹Ÿæœºçš„æ“ä½œç³»ç»Ÿæ˜ åƒï¼Œä¸“ä¸ºè¿è¡Œ Docker å®¹å™¨è€Œä¼˜åŒ–ã€‚å€ŸåŠ© Container-Optimized OSï¼Œæ‚¨å¯ä»¥å¿«é€Ÿã€é«˜æ•ˆã€å®‰å…¨åœ°åœ¨ Google Cloud Platform ä¸Šå¯åŠ¨ Docker å®¹å™¨ã€‚Container-Optimized OS ç”± Google ç»´æŠ¤ï¼ŒåŸºäº <a href="https://www.chromium.org/chromium-os" target="_blank" rel="noopener">Chromium OS</a> å¼€æ”¾æºä»£ç é¡¹ç›®ã€‚</p></blockquote><p>ç‰¹ç‚¹å°±æ˜¯ä¸åŒäºå…¶ä»–çš„ Linux å‘è¡Œç‰ˆï¼Œè¿™ä¸ªæ˜¯åŸºäº <a href="https://www.chromium.org/chromium-os" target="_blank" rel="noopener">Chromium OS</a> å®šåˆ¶åŒ–å¼€å‘çš„ï¼Œå¯¹å†…æ ¸ç‰ˆæœ¬é€‰ç”¨çš„ä¹Ÿæ¯”è¾ƒæ¿€è¿›ï¼Œä¸€èˆ¬æ˜¯ <code>4.19.112+</code> æˆ–è€… <code>5.x</code> ç‰ˆæœ¬ï¼Œè¿™æ ·ä½ å°±ä¸ç”¨å†æ‹…å¿ƒåƒ CentOS 7.x ç³»åˆ—é‚£æ ·å„ç§å†…æ ¸ bug äº†ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">items:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Node</span></span><br><span class="line">  <span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">nodeInfo:</span></span><br><span class="line">      <span class="attr">architecture:</span> <span class="string">amd64</span></span><br><span class="line">      <span class="attr">bootID:</span> <span class="string">0c517083-aaf6-75fc4b2204ba</span></span><br><span class="line">      <span class="attr">containerRuntimeVersion:</span> <span class="string">docker://19.3.1</span></span><br><span class="line">      <span class="attr">kernelVersion:</span> <span class="number">4.19</span><span class="number">.112</span><span class="string">+</span></span><br><span class="line">      <span class="attr">kubeProxyVersion:</span> <span class="string">v1.16.13-gke.1</span></span><br><span class="line">      <span class="attr">kubeletVersion:</span> <span class="string">v1.16.13-gke.1</span></span><br><span class="line">      <span class="attr">machineID:</span> <span class="string">33a96ff3203d88c0a542</span></span><br><span class="line">      <span class="attr">operatingSystem:</span> <span class="string">linux</span></span><br><span class="line">      <span class="attr">osImage:</span> <span class="string">Container-Optimized</span> <span class="string">OS</span> <span class="string">from</span> <span class="string">Google</span></span><br><span class="line">      <span class="attr">systemUUID:</span> <span class="string">33a96ff33d88c0a542</span></span><br></pre></td></tr></table></figure><p>Chromium OS å°±æ˜¯ Google åŸºäº Linux å†…æ ¸å¼€å‘çš„æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥ Google ä¹Ÿæœ‰è¿™ä¸ªå®åŠ›é’ˆå¯¹è‡ªå®¶çš„ GCP äº‘å¹³å°è¿›è¡Œå®šåˆ¶åŒ–å¼€å‘ä¸ª OS å‡ºæ¥ï¼Œä¸“é—¨ç»™ kubernetes é›†ç¾¤è¿è¡Œä½¿ç”¨ï¼Œå®šåˆ¶åŒ–å¼€å‘çš„å¥½å¤„å°±æ˜¯å¯ä»¥å¸¦æ¥æ›´å¤šçš„æ–°ç‰¹æ€§ï¼ŒäºŒä¸å—åˆ¶äºä¸Šæ¸¸çš„ Linux å‘è¡Œç‰ˆçš„é™åˆ¶ã€‚æ¯”å¦‚ä¸ä¹…å‰ Google å®£å¸ƒå°†ä½¿ç”¨ <a href="https://cilium.io/" target="_blank" rel="noopener">Cilium</a> ä½œä¸º GKE çš„ä¸‹ä¸€ä»£æ•°æ®é¢ï¼Œ<a href="https://cloud.google.com/blog/products/containers-kubernetes/bringing-ebpf-and-cilium-to-google-kubernetes-engine" target="_blank" rel="noopener">New GKE Dataplane V2 increases security and visibility for containers</a> ï¼Œè€Œ Cilium è¿™é¡¹æŠ€æœ¯æ˜¯ä¾èµ–äºå¯¹ eBPF æŠ€æœ¯ï¼Œè€Œ eBPF åˆä¾èµ–äºå†…æ ¸ç‰¹æ€§çš„æ”¯æŒã€‚</p><h3 id="AWS-çš„-Bottlerocket-OS"><a href="#AWS-çš„-Bottlerocket-OS" class="headerlink" title="AWS çš„ Bottlerocket OS"></a>AWS çš„ <a href="https://github.com/bottlerocket-os/bottlerocket" target="_blank" rel="noopener">Bottlerocket OS</a></h3><p>è¿™ä¸ªæ˜¯ AWS æœ€è¿‘å¼€æºä¸“é—¨é’ˆå¯¹  EC2 è¿›è¡Œä¼˜åŒ–çš„ Linux Container OSï¼Œå’Œ GKE ä¸€æ ·ï¼Œåªæ˜¯é’ˆå¯¹äºè‡ªå®¶çš„ AWS å…¬æœ‰äº‘ï¼Œç”±äºæ˜¯æœ€è¿‘åˆšåˆšæ¨å‡ºçš„ï¼Œè¿˜æ²¡æ¥å¾—åŠå…³æ³¨ï¼Œæ‰€ä»¥å°±ä¸ä»‹ç»äº†ã€‚åŒ GKE çš„ Container-Optimized OS ä¸€æ ·ï¼Œä¸€èˆ¬å…¬æœ‰äº‘å®šåˆ¶åŒ–å¼€å‘çš„ Container OS ä»…ä»…åªé’ˆå¯¹è‡ªå®¶çš„äº‘å¹³å°ã€‚</p><blockquote><h3 id="Optimized-performance-through-AWS-integrations"><a href="#Optimized-performance-through-AWS-integrations" class="headerlink" title="Optimized performance through AWS integrations"></a>Optimized performance through AWS integrations</h3><p>  AWS provided builds of Bottlerocket are optimized to run on Amazon EC2 and include support for the latest Amazon EC2 instance capabilities. They also have built-in integrations with AWS services for container orchestration, registries, and observability.</p></blockquote><h3 id="CoreOS-Container-Linux"><a href="#CoreOS-Container-Linux" class="headerlink" title="CoreOS Container Linux"></a>CoreOS Container Linux</h3><p>æ¥è‡ª CoreOS å›¢é˜Ÿçš„ CoreOS Container Linux ï¼Œå®ƒåº”è¯¥æ˜¯æœ€å¤è€çš„ Linux Container OS ï¼Œæ—©åœ¨ 2013 å¹´ 10 æœˆå°±å·²ç» release ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œé‚£æ—¶å€™çš„ docker è¿˜æ²¡æœ‰åœ¨ 0.x.x ç‰ˆæœ¬ã€‚</p><blockquote><p>  <a href="https://github.com/coreos/manifest/releases/tag/v94.0.0" target="_blank" rel="noopener">v94.0.0</a></p><ul><li>Git is now included by default as a number of people use it for shipping around assets, code, etc like a distributed rsync</li><li>Docker is upgraded to 0.6.3</li><li>xz is included to support new compression types</li><li>Custom OEMs can be provided via the cpio on PXE images</li></ul></blockquote><p>å®ƒæ²¡æœ‰åƒ yum æˆ– apt è¿™æ ·çš„åŒ…ç®¡ç†å™¨æ¥å®‰è£…è½¯ä»¶ï¼Œåœ¨ CoreOS ä¸­ä½ ä¸éœ€è¦å®‰è£…è½¯ä»¶ï¼Œå› ä¸ºæ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½è¦ä½¿ç”¨ docker æ¥æ‰“åŒ…ã€‚</p><ul><li>æœ€å°åŒ–çš„æ“ä½œç³»ç»Ÿï¼š å ç”¨å†…å­˜å¾ˆå°‘ï¼Œæ¯”å…¸å‹çš„æœåŠ¡å™¨ç‰ˆæœ¬ Linux å°‘å  40%çš„å†…å­˜ã€‚</li><li>æ˜“äºå‡çº§ï¼š CoreOS é‡‡ç”¨åŒç³»ç»Ÿåˆ†åŒºï¼ˆä¸»åŠ¨åˆ†åŒº/è¢«åŠ¨åˆ†åŒºï¼‰è®¾è®¡è€Œä¸æ˜¯é‡‡ç”¨ä¼ ç»Ÿçš„é€šè¿‡å‡çº§åŒ…æ¥å‡çº§ç³»ç»Ÿï¼Œè¿™ä½¿å¾—æ¯æ¬¡å‡çº§æ›´åŠ å¿«é€Ÿï¼Œå¯é å’Œæ˜“äºå›æ»šã€‚è¿™ä¸€ç‚¹æœ‰ç‚¹åƒ Android çš„ A/B åˆ†åŒºï¼Ÿ</li><li>é›†æˆ Dockerï¼š CoreOS é»˜è®¤é›†æˆ Docker å¹¶ä½œäº†å¾ˆå¥½çš„æ”¯æŒå’Œä¼˜åŒ–ï¼Œçœå»ç”¨æˆ·å®‰è£…ï¼Œé…ç½®ï¼Œä¼˜åŒ– Docker çš„æ—¶é—´ï¼Œæå¤§åœ°æ–¹ä¾¿äº†ç”¨æˆ·ã€‚</li><li>æ˜“äºé›†ç¾¤åŒ–ï¼š CoreOS æœ¬èº«æä¾›äº†å¤§å‹ Docker å®¹å™¨é›†ç¾¤çš„æ•´ä½“è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡å†…ç½®çš„ fleet å·¥å…·åœ¨å¤šå°ç³»ç»Ÿä¸­éƒ¨ç½²å®¹å™¨å¹¶è¿›è¡Œé›†ç¾¤åŒ–ç®¡ç†ã€‚åŒæ—¶é€šè¿‡æä¾› Discovery Serviceï¼Œä¾¿äºåŠ¨æ€éƒ¨ç½²å’Œç®¡ç†é›†ç¾¤ï¼Œè§£å†³æ–¹æ¡ˆæ¯”è¾ƒæˆç†Ÿã€‚</li><li>è‡ªåŠ¨åŒ–çš„å¤§è§„æ¨¡éƒ¨ç½²ï¼š CoreOS è‡ªèº«æä¾›çš„è§£å†³æ–¹æ¡ˆèƒ½å¤Ÿè‡ªåŠ¨åœ°å¤§è§„æ¨¡æ‰¹é‡éƒ¨ç½²å¹¶æ“ä½œç³»ç»Ÿï¼Œæå¤§åœ°å‡å°‘ç”¨æˆ·å·¥ä½œé‡ã€‚</li><li>ä½¿ç”¨ systemd åšä¸ºç³»ç»ŸæœåŠ¡ç®¡ç†å·¥å…·ï¼Œæ€§èƒ½æ¯”è¾ƒå¥½ï¼Œsystemd æœ‰ç°ä»£åŒ–çš„æ—¥å¿—åŠŸèƒ½ï¼ŒåŒæ—¶é‡‡ç”¨ socket å¼ä¸ D-Bus æ€»çº¿å¼æ¿€æ´»æœåŠ¡.</li></ul><p>ä¸è¿‡ CoreOS æ—©åœ¨ä»Šå¹´å››æœˆä»½å°±å·²ç» EOF äº†ï¼Œ<a href="https://getfedora.org/coreos/" target="_blank" rel="noopener">Fedora CoreOS</a> æˆä¸º CoreOS çš„ç»§ä»»è€…ï¼š</p><blockquote><p>  As weâ€™ve <a href="https://groups.google.com/d/msg/coreos-user/zgqkG88DS3U/PFP9yrKbAgAJ" target="_blank" rel="noopener">previously announced</a>, <a href="https://getfedora.org/coreos/" target="_blank" rel="noopener">Fedora CoreOS</a> is the official successor to CoreOS Container Linux. Fedora CoreOS is a <a href="https://fedoramagazine.org/fedora-coreos-out-of-preview/" target="_blank" rel="noopener">new Fedora Edition</a> built specifically for running containerized workloads securely and at scale. It combines the provisioning tools and automatic update model of Container Linux with the packaging technology, OCI support, and SELinux security of Atomic Host. For more on the Fedora CoreOS philosophy, goals, and design, see the <a href="https://fedoramagazine.org/introducing-fedora-coreos/" target="_blank" rel="noopener">announcement of the preview release</a> and the <a href="https://docs.fedoraproject.org/en-US/fedora-coreos/" target="_blank" rel="noopener">Fedora CoreOS documentation</a>.</p></blockquote><h3 id="çº¢å¸½çš„-RHCOS"><a href="#çº¢å¸½çš„-RHCOS" class="headerlink" title="çº¢å¸½çš„ RHCOS"></a>çº¢å¸½çš„ <a href="https://docs.openshift.com/container-platform/4.1/architecture/architecture-rhcos.html" target="_blank" rel="noopener">RHCOS</a></h3><p>æ¥è‡ªçº¢å¸½å­å®¶çš„ <a href="https://docs.openshift.com/container-platform/4.1/architecture/architecture-rhcos.html" target="_blank" rel="noopener">Red Hat Enterprise Linux CoreOS (RHCOS)</a>ï¼Œæ˜¯åŸºäºä¸è¿‡è¿™ä¸ª OS ä»…ä»…é€‚ç”¨äºå®ƒè‡ªå®¶çš„ <a href="https://docs.openshift.com/" target="_blank" rel="noopener">OpenShift</a>ï¼Œè€Œä¸”å®¹å™¨è¿è¡Œæ—¶ä»…æ”¯æŒ CRI-Oã€‚</p><blockquote><p>  At the moment, CRI-O is only available as a container engine within OpenShift Container Platform clusters.</p></blockquote><p>å› ä¸º CoreOS å›¢é˜Ÿç°å¦‚ä»Šå·²ç»è¢« Red HatÂ® æ”¶è´­äº†ï¼Œæ­£å¦‚åœ¨ <a href="https://access.redhat.com/documentation/zh-cn/openshift_container_platform/4.2/html/architecture/architecture-rhcos" target="_blank" rel="noopener">OpenShift æ–‡æ¡£</a> ä¸­æåˆ°çš„ï¼š Red Hat Enterprise Linux CoreOS (RHCOS) ä»£è¡¨äº†ä¸‹ä¸€ä»£å•ç”¨é€”å®¹å™¨æ“ä½œç³»ç»ŸæŠ€æœ¯ã€‚RHCOS ç”±åˆ›å»ºäº† Red Hat Enterprise Linux Atomic Host å’Œ CoreOS Container Linux çš„åŒä¸€å¼€å‘å›¢é˜Ÿæ‰“é€ ï¼Œå®ƒå°† Red Hat Enterprise Linux (RHEL) çš„è´¨é‡æ ‡å‡†ä¸ Container Linux çš„è‡ªåŠ¨åŒ–è¿œç¨‹å‡çº§åŠŸèƒ½ç»“åˆåœ¨ä¸€èµ·ã€‚</p><h3 id="RancherOS"><a href="#RancherOS" class="headerlink" title="RancherOS"></a>RancherOS</h3><p>RancherOS æ˜¯ Rancher å›¢é˜Ÿæ‰€ç»´æŠ¤çš„å¼€æºé¡¹ç›®ï¼Œä¹Ÿæ˜¯å¯¹æ ‡ CoreOS ä¸€æ ·ï¼Œä¸“é—¨ç”¨æ¥è¿è¡Œå®¹å™¨ï¼Œå¹¶ä¸”å¯ä»¥è¿è¡Œåœ¨ç”Ÿäº§ç¯å¢ƒï¼ˆè‡³å°‘å®˜æ–¹åšäº†è¿™ä¹ˆæ ·çš„æ‰¿è¯ºï¼Œå’±ä¹Ÿæ²¡åœ¨ç”Ÿäº§ç”¨è¿‡ï¼Œä¸å¥½è¯´ã€‚åœ¨ RancherOS ä¸­æ‰€æœ‰çš„è¿›ç¨‹ï¼ˆåŒ…æ‹¬ç³»ç»Ÿæ‰€æœ‰çš„æœåŠ¡ï¼Œæ¯”å¦‚ udev å’Œ syslogï¼‰éƒ½æ˜¯ç”¨ docker æ¥ç®¡ç†ï¼Œè¿™ä¸€ç‚¹è¦æ¯” CoreOS æ›´åŠ æ¿€è¿›ä¸€äº›ï¼Œè€Œ CoreOS è¿˜æ˜¯ä½¿ç”¨ä¼ ç»Ÿ Linux å‘è¡Œç‰ˆä¸­çš„ systemd æ¥ç®¡ç†ç³»ç»Ÿä¸­çš„æœåŠ¡ã€‚RancherOS é€šè¿‡ç§»é™¤ä¼ ç»Ÿ Linux å‘è¡Œç‰ˆä¸­ä¸å¿…è¦çš„æœåŠ¡å’Œåº“æ¥æœ€å°åŒ–ç³»ç»Ÿï¼Œä½¿ä»–ä¸“æ³¨å•ä¸€çš„åŠŸèƒ½ï¼Œå³è¿è¡Œ docker å®¹å™¨ã€‚ä¸è¿‡ä¹‹å‰ä½“éªŒäº†ä¸€ç•ªï¼Œå ç”¨èµ„æºæ¯”è¾ƒå¤šğŸ˜‚ï¼Œå¥½åƒå¹¶æ²¡æœ‰å¤ªå¤§çš„ä¼˜åŠ¿ï¼ˆ</p><p><code>Everything in RancherOS is a Docker container.</code> æ„Ÿè§‰è¿™ä¸ªè¦æ¯” CoreOS æ›´åŠ å®¹å™¨åŒ–ï¼Œç”šè‡³ä½¿ç”¨ docker å–ä»£äº† systemd æ¥ç®¡ç†ç³»ç»Ÿçš„å„ç§æœåŠ¡ã€‚ç³»ç»Ÿå¯åŠ¨åè¿è¡Œä¸¤ä¸ª docker æœåŠ¡è¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯ç³»ç»Ÿ docker ï¼Œåœ¨æ­¤ä¹‹ä¸Šåœ¨è¿è¡Œç³»ç»ŸæœåŠ¡å®¹å™¨ï¼Œå’Œç”¨æˆ·å±‚é¢çš„ docker ã€‚ä¸è¿‡çœ‹ä¸€ä¸‹ä¸‹é¢çš„è¿™å¼ å›¾ä½ å°±ä¼šæ˜ç™½ã€‚æ€»çš„æ¥è®² RancherOS æ˜¯ä½¿ç”¨ docker æ¥ç®¡ç†æ•´ä¸ªç³»ç»Ÿçš„æœåŠ¡çš„ï¼ŒåŒ…æ‹¬ç”¨æˆ·å±‚é¢çš„ docker ã€‚</p><p><img src="img/rancheroshowitworks.png" alt="How it works"></p><h3 id="VMware-çš„-Photon-OS"><a href="#VMware-çš„-Photon-OS" class="headerlink" title="VMware çš„ Photon OS"></a>VMware çš„ <a href="https://vmware.github.io/photon/" target="_blank" rel="noopener">Photon OS</a></h3><p>ä»Šå¤©çš„ä¸»è§’ï¼ŒVMware  å¼€æºçš„ Photon OSï¼Œè¿™ä¸ª OS ä½ å¯èƒ½æ²¡å¬è¯´è¿‡ï¼Œä½† VMware å¼€æºçš„ Harbor æƒ³å¿…å¾ˆç†Ÿæ‚‰ï¼Œè€Œ Harbor çš„åŸºç¡€é•œåƒä½¿ç”¨çš„å°±æ˜¯ä»–å®¶çš„ Photon OSğŸ˜‚ã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root [ /harbor ]# cat /etc/os-release</span><br><span class="line"><span class="attr">NAME</span>=<span class="string">"VMware Photon OS"</span></span><br><span class="line"><span class="attr">VERSION</span>=<span class="string">"2.0"</span></span><br><span class="line"><span class="attr">ID</span>=photon</span><br><span class="line"><span class="attr">VERSION_ID</span>=<span class="number">2.0</span></span><br><span class="line"><span class="attr">PRETTY_NAME</span>=<span class="string">"VMware Photon OS/Linux"</span></span><br><span class="line"><span class="attr">ANSI_COLOR</span>=<span class="string">"1;34"</span></span><br><span class="line"><span class="attr">HOME_URL</span>=<span class="string">"https://vmware.github.io/photon/"</span></span><br><span class="line"><span class="attr">BUG_REPORT_URL</span>=<span class="string">"https://github.com/vmware/photon/issues"</span></span><br></pre></td></tr></table></figure><p>åœ¨ Photon OS çš„æ„å»ºè„šæœ¬ <a href="https://github.com/vmware/photon/blob/master/build.py" target="_blank" rel="noopener">build.py</a> ä¸­å¯ä»¥çœ‹åˆ°å®ƒæ„å»ºçš„äº§ç‰©æ”¯æŒ ISO å’Œ docker é•œåƒï¼Œä»¥åŠä¼—å¤šå…¬æœ‰äº‘çš„è™šæ‹Ÿæœºæ ¼å¼ï¼Œä¸¤è€…éƒ½æ˜¯æ¥è‡ªç›¸åŒçš„æºç ï¼Œæ ¹æ®æ„å»ºå‡ºæ¥çš„æ˜¯å½¢å¼ä¸åŒï¼Œæ‰€åŒ…å«çš„è½¯ä»¶ä¹Ÿä¸åŒã€‚å› ä¸ºè£å‰ªæ‰äº†ä¸€äº›ä¸å¿…è¦çš„ç³»ç»ŸæœåŠ¡ï¼Œ docker é•œåƒæ ¼å¼çš„è¦æ›´ç²¾ç®€ä¸€äº›ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">targetList = &#123;</span><br><span class="line">        "image":["iso", "ami", "gce", "azure", "rpi3", "ova", "ova_uefi", "all", "src-iso",</span><br><span class="line">                "photon-docker-image", "k8s-docker-images", "all-images", "minimal-iso", "rt-iso"],</span><br><span class="line"></span><br><span class="line">        "rpmBuild": ["packages", "packages-minimal", "packages-initrd", "packages-docker",</span><br><span class="line">                "updated-packages", "tool-chain-stage1", "tool-chain-stage2", "check",</span><br><span class="line">                "ostree-repo", "generate-yaml-files", "create-repo", "distributed-build"],</span><br><span class="line"></span><br><span class="line">        "buildEnvironment": ["packages-cached", "sources", "sources-cached", "publish-rpms",</span><br><span class="line">                "publish-x-rpms", "publish-rpms-cached", "publish-x-rpms-cached", "photon-stage"]</span><br></pre></td></tr></table></figure><p>æ€»çš„æ¥è®²ï¼Œä¸Šé¢æåˆ°çš„å‡ ç§å®¹å™¨ä¼˜åŒ–å‹ OS ä¸­ ï¼ŒPhoton OS æ¯”è¾ƒå¼€æ”¾ä¸€äº›ï¼Œè™½ç„¶æ¥è¯´æ˜¯é’ˆå¯¹äºè‡ªå®¶ vSphere è¿›è¡Œä¼˜åŒ–çš„ï¼Œä½†å…¶ä»–å…¬æœ‰äº‘å’Œç§æœ‰äº‘ä¹Ÿæ˜¯æ”¯æŒï¼Œç”šè‡³è¿˜æ”¯æŒæ ‘è“æ´¾ğŸ“ï¼æ‰€ä»¥ä¸ªäººç”¨æˆ·æƒ³æ‹¿æ¥ç©ç©ï¼Œè¿˜æ˜¯ä¸é”™æ»´ã€‚å°¤å…¶æ˜¯é’ˆå¯¹å’±è¿™ç§ç© ESXi è½¯è·¯ç”±çš„åƒåœ¾ä½¬ï¼Œåœ¨ Photon OS ä¸Šè·‘ä¸€äº›å®¹å™¨åº”ç”¨ï¼Œå†é€‚åˆä¸è¿‡äº†ã€‚</p><h2 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h2><table><thead><tr><th align="center">Providers</th><th align="center">Name</th><th align="center">START</th><th align="center">FORK</th></tr></thead><tbody><tr><td align="center">Google</td><td align="center"><a href="https://github.com/GoogleCloudPlatform/cos-customizer" target="_blank" rel="noopener">Container-Optimized OS</a></td><td align="center">-</td><td align="center">-</td></tr><tr><td align="center">Amazon</td><td align="center"><a href="https://github.com/bottlerocket-os/bottlerocket" target="_blank" rel="noopener">Bottlerocket OS</a></td><td align="center">4.8K</td><td align="center">185</td></tr><tr><td align="center">CoreOS</td><td align="center">CoreOS Container Linux</td><td align="center">-</td><td align="center">-</td></tr><tr><td align="center">Red Hat</td><td align="center">RHCOS</td><td align="center">-</td><td align="center">-</td></tr><tr><td align="center">Rancher</td><td align="center"><a href="https://github.com/rancher/os" target="_blank" rel="noopener">Rancher OS</a></td><td align="center">6k</td><td align="center">625</td></tr><tr><td align="center">Flatcar</td><td align="center"><a href="https://github.com/flatcar-linux/Flatcar" target="_blank" rel="noopener">Flatcar Linux</a></td><td align="center">117</td><td align="center">3</td></tr><tr><td align="center">VMware</td><td align="center"><a href="https://github.com/vmware/photon" target="_blank" rel="noopener">Photon OS</a></td><td align="center">2.1k</td><td align="center">591</td></tr></tbody></table><table><thead><tr><th align="center">Providers</th><th align="center">Name</th><th align="center">Runtime</th><th align="center">Support Platform</th></tr></thead><tbody><tr><td align="center">Google</td><td align="center">Container-Optimized OS</td><td align="center">docker</td><td align="center">GCP</td></tr><tr><td align="center">Amazon</td><td align="center">Bottlerocket OS</td><td align="center">docker</td><td align="center">AWS</td></tr><tr><td align="center">CoreOS</td><td align="center">CoreOS Container Linux</td><td align="center">docker</td><td align="center">AWS/GCP/OpenStack/VMware<BR>Alibaba Cloud/Azure/DigitalOcean</td></tr><tr><td align="center">Red Hat</td><td align="center">RHCOS</td><td align="center">CRI-O</td><td align="center">AWS/vSphere/Bare Metal</td></tr><tr><td align="center">Rancher</td><td align="center">Rancher OS</td><td align="center">docker</td><td align="center">AWS/GCP/OpenStack/VMware<BR>Alibaba Cloud/Azure/DigitalOcean</td></tr><tr><td align="center">Flatcar</td><td align="center">Flatcar Linux</td><td align="center">docker</td><td align="center">AWS/GCP/OpenStack/VMware<BR>Alibaba Cloud/Azure/DigitalOcean</td></tr><tr><td align="center">VMware</td><td align="center">Photon OS</td><td align="center">docker</td><td align="center">AWS/GCE/Azure/OpenStack<br>vSphere/bare metal/Raspberry Pi 3</td></tr></tbody></table><p>ç›®å‰æ¥è®² Photon OS ä½œä¸º Harbor çš„åŸºç¡€é•œåƒï¼Œåœ¨å®¹å™¨æ–¹é¢æ¯”è¾ƒçªå‡ºä¸€äº›ï¼Œä½†ä½œä¸ºå®¹å™¨çš„å®¿ä¸»æœº OS ï¼Œè¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚ç”±äºæˆ‘æ˜¯ä½¿ç”¨çš„ VMware å®¶çš„ ESXi è™šæ‹ŸåŒ–ï¼Œé‚£ä¹ˆé€‰æ‹©ä»–å®¶çš„ Photon OS æ˜¯æœ€å¥½çš„å–½ï¼Œè€Œä¸” Photon OS æ˜¯é’ˆå¯¹ ESXi åšè¿‡ä¼˜åŒ–çš„ï¼Œå†…æ ¸éƒ½æ˜¯é’ˆå¯¹ ESXi è™šæ‹ŸåŒ–è¿›è¡Œäº†å®šåˆ¶åŒ–çš„å¼€å‘ï¼Œæ‰€ä»¥ç†è®ºä¸Šé€‰æ‹© Photon OS åº”è¯¥æ˜¯æœ€åˆé€‚çš„ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="Download-Format"><a href="#Download-Format" class="headerlink" title="Download Format"></a><a href="https://github.com/vmware/photon/wiki/Downloading-Photon-OS" target="_blank" rel="noopener">Download Format</a></h3><table><thead><tr><th>Format</th><th>Description</th></tr></thead><tbody><tr><td>ISO Image</td><td>Contains everything needed to install either the minimal or full installation of Photon OS. The bootable ISO has a manual installer or can be used with PXE/kickstart environments for automated installations.</td></tr><tr><td>OVA</td><td>Pre-installed minimal environment, customized for VMware hypervisor environments. These customizations include a highly sanitized and optimized kernel to give improved boot and runtime performance for containers and Linux applications. Since an OVA is a complete virtual machine definition, weâ€™ve made available a Photon OS OVA that has virtual hardware version 11; this will allow for compatibility with several versions of VMware platforms or allow for the latest and greatest virtual hardware enhancements.</td></tr><tr><td>Amazon AMI</td><td>Pre-packaged and tested version of Photon OS made ready to deploy in your Amazon EC2 cloud environment. Previously, weâ€™d published documentation on how to create an Amazon compatible instance, but, now weâ€™ve done the work for you.</td></tr><tr><td>Google GCE Image</td><td>Pre-packaged and tested Google GCE image that is ready to deploy in your Google Compute Engine Environment, with all modifications and package requirements for running Photon OS in GCE.</td></tr><tr><td>Azure VHD</td><td>Pre-packaged and tested Azure HD image that is ready to deploy in your Microsoft Azure Cloud, with all modifications and package requirements for running Photon OS in Azure.</td></tr><tr><td>Raspberry Pi3 Image</td><td>Pre-packaged and tested Raspberry Pi3 Image (Version 3.0 onwards) on ARM64 architecture.</td></tr></tbody></table><p>Photon OS æä¾›äº†å¤šç§å®‰è£…æ–¹å¼ï¼Œå…¶ä¸­ ISO æ˜¯é€šç”¨æ€§çš„ï¼Œå°±å’Œå®‰è£…å…¶ä»– Linux å‘è¡Œç‰ˆçš„è¿‡ç¨‹å·®ä¸å¤šï¼ŒOVA æ˜¯è™šæ‹Ÿæœºæ¨¡æ¿ï¼Œå¯ä»¥å¯¼å…¥åˆ° VMware è™šæ‹ŸåŒ–å¹³å°ä¸Šä½¿ç”¨ï¼ŒçœåŒºå®‰è£…çš„æ­¥éª¤ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚OVA è™šæ‹Ÿæœºæ¨¡æ¿çš„ç‰ˆæœ¬ä¸º 11 ï¼Œæ ¹æ® <a href="https://kb.vmware.com/s/article/1003746" target="_blank" rel="noopener">Virtual machine hardware versions</a> ä¸­çš„å®šä¹‰ï¼Œéœ€è¦ ESXi 6.0 Fusion 7.x Workstation 11.x Player 7.x ç‰ˆæœ¬ä»¥ä¸Šçš„è™šæ‹ŸåŒ–æ”¯æŒã€‚</p><table><thead><tr><th><strong>Virtual Hardware Version</strong></th><th><strong>Products</strong></th></tr></thead><tbody><tr><td>18</td><td>ESXi 7.0.1</td></tr><tr><td>17</td><td>ESXi 7.0.0</td></tr><tr><td>16</td><td>Fusion 11.x Workstation Pro 15.x Workstation Player 15.x</td></tr><tr><td>15</td><td>VMware Cloud on AWS ESXi 6.7 U2</td></tr><tr><td>14</td><td>ESXi 6.7 Fusion 10.x Workstation Pro 14.x Workstation Player 14.x</td></tr><tr><td>13</td><td>ESXi 6.5</td></tr><tr><td>12</td><td>Fusion 8.x Workstation Pro 12.x Workstation Player 12.x</td></tr><tr><td>11</td><td>ESXi 6.0 Fusion 7.x Workstation 11.x Player 7.x</td></tr><tr><td>10</td><td>ESXi 5.5 Fusion 6.x Workstation 10.x Player 6.x</td></tr></tbody></table><p>å¦å¤–è¿˜æ”¯æŒ <code>Raspberry Pi 3</code> ï¼Œä¸è¿‡éœ€è¦æ‹¿æºç è‡ªè¡Œç¼–è¯‘é•œåƒï¼Œç„¶ååˆ·åˆ°æ ‘è“æ´¾ä¸Šï¼Œä½ åƒç°çš„æ ‘è“æ´¾åˆæœ‰ç”¨é€”å•¦ğŸ˜‚ã€‚</p><p><a href="https://github.com/vmware/photon/wiki/Downloading-Photon-OS" target="_blank" rel="noopener">ä¸‹è½½æ–¹å¼</a> ğŸ‘‡</p><h3 id="Photon-OS-3-0-Revision-2-Update3-Binaries"><a href="#Photon-OS-3-0-Revision-2-Update3-Binaries" class="headerlink" title="Photon OS 3.0 Revision 2 Update3 Binaries"></a>Photon OS 3.0 Revision 2 Update3 Binaries</h3><p>Aug 14, 2020 An update to 3.0 revision 2 Update3 binaries are now available.</p><table><thead><tr><th>Download</th><th>Size</th><th>md5 checksum</th></tr></thead><tbody><tr><td><a href="https://packages.vmware.com/photon/3.0/Rev3/iso/photon-3.0-a383732.iso" target="_blank" rel="noopener">Full ISO x86_64</a></td><td>5.2G</td><td>2dd9f18c5162a7367f2463f4a9bb4890</td></tr><tr><td><a href="https://packages.vmware.com/photon/3.0/Rev3/iso/photon-minimal-3.0-a383732.iso" target="_blank" rel="noopener">Minimal ISO x86_64</a></td><td>299M</td><td>0119f0f275f246fd382d419ff41898a4</td></tr><tr><td><a href="https://packages.vmware.com/photon/3.0/Rev3/iso/photon-rt-3.0-a383732.iso" target="_blank" rel="noopener">ISO x86_64 Real-Time flavour</a></td><td>489M</td><td>d2bfce95b54a29174b5beaef9962dbc1</td></tr><tr><td><a href="https://packages.vmware.com/photon/3.0/Rev3/ova/photon-hw11-3.0-a383732.ova" target="_blank" rel="noopener">OVA-hw11</a></td><td>188M</td><td>ba52abd88c5b22cd4498cf0e88457f28</td></tr><tr><td><a href="https://packages.vmware.com/photon/3.0/Rev3/ova/photon-hw13_uefi-3.0-a383732.ova" target="_blank" rel="noopener">OVA-hw13_uefi</a></td><td>214M</td><td>95614f3b08c1a93306ababcc826572df</td></tr></tbody></table><p>åœ¨æ­¤ä½¿ç”¨ OVA-hw11 æ ¼å¼çš„ OVA è™šæ‹Ÿæœºæ¨¡æ¿ï¼Œåé¢é‚£ä¸ªå¸¦ uefi çš„éœ€è¦è®¾ç½®è™šæ‹Ÿæœºä¸º EFI æ¨¡å¼å¯åŠ¨ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚</p><ul><li>åˆ›å»ºè™šæ‹Ÿæœºçš„æ—¶å€™ä½¿ç”¨ OVA æ–‡ä»¶å¯¼å…¥</li></ul><p><img src="img/20200922-esxi_ova_01.png" alt=""></p><ul><li>é»˜è®¤çš„ç”¨æˆ·åä¸º <code>root</code> ï¼Œå¯†ç ä¸º <code>changeme</code>ï¼Œç™»å½•ä¹‹åå†è¾“å…¥ä¸€é <code>changeme</code>ï¼Œç„¶åä¿®æ”¹ä¸ºæ–°çš„å¯†ç ã€‚</li></ul><p><img src="img/20200922-esxi_photonos-01.png" alt=""></p><h2 id="ç³»ç»Ÿä¿¡æ¯"><a href="#ç³»ç»Ÿä¿¡æ¯" class="headerlink" title="ç³»ç»Ÿä¿¡æ¯"></a>ç³»ç»Ÿä¿¡æ¯</h2><ul><li>å†…æ ¸ç‰ˆæœ¬ä¸º <code>4.19.132-5.ph3-esx</code>ï¼Œ4.19 æ˜¯ä¸ª LTS ç‰ˆæœ¬çš„å†…æ ¸ï¼Œç»“å°¾çš„ <code>esx</code> åˆ™ä»£è¡¨ç€ä¸º <code>ESXi</code> è™šæ‹ŸåŒ–å®šåˆ¶çš„å†…æ ¸ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Linux photon-machine 4.19.132-5.ph3-esx #1-photon SMP Wed Aug 12 21:02:13 UTC 2020 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure><ul><li>rpm åŒ…æ•°é‡ä»…ä»…ä¸º 146 ä¸ªï¼Œä¸€èˆ¬çš„ CentOS å‘è¡Œç‰ˆè‡ªå¸¦çš„ rpm åŒ…æ•°é‡ä¸º 300 ä¸ªå·¦å³ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# rpm -qa | wc</span><br><span class="line">    146     146    4307</span><br></pre></td></tr></table></figure><ul><li>ç³»ç»Ÿè¿›ç¨‹ä¿¡æ¯ï¼Œè¿˜æ˜¯é‡‡ç”¨ systemd æ¥ç®¡ç†è¿›ç¨‹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# systemctl status</span><br><span class="line">â— photon-machine</span><br><span class="line">    State: running</span><br><span class="line">     Jobs: 0 queued</span><br><span class="line">   Failed: 0 units</span><br><span class="line">    Since: Tue 2020-09-22 08:07:29 UTC; 10min ago</span><br><span class="line">   CGroup: /</span><br><span class="line">           â”œâ”€user.slice</span><br><span class="line">           â”‚   â”œâ”€session-c2.scope</span><br><span class="line">           â”‚   â”‚ â”œâ”€413 sshd: root@pts/0</span><br><span class="line">           â”‚   â”‚ â”œâ”€420 -bash</span><br><span class="line">           â”‚   â”‚ â”œâ”€443 systemctl status</span><br><span class="line">           â”‚   â”‚ â””â”€444 systemctl status</span><br><span class="line">           â”‚   â””â”€user@0.service</span><br><span class="line">           â”‚     â””â”€init.scope</span><br><span class="line">           â”‚       â”œâ”€393 /lib/systemd/systemd --user</span><br><span class="line">           â”‚       â””â”€394 (sd-pam)</span><br><span class="line">           â”œâ”€init.scope</span><br><span class="line">           â”‚ â””â”€1 /lib/systemd/systemd</span><br><span class="line">           â””â”€system.slice</span><br><span class="line">             â”œâ”€systemd-networkd.service</span><br><span class="line">             â”‚ â””â”€245 /lib/systemd/systemd-networkd</span><br><span class="line">             â”œâ”€systemd-udevd.service</span><br><span class="line">             â”‚ â””â”€124 /lib/systemd/systemd-udevd</span><br><span class="line">             â”œâ”€vgauthd.service</span><br><span class="line">             â”‚ â””â”€159 /usr/bin/VGAuthService -s</span><br><span class="line">             â”œâ”€systemd-journald.service</span><br><span class="line">             â”‚ â””â”€97 /lib/systemd/systemd-journald</span><br><span class="line">             â”œâ”€sshd.service</span><br><span class="line">             â”‚ â””â”€352 /usr/sbin/sshd -D</span><br><span class="line">             â”œâ”€vmtoolsd.service</span><br><span class="line">             â”‚ â””â”€161 /usr/bin/vmtoolsd</span><br><span class="line">             â”œâ”€systemd-resolved.service</span><br><span class="line">             â”‚ â””â”€247 /lib/systemd/systemd-resolved</span><br><span class="line">             â”œâ”€dbus.service</span><br><span class="line">             â”‚ â””â”€157 /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only</span><br><span class="line">             â”œâ”€systemd-timesyncd.service</span><br><span class="line">             â”‚ â””â”€151 /lib/systemd/systemd-timesyncd</span><br><span class="line">             â””â”€systemd-logind.service</span><br><span class="line">               â””â”€158 /lib/systemd/systemd-logind</span><br></pre></td></tr></table></figure><ul><li>ç£ç›˜æ ¹ç›®å½•åªä½¿ç”¨äº†ä¸åˆ° 600M</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# df -h</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">&#x2F;dev&#x2F;root        16G  577M   15G   4% &#x2F;</span><br></pre></td></tr></table></figure><ul><li>å†…å­˜ä¹Ÿåªä½¿ç”¨äº† 43Miï¼Œå¯åŠ¨ dockerd ä¹‹åå†…å­˜å ç”¨ 108Miï¼Œæ¢æˆ containerd å°†ä¼šå°ä¸€äº›ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:          2.0Gi        43Mi       1.8Gi       0.0Ki       103Mi       1.8Gi</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨ dockerd å®ˆæŠ¤è¿›ç¨‹ä¹‹åå†…å­˜å ç”¨ 108Mi</span></span><br><span class="line">root@photon-machine [ ~ ]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:          2.0Gi       108Mi       1.6Gi       0.0Ki       298Mi       1.8Gi</span><br></pre></td></tr></table></figure><ul><li>å†…æ ¸æ¨¡å—çš„æ•°é‡ä¹Ÿæ¯”è¾ƒå°‘ 30 ä¸ªå·¦å³ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ä¸€äº›ç½‘ç»œç›¸å…³çš„å†…æ ¸æ¨¡å—ã€‚å¸¸è§„çš„ Linux å‘è¡Œç‰ˆçš„å†…æ ¸æ¨¡å—å¾€å¾€åœ¨ 60 ä¸ªä»¥ä¸Šã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# lsmod</span><br><span class="line">Module                  Size  Used by</span><br><span class="line">xt_conntrack           16384  2</span><br><span class="line">ip6table_mangle        16384  0</span><br><span class="line">ip6table_nat           16384  0</span><br><span class="line">nf_nat_ipv6            16384  1 ip6table_nat</span><br><span class="line">iptable_mangle         16384  0</span><br><span class="line">iptable_nat            16384  0</span><br><span class="line">nf_nat_ipv4            16384  1 iptable_nat</span><br><span class="line">nf_nat                 28672  2 nf_nat_ipv6,nf_nat_ipv4</span><br><span class="line">ip6table_filter        16384  1</span><br><span class="line">ip6_tables             24576  3 ip6table_filter,ip6table_nat,ip6table_mangle</span><br><span class="line">iptable_filter         16384  1</span><br><span class="line">xt_LOG                 16384  0</span><br><span class="line">nf_conntrack           90112  4 xt_conntrack,nf_nat,nf_nat_ipv6,nf_nat_ipv4</span><br><span class="line">nf_defrag_ipv6         20480  1 nf_conntrack</span><br><span class="line">nf_defrag_ipv4         16384  1 nf_conntrack</span><br><span class="line">mousedev               20480  0</span><br><span class="line">vfat                   20480  1</span><br><span class="line">fat                    61440  1 vfat</span><br><span class="line">evdev                  20480  1</span><br><span class="line">vmwgfx                253952  1</span><br><span class="line">psmouse                90112  0</span><br><span class="line">drm_kms_helper        106496  1 vmwgfx</span><br><span class="line">ttm                    86016  1 vmwgfx</span><br><span class="line">drm                   323584  4 vmwgfx,drm_kms_helper,ttm</span><br><span class="line">sr_mod                 24576  0</span><br><span class="line">i2c_core               40960  2 drm_kms_helper,drm</span><br><span class="line">cdrom                  49152  1 sr_mod</span><br><span class="line">rdrand_rng             16384  0</span><br><span class="line">rng_core               16384  1 rdrand_rng</span><br><span class="line">ipv6                  368640  16 nf_nat_ipv6,ip6table_mangle</span><br><span class="line">root@photon-machine [ ~ ]# lsmod | wc</span><br><span class="line">     31     109    1273</span><br></pre></td></tr></table></figure><ul><li>ç³»ç»Ÿè‡ªå¸¦çš„ docker ç‰ˆæœ¬ä¸º <code>19.03.10</code>ï¼Œå­˜å‚¨é©±åŠ¨ä½¿ç”¨çš„æ˜¯ <code>overlay2</code></li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">Client:</span><br><span class="line"> Debug Mode: false</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Containers: 0</span><br><span class="line">  Running: 0</span><br><span class="line">  Paused: 0</span><br><span class="line">  Stopped: 0</span><br><span class="line"> Images: 0</span><br><span class="line"> Server Version: 19.03.10</span><br><span class="line"> Storage Driver: overlay2</span><br><span class="line">  Backing Filesystem: extfs</span><br><span class="line">  Supports d_type: true</span><br><span class="line">  Native Overlay Diff: true</span><br><span class="line"> Logging Driver: json-file</span><br><span class="line"> Cgroup Driver: cgroupfs</span><br><span class="line"> Plugins:</span><br><span class="line">  Volume: local</span><br><span class="line">  Network: bridge host ipvlan macvlan null overlay</span><br><span class="line">  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog</span><br><span class="line"> Swarm: inactive</span><br><span class="line"> Runtimes: runc</span><br><span class="line"> Default Runtime: runc</span><br><span class="line"> Init Binary: docker-init</span><br><span class="line"> containerd version: b34a5c8af56e510852c35414db4c1f4fa6172339</span><br><span class="line"> runc version: d736ef14f0288d6993a1845745d6756cfc9ddd5a</span><br><span class="line"> init version: fec3683</span><br><span class="line"> Security Options:</span><br><span class="line">  apparmor</span><br><span class="line">  seccomp</span><br><span class="line">   Profile: default</span><br><span class="line"> Kernel Version: 4.19.132-5.ph3-esx</span><br><span class="line"> Operating System: VMware Photon OS/Linux</span><br><span class="line"> OSType: linux</span><br><span class="line"> Architecture: x86_64</span><br><span class="line"> CPUs: 1</span><br><span class="line"> Total Memory: 1.951GiB</span><br><span class="line"> Name: photon-machine</span><br><span class="line"> ID: HXBT:Z4LZ:4HZM:3YII:U7ZA:RVOH:Z7CL:L4FA:YGA4:Y2V6:DSVR:NWPD</span><br><span class="line"> Docker Root Dir: /var/lib/docker</span><br><span class="line"> Debug Mode: false</span><br><span class="line"> Registry: https://index.docker.io/v1/</span><br><span class="line"> Labels:</span><br><span class="line"> Experimental: false</span><br><span class="line"> Insecure Registries:</span><br><span class="line">  127.0.0.0/8</span><br><span class="line"> Live Restore Enabled: false</span><br><span class="line"> Product License: Community Engine</span><br></pre></td></tr></table></figure><h2 id="ç³»ç»Ÿç®¡ç†"><a href="#ç³»ç»Ÿç®¡ç†" class="headerlink" title="ç³»ç»Ÿç®¡ç†"></a>ç³»ç»Ÿç®¡ç†</h2><h3 id="ç½‘ç»œç®¡ç†"><a href="#ç½‘ç»œç®¡ç†" class="headerlink" title="ç½‘ç»œç®¡ç†"></a>ç½‘ç»œç®¡ç†</h3><ul><li>æŸ¥çœ‹ç½‘å¡çŠ¶æ€ï¼Œå¯ä½¿ç”¨è‡ªå¸¦çš„ <code>networkctl</code> å‘½ä»¤è¡Œå·¥å…·ï¼Œåƒ ifconfigã€ipã€ss ç­‰å‘½ä»¤éƒ½å·²ç»é»˜è®¤å®‰è£…ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ /mnt/RPMS ]# networkctl status eth0</span><br><span class="line">â— 2: eth0</span><br><span class="line">       Link File: /usr/lib/systemd/network/99-default.link</span><br><span class="line">    Network File: /etc/systemd/network/99-dhcp-en.network</span><br><span class="line">            Type: ether</span><br><span class="line">           State: routable (configured)</span><br><span class="line">            Path: pci-0000:0b:00.0</span><br><span class="line">          Driver: vmxnet3</span><br><span class="line">          Vendor: VMware</span><br><span class="line">           Model: VMXNET3 Ethernet Controller</span><br><span class="line">      HW Address: 00:0c:29:74:13:16 (VMware, Inc.)</span><br><span class="line">         Address: 192.168.0.235</span><br><span class="line">                  fe80::20c:29ff:fe74:1316</span><br><span class="line">         Gateway: 192.168.0.1 (NETGEAR)</span><br><span class="line">             DNS: 119.29.29.29</span><br><span class="line">                  223.6.6.6</span><br><span class="line">        CLIENTID: ffb6220feb00020000ab113bc2c88225c0d29b</span><br><span class="line">    Connected To: n/a on port 00:e0:4c:68:54:12</span><br><span class="line">                  n/a on port 00:e0:4c:68:54:13</span><br><span class="line">                  n/a on port 00:e0:4c:68:54:15</span><br></pre></td></tr></table></figure><ul><li>ç³»ç»Ÿå®‰è£…æ—¶é»˜è®¤ä½¿ç”¨çš„ DHCP è·å– IP ï¼Œå¯ä»¥ä½¿ç”¨ systemd æ¥è®¾ç½®é™æ€ IP</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> é¦–å…ˆä¿®æ”¹ DHCP çš„ systemd æ–‡ä»¶ï¼Œå…³é—­ DHCP</span></span><br><span class="line">sed -i 's/yes/no/' /etc/systemd/network/99-dhcp-en.network</span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºé™æ€ IP çš„ systemd æ–‡ä»¶</span></span><br><span class="line">cat &gt; /etc/systemd/network/10-static-en.network &lt;&lt; "EOF"</span><br><span class="line"></span><br><span class="line">[Match]</span><br><span class="line">Name=eth0</span><br><span class="line"></span><br><span class="line">[Network]</span><br><span class="line">Address=198.168.0.235/24</span><br><span class="line">Gateway=198.168.0.1</span><br><span class="line">DNS=192.168.0.100</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶æƒé™ä¸º 644 ï¼Œä¸ç„¶å¯åŠ¨çš„æ—¶å€™ä¼šæŠ¥é”™æç¤ºæƒé™é—®é¢˜</span></span><br><span class="line">chmod 644 /etc/systemd/network/10-static-en.network</span><br><span class="line"><span class="meta">#</span><span class="bash"> é‡å¯ä¸€ä¸‹ç½‘ç»œ</span></span><br><span class="line">systemctl restart systemd-networkd</span><br></pre></td></tr></table></figure><ul><li>æŒ‚è½½ NFS æ–‡ä»¶ç³»ç»Ÿéœ€è¦å®‰è£… <code>nfs-utils</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tdnf install nfs-utils -y</span><br><span class="line">mount 192.168.0.100:/nfs /mnt/nfs</span><br></pre></td></tr></table></figure><h3 id="åŒ…ç®¡ç†"><a href="#åŒ…ç®¡ç†" class="headerlink" title="åŒ…ç®¡ç†"></a>åŒ…ç®¡ç†</h3><p>Photon OS ä½¿ç”¨çš„æ˜¯ yum/tdnf ä½œä¸ºåŒ…ç®¡ç†å™¨ï¼Œä½¿ç”¨æ–¹æ³•å’Œ RedHat ç³»çš„å‘è¡Œç‰ˆåŸºæœ¬ç›¸åŒï¼Œrepo ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ls /etc/yum.repos.d/</span><br><span class="line">lightwave.repo</span><br><span class="line">photon-extras.repo</span><br><span class="line">photon-iso.repo</span><br><span class="line">photon-updates.repo</span><br><span class="line">photon.repo</span><br></pre></td></tr></table></figure><h3 id="æºç ç¼–è¯‘"><a href="#æºç ç¼–è¯‘" class="headerlink" title="æºç ç¼–è¯‘"></a>æºç ç¼–è¯‘</h3><h2 id="è¿è¡Œå®¹å™¨"><a href="#è¿è¡Œå®¹å™¨" class="headerlink" title="è¿è¡Œå®¹å™¨"></a>è¿è¡Œå®¹å™¨</h2><h3 id="Pi-hole"><a href="#Pi-hole" class="headerlink" title="Pi-hole"></a>Pi-hole</h3><blockquote><p>  Pi-hole æ˜¯ä¸€æ¬¾å¼€æºä¸”å…è´¹çš„ DNS æ²‰æ´æœåŠ¡å™¨ï¼ˆDNS sinkholeï¼‰ï¼Œèƒ½å¤Ÿåœ¨ä¸å®‰è£…ä»»ä½•å®¢æˆ·ç«¯ä¾§è½¯ä»¶çš„å‰æä¸‹ä¸ºè®¾å¤‡æä¾›ç½‘ç»œå†…å®¹å±è”½æœåŠ¡ï¼Œéå¸¸è½»é‡æ˜“ç”¨ã€‚æ­é…ä¸Šå®¶ä¸­åƒç°å·²ä¹…çš„æ ‘è“æ´¾ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿè½»æ¾æ‰“é€ å±äºè‡ªå·±çš„å¹¿å‘Šå±è”½åŠ©æ‰‹ã€‚<br>  åœ¨<a href="https://pi-hole.net/" target="_blank" rel="noopener">å®˜ç½‘</a>çš„ä»‹ç»ä¸­ï¼ŒPi-hole ä¸»è¦å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li>æ˜“äºå®‰è£…å’Œé…ç½®ï¼ˆå·ç§° 10 åˆ†é’Ÿå®‰è£…é…ç½®ä¸€æ¡é¾™ï¼‰ã€‚</li><li>å…¨å¹³å°ï¼Œå¹¿å‘Šå±è”½æœåŠ¡å¯ä½œç”¨äºä»»ä½•è®¾å¤‡ï¼ŒåŒ…æ‹¬PCã€æ‰‹æœºã€å¹³æ¿ç”µè„‘ã€‚</li><li>è½»é‡ï¼Œå¯¹ç¡¬ä»¶è¦æ±‚æä½ã€‚</li><li>åŠŸèƒ½ç¨³å®šä¸”å¼ºå¤§ï¼Œèƒ½è½»æ¾ hold ä½ç™¾ä¸‡çº§åˆ«çš„è¯·æ±‚ã€‚</li><li>æä¾›äº†ç¾è§‚çš„ Web æ•°æ®ç›‘æ§ä»ªè¡¨ç›˜ã€‚</li><li>å¼€æºä¸”å…è´¹ã€‚</li></ul></blockquote><ul><li>é¦–å…ˆéœ€è¦å…³é—­ systemd è‡ªå¸¦çš„ DNS æœåŠ¡ï¼Œä¸ç„¶ Pi-hole åšæŒºçš„ 53 ç«¯å£ä¼šè¢«å ç”¨</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop systemd-resolved</span><br><span class="line">systemctl disable systemd-resolved</span><br></pre></td></tr></table></figure><ul><li>å®‰è£… docker-composeï¼Œä¿®æ”¹ docker-compose.yaml æ–‡ä»¶</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3"</span></span><br><span class="line"><span class="comment"># More info at https://github.com/pi-hole/docker-pi-hole/ and https://docs.pi-hole.net/</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">pihole:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">pihole</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">pihole/pihole:latest</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"53:53/tcp"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"53:53/udp"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"67:67/udp"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"80:80/tcp"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"443:443/tcp"</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">'Asia/Shanghai'</span></span><br><span class="line">      <span class="attr">WEBPASSWORD:</span> <span class="string">'changeme'</span></span><br><span class="line">    <span class="comment"># Volumes store your data between container upgrades</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'./etc-pihole/:/etc/pihole/'</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'./etc-dnsmasq.d/:/etc/dnsmasq.d/'</span></span><br><span class="line">    <span class="comment"># Recommended but not required (DHCP needs NET_ADMIN)</span></span><br><span class="line">    <span class="comment">#   https://github.com/pi-hole/docker-pi-hole#note-on-capabilities</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br></pre></td></tr></table></figure><ul><li>docker-compose up èµ°èµ·ï¼</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">root@PhotonOS [ /opt/docker/pihole ]# docker-compose up</span><br><span class="line">Creating network "pihole_default" with the default driver</span><br><span class="line">Creating pihole ... done</span><br><span class="line">Attaching to pihole</span><br><span class="line">pihole    | [s6-init] making user provided files available at /var/run/s6/etc...exited 0.</span><br><span class="line">pihole    | [s6-init] ensuring user provided files have correct perms...exited 0.</span><br><span class="line">pihole    | [fix-attrs.d] applying ownership &amp; permissions fixes...</span><br><span class="line">pihole    | [fix-attrs.d] 01-resolver-resolv: applying...</span><br><span class="line">pihole    | [fix-attrs.d] 01-resolver-resolv: exited 0.</span><br><span class="line">pihole    | [fix-attrs.d] done.</span><br><span class="line">pihole    | [cont-init.d] executing container initialization scripts...</span><br><span class="line">pihole    | [cont-init.d] 20-start.sh: executing...</span><br><span class="line">pihole    |  ::: Starting docker specific checks &amp; setup for docker pihole/pihole</span><br><span class="line">  [âœ“] Update local cache of available packages</span><br><span class="line">pihole    |   [i] Existing PHP installation detected : PHP version 7.0.33-0+deb9u8</span><br><span class="line">pihole    |</span><br><span class="line">pihole    |   [i] Installing configs from /etc/.pihole...</span><br><span class="line">pihole    |   [i] Existing dnsmasq.conf found... it is not a Pi-hole file, leaving alone!</span><br><span class="line">  [âœ“] Copying 01-pihole.conf to /etc/dnsmasq.d/01-pihole.conf</span><br><span class="line">pihole    | chown: cannot access '': No such file or directory</span><br><span class="line">pihole    | chmod: cannot access '': No such file or directory</span><br><span class="line">pihole    | chown: cannot access '/etc/pihole/dhcp.leases': No such file or directory</span><br><span class="line">pihole    | ::: Pre existing WEBPASSWORD found</span><br><span class="line">pihole    | Using default DNS servers: 8.8.8.8 &amp; 8.8.4.4</span><br><span class="line">pihole    | DNSMasq binding to default interface: eth0</span><br><span class="line">pihole    | Added ENV to php:</span><br><span class="line">pihole    |                     "PHP_ERROR_LOG" =&gt; "/var/log/lighttpd/error.log",</span><br><span class="line">pihole    |                     "ServerIP" =&gt; "0.0.0.0",</span><br><span class="line">pihole    |                     "VIRTUAL_HOST" =&gt; "0.0.0.0",</span><br><span class="line">pihole    | Using IPv4 and IPv6</span><br><span class="line">pihole    | ::: Preexisting ad list /etc/pihole/adlists.list detected ((exiting setup_blocklists early))</span><br><span class="line">pihole    | https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts</span><br><span class="line">pihole    | https://mirror1.malwaredomains.com/files/justdomains</span><br><span class="line">pihole    | ::: Testing pihole-FTL DNS: FTL started!</span><br><span class="line">pihole    | ::: Testing lighttpd config: Syntax OK</span><br><span class="line">pihole    | ::: All config checks passed, cleared for startup ...</span><br><span class="line">pihole    |  ::: Docker start setup complete</span><br><span class="line">pihole    |   [i] Neutrino emissions detected...</span><br><span class="line">  [âœ“] Pulling blocklist source list into range</span><br><span class="line">pihole    |</span><br><span class="line">  [âœ“] Preparing new gravity database</span><br><span class="line">pihole    |   [i] Target: https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts</span><br><span class="line">pihole    |   [i] Received 55654 domains</span><br><span class="line">pihole    |   [i] Target: https://mirror1.malwaredomains.com/files/justdomains</span><br><span class="line">  [âœ“] Status: No changes detected</span><br><span class="line">pihole    |   [i] Received 26854 domains</span><br><span class="line">  [âœ“] Storing downloaded domains in new gravity database</span><br><span class="line">  [âœ“] Building tree</span><br><span class="line">  [âœ“] Swapping databases</span><br><span class="line">pihole    |   [i] Number of gravity domains: 82508 (82465 unique domains)</span><br><span class="line">pihole    |   [i] Number of exact blacklisted domains: 0</span><br><span class="line">pihole    |   [i] Number of regex blacklist filters: 0</span><br><span class="line">pihole    |   [i] Number of exact whitelisted domains: 0</span><br><span class="line">pihole    |   [i] Number of regex whitelist filters: 0</span><br><span class="line">  [âœ“] Cleaning up stray matter</span><br><span class="line">pihole    |</span><br><span class="line">pihole    |   [âœ“] DNS service is running</span><br><span class="line">pihole    |   [âœ“] Pi-hole blocking is Enabled</span><br><span class="line">pihole    |   Pi-hole version is v5.1.2 (Latest: v5.1.2)</span><br><span class="line">pihole    |   AdminLTE version is v5.1.1 (Latest: v5.1.1)</span><br><span class="line">pihole    |   FTL version is v5.2 (Latest: v5.2)</span><br><span class="line">pihole    | [cont-init.d] 20-start.sh: exited 0.</span><br><span class="line">pihole    | [cont-init.d] done.</span><br><span class="line">pihole    | [services.d] starting services</span><br><span class="line">pihole    | Starting pihole-FTL (no-daemon) as root</span><br><span class="line">pihole    | Starting lighttpd</span><br><span class="line">pihole    | Starting crond</span><br><span class="line">pihole    | [services.d] done.</span><br></pre></td></tr></table></figure><ul><li>æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ <code>http://ip:port/admin</code> å³å¯è¿›å…¥ Pi-hole çš„åå°ç®¡ç†é¡µé¢ï¼Œåœ¨è¿™é‡Œå¯ä»¥æŸ¥çœ‹åˆ° DNS è§£æçš„è¯¦ç»†è®°å½•ï¼Œå…³äº Pi-hole çš„ä½¿ç”¨å¯ä»¥å‚è€ƒä¸€äº›å¤§ä½¬çš„åšå®¢ï¼Œæ¯”å¦‚ <a href="https://wzyboy.im/post/1372.html" target="_blank" rel="noopener">æ­å»º Pi-Hole ä¸ºç½‘ä¸Šå†²æµªä¿é©¾æŠ¤èˆª</a>ã€‚</li></ul><p><img src="img/20200925-pihole.png" alt=""></p><p>å¦‚æœæƒ³è¦è®©å†…ç½‘çš„æœºå™¨éƒ½èµ° Pi-hole æ¥è¿›è¡Œ DNS ï¼Œå¯ä»¥å°†è·¯ç”±å™¨çš„ DHCP çš„  DNS çš„ IP è®¾ç½®ä¸º Pi-hole çš„ IPã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://cloud.google.com/blog/products/containers-kubernetes/bringing-ebpf-and-cilium-to-google-kubernetes-engine" target="_blank" rel="noopener">New GKE Dataplane V2 increases security and visibility for containers</a></li><li><a href="https://moelove.info/2020/09/02/%E8%A2%AB-Google-%E9%80%89%E6%8B%A9%E7%9A%84%E4%B8%8B%E4%B8%80%E4%BB%A3%E6%95%B0%E6%8D%AE%E9%9D%A2-Cilium-%E6%98%AF%E4%BB%80%E4%B9%88/" target="_blank" rel="noopener">è¢« Google é€‰æ‹©çš„ä¸‹ä¸€ä»£æ•°æ®é¢ Cilium æ˜¯ä»€ä¹ˆ</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;å‰æ®µæ—¶é—´æ¡åƒåœ¾ä¸œæ‹¼è¥¿å‡‘æäº†å° Homelab ğŸ‘‡ç©ç©
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Linux" scheme="https://blog.k8s.li/tags/Linux/"/>
    
      <category term="å®¹å™¨" scheme="https://blog.k8s.li/tags/%E5%AE%B9%E5%99%A8/"/>
    
      <category term="PhotonOS" scheme="https://blog.k8s.li/tags/PhotonOS/"/>
    
  </entry>
  
  <entry>
    <title>ç»™é˜µåˆ—å¡åˆ·ä¸ªæœºï¼ŒIR æ¨¡å¼è½¬ IT æ¨¡å¼</title>
    <link href="https://blog.k8s.li/lsi-9211-4i-ir-to-it.html"/>
    <id>https://blog.k8s.li/lsi-9211-4i-ir-to-it.html</id>
    <published>2020-09-07T16:00:00.000Z</published>
    <updated>2020-09-07T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åˆ·æœºï¼Ÿ"><a href="#åˆ·æœºï¼Ÿ" class="headerlink" title="åˆ·æœºï¼Ÿ"></a>åˆ·æœºï¼Ÿ</h2><p>ä¸ä¹…å‰æ¡åƒåœ¾æäº†ä¸€å°ä½åŠŸè€— Homelab ä¸»æœºç©ç©ï¼Œç”±äºä¸»æ¿ SATA å£çš„é™åˆ¶ï¼Œä¸èƒ½ä½¿ç”¨å¤§äº 2TB çš„ç¡¬ç›˜ï¼Œå¯¹äºå’±æ¢¦æƒ³ç€è¿™ç§æ‹¥æœ‰å‡ å TB å­˜å‚¨æ¥å­˜æ”¾è€å©†çš„æ­»è‚¥å®…æ¥è¯´ï¼Œ2TB æ€ä¹ˆå¤Ÿäº†ã€‚äºæ˜¯æƒ³è¦çªç ´é™åˆ¶ï¼Œå†ç»™ Homelab ä¸»æœºå¢åŠ ä¸€å— 6TB çš„ç£ç›˜ã€‚äºæ˜¯ï¼Œåœ¨æ´‹åƒåœ¾å †é‡ŒèŠ±äº† 50 å—é’±æ¡äº†è¿™å—é˜µåˆ—å¡ğŸ‘‡ã€‚</p><p><img src="img/20200830_9211-4i-01.jpg" alt=""></p><p>ä¹°çš„è¿™å—é˜µåˆ—å¡å‹å·æ˜¯ <a href="https://lenovopress.com/tips0831-serveraid-h1110" target="_blank" rel="noopener">ServeRAID H1110 SAS/SATA Controller for IBM System x </a> ï¼Œå–å®¶è¯´æ˜¯ <code>IBM H1110</code> ï¼Œå…¶å®éƒ½å·®ä¸å¤šå•¦ã€‚ç”±äºæ˜¯ç¬¬ä¸€æ¬¡ç©å„¿é˜µåˆ—å¡ï¼Œå¯¹è¿™ç§å‹å·ä¹Ÿä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œä¹‹ååˆ·äº†æ–°çš„å›ºä»¶åˆå˜æˆäº† <code>LSI 9211-4i</code> ã€‚</p><h2 id="ç¿»è½¦ï¼Ÿ"><a href="#ç¿»è½¦ï¼Ÿ" class="headerlink" title="ç¿»è½¦ï¼Ÿ"></a>ç¿»è½¦ï¼Ÿ</h2><p>æ”¶åˆ°è´§åï¼Œè¿«ä¸åŠå¾…åœ°å°†å­˜æ»¡è€å©†çš„ç¡¬ç›˜æ¥åˆ°é˜µåˆ—å¡ä¸Šï¼Œå¼€æœºçš„æ—¶å€™ï¼Œä¸€ç›´å¡åœ¨é˜µåˆ—å¡ BIOS åˆå§‹åŒ–é¡µé¢å¾ˆä¹…å¾ˆä¹…ã€‚é¡¿æ—¶è§‰ç€ï¼Œå®Œè›‹ç¿»è½¦äº†ï¼Œæ­£å‡†å¤‡å»æ€¼ä¸€æ³¢å–å®¶ï¼Œé˜µåˆ—å¡å¯åŠ¨ç­‰äº†äº”å…­åˆ†é’Ÿåè¿›å…¥äº†ä¹…è¿çš„  ESXi çš„å¯åŠ¨é¡µé¢ã€‚è¿™å°¼ç›ï¼Œå‘æˆ‘å•Šï¼Œä½ ä¸€ä¸ªå·´æŒå¤§çš„é˜µåˆ—å¡å¯åŠ¨ç«Ÿç„¶éœ€è¦äº”åˆ†é’Ÿï¼Ÿå†…å¿ƒä¸€ä¸‡åŒ¹è‰æ³¥é©¬å¥”è…¾è€Œè¿‡ã€‚</p><p><img src="img/20200830_9211-4i-02.png" alt=""></p><h2 id="IR-æ¨¡å¼ï¼Ÿ"><a href="#IR-æ¨¡å¼ï¼Ÿ" class="headerlink" title="IR æ¨¡å¼ï¼Ÿ"></a>IR æ¨¡å¼ï¼Ÿ</h2><p>åœ¨ç½‘ä¸Šçœ‹æ¥ä¸€ä¸‹å¤§ä½¬ä»¬çš„è¯„è®ºï¼Œè¯´é˜µåˆ—å¡ IR æ¨¡å¼çš„å¯åŠ¨é€Ÿåº¦è¦æ…¢ä¸€äº›ï¼Ÿç„¶ååˆæ‰¾åˆ°äº† <a href="https://wiki2.xbits.net:4430/hardware:lsi:h1110-it-firmware" target="_blank" rel="noopener">IBM H1110å¡åˆ·ä¸ºLSI 9211-4i ITå›ºä»¶</a> ï¼Œé‡Œé¢æåˆ°çš„å¯ä»¥å°† IR æ¨¡å¼åˆ·ä¸º IT ç›´é€šæ¨¡å¼ã€‚è‡³äº IR æ¨¡å¼å’Œ IT æ¨¡å¼ï¼Œè‡ªå·±å¤ªèœæ²¡æ‰¾åˆ°ç¡®åˆ‡çš„èµ„æ–™ã€‚å¤§æ¦‚å¯ä»¥ç†è§£ä¸º IR æ¨¡å¼é€‚ç”¨äºä½¿ç”¨é˜µåˆ—å¡ç»„ RAID é˜µåˆ—ï¼Œè€Œ IT æ¨¡å¼å°±æ˜¯æ‰€è°“çš„ç›´é€šæ¨¡å¼ï¼Œä¸é€‚ç”¨ RAID ï¼Œåªä½¿ç”¨é˜µåˆ—å¡çš„ç£ç›˜æ§åˆ¶å™¨ï¼Ÿç›¸å½“äºä¸»æ¿ä¸Šçš„ SATA æ¥å£ã€‚ä½•å†µæˆ‘è¿™ä¸ªæ˜¯å°ä¸»æœºï¼Œé‡Œé¢ä¹Ÿå¡ä¸ä¸‹é‚£ä¹ˆå¤šçš„ç£ç›˜ï¼Œæ‰€ä»¥é˜µåˆ—å¡ä½¿ç”¨ IT ç›´é€šæ¨¡å¼æ— ç–‘æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚</p><p><img src="img/20200828_9211-4i-03.jpg" alt=""></p><h2 id="ä¸‡ç‰©çš†å¯åˆ·ï¼Ÿ"><a href="#ä¸‡ç‰©çš†å¯åˆ·ï¼Ÿ" class="headerlink" title="ä¸‡ç‰©çš†å¯åˆ·ï¼Ÿ"></a>ä¸‡ç‰©çš†å¯åˆ·ï¼Ÿ</h2><p>å‚ç…§å¤§ä½¬ä»¬çš„åšå®¢ï¼Œå’±ä¹Ÿè¦ä½“éªŒä¸€æŠŠåˆ·<del>æœº</del>å¡çš„ç—›å¿«äº†ï¼Œæ¯•ç«ŸæŠ˜è…¾è¿™äº›æ²¡ç”¨çš„ç©æ„å„¿ä¹Ÿæ˜¯å’±çš„ä¸€å¤§ä¹è¶£ã€‚</p><blockquote><p>  æˆ‘é’å¹´æ—¶ä»£å°±åˆ·è¿‡ï¼šè¯ºåŸºäºšã€æ‘©æ‰˜ç½—æ‹‰ã€ä¸‰æ˜Ÿã€é»‘è“ã€Lumiaã€HTCï¼Œæˆ‘è¿˜åˆ·è¿‡ï¼šè·¯ç”±å™¨ã€äº¤æ¢æœºã€é˜µåˆ—å¡ã€ç”µè§†ç›’å­â€¦â€¦</p></blockquote><p>å®‰å“<del>åŸº</del>æœºä½¬ä»¬æƒ³å¿…å¯¹ twrp å†ç†Ÿæ‚‰ä¸è¿‡äº†ï¼Œå®ƒæ˜¯æˆ‘ä»¬åˆ·æœºï¼Œåˆ·å„ç§ ROM åŒ…æœ€å¸¸ç”¨çš„ç³»ç»Ÿï¼Œç›¸å½“äº Windows ä¸­çš„ PE ç³»ç»Ÿï¼Œå¯¹ç³»ç»Ÿåˆ†åŒºåˆ·ä¸Š ROM æ¥è¾¾åˆ°åˆ·æœºçš„ç›®çš„ã€‚åˆ·é˜µåˆ—å¡çš„å›ºä»¶å’Œåˆ·æœºä¹Ÿå·®ä¸å¤šï¼Œä¹Ÿæ˜¯éœ€è¦ä¸€ä¸ªåº•å±‚çš„ç³»ç»Ÿè¿›å»å¯¹é˜µåˆ—å¡ä¸Šçš„å­˜å‚¨èŠ¯ç‰‡è¿›è¡Œæ“ä½œã€‚æœ€å¸¸è§çš„å°±æ˜¯ Dos å’Œ EFI Shell ï¼Œç”±äº Dos å¹´ä»£ä¹…è¿œï¼Œä¸”æˆ‘çš„ä¸»æ¿å¯¹ EFI æ”¯æŒæ¯”è¾ƒå‹å¥½ï¼Œåœ¨è¿›è¡Œåˆ·æœºçš„æ—¶å€™ä¸ºäº†ç¨³å¦¥èµ·è§é€‰æ‹© EFI shellã€‚</p><h3 id="è®°å½•-SAS-åœ°å€"><a href="#è®°å½•-SAS-åœ°å€" class="headerlink" title="è®°å½• SAS åœ°å€"></a>è®°å½• SAS åœ°å€</h3><p>åœ¨åˆ·é˜µåˆ—å¡ä¹‹å‰è¦çº¿è®°å½•ä¸‹ SAS çš„ Address ï¼Œè¿›å…¥åˆ°é˜µåˆ—å¡çš„ BIOS ä¸­ä¼šæœ‰è¿™ä¸ªä¿¡æ¯ã€‚</p><h3 id="æ‰¾å¥½å›ºä»¶å’Œæ–‡æ¡£"><a href="#æ‰¾å¥½å›ºä»¶å’Œæ–‡æ¡£" class="headerlink" title="æ‰¾å¥½å›ºä»¶å’Œæ–‡æ¡£"></a>æ‰¾å¥½å›ºä»¶å’Œæ–‡æ¡£</h3><p>ç”±äºæˆ‘è¦åˆ·å…¥çš„å›ºä»¶ä¸æ˜¯é˜µåˆ—å¡åŸå‚çš„å›ºä»¶ï¼Œåªæ‰¾åˆ°äº†ç°æˆçš„å›ºä»¶ï¼Œç›´æ¥å°±æ‹¿æ¥ç”¨äº†ï¼Œåº”è¯¥é—®é¢˜ä¸å¤§ã€‚è€Œä¸”åˆ·å…¥çš„æµç¨‹ä¹Ÿæ˜¯æ¯”è¾ƒç®€ç­”ã€‚<a href="https://wiki2.xbits.net:4430/hardware:lsi:h1110-it-firmware" target="_blank" rel="noopener">IBM H1110å¡åˆ·ä¸ºLSI 9211-4i ITå›ºä»¶</a> :</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¤‡ä»½åŸå¡ä¿¡æ¯å’Œsbr</span></span><br><span class="line">MegaCli.exe -AdpAllInfo -aAll -ApplogFile bak.txt</span><br><span class="line">MegaRec.exe -readsbr 0 orig.sbr</span><br><span class="line"><span class="meta">#</span><span class="bash">æ“¦å†™sbrå’Œflashä¸€éèƒ½åˆ·å…¥LSIåŸå‚å›ºä»¶</span></span><br><span class="line">MegaRec -writesbr 0 sbrempty.bin</span><br><span class="line">MegaRec -cleanflash 0</span><br><span class="line"><span class="meta">#</span><span class="bash">é‡å¯å†æ¬¡è¿›å…¥DOS</span></span><br><span class="line">reboot</span><br><span class="line"><span class="meta">#</span><span class="bash">åˆ·å…¥å¯¹åº”ITå›ºä»¶å’ŒROM</span></span><br><span class="line">sas2flsh -o -f 2114it.bin -b mptsas2.rom</span><br><span class="line"><span class="meta">#</span><span class="bash">æ¢å¤åŸæ¥çš„SASåœ°å€</span></span><br><span class="line">sas2flsh -o -sasadd xxxxxxxx</span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹æœ€æ–°çŠ¶æ€</span></span><br><span class="line">sas2flsh -list</span><br><span class="line"><span class="meta">#</span><span class="bash">é‡å¯ï¼Œå®Œæˆ</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><p>ä¸€äº›å®˜æ–¹çš„æ–‡æ¡£<a href="https://www.broadcom.cn/support/knowledgebase/1211161495925/flash-upgrading-firmware-on-lsi-sas-hbas-upgraded-firmware-on-92" target="_blank" rel="noopener">Flash upgrading firmware on LSI SAS HBAs; Upgraded firmware on 9211-8i to P8, now duplicated drives</a>ï¼š</p><blockquote><p>  Advanced users:</p><p>  To delete the firmware and BIOS in your 9211, then reflash it, follow these steps:</p><ol><li><p>Check to see if there is an also an onboard SATA controller with disk in the system before running the commands below.<br>Run sas2flsh -listall<br>If you see only the 9211, then run the commands as shown below.<br>If you see two controllers (e.g. c0 and c1, then add -c 1 to all of the commands belowâ€“&gt; sas2flsh -c 1 -o -e 6</p></li><li><p>Record the SAS address of the 9211 in case you need it later.  To display it, type:<br>sas2flsh -list</p><p>and write down the SAS address.  You can run the is DOS, Windows, Linux, etc.</p></li><li><p>Download 9211_8i_Package_for_P9_Firmware_BIOS_on_MSDOS_and_Windows.zip for the 9211-8i</p></li><li><p>Boot to DOS (create a DOS bootable USB stick from <a href="http://www.bootdisk.com" target="_blank" rel="noopener">http://www.bootdisk.com</a> or <a href="http://www.gocoding.com" target="_blank" rel="noopener">www.gocoding.com</a>).</p></li><li><p>Run from DOS sas2flsh -o -e 6 (this will erase the controller firmware and BIOS).</p></li><li><p>Turn the system off.</p></li><li><p>Turn the system on and boot to DOS (note:  the BIOS wonâ€™t post, as you will reflash it in step 8 below).</p></li><li><p>Run from DOS, with files sas2flsh.exe, the .bin and .rom files in the same directory:</p><p>For IR firmware:  sas2flsh -f 9211IRP9.bin -b mptsas2.rom<br>For IT firmware:  sas2flsh -f 9211itp9.bin -b mptsas2.rom</p><p>Note:  you will need to rename 9211-8i_IR_P9.bin to 9211IRP9.bin and 9211-8i-IT_ph9.bin to 9211itp9.bin</p></li><li><p>The controller will now work normally, with the P9 firmware and BIOS.</p></li><li><p>Check to make sure you have a SAS address:<br>sas2flsh -list<br>If you see the same SAS address that you had in step 2, then you are done.<br>If you donâ€™t see the same SAS address, or you donâ€™t see a SAS address, type:<br>sas2flsh -o -sasadd <SAS address></p></li></ol></blockquote><p>ä¸Šé¢æåˆ°çš„éƒ½æ˜¯åŸºäº Dos ç³»ç»Ÿä¸Šæ“ä½œçš„ï¼Œä¸è¿‡æˆ‘è¯•äº†ä¸€ä¸‹éƒ½ç¿»è½¦äº†ğŸ¤£</p><h3 id="åˆ¶ä½œ-EFI-shell-ç³»ç»Ÿ"><a href="#åˆ¶ä½œ-EFI-shell-ç³»ç»Ÿ" class="headerlink" title="åˆ¶ä½œ EFI shell ç³»ç»Ÿ"></a>åˆ¶ä½œ EFI shell ç³»ç»Ÿ</h3><p>å¦‚æœä¸»æ¿æ”¯æŒ EFI çš„è¯ï¼Œå»ºè®®ä½¿ç”¨ EFI shell åˆ·å…¥å›ºä»¶ï¼Œåœ¨ Dos ä¸‹ä¼šæœ‰äº›å¥‡æ€ªçš„é—®é¢˜ã€‚</p><p>æŒ‰ç…§ <a href="https://superuser.com/questions/1057446/how-do-i-boot-to-uefi-shell" target="_blank" rel="noopener">How do I â€œBoot to UEFI shellâ€?</a> ä¸­æåˆ°çš„ï¼š</p><blockquote><p>It depends on whether your UEFI has a shell builtin. If it does, there should be an option in its settings / boot menu for you to launch it. Some motherboard also provide an option to launch a shell from the EFI System Partition (ESP). You should consult the manual of your motherboard for the path it will look for (the instruction is often vague though). Usually they are looking for a file named <code>Shell.efi</code> in the ESP root folder.</p><p>Another way is to launch it just like you launch any other EFI binary (e.g. bootloader). Since itâ€™s not really accessible to register a EFI binary to your UEFI or put the shell binary to your ESP in Windows, so the easiest way is probably to put it as <code>\EFI\Boot\bootx64.efi</code> <strong>(also put the <code>update.nsh</code> you need to run and the files it requires under <code>\EFI\Boot\</code>)</strong> in a FAT(32)-formatted USB drive (It shouldnâ€™t matter whether itâ€™s MBR or GPT as long as your UEFI is standard-conforming enough). <strong>Then reboot and boot the USB in UEFI mode from your UEFI boot menu.</strong></p><p>You can obtain the EFI shell binary from the EDK2 project repo:</p><ul><li><p><a href="https://github.com/tianocore/edk2/releases/download/edk2-stable202002/ShellBinPkg.zip" target="_blank" rel="noopener">version 2</a></p></li><li><p><a href="https://github.com/tianocore/edk2/blob/UDK2018/EdkShellBinPkg/FullShell/X64/Shell_Full.efi?raw=true" target="_blank" rel="noopener">version 1 (no longer updated, only for old UEFI that does not work with v2)</a></p><p>(<strong>Note:</strong> some older EFI tools like [sas2flash.efi](<a href="https://www.broadcom.com/site-search?q=Installer" target="_blank" rel="noopener">https://www.broadcom.com/site-search?q=Installer</a> for UEFI) only work with such an old EFI shell (which works on current mainboards with current UEFI))</p></li></ul></blockquote><p>é¦–å…ˆéœ€è¦ä¸€ä¸ª U ç›˜ï¼Œå¯¹å®¹é‡æ²¡æœ‰é—²ç½®ï¼Œå‡ åå…†è¶³å¤Ÿï¼ŒæŠŠåˆ†åŒºæ ¼å¼åŒ–ä¸º FAT32 æ–‡ä»¶ç³»ç»Ÿæ ¼å¼ï¼Œç„¶åä¸‹è½½ä¸€ä¸ª EFI shell çš„ efi æ–‡ä»¶ <a href="https://github.com/tianocore/edk2/blob/UDK2018/EdkShellBinPkg/FullShell/X64/Shell_Full.efi?raw=true" target="_blank" rel="noopener">version 1 </a>ï¼ŒæŠŠè¯¥æ–‡ä»¶ä¿å­˜åœ¨ FAT32 åˆ†åŒºä¸‹çš„ <code>\EFI\Boot\bootx64.efi</code> è·¯å¾„ä¸‹ã€‚</p><blockquote><p>  Download from Github Tianocore the precompiled UEFI version 1 Shell: <a href="https://github.com/tianocore/edk2/tree/master/EdkShellBinPkg/FullShell/X64" target="_blank" rel="noopener">Shell_Full.efi</a>. (Only v1 is applicable, later versions are not compatible with the flash tool and end up with the message: â€œInitShellApp: Application not started from Shellâ€.)</p></blockquote><p>ç”±äºåˆ·å›ºä»¶çš„å·¥å…· <code>sas2flash.efi</code> åªå’Œ EFI shell v1 ç‰ˆæœ¬çš„å…¼å®¹ï¼Œæˆ‘ç¬¬ä¸€æ¬¡åˆ·çš„æ—¶å€™æ—¶ä½¿ç”¨çš„ v2 ç‰ˆæœ¬ï¼Œæç¤º <code>â€œInitShellApp: Application not started from Shellâ€</code> é”™è¯¯ğŸ˜‚</p><p>ç„¶åè¿˜éœ€è¦æŠŠå›ºä»¶ <code>2114it.bin</code> ï¼Œä»¥åŠåˆ·å›ºä»¶ç”¨åˆ°çš„å·¥å…· <code>sas2flash.efi</code> æ”¾å…¥åˆ° FAT32 è·Ÿç›®å½•ä¸‹ï¼Œå…¶ä¸­å›ºä»¶æ ¹æ®é˜µåˆ—å¡çš„å‹å·ä¸åŒéœ€è¦è‡ªè¡Œæ‰¾åˆ°ç›¸åº”çš„å›ºä»¶ç‰ˆæœ¬ï¼Œæˆ‘è¿™ä¸ªè™½ç„¶æ˜¯ IBM H1110 å‹å·çš„ï¼Œä½†æ˜¯å¯ä»¥åˆ·æˆ LSI 9211 çš„ï¼Œæ‰€ä»¥å°±æ²¡å»æ‰¾åŸå‚çš„å›ºä»¶ã€‚</p><h3 id="è¿›å…¥-EFI-shell-åˆ·å…¥æ–°çš„å›ºä»¶"><a href="#è¿›å…¥-EFI-shell-åˆ·å…¥æ–°çš„å›ºä»¶" class="headerlink" title="è¿›å…¥ EFI shell åˆ·å…¥æ–°çš„å›ºä»¶"></a>è¿›å…¥ EFI shell åˆ·å…¥æ–°çš„å›ºä»¶</h3><p>ä» <a href="https://www.ixsystems.com/community/threads/how-to-flash-lsi-9211-8i-using-efi-shell.50902/" target="_blank" rel="noopener">How-to: Flash LSI 9211-8i using EFI shell</a> å¤§ä½¬é‚£é‡Œå¤åˆ¶ç²˜è´´è¿‡æ¥çš„çš„æ•™ç¨‹ï¼š</p><blockquote><ol><li>Insert the controller card in a PCIe slot. (Iâ€™ve used the slot Nr. 3. In case of troubles recognizing the card in your desktop PC try different slots.)</li><li>Boot the PC and prepare the USB stick:</li><li>In the USB stick create and format a FAT or FAT32 partition &gt;= 10 MB. (Iâ€™ve created 500 MB FAT32 partition. I wouldnâ€™t recommend large partitions, who knows if the EFI shell will read every big partition.)</li><li>Create the sub-folders for EFI boot. In the web there are two different structures: <code>/boot/efi</code> and <code>/efi/boot</code>. For time saving Iâ€™ve created both groups, it works.</li><li>Download from Broadcom following packages: <a href="https://docs.broadcom.com/docs/12350820" target="_blank" rel="noopener">Installer_P20_for_UEFI</a> and <a href="https://docs.broadcom.com/docs/12350530" target="_blank" rel="noopener">9211-8i_Package_P20_IR_IT_Firmware_BIOS_for_MSDOS_Windows</a> and extract them on your PCâ€™s HDD.</li><li>Copy from the downloaded packages three files to the USB stick root folder:</li><li>from the first package the file <code>sas2flash.efi</code> (it is in sub-folder <code>/sas2flash_efi_ebc_rel/</code>);</li><li>from the second package: <code>2118it.bin</code> (it is in sub-folder <code>/Firmware/HBA_9211_8i_IT/</code>) and <code>mptsas2.rom</code> (it is in sub-folder <code>/sasbios_rel/</code>).</li><li>Download from Github Tianocore the precompiled UEFI version 1 Shell: <a href="https://github.com/tianocore/edk2/tree/master/EdkShellBinPkg/FullShell/X64" target="_blank" rel="noopener">Shell_Full.efi</a>. (Only v1 is applicable, later versions are not compatible with the flash tool and end up with the message: â€œInitShellApp: Application not started from Shellâ€.)</li><li>Rename the <code>Shell_Full.efi</code> in <code>ShellX64.efi</code> and copy this file to following three USB stick destinations: root folder, <code>/boot/efi/</code>, <code>/efi/boot/</code>. (Again, there are different advices, for time saving it easier to use all three choices.)</li><li>The creative part is completed, itâ€™s time for action. Restart the PC and enter the BIOS. If you use ASUS UEFI BIOS Utility in advanced mode, mouse click on the Exit (not by using keyboard â€œEscâ€), in the next dialog select â€œLaunch EFI Shell from filesystem deviceâ€. Other BIOS should behave similarly.</li><li>Next you should see starting shell execution, ending with a prompt: â€œShell&gt;â€ (not the â€œ2.0 Shell&gt;â€!).</li><li>Type the command: <code>map â€“b</code> (+Enter) for listing of available disks. Locate which one is your USB stick. In my case it is the fs6:<br>â€œfs6 :Removable HardDisk - â€¦ USB(â€¦)â€</li><li>You can break further execution of the map command by <code>q</code>.</li><li>Switch to the located USB stick by command <code>fsN:</code> (+Enter) (N=6 â€“ in my example = â€œfs6:â€, set N to your USB stick ID).</li><li><code>Dir</code> shows the file list:<br>2118IT.BIN<br>MPTSAS2.ROM<br>sas2flash.efi<DIR> BOOT<DIR> EFIShellX64.efi</li><li>The action can start. During it the power shall not be brocken!</li><li>Erase the controller flash memory: <code>sas2flash.efi -o -e 6</code>.</li><li>Write the new firmware to the flash: <code>sas2flash.efi -o -f 2118it.bin -b mptsas2.rom</code>.</li><li>After a while youâ€™ll see the success message. You can restart the PC and check if the controller BIOS reports the new â€œITâ€-firmware.</li><li>The card is ready to use.</li></ol></blockquote><ul><li>ä½¿ç”¨ <code>map -b</code> å‘½ä»¤æŸ¥çœ‹ U ç›˜çš„è·¯å¾„ï¼Œä¸€èˆ¬ä¸º <code>fsX</code> ç„¶åæŒ‰ä¸‹ <code>fs0:</code> è·¯å¾„å°±åˆ‡æ¢åˆ°äº† U ç›˜çš„ FAT32 åˆ†åŒºä¸‹ã€‚</li></ul><p><img src="img/20200828_9211-4i-04.jpg" alt=""></p><ul><li>ç„¶åä½¿ç”¨ <code>sas2flash.efi -o -e 6</code> å‘½ä»¤æ¸…ç©ºé˜µåˆ—å¡çš„  <code>flash memory</code>ã€‚</li><li>æ¥ç€ä½¿ç”¨ <code>sas2flsh -o -f 2114it.bin -b mptsas2.rom</code> å‘½ä»¤åˆ·å…¥æ–°çš„å›ºä»¶ã€‚</li></ul><p><img src="img/20200828_9211-4i-05.jpg" alt=""></p><ul><li>æ¢å¤ SAS åœ°å€ <code>sas2flsh -o -sasadd xxxxxxxx</code> </li></ul><p>æ“ä½œå®Œä»¥ä¸Šæ­¥éª¤åå°±å¯ä»¥é‡å¯äº†</p><h2 id="IT-æ¨¡å¼ï¼Ÿ"><a href="#IT-æ¨¡å¼ï¼Ÿ" class="headerlink" title="IT æ¨¡å¼ï¼Ÿ"></a>IT æ¨¡å¼ï¼Ÿ</h2><p>åˆ·å®Œä¹‹åé˜µåˆ—å¡çš„å‹å·å°±è«åå…¶å¦™åœ°å˜æˆäº† <code>LSIÂ® SAS 9211-4i PCI ExpressÂ® to 6Gb/s Serial Attached SCSI (SAS) Host Bus Adapter</code> ï¼Œå›ºä»¶çš„ç‰ˆæœ¬ä¹Ÿå˜æˆäº†  IT æ¨¡å¼ï¼Œå¼€æœºçš„é€Ÿåº¦æ¯”ä»¥å‰å¿«äº†å¾ˆå¤šï¼Œåªéœ€è¦ä¸åˆ° 5s å°±è‡ªæ£€å®Œæˆè¿›å…¥ ESXi çš„å¯åŠ¨æµç¨‹ï¼Œç»ˆäºå‘Šåˆ«åŸå…ˆçš„é¾Ÿé€Ÿå¯åŠ¨äº†ã€‚</p><p><img src="img/20200828_9211-4i-06.jpg" alt=""></p><p>åœ¨ ESXi ä¸­ï¼Œé˜µåˆ—å¡ä¹Ÿè¢«è¯†åˆ«ä¸ºäº† <code>LSI2004</code> ï¼Œçœ‹æ¥æ˜¯æ²¡é—®é¢˜äº†ï¼Œæ’ä¸Šç¡¬ç›˜ä¹Ÿéƒ½æ˜¯è¯†åˆ«å‡ºæ¥äº†ã€‚</p><p><img src="img/20200908_9211-4i-07.png" alt=""></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>ç”±äºæ˜¯æ˜¯ç¬¬ä¸€æ¬¡ç»™é˜µåˆ—å¡åˆ·å›ºä»¶ï¼Œåœ¨ç½‘ä¸Šæ‰¾åˆ°äº†å†™èµ„æ–™å¯ä»¥åšå‚è€ƒã€‚</p><ul><li><a href="https://wiki2.xbits.net:4430/hardware:lsi:h1110-it-firmware" target="_blank" rel="noopener">IBM H1110å¡åˆ·ä¸ºLSI 9211-4i ITå›ºä»¶</a></li><li><a href="https://www.tfir.io/easiest-way-to-flash-lsi-sas-9211-8i-on-motherboards-without-efi-shell/" target="_blank" rel="noopener">Easiest Way To Flash LSI SAS 9211-8i on Motherboards without EFI Shell</a></li><li><a href="https://www.broadcom.cn/support/knowledgebase/1211161495925/flash-upgrading-firmware-on-lsi-sas-hbas-upgraded-firmware-on-92" target="_blank" rel="noopener">Flash upgrading firmware on LSI SAS HBAs; Upgraded firmware on 9211-8i to P8, now duplicated drives</a></li><li><a href="chrome-extension://ikhdkkncnoglghljlkmcimlnlhkeamad/pdf-viewer/web/viewer.html?file=https%3A%2F%2Fdocs.broadcom.com%2Fdoc%2F12353332">LSIÂ® SAS 9211-4i PCI ExpressÂ® to 6Gb/s Serial Attached SCSI (SAS) Host Bus Adapter </a></li><li><a href="https://www.ixsystems.com/community/threads/how-to-flash-lsi-9211-8i-using-efi-shell.50902/" target="_blank" rel="noopener">How-to: Flash LSI 9211-8i using EFI shell</a></li><li><a href="https://github.com/bsodmike/s5clouds8-lsi9211-8i-IR-to-IT-EFI-bootable-usb" target="_blank" rel="noopener">s5clouds8-lsi9211-8i-IR-to-IT-EFI-bootable-usb</a></li><li><a href="https://superuser.com/questions/1057446/how-do-i-boot-to-uefi-shell" target="_blank" rel="noopener">How do I â€œBoot to UEFI shellâ€?</a></li><li><a href="https://forums.laptopvideo2go.com/topic/29059-sas2008-lsi92409211-firmware-files/" target="_blank" rel="noopener">SAS2008 (LSI9240/9211) Firmware files</a></li><li><a href="https://www.servethehome.com/ibm-serveraid-m1015-part-4/" target="_blank" rel="noopener">IBM ServeRAID M1015 Part 4: Cross flashing to a LSI9211-8i in IT or IR mode</a></li><li><a href="https://web.archive.org/web/20200423162708/http://brycv.com/blog/2012/flashing-it-firmware-to-lsi-sas9211-8i/" target="_blank" rel="noopener">Flashing IT Firmware to the LSI SAS9211-8i HBA</a></li><li><a href="https://forum.openmediavault.org/index.php?thread/2310-ibm-m1015-ir-vs-it/" target="_blank" rel="noopener">IBM M1015 - IR vs. IT</a></li><li><a href="https://marcan.st/2016/05/crossflashing-the-fujitsu-d2607/" target="_blank" rel="noopener">Crossflashing the Fujitsu D2607</a></li><li><a href="https://kc.mcafee.com/corporate/index?page=content&id=KB90801&locale=en_US" target="_blank" rel="noopener">How to create a bootable USB media to access the default EFI shell</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;åˆ·æœºï¼Ÿ&quot;&gt;&lt;a href=&quot;#åˆ·æœºï¼Ÿ&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="åˆ·æœº" scheme="https://blog.k8s.li/tags/%E5%88%B7%E6%9C%BA/"/>
    
      <category term="é˜µåˆ—å¡" scheme="https://blog.k8s.li/tags/%E9%98%B5%E5%88%97%E5%8D%A1/"/>
    
  </entry>
  
  <entry>
    <title>åƒåœ¾ä½¬çš„ Homelab æŠ˜è…¾è®°å½•</title>
    <link href="https://blog.k8s.li/homelab.html"/>
    <id>https://blog.k8s.li/homelab.html</id>
    <published>2020-08-20T16:00:00.000Z</published>
    <updated>2020-09-15T00:28:09.964Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ¡åƒåœ¾"><a href="#æ¡åƒåœ¾" class="headerlink" title="æ¡åƒåœ¾"></a>æ¡åƒåœ¾</h2><p>æ¥è‡ª <a href="https://space.bilibili.com/1292029" target="_blank" rel="noopener">@awpak78 </a>çš„å›¾ğŸ‘‡</p><p><img src="img/20200801_150112.jpg" alt="20200801_150112"></p><p>ä½œä¸ºä¸€åè¿ç»´å·¥ç¨‹å¸ˆï¼Œç™½å¤©åœ¨å·¥åœ°ä¸Šæ¬ç –å…»å®¶ç³Šå£ï¼Œæ™šä¸Šä¸‹ç­å›å®¶åå°±å¼€å§‹æŠ˜è…¾ä¸€å †ç ´é“œçƒ‚é“è‡ªå¨±è‡ªä¹ğŸ˜‚ã€‚æœ€è¿‘ä¸œæ‹¼è¥¿å‡‘èŠ±äº† 2000 æ¥å—é’±æ¡åƒåœ¾æ•´äº†å° HomeLab ç©ç©ï¼ŒæŠ˜è…¾ä¸€äº›æ²¡ç”¨çš„ä¸œè¥¿ğŸ™ƒ</p><p>å…¶å®å¾ˆæ—©ä¹‹å‰å°±æƒ³æä¸€å°ä½åŠŸè€—çš„ HomeLab ä¸»æœºç©å„¿äº†ï¼Œæœ€æ—©å¼€å§‹é€‰æ‹©çš„æ˜¯ Dell T1700 SFF + E3-1271V3 +32GB DDR3ï¼Œä½†æ˜¯å‘¢ï¼ŒE3 V3 ç³»åˆ—æ˜¯ Intel ç¬¬å››ä»£  CPU ï¼Œ1150 èŠ¯ç‰‡ç»„æ— æ³•ä» M.2 å¯åŠ¨ï¼Œç£ç›˜é€Ÿåº¦åªèƒ½è¾¾åˆ° SATA III ä¹Ÿå°±æ˜¯é¡¶å¤š 600 MB/s çš„è¯»å†™é€Ÿåº¦ï¼Œè€Œç›®å‰éšä¾¿ä¸€å—æ”¯æŒ  PCI-e M.2 NVMe çš„ä¸»æ¿æ™®ééƒ½èƒ½è¾¾åˆ° 3000MB/s äº†ã€‚æ‰€ä»¥è¿™ä¸€ç‚¹æ¥è®² E3 V3 å·²ç»ä¸å€¼å¾—æ¡äº†ã€‚è€Œä¸”æˆ‘æƒ³æŠŠæˆ‘å°å¼æœºä¸Š SN750 500GB æ¢åˆ°è¿™å°æœºå™¨ä¸Šï¼Œæ‰€ä»¥è¿˜æ˜¯è¦é€‰æ‹©ä¸€ä¸ªæ”¯æŒ PCI-e M.2 NVMe çš„ä¸»æ¿ã€‚</p><table><thead><tr><th align="center">ç¡¬ä»¶</th><th>é…ç½®</th><th align="center">ä»·æ ¼</th></tr></thead><tbody><tr><td align="center">CPU</td><td>Intel(R) Core(TM) i5-6600T CPU @ 2.70GHz 35w</td><td align="center">480</td></tr><tr><td align="center">ä¸»æ¿</td><td>Dell OptiPlex 7040 å‡†ç³»ç»Ÿï¼šIntel Â®Q170</td><td align="center">400</td></tr><tr><td align="center">å†…å­˜</td><td>é•å…‰ DDR4 16GB 2666MHz</td><td align="center">310</td></tr><tr><td align="center">æ˜¾å¡</td><td>è‹±ç‰¹å°”Â® æ ¸èŠ¯æ˜¾å¡ 530</td><td align="center">0</td></tr><tr><td align="center">æœºç®±</td><td>Dell OptiPlex 7040 å‡†ç³»ç»Ÿ</td><td align="center">0</td></tr><tr><td align="center">ç”µæº</td><td>Dell OptiPlex 7040 å‡†ç³»ç»Ÿï¼š290W å¼€å…³ç”µæº</td><td align="center">0</td></tr><tr><td align="center">UPS</td><td>æŸæ‚ç‰Œ UPS 650VA360W</td><td align="center">160</td></tr><tr><td align="center">å›ºæ€</td><td>ä¸‰æ˜Ÿ 970PRO 512GB</td><td align="center">820</td></tr><tr><td align="center">æ€»ä»·</td><td></td><td align="center">2170</td></tr></tbody></table><h3 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h3><p>è‡³äº 6600T çš„æ€§èƒ½ï¼Œåœ¨ 500 å—é’±çš„ä»·ä½å†… 35Wä½åŠŸè€—çš„ 6600T è¿˜ç®—å¯ä»¥èƒ½æ¥å—ï¼Œä¸ºä»€ä¹ˆä¸ä¹° 7200U è¿™ç§ä½å‹ U å‘¢ï¼Ÿï¼Œä¸€æ˜¯ä½å‹ U çš„è£…æœºæˆæœ¬å¤ªé«˜ï¼Œè€Œä¸”æ€§ä»·æ¯”å¾ˆä½ï¼Œæˆ‘è¿˜è¦åœ¨ä¸Šé¢è·‘ä¸€å †è™šæ‹Ÿæœºï¼Œä½å‹ U ææ€•æ‰›ä¸ä½ï¼Œæ‰€ä»¥ä¸€å¼€å§‹å°±æ”¾å¼ƒäº†ä½å‹ U çš„è£…æœºæ–¹æ¡ˆã€‚</p><p><img src="img/HomeLab-1.jpg" alt=""></p><h3 id="ä¸»æ¿"><a href="#ä¸»æ¿" class="headerlink" title="ä¸»æ¿"></a>ä¸»æ¿</h3><p>ç”±äº Dell SFF ç³»åˆ—çš„æœºç®±æ˜¯å®šåˆ¶çš„ï¼Œå’Œæ™®é€šçš„ä¸»æ¿ä¸å¤ªä¸€æ ·ï¼Œä¹Ÿåªæœ‰è¿™æ ·æ‰èƒ½å¡è¿›è¿™ä¹ˆå°çš„ç©ºé—´ï¼Œå¯¹äº MFF ç³»åˆ—çš„åˆ™æ›´å°ä¸€ç‚¹ã€‚å¯¹äºè¿™ç§å°æœºç®±è€Œè¨€ï¼Œæ‹¥æœ‰ 2ä¸ª PCI-e*4 å’Œä¸€ä¸ª PIC-e*16 æ˜¯ç›¸å½“ä¸é”™äº†ï¼ŒPCI-e*4å¯ä»¥è£…ä¸€ä¸ªé˜µåˆ—å¡ä¸ªä¸€ä¸ªå››ç½‘å£çš„ç½‘å¡ï¼ŒPIC-e*16åˆå¯ä»¥è£…ä¸€ä¸ªä½åŠŸè€—çš„åˆ€å¡æ˜¾å¡ã€‚ç­‰åˆ°ä»¥åå°å¼æœºå‡çº§çš„ç¡¬ä»¶çš„æ—¶å€™å†æŠŠå°å¼æœºä¸Šçš„ GT1030 äº®æœºå¡æ”¾ä¸Šå»ã€‚ä¸‰ä¸ª SATA ä¸€ä¸ª M.2 æœ‰ç‚¹æ‰è¥Ÿè§è‚˜ï¼Œæœºç®±ç©ºé—´å°±é‚£ä¹ˆç‚¹ï¼Œå£å­å¤šäº†ç¡¬ç›˜ä¹Ÿå¡ä¸ä¸‹å‘€ğŸ˜‚ã€‚</p><table><thead><tr><th>Model:</th><th><a href="https://www.dell.com/support/manuals/us/en/04/optiplex-7040-desktop/opti7040_sff_om/specifications?guid=guid-f058d593-d332-479e-9d55-6c6031fa6cba&lang=en-us" target="_blank" rel="noopener"><em>Dell OptiPlex 7040 SFF</em></a></th></tr></thead><tbody><tr><td>Form factor:</td><td>Small Form Factor</td></tr><tr><td>CPU options:</td><td>Intel Gen6 i3/i5/i7</td></tr><tr><td>Chipset:</td><td><a href="https://ark.intel.com/content/www/us/en/ark/products/90587/intel-q170-chipset.html" target="_blank" rel="noopener">Intel Q170</a></td></tr><tr><td>RAM slots:</td><td>(4x) DIMM DDR4-2133</td></tr><tr><td>Max RAM:</td><td>64 GB</td></tr><tr><td>USB Ports:</td><td>(6x) USB3.0; (4x) USB2.0;</td></tr><tr><td>Video Ports:</td><td>(2x) Display Port 1.2; HDMI 1.4;</td></tr><tr><td>Other Ports:</td><td>Serial; (2x) PS2; RJ45; Headset; Line-Out;</td></tr><tr><td>Optional Ports:</td><td>VGA; Media Card Reader;</td></tr><tr><td>SATA:</td><td>(3x) SATA 3.0*</td></tr><tr><td>PCIe:</td><td>PCIe 3.0 x16 (low profile); PCIe 3.0 x4 (low profile);</td></tr><tr><td>M.2 slots:</td><td>M.2 2280 M-key (PCIe 3.0 x4, SATA 3.0)</td></tr><tr><td>Drive bays:</td><td>3.5-inch/(2x)2.5-inch; 5.25-inch (slim);</td></tr><tr><td>Hard Drive:</td><td>max 2TB; RAID 0 &amp; 1;</td></tr><tr><td>PSU:</td><td>180 W</td></tr><tr><td>Weight:</td><td>6.00 kg (13.22 lb)</td></tr></tbody></table><ul><li>ä» <a href="https://www.hardware-corner.net/guides/difference-optiplex-3040-vs-5040-vs-7040/" target="_blank" rel="noopener">The difference between Dell OptiPlex 3040 vs. 5040 vs. 7040</a> å·æ¥çš„ä¸€å¼ å›¾ç‰‡ğŸ‘‡</li></ul><p><img src="img/OptiPlex_5040SFF_motherboard.jpg" alt="img"></p><h3 id="å†…å­˜"><a href="#å†…å­˜" class="headerlink" title="å†…å­˜"></a>å†…å­˜</h3><p>ä¸¤æ¡ 8GB DDR4 å†…ä»ä»æˆ‘å°å¼æœºä¸Šæ‹†ä¸‹æ¥çš„ï¼ŒåˆèŠ±äº† 300 å—é’±ä¹°äº†ä¸ªé•å…‰çš„ 16GB DDR4 è£…äº†ä¸Šå»ï¼Œè¿«äº æˆ‘çš„å°å¼æœº B350M-K çš„ç¼©æ°´æ¿åªæœ‰ä¸¤ä¸ªå†…å­˜æ’æ§½è€Œä¸”æ”¯æŒåˆ° 32GBï¼Œæš‚æ—¶è£…ä¸€ä¸ª 16GB çš„å§ï¼Œèƒ½ä»¥åå†è£…ä¸€ä¸ªä¸Šå»ã€‚</p><h3 id="å›ºæ€"><a href="#å›ºæ€" class="headerlink" title="å›ºæ€"></a>å›ºæ€</h3><p>å…¶å®æœ¬æ¥çš„é¢„ç®—ä¸‰æ˜Ÿ 970PRO 512GBæ²¡æ‰“ç®—ä¹°ï¼Œæ˜¯æˆ‘åœ¨æ‰¾ Dell OptiPlex 7040 æ—¶æ„å¤–ç¢°åˆ°çš„ä¸€ä¸ªè€å“¥ï¼Œè€Œä¸”è¿™å—å›ºæ€æ˜¯å¾·äºšçš„ï¼Œè¿˜ç®—é è°±ä¸€äº›ï¼Œäºæ˜¯å‰æ‰‹ä¹°äº†è¿™ä¸ªå—å›ºæ€ã€‚970PRO ç³»åˆ—çš„éƒ½æ˜¯ MLC çš„é¢—ç²’çš„å›ºæ€ç¡¬ç›˜ï¼Œé€š SM961 ä¸€æ ·æ˜¯å±äºä¼ å®¶å®ç³»åˆ—ğŸ˜‚ï¼Œä½†æ˜¯ SM961 æ·˜å®ä¸Šæ°´å¤ªæ·±ï¼Œæ¸…é›¶ç›˜å æ®å¤šæ•°ï¼Œæ‰€ä»¥ä¸å»ºè®®ä¹°ã€‚</p><p>æ­£å¥½æŠŠè¿™å— 970PRO æ¢åˆ°æˆ‘çš„å°å¼æœºä¸Šï¼ŒæŠŠå°å¼æœºä¸Šçš„ SN750 512GB æ¢åˆ° HomeLab æœºå™¨ä¸Šï¼Œç»™ ESXi ä¸Šçš„è™šæ‹Ÿæœºç”¨ã€‚åœ¨ç©å„¿è™šæ‹ŸåŒ–çš„æ—¶å€™æ·±æœ‰æ„Ÿè§¦ï¼Œå®¿ä¸»æœºçš„ç£ç›˜æ˜¯æœºæ¢°ç¡¬ç›˜çš„è¯ï¼Œä¸Šé¢çš„è™šæ‹Ÿæœºè¾¾åˆ°ä¸€å®šæ•°é‡æ—¶ï¼Œè™šæ‹Ÿæœºä¼šå¾ˆå¡ï¼Œæ‰€ä»¥ç© ESXi è™šæ‹ŸåŒ–ï¼Œæœ‰å—å›ºæ€çš„ä½“éªŒæ˜¯éå¸¸çˆ½æ»´ğŸ˜‹ã€‚</p><h2 id="è£…æœº"><a href="#è£…æœº" class="headerlink" title="è£…æœº"></a>è£…æœº</h2><p>å…¶å®è£…æœºå¾ˆå¿«ï¼Œç”±äºæ˜¯ä¹°çš„ Dell OptiPlex 7040 å‡†ç³»ç»Ÿï¼Œæ‰€ä»¥åªéœ€è¦æŠŠ CPU ã€å†…å­˜ã€ç¡¬ç›˜è£…ä¸Šå»å°±å®Œäº‹å„¿äº†ã€‚</p><p>æ”¶åˆ°å‡†ç³»ç»Ÿåå‘ç°æ²¡æœ‰å¸¦ M.2 èºä¸ï¼Œåªèƒ½ä¸´æ—¶æ‹¿èƒ¶å¸¦ç²˜ç³Šä¸Šå»ï¼Œå‹‰å¼ºæ’‘äº†ä¸¤å¤©ï¼Œåæ¥ä¹°äº†ä¸ªèºä¸å’Œæ•£çƒ­ç‰‡å®Œç¾åœ°è§£å†³äº†ã€‚</p><p><img src="img/HomeLab-5.jpg" alt=""></p><p>ä»ä»¥å‰æ—§ç¬”è®°æœ¬æ·˜æ±°ä¸‹æ¥çš„ 2TB 5400RPM çš„çŸ³å¤´ç›˜ï¼Œå·²ç»å‡ºç°åé“äº†ï¼Œä¸´æ—¶å½“ä¸ªä¸‹è½½ç›˜å§ï¼Œåœ¨å®ƒè¿˜æ²¡å½»åº•å´©ç›˜ä¹‹å‰å†å‹æ¦¨ä¸€ä¸‹å®ƒå§ğŸ˜‚ã€‚åé¢æ‰“ç®—å†æ·»åŠ ä¸€å—12TBçš„æ°¦æ°”ç›˜å½“ä»“åº“ç›˜å’Œå¤‡ä»½æ•°æ®ä½¿ç”¨ï¼Œæœ‰äº† UPS å’Œè¿™å°ä¸»æœº 7*24 å°æ—¶å¼€æœºä¹Ÿæ²¡å•¥é—®é¢˜äº†ã€‚</p><p><img src="img/HomeLab-3.jpg" alt=""></p><p>åé¢é‚£å°æ˜¯æˆ‘çš„å°å¼æœºï¼Œä¹Ÿæ˜¯å»å¹´è¿™æ—¶å€™ä¹°çš„ï¼Œä¸¤è€…æ¯”è¾ƒèµ·æ¥ SFF çš„å‹å·ç¡®å®å°å¾ˆå¤šã€‚Dell çš„è¿™ç§ä¸»æœºè¿˜æœ‰ä¸€ç§ MFF å‹å·çš„ï¼Œé‚£ç§æ›´å°ä¸€äº›ï¼Œå·®ä¸å¤šæ¯”è·¯ç”±å™¨å¤§ä¸€äº›è€Œå·²ï¼Œä¸è¿‡æ‰©å±•æ€§ä¸å¥½ï¼Œè€Œä¸”è¿˜éœ€è¦å¤–ç½®ç”µæºï¼Œä¹Ÿå°±æ²¡è€ƒè™‘ï¼Œä¸è¿‡ç°åœ¨æƒ³æƒ³æœ‰ç‚¹åæ‚”äº†ï¼Œå½“åˆåº”è¯¥å¤šåŠ ç‚¹é’±ä¹° SFF çš„ï¼Œä¸è¿‡è¿˜å¥½ä¹Ÿèƒ½æ¥å—ï¼Œåªä¸è¿‡ä½“ç§¯å¤§äº†äº›ï¼Œæ¬å®¶çš„æ—¶å€™ä¸å¤ªæ–¹ä¾¿ã€‚</p><p><img src="img/HomeLab-4.jpg" alt=""></p><h2 id="ESXi"><a href="#ESXi" class="headerlink" title="ESXi"></a>ESXi</h2><p>è£…å®Œæœºå™¨ä¹‹åå°±å¼€å§‹è£… ESXi ï¼Œå¯¹äºè™šæ‹ŸåŒ–ï¼ŒESXi ç®—æ˜¯æ¯”è¾ƒç†Ÿæ‚‰çš„äº†ï¼Œå¬è¯´ Proxmox VE ä¹Ÿä¸é”™ğŸ¤”ï¼Œç­‰åˆ°åé¢ç¡¬ç›˜åˆ°äº†å†æŠ˜è…¾ä¸€ä¸‹ Proxmox VEã€‚çœ‹åˆ°éš”å£ <a href="https://wzyboy.im/post/1293.html" target="_blank" rel="noopener">Proxmox VEï¼šä¼˜ç§€çš„è‡ªå»ºè™šæ‹ŸåŒ–æ–¹æ¡ˆ</a> æ„ˆå‘æƒ³ç©ç©äº†ã€‚</p><blockquote><p>  è´¯å½»ã€Œä¸é‡å¤é€ è½®å­ã€çš„åŸåˆ™ï¼Œå½“å‰ç‰ˆæœ¬çš„ PVE åŸºäºæˆç†Ÿç¨³å®šçš„ Debian 9 â€œStretchâ€ æ„å»ºã€‚åœ¨ç†Ÿæ‚‰å’Œä½¿ç”¨ PVE çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘è¶Šå‘å–œæ¬¢å®ƒã€Œä¸é‡å¤é€ è½®å­ã€çš„ç‰¹æ€§ã€‚ç›¸è¾ƒä¹‹å‰ç”¨è¿‡çš„å…¶ä»–è™šæ‹ŸåŒ–æ–¹æ¡ˆï¼ŒPVE çš„å†…éƒ¨æ„é€ å’Œå·¥ä½œåŸç†å¯¹æˆ‘æ¥è¯´ä¸å†æ˜¯ä¸€ä¸ªé»‘ç›’ï¼Œæˆ‘å¯ä»¥æ¸…æ™°åœ°è§‚æµ‹åˆ°å®ƒåœ¨å¹²ä»€ä¹ˆâ€”â€”æ¯”å¦‚è¦è¿ç§»ä¸€å°è™šæ‹Ÿæœºåˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘å°±å¯ä»¥é€šè¿‡ <code>ps</code> è§‚å¯Ÿåˆ°å®ƒå¯åŠ¨äº†ä¸€ä¸ª <code>dd</code> è¿›ç¨‹ï¼Œå¯¹æ¥ <code>ssh</code> ç®¡é“ï¼Œå°†ç£ç›˜æ•°æ®é€šè¿‡ç½‘ç»œå¤åˆ¶åˆ°ç›®æ ‡æœºå™¨â€”â€”è¿™ç§ä»¿ä½›é€æ˜æ‰‹è¡¨ä¸€æ ·èƒ½çœ‹åˆ°å†…éƒ¨å·¥ä½œåŸç†çš„æ„Ÿè§‰çœŸæ˜¯å¤ªæ£’äº†ï¼</p></blockquote><p>ä» VMware å®¶ä¸‹è½½å¥½ <code>VMware-VMvisor-Installer-7.0.0-15843807.x86_64.iso</code> é•œåƒï¼Œæ‰¾äº†ä¸¤ä¸ª U ç›˜ï¼Œä¸€ä¸ªç”¨äº ESXi çš„å®‰è£…ç›˜ï¼Œä¸€ä¸ªç”¨äº ESXi çš„ç³»ç»Ÿç›˜ï¼Œå…¶ä¸­ä¸€ä¸ª U ç›˜è¿˜æ˜¯æˆ‘ç”¨è¯»å¡å™¨+16GBå†…å­˜å¡æ‹¼å‡‘è€Œæˆçš„ï¼Œç›®çš„æ˜¯ä¸ºäº†æŠŠ ESXi è£…åˆ° U ç›˜é‡Œæ–¹ä¾¿è¿ç§»æ•°æ®ä¹‹ç±»çš„ï¼Œä¹‹ååœ¨ç½‘ä¸Šæ‰¾ä¸€ä¸ªç¥ KEY æ¿€æ´»ä¸€ä¸‹ï¼ˆğŸ¤«å°å£°</p><p><img src="img/HomeLab-6.jpg" alt=""></p><h3 id="Ubuntu-20-04"><a href="#Ubuntu-20-04" class="headerlink" title="Ubuntu 20.04"></a>Ubuntu 20.04</h3><p>å½“ä½œç½‘å…³æœºä½¿ç”¨ï¼Œå’Œæˆ‘æ‰€æœ‰çš„ äº‘ä¸»æœºæ‰“é€šç½‘ç»œï¼Œä½¿ç”¨ WireGuard ç»„æˆä¸€ä¸ªå°å†…ç½‘ï¼Œå…³äº WireGuard çš„ä½¿ç”¨å»ºè®®é˜…è¯»å¤§ä½¬å†™å¾—åšå®¢ <a href="https://fuckcloudnative.io/posts/wireguard-docs-practice/" target="_blank" rel="noopener">WireGuard æ•™ç¨‹ï¼šWireGuard çš„æ­å»ºä½¿ç”¨ä¸é…ç½®è¯¦è§£</a> ä»¥åŠ <a href="https://fuckcloudnative.io/posts/wireguard-docs-theory/" target="_blank" rel="noopener">WireGuard æ•™ç¨‹ï¼šWireGuard çš„å·¥ä½œåŸç†</a>ã€‚</p><p>é¡ºå¸¦ç”¨ <a href="https://github.com/Aniverse/ZBench" target="_blank" rel="noopener">ZBench</a> æµ‹äº†ä¸€ä¸‹è™šæ‹Ÿæœºçš„ç£ç›˜æ€§èƒ½ï¼Œè¿˜ç®—å‹‰å¼ºè¯´çš„è¿‡å»ï¼Œå®é™…ä¸Š SN750 512GB åªæœ‰ 2GB å·¦å³çš„ç¼“å­˜ï¼Œå†™æ»¡æ¢ç²—ä¹‹åï¼Œå†™å…¥çš„æ€§èƒ½ä¼šç›´çº¿ä¸‹é™åˆ° 800MB/sï¼Œè¯»çš„æ€§èƒ½å€’æ˜¯å¯ä»¥è¾¾åˆ° 3200MB/s ä»¥ä¸Šï¼Œæˆ–è®¸æ˜¯ä¸»æ¿çš„é™åˆ¶ï¼Œæ²¡èƒ½è¾¾åˆ°ç†æƒ³çš„è¯»å†™æ€§èƒ½ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------------------------------------------------</span><br><span class="line">CPU model            : Intel(R) Core(TM) i5-6600T CPU @ 2.70GHz</span><br><span class="line">Number of cores      : 4</span><br><span class="line">CPU frequency        : 2712.000 MHz</span><br><span class="line">Total size of Disk   : 33.3 GB (7.7 GB Used)</span><br><span class="line">Total amount of Mem  : 3935 MB (306 MB Used)</span><br><span class="line">Total amount of Swap : 3934 MB (0 MB Used)</span><br><span class="line">System uptime        : 4 days, 19 hour 47 min</span><br><span class="line">Load average         : 0.13, 0.08, 0.03</span><br><span class="line">OS                   : Ubuntu 20.04 LTS</span><br><span class="line">Arch                 : x86_64 (64 Bit)</span><br><span class="line">Kernel               : 5.4.0-42-generic</span><br><span class="line">Virt                 : vmware</span><br><span class="line">--------------------------------------------------------------------------</span><br><span class="line">I/O speed(1st run)   :1.3 GB/s</span><br><span class="line">I/O speed(2nd run)   :1.3 GB/s</span><br><span class="line">I/O speed(3rd run)   :1.3 GB/s</span><br></pre></td></tr></table></figure><h3 id="PhotonOS"><a href="#PhotonOS" class="headerlink" title="PhotonOS"></a>PhotonOS</h3><p>è¿™ä¸ªæ˜¯ç³»ç»Ÿåœ¨æˆ‘å¦ä¸€ç¯‡åšå®¢ <a href="https://blog.k8s.li/container-linux-os.html">Container Linux OS ä»å…¥å‘åˆ°çˆ¬å‡ºæ¥</a> é‡Œæåˆ°è¿‡ï¼ŒPhoton OSâ„¢ æ˜¯é’ˆå¯¹ VMware vSphereÂ® è™šæ‹ŸåŒ–å¹³å°è¿›è¡Œå†…æ ¸ä¼˜åŒ–çš„å®¹å™¨ä¸“ç”¨æ“ä½œç³»ç»Ÿï¼Œå°±å’Œ CoreOS ä¸€æ ·ã€‚ååˆ†é€‚åˆä¸“é—¨ç”¨æ¥è¿è¡Œå®¹å™¨ï¼Œå½“ä½œ Kubernetes é›†ç¾¤ä¸­çš„å·¥ä½œè´Ÿè½½æ¥ä½¿ç”¨ã€‚</p><ul><li>ç³»ç»Ÿåˆå§‹åŒ–å¯åŠ¨ä¹‹åå†…å­˜ä»…ä»…ä½¿ç”¨äº† 45Mi</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:          2.0Gi        45Mi       1.8Gi       0.0Ki        93Mi       1.8Gi</span><br><span class="line">Swap:            0B          0B          0B</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨ docker è¿›ç¨‹ä¹‹åçš„å ç”¨æƒ…å†µï¼Œä¹Ÿä»…ä»… 109Mi</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:          2.0Gi       109Mi       1.6Gi       0.0Ki       238Mi       1.8Gi</span><br><span class="line">Swap:            0B          0B          0B</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ OVA è™šæ‹Ÿæœºæ¨¡æ¿å¯åŠ¨åçš„è™šæ‹Ÿæœºï¼Œç£ç›˜ä»…ä»…å ç”¨äº† 515MB ï¼Œç¡®å®æ˜¯ç›¸å½“è½»é‡åŒ–ï¼Œè¿™è¿˜æ˜¯åŒ…å«äº† dockerã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# df -h</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/root        16G  515M   15G   4% /</span><br><span class="line">devtmpfs        998M     0  998M   0% /dev</span><br><span class="line">tmpfs          1000M     0 1000M   0% /dev/shm</span><br><span class="line">tmpfs          1000M  532K  999M   1% /run</span><br><span class="line">tmpfs          1000M     0 1000M   0% /sys/fs/cgroup</span><br><span class="line">tmpfs          1000M     0 1000M   0% /tmp</span><br><span class="line">/dev/sda2        10M  2.2M  7.9M  22% /boot/efi</span><br><span class="line">tmpfs           200M     0  200M   0% /run/user/0</span><br></pre></td></tr></table></figure><p>æ€»ä¹‹ï¼ŒPhotonOS æ˜¯ä¸ªå¾ˆè½»é‡çš„ OS ï¼Œé€‚åˆä¸“é—¨ç”¨æ¥è¿è¡Œä¸€äº›å®¹å™¨åŒ–çš„æœåŠ¡ï¼Œè¿™æ­£å¥½ç¬¦åˆæˆ‘çš„éœ€æ±‚ã€‚åˆ«é—®æˆ‘ä¸ºä»€ä¹ˆä¸ç”¨ CoreOS ï¼ŒCoreOS å·²ç»å‡‰äº†ã€‚</p><h3 id="Alpine-NFS"><a href="#Alpine-NFS" class="headerlink" title="Alpine NFS"></a>Alpine NFS</h3><p>æŠŠæˆ‘ä¸€å—ç£ç›˜ç›´é€šç»™è¿™ä¸ªè™šæ‹Ÿæœºï¼Œä¸»è¦ç”¨æ¥ç»™ k8s é›†ç¾¤ä¸­çš„ Pod æŒ‚è½½ PVC æŒä¹…åŒ–å­˜å‚¨ä½¿ç”¨ã€‚</p><h3 id="Debian"><a href="#Debian" class="headerlink" title="Debian"></a>Debian</h3><p>ä¸»è¦æ˜¯ç”¨æ¥è¿è¡Œ K8s é›†ç¾¤ï¼Œç›®å‰åªæœ‰ä¸€ä¸ª  master å’Œä¸€ä¸ª node ç©ç©å„¿ï¼Œè·‘äº†ä¸€äº›è‡ªç”¨çš„æœåŠ¡ã€‚</p><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>å½“ä¸‹è½½æœºä½¿ç”¨ï¼Œå¤–åŠ è¿è¡Œä¸€äº›ä¸å¾—ä¸ä½¿ç”¨çš„å›½äº§æ¯’ç˜¤è½¯ä»¶ğŸ˜¡</p><h2 id="é¢å¤–ç¡¬ä»¶"><a href="#é¢å¤–ç¡¬ä»¶" class="headerlink" title="é¢å¤–ç¡¬ä»¶"></a>é¢å¤–ç¡¬ä»¶</h2><p>æ¡åƒåœ¾çš„ä¹è¶£å°±åœ¨äºè¶ŠæŠ˜è…¾è¶Šå¥½ç©ï¼Œäºæ˜¯åˆå¼€å§‹æ‰“ç®—æŠ˜è…¾ä¸€äº›</p><h3 id="UPS"><a href="#UPS" class="headerlink" title="UPS"></a>UPS</h3><p>ç”±äºæœ€è¿‘æˆ¿ä¸œå®¶é‡Œç»å¸¸æ–­ç”µï¼Œæœ‰æ—¶ä¸€å¤©æ–­ç”µå…«ä¹æ¬¡ï¼Œæ¯æ¬¡æ–­ç”µæˆ‘éƒ½æ‹…å¿ƒç€ç¡¬ç›˜é‡Œçš„è€å©†ä»¬ä¼šä¸ä¼šæŒ‚æ‰ï¼Œç´¢æ€§è¿˜æ˜¯ä¹°äº† UPS ï¼Œåœ¨é©¬äº‘å®¶çœ‹äº†çœ‹ï¼Œå¸¦ç»™ NAS è‡ªåŠ¨æ–­ç”µçš„ UPS æ™®éåœ¨ 400å—é’±ä»¥ä¸Šï¼Œè€Œä¸”æˆ‘è¿™ä¸ªè¿˜æ˜¯ä¸ªå‡çš„ NAS ï¼ŒUPS ä¸Šçš„ USB å£ä¸ä¸€å®šæ”¯æŒæˆ‘çš„ä¸»æœºã€‚æœ€åä¸ºäº†èŠ‚çœä¸€ä¸‹é¢„ç®—èŠ±å„¿ 160 å—é’±ä¹°äº†ä¸ªä¸æ”¯æŒ USB çš„ UPS ï¼Œä½†æ˜¯åˆä¸èƒ½æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œå› ä¸ºå®¶é‡Œçš„ 220V å¸‚ç”µæ–­ç”µä¹‹åï¼ŒUPS çš„ç”µé‡åªèƒ½ç»™ä¸»æœºç»­å‘½ 10~20min å·¦å³ï¼ŒUPS çš„ç”µé‡ç”¨å®Œä¹‹åå°±å—å±äº†ï¼Œç…§é˜³è¿˜æ˜¯æ–­ç”µã€‚æ‰€ä»¥åœ¨ UPS ç”¨å°½ç”µé‡è¿˜æ˜¯æ²¡æœ‰æ¥ç”µä¹‹å‰ï¼Œä¸€å®šè¦æƒ³åŠæ³•æŠŠä¸»æœºé€šè¿‡ poweroff çš„æ–¹å¼å®‰å…¨ä¼˜é›…æ»´å…³æœºã€‚</p><p>é¦–å…ˆè¦è€ƒè™‘çš„æ˜¯æ€ä¹ˆçŸ¥é“ 220V å¸‚ç”µæ–­ç”µäº†ï¼Œèµ·åˆæƒ³æœ‰æ²¡æœ‰ä¸ª 220V çš„ä¼ æ„Ÿå™¨ï¼Œæˆ‘å»ï¼Œæœ‰ç‚¹éš¾åº¦è¿˜æ˜¯ç®—äº†å§ã€‚æœ€åä¸€æƒ³ï¼Œå¯ä»¥é€šè¿‡ ping æˆ¿ä¸œå®¶å…‰çŒ«çš„æ–¹å¼ã€‚æˆ‘çš„è·¯ç”±å™¨å’Œä¸»æœºç­‰è®¾å¤‡è¿æ¥ UPS ï¼Œæˆ¿ä¸œå®¶çš„å…‰çŒ«å¹¶æ²¡æœ‰è¿æ¥ UPS ï¼Œæˆ‘åœ¨è·¯ç”±å™¨ä¸Šè®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯åˆ†é’Ÿå» ping æˆ¿ä¸œå®¶çš„å…‰çŒ«ï¼Œæ²¡æœ‰ ping é€šè¯´æ˜å°±æ˜¯æ–­ç”µäº†ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ç½‘çº¿è¢«æ‹”æ‰äº†ï¼Œä½†æ¦‚ç‡å¾ˆå°ã€‚<code>! ping -c 8 A &amp;&amp; ssh B &quot;poweroff&quot;</code> ä¸€è¡Œç®€å•çš„å‘½ä»¤å°±æ»¡è¶³äº†æˆ‘çš„éœ€æ±‚ï¼Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">echo "start" &gt;&gt; /tmp/power_status</span><br><span class="line">if ! ping -c 32 192.168.1.1</span><br><span class="line">then</span><br><span class="line">    sleep 300</span><br><span class="line">    ping -c 32 192.168.1.1 &amp;&amp; exit 0</span><br><span class="line">    sshpass -p "pwd" ssh root@192.168.0.210 "net rpc shutdown -I 192.168.0.240 -U admin%poweroff"</span><br><span class="line">    sshpass -p "pwd" ssh root@192.168.0.200 "sh -c /suspend_vm.sh"</span><br><span class="line">    echo "220v poweroff" &gt;&gt; /tmp/power_status</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>å¯¹äº ESXi ä¸Šçš„è™šæ‹Ÿæœºï¼Œè¿˜æ˜¯é‡‡ç”¨äº†æŒ‚èµ·çš„æ–¹å¼ï¼Œå°†è™šæ‹Ÿæœºçš„å†…å­˜çŠ¶æ€ä¿å­˜åœ¨æ•°æ®å­˜å‚¨çš„ç£ç›˜é‡Œï¼Œè¿™æ ·é‡æ–°å¼€å¯è™šæ‹Ÿæœºåå°±èƒ½æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼Œè¿™ä¸€ç‚¹æœ‰ç‚¹åƒ Windows çš„ä¼‘çœ ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">for vm in $(/sbin/vmdumper -l | grep -v Alpine |  awk '&#123;print $1&#125;' | sed 's/wid=//g')</span><br><span class="line">do</span><br><span class="line">     /sbin/vmdumper $&#123;vm&#125; suspend_vm</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h3 id="ç½‘ç®¡äº¤æ¢æœº"><a href="#ç½‘ç®¡äº¤æ¢æœº" class="headerlink" title="ç½‘ç®¡äº¤æ¢æœº"></a>ç½‘ç®¡äº¤æ¢æœº</h3><p>å½“æˆ‘ä»å°å¼æœºå‘ ESXI é‡Œçš„è™šæ‹Ÿæœºä¼ è¾“æ–‡ä»¶çš„æ—¶å€™ï¼Œå‘ç°ç½‘ç»œé€Ÿåº¦æœ€å¿«åªèƒ½è¾¾åˆ° 700Mbits/sec ï¼Œçœ‹æ¥åº”è¯¥æ˜¯è·¯ç”±å™¨çš„æ€§èƒ½ç“¶é¢ˆï¼Œäºæ˜¯æƒ³ç€å‡çº§ä¸€ä¸‹ç½‘ç»œè®¾å¤‡ï¼ŒæŠŠ R6300V2 è·¯ç”±å™¨å½“ä½œ AP æ¥ç”¨ï¼Œå°†æµé‡éƒ½æ±‡èšåˆ°ç½‘ç®¡äº¤æ¢æœºä¸Šã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[  4] local 192.168.0.240 port 50718 connected to 192.168.0.123 port 5201</span><br><span class="line">[ ID] Interval           Transfer     Bandwidth</span><br><span class="line">[  4]   0.00-1.00   sec  83.8 MBytes   702 Mbits/sec</span><br><span class="line">[  4]   1.00-2.00   sec  83.4 MBytes   700 Mbits/sec</span><br><span class="line">[  4]   2.00-3.00   sec  83.6 MBytes   701 Mbits/sec</span><br><span class="line">[  4]   3.00-4.00   sec  82.9 MBytes   695 Mbits/sec</span><br><span class="line">[  4]   4.00-5.00   sec  83.8 MBytes   702 Mbits/sec</span><br><span class="line">[  4]   5.00-6.00   sec  83.6 MBytes   701 Mbits/sec</span><br><span class="line">[  4]   6.00-7.00   sec  83.5 MBytes   701 Mbits/sec</span><br><span class="line">[  4]   7.00-8.00   sec  83.8 MBytes   703 Mbits/sec</span><br><span class="line">[  4]   8.00-9.00   sec  83.8 MBytes   702 Mbits/sec</span><br><span class="line">[  4]   9.00-10.00  sec  83.8 MBytes   702 Mbits/sec</span><br><span class="line">[  4]  10.00-11.00  sec  83.8 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  11.00-12.00  sec  83.8 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  12.00-13.00  sec  83.9 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  13.00-14.00  sec  83.8 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  14.00-15.00  sec  83.8 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  15.00-16.00  sec  83.9 MBytes   704 Mbits/sec</span><br><span class="line">[  4]  16.00-17.00  sec  83.4 MBytes   699 Mbits/sec</span><br><span class="line">[  4]  17.00-18.00  sec  83.9 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  18.00-19.00  sec  83.6 MBytes   702 Mbits/sec</span><br><span class="line">[  4]  19.00-20.00  sec  83.8 MBytes   702 Mbits/sec</span><br><span class="line">[  4]  20.00-21.00  sec  83.9 MBytes   704 Mbits/sec</span><br><span class="line">[  4]  21.00-22.00  sec  83.8 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  22.00-23.00  sec  83.9 MBytes   704 Mbits/sec</span><br><span class="line">[  4]  23.00-24.00  sec  83.9 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  24.00-25.00  sec  83.9 MBytes   703 Mbits/sec</span><br><span class="line">[  4]  25.00-25.20  sec  16.6 MBytes   698 Mbits/sec</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€debian@debian ~</span><br><span class="line">â•°â”€$ qperf 192.168.0.123 -t 30 -vvu tcp_lat udp_lat tcp_bw udp_bw conf</span><br><span class="line">tcp_lat:</span><br><span class="line">    latency   =  98.7 us</span><br><span class="line">    msg_size  =     1 bytes</span><br><span class="line">    time      =    30 sec</span><br><span class="line">    timeout   =     5 sec</span><br><span class="line">udp_lat:</span><br><span class="line">    latency   =  98 us</span><br><span class="line">    msg_size  =   1 bytes</span><br><span class="line">    time      =  30 sec</span><br><span class="line">    timeout   =   5 sec</span><br><span class="line">tcp_bw:</span><br><span class="line">    bw        =  87.9 MB/sec</span><br><span class="line">    msg_size  =    64 KiB (65,536)</span><br><span class="line">    time      =    30 sec</span><br><span class="line">    timeout   =     5 sec</span><br><span class="line">udp_bw:</span><br><span class="line">    send_bw   =  56.7 MB/sec</span><br><span class="line">    recv_bw   =  56.7 MB/sec</span><br><span class="line">    msg_size  =    32 KiB (32,768)</span><br><span class="line">    time      =    30 sec</span><br><span class="line">    timeout   =     5 sec</span><br><span class="line">conf:</span><br><span class="line">    loc_node   =  debian</span><br><span class="line">    loc_cpu    =  16 Cores: AMD Ryzen 7 1700 Eight-Core   3.0GHz</span><br><span class="line">    loc_os     =  Linux 4.4.0-18362</span><br><span class="line">    loc_qperf  =  0.4.11</span><br><span class="line">    rem_node   =  gateway</span><br><span class="line">    rem_cpu    =  4 Cores: Intel Core i5-6600T @ 2.70GHz</span><br><span class="line">    rem_os     =  Linux 5.4.0-42-generic</span><br><span class="line">    rem_qperf  =  0.4.11</span><br></pre></td></tr></table></figure><p>å‡†å¤‡ä¹° GS108E V2 æˆ–è€… GS105E V2ï¼Œ</p><h3 id="å››ç½‘å£ç½‘å¡"><a href="#å››ç½‘å£ç½‘å¡" class="headerlink" title="å››ç½‘å£ç½‘å¡"></a>å››ç½‘å£ç½‘å¡</h3><p>ä¸ºäº†æŠ˜è…¾ä¸€ä¸‹ç½‘å¡ç›´é€šã€ç«¯å£æ±‡èšã€overlay ç½‘ç»œå¸è½½ç­‰ç‰¹æ€§ï¼Œåé¢è¿˜è¦æ·»åŠ ä¸€å— <a href="https://www.intel.cn/content/www/cn/zh/products/docs/network-io/ethernet/10-25-40-gigabit-adapters/ethernet-i350-server-adapter-brief.html" target="_blank" rel="noopener">intel I350 T4 V2</a> ï¼Œé—²é±¼ä¸Šçš„ä»·æ ¼ä¹Ÿä¸æ˜¯å¾ˆè´µã€‚</p><p><img src="img/20200822195450798.png" alt="image-20200822195450798"></p><h3 id="é˜µåˆ—å¡"><a href="#é˜µåˆ—å¡" class="headerlink" title="é˜µåˆ—å¡"></a>é˜µåˆ—å¡</h3><p>ç”±äºä¸»æ¿çš„ SATA æ¥å£æœ€å¤§åªæ”¯æŒåˆ° 2TB ï¼Œä¸ºäº†æ‰©å±•ä¸€ä¸‹å­˜å‚¨ï¼Œåªèƒ½é¢å¤–æ·»åŠ ä¸€å—é˜µåˆ—å¡äº†ï¼Œç”±äºä¸»æ¿çš„ PCIe æœ‰é™ï¼Œè€Œä¸”è¿™ä¹ˆå¤§ç‚¹çš„æœºç®±æœ€å¤šä¹Ÿå°±èƒ½å¡ä¸‹ 1 å— 3.5 å¯¸ç¡¬ç›˜å’Œ 3 å— 2.5 å¯¸ç¡¬ç›˜ï¼Œæ‰€ä»¥æ‰¾ä¸€å—å…¥é—¨çº§çš„é˜µåˆ—å¡å°±å¤Ÿäº†ï¼Œæœ€ç»ˆèŠ±äº† 50 å—é’±æ¡äº†ä¸€å— <a href="https://lenovopress.com/tips0831-serveraid-h1110" target="_blank" rel="noopener">ServeRAID H1110 SAS/SATA Controller</a> é˜µåˆ—å¡ï¼Œçœ‹æ¥ä¸€ä¸‹æ‰‹å†Œé‡Œçš„å‚æ•°ï¼Œå¤§æ¦‚ä¹Ÿèƒ½æš‚æ—¶æ»¡è¶³æˆ‘çš„éœ€æ±‚ã€‚</p><blockquote><ul><li>Four internal 6 Gbps SAS/SATA ports</li><li>One x4 mini-SAS internal connector (SFF-8087)</li><li>6 Gbps throughput per port</li><li>Based on LSI SAS2004 6 Gbps RAID on Chip (ROC) controller</li><li>x4 PCI Express 2.0 host interface</li><li>Supports RAID 0, 1, 1E, and 10</li><li>Connects to up to four SAS or SATA drives</li><li>SAS and SATA drives are supported, but the mixing of SAS and SATA in the same integrated volume is not supported</li><li>Supports simple-swap SATA and hot-swap SAS and SATA drives</li><li>Supports up to two integrated volumes</li><li>Supports up to two global hot-spare drives</li><li>Supports drive sizes greater than 2 TB for RAID 0, 1E, and 10 (not RAID 1)</li><li>Fixed stripe size of 64 KB</li><li>Compliant with Disk Data Format (DDF)</li><li>S.M.A.R.T. support</li></ul></blockquote><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>æ‡’å¾—å†™äº†</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;æ¡åƒåœ¾&quot;&gt;&lt;a href=&quot;#æ¡åƒåœ¾&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="æ¡åƒåœ¾" scheme="https://blog.k8s.li/tags/%E6%8D%A1%E5%9E%83%E5%9C%BE/"/>
    
      <category term="NAS" scheme="https://blog.k8s.li/tags/NAS/"/>
    
  </entry>
  
  <entry>
    <title>docker registry GC åŸç†åˆ†æ</title>
    <link href="https://blog.k8s.li/registry-gc.html"/>
    <id>https://blog.k8s.li/registry-gc.html</id>
    <published>2020-07-10T16:00:00.000Z</published>
    <updated>2020-09-15T00:28:09.960Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å¥½ä¹…æ²¡æ›´æ–°åšå®¢äº†ï¼Œåœ¨å®¶æ‘¸é±¼èµ¶ç´§æ¥æ°´ä¸€ç¯‡ğŸ˜‚</p></blockquote><h2 id="registry-GC-åŸç†ğŸ¤”"><a href="#registry-GC-åŸç†ğŸ¤”" class="headerlink" title="registry GC åŸç†ğŸ¤”"></a>registry GC åŸç†ğŸ¤”</h2><p>åœ¨å’±ä¸Šä¸ªæœˆå†™çš„<a href="https://blog.k8s.li/Exploring-container-image.html">ã€Šæ·±å…¥æµ…å‡ºå®¹å™¨é•œåƒçš„ä¸€ç”Ÿã€‹</a>ä¸­ç®€å•æåˆ°äº†å®¹å™¨é•œåƒçš„ä¸€äº›çŸ¥è¯†ï¼Œä¹Ÿç®€å•ä»‹ç»äº†é•œåƒåœ¨ registry ä¸­å­˜å‚¨çš„ç›®å½•ç»“æ„ã€‚ä»Šå¤©è¿˜æ˜¯ä»æ–‡ä»¶ç³»ç»Ÿå±‚é¢åˆ†æä¸€ä¸‹ registry GC çš„åŸç†ï¼Œæ¯”ä»æºç æ¥åˆ†ææ›´ç›´è§‚ä¸€äº›ã€‚</p><h3 id="éƒ¨ç½²-registry-å®¹å™¨"><a href="#éƒ¨ç½²-registry-å®¹å™¨" class="headerlink" title="éƒ¨ç½² registry å®¹å™¨"></a>éƒ¨ç½² registry å®¹å™¨</h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨æœ¬åœ°éƒ¨ç½²ä¸€ä¸ª registry å®¹å™¨ï¼ŒåŒæ—¶ä¸ºäº†æ“ä½œçš„æ–¹ä¾¿è¿˜éœ€è¦ä½¿ç”¨åˆ° skopeo è¿™ä¸ªå·¥å…·æ¥æ›¿ä»£ docker å‘½ä»¤è¡Œå®¢æˆ·ç«¯è¿›è¡Œ copy é•œåƒå’Œ delete é•œåƒã€‚å…³äº skopeo è¿™ä¸ªå·¥å…·çš„å®‰è£…å’Œä½¿ç”¨å¯ä»¥å‚è€ƒå’±ä¹‹å‰å†™è¿‡çš„<a href="https://blog.k8s.li/skopeo.html">ã€Šé•œåƒæ¬è¿å·¥ skopeo ã€‹</a>ã€‚</p><h4 id="è‡ªç­¾-SSL-è¯ä¹¦"><a href="#è‡ªç­¾-SSL-è¯ä¹¦" class="headerlink" title="è‡ªç­¾ SSL è¯ä¹¦"></a>è‡ªç­¾ SSL è¯ä¹¦</h4><p>è¿™ä¸€æ­¥ä¸ºäº†æ–¹ä¾¿åœ¨ä½¿ç”¨ skopeo çš„æ—¶å€™ä¸ç”¨åŠ ä¸€å †é¢å¤–çš„å‚æ•°ğŸ˜‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">set -e</span><br><span class="line">set -o nounset</span><br><span class="line">cat &gt;ca.conf &lt;&lt;EOF</span><br><span class="line">[ req ]</span><br><span class="line">default_bits  = 2048</span><br><span class="line">distinguished_name = req_distinguished_name</span><br><span class="line">prompt   = no</span><br><span class="line">encrypt_key  = no</span><br><span class="line">x509_extensions  = v3_ca</span><br><span class="line">[ req_distinguished_name ]</span><br><span class="line">CN         = localhost</span><br><span class="line">[ CA_default ]</span><br><span class="line">copy_extensions = copy</span><br><span class="line">[ alternate_names ]</span><br><span class="line">DNS.2=localhost</span><br><span class="line">[ v3_ca ]</span><br><span class="line">subjectAltName=@alternate_names</span><br><span class="line">subjectKeyIdentifier=hash</span><br><span class="line">authorityKeyIdentifier=keyid:always,issuer:always</span><br><span class="line">basicConstraints = critical,CA:true</span><br><span class="line">keyUsage=keyCertSign,cRLSign,digitalSignature,keyEncipherment,nonRepudiation</span><br><span class="line">EOF</span><br><span class="line">mkdir -p certs</span><br><span class="line">openssl req -days 365 -x509 -config ca.conf \</span><br><span class="line">    -new -keyout certs/domain.key -out certs/domain.crt</span><br></pre></td></tr></table></figure><ul><li>ä¿¡ä»»è¯ä¹¦ï¼Œæ ¹æ®ä¸åŒçš„å‘è¡Œç‰ˆé€‰æ‹©ç›¸åº”çš„è·¯å¾„å’Œå‘½ä»¤è¡Œå³å¯ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> CentOS</span></span><br><span class="line">update-ca-trust force-enable</span><br><span class="line">cp certs/domain.crt /etc/pki/ca-trust/source/anchors/localhost.crt</span><br><span class="line">update-ca-trust</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Ubuntu</span></span><br><span class="line">cp certs/domain.crt /usr/local/share/ca-certificates/localhost.crt</span><br><span class="line"><span class="meta">$</span><span class="bash"> update-ca-certificates</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian</span></span><br><span class="line">cp certs/domain.crt /usr/share/ca-certificates/localhost.crt</span><br><span class="line">echo localhost.crt &gt;&gt; /etc/ca-certificates.conf</span><br><span class="line">update-ca-certificates</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºå¯†ç -auth-è®¤è¯-auth-htpasswd-æ–‡ä»¶"><a href="#åˆ›å»ºå¯†ç -auth-è®¤è¯-auth-htpasswd-æ–‡ä»¶" class="headerlink" title="åˆ›å»ºå¯†ç  auth è®¤è¯  auth.htpasswd æ–‡ä»¶"></a>åˆ›å»ºå¯†ç  auth è®¤è¯  auth.htpasswd æ–‡ä»¶</h4><p>ç”±äº PUSH é•œåƒå’Œ DELETE é•œåƒæ˜¯é€šè¿‡ HTTP è¯·æ±‚ registry çš„ API å®Œæˆçš„ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦ä¸€ä¸ª token æ‰èƒ½å®Œæˆæ“ä½œï¼Œè¿™ä¸ª token éœ€è¦ä½¿ç”¨è¿™ä¸ª AUTH æ–‡ä»¶æ¥è¿›è¡Œé‰´æƒï¼Œä½¿ç”¨ <code>htpasswd</code> æ¥ç”Ÿæˆä¸€ä¸ªæ˜æ–‡çš„ç”¨æˆ·/å¯†ç å³å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htpasswd -cB -b auth.htpasswd root 123456</span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨-registry-å®¹å™¨ï¼Œdocker-run-èµ°èµ·ï¼"><a href="#å¯åŠ¨-registry-å®¹å™¨ï¼Œdocker-run-èµ°èµ·ï¼" class="headerlink" title="å¯åŠ¨ registry å®¹å™¨ï¼Œdocker run èµ°èµ·ï¼"></a>å¯åŠ¨ registry å®¹å™¨ï¼Œdocker run èµ°èµ·ï¼</h4><ul><li><code>-v /var/lib/registry:/var/lib/registry</code> ï¼Œå°†æœ¬åœ°çš„å­˜å‚¨ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…çš„ registry å­˜å‚¨ç›®å½•ä¸‹ã€‚</li><li><code>-v pwd/certs:/certs</code>ï¼Œå°†ç”Ÿæˆçš„ SSL è¯ä¹¦æŒ‚è½½åˆ°å®¹å™¨å†…ã€‚</li><li><code>-e REGISTRY_STORAGE_DELETE_ENABLED=true</code>ï¼Œæ·»åŠ è¯¥å‚æ•°æ‰èƒ½è¿›è¡Œ DELETE é•œåƒæ“ä½œï¼Œä¸ç„¶çš„è¯ä¼šæç¤º <a href="https://github.com/docker/distribution/issues/1573" target="_blank" rel="noopener">Error in deleting repository in a private registry V2 #1573</a> è¿™ç§é”™è¯¯ï¼ˆï¼ï¹ï¼œï¼‰ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 127.0.0.1:443:5000 --name registry \</span><br><span class="line">    -v /var/lib/registry:/var/lib/registry \</span><br><span class="line">    -v `pwd`/certs:/certs \</span><br><span class="line">    -v $(pwd)/auth.htpasswd:/etc/docker/registry/auth.htpasswd \</span><br><span class="line">    -e REGISTRY_AUTH="&#123;htpasswd: &#123;realm: localhost, path: /etc/docker/registry/auth.htpasswd&#125;&#125;" \</span><br><span class="line">    -e REGISTRY_HTTP_ADDR=0.0.0.0:5000 \</span><br><span class="line">    -e REGISTRY_HTTP_TLS_CERTIFICATE=/certs/domain.crt \</span><br><span class="line">    -e REGISTRY_HTTP_TLS_KEY=/certs/domain.key \</span><br><span class="line">    -e REGISTRY_STORAGE_DELETE_ENABLED=true \</span><br><span class="line">    registry</span><br></pre></td></tr></table></figure><h4 id="docker-login"><a href="#docker-login" class="headerlink" title="docker login"></a>docker login</h4><p>è¿™ä¸€æ­¥æ˜¯ä¸ºäº†åœ¨ <code>~/.docker/.config.json</code> ï¼Œä¸­æ·»åŠ ä¸Š auth è®¤è¯ï¼Œåé¢ä½¿ç”¨ skopeo çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~/registry</span><br><span class="line">â•°â”€# docker login localhost -u root -p 123456</span><br><span class="line">]WARNING! Using --password via the CLI is insecure. Use --password-stdin.</span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line">â•­â”€root@sg-02 ~/registry</span><br><span class="line">â•°â”€# cat ~/.docker/config.json</span><br><span class="line">&#123;</span><br><span class="line">        "auths": &#123;</span><br><span class="line">                "https://registry.k8s.li/v2": &#123;</span><br><span class="line">                        "auth": "VlJFpmQE43Sw=="</span><br><span class="line">                &#125;,</span><br><span class="line">                "localhost": &#123;</span><br><span class="line">                        "auth": "cm9vdDoxMjM0NTY="</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "HttpHeaders": &#123;</span><br><span class="line">                "User-Agent": "Docker-Client/19.03.5 (linux)"</span><br><span class="line">        &#125;,</span><br><span class="line">        "experimental": "enabled"</span><br><span class="line">&#125;#</span><br></pre></td></tr></table></figure><h3 id="COPY-é•œåƒåˆ°-registry"><a href="#COPY-é•œåƒåˆ°-registry" class="headerlink" title="COPY é•œåƒåˆ° registry"></a>COPY é•œåƒåˆ° registry</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~/registry</span><br><span class="line">â•°â”€# skopeo copy docker://alpine:3.10 docker://localhost/library/alpine:3.10</span><br><span class="line">Getting image source signatures</span><br><span class="line">Copying blob 21c83c524219 done</span><br><span class="line">Copying config be4e4bea2c done</span><br><span class="line">Writing manifest to image destination</span><br><span class="line">Storing signatures</span><br></pre></td></tr></table></figure><h3 id="registry-å­˜å‚¨ç›®å½•é•¿ä»€ä¹ˆæ ·ğŸ¤”"><a href="#registry-å­˜å‚¨ç›®å½•é•¿ä»€ä¹ˆæ ·ğŸ¤”" class="headerlink" title="registry å­˜å‚¨ç›®å½•é•¿ä»€ä¹ˆæ ·ğŸ¤”"></a>registry å­˜å‚¨ç›®å½•é•¿ä»€ä¹ˆæ ·ğŸ¤”</h3><p><img src="img/registry-storage.jpeg" alt="img"></p><p>registry å®¹å™¨å†…çš„<code>/var/lib/registry/docker/registry/v2</code> å­˜å‚¨ç›®å½•ï¼Œç»“åˆä¸Šé¢è¿™å¼ å›¾ï¼Œé€šè¿‡ tree ç›®å½•æˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ï¼šregistry å­˜å‚¨ç›®å½•ä¸‹åªæœ‰ä¸¤ç§æ–‡ä»¶åçš„æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯ <code>data</code> æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯ <code>link</code> æ–‡ä»¶ã€‚å…¶ä¸­ link æ–‡ä»¶æ˜¯æ™®é€šçš„æ–‡æœ¬æ–‡ä»¶ï¼Œå­˜æ”¾åœ¨ <code>repositories</code> ç›®å½•ä¸‹ï¼Œå…¶å†…å®¹æ˜¯æŒ‡å‘ data æ–‡ä»¶çš„ sha256 digest å€¼ã€‚link æ–‡ä»¶æ˜¯ä¸æ˜¯æœ‰ç‚¹åƒ C è¯­è¨€ä¸­çš„æŒ‡é’ˆğŸ˜‚ï¼ˆå¤§é›¾ã€‚</p><p>data æ–‡ä»¶å­˜æ”¾åœ¨ <code>blobs</code> ç›®å½•ä¸‹æ–‡ä»¶åˆåˆ†ä¸ºäº†ä¸‰ç§æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯é•œåƒæ¯ä¸€å±‚çš„ <code>layer</code> æ–‡ä»¶å’Œé•œåƒçš„ <code>config</code> æ–‡ä»¶ï¼Œä»¥åŠé•œåƒçš„ <code>manifest</code> æ–‡ä»¶ã€‚</p><p>åœ¨ <code>repositories</code> ç›®å½•ä¸‹æ¯ä¸ªé•œåƒçš„ <code>_layers/sha256</code> ç›®å½•ä¸‹çš„æ–‡ä»¶å¤¹åæ˜¯é•œåƒçš„ layer å’Œ config æ–‡ä»¶çš„ digest ï¼Œè¯¥ç›®å½•ä¸‹çš„ link æ–‡ä»¶å°±æ˜¯æŒ‡å‘å¯¹åº” blobs ç›®å½•ä¸‹çš„ data æ–‡ä»¶ã€‚å½“æˆ‘ä»¬ pull ä¸€ä¸ªé•œåƒçš„ layer æ—¶ï¼Œæ˜¯é€šè¿‡ link æ–‡ä»¶æ‰¾åˆ° layer åœ¨ registry ä¸­å®é™…çš„å­˜å‚¨ä½ç½®çš„ã€‚</p><p>åœ¨ <code>_manifests</code> æ–‡ä»¶å¤¹ä¸‹çš„ tags å’Œ revisions ç›®å½•ä¸‹çš„ link æ–‡ä»¶åˆ™æŒ‡å‘è¯¥é•œåƒçš„ manifest æ–‡ä»¶ï¼Œä¿å­˜åœ¨æ‰€æœ‰å†å²é•œåƒ tag çš„ manifest æ–‡ä»¶ çš„ linkã€‚å½“åˆ é™¤ä¸€ä¸ªé•œåƒæ—¶ï¼Œåªä¼šåˆ é™¤è¯¥é•œåƒæœ€æ–°çš„ tag çš„ link æ–‡ä»¶ã€‚</p><p>tags ç›®å½•ä¸‹çš„æ–‡ä»¶å¤¹åä¾‹å¦‚ 3.10 ï¼Œå°±æ˜¯è¯¥é•œåƒçš„ tag ï¼Œåœ¨å®ƒçš„å­ç›®å½•ä¸‹çš„ current/link æ–‡ä»¶åˆ™è®°å½•äº†å½“å‰ tag æŒ‡å‘çš„ manifest æ–‡ä»¶çš„ä½ç½®ã€‚æ¯”å¦‚æˆ‘ä»¬çš„ alpine:latest é•œåƒï¼Œæ¯æ¬¡ push æ–°çš„ latest é•œåƒæ—¶ï¼Œcurrent/link éƒ½ä¼šæ›´æ–°æˆæŒ‡å‘æœ€æ–°é•œåƒçš„ manifest æ–‡ä»¶ã€‚</p><p>æˆ‘ä»¬åé¢è§‚å¯Ÿä¸€ä¸‹å½“åˆ é™¤ä¸€ä¸ªé•œåƒæ—¶ï¼Œè¿™äº›æ–‡ä»¶æ˜¯æ€ä¹ˆå˜åŒ–çš„ï¼Œå°±å¯ä»¥å¾—çŸ¥é€šè¿‡ registry API è¿›è¡Œ DELETE æ“ä½œå¯ä»¥è½¬æ¢æˆæ–‡ä»¶ç³»ç»Ÿå±‚é¢ä¸Šå¯¹ link æ–‡ä»¶çš„åˆ é™¤æ“ä½œã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~/registry</span><br><span class="line">â•°â”€# cd /var/lib/registry/docker/registry/v2</span><br><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ blobs</span><br><span class="line">â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 21</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ a1</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â””â”€â”€ be</span><br><span class="line">â”‚Â Â          â””â”€â”€ be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">â”‚Â Â              â””â”€â”€ data</span><br><span class="line">â””â”€â”€ repositories</span><br><span class="line">    â””â”€â”€ library</span><br><span class="line">        â””â”€â”€ alpine</span><br><span class="line">            â”œâ”€â”€ _layers</span><br><span class="line">            â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">            â”‚Â Â      â”œâ”€â”€ 21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â””â”€â”€ link</span><br><span class="line">            â”‚Â Â      â””â”€â”€ be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">            â”‚Â Â          â””â”€â”€ link</span><br><span class="line">            â”œâ”€â”€ _manifests</span><br><span class="line">            â”‚Â Â  â”œâ”€â”€ revisions</span><br><span class="line">            â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">            â”‚Â Â  â”‚Â Â      â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">            â”‚Â Â  â”‚Â Â          â””â”€â”€ link</span><br><span class="line">            â”‚Â Â  â””â”€â”€ tags</span><br><span class="line">            â”‚Â Â      â””â”€â”€ 3.10</span><br><span class="line">            â”‚Â Â          â”œâ”€â”€ current</span><br><span class="line">            â”‚Â Â          â”‚Â Â  â””â”€â”€ link</span><br><span class="line">            â”‚Â Â          â””â”€â”€ index</span><br><span class="line">            â”‚Â Â              â””â”€â”€ sha256</span><br><span class="line">            â”‚Â Â                  â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">            â”‚Â Â                      â””â”€â”€ link</span><br><span class="line">            â””â”€â”€ _uploads</span><br><span class="line"></span><br><span class="line">26 directories, 8 files</span><br></pre></td></tr></table></figure><ul><li><code>blobs</code> å­˜å‚¨ç›®å½•ï¼Œå­˜æ”¾äº†é•œåƒçš„ä¸‰ä¸ªå¿…é¡»æ–‡ä»¶ï¼Œ<code>layer</code>ï¼Œ<code>manifest</code>ï¼Œ<code>config</code>ã€‚é€šè¿‡æ–‡ä»¶å¤§å°æˆ‘ä»¬å¯ä»¥å¤§è‡´åœ°æ¨ç®—å‡ºæœ€å¤§çš„ 2.7M æ˜¯é•œåƒçš„ layer ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# find . -name "data" -exec ls -sh &#123;&#125; \;</span><br><span class="line">2.7M ./blobs/sha256/21/21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d/data</span><br><span class="line">4.0K ./blobs/sha256/a1/a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590/data</span><br><span class="line">4.0K ./blobs/sha256/be/be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c/data</span><br></pre></td></tr></table></figure><ul><li><code>image layer</code> æ–‡ä»¶ï¼Œæ˜¯ gzip æ ¼å¼çš„ tar åŒ…ï¼Œæ˜¯é•œåƒå±‚çœŸå®å†…å®¹çš„ <code>tar.gzip</code> æ ¼å¼å­˜å‚¨å½¢å¼ã€‚</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./blobs/sha256/21/21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d/data: gzip compressed data</span><br></pre></td></tr></table></figure><ul><li><code>image manifest</code> æ–‡ä»¶ï¼Œjson æ–‡ä»¶æ ¼å¼çš„ï¼Œå­˜æ”¾è¯¥é•œåƒ <code>layer</code> å’Œ  <code>image config</code> æ–‡ä»¶çš„ç´¢å¼•ã€‚</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# cat ./blobs/sha256/a1/a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590/data</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">   <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.container.image.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">1509</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">2795580</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;#</span><br></pre></td></tr></table></figure><ul><li><code>image config</code> æ–‡ä»¶ï¼Œjson æ ¼å¼çš„ã€‚æ˜¯æ„å»ºæ—¶ç”Ÿæˆçš„ï¼Œæ ¹æ® <code>Dockerfile</code> å’Œå®¿ä¸»æœºçš„ä¸€äº›ä¿¡æ¯ï¼Œä»¥åŠä¸€äº›æ„å»ºè¿‡ç¨‹ä¸­çš„å®¹å™¨å¯ä»¥ç”Ÿæˆ digest å”¯ä¸€çš„ <code>image config</code> æ–‡ä»¶ã€‚ä»”ç»†çœ‹è¿™ä¸ª image config æ–‡ä»¶æ˜¯ä¸æ˜¯æœ‰ç‚¹ç–‘æƒ‘ï¼Œæ— è®ºæ˜¯ manifest è¿˜æ˜¯ config æ–‡ä»¶é‡Œé¢çš„å†…å®¹å‹æ ¹å°±æ²¡æœ‰é•œåƒçš„åç§°å’Œ tag ã€‚å…¶å®ï¼Œé•œåƒå°±å¥½æ¯”ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶çš„å†…å®¹å’Œæ–‡ä»¶åæ¯«æ— å…³ç³»ã€‚åœ¨ registry ä¸­ï¼Œæ˜¯é€šè¿‡è·¯å¾„åçš„æ–¹å¼æ¥å¯¹ä¸€ä¸ªé•œåƒè¿›è¡Œå‘½åçš„ã€‚å½“æˆ‘ä»¬å¾€ registry ä¸­ PUSH ä¸€ä¸ªé•œåƒæ—¶ï¼Œä»¥<code>localhost/library/alpine:3.10</code>ä¸ºä¾‹ï¼Œ<code>localhost</code>ï¼Œå°±æ˜¯è¯¥ registry çš„åŸŸåæˆ–è€… URL ï¼Œ<code>library</code>å°±æ˜¯ project ï¼Œ<code>alpine:3.10</code>å°±æ˜¯é•œåƒåå’Œé•œåƒçš„ tagã€‚registry ä¼šæ ¹æ® <code>localhost/library/alpine:3.10</code> åœ¨<code>repositories</code> ç›®å½•ä¸‹ä¾æ¬¡åˆ›å»ºç›¸åº”çš„ç›®å½•ã€‚</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# cat ./blobs/sha256/be/be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c/data | jq "."</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">  <span class="attr">"config"</span>: &#123;</span><br><span class="line">    <span class="attr">"Hostname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"User"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"/bin/sh"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"ArgsEscaped"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"Image"</span>: <span class="string">"sha256:d928e20e1fbe5142bb5cdf594862271673133c5354950d6a8f74afed24df4c23"</span>,</span><br><span class="line">    <span class="attr">"Volumes"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Entrypoint"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OnBuild"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"Labels"</span>: <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"container"</span>: <span class="string">"37e3972c75360676982c8f6591b66a9097719e5ad4cecd5fa63ad4f06472825f"</span>,</span><br><span class="line">  <span class="attr">"container_config"</span>: &#123;</span><br><span class="line">    <span class="attr">"Hostname"</span>: <span class="string">"37e3972c7536"</span>,</span><br><span class="line">    <span class="attr">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"User"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"/bin/sh"</span>,</span><br><span class="line">      <span class="string">"-c"</span>,</span><br><span class="line">      <span class="string">"#(nop) "</span>,</span><br><span class="line">      <span class="string">"CMD [\"/bin/sh\"]"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"ArgsEscaped"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"Image"</span>: <span class="string">"sha256:d928e20e1fbe5142bb5cdf594862271673133c5354950d6a8f74afed24df4c23"</span>,</span><br><span class="line">    <span class="attr">"Volumes"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Entrypoint"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OnBuild"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"Labels"</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"created"</span>: <span class="string">"2020-04-24T01:05:21.571691552Z"</span>,</span><br><span class="line">  <span class="attr">"docker_version"</span>: <span class="string">"18.09.7"</span>,</span><br><span class="line">  <span class="attr">"history"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-04-24T01:05:21.178437685Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop) ADD file:66a440394c2442570f1f060e25c86613cb2d88a8af0c71c5a4154b3570e9a805 in / "</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-04-24T01:05:21.571691552Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop)  CMD [\"/bin/sh\"]"</span>,</span><br><span class="line">      <span class="attr">"empty_layer"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">  <span class="attr">"rootfs"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"layers"</span>,</span><br><span class="line">    <span class="attr">"diff_ids"</span>: [</span><br><span class="line">      <span class="string">"sha256:1b3ee35aacca9866b01dd96e870136266bde18006ac2f0d6eb706c798d1fa3c3"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æˆ‘ä»¬å†å¾€ registry ä¸­ COPY ä¸€ä¸ªé•œåƒï¼Œæ–¹ä¾¿åé¢çš„åˆ†æè¿‡ç¨‹ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">skopeo copy docker://debian:buster-slim docker://localhost/library/debian:buster-slim</span><br></pre></td></tr></table></figure><ul><li>è¿™æ˜¯ registry ä¸­å°±åªæœ‰ <code>alpine:3.10</code> å’Œ <code>debian:buster-slim</code>è¿™ä¸¤ä¸ªåŸºç¡€é•œåƒï¼Œæ­¤æ—¶çš„ registry å­˜å‚¨ç›®å½•çš„ç»“æ„å¦‚ä¸‹ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ blobs</span><br><span class="line">â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 21</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 43</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 43e3995ee54ac008271bfcf2d8ac7278c33f4c5e83d2f02bfcddd350034e3357</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 7c</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 7c459309b9a5ec1683ef3b137f39ce5888f5ad0384e488ad73c94e0243bc77d4</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 85</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 8559a31e96f442f2c7b6da49d6c84705f98a39d8be10b3f5f14821d0ee8417df</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ a1</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â””â”€â”€ be</span><br><span class="line">â”‚Â Â          â””â”€â”€ be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">â”‚Â Â              â””â”€â”€ data</span><br><span class="line">â””â”€â”€ repositories</span><br><span class="line">    â””â”€â”€ library</span><br><span class="line">        â”œâ”€â”€ alpine</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ _layers</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â”‚Â Â  â””â”€â”€ link</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â””â”€â”€ be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">        â”‚Â Â  â”‚Â Â          â””â”€â”€ link</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ _manifests</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”œâ”€â”€ revisions</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”‚Â Â      â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”‚Â Â          â””â”€â”€ link</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â””â”€â”€ tags</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â””â”€â”€ 3.10</span><br><span class="line">        â”‚Â Â  â”‚Â Â          â”œâ”€â”€ current</span><br><span class="line">        â”‚Â Â  â”‚Â Â          â”‚Â Â  â””â”€â”€ link</span><br><span class="line">        â”‚Â Â  â”‚Â Â          â””â”€â”€ index</span><br><span class="line">        â”‚Â Â  â”‚Â Â              â””â”€â”€ sha256</span><br><span class="line">        â”‚Â Â  â”‚Â Â                  â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">        â”‚Â Â  â”‚Â Â                      â””â”€â”€ link</span><br><span class="line">        â”‚Â Â  â””â”€â”€ _uploads</span><br><span class="line">        â””â”€â”€ debian</span><br><span class="line">            â”œâ”€â”€ _layers</span><br><span class="line">            â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">            â”‚Â Â      â”œâ”€â”€ 43e3995ee54ac008271bfcf2d8ac7278c33f4c5e83d2f02bfcddd350034e3357</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â””â”€â”€ link</span><br><span class="line">            â”‚Â Â      â””â”€â”€ 8559a31e96f442f2c7b6da49d6c84705f98a39d8be10b3f5f14821d0ee8417df</span><br><span class="line">            â”‚Â Â          â””â”€â”€ link</span><br><span class="line">            â”œâ”€â”€ _manifests</span><br><span class="line">            â”‚Â Â  â”œâ”€â”€ revisions</span><br><span class="line">            â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">            â”‚Â Â  â”‚Â Â      â””â”€â”€ 7c459309b9a5ec1683ef3b137f39ce5888f5ad0384e488ad73c94e0243bc77d4</span><br><span class="line">            â”‚Â Â  â”‚Â Â          â””â”€â”€ link</span><br><span class="line">            â”‚Â Â  â””â”€â”€ tags</span><br><span class="line">            â”‚Â Â      â””â”€â”€ buster-slim</span><br><span class="line">            â”‚Â Â          â”œâ”€â”€ current</span><br><span class="line">            â”‚Â Â          â”‚Â Â  â””â”€â”€ link</span><br><span class="line">            â”‚Â Â          â””â”€â”€ index</span><br><span class="line">            â”‚Â Â              â””â”€â”€ sha256</span><br><span class="line">            â”‚Â Â                  â””â”€â”€ 7c459309b9a5ec1683ef3b137f39ce5888f5ad0384e488ad73c94e0243bc77d4</span><br><span class="line">            â”‚Â Â                      â””â”€â”€ link</span><br><span class="line">            â””â”€â”€ _uploads</span><br><span class="line"></span><br><span class="line">48 directories, 16 files</span><br></pre></td></tr></table></figure><h3 id="DELETE-é•œåƒ"><a href="#DELETE-é•œåƒ" class="headerlink" title="DELETE é•œåƒ"></a>DELETE é•œåƒ</h3><ul><li>é€šè¿‡ <code>skopeo delete</code> åˆ é™¤é•œåƒï¼Œæ³¨æ„ï¼Œé€šè¿‡ registry çš„ API åˆ é™¤é•œåƒæ¯æ¬¡åªèƒ½åˆ é™¤ä¸€ä¸ª tag çš„é•œåƒã€‚</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# skopeo delete docker://localhost/library/alpine:3.10 --debug</span><br><span class="line">DEBU[0000] Returning credentials from /run/containers/0/auth.json</span><br><span class="line">DEBU[0000] Using registries.d directory /etc/containers/registries.d for sigstore configuration</span><br><span class="line">DEBU[0000]  No signature storage configuration found for localhost/library/alpine:3.10</span><br><span class="line">DEBU[0000] Looking for TLS certificates and private keys in /etc/docker/certs.d/localhost</span><br><span class="line">DEBU[0000] Loading registries configuration "/etc/containers/registries.conf"</span><br><span class="line">DEBU[0000] GET https://localhost/v2/</span><br><span class="line">DEBU[0000] Ping https://localhost/v2/ status 401</span><br><span class="line">DEBU[0000] GET https://localhost/v2/library/alpine/manifests/3.10</span><br><span class="line">DEBU[0000] DELETE https://localhost/v2/library/alpine/manifests/sha256:a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br></pre></td></tr></table></figure><ul><li>å†çœ‹ä¸€ä¸‹åˆ é™¤åçš„ registry å­˜å‚¨ç›®å½•ä¸‹çš„ alpine ç›®å½•é‡Œéƒ½å°‘äº†å“ªäº›ä¸œä¸œï¼Ÿ</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ blobs</span><br><span class="line">â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 21</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 43</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 43e3995ee54ac008271bfcf2d8ac7278c33f4c5e83d2f02bfcddd350034e3357</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 7c</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 7c459309b9a5ec1683ef3b137f39ce5888f5ad0384e488ad73c94e0243bc77d4</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 85</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 8559a31e96f442f2c7b6da49d6c84705f98a39d8be10b3f5f14821d0ee8417df</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ a1</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â””â”€â”€ be</span><br><span class="line">â”‚Â Â          â””â”€â”€ be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">â”‚Â Â              â””â”€â”€ data</span><br><span class="line">â””â”€â”€ repositories</span><br><span class="line">    â””â”€â”€ library</span><br><span class="line">        â”œâ”€â”€ alpine</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ _layers</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â”‚Â Â  â””â”€â”€ link</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â””â”€â”€ be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">        â”‚Â Â  â”‚Â Â          â””â”€â”€ link</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ _manifests</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”œâ”€â”€ revisions</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”‚Â Â      â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â””â”€â”€ tags</span><br><span class="line">        â”‚Â Â  â””â”€â”€ _uploads</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ skopeo delete ä¸€ä¸ªé•œåƒçš„æ—¶å€™ï¼Œåªå¯¹ <code>_manifests</code> ä¸‹çš„ link æ–‡ä»¶è¿›è¡Œäº†æ“ä½œï¼Œåˆ é™¤çš„éƒ½æ˜¯å¯¹è¯¥ tag é•œåƒ manifest æ–‡ä»¶å¤¹ä¸‹çš„ link æ–‡ä»¶ï¼Œå®é™…ä¸Š manifest æ–‡ä»¶å¹¶æ²¡æœ‰ä» blobs ç›®å½•ä¸‹åˆ é™¤ï¼Œåªæ˜¯åˆ é™¤äº†è¯¥é•œåƒçš„ manifest æ–‡ä»¶çš„å¼•ç”¨ã€‚åˆ é™¤ä¸€ä¸ªé•œåƒåï¼Œtags ç›®å½•ä¸‹çš„ tag åç›®å½•å°±è¢«åˆ é™¤äº†ï¼Œ_manifests/revisions ç›®å½•ä¸‹çš„ link æ–‡ä»¶ä¹Ÿè¢«åˆ é™¤äº†ã€‚å®é™…ä¸Šä¸¤è€…åˆ é™¤çš„æ˜¯åŒä¸€ä¸ªå†…å®¹ï¼Œå³å¯¹è¯¥é•œåƒ manifest æ–‡ä»¶çš„ link æ–‡ä»¶ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DEBU[0000] DELETE https://localhost/v2/library/alpine/manifests/sha256:a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢æ–‡ä»¶çš„å˜åŒ–å¯ä»¥å¾—å‡ºï¼Œé€šè¿‡ registry API æ¥ DELETE ä¸€ä¸ªé•œåƒå®è´¨ä¸Šæ˜¯åˆ é™¤ repositories å…ƒæ•°æ®æ–‡ä»¶å¤¹ä¸‹çš„ tag åæ–‡ä»¶å¤¹å’Œè¯¥ tag çš„ revisions ä¸‹çš„ link æ–‡ä»¶ã€‚</p><h2 id="registry-GC-åŸç†"><a href="#registry-GC-åŸç†" class="headerlink" title="registry GC åŸç†"></a>registry GC åŸç†</h2><p>ä¸Šé¢å·´æ‹‰å·´æ‹‰æ‰¯äº†ä¸€é€šä¹Ÿè®¸ä½ ç°åœ¨ä¸€å¤´é›¾æ°´ï¼Œè¿™å’Œä»Šå¤©çš„ä¸»é¢˜ registry GC åŸç†æ¯›å…³ç³»ï¼ŸğŸ˜‚ï¼Œå…¶å®æƒ³è¦ä»æ–‡ä»¶ç³»ç»Ÿå±‚é¢æ¥ç†è§£ registry GC ï¼Œä¸Šé¢çš„çŸ¥è¯†æ˜¯å¿…å¤‡çš„ï¼ˆ<em>^____^</em>ï¼‰ã€‚</p><h3 id="GC-æ˜¯å¼„å•¥å’§ï¼ŸğŸ¤”"><a href="#GC-æ˜¯å¼„å•¥å’§ï¼ŸğŸ¤”" class="headerlink" title="GC æ˜¯å¼„å•¥å’§ï¼ŸğŸ¤”"></a>GC æ˜¯å¼„å•¥å’§ï¼ŸğŸ¤”</h3><p>GC å˜›ï¼Œå°±æ˜¯åƒåœ¾å›æ”¶çš„æ„æ€ï¼Œä» docker å®˜æ–¹æ–‡æ¡£ <a href="https://docs.docker.com/registry/garbage-collection/" target="_blank" rel="noopener">Garbage collection</a> å·æ¥çš„ example ğŸ˜‚æ¥è§£é‡Šä¸€ä¸‹å§ã€‚</p><ul><li>å‡å¦‚é•œåƒ A å’Œé•œåƒ B ï¼Œä»–ä¿©åˆ†åˆ«å¼•ç”¨äº†layer aï¼Œbå’Œ aï¼Œcã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A -----&gt; a &lt;----- B</span><br><span class="line">    \--&gt; b     |</span><br><span class="line">         c &lt;--&#x2F;</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡ registry API åˆ é™¤é•œåƒ B ä¹‹åï¼Œlayer c å¹¶æ²¡æœ‰åˆ æ‰ï¼Œåªæ˜¯åˆ æ‰äº†å¯¹å®ƒçš„å¼•ç”¨ï¼Œæ‰€ä»¥ c æ˜¯å¤šä½™çš„ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A -----&gt; a     B</span><br><span class="line">    \--&gt; b</span><br><span class="line">         c</span><br></pre></td></tr></table></figure><ul><li>GC ä¹‹åï¼Œlayer c å°±è¢«åˆ æ‰äº†ï¼Œç°åœ¨å°±æ²¡æœ‰æ— ç”¨çš„ layer äº†ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A -----&gt; a</span><br><span class="line">    \--&gt; b</span><br></pre></td></tr></table></figure><h3 id="GC-çš„è¿‡ç¨‹"><a href="#GC-çš„è¿‡ç¨‹" class="headerlink" title="GC çš„è¿‡ç¨‹"></a>GC çš„è¿‡ç¨‹</h3><p>ç¿»ä¸€ä¸‹ registry  GC çš„æºç  <a href="https://github.com/docker/distribution/blob/master/registry/storage/garbagecollect.go" target="_blank" rel="noopener">garbagecollect.go</a>ï¼Œå¯ä»¥çœ‹åˆ° GC çš„ä¸»è¦åˆ†ä¸¤ä¸ªé˜¶æ®µï¼Œmarking å’Œ sweepã€‚</p><h4 id="marking"><a href="#marking" class="headerlink" title="marking"></a>marking</h4><p>marking é˜¶æ®µæ˜¯æ‰«ææ‰€æœ‰çš„ manifest æ–‡ä»¶ï¼Œæ ¹æ®ä¸Šæ–‡æˆ‘ä»¬æåˆ°çš„ link æ–‡ä»¶ï¼Œé€šè¿‡æ‰«ææ‰€æœ‰é•œåƒ tags ç›®å½•ä¸‹çš„ link æ–‡ä»¶å°±å¯ä»¥å¾—åˆ°è¿™äº›é•œåƒçš„ manifestï¼Œåœ¨ manifest ä¸­ä¿å­˜åœ¨è¯¥é•œåƒæ‰€æœ‰çš„ layer å’Œ config æ–‡ä»¶çš„ digest å€¼ï¼ŒæŠŠè¿™äº›å€¼æ ‡è®°ä¸º<strong>ä¸èƒ½æ¸…é™¤</strong>ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mark</span></span><br><span class="line">markSet := <span class="built_in">make</span>(<span class="keyword">map</span>[digest.Digest]<span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">manifestArr := <span class="built_in">make</span>([]ManifestDel, <span class="number">0</span>)</span><br><span class="line">err := repositoryEnumerator.Enumerate(ctx, <span class="function"><span class="keyword">func</span><span class="params">(repoName <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">emit(repoName)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> err error</span><br><span class="line">named, err := reference.WithName(repoName)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">"failed to parse repo name %s: %v"</span>, repoName, err)</span><br><span class="line">&#125;</span><br><span class="line">repository, err := registry.Repository(ctx, named)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">"failed to construct repository: %v"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">manifestService, err := repository.Manifests(ctx)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">"failed to construct manifest service: %v"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">manifestEnumerator, ok := manifestService.(distribution.ManifestEnumerator)</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">"unable to convert ManifestService into ManifestEnumerator"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€é˜¶æ®µç”¨ shell è„šæœ¬æ¥å®ç°çš„è¯å¤§è‡´å¯ä»¥è¿™æ ·æ¥æï¼Œä½¿ç”¨ shell å»éå†è¿™äº› manifest ï¼Œç„¶åå† grep å‡ºæ‰€æœ‰çš„ sha256 å€¼å°±èƒ½å¾—åˆ°è¿™ä¸ªé•œåƒæ‰€æœ‰çš„ blobs ç›®å½•ä¸‹çš„ data æ–‡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">set -x</span><br><span class="line">v2=$&#123;v2:="/var/lib/registry/docker/registry/v2"&#125;</span><br><span class="line">cd $&#123;v2&#125;</span><br><span class="line">all_blobs=/tmp/all_blobs.list</span><br><span class="line">echo "" &gt; $&#123;all_blobs&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> marking all the blob by all images manifest</span></span><br><span class="line">for tag in $(find repositories -name "link" | grep current)</span><br><span class="line">do</span><br><span class="line">    link=$(cat $&#123;tag&#125; | cut -c8-71)</span><br><span class="line">    mfs=blobs/sha256/$&#123;link:0:2&#125;/$&#123;link&#125;/data</span><br><span class="line">    echo $&#123;link&#125; &gt;&gt; $&#123;all_blobs&#125;</span><br><span class="line">    grep sha256 $&#123;mfs&#125; |cut -d "\"" -f4 | cut -c8-71 &gt;&gt; $&#123;all_blobs&#125;</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h4 id="sweep"><a href="#sweep" class="headerlink" title="sweep"></a>sweep</h4><p>ç¬¬äºŒé˜¶æ®µå°±æ˜¯åˆ é™¤æ“ä½œå•¦ï¼Œmarking å®Œä¹‹åï¼Œæ²¡æœ‰æ ‡è®° blobï¼ˆ layer å’Œ config æ–‡ä»¶ï¼‰å°±ä¼šè¢«æ¸…é™¤æ‰ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sweep</span></span><br><span class="line">vacuum := NewVacuum(ctx, storageDriver)</span><br><span class="line"><span class="keyword">if</span> !opts.DryRun &#123;</span><br><span class="line"><span class="keyword">for</span> _, obj := <span class="keyword">range</span> manifestArr &#123;</span><br><span class="line">err = vacuum.RemoveManifest(obj.Name, obj.Digest, obj.Tags)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">"failed to delete manifest %s: %v"</span>, obj.Digest, err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">blobService := registry.Blobs()</span><br><span class="line">deleteSet := <span class="built_in">make</span>(<span class="keyword">map</span>[digest.Digest]<span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">err = blobService.Enumerate(ctx, <span class="function"><span class="keyword">func</span><span class="params">(dgst digest.Digest)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="comment">// check if digest is in markSet. If not, delete it!</span></span><br><span class="line"><span class="keyword">if</span> _, ok := markSet[dgst]; !ok &#123;</span><br><span class="line">deleteSet[dgst] = <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="img/registry-gc.png" alt=""></p><h3 id="GC-éƒ½å¹²äº†å•¥ï¼Ÿ"><a href="#GC-éƒ½å¹²äº†å•¥ï¼Ÿ" class="headerlink" title="GC éƒ½å¹²äº†å•¥ï¼Ÿ"></a>GC éƒ½å¹²äº†å•¥ï¼Ÿ</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¿›è¡Œå®é™…çš„ GC æ“ä½œï¼Œè¿›å…¥åˆ° registry å®¹å™¨ä¸­ï¼Œä½¿ç”¨ registry garbage-collect è¿™ä¸ªå­å‘½ä»¤è¿›è¡Œæ“ä½œã€‚</p><h4 id="marking-1"><a href="#marking-1" class="headerlink" title="marking"></a>marking</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-<span class="number">02</span> /<span class="keyword">var</span>/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# docker exec -it registry sh</span><br><span class="line">/ # registry garbage-collect -m --delete-untagged=true /etc/docker/registry/<span class="keyword">config</span><span class="variable">.yml</span></span><br><span class="line"><span class="keyword">library</span>/alpine</span><br><span class="line"><span class="keyword">library</span>/debian</span><br><span class="line"><span class="keyword">library</span>/debian: marking manifest sha256:<span class="number">7</span>c459309b9a5ec1683ef3b137f39ce5888f5ad0384e488ad73c94e0243bc77d4</span><br><span class="line"><span class="keyword">library</span>/debian: marking blob sha256:<span class="number">43</span>e3995ee54ac008271bfcf2d8ac7278c33f4c5e83d2f02bfcddd350034e3357</span><br><span class="line"><span class="keyword">library</span>/debian: marking blob sha256:<span class="number">8559</span>a31e96f442f2c7b6da49d6c84705f98a39d8be10b3f5f14821d0ee8417df</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> blobs marked, <span class="number">3</span> blobs <span class="keyword">and</span> <span class="number">0</span> manifests eligible <span class="keyword">for</span> deletion</span><br></pre></td></tr></table></figure><h4 id="sweep-1"><a href="#sweep-1" class="headerlink" title="sweep"></a>sweep</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">blob eligible for deletion: sha256:a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">INFO[0000] Deleting blob: &#x2F;docker&#x2F;registry&#x2F;v2&#x2F;blobs&#x2F;sha256&#x2F;a1&#x2F;a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590  go.version&#x3D;go1.11.2 instance.id&#x3D;3ad15352-7cb7-46ca-a5ae-e5e16c6485a5 service&#x3D;registry</span><br><span class="line">blob eligible for deletion: sha256:be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">INFO[0000] Deleting blob: &#x2F;docker&#x2F;registry&#x2F;v2&#x2F;blobs&#x2F;sha256&#x2F;be&#x2F;be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c  go.version&#x3D;go1.11.2 instance.id&#x3D;3ad15352-7cb7-46ca-a5ae-e5e16c6485a5 service&#x3D;registry</span><br><span class="line">blob eligible for deletion: sha256:21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">INFO[0000] Deleting blob: &#x2F;docker&#x2F;registry&#x2F;v2&#x2F;blobs&#x2F;sha256&#x2F;21&#x2F;21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d  go.version&#x3D;go1.11.2 instance.id&#x3D;3ad15352-7cb7-46ca-a5ae-e5e16c6485a5 service&#x3D;registry</span><br></pre></td></tr></table></figure><h4 id="GC-ä¹‹åçš„-registry-å­˜å‚¨ç›®å½•é•¿ä»€ä¹ˆæ ·ï¼Ÿ"><a href="#GC-ä¹‹åçš„-registry-å­˜å‚¨ç›®å½•é•¿ä»€ä¹ˆæ ·ï¼Ÿ" class="headerlink" title="GC ä¹‹åçš„ registry å­˜å‚¨ç›®å½•é•¿ä»€ä¹ˆæ ·ï¼Ÿ"></a>GC ä¹‹åçš„ registry å­˜å‚¨ç›®å½•é•¿ä»€ä¹ˆæ ·ï¼Ÿ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# tree                                                                                     </span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ blobs</span><br><span class="line">â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 21</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 43</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 43e3995ee54ac008271bfcf2d8ac7278c33f4c5e83d2f02bfcddd350034e3357</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 7c</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 7c459309b9a5ec1683ef3b137f39ce5888f5ad0384e488ad73c94e0243bc77d4</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 85</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ 8559a31e96f442f2c7b6da49d6c84705f98a39d8be10b3f5f14821d0ee8417df</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ a1</span><br><span class="line">â”‚Â Â      â””â”€â”€ be</span><br><span class="line">â””â”€â”€ repositories</span><br><span class="line">    â””â”€â”€ library</span><br><span class="line">        â”œâ”€â”€ alpine</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ _layers</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 21c83c5242199776c232920ddb58cfa2a46b17e42ed831ca9001c8dbc532d22d</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â”‚Â Â  â””â”€â”€ link</span><br><span class="line">        â”‚Â Â  â”‚Â Â      â””â”€â”€ be4e4bea2c2e15b403bb321562e78ea84b501fb41497472e91ecb41504e8a27c</span><br><span class="line">        â”‚Â Â  â”‚Â Â          â””â”€â”€ link</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ _manifests</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”œâ”€â”€ revisions</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â”‚Â Â      â””â”€â”€ a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">        â”‚Â Â  â”‚Â Â  â””â”€â”€ tags</span><br><span class="line">        â”‚Â Â  â””â”€â”€ _uploads</span><br><span class="line">        â””â”€â”€ debian</span><br><span class="line">            â”œâ”€â”€ _layers</span><br><span class="line">            â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">            â”‚Â Â      â”œâ”€â”€ 43e3995ee54ac008271bfcf2d8ac7278c33f4c5e83d2f02bfcddd350034e3357</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â””â”€â”€ link</span><br><span class="line">            â”‚Â Â      â””â”€â”€ 8559a31e96f442f2c7b6da49d6c84705f98a39d8be10b3f5f14821d0ee8417df</span><br><span class="line">            â”‚Â Â          â””â”€â”€ link</span><br><span class="line">            â”œâ”€â”€ _manifests</span><br><span class="line">            â”‚Â Â  â”œâ”€â”€ revisions</span><br><span class="line">            â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">            â”‚Â Â  â”‚Â Â      â””â”€â”€ 7c459309b9a5ec1683ef3b137f39ce5888f5ad0384e488ad73c94e0243bc77d4</span><br><span class="line">            â”‚Â Â  â”‚Â Â          â””â”€â”€ link</span><br><span class="line">            â”‚Â Â  â””â”€â”€ tags</span><br><span class="line">            â”‚Â Â      â””â”€â”€ buster-slim</span><br><span class="line">            â”‚Â Â          â”œâ”€â”€ current</span><br><span class="line">            â”‚Â Â          â”‚Â Â  â””â”€â”€ link</span><br><span class="line">            â”‚Â Â          â””â”€â”€ index</span><br><span class="line">            â”‚Â Â              â””â”€â”€ sha256</span><br><span class="line">            â”‚Â Â                  â””â”€â”€ 7c459309b9a5ec1683ef3b137f39ce5888f5ad0384e488ad73c94e0243bc77d4</span><br><span class="line">            â”‚Â Â                      â””â”€â”€ link</span><br><span class="line">            â””â”€â”€ _uploads</span><br><span class="line"></span><br><span class="line">40 directories, 10 files</span><br></pre></td></tr></table></figure><p>æ ¹æ® GC åçš„ registry å­˜å‚¨ç›®å½•æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒåŸæœ¬ blobs ç›®å½•ä¸‹æœ‰ 6 ä¸ª data æ–‡ä»¶ï¼Œç°åœ¨å·²ç»å˜æˆäº† 3 ä¸ªï¼Œalpine:3.10 è¿™ä¸ªé•œåƒç›¸å…³çš„ layerã€configã€manifest è¿™ä¸‰ä¸ªæ–‡ä»¶éƒ½å·²ç»è¢« GC æ‰äº†ã€‚ä½†æ˜¯åœ¨ repositories ç›®å½•ä¸‹ï¼Œè¯¥é•œåƒçš„ _layers ä¸‹çš„ link æ–‡ä»¶ä¾æ—§å­˜åœ¨ğŸ¤”ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ€»ç»“ä»¥ä¸Šï¼Œç”¨ä¸‹é¢è¿™ä¸‰å¼ å›¾ç‰‡å°±èƒ½ç›´è§‚åœ°ç†è§£è¿™äº›è¿‡ç¨‹å•¦ã€‚</p><h4 id="delete-é•œåƒä¹‹å‰çš„-registry-å­˜å‚¨ç›®å½•ç»“æ„"><a href="#delete-é•œåƒä¹‹å‰çš„-registry-å­˜å‚¨ç›®å½•ç»“æ„" class="headerlink" title="delete é•œåƒä¹‹å‰çš„ registry å­˜å‚¨ç›®å½•ç»“æ„"></a>delete é•œåƒä¹‹å‰çš„ registry å­˜å‚¨ç›®å½•ç»“æ„</h4><p><img src="img/registry-gc-1.jpeg" alt="REGISTRY"></p><h4 id="delete-é•œåƒä¹‹åçš„-registry-å­˜å‚¨ç›®å½•ç»“æ„"><a href="#delete-é•œåƒä¹‹åçš„-registry-å­˜å‚¨ç›®å½•ç»“æ„" class="headerlink" title="delete é•œåƒä¹‹åçš„ registry å­˜å‚¨ç›®å½•ç»“æ„"></a>delete é•œåƒä¹‹åçš„ registry å­˜å‚¨ç›®å½•ç»“æ„</h4><p><img src="img/registry-gc-2.jpeg" alt=""></p><h4 id="GC-ä¹‹åçš„-registry-å­˜å‚¨ç›®å½•ç»“æ„"><a href="#GC-ä¹‹åçš„-registry-å­˜å‚¨ç›®å½•ç»“æ„" class="headerlink" title="GC ä¹‹åçš„ registry å­˜å‚¨ç›®å½•ç»“æ„"></a>GC ä¹‹åçš„ registry å­˜å‚¨ç›®å½•ç»“æ„</h4><p><img src="img/registry-gc-3.jpeg" alt=""></p><h3 id="shell-å¤§æ³•å¥½ï¼"><a href="#shell-å¤§æ³•å¥½ï¼" class="headerlink" title="shell å¤§æ³•å¥½ï¼"></a>shell å¤§æ³•å¥½ï¼</h3><p>æ ¹æ®ä¸Šé¢çš„ GC åŸç†å’Œè¿‡ç¨‹ï¼Œå®é™…ä¸Šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸åˆ° 25 è¡Œçš„ shell è„šæœ¬æ¥å®ç°ä¸€ä¸ªç²—æš´çš„  GC ğŸ˜‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">set -x</span><br><span class="line">v2=$1</span><br><span class="line">v2=$&#123;v2:="/var/lib/registry/docker/registry/v2"&#125;</span><br><span class="line">cd $&#123;v2&#125;</span><br><span class="line">all_blobs=/tmp/all_blobs.list</span><br><span class="line">: &gt; $&#123;all_blobs&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> marking all the blob by all images manifest</span></span><br><span class="line">for tag in $(find repositories -name "link" | grep current)</span><br><span class="line">do</span><br><span class="line">    link=$(cat $&#123;tag&#125; | cut -c8-71)</span><br><span class="line">    mfs=blobs/sha256/$&#123;link:0:2&#125;/$&#123;link&#125;/data</span><br><span class="line">    echo $&#123;link&#125; &gt;&gt; $&#123;all_blobs&#125;</span><br><span class="line">    grep sha256 $&#123;mfs&#125; |cut -d "\"" -f4 | cut -c8-71 &gt;&gt; $&#123;all_blobs&#125;</span><br><span class="line">done</span><br><span class="line"><span class="meta">#</span><span class="bash"> delete blob <span class="keyword">if</span> the blob doesn<span class="string">'t exist in all_blobs.list</span></span></span><br><span class="line">for blob in $(find blobs -name "data" | cut -d "/" -f4)</span><br><span class="line">do</span><br><span class="line">    grep $&#123;blob&#125; $&#123;all_blobs&#125;</span><br><span class="line">    if [[ $? != 0 ]]; then</span><br><span class="line">    rm -rf blobs/sha256/$&#123;blob:0:2&#125;/$&#123;blob&#125;</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure><ol><li><p>éå†æ‰€æœ‰é•œåƒçš„ tag ä¸‹æœ€æ–°çš„ link æ–‡ä»¶æŒ‡å‘çš„ manifest</p></li><li><p>æ ¹æ® manifest æ–‡ä»¶ grep å‡º sha256 å€¼çš„ image config å’Œ layer æ–‡ä»¶ï¼Œä¿å­˜åˆ° <code>all_blobs.list</code> æ–‡ä»¶ä¸­ã€‚</p></li><li><p>ä½¿ç”¨ <code>find</code> å’Œ <code>for</code> å¾ªç¯éå†æ‰€æœ‰ blobs ä¸‹çš„çš„ data æ–‡ä»¶ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦åœ¨ <code>all_blobs.list</code> ä¸­ï¼Œä¸å†çš„è¯ç›´æ¥ <code>rm -rf</code> å¹²æ‰å®ƒï¼</p></li><li><p>æœ€åé‡å¯ä¸€ä¸‹ registry å®¹å™¨ã€‚</p></li></ol><p>å°±æ˜¯è¿™ä¹ˆç®€å•ç²—æš´ï¼å“ˆå“ˆï¼Œ<code>rm -rf</code> ç”¨èµ·æ¥çœŸçˆ½ï¼ˆæ‰‹åŠ¨æ»‘ç¨½ ã€‚å¦‚æœè¿˜æƒ³æŠŠè¿™ä¸ªè„šæœ¬å†ä¼˜åŒ–ä¸€ä¸‹çš„è¯ï¼Œå¯ä»¥å°† æ‰€æœ‰çš„ blob çš„ sha256 å€¼æˆªå–å‰ 12 ä½ä¿å­˜åœ¨ä¸€ä¸ªå˜é‡ä¸­ã€‚é€šè¿‡ <code>=~</code> æ¥åˆ¤æ–­åŒ…å«å…³ç³»æ¥æ›¿ä»£ grepã€‚</p><h2 id="è¸©å‘ï¼"><a href="#è¸©å‘ï¼" class="headerlink" title="è¸©å‘ï¼"></a>è¸©å‘ï¼</h2><h3 id="The-operation-is-unsupported-405-Method-Not-Allowed"><a href="#The-operation-is-unsupported-405-Method-Not-Allowed" class="headerlink" title="The operation is unsupported.(405 Method Not Allowed)"></a>The operation is unsupported.(405 Method Not Allowed)</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~/registry</span><br><span class="line">â•°â”€# skopeo delete docker://localhost/library/alpine:3.10 --debug</span><br><span class="line">DEBU[0000] Returning credentials from /run/containers/0/auth.json</span><br><span class="line">DEBU[0000] Using registries.d directory /etc/containers/registries.d for sigstore configuration</span><br><span class="line">DEBU[0000]  No signature storage configuration found for localhost/library/alpine:3.10</span><br><span class="line">DEBU[0000] Looking for TLS certificates and private keys in /etc/docker/certs.d/localhost</span><br><span class="line">DEBU[0000] Loading registries configuration "/etc/containers/registries.conf"</span><br><span class="line">DEBU[0000] GET https://localhost/v2/</span><br><span class="line">DEBU[0000] Ping https://localhost/v2/ status 401</span><br><span class="line">DEBU[0000] GET https://localhost/v2/library/alpine/manifests/3.10</span><br><span class="line">DEBU[0000] DELETE https://localhost/v2/library/alpine/manifests/sha256:a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590</span><br><span class="line">FATA[0000] Failed to delete /v2/library/alpine/manifests/sha256:a143f3ba578f79e2c7b3022c488e6e12a35836cd4a6eb9e363d7f3a07d848590: &#123;"errors":[&#123;"code":"UNSUPPORTED","message":"The operation is unsupported."&#125;]&#125;</span><br><span class="line"> (405 Method Not Allowed)</span><br></pre></td></tr></table></figure><p>åœ¨ registry å®¹å™¨å¯åŠ¨çš„æ—¶å€™æ·»åŠ å˜é‡å¼€å¯ <code>REGISTRY_STORAGE_DELETE_ENABLED=true</code> å³å¯ï¼Œæˆ–è€…ä¿®æ”¹å®¹å™¨å†…çš„é…ç½®æ–‡ä»¶ <code>/etc/docker/registry/config.yml</code>ï¼Œåœ¨ <code>storage:</code> ä¸‹æ·»åŠ ä¸Š ä¸‹é¢çš„å‚æ•°ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">storage:</span></span><br><span class="line">  <span class="attr">delete:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="GC-ä¸å½»åº•ï¼Œæ®‹ç•™-link-æ–‡ä»¶"><a href="#GC-ä¸å½»åº•ï¼Œæ®‹ç•™-link-æ–‡ä»¶" class="headerlink" title="GC ä¸å½»åº•ï¼Œæ®‹ç•™ link æ–‡ä»¶"></a>GC ä¸å½»åº•ï¼Œæ®‹ç•™ link æ–‡ä»¶</h3><p>ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œregistry æ— è®ºæ˜¯åˆ é™¤ä¸€ä¸ªé•œåƒè¿˜æ˜¯è¿›è¡Œ GC æ“ä½œï¼Œéƒ½ä¸ä¼šåˆ é™¤ repositories ç›®å½•ä¸‹çš„ <code>_layers/sha256/digest/link</code> æ–‡ä»¶ï¼Œåœ¨è¿›è¡Œ GC ä¹‹åï¼Œä¸€äº›é•œåƒ layer å’Œ config æ–‡ä»¶å·²ç»åœ¨ blobs å­˜å‚¨ç›®å½•ä¸‹åˆ é™¤äº†ï¼Œä½†æŒ‡å‘å®ƒçš„ layers/link æ–‡ä»¶ä¾æ—§ä¿å­˜åœ¨ repositories ç›®å½•ä¸‹ğŸ™„ã€‚GitHub ä¸Šæœ‰ä¸ª PR <a href="https://github.com/docker/distribution/issues/2288" target="_blank" rel="noopener">Remove the layerâ€™s link by garbage-collect #2288</a> å°±æ˜¯ä¸“é—¨æ¥æ¸…ç†è¿™äº›æ— ç”¨çš„ layer link æ–‡ä»¶çš„ï¼Œæœ€æ—©çš„ä¸€ä¸ªæ˜¯ä¸‰å¹´å‰çš„ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰åˆå¹¶ğŸ˜‚ã€‚</p><p>ç•™ç€å·²ç»è¢« GC æ‰ blob çš„ layer link ä¹Ÿæ²¡å•¥ç”¨ï¼Œä½¿ç”¨ä¸‹é¢è¿™ä¸ªè„šæœ¬å°±èƒ½åˆ æ‰æ— ç”¨çš„ layer link æ–‡ä»¶ã€‚æ ¹æ® layer link çš„å€¼å» blobs ç›®å½•ä¸‹çœ‹çœ‹è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨çš„è¯å°± rm -rf æ‰ï¼Œå­˜åœ¨çš„è¯å°±ç•™ç€ã€‚è¿™æ ·å°±èƒ½æ¸…ç†å¹²å‡€å•¦ğŸ˜ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">cd /var/lib/registry/docker/registry/v2</span><br><span class="line">for link in $(find repositories -name "link" | grep -E "_layers")</span><br><span class="line">do</span><br><span class="line">    link_sha256=$(echo $&#123;link&#125; | awk -F "/" '&#123;print $6&#125;')</span><br><span class="line">    link_short=$(echo $&#123;link&#125; | awk -F "/" '&#123;print $6&#125;' | cut -c1-2)</span><br><span class="line">    data_file=blobs/sha256/$&#123;link_short&#125;/$&#123;link_sha256&#125;</span><br><span class="line">    dir_link=$(echo $&#123;link&#125; | sed s'/link//g')</span><br><span class="line">    if [[ ! -d "$&#123;data_file&#125;" ]]; then</span><br><span class="line">    rm -rf $&#123;dir_link&#125;</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h3 id="GC-åè¦é‡å¯ï¼"><a href="#GC-åè¦é‡å¯ï¼" class="headerlink" title="GC åè¦é‡å¯ï¼"></a>GC åè¦é‡å¯ï¼</h3><p>GC ä¹‹åä¸€å®šè¦é‡å¯ï¼Œå› ä¸º registry å®¹å™¨ç¼“å­˜äº†é•œåƒ layer çš„ä¿¡æ¯ï¼Œå½“åˆ é™¤æ‰ä¸€ä¸ªé•œåƒ A ï¼Œåè¾¹ GC æ‰è¯¥é•œåƒçš„ layer ä¹‹åï¼Œå¦‚æœä¸é‡å¯ registry å®¹å™¨ï¼Œå½“é‡æ–° PUSH é•œåƒ A çš„æ—¶å€™å°±ä¼šæç¤ºé•œåƒ layer å·²ç»å­˜åœ¨ï¼Œä¸ä¼šé‡æ–°ä¸Šä¼  layer ï¼Œä½†å®é™…ä¸Šå·²ç»è¢« GC æ‰äº†ï¼Œæœ€ç»ˆä¼šå¯¼è‡´é•œåƒ A ä¸å®Œæ•´ï¼Œæ— æ³• pull åˆ°è¯¥é•œåƒã€‚</p><h3 id="GC-ä¸æ˜¯äº‹åŠ¡æ€§æ“ä½œ"><a href="#GC-ä¸æ˜¯äº‹åŠ¡æ€§æ“ä½œ" class="headerlink" title="GC ä¸æ˜¯äº‹åŠ¡æ€§æ“ä½œ"></a>GC ä¸æ˜¯äº‹åŠ¡æ€§æ“ä½œ</h3><p>GC çš„æ—¶å€™æœ€å¥½æš‚åœ PUSH é•œåƒï¼Œä»¥å…æŠŠæ­£åœ¨ä¸Šä¼ çš„é•œåƒ layer ç»™ GC æ‰ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;blockquote&gt;
&lt;p&gt;å¥½ä¹…æ²¡æ›´æ–°åšå®¢äº†ï¼Œåœ¨å®¶æ‘¸é±¼èµ¶ç´§æ¥
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="docker" scheme="https://blog.k8s.li/tags/docker/"/>
    
      <category term="registry" scheme="https://blog.k8s.li/tags/registry/"/>
    
      <category term="é•œåƒ" scheme="https://blog.k8s.li/tags/%E9%95%9C%E5%83%8F/"/>
    
  </entry>
  
  <entry>
    <title>2020 é˜…è¯»è®°å½•ï¼ˆäºŒï¼‰</title>
    <link href="https://blog.k8s.li/Q2-reading.html"/>
    <id>https://blog.k8s.li/Q2-reading.html</id>
    <published>2020-06-19T16:00:00.000Z</published>
    <updated>2020-06-29T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>  è¦‹è­‰äº†é€™æ®µæ­·å²ä¹Ÿè¶Šä¾†è¶Šèƒ½é«”æœƒæ„Ÿè§¸åˆ°ï¼šç•¶ä»Šä¸–ç•Œï¼Œå°ˆåˆ¶çš„æ¬ŠåŠ›é‚„åœ¨å¥´å½¹äººçš„è‡ªç”±ï¼›æ¥µæ¬Šçš„çµ±æ²»é‚„åœ¨æ§åˆ¶äººçš„æ€æƒ³ï¼›ç¿’æ…£æ€§çš„ä¸æ€è€ƒå’Œç„¡åˆ¤æ–·å°‡äººå‚¾å‘æ„šæ˜§å’Œè‡ªæˆ‘æ¬ºé¨™ï¼Œæ–¼æ˜¯æˆ‘å€‘å…±åŒé€ å°±äº†é€™å°æ¥µæ¬Šå°ˆåˆ¶çš„æ©Ÿå™¨ï¼Œæˆ‘å€‘æœå¾é€™è€å¤§å“¥çš„æ€æƒ³ï¼Œä¸€åˆ‡éƒ½è¦æ”¿æ²»æ­£ç¢ºã€‚</p></blockquote><p>æ‚„æ— å£°æ¯åœ°æ¸¡è¿‡äº† 2020 å¹´çš„ä¸€åŠï¼Œå’Œä¸Šä¸€ç¯‡è¯»ä¹¦è®°å½•<a href="https://blog.k8s.li/spring-reading-note.html">ã€Šæ˜¥å­£è¯»ä¹¦ç¬”è®°ã€‹</a>ä¸€æ ·ï¼Œè¿™ç¯‡ä¹Ÿæ˜¯ä¸ªäººå›é¡¾ä¸€ä¸‹æœ€è¿‘ä¸‰ä¸ªæœˆçš„è¯»ä¹¦è®°å½•ï¼Œåœ¨æ­¤åšä¸ªæ€»ç»“ï¼Œä»¥æ­¤æ¥ç£ä¿ƒè‡ªå·±æ¯å¤©éƒ½è¦åšæŒé˜…è¯»ï¼ŒåšæŒè®°å½•ä¸‹å»ã€‚</p><h3 id="åœ¨è¯»"><a href="#åœ¨è¯»" class="headerlink" title="åœ¨è¯»"></a>åœ¨è¯»</h3><ul><li>å¸ƒæ‹‰æ ¼ç²¾ç¥</li><li>å¤§è¯å­˜å‚¨</li><li>ç”Ÿå‘½é€šå²</li><li>å¾è´²æ–‡é›†</li><li>é€šå¾€å°Šä¸¥çš„å…¬å…±ç”Ÿæ´»</li></ul><h3 id="2020-è¯»å®Œ"><a href="#2020-è¯»å®Œ" class="headerlink" title="2020 è¯»å®Œ"></a>2020 è¯»å®Œ</h3><p>å›é¡¾è¿™å¤§åŠå¹´æ¥ä¸€å…±å®Œæ•´è¯»å®Œäº† 48 æœ¬ä¹¦ğŸ˜‚</p><table><thead><tr><th align="center">ä¹¦å</th><th align="center">ä½œè€…</th><th align="center">æ—¶é—´</th><th align="center">é˜…è¯»æ—¶é•¿</th></tr></thead><tbody><tr><td align="center">è®ºäººç±»ä¸å¹³ç­‰çš„èµ·æºå’ŒåŸºç¡€</td><td align="center">[æ³•]è®©-é›…å…‹Â·å¢æ¢­</td><td align="center">01-01</td><td align="center">5h</td></tr><tr><td align="center">ç¤¾ä¼šä¸»ä¹‰ï¼šç»æµå­¦ä¸ç¤¾ä¼šå­¦çš„åˆ†æ</td><td align="center">[å¥¥] è·¯å¾·ç»´å¸ŒÂ·å†¯Â·ç±³ç‘Ÿæ–¯</td><td align="center">01-01</td><td align="center">10h</td></tr><tr><td align="center">å¿ƒç†æµ‹é‡è€…</td><td align="center">[æ—¥]æ·±çœŸè§</td><td align="center">01-03</td><td align="center">6h</td></tr><tr><td align="center">è®ºé©å‘½</td><td align="center">[å¾·] æ±‰å¨œÂ·é˜¿ä¼¦ç‰¹</td><td align="center">01-05</td><td align="center">12h</td></tr><tr><td align="center">æ–°å¸¸è¯†ï¼šä¸€å…šä¸“æ”¿çš„æ€§è´¨å’Œåæœ</td><td align="center">å¼ é›ªå¿ </td><td align="center">01-15</td><td align="center">4h</td></tr><tr><td align="center">è®ºç§‘å­¦ä¸è‰ºæœ¯</td><td align="center">[æ³•]è®©-é›…å…‹Â·å¢æ¢­</td><td align="center">01-21</td><td align="center">2h</td></tr><tr><td align="center">åœ°çƒè„‰åŠ¨ï¼šå‰æ‰€æœªè§çš„è‡ªç„¶ä¹‹ç¾</td><td align="center">[è‹±]é˜¿æ‹‰æ–¯æ³°å°”Â·ç¦ç‘Ÿå‰å°”</td><td align="center">01-22</td><td align="center">2h</td></tr><tr><td align="center">ç¤¾ä¼šå¥‘çº¦è®º (è¯‘æ—äººæ–‡ç²¾é€‰)</td><td align="center">[æ³•]è®©-é›…å…‹Â·å¢æ¢­</td><td align="center">01-23</td><td align="center">4h</td></tr><tr><td align="center">ä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ï¼šä¸€ä¸ªç»„ç»‡å­¦ç ”ç©¶</td><td align="center">å‘¨é›ªå…‰</td><td align="center">01-28</td><td align="center">8h</td></tr><tr><td align="center">ç—…æ¯’æ˜Ÿçƒ</td><td align="center">[ç¾]å¡å°”Â·é½é»˜</td><td align="center">01-28</td><td align="center">4h</td></tr><tr><td align="center">ç—…æ¯’æ¥è¢­</td><td align="center">[ç¾]å†…æ£®â€¢æ²ƒå°”å¤«</td><td align="center">01-29</td><td align="center">2h</td></tr><tr><td align="center">è¡€ç–«ï¼šåŸƒåšæ‹‰çš„æ•…äº‹</td><td align="center">ç†æŸ¥å¾·Â·æ™®é›·æ–¯é¡¿</td><td align="center">02-01</td><td align="center">8h</td></tr><tr><td align="center">è¿œå¤çš„è‘±èŒï¼šå¤æ¤ç‰©ç‹å›½</td><td align="center">å‘¨å¿—ç‚</td><td align="center">02-05</td><td align="center">4h</td></tr><tr><td align="center">å¤ç”Ÿç‰©å­¦ç®€æ˜æ•™ç¨‹</td><td align="center">æœ±æ‰ä¼</td><td align="center">02-06</td><td align="center">3h</td></tr><tr><td align="center">ä¸Šå¸é€ äººæœ‰å¤šéš¾ï¼šç”Ÿå‘½çš„å¯†é’¥</td><td align="center">æœ±é’¦å£«</td><td align="center">02-07</td><td align="center">6h</td></tr><tr><td align="center">æœ±é’¦å£«çš„ä¸ªäººåšå®¢</td><td align="center">æœ±é’¦å£«</td><td align="center">02-08</td><td align="center">8h</td></tr><tr><td align="center">è¿œå¤çš„è¾‰ç…Œï¼šç”Ÿç‰©å¤§å¹…å°„</td><td align="center">æˆå˜‰ä½™</td><td align="center">02-13</td><td align="center">6h</td></tr><tr><td align="center">ç‰›æ´¥é€šè¯†è¯»æœ¬ï¼šåœ°çƒ</td><td align="center">[è‹±]é©¬ä¸Â·é›·å¾·èŠ¬</td><td align="center">02-13</td><td align="center">6h</td></tr><tr><td align="center">ç”Ÿå‘½æ´»åŠ¨çš„æ‘‡ç¯®ï¼šç»†èƒ</td><td align="center">ç‹è€€å‘</td><td align="center">02-16</td><td align="center">4h</td></tr><tr><td align="center">åœ°çƒè„‰åŠ¨2ï¼šå¥‡è¿¹ä¸–ç•Œ</td><td align="center">èƒ¡Â·ç§‘é‡Œ</td><td align="center">02-24</td><td align="center">3h</td></tr><tr><td align="center">ä¸€æƒ³åˆ°è¿˜æœ‰95<em>%çš„</em>é—®é¢˜ç•™ç»™äººç±»ï¼Œæˆ‘å°±æ”¾å¿ƒäº†</td><td align="center">è±ªå°”èµ«â€¢é™ˆ</td><td align="center">03-07</td><td align="center">4h</td></tr><tr><td align="center">å†å²çš„ç»ˆç»“åŠæœ€åä¹‹äºº</td><td align="center">[ç¾]å¼—æœ—è¥¿æ–¯Â·ç¦å±±</td><td align="center">03-03</td><td align="center">10h</td></tr><tr><td align="center">æˆ‘ç„¡ç½ªï¼šåŠ‰æ›‰æ³¢å‚³</td><td align="center">ä½™æ°</td><td align="center">03-13</td><td align="center">8h</td></tr><tr><td align="center">ç¥å¥‡çš„ç”Ÿç‰©åŒ–å­¦</td><td align="center">ç¥å¥‡çš„ç”Ÿç‰©åŒ–å­¦</td><td align="center">03-23</td><td align="center">4h</td></tr><tr><td align="center">è´¹é©¬æœ€ç»ˆå®šç†</td><td align="center">[æ—¥]æ—¥å†²æ¨±çš®</td><td align="center">03-26</td><td align="center">3h</td></tr><tr><td align="center">è¢«è®¨åŒçš„å‹‡æ°”</td><td align="center">[æ—¥]å²¸è¦‹ä¸€éƒ</td><td align="center">03-28</td><td align="center">4h</td></tr><tr><td align="center">é¸Ÿç°å¤æ–‡æ˜</td><td align="center">[æ³•] è®©-å…‹åŠ³å¾·Â·æˆˆå°”ä¸‡</td><td align="center">04-03</td><td align="center">8h</td></tr><tr><td align="center">ç¼–ç ï¼šéšåŒ¿åœ¨è®¡ç®—æœºè½¯ç¡¬ä»¶èƒŒåçš„è¯­è¨€</td><td align="center">[ç¾]æŸ¥å°”æ–¯â€¢ä½©æªå°”å¾·</td><td align="center">04-10</td><td align="center">8h</td></tr><tr><td align="center">è‡ªç”±å®ªç« </td><td align="center">[å¥¥]å¼—é‡Œå¾·é‡Œå¸ŒÂ·å“ˆè€¶å…‹</td><td align="center">04-01</td><td align="center">16h</td></tr><tr><td align="center">æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—éŸ©äººæ°‘çš„çœŸå®ç”Ÿæ´»</td><td align="center">[ç¾]èŠ­èŠ­æ‹‰Â·å¾·ç±³å…‹</td><td align="center">04-23</td><td align="center">6h</td></tr><tr><td align="center">å“ˆç»´å°”æ–‡é›†</td><td align="center">[æ·å…‹]å“ˆç»´å°”</td><td align="center">04-24</td><td align="center">8h</td></tr><tr><td align="center">å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ</td><td align="center">[ç¾] å¡è’‚Â·é©¬é¡¿</td><td align="center">04-26</td><td align="center">6h</td></tr><tr><td align="center">è‡´å‘½çš„è‡ªè´Ÿï¼šç¤¾ä¼šä¸»ä¹‰çš„è°¬è¯¯</td><td align="center">[å¥¥]å¼—é‡Œå¾·é‡Œå¸ŒÂ·å“ˆè€¶å…‹</td><td align="center">05-01</td><td align="center">10h</td></tr><tr><td align="center">åœ°çƒçš„æ¼”å˜æ•…äº‹</td><td align="center">å§šå»ºæ˜</td><td align="center">05-02</td><td align="center">4h</td></tr><tr><td align="center">å›¾è§£ç§‘æŠ€è¯‘ä¸›ï¼šæ¼«ç”»å…ƒç´ 118</td><td align="center">[æ—¥]æ–‹è…¾èƒœè£•</td><td align="center">05-02</td><td align="center">2h</td></tr><tr><td align="center">é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–</td><td align="center">å¾è´²</td><td align="center">05-02</td><td align="center">4h</td></tr><tr><td align="center">ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘</td><td align="center">å¾è´²</td><td align="center">05-03</td><td align="center">8h</td></tr><tr><td align="center">ä¸‰è§’è·ç¦»æ— é™ä¸ºé›¶1-4</td><td align="center">[æ—¥]å²¬é¹­å®«</td><td align="center">05-05</td><td align="center">10h</td></tr><tr><td align="center">è¢«ç¦é”¢çš„å¤´è„‘</td><td align="center">[ç«‹]åˆ‡æ–¯ç“¦å¤«Â·ç±³æ²ƒä»€</td><td align="center">05-05</td><td align="center">6h</td></tr><tr><td align="center">äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†</td><td align="center">å¾è´²</td><td align="center">05-02</td><td align="center">10h</td></tr><tr><td align="center">å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾</td><td align="center">[è‹±]å¸ƒè±æ©â€¢è€ƒå…‹æ–¯</td><td align="center">05-25</td><td align="center">5h</td></tr><tr><td align="center">é€šå¾€å°Šä¸¥çš„å…¬å…±ç”Ÿæ´»</td><td align="center">å¾è´²</td><td align="center">05-25</td><td align="center">10h</td></tr><tr><td align="center">å®‡å®™ä»èµ·æºåˆ°æœªæ¥</td><td align="center">[[ç¾]çº¦ç¿°Â·å¸ƒç½—å…‹æ›¼</td><td align="center">06-18</td><td align="center">5h</td></tr><tr><td align="center">kubernetes ç½‘ç»œæƒå¨æŒ‡å—</td><td align="center">æœå†›</td><td align="center">06-20</td><td align="center">6h</td></tr><tr><td align="center">Linuxå¼€æºç½‘ç»œå…¨æ ˆè¯¦è§£ï¼šä»DPDKåˆ°OpenFlow</td><td align="center">è‹±ç‰¹å°”äºšå¤ªç ”å‘æœ‰é™å…¬å¸</td><td align="center">06-20</td><td align="center">3h</td></tr><tr><td align="center">å¤§è¯å¤„ç†å™¨</td><td align="center">ä¸‡æœ¨æ¨</td><td align="center">06-21</td><td align="center">1h</td></tr><tr><td align="center">ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶5</td><td align="center">[æ—¥]å²¬é¹­å®«</td><td align="center">06-24</td><td align="center">2.5h</td></tr></tbody></table><h2 id="4-æœˆ"><a href="#4-æœˆ" class="headerlink" title="4 æœˆ"></a>4 æœˆ</h2><h3 id="è‡ªç”±å®ªç« "><a href="#è‡ªç”±å®ªç« " class="headerlink" title="è‡ªç”±å®ªç« "></a>è‡ªç”±å®ªç« </h3><p>ã€Šè‡ªç”±å®ªç« ã€‹æ˜¯è¿™å¤§åŠå¹´æ¥æœ€éš¾å•ƒçš„ä¹¦ï¼Œå“ˆè€¶å…‹çš„ä¹¦å¯¹äºæœ¨å­è¿™ç§èœé¸¡æ¥è¯´è¯»èµ·æ¥å°±æ˜¯å¤´å¤§å•ŠğŸ˜‚ï¼Œå’Œæˆ‘åœ¨ä¸€æœˆä»½è¯»çš„ã€Šè‡ªç”±ä¸ç¹è£çš„å›½åº¦ã€‹å‘³é“ä¸€æ ·ã€‚</p><h4 id="ä½œè€…"><a href="#ä½œè€…" class="headerlink" title="ä½œè€…"></a>ä½œè€…</h4><p><strong>å¼—é‡Œå¾·é‡Œå¸ŒÂ·å“ˆè€¶å…‹</strong>ï¼ˆFriedrich AÂ·Hayekï¼‰æ˜¯å¥¥åœ°åˆ©ç»æµå­¦å®¶å’Œæ”¿æ²»å“²å­¦å®¶ã€‚èº«ä¸º1974å¹´çš„è¯ºè´å°”ç»æµå­¦å¥–çš„è·å¾—è€…ä¹‹ä¸€ï¼Œä»–ä¸»å¼ ä»¥å¸‚åœºä¸ºåŸºç¡€çš„è‡ªç”±èµ„æœ¬ä¸»ä¹‰å’Œæœ‰é™çš„æ”¿åºœã€‚æ­¤å¤–ï¼Œä»–è¿˜äº1991å¹´è·å¾—äº†æ€»ç»Ÿè‡ªç”±å‹‹ç« ã€‚</p><p>åœ¨è¿™æœ¬ä¹¦ä¸­ï¼Œå•å•æ³•æ²»æ¦‚å¿µçš„å«ä¹‰ï¼Œå“ˆè€¶å…‹æœ¬äººå°±ç½—åˆ—å¼•ç”¨äº† 30 å¤šæœ¬è‘—ä½œï¼å¯è§å½“æ—¶å“ˆè€¶å…‹æœ¬äººçš„å­¦æœ¯æ°´å¹³ç›¸å½“é«˜æ»´ï¼</p><blockquote><ul><li>ã€Šæ³•å¾‹ä¸ç§©åºã€‹</li><li>ã€Šæ•™ä¼šã€å›½å®¶ä¸ç ”ç©¶ã€‹</li><li>ã€Šæ–°åˆ©ç»´å¦ã€‹</li><li>ã€Šç¾å›½çš„è¡Œæ”¿å¸æ³•åŠæ³•å¾‹çš„æœ€é«˜åœ°ä½ã€‹</li><li>ã€Šå®ªæ”¿æ”¿æ²»ä¸æ°‘ä¸»ã€‹</li><li>ã€Šæ”¿æ²»ä¸è¡Œæ”¿ã€‹</li><li>ã€Šç°ä»£å…±åŒä½“çš„åŸºç¡€ã€‹</li><li>ã€Šå¯¹è‰¯å¥½ç¤¾ä¼šåŸåˆ™æ¢ç´¢ã€‹</li><li>ã€Šå®ªæ”¿ä¸å˜åŠ¨ä¸­çš„ä¸–ç•Œã€‹</li><li>ã€Šæ°‘ä¸»å›½å®¶ä¸é›†æƒå›½å®¶ã€‹</li><li>ã€Šè¡Œæ”¿ä¸æ³•æ²»ã€‹</li><li>ã€Šç°ä»£æ”¿æ²»è¯¸è¦ç´ ã€‹</li><li>ã€Šæ³•æ²»ï¼šä¿å®ˆçš„ä¼¦æ•¦å¾‹å¸ˆå…¬ä¼šä¸å·¥ä¼šåä¼šè¿›è¡Œçš„ç ”ç©¶ã€‹</li><li>ã€Šæ³•å¾‹ï¼šæœ‰å…³æ°‘ä¸»ä¹‹ä¸­çš„æƒå¨çš„ç†è®ºçš„è®ºæ–‡ã€‹</li><li>ã€Šä¸ªäººä¸»ä¹‰ä¸æ³•å¾‹ã€‹</li><li>ã€Šå®ªæ³•å­¦ã€‹</li><li>ã€Šå®ªæ³•ä¹‹ä¿å«è€…ã€‹</li><li>ã€Šæ³•æ²»å›½å®¶ï¼Œè¿˜æ˜¯ç‹¬è£ï¼Ÿã€‹</li><li>ã€Šæ”¿æ²»å­¦ã€‹ã€Šæ³•æ²»å›½å®¶æœ‰æ•ˆæ€§çš„ç•Œé™ã€‹</li><li>ã€Šæ³•æ²»å›½å®¶è¿˜æ˜¯å¨æƒå›½å®¶ï¼Ÿã€‹</li><li>ã€Šè‡ªç”±ä¸»ä¹‰ä½œä¸ºä¸€ç§æ„è¯†å½¢æ€çš„æ²¡è½ã€‹</li><li>ã€Šæ³¢æ©åŸºæœ¬æ³•ä¸­çš„ç¤¾ä¼šæ³•æ²»å›½å®¶æ¦‚å¿µã€‹</li><li>ã€Šä½œä¸ºåˆ‘æ³•æœ€æ–°å‘å±•çš„ä¸­å¿ƒæ¦‚å¿µçš„æ³•æ²»å›½å®¶ã€‹</li><li>ã€Šæ³•ã€å›½å®¶ã€ç»æµã€‹</li><li>ã€Šä»æ³•å¾‹å›½å®¶åˆ°æ³•å®˜å›½å®¶ã€‹</li><li>ã€Šç‘å£«è”é‚¦å›½å®¶æ³•ã€‹</li><li>ã€Šå¾·å›½è¡Œæ”¿æ³•çš„ä½“åˆ¶ã€‹</li><li>ã€Šç‘å£«è”é‚¦æ³•é™¢çš„å®ªæ³•ç®¡è¾–æƒã€‹</li><li>ã€Šæ³•åˆ¶å›½å®¶æ°‘ä¸»åˆ¶ã€‹</li><li>ã€Šç¾å›½ä¸ç‘å£«å®ªæ³•ç®¡è¾–æƒçš„æ”¿æ²»æ„è¯†å½¢æ€ä¸Šä¸æ³•å¾‹æ„è¯†å½¢æ€ä¸Šçš„æ ¹æ®ã€‹</li><li>ã€Šä½œä¸ºå›½å®¶æ ¹æœ¬æ³•å¾‹ç§©åºçš„å®ªæ³•ã€‹</li><li>ã€Šç‘å£«æ³•å¾‹ä¸­çš„å…¬æ°‘è‡ªç”±ã€‹</li><li>ã€Šæ³•æ²»å›½å®¶çš„ç§©åºã€‹</li><li>ã€Š1955å¹´é›…å…¸å›½é™…æ³•å­¦å®¶å¤§ä¼šæŠ¥å‘Šã€‹</li></ul></blockquote><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>è™½ç„¶è¿™æœ¬ä¹¦æ—©åœ¨1960å¹´å°±å·²å‡ºç‰ˆï¼Œä½†å…¶æ·±åˆ»çš„è§è§£æ—¶è‡³ä»Šæ—¥ä»ç„¶ç››è¡Œã€‚ä»–æ‰€å€¡å¯¼çš„ç»æµå’Œä¸ªäººè‡ªç”±ç†è®ºé€‚ç”¨äºå¾ˆå¤šå½“ä»Šçš„çƒ­è®®è¯é¢˜ï¼Œä»ç‰©ä»·ä¸Šæ¶¨åˆ°ç´¯è¿›ç¨åˆ¶ã€‚åœ¨ä¹¦ä¸­ï¼Œä½œè€…å¯¹æ¯”äº†å»ºç«‹æœ‰é™æ”¿åºœçš„ç›Šå¤„å’Œå®æ–½ä¸­å¤®è®¡åˆ’ç»æµçš„å¼Šç«¯ã€‚é™åˆ¶æ”¿åºœæƒåŠ›å°†ä¼šæœ‰åˆ©äºæå‡ä¸ªä½“èƒ½åŠ¨æ€§å’Œåˆ›é€ åŠ›ï¼Œè¿›è€Œæ¨åŠ¨äººç±»çŸ¥è¯†å’Œæ–‡æ˜çš„è¿›æ­¥ã€‚å“ˆè€¶å…‹è®ºè¯äº†æ³•å¾‹æ³•è§„ã€åˆæ³•ç¨‹åºå’Œå®ªæ³•æ”¿åºœå¯¹è‡ªç”±çš„ç§¯æä½œç”¨ï¼Œå¹¶æŒ‡å‡ºä¸ªäººè‡ªç”±æ‰€é¢ä¸´çš„ä¸¥å³»çš„æ½œåœ¨å¨èƒã€‚ä»¥ä¸‹æ˜¯æœ¬ä¹¦çš„å‡ ä¸ªè¦ç‚¹ï¼š</p><ul><li>æœ‰é™çš„æ”¿åºœé€šè¿‡æ¿€å‘äººçš„ä¸ªä½“ä¸»åŠ¨æ€§æ¥æ¨åŠ¨ç¤¾ä¼šçš„è¿›æ­¥ã€‚</li><li>è´¢äº§æƒåˆ©å’Œä¸ªäººè‡ªç”±è¿™ä¸€å®½æ³›çš„æ”¿æ²»æ¦‚å¿µæœ‰ç€å¯†åˆ‡çš„è”ç³»ã€‚</li><li>åªæœ‰é‚£äº›ä¸çº¦å®šä¿—æˆçš„é“å¾·è§‚å¿µç›¸ç¬¦çš„æ³•å¾‹æ‰èƒ½ç»å¾—ä½æ—¶é—´çš„è€ƒéªŒã€‚</li><li>å¤šæ•°è£å®šåŸåˆ™è‡ªç„¶å¾ˆæœ‰å¿…è¦ï¼Œä½†ä»…ä»…ä¾é å®ƒè¿˜ä¸è¶³ä»¥å»ºç«‹ä¸€ä¸ªè‡ªç”±ç¤¾ä¼šã€‚</li><li>å®ªæ”¿æ˜¯ç¾å›½è¿½æ±‚è‡ªç”±äº‹ä¸šæœ€æœ‰åŠ›çš„æ­¦å™¨ã€‚</li><li>ç¤¾ä¼šä¸»ä¹‰æ˜¯ä¸€ç§å¤±è´¥çš„æ”¿åºœå½¢å¼ï¼Œä½†å®ƒè‡³ä»Šä¾ç„¶å½±å“ç€å…¬å…±æ”¿ç­–çš„åˆ¶å®šã€‚</li><li>é€šè¿‡æ”¶å…¥å†åˆ†é…æ¥ç¼“è§£è´«å›°ä¼šå¸¦æ¥æ„æƒ³ä¸åˆ°çš„è´Ÿé¢æ•ˆåº”ï¼Œæ¯”å¦‚â€œç¦åˆ©å›½å®¶â€çš„å‡ºç°ã€‚</li><li>åŸºäºå¸‚åœºçŠ¶å†µçš„å¥–åŠ±åˆ¶åº¦æ¯”åŸºäºä¸ªäººä¼˜ç‚¹çš„å¥–åŠ±åˆ¶åº¦æ›´åŠ æœ‰æ•ˆã€‚</li><li>æ¯”èµ·é€šè´§ç´§ç¼©ï¼Œæ”¿åºœæ›´å€¾å‘äºé€šè´§è†¨èƒ€ã€‚ä½†è¿‡åº¦çš„è†¨èƒ€ä¼šå¨èƒåˆ°è‡ªç”±ã€‚</li><li>é™åˆ¶æ”¿åºœå¯¹æ•™è‚²çš„å¹²æ¶‰æœ‰åˆ©äºç¤¾ä¼šä¿æŒæ€æƒ³æ´»åŠ›ã€‚</li></ul><h3 id="æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—æœé²œäººæ°‘çš„çœŸå®ç”Ÿæ´»"><a href="#æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—æœé²œäººæ°‘çš„çœŸå®ç”Ÿæ´»" class="headerlink" title="æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—æœé²œäººæ°‘çš„çœŸå®ç”Ÿæ´»"></a>æˆ‘ä»¬æœ€å¹¸ç¦ï¼šåŒ—æœé²œäººæ°‘çš„çœŸå®ç”Ÿæ´»</h3><p>è¯»å®Œè¿™æœ¬ä¹¦å°±æ„Ÿè§‰åˆ°å½“ä»Šçš„æœé²œå°±å¦‚ä¸Šä¸–çºªçš„ä¸­å›½<strong>åå¹´æ–‡é©åŸºç¡€ä¸Šå†åŠ ä¸Šä¸‰å¹´å¤§é¥¥è’</strong>ä¸€æ ·æ‚²æƒ¨ï¼Œè¿™ç§çºªå®ç±»çš„å†™ä½œå’Œã€Šåˆ‡å°”è¯ºè´åˆ©çš„æ‚²é¸£ã€‹ä»¥åŠã€Šåä¸ªäººçš„ä¸€ç™¾å¹´ã€‹ä¸€æ ·ï¼Œæ²‰é‡çš„å†å²æ„Ÿã€‚æˆ‘ä»¬éƒ½æ˜¯è¢«å…±äº§ä¸»ä¹‰çš„ææƒä¸“åˆ¶ç‹¬è£æš´æ”¿ç»Ÿæ²»è¹‚èºè¿‡çš„æ°‘æ—ï¼Œæ„ŸåŒèº«å—çš„å†å²è®°å¿†ï¼Œå½·ä½›å°±åœ¨æ˜ å°„ç€å½“ä¸‹ä¸€æ ·ï¼Œè®©äººæœ‰ç§èº«åœ¨å†å²ä¸­æ„Ÿå—å®ƒçš„å­˜åœ¨ä¸€æ ·ã€‚çœ‹çœ‹ä¸‹é¢è¿™å‡ æ®µæ‘˜æŠ„ï¼Œå’Œæ–‡é©æ—¶æœŸçš„æˆ‘ä»¬ä»¥åŠå½“ä¸‹çš„æˆ‘ä»¬åˆæ˜¯ä½•å…¶çš„ç›¸ä¼¼ï¼š</p><blockquote><p>  ç”±äºåŒ—éŸ©å¤ªè´«å›°ï¼Œç”µåŠ›ä¾›åº”ä¸è¶³ä»¥ç»´æŒç”µå­ç›‘æ§ï¼Œæ‰€ä»¥å›½å®¶å®‰å…¨å¿…é¡»ä»°èµ–äººåŠ›æƒ…æŠ¥â€”â€”å‘Šå¯†ã€‚æŠ¥çº¸å¶å°”ä¼šå‡ºç°æ–‡æƒ…å¹¶èŒ‚çš„æŠ¥å¯¼ï¼Œæè¿°å‹‡æ•¢çš„å­©å­çº ä¸¾çˆ¶æ¯çš„è¿æ³•è¡Œä¸ºã€‚ç”±æ­¤çœ‹æ¥ï¼Œå› å‘è¡¨å¯¹å½“å±€ä¸æ»¡çš„è¨€è®ºè€Œè¢«é‚»å±…å‘Šå‘ä¹Ÿå°±ä¸è§‰å¾—å¥‡æ€ªäº†ã€‚</p></blockquote><blockquote><p>  åŒ—éŸ©äººå­¦ä¼šåä¸‹è‡ªå·±çš„è‡ªå°Šä¸æä½è‡ªå·±çš„é¼»å­ã€‚ä»–ä»¬ä»å†œæ‘åŠ¨ç‰©çš„æ’æ³„ç‰©ä¸­æŒ‘å‡ºæ¥æœªè¢«æ¶ˆåŒ–çš„ç‰ç±³ç²’ã€‚èˆ¹å‚å·¥äººå‘å±•å¤„ä¸€ç§æŠ€æœ¯ï¼ŒåŸæœ¬å‚¨å­˜ç²®é£Ÿçš„è´§ä»“åº•éƒ¨æ®‹ç•™ç€è…è‡­é»è…»çš„ä¸œè¥¿ï¼Œä»–ä»¬å°†è¿™äº›ä¸œè¥¿åˆ®èµ·äº†ï¼Œæ”¾åœ¨åœ°é¢æ™¾å¹²ï¼Œä»ä¸­å¯ä»¥æ‹¾å–ä¸€ç‚¹æœªçƒ¹ç…®è¿‡çš„ç¨»ç±³ä¸å…¶ä»–å¯é£Ÿç”¨çš„è°·ç‰©ã€‚</p></blockquote><blockquote><p>  å­©å­ç¡è§‰æ—¶è¦æé˜²å…¶ä»–å¸®æ´¾å·èµ°ä»–ä»¬çš„å°‘è®¸ä½™ç²®ã€‚æ­¤å¤–ä¹Ÿæµä¼ ç€è®¸å¤šè¯¡å¼‚çš„æ•…äº‹ï¼Œæåˆ°æˆå¹´äººæŠŠå­©å­å½“æˆçŒç‰©ã€‚ä¸åªç”¨æ¥å‘æ³„æ€§æ¬²ï¼Œä¹Ÿå½“æˆé£Ÿç‰©ã€‚é‡‘èµ«å¬è¯´æœ‰äººå¯¹å­©å­ä¸‹æ¯’ï¼Œæ€æ­»å­©å­ï¼Œå¤§å¸å…«å—åƒä¸‹è‚šã€‚åœ¨ç«è½¦ç«™åé¢ï¼Œé è¿‘é“é“è¾¹ï¼Œæœ‰äº›å°è´©åœ¨å°ç«ç‚‰ä¸Šç…®æ±¤ç…®é¢ï¼Œæ®è¯´æµ®åœ¨ä¸Šé¢çš„ç°è‰²è‚‰å—å°±æ˜¯äººè‚‰ã€‚</p></blockquote><blockquote><p>  å„çº§ç£å¯¼ä¾‹è¡Œæ€§åœ°æé€ å†œä¸šç”Ÿäº§ä¸å·¥ä¸šäº§å‡ºçš„ç»Ÿè®¡æ•°æ®ï¼Œå› ä¸ºä»–ä»¬ä¸æ•¢å‘Šè¯‰é•¿å®˜å®æƒ…ã€‚ä¸ºäº†åœ†è°ï¼Œåªå¥½è¯´æ›´å¤šçš„è°ï¼Œä»åŸºå±‚ä¼ è¾¾åˆ°é«˜å±‚çš„è®¯æ¯æ²¡æœ‰ä¸€ä»¶æ˜¯çœŸçš„ï¼Œæ‰€ä»¥å¯ä»¥æƒ³è§é‡‘æ—¥æˆæœ¬äººææ€•å®Œå…¨ä¸çŸ¥é“ç»æµçš„çŠ¶å†µæœ‰å¤šç³Ÿã€‚</p></blockquote><h4 id="ä½œè€…-1"><a href="#ä½œè€…-1" class="headerlink" title="ä½œè€…"></a>ä½œè€…</h4><p><strong>èŠ­èŠ­æ‹‰Â·å¾·ç±³å…‹</strong></p><h4 id="åˆ«ç¬‘ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆå¹¸ç¦"><a href="#åˆ«ç¬‘ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆå¹¸ç¦" class="headerlink" title="åˆ«ç¬‘ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆå¹¸ç¦"></a>åˆ«ç¬‘ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆå¹¸ç¦</h4><p><img src="img/2020-06-27_17-12-28.jpg" alt="img"></p><p>çœ‹å®Œè¿™æœ¬ä¹¦ä¹Ÿå¯ä»¥å»çœ‹å¦å¤–ä¸€æœ¬ä¹¦ã€Šé»„é•¿çƒ¨å›å¿†å½•ã€‹</p><blockquote><p>  æˆ‘åœ¨ä¸€ä¸ªå……æ»¡äº†è™šä¼ªå’Œæ¬ºéª—çš„ç¤¾ä¼šç”Ÿæ´»äº†å¾ˆä¹…ï¼Œä¸€å¼€å§‹æˆ‘ä»¥ä¸ºè™šä¼ªå’Œæ¬ºéª—æ˜¯ä¸ºäº†è§£æ”¾å‹¤åŠ³çš„äººæ°‘å¤§ä¼—ï¼Œå³ä¸ºäº†å–å¾—ä¸å‰¥å‰Šé˜¶çº§æ–—äº‰çš„èƒœåˆ©è€Œå¿…é¡»é‡‡ç”¨çš„æ‰‹æ®µã€‚ ä½†æ˜¯ï¼Œåæ¥æˆ‘æ„è¯†åˆ°ï¼Œè™šä¼ªä¸æ¬ºéª—å·²ç»ä¸ç‹¬è£è€…çš„åˆ©å·±ä¸»ä¹‰ç»“åˆèµ·æ¥ã€‚ç‹¬è£è€…çš„åˆ©å·±ä¸»ä¹‰é›†ä¸­ä½“ç°ä¸ºä¸ªäººå´‡æ‹œæ€æƒ³ï¼ŒåŒ—æœé²œæ˜¯å…¨ä¸–ç•Œä¸ªäººå´‡æ‹œå’Œé˜¶çº§ä¸»ä¹‰æœ€ä¸¥é‡çš„å›½å®¶ã€‚ æˆ‘èº«å¤„åŒ—æœé²œç»Ÿæ²»ä½“åˆ¶çš„ä¸­æ¢ï¼Œæ˜¯æ•´ä¸ªè™šä¼ªå®£ä¼ çš„åŠ¨å‘˜å’Œç»„ç»‡è€…ï¼ˆä½œè€…æ˜¯åŒ—æœé²œé©¬å…‹æ€ä¸»ä¹‰å’Œæ„è¯†å½¢æ€é¢†åŸŸçš„æƒå¨ï¼Œè¯‘è€…æ³¨ï¼‰ã€‚è™šä¼ªæ›¾ç»ä¸€åº¦å–ä»£çœŸç†å æ®ä¸€ä¸ªå­¦è€…çš„è‰¯å¿ƒï¼Œä¸å­¦è€…çš„çµé­‚å¯¹ç«‹ã€‚ æˆ‘ï¼ˆåœ¨ä¹¦ä¸­ï¼‰ä¸ä¼šå› ä¸ºè®¨åŒæˆ‘å’Œè®©æˆ‘è®¨åŒçš„äººè€Œå¤¸å¤§ã€ä¸‘åŒ–äº‹å®ï¼Œä¹Ÿä¸ä¼šå› ä¸ºçˆ±æˆ‘å’Œè®©æˆ‘çˆ±çš„äººè€Œæ¯«æ— åŸåˆ™çš„ç¾åŒ–ç°å®ã€‚ å†å²å°±æ‘†åœ¨é‚£é‡Œï¼Œå¯¹å†å²æ¥è¯´ï¼Œæ­ªæ›²æ˜¯æœ€å¤§çš„çŠ¯ç½ªã€‚æˆ‘ä¸è®¤ä¸ºæˆ‘è¯´çš„å°±æ˜¯ç»å¯¹ï¼ˆæ­£ç¡®ï¼‰ï¼Œæˆ‘åå€’æ›´å¸Œæœ›è¯»è€…å¸¦ç€æ‰¹åˆ¤çš„æ€åº¦æ¥é˜…è¯»æœ¬ä¹¦ã€‚ å¯¹äºä¸å¤§ä¼—åˆ©ç›Šæ¯«æ— å…³ç³»çš„ä¸ªäººç”Ÿæ´»ï¼Œæˆ–è€…æœ‰å¹²æ¶‰å®ƒå›½å†…æ”¿ä¹‹å«Œçš„è¨€è®ºï¼Œæˆ‘ä¼šå°½é‡é¿å…ã€‚æ¥åˆ°éŸ©å›½ä¹‹åï¼Œæˆ‘åœ¨åŠªåŠ›å­¦ä¹ æ–°äº‹ç‰©ï¼Œå¼€å§‹æ–°çš„ä½“éªŒã€‚ ä½†æ˜¯ï¼Œæˆ‘å·²ç»è€äº†ï¼Œå­¦åˆ°çš„æ–°çŸ¥è¯†å’Œæ–°ç»éªŒå¯¹æˆ‘æ€è€ƒæ–¹æ³•çš„å½±å“æœ‰é™ã€‚åœ¨æœ¬ä¹¦ä¸­ï¼Œæˆ‘è¿˜æ˜¯æƒ³å°†åœ¨åŒ—æœé²œç»å†è¿‡çš„ã€ä½“éªŒè¿‡çš„å†™å‡ºæ¥ã€‚</p></blockquote><h3 id="å“ˆç»´å°”æ–‡é›†"><a href="#å“ˆç»´å°”æ–‡é›†" class="headerlink" title="å“ˆç»´å°”æ–‡é›†"></a>å“ˆç»´å°”æ–‡é›†</h3><p>ä¸‰æœˆä»½åœ¨è¯»ã€Šæˆ‘æ— ç½ªï¼šåˆ˜æ™“æ³¢ä¼ ã€‹çš„æ—¶å€™æ„å¤–æ”¶è·åˆ°çš„è¿™æœ¬ä¹¦ï¼Œåˆ˜æ™“æ³¢å’Œå“ˆç»´å°”è‡³äºæ·å…‹</p><p>å¦å¤–æ¨èé˜…è¯»ææ…ä¹‹å…ˆç”Ÿä¸ºè¿™æœ¬ä¹¦é¢˜çš„åºçš„<a href="http://www.aisixiang.com/data/1724.html" target="_blank" rel="noopener">ã€Šæ— æƒè€…çš„æƒåŠ›å’Œåæ”¿æ²»çš„æ”¿æ²»ï¼šåææƒä¸»ä¹‰æ—¶ä»£çš„äººç”Ÿå“²å­¦ã€‹</a></p><h3 id="å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ"><a href="#å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ" class="headerlink" title="å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ"></a>å¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆ</h3><p>åœ¨äºŒæœˆä»½çš„æ—¶å€™å‰©ä½™ä»·å€¼é‡Œçš„ä¸€æœŸèŠ‚ç›®ä¸­æåˆ°è¿‡ã€Šå¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆã€‹è¿™æœ¬ä¹¦ï¼Œè€Œè¿™æœ¬ä¹¦çš„åºè¨€æ­£æ˜¯å¾è´²è€å¸ˆå†™çš„ï¼Œåæ¥é™†ç»­åˆè¯»äº†äº”å…­æœ¬å¾è´²è€å¸ˆçš„ä¹¦ã€‚</p><h4 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><blockquote><p>  æœ¬ä¹¦é€šè¿‡å†·æˆ˜æ—¶æœŸåŒˆç‰™åˆ©ç§˜å¯†è­¦å¯Ÿé•¿è¾¾20å¹´çš„æ¡£æ¡ˆï¼Œæ‰€æ­å¼€çš„æ˜¯ä¸€éƒ¨éšè—äº†å‡ åå¹´çš„å®¶åº­å†å²å’Œæ—¶ä»£ä¾§è®°ã€‚</p><p>  å†·æˆ˜æ—¶æœŸï¼Œè‹è”é›†å›¢ä¸­çš„åŒˆç‰™åˆ©ï¼Œç§˜å¯†è­¦å¯Ÿé€šè¿‡åºå¤§çš„å‘Šå¯†ç½‘ï¼Œè¯•å›¾å…¨é¢æ¸—é€æ§åˆ¶åŒˆç‰™åˆ©çš„æ”¿æ²»ç”Ÿæ´»ã€‚ä½œè€…çš„çˆ¶æ¯åŸæ˜¯åŒˆç‰™åˆ©è‘—åè®°è€…ï¼Œä»–ä»¬çš„æŠ¥é“æ˜¯è¥¿æ–¹äº†è§£åŒˆç‰™åˆ©çš„é‡è¦ä¿¡æ¯æ¥æºã€‚å› æ­¤ä»–ä»¬è¢«è§†ä¸ºâ€œäººæ°‘çš„æ•Œäººâ€ï¼Œé•¿æœŸå—ç§˜å¯†è­¦å¯Ÿçš„ç›‘æ§ï¼Œç»ˆå› å›å›½å’Œé—´è°ç½ªè€Œå…ˆåå…¥ç‹±ã€‚ä¸€å®¶ç§»å±…ç¾å›½åï¼ŒåŒˆç‰™åˆ©æ”¿åºœå´åˆå¼‚æƒ³å¤©å¼€åœ°è¯•å›¾æ‹›å‹Ÿä»–ä»¬å½“é—´è°ï¼Œè€Œç¾å›½ä¹Ÿå¯¹ä»–ä»¬è¿›è¡Œäº†å‡ å¹´çš„ç›‘æ§ã€‚ä¹¦ä¸­ä¸åªè¿˜åŸäº†é©¬é¡¿å¤«å¦‡è¢«å‘Šå¯†è€…åŒ…å›´çš„ç»å†å’Œé­é‡ï¼Œä»–ä»¬çš„æŠ—äº‰ã€åšå®ˆã€è„†å¼±å’Œå‹‡æ°”ï¼Œä¹Ÿå±•ç°äº†ä»–ä»¬æƒ…æ„Ÿå’Œå†…å¿ƒçš„çŸ›ç›¾â€”â€”å¤«å¦»ä¹‹é—´ç›¸äº’çš„æ„Ÿæƒ…èƒŒå›ä¸ç¾éš¾ä¸­çš„æ”¯æ’‘ï¼Œçˆ¶æ¯å­å¥³ä¹‹é—´çš„çˆ±ä¸äº²æƒ…ï¼Œäººæ€§çš„åšå¼ºä¸è½¯å¼±ï¼Œä»è€Œä½¿å¾—è¿™æœ¬ä¹¦æ›´ä¸ºä¸°å¯Œã€å¤æ‚ï¼Œå…·æœ‰è¡€è‚‰ã€‚</p></blockquote><h2 id="5-æœˆ"><a href="#5-æœˆ" class="headerlink" title="5 æœˆ"></a>5 æœˆ</h2><h3 id="è‡´å‘½çš„è‡ªè´Ÿï¼šç¤¾ä¼šä¸»ä¹‰çš„è°¬è¯¯"><a href="#è‡´å‘½çš„è‡ªè´Ÿï¼šç¤¾ä¼šä¸»ä¹‰çš„è°¬è¯¯" class="headerlink" title="è‡´å‘½çš„è‡ªè´Ÿï¼šç¤¾ä¼šä¸»ä¹‰çš„è°¬è¯¯"></a>è‡´å‘½çš„è‡ªè´Ÿï¼šç¤¾ä¼šä¸»ä¹‰çš„è°¬è¯¯</h3><p>åœ°çƒçš„æ¼”å˜æ•…äº‹</p><h3 id="å›¾è§£ç§‘æŠ€è¯‘ä¸›ï¼šæ¼«ç”»å…ƒç´ 118"><a href="#å›¾è§£ç§‘æŠ€è¯‘ä¸›ï¼šæ¼«ç”»å…ƒç´ 118" class="headerlink" title="å›¾è§£ç§‘æŠ€è¯‘ä¸›ï¼šæ¼«ç”»å…ƒç´ 118"></a>å›¾è§£ç§‘æŠ€è¯‘ä¸›ï¼šæ¼«ç”»å…ƒç´ 118</h3><h3 id="äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†"><a href="#äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†" class="headerlink" title="äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†"></a>äººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†</h3><h4 id="ä½œè€…-2"><a href="#ä½œè€…-2" class="headerlink" title="ä½œè€…"></a>ä½œè€…</h4><p><strong>å¾è´²</strong></p><h4 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>ä¹‹å‰æˆ‘ä¹Ÿè¯»è¿‡ä»–çš„è®ºæ–‡ <a href="https://matters.news/@philosophia1979/å¾è´²-ä¸­å›½çš„-æ–°ææƒä¸»ä¹‰-åŠå…¶æœ«ä¸–æ™¯è±¡-é‡å…½èè¯»-bafyreiegbg5tti3ljc7newaah5wp36ncf7fvb2oaovd6p7elc4xqfhbcd4" target="_blank" rel="noopener">ã€Šä¸­å›½çš„â€œæ–°ææƒä¸»ä¹‰â€åŠå…¶æœ«ä¸–æ™¯è±¡ã€‹</a>) ï¼Œæ‰€ä»¥å¯¹ä»–å…³æ³¨çš„å†…å®¹ä¹Ÿæœ‰æ‰€äº†è§£ã€‚æ€»æ„Ÿè§‰è¿™æœ¬ä¹¦æ›´åƒæ˜¯é˜¿ä¼¦ç‰¹ã€åŠ ç¼ªã€è¨ç‰¹ã€å“ˆç»´å°”ç­‰äººå¯¹äºææƒä¸»ä¹‰è‘—ä½œåŠæ€æƒ³çš„è§£æã€‚å°±åƒåœ¨å‰©ä½™ä»·å€¼é‡Œæåˆ°çš„ï¼Œæˆ‘ä»¬è¯»è¿™äº›å†å²çš„æ—¶å€™ï¼Œè€Œå½“ä¸‹å°±ä»¿ä½›ç½®èº«äºå†å²ä¹‹ä¸­ä¸€æ ·ã€‚ä¹¦ä¸­è®°å½•è‹è”å’Œçº³ç²¹å¾·å›½ææƒç»Ÿæ²»æ”¹é€ äººæ€§çš„è¨€è®ºå®¡æŸ¥ã€ç§˜å¯†è­¦å¯Ÿã€é›†ä¸­è¥ã€æ— è¨€è®ºè‡ªç”±å’Œæ–°é—»è‡ªç”±ã€å…šåª’æ„šæ°‘æ´—è„‘ç­‰ï¼Œè¿™äº›æè¿°ææƒç»Ÿæ²»çš„å†å²ï¼Œå†çœ‹ä¸€çœ‹å½“ä¸‹ï¼Œæˆ‘ä»¬ä¸æ­£ç½®èº«äºå…¶ä¸­å—ï¼Ÿ</p><ul><li><strong>æ¯”ç˜Ÿç–«æ›´å¯æ€•çš„æ˜¯è¬Šè¨€ï¼Œæ¯”ç½é›£æ›´å¯æ€•çš„æ˜¯éºå¿˜</strong></li></ul><p><img src="img/20200618225156768.png" alt="image-20200618225156768"></p><p><img src="img/2020-06-09_15-46-37.jpg" alt=""></p><p><img src="img/2020-06-09_15-46-372.jpg" alt=""></p><p><img src="img/2020-06-09_15-46-373.jpg" alt=""></p><p>è¯ºè´å°”å’Œå¹³å¥–å¾—ä¸» <a href="https://www.rfa.org/mandarin/pinglun/liuxiaobopinglunzhuanji/64-06022008113911.html" target="_blank" rel="noopener">åˆ˜æ™“æ³¢æ›¾ç»è¯´è¿‡ï¼Œ</a>â€œé—å¿˜ç½ªæ¶å†å²çš„æ°‘æ—ï¼Œå†³ä¸ä¼šæœ‰çœŸæ­£çš„æœªæ¥ã€‚â€</p><blockquote><p>  â€œå¯¹äºä¸€ä¸ªæ°‘æ—æ¥è¯´ï¼Œè®°å¿†å¯¹é—å¿˜çš„æŠ—æ‹’ï¼Œé¦–å…ˆæ˜¯çŸ¥è¯†ç²¾è‹±çš„è‰¯çŸ¥å¯¹å¼ºæƒçš„æŠ—æ‹’ã€‚å¦åˆ™çš„è¯ï¼Œæˆ‘ä»¬éä½†æ— æ³•æŠŠå…­å››å¤§å± æ€çš„çœŸç›¸ã€è¿›è€ŒæŠŠç‹¬è£åˆ¶åº¦çš„ç½ªæ¶å˜æˆæ°‘ä¼—çš„å†å²å¸¸è¯†ï¼Œä¹Ÿæ— æ³•é˜²æ­¢ç±»ä¼¼å¤§æ‚²å‰§çš„é‡æ¼”ã€‚éš¾é“ä¸­å›½å†å²åœ¨ä¸“åˆ¶ä¸‹æ¶æ€§å¾ªç¯çš„æ—¶é—´è¿˜ä¸å¤Ÿé•¿å—ï¼Ÿâ€</p></blockquote><p>æœ€ç»ˆï¼Œå› ä¸ºé—å¿˜ç½ªæ¶å†å²è€Œå—å®³çš„ï¼Œåªä¼šæ˜¯ä¸­å›½äººè‡ªå·±ã€‚</p><p>å°±åƒåˆ˜æ™“æ³¢æ‰€è¯´çš„é‚£æ ·ï¼š</p><p><strong>â€œç”¨æ°‘é—´è®°å¿†æŠ—æ‹’å®˜æ–¹çš„å¼ºåˆ¶é—å¿˜ï¼Œå°±æ˜¯ä¸ºæˆ‘ä»¬è¿™ä¸ªå†å°½è‹¦éš¾çš„æ°‘æ—ä¿å­˜è®°å¿†å’Œè‰¯çŸ¥ã€‚â€</strong></p><blockquote><p>  äººæ°‘â€œè·å¾—â€çš„â€œå›½å®¶å†å²â€æ˜¯é‚£äº›è®°å½•ä¸‹æ¥ï¼Œæˆ–è€…è¯´è¢«æƒåŠ›å…è®¸è®°å½•ä¸‹æ¥çš„â€œäº‹ä»¶â€ï¼Œè€Œé‚£äº›æ²¡æœ‰è¢«è®°å½•æˆ–ä¸è¢«å…è®¸è®°å½•ä¸‹æ¥çš„äº‹ä»¶ï¼Œå°±æ­¤è¢«æ­¦æ–­åœ°ä»å›½å®¶å†å²ä¸­å‰”é™¤ï¼Œä¹Ÿä»æ—ç¾¤è®°å¿†ä¸­æ’æ–¥å‡ºå»äº†ã€‚å› æ­¤ï¼Œå¯¹å†å²çœŸå®ä¿æŒæ²‰é»˜ï¼Œè™½ç„¶æ˜¯ä»æ”¹å†™å†å²å¼€å§‹ï¼Œä½†æœ€ç»ˆå´è¡¨ç°ä¸ºæ—ç¾¤çš„é›†ä½“å¿˜å´ã€‚æ¯ä¸ªæ²‰é»˜çš„ä¸ªäººï¼Œæ¯ä¸ªåœ¨æ—ç¾¤ä¸­æŒ‰æƒåŠ›æ„å¿—æ¥è®°å¿†æˆ–å¿˜å´çš„äººï¼Œéƒ½å‚ä¸åœ¨ä»¥æ²‰é»˜ä»£æ›¿çœŸå®ï¼Œä»¥æ²‰é»˜ç»´æŒè°è¨€çš„å…±è°‹ä¹‹ä¸­ã€‚</p></blockquote><h3 id="é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–"><a href="#é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–" class="headerlink" title="é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–"></a>é¢“åºŸä¸æ²‰é»˜ï¼šé€è§†çŠ¬å„’æ–‡åŒ–</h3><p>æ°å¥½è¯»å®Œè¿™æœ¬ä¹¦ä¹‹åä¸ä¹… B ç«™å°±ä¸Šæ˜ äº†åæµªæ´—è„‘å®£ä¼ ç‰‡ï¼Œä¸æ–™å¾®åšè¯„è®ºåŒºä¹Ÿæ˜¯ç¿»è½¦ç°åœºğŸ¤£</p><p><img src="img/2020-05-04_17-31-222.jpg" alt=""></p><p><img src="img/2020-05-04_17-31-223.jpg" alt=""></p><p>ç¬¬ä¸€æ¬¡å¬è¯´åˆ°åæµªçš„æ—¶å€™æˆ‘å°±è§‰ç€ï¼Œè¿™ç±»èº«å±…é«˜ä½çš„çŠ¬å„’çŸ¥è¯†ä»½å­ï¼Œå¦‚èƒ¡é”¡è¿›ã€èƒ¡éé’¢ã€é‡‘ç¿è£ã€å¼ ç»´ä¸ºè¿™ç±»ï¼Œä¸ºå½“æƒè€…æ­ŒåŠŸèµå¾·ã€æ‹é©¬æºœé¡»ã€è°„åªšçŒ®åªšã€é˜¿è°€å¥‰æ‰¿ï¼Œè¿™ç±»äººåº”è¯¥æ¯”ä»»ä½•äººéƒ½æ¸…æ¥šåœ¨è¿™å¤ªå¹³ç››ä¸–çš„èƒŒåï¼ŒæŠ“æ•äº†å¤šå°‘ç»´æƒå¾‹å¸ˆã€è¿«å®³äº†å¤šå°‘å¼‚è®®äººå£«ã€å…³æŠ¼äº†å¤šå°‘å…¬æ°‘è®°è€…ã€å¤„åˆ†äº†å¤šå°‘ç›´è¨€æ•™å¸ˆã€‚ç„¶è¿™äº›çŸ¥è¯†åˆ†å­ã€æ•™æˆã€ä¸“å®¶åœ¨è¯´å‡è¯ï¼Œç”¨æ‰€è°“çš„â€å­¦æœ¯â€æ¥å–æ‚¦å’ŒæŠ•é æƒåŠ›å’Œå½“æƒè€…,è°‹å–ç§åˆ©ï¼Œä»¥è²Œä¼¼é«˜æ·±ã€æ¸Šåšã€ç²¾è‡´çš„ç†è®ºåŒ…è£…æ™®é€šäººç”¨å¸¸è¯†å°±èƒ½çœ‹ç©¿çš„æ…Œè¨€ï¼Œæœ‰çš„ç”šè‡³è¿˜ç›¸å½“â€å¯Œæœ‰åˆ›æ„â€ï¼Œå–„äºâ€ç†è®ºæ›´æ–°â€,æˆ–æœ‰â€ç†è®ºå»ºæ ‘â€ã€‚</p><p>åœ¨æ”¿æ²»æ„è¯†å½¢æ€ä¸»å¯¼ä¸€åˆ‡,æƒåŠ›å¯ä»¥æ“æ§ä¸€åˆ‡çš„ç¤¾ä¼šé‡Œ,ä¸å­˜åœ¨æ‰€è°“çš„â€ç‹¬ç«‹å­¦æœ¯â€,å°¤å…¶ä¸å­˜åœ¨ç‹¬ç«‹çš„äººæ–‡å­¦æœ¯ã€‚ä¸€äº›çŸ¥è¯†åˆ†å­å› ä¸ºä¸å¾—å·²è€Œåšâ€çº¯å­¦é—®â€,æ˜¯ä¸€ç§æ†‹å±ˆçš„å­¦æœ¯â€è‡ªå®«â€ã€‚æƒåŠ›çš„å’¸èƒä¸åˆ©è¯±é€ å°±ä½“åˆ¶æ€§çš„â€å­¦æœ¯ä¹‰å„’â€,å®ƒå¾€å¾€æ˜¯ä¸€ç§åœ¨æ¸…é†’çŠ¶æ€ä¸‹çš„è£…å‚»â€”â€”ä¸€é¢è‡ªå˜²,ä¸€é¢é…åˆä½“åˆ¶,ç§¯æè‡ªæˆ‘å®¡æŸ»ï¼›ä¸€é¢å’’éª‚,ä¸€é¢è¿åˆä½“åˆ¶çš„æ— ç†è¦æ±‚ï¼›ä¸€é¢é„™è§†ä¸æ‡‚å­¦æœ¯çš„é¡¶å¤´ä¸Šå¸,ä¸€é¢é¡ºä»ä»–ä»¬çš„é¢†å¯¼æƒå¨ï¼›ä¸€é¢å˜²ç¬‘,ä¸€é¢å‚ä¸ä¸ºå®˜å‘˜æˆäºˆå„ç§çœŸçš„å‡å­¦ä½å’Œå‡å¤´è¡”ã€‚</p><blockquote><p>  é˜¿ä¼¦ç‰¹åœ¨1963å¹´7æœˆ24æ—¥ç»™å‹äººå¡æ–¯è´å°”ï¼ˆGerhard Casperï¼‰çš„ä¿¡é‡Œå†™é“:â€äººä»¬ç»å¸¸å‘ç°,æ´—è„‘æ¬ºéª—æœ€è‚¯å®šçš„é•¿æœŸåæœå°±æ˜¯é€ æˆçŠ¬å„’ä¸»ä¹‰â€”â€”ç»å¯¹ä¸ç›¸ä¿¡ä»»ä½•äº‹æƒ…å¯èƒ½æ˜¯çœŸçš„,å“ªæ€•æ˜¯ç¡®æœ‰å®æ®çš„çœŸå®,ä¹Ÿç…§æ ·ä¸ç›¸ä¿¡ã€‚æ¢è¨€ä¹‹,å®Œå…¨ç”¨è°è¨€æ¥ä»£æ›¿äº‹å®çœŸç›¸çš„ç»“æœä¸æ˜¯äººä»¬ä¼šæŠŠè°è¨€å½“ä½œçœŸå®,æˆ–è€…çœŸå®ä¼šè¢«å½“ä½œä¸ºè°è¨€,è€Œæ˜¯æˆ‘ä»¬èµ–ä»¥åœ¨çœŸå®ä¸–ç•Œé‡Œå­˜åœ¨çš„çŸ¥è§‰ä¼šè¢«å®Œå…¨æ‘§æ¯ã€‚äººç±»ä¸ºäº†ç”Ÿå­˜,å¿…é¡»å…·å¤‡åŸºæœ¬çŸ¥è§‰,å…¶ä¸­å°±æœ‰å¯¹çœŸå’Œå‡çš„è¯†åˆ«ã€‚â€</p></blockquote><blockquote><p>  é˜¿ä¼¦ç‰¹è®¤ä¸º,ç¤¾ä¼šä¸­çš„å¤šæ•°äººé›†ä½“æŠ•å‘çŠ¬å„’ä¸»ä¹‰,æ˜¯å› ä¸ºæ”¿æ²»æƒåŠ›é•¿æœŸç”¨è°è¨€æ¥ä»£æ›¿çœŸå®,å¤§è§„æ¨¡åœ°å¯¹ç¾¤ä¼—è¿›è¡Œæ´—è„‘å¹¶æ¬ºéª—ä»–ä»¬ã€‚è¿™æ˜¯20ä¸–çºªæ‰æœ‰çš„ç»Ÿæ²»æ–¹å¼,æœ€å…¸å‹çš„ä¾‹å­å°±æ˜¯æ–¯å¤§æ—ç»Ÿæ²»æ—¶æœŸå¦è®¤æ‰˜æ´›èŒ¨åŸºæ›¾å¯¹ä¿„ç½—æ–¯é©å‘½æœ‰è¿‡ä»»ä½•è´¡çŒ®ã€‚é˜¿ä¼¦ç‰¹ç§°æ­¤ä¸ºâ€ææƒè°è¨€â€,å®ƒè¦ç¼–é€ çš„æ˜¯ä¸€ç§å®Œå…¨è™šå‡çš„,å› æ­¤å½»åº•é¢ è¦†çœŸä¼ªåŒºåˆ«çš„â€çœŸå®â€ã€‚</p></blockquote><h4 id="çŠ¬å„’ä¸»ä¹‰"><a href="#çŠ¬å„’ä¸»ä¹‰" class="headerlink" title="çŠ¬å„’ä¸»ä¹‰"></a>çŠ¬å„’ä¸»ä¹‰</h4><ul><li>ï¼ˆ1ï¼‰å¨±ä¹è‡³æ­»ï¼ˆæ²¡æœ‰ç›®æ ‡æˆ–ä¿¡ä»°,å¾—è¿‡ä¸”è¿‡ï¼‰ï¼›</li><li>ï¼ˆ2ï¼‰çœ‹å®¢å¿ƒæ€ï¼ˆçœ‹ç©¿ã€å†·æ¼ ã€å›´è§‚,ç®¡äº†ä¹Ÿæ²¡ç”¨,ä¸å¦‚ä¸ç®¡ï¼‰ï¼›</li><li>ï¼ˆ3ï¼‰ä¹ æƒ¯æ€§æ€€ç–‘ï¼ˆä¸Šè‡³æ”¿åºœ,ä¸‹è‡³æœ‹å‹,å¯¹è°éƒ½ä¸ä¿¡ä»»,éƒ½ä¸ç›¸ä¿¡ï¼‰ï¼›</li><li>ï¼ˆ4ï¼‰å®¡ä¸‘å¿ƒç†ï¼ˆåœ¨ä¸€ä¸ªæ˜¯éä¸åˆ†çš„ç¯å¢ƒé‡Œ,ç¾ä¸‘ã€å–„æ¶ã€çœŸå‡ä¹Ÿæ— æ³•è¾¨åˆ«,ä½•å¿…è¦åšæŒçœŸã€å–„ã€ç¾ï¼‰ï¼›</li><li>ï¼ˆ8ï¼‰â€é¸µé¸Ÿå¿ƒæ€â€ï¼ˆå¤šä¸€äº‹ä¸å¦‚å°‘ä¸€äº‹,è¢«å®£ä¼ çš„ç°å®åæ­£æ˜¯å‡çš„,ä¸å¦‚â€èº²è¿›å°æ¥¼æˆä¸€ç»Ÿâ€ï¼‰;</li><li>ï¼ˆ9ï¼‰æ€è€ƒææƒ§ç—‡ï¼ˆå¤šæ€å¤šæƒ¹äº‹,æœ‰çš„æ˜¯å‰è½¦ä¹‹é‰´,ä½ è¦æˆ‘æ€ä¹ˆè¯´,æˆ‘å°±æ€ä¹ˆè¯´,è¿™æ‰æ˜¯å®‰èº«ä¿å‘½ä¹‹é“ï¼‰ï¼›</li><li>ï¼ˆ11ï¼‰ç‚«å¯Œå¿ƒæ€ï¼ˆçœ‹ç©¿ä¸€äº›é“å¾·ã€ç†æƒ³ã€æœªæ¥å±•æœ›çš„è™šå¦„,åªæœ‰é’±æ‰æ˜¯å®åœ¨çš„,æ‰æ˜¯ä¸–äººè®¤å¯çš„å”¯ä¸€ä»·å€¼ï¼‰ï¼›</li><li>ï¼ˆ12ï¼‰åˆè€ç—‡ï¼ˆæ²¡æœ‰å‰é€”ã€æ²¡æœ‰æœªæ¥ã€æ²¡æœ‰è¿½æ±‚,è¿‡ä¸€å¤©ç®—ä¸€å¤©,ååƒç­‰æ­»ï¼‰ï¼›</li><li>ï¼ˆ13ï¼‰è‡ªè™å¿ƒæ€ï¼ˆè¿™ä¸ªè¯´æ³•å¹¶ä¸ç¡®å®,å› ä¸ºä¸€èˆ¬äººæ—¢éå…±äº§å…šåˆéä½“åˆ¶,ä¸æ˜¯â€è‡ªè™â€,è¿™ç§é¡¾å·¦å³è€Œè¨€ä»–çš„è¯´æ³•,æ˜ç™½äººè¯´ç³Šæ¶‚è¯,æ—¢ä¸è¯šå®,ä¹Ÿä¸çœŸå®,å®ƒæœ¬èº«å°±æ˜¯çŠ¬å„’ä¸»ä¹‰çš„ï¼‰ã€‚</li></ul><blockquote><p>  å¯¹çŠ¬å„’çš„ç°ä»£å®šä¹‰æ˜¯æœ‰ä»£è¡¨æ€§çš„:ä¸€ã€æŒ‘åˆºã€å˜²ç¬‘ã€è®½åˆºï¼›äºŒã€ä¸ç›¸ä¿¡æˆ–è£…ç€ä¸ç›¸ä¿¡æ™®é€šäººæ¥å—çš„é“å¾·ä»·å€¼è§‚å’Œäººç±»è¡Œä¸ºçœŸè¯šçš„å–„è‰¯åŠ¨æœº,æŠŠè‡ªç§è‡ªåˆ©è®¤ä½œå”¯ä¸€å¯èƒ½çš„åŠ¨æœºï¼›è½»è”‘ã€é„™è§†ã€å˜²è®½çš„æ€€ç–‘å’Œä¸ç›¸ä¿¡ã€‚</p></blockquote><p>åˆ˜æ™“æ³¢æ›¾åœ¨ <a href="http://www.liu-xiaobo.org/blog/archives/12412" target="_blank" rel="noopener">åˆ˜æ™“æ³¢ï¼šåœ¨åˆ€é”‹ä¸Šè¡Œèµ°â€”â€”ç‹±ä¸­è¯»ã€Šå¸ƒæ‹‰æ ¼ç²¾ç¥ã€‹</a> å†™è¿‡ï¼š</p><blockquote><p>  æ®å…‹é‡Œç›çš„ä»‹ç»ï¼Œåœ¨å‰è‹ä¸œææƒä¸‹çš„æ·å…‹çŸ¥è¯†åˆ†å­ç¾¤ä½“ä¸­ï¼Œä¸ä»…å‡ºç°äº†å“ˆç»´å°”è¿™æ ·çš„é“ä¹‰ç¤ºèŒƒï¼Œè€Œä¸”æœ‰95ï¼…ä»¥ä¸Šçš„äººä¸ºäº†è‡ªç”±å’Œè‰¯çŸ¥è€Œè¿›è¡Œç€å„ç§å½¢å¼çš„æ‹’ç»ï¼Œåªæœ‰ä¸åˆ°5%çš„äººç”˜æ„¿å •è½ä¸ºå–èº«æŠ•é è€…ã€‚è¿™å½“ç„¶æ˜¯è®©ä¸­å›½çŸ¥è¯†åˆ†å­è‡ªè§‰ç¾æ„§çš„è¡¨ç°ã€‚æˆ‘ä»¬æ²¡æœ‰æ·å…‹äººé‚£ç§æ¸…é†’å’ŒåšéŸ§ï¼Œä»…ä»…åå¹´çš„æ—¶é—´ï¼Œå…­å››çš„ä¼¤å£ä¾¿è¢«é—å¿˜ï¼Œè¿™ä¸å…‰æ˜¯å› ä¸ºå®˜æ–¹çš„å¼ºåˆ¶ï¼Œä¹Ÿæ˜¯æ°‘æ—çµé­‚çš„å†·æ¼ ã€‚çŸ¥è¯†åˆ†å­ç¾¤ä½“ä¸èƒ½ä»¥è¨€è¡Œæ¥æ´—åˆ·è€»è¾±ï¼Œæ—¢æºäºå¤–åœ¨çš„æ”¿æ²»ææ€–ï¼Œæ›´æºäºä»–ä»¬ç”Ÿå‘½ä¸­æ´—åˆ·è€»è¾±çš„å†²åŠ¨å·²ç»æ­»äº¡ã€‚</p></blockquote><h3 id="ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘"><a href="#ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘" class="headerlink" title="ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘"></a>ç»Ÿæ²»ä¸æ•™è‚²ï¼šä»å›½æ°‘åˆ°å…¬æ°‘</h3><blockquote><p>  ææƒæ”¿ä½“å½»åº•æ§åˆ¶ä¸æ€æƒ³ã€è¨€è®ºã€æ–°é—»æœ‰å…³çš„è¦å®³é¢†åŸŸï¼Œæ•™è‚²æ˜¯è¢«ç®¡åˆ¶å¾—æœ€ä¸¥å‰çš„é¢†åŸŸä¹‹ä¸€ï¼Œå’Œå®£ä¼ ä¸€æ ·ï¼Œè¢«ä¸¥æ ¼æ§åˆ¶ã€‚è¿™æ ·çš„æ•™è‚²è™½ç„¶ä¸æ°‘ä¸»å›½å®¶çš„æ•™è‚²ä¸€æ ·è¢«ç§°ä¸ºâ€œæ•™è‚²â€ï¼Œä½†å®é™…ä¸Šå·²ç»æˆä¸ºæ”¿æ²»æƒåŠ›æ§åˆ¶å›½æ°‘æ€æƒ³å’ŒåŸ¹å…»å­æ°‘çš„å·¥å…·ã€‚è¿™ä¸æ°‘ä¸»å›½å®¶ä¸­å­¦æ ¡æ•™è‚²ä½œä¸ºå…¬æ°‘ç¤¾ä¼šæ–‡åŒ–æœºåˆ¶çš„ä¸€éƒ¨åˆ†ï¼Œèµ·åˆ°åŸ¹å…»æ°‘ä¸»å…¬æ°‘çš„ä½œç”¨ï¼Œæ˜¯å®Œå…¨ä¸åŒçš„ã€‚</p></blockquote><blockquote><p>  çº³ç²¹ç»Ÿæ²»å¾·å›½ï¼Œä¾é çš„ä¸ä»…æ˜¯å®Œå…¨ç”±çº³ç²¹æ§åˆ¶å’Œæ“çºµçš„å›½å®¶æœºå™¨ï¼Œæ”¿åºœã€å„çº§çº³ç²¹å…šç»„ç»‡ã€å…šå«å†›ã€å†²é”‹é˜Ÿã€è­¦å¯Ÿç­‰ï¼Œè€Œä¸”æ›´æ˜¯æ— å¤„ä¸åœ¨çš„çº³ç²¹æ„è¯†å½¢æ€ï¼Œå®ƒæ¸—é€åˆ°å¾·å›½ç¤¾ä¼šã€æ–‡åŒ–ã€æ•™è‚²å’Œå®¶åº­ç”Ÿæ´»çš„æ¯ä¸€ä¸ªè§’è½ï¼Œç¡®ä¿çº³ç²¹æ”¿å…šæˆä¸ºå¾·å›½ä¸»æƒçš„å†…æ ¸ã€‚æ­£æ˜¯ç”±äºçº³ç²¹æ”¿å…šå®é™…ä¸Šå·²ç»æˆä¸ºå¾·å›½ä¸»æƒçš„å†…æ ¸ï¼Œå¾·å›½çš„å›½å®¶ä¸»ä¹‰æ‰ä¼šæŒ‰ç…§çº³ç²¹çš„æ„å¿—è½¬å˜ä¸ºç¬¦åˆçº³ç²¹å…šåˆ©ç›Šï¼Œå¹¶ä¸ºå®ƒçš„åˆ©ç›ŠæœåŠ¡çš„å…šå›½ä¸»ä¹‰ã€‚</p></blockquote><blockquote><p>  åœ¨çº³ç²¹çš„ææƒç»Ÿæ²»åˆ¶åº¦ä¸­ï¼Œå­¦æ ¡è¿›è¡Œçš„æ˜¯ä¸€ç§ç”±ç»Ÿæ²»æ”¿å…šæ„è¯†å½¢æ€æŒ‡æŒ¥çš„å…šåŒ–æ•™è‚²ã€‚è¿™ç§å…šåŒ–æ•™è‚²æ¸—é€åˆ°æ•™è‚²çš„æ¯ä¸€ä¸ªç¯èŠ‚ä¹‹ä¸­ï¼Œè€Œåœ¨æ¯ä¸€ä¸ªç¯èŠ‚ä¸­ä½¿è¿™ç§å…šåŒ–æ„è¯†å½¢æ€é¡ºåˆ©å‘ç”Ÿä½œç”¨çš„æ­£æ˜¯æ— æ•°ç›´æ¥ä»äº‹æ•™å­¦å·¥ä½œçš„æ•™å¸ˆã€‚å…šåŒ–æ•™è‚²è¿«ä½¿äººä»¬ä¸æ–­è¿›è¡Œæ€æƒ³çš„ç›¸äº’çº¯æ´å’Œè‡ªæˆ‘çº¯æ´ï¼Œå®ƒåœ¨è¯¾å ‚é‡Œå‘ç”Ÿä¹‹å‰ï¼Œæ—©å°±å…ˆå·²ç»åœ¨è®¸å¤šæ•™å¸ˆçš„å¤´è„‘ä¸­å‘ç”Ÿäº†ï¼Œå¹¶æˆä¸ºä»–ä»¬çš„æ€ç»´å’Œè¡Œä¸ºä¹ æƒ¯ã€‚æ²¡æœ‰è¿™æ ·çš„æ•™å¸ˆï¼Œå…šåŒ–æ•™è‚²æ˜¯ä¸å¯èƒ½åœ¨å­¦æ ¡é‡Œæœ‰æ•ˆè´¯å½»çš„ã€‚</p></blockquote><blockquote><p>  åœ¨ææƒå›½å®¶é‡Œï¼Œå›½æ°‘å¿…é¡»æœ‰ç›¸åŒçš„æ­£ç¡®è¡¨ç°ï¼Œæ•™å¸ˆåœ¨å­¦æ ¡é‡Œçš„è¡Œä¸ºè¢«å®Œå…¨æ¨¡å¼åŒ–äº†ã€‚æ•™å¸ˆä»¬éƒ½å¿ äºå…šï¼ŒæŒ‰å…šçš„è¦æ±‚å»åšï¼Œä»–ä»¬åœ¨å­¦æ ¡çš„è¡Œä¸ºå¹¶ä¸ä»…ä»…æ˜¯â€œå¥½æ•™å¸ˆâ€è¡Œä¸ºï¼ŒåŒæ—¶ä¹Ÿæ˜¯â€œå¥½å›½æ°‘â€è¡Œä¸ºã€‚å½“ä¸€ä¸ªâ€œå¥½å›½æ°‘â€ï¼Œå°±æ˜¯åƒæ‰€æœ‰å…¶ä»–å›½æ°‘ä¸€æ ·å¯¹é¢†è¢–ã€å…šå’Œå…šå›½è¡¨ç°ç»å¯¹çš„å¿ è¯šã€‚â€œ</p></blockquote><blockquote><p>  çº³ç²¹å¾·å›½å®è¡Œçš„æ˜¯ä¸€ç§å½»åº•çš„ä»¥å›½å®¶ä¸»ä¹‰ä¸ºæ——å·çš„å…šåŒ–æ•™è‚²ï¼Œè¿™ç§æ•™è‚²ä»å„¿ç«¥å¼€å§‹ï¼Œåœ¨è¯¾ç¨‹ã€æ•™å­¦ã€æ•™æã€å¸ˆç”Ÿå…³ç³»çš„æ¯ä¸€ä¸ªç¯èŠ‚ä¸Šéƒ½è´¯å½»çº³ç²¹çš„ææƒç»Ÿæ²»åŸåˆ™ã€‚</p></blockquote><blockquote><p>  åœ¨ã€Šææƒä¸»ä¹‰çš„èµ·æºã€‹ä¸€ä¹¦ä¸­ï¼Œæ±‰å¨œÂ·é˜¿ä¼¦ç‰¹ä»ææƒä¸»ä¹‰åŸå‹çš„ç‰¹ç‚¹ä¸­æ¦‚æ‹¬å‡ºå®ƒæˆåŠŸç»Ÿæ²»çš„ä¸‰å¤§è¦ç´ ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯æš´åŠ›å’Œææƒ§çš„ç»Ÿæ²»ï¼Œè¿«ä½¿äººæ°‘æˆä¸ºç›¸äº’éš”ç»çš„ã€æ— åŠ©æ— æ´çš„æ•£æ²™ä¸ªä½“ï¼Œä»¥åŠå……åˆ†è¿ç”¨â€œç»„ç»‡â€å’Œâ€œå®£ä¼ â€çš„åŠ›é‡ã€‚é˜¿ä¼¦ç‰¹äº²èº«ç»å†è¿‡å¥¹æ‰€æ€è€ƒçš„ææƒä¸»ä¹‰ä¸­æœ€ä¸ºæˆåŠŸçš„ä¸€ç§ï¼Œé‚£å°±æ˜¯å¾·å›½çº³ç²¹çš„ææƒã€‚å¥¹å¯¹ææƒä¸»ä¹‰ä¸‰è¦ç´ çš„æ€»ç»“ä¾¿æ˜¯ä»å¥¹çš„ç›´æ¥ç»éªŒä¸­è§‚å¯Ÿå¾—å‡ºçš„ã€‚</p></blockquote><blockquote><p>  å…šçš„å®£ä¼ è¦æ±‚æ–°é—»ä»â€œæ­£é¢æŠ¥é“â€ï¼Œæ‰€ä»¥æ€»æ˜¯å°½é‡ä¸è®©åæ¶ˆæ¯æ›å…‰ã€‚å®ƒè®¤ä¸ºï¼Œåæ¶ˆæ¯ä¸åˆ©äºç¨³å®šäººå¿ƒï¼Œä¹Ÿå¯èƒ½è¢«åˆ«äººåˆ©ç”¨ï¼Œæ‰€ä»¥ï¼Œåæ¶ˆæ¯ä¹Ÿæˆä¸ºä¸€ç§ä¸èƒ½æ³„éœ²çš„â€œå›½å®¶æœºå¯†â€ã€‚</p></blockquote><h3 id="ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶1-4"><a href="#ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶1-4" class="headerlink" title="ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶1-4"></a>ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶1-4</h3><h3 id="ä¸ƒå ‚æç®€ç‰©ç†è¯¾"><a href="#ä¸ƒå ‚æç®€ç‰©ç†è¯¾" class="headerlink" title="ä¸ƒå ‚æç®€ç‰©ç†è¯¾"></a>ä¸ƒå ‚æç®€ç‰©ç†è¯¾</h3><p>è™½ç„¶è¢«æ§å¾—å¾ˆå¥½ï¼Œä½†è§‰ç€æ²¡å•¥å¥½çœ‹çš„â€¦â€¦ğŸ™„</p><h2 id="6-æœˆ"><a href="#6-æœˆ" class="headerlink" title="6 æœˆ"></a>6 æœˆ</h2><h3 id="è¢«ç¦é”¢çš„å¤´è„‘"><a href="#è¢«ç¦é”¢çš„å¤´è„‘" class="headerlink" title="è¢«ç¦é”¢çš„å¤´è„‘"></a>è¢«ç¦é”¢çš„å¤´è„‘</h3><h3 id="å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾"><a href="#å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾" class="headerlink" title="å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾"></a>å®‡å®™ä»ä¸€ç²’å°˜åŸƒå¼€å§‹ï¼š9å ‚æç®€å®‡å®™è¯¾</h3><p>ä¸é”™çš„å¤©ä½“ç‰©ç†å­¦ç§‘æ™®ï¼Œç®€å•è®²äº†ä¸‹å¤§çˆ†ç‚¸ã€æš´æ¶¨ã€é‡å­åŠ›å­¦ç­‰çŸ¥è¯†ï¼Œä»¥åŠå¦‚ä½•ç»™åœ°çƒç§°é‡é‡ã€å¦‚ä½•æµ‹é‡å¤©ä½“ä¹‹é—´çš„è·ç¦»ç­‰ã€‚</p><h3 id="å®‡å®™ä»èµ·æºåˆ°æœªæ¥"><a href="#å®‡å®™ä»èµ·æºåˆ°æœªæ¥" class="headerlink" title="å®‡å®™ä»èµ·æºåˆ°æœªæ¥"></a>å®‡å®™ä»èµ·æºåˆ°æœªæ¥</h3><p>ä½œè€…é˜µå®¹å¾ˆå¼º</p><h3 id="kubernetes-ç½‘ç»œæƒå¨æŒ‡å—"><a href="#kubernetes-ç½‘ç»œæƒå¨æŒ‡å—" class="headerlink" title="kubernetes ç½‘ç»œæƒå¨æŒ‡å—"></a>kubernetes ç½‘ç»œæƒå¨æŒ‡å—</h3><p>è¿™æ˜¯ä¸€æœ¬æŠ€æœ¯å¹²è´§ï¼Œå†™ä½œé£æ ¼å’Œåšå®¢æä¸ºç›¸ä¼¼ï¼Œä¸»è¦æ˜¯è®²äº†äº› kubernetes åŠå…¶å®¹å™¨ç½‘è·¯çš„åº•å±‚åŸç†ï¼Œæ˜¯å®¹å™¨ç½‘ç»œé‡Œéš¾å¾—çš„ä¸­æ–‡èµ„æ–™ï¼Œå€¼å¾—æ¨èã€‚</p><h3 id="å¤§è¯å¤„ç†å™¨"><a href="#å¤§è¯å¤„ç†å™¨" class="headerlink" title="å¤§è¯å¤„ç†å™¨"></a>å¤§è¯å¤„ç†å™¨</h3><h3 id="Linux-å¼€æºç½‘ç»œå…¨æ ˆè¯¦è§£ï¼šä»-DPDK-åˆ°-OpenFlow"><a href="#Linux-å¼€æºç½‘ç»œå…¨æ ˆè¯¦è§£ï¼šä»-DPDK-åˆ°-OpenFlow" class="headerlink" title="Linux å¼€æºç½‘ç»œå…¨æ ˆè¯¦è§£ï¼šä» DPDK åˆ° OpenFlow"></a>Linux å¼€æºç½‘ç»œå…¨æ ˆè¯¦è§£ï¼šä» DPDK åˆ° OpenFlow</h3><h3 id="ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶5"><a href="#ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶5" class="headerlink" title="ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶5"></a>ä¸‰è§’çš„è·ç¦»æ— é™ä¸ºé›¶5</h3>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;blockquote&gt;
&lt;p&gt; 
        
      
    
    </summary>
    
    
    
      <category term="life" scheme="https://blog.k8s.li/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>æ·±å…¥æµ…å‡ºå®¹å™¨é•œåƒçš„ä¸€ç”ŸğŸ¤”</title>
    <link href="https://blog.k8s.li/Exploring-container-image.html"/>
    <id>https://blog.k8s.li/Exploring-container-image.html</id>
    <published>2020-06-13T16:00:00.000Z</published>
    <updated>2020-06-13T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸Šå‘¨åœ¨å†™<a href="https://blog.k8s.li/skopeo.html">ã€Šé•œåƒæ¬è¿å·¥ skopeo ã€‹</a> çš„æ—¶å€™çœ‹äº†å¾ˆå¤šå…³äºå®¹å™¨é•œåƒç›¸å…³çš„åšå®¢ï¼Œä»å¤§ä½¬ä»¬é‚£é‡Œå·å·å­¦äº†ä¸å°‘çŸ¥è¯†ï¼Œå¯¹å®¹å™¨é•œåƒæœ‰äº†ä¸€ç‚¹ç‚¹æ·±å…¥çš„äº†è§£ã€‚è¿™å‘¨æœ«ä¸€ä¸ªäººé—²ç€å®…åœ¨å®¶é‡Œæ²¡äº‹å°±æŠŠæœ€è¿‘æ‰€å­¦çš„çŸ¥è¯†æ•´ç†ä¸€ä¸‹åˆ†äº«å‡ºæ¥ï¼Œä¾›å¤§å®¶ä¸€èµ·æ¥é£Ÿç”¨ã€‚å†…å®¹æ¯”è¾ƒå¤šï¼Œè€å¿ƒçœ‹å®Œçš„è¯ï¼Œè¿˜æ˜¯èƒ½æ”¶è·ä¸€äº›<del>æ²¡ç”¨çš„</del>çŸ¥è¯†æ»´ğŸ˜‚ã€‚</p><h2 id="æ›´æ–°è®°å½•"><a href="#æ›´æ–°è®°å½•" class="headerlink" title="æ›´æ–°è®°å½•"></a>æ›´æ–°è®°å½•</h2><ul><li>2020-06-13ï¼šè¿˜æœ‰ä¸€äº›æ²¡æœ‰å†™å®Œï¼Œåç»­è¡¥å……</li><li>2020-06-06ï¼š åˆç¨¿</li><li>2020-09-02ï¼šè¡¥å……</li></ul><h2 id="é•œåƒæ˜¯æ€æ ·ç‚¼æˆçš„ğŸ¤”"><a href="#é•œåƒæ˜¯æ€æ ·ç‚¼æˆçš„ğŸ¤”" class="headerlink" title="é•œåƒæ˜¯æ€æ ·ç‚¼æˆçš„ğŸ¤”"></a>é•œåƒæ˜¯æ€æ ·ç‚¼æˆçš„ğŸ¤”</h2><p>æ‰€è°“ç‚¼æˆåƒå°±æ˜¯æ„å»ºé•œåƒå•¦ï¼Œä¸‹é¢ç”¨åˆ°çš„<strong>æ“</strong>å’Œ<strong>ç‚¼åˆ¶</strong>éƒ½æ˜¯æŒ‡çš„æ„å»ºé•œåƒå•¦ï¼Œåªæ˜¯ä¸ªäººä¹ æƒ¯ç”¨è¯­è€Œå·²ğŸ˜‚ã€‚</p><p>æåˆ°å®¹å™¨é•œåƒå°±ä¸å¾—ä¸æä¸€ä¸‹ OCI ï¼Œå³ Open Container Initiative æ—¨åœ¨å›´ç»•å®¹å™¨æ ¼å¼å’Œè¿è¡Œæ—¶åˆ¶å®šä¸€ä¸ªå¼€æ”¾çš„å·¥ä¸šåŒ–æ ‡å‡†ã€‚ç›®å‰ OCI ä¸»è¦æœ‰ä¸‰ä¸ªè§„èŒƒï¼šè¿è¡Œæ—¶è§„èŒƒ <a href="https://github.com/opencontainers/runtime-spec" target="_blank" rel="noopener">runtime-spec</a> ï¼Œé•œåƒè§„èŒƒ <a href="http://www.github.com/opencontainers/image-spec" target="_blank" rel="noopener">image-spec</a> ä»¥åŠä¸å¸¸è§çš„é•œåƒä»“åº“è§„èŒƒ <a href="https://github.com/opencontainers/distribution-spec" target="_blank" rel="noopener">distribution-spec</a> ã€‚å…³äº OCI è¿™äº›è§„èŒƒçš„ä½œç”¨çš„ä½œç”¨ï¼Œå°±å¼•ç”¨ä¸€ä¸‹ <a href="https://wilhelmguo.cn/blog/post/william/%E5%AE%B9%E5%99%A8%E5%BC%80%E6%94%BE%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83%EF%BC%88CRI-OCI%EF%BC%89-2" target="_blank" rel="noopener">å®¹å™¨å¼€æ”¾æ¥å£è§„èŒƒï¼ˆCRI OCIï¼‰</a> ä¸­çš„å†…å®¹ï¼Œæˆ‘ä¹Ÿå°±æ‡’å¾—è‡ªå·±ç»„ç»‡è¯­è¨€çŒæ°´äº†ğŸ˜‚ï¼ˆå‡‘å­—æ•°</p><blockquote><p>åˆ¶å®šå®¹å™¨æ ¼å¼æ ‡å‡†çš„å®—æ—¨æ¦‚æ‹¬æ¥è¯´å°±æ˜¯ä¸å—ä¸Šå±‚ç»“æ„çš„ç»‘å®šï¼Œå¦‚ç‰¹å®šçš„å®¢æˆ·ç«¯ã€ç¼–æ’æ ˆç­‰ï¼ŒåŒæ—¶ä¹Ÿä¸å—ç‰¹å®šçš„ä¾›åº”å•†æˆ–é¡¹ç›®çš„ç»‘å®šï¼Œå³ä¸é™äºæŸç§ç‰¹å®šæ“ä½œç³»ç»Ÿã€ç¡¬ä»¶ã€CPUæ¶æ„ã€å…¬æœ‰äº‘ç­‰ã€‚</p><p>è¿™ä¸¤ä¸ªåè®®é€šè¿‡ OCI runtime filesytem bundle çš„æ ‡å‡†æ ¼å¼è¿æ¥åœ¨ä¸€èµ·ï¼ŒOCI é•œåƒå¯ä»¥é€šè¿‡å·¥å…·è½¬æ¢æˆ bundleï¼Œç„¶å OCI å®¹å™¨å¼•æ“èƒ½å¤Ÿè¯†åˆ«è¿™ä¸ª bundle æ¥è¿è¡Œå®¹å™¨</p><ul><li>æ“ä½œæ ‡å‡†åŒ–ï¼šå®¹å™¨çš„æ ‡å‡†åŒ–æ“ä½œåŒ…æ‹¬ä½¿ç”¨æ ‡å‡†å®¹å™¨åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢å®¹å™¨ï¼Œä½¿ç”¨æ ‡å‡†æ–‡ä»¶ç³»ç»Ÿå·¥å…·å¤åˆ¶å’Œåˆ›å»ºå®¹å™¨å¿«ç…§ï¼Œä½¿ç”¨æ ‡å‡†åŒ–ç½‘ç»œå·¥å…·è¿›è¡Œä¸‹è½½å’Œä¸Šä¼ ã€‚</li><li>å†…å®¹æ— å…³ï¼šå†…å®¹æ— å…³æŒ‡ä¸ç®¡é’ˆå¯¹çš„å…·ä½“å®¹å™¨å†…å®¹æ˜¯ä»€ä¹ˆï¼Œå®¹å™¨æ ‡å‡†æ“ä½œæ‰§è¡Œåéƒ½èƒ½äº§ç”ŸåŒæ ·çš„æ•ˆæœã€‚å¦‚å®¹å™¨å¯ä»¥ç”¨åŒæ ·çš„æ–¹å¼ä¸Šä¼ ã€å¯åŠ¨ï¼Œä¸ç®¡æ˜¯PHPåº”ç”¨è¿˜æ˜¯MySQLæ•°æ®åº“æœåŠ¡ã€‚</li><li>åŸºç¡€è®¾æ–½æ— å…³ï¼šæ— è®ºæ˜¯ä¸ªäººçš„ç¬”è®°æœ¬ç”µè„‘è¿˜æ˜¯AWS S3ï¼Œäº¦æˆ–æ˜¯OpenStackï¼Œæˆ–è€…å…¶å®ƒåŸºç¡€è®¾æ–½ï¼Œéƒ½åº”è¯¥å¯¹æ”¯æŒå®¹å™¨çš„å„é¡¹æ“ä½œã€‚</li><li>ä¸ºè‡ªåŠ¨åŒ–é‡èº«å®šåˆ¶ï¼šåˆ¶å®šå®¹å™¨ç»Ÿä¸€æ ‡å‡†ï¼Œæ˜¯çš„æ“ä½œå†…å®¹æ— å…³åŒ–ã€å¹³å°æ— å…³åŒ–çš„æ ¹æœ¬ç›®çš„ä¹‹ä¸€ï¼Œå°±æ˜¯ä¸ºäº†å¯ä»¥ä½¿å®¹å™¨æ“ä½œå…¨å¹³å°è‡ªåŠ¨åŒ–ã€‚</li><li>å·¥ä¸šçº§äº¤ä»˜ï¼šåˆ¶å®šå®¹å™¨æ ‡å‡†ä¸€å¤§ç›®æ ‡ï¼Œå°±æ˜¯ä½¿è½¯ä»¶åˆ†å‘å¯ä»¥è¾¾åˆ°å·¥ä¸šçº§äº¤ä»˜æˆä¸ºç°å®</li></ul></blockquote><p>å…¶å® OCI è§„èŒƒå°±æ˜¯ä¸€å † markdown æ–‡ä»¶å•¦ï¼Œå†…å®¹ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œä¸åƒ RFC å’Œ ISO é‚£ä¹ˆé«˜æ·±è«æµ‹ï¼Œæ‰€ä»¥æ±æƒ³å¯¹å®¹å™¨é•œåƒæœ‰ä¸ªæ·±å…¥çš„äº†è§£è¿˜æ˜¯æ¨èå¤§å®¶å»è¯»ä¸€ä¸‹è¿™äº› markdown æ–‡ä»¶ğŸ˜‚ã€‚OCI è§„èŒƒæ˜¯å…è´¹çš„å“¦ï¼Œä¸åƒå¤§å¤šæ•° ISO è§„èŒƒè¿˜è¦äº¤é’±æ‰èƒ½çœ‹ï¼ˆï¸¶^ï¸¶ï¼‰å“¼ã€‚</p><h3 id="OCI-image-spec"><a href="#OCI-image-spec" class="headerlink" title="OCI image-spec"></a>OCI image-spec</h3><p>OCI è§„èŒƒä¸­çš„é•œåƒè§„èŒƒ <a href="http://www.github.com/opencontainers/image-spec" target="_blank" rel="noopener">image-spec</a> å†³å®šäº†æˆ‘ä»¬çš„é•œåƒæŒ‰ç…§ä»€ä¹ˆæ ‡å‡†æ¥æ„å»ºï¼Œä»¥åŠæ„å»ºå®Œé•œåƒä¹‹åå¦‚ä½•å­˜æ”¾ï¼Œæ¥ç€ä¸‹æ–‡æåˆ°çš„ Dockerfile åˆ™å†³å®šäº†é•œåƒçš„ layer å†…å®¹ä»¥åŠé•œåƒçš„ä¸€äº›å…ƒæ•°æ®ä¿¡æ¯ã€‚ä¸€ä¸ªé•œåƒè§„èŒƒ image-spec å’Œä¸€ä¸ª Dockerfile å°±æŒ‡å¯¼ç€æˆ‘ä»¬æ„å»ºä¸€ä¸ªé•œåƒï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±ç®€å•äº†è§£ä¸€ä¸‹è¿™ä¸ªé•œåƒè§„èŒƒï¼Œçœ‹çœ‹é•œåƒæ˜¯é•¿ä»€ä¹ˆæ ·å­çš„ï¼Œå¯¹é•œåƒæœ‰ä¸ªå¤§ä½“çš„ä¸»è§‚è®¤è¯†ã€‚</p><p>æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„æè¿°ï¼ŒOCI é•œåƒè§„èŒƒçš„ä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ª markdown æ–‡ä»¶ç»„æˆï¼š</p><blockquote><ul><li><a href="https://github.com/opencontainers/image-spec/blob/master/manifest.md" target="_blank" rel="noopener">Image Manifest</a> - a document describing the components that make up a container image</li><li><a href="https://github.com/opencontainers/image-spec/blob/master/image-index.md" target="_blank" rel="noopener">Image Index</a> - an annotated index of image manifests</li><li><a href="https://github.com/opencontainers/image-spec/blob/master/image-layout.md" target="_blank" rel="noopener">Image Layout</a> - a filesystem layout representing the contents of an image</li><li><a href="https://github.com/opencontainers/image-spec/blob/master/layer.md" target="_blank" rel="noopener">Filesystem Layer</a> - a changeset that describes a containerâ€™s filesystem</li><li><a href="https://github.com/opencontainers/image-spec/blob/master/config.md" target="_blank" rel="noopener">Image Configuration</a> - a document determining layer ordering and configuration of the image suitable for translation into a <a href="https://github.com/opencontainers/runtime-spec" target="_blank" rel="noopener">runtime bundle</a></li><li><a href="https://github.com/opencontainers/image-spec/blob/master/conversion.md" target="_blank" rel="noopener">Conversion</a> - a document describing how this translation should occur</li><li><a href="https://github.com/opencontainers/image-spec/blob/master/descriptor.md" target="_blank" rel="noopener">Descriptor</a> - a reference that describes the type, metadata and content address of referenced content</li></ul></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ annotations.md         # æ³¨è§£è§„èŒƒ</span><br><span class="line">â”œâ”€â”€ config.md              # image config æ–‡ä»¶è§„èŒƒ</span><br><span class="line">â”œâ”€â”€ considerations.md      # æ³¨æ„äº‹é¡¹</span><br><span class="line">â”œâ”€â”€ conversion.md          # è½¬æ¢ä¸º OCI è¿è¡Œæ—¶</span><br><span class="line">â”œâ”€â”€ descriptor.md          # OCI Content Descriptors å†…å®¹æè¿°</span><br><span class="line">â”œâ”€â”€ image-index.md         # manifest list æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ image-layout.md        # é•œåƒçš„å¸ƒå±€</span><br><span class="line">â”œâ”€â”€ implementations.md     # ä½¿ç”¨ OCI è§„èŒƒçš„é¡¹ç›®</span><br><span class="line">â”œâ”€â”€ layer.md               # é•œåƒå±‚ layer è§„èŒƒ</span><br><span class="line">â”œâ”€â”€ manifest.md            # manifest è§„èŒƒ</span><br><span class="line">â”œâ”€â”€ media-types.md         # æ–‡ä»¶ç±»å‹</span><br><span class="line">â”œâ”€â”€ README.md              # README æ–‡æ¡£</span><br><span class="line">â”œâ”€â”€ spec.md                # OCI é•œåƒè§„èŒƒçš„æ¦‚è§ˆ</span><br></pre></td></tr></table></figure><p>æ€»ç»“ä»¥ä¸Šå‡ ä¸ª markdown æ–‡ä»¶ï¼Œ OCI å®¹å™¨é•œåƒè§„èŒƒä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ å—å†…å®¹ï¼š</p><h4 id="layer"><a href="#layer" class="headerlink" title="layer"></a>layer</h4><p><a href="https://github.com/opencontainers/image-spec/blob/master/layer.md" target="_blank" rel="noopener">æ–‡ä»¶ç³»ç»Ÿ</a>ï¼šä»¥ layer ï¼ˆé•œåƒå±‚ï¼‰ä¿å­˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯ä¸ª layer ä¿å­˜äº†å’Œä¸Šå±‚ä¹‹é—´å˜åŒ–çš„éƒ¨åˆ†ï¼Œlayer åº”è¯¥ä¿å­˜å“ªäº›æ–‡ä»¶ï¼Œæ€ä¹ˆè¡¨ç¤ºå¢åŠ ã€ä¿®æ”¹å’Œåˆ é™¤çš„æ–‡ä»¶ç­‰ã€‚</p><h4 id="image-config"><a href="#image-config" class="headerlink" title="image config"></a>image config</h4><p><a href="https://github.com/opencontainers/image-spec/blob/master/config.md" target="_blank" rel="noopener">image config æ–‡ä»¶</a>ï¼šä¿å­˜äº†æ–‡ä»¶ç³»ç»Ÿçš„å±‚çº§ä¿¡æ¯ï¼ˆæ¯ä¸ªå±‚çº§çš„ hash å€¼ï¼Œä»¥åŠå†å²ä¿¡æ¯ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡Œæ—¶éœ€è¦çš„ä¸€äº›ä¿¡æ¯ï¼ˆæ¯”å¦‚ç¯å¢ƒå˜é‡ã€å·¥ä½œç›®å½•ã€å‘½ä»¤å‚æ•°ã€mount åˆ—è¡¨ï¼‰ï¼ŒæŒ‡å®šäº†é•œåƒåœ¨æŸä¸ªç‰¹å®šå¹³å°å’Œç³»ç»Ÿçš„é…ç½®ï¼Œæ¯”è¾ƒæ¥è¿‘æˆ‘ä»¬ä½¿ç”¨ <code>docker inspect &lt;image_id&gt;</code> çœ‹åˆ°çš„å†…å®¹ã€‚</p><ul><li>example</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">  <span class="attr">"config"</span>: &#123;</span><br><span class="line">    <span class="attr">"Hostname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"User"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"bash"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Image"</span>: <span class="string">"sha256:ba8f577813c7bdf6b737f638dffbc688aa1df2ff28a826a6c46bae722977b549"</span>,</span><br><span class="line">    <span class="attr">"Volumes"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Entrypoint"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OnBuild"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"Labels"</span>: <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"container"</span>: <span class="string">"38501d5aa48c080884f4dc6fd4b1b6590ff1607d9e7a12e1cef1d86a3fdc32df"</span>,</span><br><span class="line">  <span class="attr">"container_config"</span>: &#123;</span><br><span class="line">    <span class="attr">"Hostname"</span>: <span class="string">"38501d5aa48c"</span>,</span><br><span class="line">    <span class="attr">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"User"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"/bin/sh"</span>,</span><br><span class="line">      <span class="string">"-c"</span>,</span><br><span class="line">      <span class="string">"#(nop) "</span>,</span><br><span class="line">      <span class="string">"CMD [\"bash\"]"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Image"</span>: <span class="string">"sha256:ba8f577813c7bdf6b737f638dffbc688aa1df2ff28a826a6c46bae722977b549"</span>,</span><br><span class="line">    <span class="attr">"Volumes"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Entrypoint"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OnBuild"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"Labels"</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"created"</span>: <span class="string">"2020-06-07T01:59:47.348924716Z"</span>,</span><br><span class="line">  <span class="attr">"docker_version"</span>: <span class="string">"19.03.5"</span>,</span><br><span class="line">  <span class="attr">"history"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-06-07T01:59:46.877600299Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop) ADD file:a82014afc29e7b364ac95223b22ebafad46cc9318951a85027a49f9ce1a99461 in / "</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-06-07T01:59:47.348924716Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop)  CMD [\"bash\"]"</span>,</span><br><span class="line">      <span class="attr">"empty_layer"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">  <span class="attr">"rootfs"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"layers"</span>,</span><br><span class="line">    <span class="attr">"diff_ids"</span>: [</span><br><span class="line">      <span class="string">"sha256:d1b85e6186f67d9925c622a7a6e66faa447e767f90f65ae47cdc817c629fa956"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="manifest"><a href="#manifest" class="headerlink" title="manifest"></a>manifest</h4><p><a href="https://github.com/opencontainers/image-spec/blob/master/manifest.md" target="_blank" rel="noopener">manifest æ–‡ä»¶</a> ï¼šé•œåƒçš„ config æ–‡ä»¶ç´¢å¼•ï¼Œæœ‰å“ªäº› layerï¼Œé¢å¤–çš„ annotation ä¿¡æ¯ï¼Œmanifest æ–‡ä»¶ä¸­ä¿å­˜äº†å¾ˆå¤šå’Œå½“å‰å¹³å°æœ‰å…³çš„ä¿¡æ¯ã€‚å¦å¤– manifest ä¸­çš„ layer å’Œ config ä¸­çš„ layer è¡¨è¾¾çš„è™½ç„¶éƒ½æ˜¯é•œåƒçš„ layer ï¼Œä½†äºŒè€…ä»£è¡¨çš„æ„ä¹‰ä¸å¤ªä¸€æ ·ï¼Œç¨åä¼šè®²åˆ°ã€‚manifest æ–‡ä»¶æ˜¯å­˜æ”¾åœ¨ registry ä¸­ï¼Œå½“æˆ‘ä»¬æ‹‰å–é•œåƒçš„æ—¶å€™ï¼Œä¼šæ ¹æ®è¯¥æ–‡ä»¶æ‹‰å–ç›¸åº”çš„ layer ã€‚æ ¹æ® OCI image-spec è§„èŒƒä¸­ <a href="https://github.com/opencontainers/image-spec/blob/master/manifest.md" target="_blank" rel="noopener">OCI Image Manifest Specification</a> çš„å®šä¹‰å¯ä»¥å¾—çŸ¥ï¼Œé•œåƒçš„ manifest æ–‡ä»¶ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªç›®æ ‡ï¼šï¼ˆè‹±è¯­ä¸å¥½å°±ä¸ç¿»è¯‘äº†ğŸ˜¥</p><blockquote><p>There are three main goals of the Image Manifest Specification.</p><ul><li>The first goal is content-addressable images, by supporting an image model where the imageâ€™s configuration can be hashed to generate a unique ID for the image and its components.</li><li>The second goal is to allow multi-architecture images, through a â€œfat manifestâ€ which references image manifests for platform-specific versions of an image. In OCI, this is codified in an <a href="https://github.com/opencontainers/image-spec/blob/master/image-index.md" target="_blank" rel="noopener">image index</a>.</li><li>The third goal is to be <a href="https://github.com/opencontainers/image-spec/blob/master/conversion.md" target="_blank" rel="noopener">translatable</a> to the <a href="https://github.com/opencontainers/runtime-spec" target="_blank" rel="noopener">OCI Runtime Specification</a>.</li></ul></blockquote><p>å¦å¤– manifest ä¹Ÿåˆ†å¥½å‡ ä¸ªç‰ˆæœ¬ï¼Œç›®å‰ä¸»æµçš„ç‰ˆæœ¬æ˜¯  <code>Manifest Version 2, Schema 2</code> ï¼Œå¯ä»¥å‚è€ƒ docker çš„å®˜æ–¹æ–‡æ¡£ <a href="https://github.com/docker/distribution/blob/master/docs/spec/manifest-v2-2.md" target="_blank" rel="noopener">Image Manifest Version 2, Schema 2</a> ã€‚registry ä¸­ä¼šæœ‰ä¸ª <code>Manifest List</code> æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æ˜¯ä¸ºä¸åŒå¤„ç†å™¨ä½“ç³»æ¶æ„è€Œè®¾è®¡çš„ï¼Œé€šè¿‡è¯¥æ–‡ä»¶æŒ‡å‘ä¸è¯¥å¤„ç†å™¨ä½“ç³»æ¶æ„ç›¸å¯¹åº”çš„ Image Manifest ï¼Œè¿™ä¸€ç‚¹ä¸è¦ææ··ã€‚</p><ul><li>Example Manifest List</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.list.v2+json"</span>,</span><br><span class="line">  <span class="attr">"manifests"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">7143</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:e692418e4cbaf90ca69d05a66403747baa33ee08806650b51fab815ad7fc331f"</span>,</span><br><span class="line">      <span class="attr">"platform"</span>: &#123;</span><br><span class="line">        <span class="attr">"architecture"</span>: <span class="string">"ppc64le"</span>,</span><br><span class="line">        <span class="attr">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">7682</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:5b0bcabd1ed22e9fb1310cf6c2dec7cdef19f0ad69efa1f392e94a4333501270"</span>,</span><br><span class="line">      <span class="attr">"platform"</span>: &#123;</span><br><span class="line">        <span class="attr">"architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">        <span class="attr">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">        <span class="attr">"features"</span>: [</span><br><span class="line">          <span class="string">"sse4"</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Image Manifest</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "schemaVersion": 2,</span><br><span class="line">  "mediaType": "application/vnd.docker.distribution.manifest.v2+json",</span><br><span class="line">  "config": &#123;</span><br><span class="line">    "mediaType": "application/vnd.docker.container.image.v1+json",</span><br><span class="line">    "size": 1509,</span><br><span class="line">    "digest": "sha256:a24bb4013296f61e89ba57005a7b3e52274d8edd3ae2077d04395f806b63d83e"</span><br><span class="line">  &#125;,</span><br><span class="line">  "layers": [</span><br><span class="line">    &#123;</span><br><span class="line">      "mediaType": "application/vnd.docker.image.rootfs.diff.tar.gzip",</span><br><span class="line">      "size": 5844992,</span><br><span class="line">      "digest": "sha256:50644c29ef5a27c9a40c393a73ece2479de78325cae7d762ef3cdc19bf42dd0a"</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åå†è¡¥å……ä¸€æ®µé«˜ç­–å¤§ä½¬çš„ <a href="http://gaocegege.com/Blog/ormb" target="_blank" rel="noopener">è§£é‡Š</a> ï¼š</p><blockquote><p>Manifest æ˜¯ä¸€ä¸ª JSON æ–‡ä»¶ï¼Œå…¶å®šä¹‰åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ <a href="https://github.com/opencontainers/image-spec/blob/master/config.md" target="_blank" rel="noopener">Config</a> å’Œ <a href="https://github.com/opencontainers/image-spec/blob/master/layer.md" target="_blank" rel="noopener">Layers</a>ã€‚Config æ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼ŒLayers æ˜¯ä¸€ä¸ªç”± JSON å¯¹è±¡ç»„æˆçš„æ•°ç»„ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒConfig ä¸ Layers ä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡çš„ç»“æ„ç›¸åŒï¼Œéƒ½åŒ…æ‹¬ä¸‰ä¸ªå­—æ®µï¼Œåˆ†åˆ«æ˜¯ digestã€mediaType å’Œ sizeã€‚å…¶ä¸­ digest å¯ä»¥ç†è§£ä¸ºæ˜¯è¿™ä¸€å¯¹è±¡çš„ IDã€‚mediaType è¡¨æ˜äº†è¿™ä¸€å†…å®¹çš„ç±»å‹ã€‚size æ˜¯è¿™ä¸€å†…å®¹çš„å¤§å°ã€‚</p><p>å®¹å™¨é•œåƒçš„ Config æœ‰ç€å›ºå®šçš„ mediaType <code>application/vnd.oci.image.config.v1+json</code>ã€‚ä¸€ä¸ª Config çš„ç¤ºä¾‹é…ç½®å¦‚ä¸‹ï¼Œå®ƒè®°å½•äº†å…³äºå®¹å™¨é•œåƒçš„é…ç½®ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯é•œåƒçš„å…ƒæ•°æ®ã€‚é€šå¸¸å®ƒä¼šè¢«é•œåƒä»“åº“ç”¨æ¥åœ¨ UI ä¸­å±•ç¤ºä¿¡æ¯ï¼Œä»¥åŠåŒºåˆ†ä¸åŒæ“ä½œç³»ç»Ÿçš„æ„å»ºç­‰ã€‚</p><p>è€Œå®¹å™¨é•œåƒçš„ Layers æ˜¯ç”±å¤šå±‚ mediaType ä¸º <code>application/vnd.oci.image.layer.v1.*</code>ï¼ˆå…¶ä¸­æœ€å¸¸è§çš„æ˜¯ <code>application/vnd.oci.image.layer.v1.tar+gzip</code>) çš„å†…å®¹ç»„æˆçš„ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œå®¹å™¨é•œåƒæ˜¯åˆ†å±‚æ„å»ºçš„ï¼Œæ¯ä¸€å±‚å°±å¯¹åº”ç€ Layers ä¸­çš„ä¸€ä¸ªå¯¹è±¡ã€‚</p><p>å®¹å™¨é•œåƒçš„ Configï¼Œå’Œ Layers ä¸­çš„æ¯ä¸€å±‚ï¼Œéƒ½æ˜¯ä»¥ Blob çš„æ–¹å¼å­˜å‚¨åœ¨é•œåƒä»“åº“ä¸­çš„ï¼Œå®ƒä»¬çš„ digest ä½œä¸º Key å­˜åœ¨ã€‚å› æ­¤ï¼Œåœ¨è¯·æ±‚åˆ°é•œåƒçš„ Manifest åï¼ŒDocker ä¼šåˆ©ç”¨ digest å¹¶è¡Œä¸‹è½½æ‰€æœ‰çš„ Blobsï¼Œå…¶ä¸­å°±åŒ…æ‹¬ Config å’Œæ‰€æœ‰çš„ Layersã€‚</p></blockquote><h4 id="image-manifest-index"><a href="#image-manifest-index" class="headerlink" title="image manifest index"></a>image manifest index</h4><p><a href="https://github.com/opencontainers/image-spec/blob/master/image-index.md" target="_blank" rel="noopener">index æ–‡ä»¶</a> ï¼šå…¶å®å°±æ˜¯æˆ‘ä»¬ä¸Šé¢æåˆ°çš„ Manifest List å•¦ã€‚åœ¨ docker çš„ <a href="https://github.com/docker/distribution" target="_blank" rel="noopener">distribution</a> ä¸­ç§°ä¹‹ä¸º <code>Manifest List</code> åœ¨ OCI ä¸­å°±å« <a href="https://github.com/opencontainers/image-spec/blob/master/image-index.md" target="_blank" rel="noopener">OCI Image Index Specification</a> ã€‚å…¶å®ä¸¤è€…æ˜¯æŒ‡çš„åŒä¸€ä¸ªæ–‡ä»¶ï¼Œç”šè‡³ä¸¤è€… GitHub ä¸Šæ–‡æ¡£ç»™çš„ example éƒ½ä¸€ä¸€æ¨¡æ ·ğŸ¤£ï¼Œåº”è¯¥æ˜¯ OCI å¤åˆ¶ç²˜è´´ Docker çš„æ–‡æ¡£ğŸ˜‚ã€‚index æ–‡ä»¶æ˜¯ä¸ªå¯é€‰çš„æ–‡ä»¶ï¼ŒåŒ…å«ç€ä¸€ä¸ªåˆ—è¡¨ä¸ºåŒä¸€ä¸ªé•œåƒä¸åŒçš„å¤„ç†å™¨ arch æŒ‡å‘ä¸åŒå¹³å°çš„ manifest æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶èƒ½ä¿è¯ä¸€ä¸ªé•œåƒå¯ä»¥è·¨å¹³å°ä½¿ç”¨ï¼Œæ¯ä¸ªå¤„ç†å™¨ arch å¹³å°æ‹¥æœ‰ä¸åŒçš„ manifest æ–‡ä»¶ï¼Œä½¿ç”¨ index ä½œä¸ºç´¢å¼•ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ arm æ¶æ„çš„å¤„ç†å™¨æ—¶è¦é¢å¤–æ³¨æ„ï¼Œåœ¨æ‹‰å–é•œåƒçš„æ—¶å€™è¦æ‹‰å– arm æ¶æ„çš„é•œåƒï¼Œä¸€èˆ¬å¤„ç†å™¨çš„æ¶æ„éƒ½æ¥åœ¨é•œåƒçš„ tag åé¢ï¼Œé»˜è®¤ latest tag çš„é•œåƒæ˜¯ x86 çš„ï¼Œåœ¨ arm å¤„ç†å™¨çš„æœºå™¨è¿™äº›é•œåƒä¸Šæ˜¯è·‘ä¸èµ·æ¥çš„ã€‚</p><h3 id="å„ç§-id-åˆ†ä¸æ¸…ï¼Ÿ"><a href="#å„ç§-id-åˆ†ä¸æ¸…ï¼Ÿ" class="headerlink" title="å„ç§ id åˆ†ä¸æ¸…ï¼Ÿ"></a>å„ç§ id åˆ†ä¸æ¸…ï¼Ÿ</h3><p>çœ‹å®Œ  <a href="http://www.github.com/opencontainers/image-spec" target="_blank" rel="noopener">image-spec</a> é‡Œé¢æåˆ°çš„å„ç§ id ç›¸ä¿¡ä½ åˆå¾ˆå¤šç–‘æƒ‘ï¼Œåœ¨æ­¤æ€»ç»“ä¸€ä¸‹è¿™äº› id çš„ä½œç”¨ï¼š</p><table><thead><tr><th align="center">image-id</th><th>image config çš„ sha256 å“ˆå¸Œå€¼ï¼Œåœ¨æœ¬åœ°é•œåƒå­˜å‚¨ä¸­ç”±å®ƒå”¯ä¸€æ ‡è¯†ä¸€ä¸ªé•œåƒ</th></tr></thead><tbody><tr><td align="center">image digest</td><td>åœ¨ registry ä¸­çš„ image manifest çš„ sha256 å“ˆå¸Œå€¼ï¼Œåœ¨ registry ä¸­ç”±å®ƒå”¯ä¸€æ ‡è¯†ä¸€ä¸ªé•œåƒ</td></tr><tr><td align="center">diff_ids</td><td>é•œåƒæ¯ä¸€å±‚çš„ id ï¼Œæ˜¯å¯¹ layer çš„æœªå‹ç¼©çš„ tar åŒ…çš„ sha256 å“ˆå¸Œå€¼</td></tr><tr><td align="center">layer digest</td><td>é•œåƒåœ¨ registry å­˜å‚¨ä¸­çš„ id ï¼Œæ˜¯å¯¹ layerå‹ç¼©åçš„ tar åŒ…çš„ sha256 å“ˆå¸Œå€¼</td></tr></tbody></table><p>é•œåƒçš„ image config ä¸­çš„ <code>rootfs</code> å­—æ®µè®°å½•äº†æ¯ä¸€å±‚ layer çš„ idï¼Œè€Œé•œåƒçš„ layer id åˆ™æ˜¯ layer tar åŒ…çš„ sha256 å€¼ï¼Œå¦‚æœé•œåƒçš„ layer æ”¹å˜ï¼Œåˆ™è¿™ä¸ª layer id ä¼šæ”¹å˜ï¼Œè€Œè®°å½•å®ƒçš„ image config å†…å®¹ä¹Ÿä¼šæ”¹å˜ï¼Œimage config å†…å®¹å˜äº†ï¼Œimage config æ–‡ä»¶çš„ sha256 å€¼ä¹Ÿå°±ä¼šæ”¹å˜ï¼Œè¿™æ ·å°±å¯ä»¥ç”± image id å’Œ image digest å”¯ä¸€æ ‡è¯†ä¸€ä¸ªé•œåƒï¼Œè¾¾åˆ°é˜²æ²»ç¯¡æ”¹çš„å®‰å…¨ç›®çš„ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">"rootfs": &#123;</span><br><span class="line">    "type": "layers",</span><br><span class="line">    "diff_ids": [</span><br><span class="line">      <span class="string">"sha256:d1b85e6186f67d9925c622a7a6e66faa447e767f90f65ae47cdc817c629fa956"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><p>ä¼—æ‰€å‘¨çŸ¥ docker é•œåƒéœ€è¦ä¸€ä¸ª Dockerfile æ¥æ„å»ºè€Œæˆï¼Œå½“æˆ‘ä»¬å¯¹ OCI é•œåƒè§„èŒƒæœ‰äº†ä¸ªå¤§è‡´çš„äº†è§£ä¹‹åï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±æ‹¿ç€ Dockerfile è¿™ä¸ª â€å›¾çº¸â€œ å»ä¸€æ­¥æ­¥æ„å»ºé•œåƒã€‚æœ¬æ–‡ä¸å†ç»†è®² Dockerfile çš„è¯¦ç»†ä¹¦å†™å’ŒæŠ€å·§ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šä¼—æ‰€å‘¨çŸ¥çš„å…³äºå†™å¥½ Dockerfile çš„æŠ€å·§ï¼Œæ¯”å¦‚æˆ‘ä¹‹å‰æ°´è¿‡çš„ä¸€ç¯‡ <a href="https://blog.k8s.li/dockerfile-tips.html">Dockerfile æ“é•œåƒçš„å°æŠ€å·§</a> ã€‚</p><p>ä¸‹é¢å°±æ˜¯ <a href="https://webp.sh" target="_blank" rel="noopener">webp server go</a> Dockerfile çš„ä¾‹å­ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> golang:alpine as builder</span><br><span class="line"><span class="keyword">ARG</span> IMG_PATH=/opt/pics</span><br><span class="line"><span class="keyword">ARG</span> EXHAUST_PATH=/opt/exhaust</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apk update ;\</span></span><br><span class="line"><span class="bash">    apk add alpine-sdk ;\</span></span><br><span class="line"><span class="bash">    git <span class="built_in">clone</span> https://github.com/webp-sh/webp_server_go /build ;\</span></span><br><span class="line"><span class="bash">    <span class="built_in">cd</span> /build ;\</span></span><br><span class="line"><span class="bash">    sed -i <span class="string">"s|.\/pics|<span class="variable">$&#123;IMG_PATH&#125;</span>|g"</span> config.json ;\</span></span><br><span class="line"><span class="bash">    sed -i <span class="string">"s|\"\"|\"<span class="variable">$&#123;EXHAUST_PATH&#125;</span>\"|g"</span> config.json ;\</span></span><br><span class="line"><span class="bash">    sed -i <span class="string">'s/127.0.0.1/0.0.0.0/g'</span> config.json</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /build</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> go build -o webp-server .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> alpine</span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> --from=builder /build/webp-server  /usr/bin/webp-server</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> --from=builder /build/config.json /etc/config.json</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /opt</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /opt/exhaust</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"/usr/bin/webp-server"</span>, <span class="string">"--config"</span>, <span class="string">"/etc/config.json"</span>]</span></span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ RUN æŒ‡ä»¤çš„æ¯è¡Œç»“å°¾æˆ‘ä½¿ç”¨çš„æ˜¯ <code>;\</code> æ¥æ¥ä¸‹ä¸€è¡Œ shell ï¼Œå¦ä¸€ç§å†™æ³•æ˜¯ <code>&amp;&amp;</code> ã€‚äºŒè€…æœ‰æœ¬è´¨çš„åŒºåˆ«ï¼Œæ¯”å¦‚ COMMAND 1;COMMAND 2 ï¼Œå½“ COMMAND 1 è¿è¡Œå¤±è´¥æ—¶ä¼šç»§ç»­è¿è¡Œ COMMAND2 ï¼Œå¹¶ä¸ä¼šé€€å‡ºã€‚è€Œ COMMAND 1&amp;&amp; COMMAND 2ï¼Œæ—¶ COMMAND 1 è¿è¡ŒæˆåŠŸæ—¶æ‰æ¥ç€è¿è¡Œ COMMAND 2 ï¼ŒCOMMAND 1 è¿è¡Œå¤±è´¥ä¼šé€€å‡ºã€‚å¦‚æœæ²¡æœ‰åè¶³çš„æŠŠæ¡ä¿è¯æ¯ä¸€è¡Œ shell éƒ½èƒ½æ¯æ¬¡è¿è¡ŒæˆåŠŸå»ºè®®ç”¨ <code>&amp;&amp;</code> ï¼Œè¿™æ ·å¤±è´¥äº†å°±é€€å‡ºæ„å»ºé•œåƒï¼Œä¸ç„¶æ„å»ºå‡ºæ¥çš„é•œåƒä¼šæœ‰é—®é¢˜ã€‚å¦‚æœæ˜¯è€å¸æœºğŸš— çš„è¯å»ºè®®ç”¨ <code>;</code> ï¼Œé€›äº†ä¸€åœˆ docker hub å®˜æ–¹é•œåƒä¸­ç”¨ <code>;</code> è¾ƒå¤šä¸€äº›ï¼Œå› ä¸º <code>;</code> æ¯” <code>&amp;&amp;</code> è¦ç¾è§‚ä¸€äº›ï¼ˆå¤§é›¾ğŸ˜‚ã€‚</p><ul><li>é£æ ¼ä¸€ï¼šæ¯”å¦‚ <a href="https://github.com/nginxinc/docker-nginx/blob/master/stable/buster/Dockerfile" target="_blank" rel="noopener">nginx</a> å®˜æ–¹é•œåƒæ˜¯ç”¨çš„ <code>&amp;&amp;</code>ï¼Œè²Œä¼¼ä¹Ÿæ··å…¥äº† <code>;</code>ğŸ¤£</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">RUN set -x \</span><br><span class="line"><span class="meta">#</span><span class="bash"> create nginx user/group first, to be consistent throughout docker variants</span></span><br><span class="line">    &amp;&amp; addgroup --system --gid 101 nginx \</span><br><span class="line">    &amp;&amp; adduser --system --disabled-login --ingroup nginx --no-create-home --home /nonexistent --gecos "nginx user" --shell /bin/false --uid 101 nginx \</span><br><span class="line">    &amp;&amp; apt-get update \</span><br><span class="line">    &amp;&amp; apt-get install --no-install-recommends --no-install-suggests -y gnupg1 ca-certificates \</span><br><span class="line">    &amp;&amp; \</span><br><span class="line">    NGINX_GPGKEY=573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62; \</span><br><span class="line">    found=''; \</span><br><span class="line">    for server in \</span><br><span class="line">        ha.pool.sks-keyservers.net \</span><br><span class="line">        hkp://keyserver.ubuntu.com:80 \</span><br><span class="line">        hkp://p80.pool.sks-keyservers.net:80 \</span><br><span class="line">        pgp.mit.edu \</span><br><span class="line">    ; do \</span><br></pre></td></tr></table></figure><ul><li>é£æ ¼äºŒï¼šæ¯”å¦‚ <a href="https://github.com/docker-library/redis/blob/23af5b6adb271bcebbcebc93308884438512a4af/6.0/Dockerfile" target="_blank" rel="noopener">redis</a> å®˜æ–¹é•œåƒå°±æ¸…ä¸€è‰²ä½¿ç”¨çš„ <code>;</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">RUN set -eux; \</span><br><span class="line">savedAptMark="$(apt-mark showmanual)"; \</span><br><span class="line">apt-get update; \</span><br><span class="line">apt-get install -y --no-install-recommends ca-certificates dirmngr gnupg wget; \</span><br><span class="line">rm -rf /var/lib/apt/lists/*; \</span><br><span class="line">dpkgArch="$(dpkg --print-architecture | awk -F- '&#123; print $NF &#125;')"; \</span><br><span class="line">wget -O /usr/local/bin/gosu "https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch"; \</span><br><span class="line">wget -O /usr/local/bin/gosu.asc "https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc"; \</span><br><span class="line">export GNUPGHOME="$(mktemp -d)"; \</span><br><span class="line">gpg --batch --keyserver hkps://keys.openpgp.org --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4; \</span><br><span class="line">gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu; \</span><br><span class="line">gpgconf --kill all; \</span><br><span class="line">rm -rf "$GNUPGHOME" /usr/local/bin/gosu.asc; \</span><br><span class="line">apt-mark auto '.*' &gt; /dev/null; \</span><br><span class="line">[ -z "$savedAptMark" ] || apt-mark manual $savedAptMark &gt; /dev/null; \</span><br><span class="line">apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \</span><br><span class="line">chmod +x /usr/local/bin/gosu; \</span><br><span class="line">gosu --version; \</span><br><span class="line">gosu nobody true</span><br></pre></td></tr></table></figure><p>æ±å–œæ¬¢å“ªç§é£æ ¼å‘¢ï¼Ÿå¿«åœ¨è¯„è®ºåŒºç•™è¨€å§ğŸ˜‹</p><h4 id="é•œåƒå·¥å‚ğŸ› "><a href="#é•œåƒå·¥å‚ğŸ› " class="headerlink" title="é•œåƒå·¥å‚ğŸ› "></a>é•œåƒå·¥å‚ğŸ› </h4><blockquote><p>Docker æ˜¯ä¸€ä¸ªå…¸å‹çš„ C/S æ¶æ„çš„åº”ç”¨ï¼Œåˆ†ä¸º Docker å®¢æˆ·ç«¯ï¼ˆå³å¹³æ—¶æ•²çš„ docker å‘½ä»¤ï¼‰ Docker æœåŠ¡ç«¯ï¼ˆdockerd å®ˆæŠ¤è¿›ç¨‹ï¼‰ã€‚</p><p>Docker å®¢æˆ·ç«¯é€šè¿‡ REST API å’ŒæœåŠ¡ç«¯è¿›è¡Œäº¤äº’ï¼Œdocker å®¢æˆ·ç«¯æ¯å‘é€ä¸€æ¡æŒ‡ä»¤ï¼Œåº•å±‚éƒ½ä¼šè½¬åŒ–æˆ REST API è°ƒç”¨çš„å½¢å¼å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å¤„ç†å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚å¹¶ç»™å‡ºå“åº”ã€‚</p><p>Docker é•œåƒçš„æ„å»ºã€å®¹å™¨åˆ›å»ºã€å®¹å™¨è¿è¡Œç­‰å·¥ä½œéƒ½æ˜¯ Docker æœåŠ¡ç«¯æ¥å®Œæˆçš„ï¼ŒDocker å®¢æˆ·ç«¯åªæ˜¯æ‰¿æ‹…å‘é€æŒ‡ä»¤çš„è§’è‰²ã€‚</p><p>Docker å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯ä»¥åœ¨åŒä¸€ä¸ªå®¿ä¸»æœºï¼Œä¹Ÿå¯ä»¥åœ¨ä¸åŒçš„å®¿ä¸»æœºï¼Œå¦‚æœåœ¨åŒä¸€ä¸ªå®¿ä¸»æœºçš„è¯ï¼ŒDocker å®¢æˆ·ç«¯é»˜è®¤é€šè¿‡ UNIX å¥—æ¥å­—(<code>/var/run/docker.sock</code>)å’ŒæœåŠ¡ç«¯é€šä¿¡ã€‚</p></blockquote><p>ç±»æ¯”äºé’¢é“æ˜¯æ€æ ·ç‚¼æˆçš„ï¼Œå¦‚æœè¯´ç‚¼åˆ¶é•œåƒä¹Ÿéœ€è¦ä¸ªå·¥å‚çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ dockerd è¿™ä¸ªå®ˆæŠ¤è¿›ç¨‹å°±æ˜¯ä¸ªç”Ÿäº§é•œåƒçš„å·¥å‚ã€‚èƒ½ç”Ÿäº§é•œåƒçš„ä¸æ­¢ docker ä¸€å®¶ï¼Œçº¢å¸½å­å®¶çš„ <a href="https://buildah.io/" target="_blank" rel="noopener">buildah</a> ä¹Ÿèƒ½ç”Ÿäº§é•œåƒï¼Œä¸è¿‡ç”¨çš„äººå¹¶ä¸å¤šã€‚äºŒè€…çš„æœ€å¤§åŒºåˆ«åœ¨äº buildah å¯ä»¥ä¸ç”¨ root æƒé™æ¥æ„å»ºé•œåƒï¼Œè€Œä½¿ç”¨ docker æ„å»ºé•œåƒæ—¶éœ€è¦ç”¨åˆ° root æƒé™ï¼Œæ²¡æœ‰ root æƒé™çš„ç”¨æˆ·æ„å»ºé•œåƒä¼šå½“åœºç¿»è½¦ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock:</span><br></pre></td></tr></table></figure><p>ä¸è¿‡ buildah æ„å»ºå‡ºæ¥çš„é•œåƒæœ‰ä¸€å †å †çš„å…¼å®¹æ€§é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ docker æ¥æ„å»ºé•œåƒå§ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ docker build å‘½ä»¤æ„å»ºä¸€ä¸ªé•œåƒçš„æ—¶å€™ç¬¬ä¸€è¡Œæ—¥å¿—å°±æ˜¯ <code>Sending build context to Docker daemon xx MB</code>ã€‚è¿™ä¸€æ­¥æ˜¯ docker cli è¿™ä¸ªå‘½ä»¤è¡Œå®¢æˆ·ç«¯å°†æˆ‘ä»¬å½“å‰ç›®å½•ï¼ˆå³æ„å»ºä¸Šä¸‹æ–‡ï¼‰ <code>build context</code> æ‰“åŒ…å‘é€ <code>Docker daemon</code> å®ˆæŠ¤è¿›ç¨‹ ï¼ˆå³ dockerdï¼‰çš„è¿‡ç¨‹ã€‚</p><p><img src="img/docker-architecture.png" alt="img"></p><p>docker build æ„å»ºé•œåƒçš„æµç¨‹å¤§æ¦‚å°±æ˜¯ï¼š</p><ul><li>æ‰§è¡Œ <code>docker build -t &lt;imageName:Tag&gt; .</code>ï¼Œå¯ä»¥ä½¿ç”¨ <code>-f</code>å‚æ•°æ¥æŒ‡å®š Dockerfile æ–‡ä»¶ï¼›</li><li>docker å®¢æˆ·ç«¯ä¼šå°†æ„å»ºå‘½ä»¤åé¢æŒ‡å®šçš„è·¯å¾„(<code>.</code>)ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ª tar åŒ…ï¼Œå‘é€ç»™ Docker æœåŠ¡ç«¯;</li><li>docker æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„ tar åŒ…ï¼Œç„¶åè§£å‹ï¼Œæ¥ä¸‹æ¥æ ¹æ® Dockerfile é‡Œé¢çš„æŒ‡ä»¤è¿›è¡Œé•œåƒçš„åˆ†å±‚æ„å»ºï¼›</li><li>docker ä¸‹è½½ FROM è¯­å¥ä¸­æŒ‡å®šçš„åŸºç¡€é•œåƒï¼Œç„¶åå°†åŸºç¡€é•œåƒçš„ layer è”åˆæŒ‚è½½ä¸ºä¸€å±‚ï¼Œå¹¶åœ¨ä¸Šé¢åˆ›å»ºä¸€ä¸ªç©ºç›®å½•ï¼›</li><li>æ¥ç€å¯åŠ¨ä¸€ä¸ªä¸´æ—¶çš„å®¹å™¨å¹¶åœ¨ chroot ä¸­å¯åŠ¨ä¸€ä¸ª bashï¼Œè¿è¡Œ <code>RUN</code> è¯­å¥ä¸­çš„å‘½ä»¤ï¼š<code>RUN: chroot . /bin/bash -c &quot;apt get updateâ€¦â€¦&quot;</code>ï¼›</li><li>ä¸€æ¡ <code>RUN</code> å‘½ä»¤ç»“æŸåï¼Œä¼šæŠŠä¸Šå±‚ç›®å½•å‹ç¼©ï¼Œå½¢æˆæ–°é•œåƒä¸­çš„æ–°çš„ä¸€å±‚ï¼›</li><li>å¦‚æœ Dockerfile ä¸­åŒ…å«å…¶å®ƒå‘½ä»¤ï¼Œå°±ä»¥ä¹‹å‰æ„å»ºçš„å±‚æ¬¡ä¸ºåŸºç¡€ï¼Œä»ç¬¬äºŒæ­¥å¼€å§‹é‡å¤åˆ›å»ºæ–°å±‚ï¼Œç›´åˆ°å®Œæˆæ‰€æœ‰è¯­å¥åé€€å‡ºï¼›</li><li>æ„å»ºå®Œæˆä¹‹åä¸ºè¯¥é•œåƒæ‰“ä¸Š tagï¼›</li></ul><p>ä»¥ä¸Šå°±æ˜¯æ„å»ºé•œåƒçš„å¤§è‡´æµç¨‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ <code>docker history &lt;imageName:Tag&gt;</code> å‘½ä»¤æ¥é€†å‘æ¨ç®—å‡º docker build çš„è¿‡ç¨‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker history webpsh/webps</span><br><span class="line">IMAGE               CREATED             CREATED BY          SIZE                COMMENT</span><br><span class="line">30d9679b0b1c        2 weeks ago         /bin/sh -c #(nop)  CMD ["/usr/bin/webp-serveâ€¦   0B</span><br><span class="line">&lt;missing&gt;           2 weeks ago         /bin/sh -c #(nop)  VOLUME [/opt/exhaust]        0B</span><br><span class="line">&lt;missing&gt;           2 weeks ago         /bin/sh -c #(nop) WORKDIR /opt                  0B</span><br><span class="line">&lt;missing&gt;           2 weeks ago         /bin/sh -c #(nop) COPY file:1497d882aeef5f77â€¦   168B</span><br><span class="line">&lt;missing&gt;           2 weeks ago         /bin/sh -c #(nop) COPY file:327020918e4dc998â€¦   14.9MB</span><br><span class="line">&lt;missing&gt;           6 weeks ago         /bin/sh -c #(nop)  CMD ["/bin/sh"]              0B</span><br><span class="line">&lt;missing&gt;           6 weeks ago         /bin/sh -c #(nop) ADD file:b91adb67b670d3a6fâ€¦   5.61MB</span><br><span class="line"></span><br><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker history debian:v2</span><br><span class="line">IMAGE               CREATED             CREATED BY           SIZE                COMMENT</span><br><span class="line">e6e782a57a51        38 hours ago        /bin/sh -c #(nop)  CMD ["bash"]                 0B</span><br><span class="line">ba8f577813c7        38 hours ago        /bin/sh -c #(nop) ADD file:a82014afc29e7b364â€¦   69.2MB</span><br></pre></td></tr></table></figure><h4 id="base-image"><a href="#base-image" class="headerlink" title="base image"></a>base image</h4><p>å½“æˆ‘ä»¬åœ¨å†™ Dockerfile çš„æ—¶å€™éƒ½éœ€è¦ç”¨ <code>FROM</code> è¯­å¥æ¥æŒ‡å®šä¸€ä¸ªåŸºç¡€é•œåƒï¼Œè¿™äº›åŸºç¡€é•œåƒå¹¶ä¸æ˜¯æ— ä¸­ç”Ÿæœ‰ï¼Œä¹Ÿéœ€è¦ä¸€ä¸ª Dockerfile æ¥æ„å»ºæˆé•œåƒã€‚ä¸‹é¢æˆ‘ä»¬æ‹¿æ¥ <a href="https://hub.docker.com/_/debian" target="_blank" rel="noopener">debian:buster</a> è¿™ä¸ªåŸºç¡€é•œåƒçš„ <a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/18cb4d0418be1c80fb19141b69ac2e0600b2d601/buster/Dockerfile" target="_blank" rel="noopener">Dockerfile</a> æ¥çœ‹ä¸€ä¸‹åŸºç¡€é•œåƒæ˜¯å¦‚ä½•ç‚¼æˆçš„ã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> scratch</span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> rootfs.tar.xz /</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"bash"</span>]</span></span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªåŸºç¡€é•œåƒçš„ Dockerfile ä¸€èˆ¬ä»…æœ‰ä¸‰è¡Œã€‚ç¬¬ä¸€è¡Œ <code>FROM scratch</code> ä¸­çš„<code>scratch</code> è¿™ä¸ªé•œåƒå¹¶ä¸çœŸå®çš„å­˜åœ¨ã€‚å½“ä½ ä½¿ç”¨ <code>docker pull scratch</code> å‘½ä»¤æ¥æ‹‰å–è¿™ä¸ªé•œåƒçš„æ—¶å€™ä¼šç¿»è½¦å“¦ï¼Œæç¤º <code>Error response from daemon: &#39;scratch&#39; is a reserved name</code>ã€‚è¿™æ˜¯å› ä¸ºè‡ªä» docker 1.5 ç‰ˆæœ¬å¼€å§‹ï¼Œåœ¨ Dockerfile ä¸­ <code>FROM scratch</code> æŒ‡ä»¤å¹¶ä¸è¿›è¡Œä»»ä½•æ“ä½œï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šåˆ›å»ºä¸€ä¸ªé•œåƒå±‚ï¼›æ¥ç€ç¬¬äºŒè¡Œçš„ <code>ADD rootfs.tar.xz /</code> ä¼šè‡ªåŠ¨æŠŠ <code>rootfs.tar.xz</code>  è§£å‹åˆ° <code>/</code> ç›®å½•ä¸‹ï¼Œç”±æ­¤äº§ç”Ÿçš„ä¸€å±‚é•œåƒå°±æ˜¯æœ€ç»ˆæ„å»ºçš„é•œåƒçœŸå®çš„ layer å†…å®¹ï¼›ç¬¬ä¸‰è¡Œ <code>CMD [&quot;bash&quot;]</code> æŒ‡å®šè¿™é•œåƒåœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™æ‰§è¡Œçš„åº”ç”¨ç¨‹åºï¼Œä¸€èˆ¬åŸºç¡€é•œåƒçš„ CMD é»˜è®¤ä¸º bash æˆ–è€… sh ã€‚</p><blockquote><p>As of Docker 1.5.0 (specifically, <a href="https://github.com/docker/docker/pull/8827" target="_blank" rel="noopener"><code>docker/docker#8827</code></a>), <code>FROM scratch</code> is a no-op in the Dockerfile , and will not create an extra layer in your image (so a previously 2-layer image will be a 1-layer image instead).</p></blockquote><p><code>ADD rootfs.tar.xz /</code> ä¸­ï¼Œè¿™ä¸ª <code>rootfs.tar.xz</code> å°±æ˜¯æˆ‘ä»¬ç»è¿‡ä¸€ç³»åˆ—éªšæ“ä½œï¼ˆä¸€èˆ¬æ˜¯å‘è¡Œç‰ˆæºç ç¼–è¯‘ï¼‰æ“å‡ºæ¥çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™ä¸ªæ“ä½œæ¯”è¾ƒå¤æ‚ï¼Œæœ¨å­å¤ªèœäº†ğŸ¥¬å°±ä¸åœ¨è¿™é‡Œçæ°æ°äº†ğŸ™ƒï¼Œå¦‚æœæ±å¯¹æºç æ„å»º <code>rootfs.tar.xz</code> è¿™ä¸ªè¿‡ç¨‹æ„Ÿå…´è¶£å¯ä»¥å»çœ‹ä¸€ä¸‹æ„å»º debian åŸºç¡€é•œåƒçš„ Jenkins æµæ°´çº¿ä»»åŠ¡ <a href="https://doi-janky.infosiftr.net/job/tianon/job/debuerreotype/" target="_blank" rel="noopener">debuerreotype</a>ï¼Œä¸Šé¢æœ‰æ„å»ºè¿™ä¸ª <code>rootfs.tar.xz</code> å®Œæ•´è¿‡ç¨‹ï¼Œæˆ–è€…å‚è€ƒ Debian å®˜æ–¹çš„ <a href="https://github.com/debuerreotype/docker-debian-artifacts" target="_blank" rel="noopener">docker-debian-artifacts</a> è¿™ä¸ª repo é‡Œçš„ shell è„šæœ¬ã€‚</p><p>éœ€è¦é¢å¤–æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨è¿™é‡Œå¾€é•œåƒé‡Œæ·»åŠ  <code>rootfs.tar.xz</code> æ—¶ä½¿ç”¨çš„æ˜¯ <code>ADD</code> è€Œä¸æ˜¯ <code>COPY</code> ï¼Œå› ä¸ºåœ¨ Dockerfile ä¸­çš„ ADD æŒ‡ä»¤ src æ–‡ä»¶å¦‚æœæ˜¯ä¸ª tar åŒ…ï¼Œåœ¨æ„å»ºçš„æ—¶å€™ docker ä¼šå¸®æˆ‘ä»¬æŠŠ tar åŒ…è§£å¼€åˆ°æŒ‡å®šç›®å½•ï¼Œä½¿ç”¨ copy æŒ‡ä»¤åˆ™ä¸ä¼šè§£å¼€ tar åŒ…ã€‚å¦å¤–ä¸€ç‚¹åŒºåˆ«å°±æ˜¯ ADD æŒ‡ä»¤æ˜¯æ·»åŠ ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥æ˜¯æ„å»ºä¸Šä¸‹æ–‡ç¯å¢ƒä¸­çš„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸ª URLï¼Œè€Œ COPY åˆ™åªèƒ½æ·»åŠ æ„å»ºä¸Šä¸‹æ–‡ä¸­çš„æ–‡ä»¶ï¼Œæ‰€è°“çš„æ„å»ºä¸Šä¸‹æ–‡å°±æ˜¯æˆ‘ä»¬æ„å»ºé•œåƒçš„æ—¶å€™æœ€åä¸€ä¸ªå‚æ•°å•¦ã€‚</p><blockquote><p>PSï¼šé¢è¯•çš„æ—¶å€™ç»å¸¸è¢«é—® ADD ä¸ COPY çš„åŒºåˆ«ï¼›CMD ä¸ ENTRYPOINT çš„åŒºåˆ«ğŸ˜‚ã€‚</p></blockquote><p>æ“è¿™ä¸ª <code>rootfs.tar.xz</code> ä¸åŒçš„å‘è¡Œç‰ˆæ–¹æ³•å¯èƒ½ä¸å¤ªä¸€æ ·ï¼ŒDebian å‘è¡Œç‰ˆçš„ <code>rootfs.tar.xz</code> å¯ä»¥åœ¨ <a href="https://github.com/debuerreotype/docker-debian-artifacts" target="_blank" rel="noopener">docker-debian-artifacts</a> è¿™ä¸ª repo ä¸Šæ‰¾åˆ°ï¼Œæ ¹æ®ä¸åŒå¤„ç†å™¨ arch é€‰æ‹©ç›¸åº”çš„ branch ï¼Œç„¶åè¿™ä¸ª branch ä¸‹çš„ç›®å½•å°±å¯¹åº”ç€è¯¥å‘è¡Œç‰ˆçš„ä¸åŒçš„ç‰ˆæœ¬çš„ä»£å·ã€‚æ„å¤–å‘ç° Debian å®˜æ–¹æ˜¯å°†æ‰€æœ‰ arch å’Œæ‰€æœ‰ç‰ˆæœ¬çš„ <code>rootfs.tar.xz</code> éƒ½æ”¾åœ¨è¿™ä¸ª repo é‡Œçš„ï¼Œä»¥è‡³äºè¿™ä¸ª repo çš„å¤§å°æ¥è¿‘ 2.88 GiB ğŸ˜¨ï¼Œå½“ç½‘ç›˜æ¥ç”¨çš„å˜›ğŸ¤£ï¼ˆï¼šæ‰‹åŠ¨æ»‘ç¨½</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~</span><br><span class="line">â•°â”€# git clone https://github.com/debuerreotype/docker-debian-artifacts</span><br><span class="line">Cloning into 'docker-debian-artifacts'...</span><br><span class="line">remote: Enumerating objects: 278, done.</span><br><span class="line">remote: Counting objects: 100% (278/278), done.</span><br><span class="line">Receiving objects:  67% (443/660), 1.60 GiB | 16.96 MiB/s</span><br><span class="line">remote: Total 660 (delta 130), reused 244 (delta 97), pack-reused 382</span><br><span class="line">Receiving objects: 100% (660/660), 2.88 GiB | 16.63 MiB/s, done.</span><br><span class="line">Resolving deltas: 100% (267/267), done.</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠè¿™ä¸ª <code>rootfs.tar.xz</code> è§£å¼€å°±å¯ä»¥çœ‹åˆ°ï¼Œè¿™å°±æ˜¯ä¸€ä¸ª Linux çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œä¸åŒäºæˆ‘ä»¬ä½¿ç”¨ ISO å®‰è£…ç³»ç»Ÿçš„é‚£ä¸ªæ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™ä¸ªæ ¹æ–‡ä»¶ç³»ç»Ÿæ˜¯ç»è¿‡ä¸€ç³»åˆ—çš„è£å‰ªï¼Œå»æ‰äº†ä¸€äº›åœ¨å®¹å™¨è¿è¡Œä¸­ä¸å¿…è¦çš„æ–‡ä»¶ï¼Œä½¿ä¹‹æ›´åŠ è½»é‡é€‚ç”¨äºå®¹å™¨è¿è¡Œçš„åœºæ™¯ï¼Œæ•´ä¸ªæ ¹æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°ä¸º 125Mï¼Œå¦‚æœä½¿ç”¨ slim çš„<code>rootfs.tar.xz</code> ä¼šæ›´å°ä¸€äº›ï¼Œä»…ä»… 76Mã€‚å½“ç„¶ç›¸æ¯”äºä»…ä»…å‡  M çš„ <code>alpine</code> ï¼Œè¿™ç®—æ˜¯å¤Ÿå¤§çš„äº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# git checkout dist-amd64</span><br><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# cd buster</span><br><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# mkdir rootfs</span><br><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# tar -xvf rootfs.tar.xz -C !$</span><br><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# ls rootfs/</span><br><span class="line">bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# du -sh rootfs</span><br><span class="line">125M    rootfs</span><br><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# du -sh slim/rootfs</span><br><span class="line">76M     slim/rootfs</span><br></pre></td></tr></table></figure><p>æƒ³è¦è‡ªå·±æ„å»ºä¸€ä¸ª <code>debian:buster</code> åŸºç¡€é•œåƒå…¶å®å¾ˆç®€å•ï¼Œå°±åƒä¸‹é¢è¿™æ ·ä¸€æŠŠæ¢­æ“ä½œä¸‹æ¥å°±è¡ŒğŸ˜‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/debuerreotype/docker-debian-artifacts debian</span><br><span class="line">cd !$</span><br><span class="line">git checkout dist-amd64</span><br><span class="line">cd buster</span><br><span class="line">docker build -t debian:buster .</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å°±æ˜¯æ„å»º Debian åŸºç¡€é•œåƒçš„è¿‡ç¨‹ï¼Œæ­£å¦‚ Dockerfile ä¸­çš„é‚£æ ·ï¼Œæœ€ç»ˆåªäº§ç”Ÿäº†ä¸€å±‚é•œåƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker build -t debian:buster .</span><br><span class="line">Sending build context to Docker daemon  30.12MB</span><br><span class="line">Step 1/3 : FROM scratch</span><br><span class="line"><span class="meta"> ---&gt;</span></span><br><span class="line">Step 2/3 : ADD rootfs.tar.xz /</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 1756d6a585ae</span></span><br><span class="line">Step 3/3 : CMD ["bash"]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> c86a8b6deb3d</span></span><br><span class="line">Removing intermediate container c86a8b6deb3d</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 04948daa3c2e</span></span><br><span class="line">Successfully built 04948daa3c2e</span><br><span class="line">Successfully tagged debian:buster</span><br></pre></td></tr></table></figure><h2 id="é•œåƒæ˜¯æ€æ ·å­˜æ”¾çš„-ï¼ˆä¸€ï¼‰æœ¬åœ°å­˜å‚¨-ğŸ™„"><a href="#é•œåƒæ˜¯æ€æ ·å­˜æ”¾çš„-ï¼ˆä¸€ï¼‰æœ¬åœ°å­˜å‚¨-ğŸ™„" class="headerlink" title="é•œåƒæ˜¯æ€æ ·å­˜æ”¾çš„ ï¼ˆä¸€ï¼‰æœ¬åœ°å­˜å‚¨ ğŸ™„"></a>é•œåƒæ˜¯æ€æ ·å­˜æ”¾çš„ ï¼ˆä¸€ï¼‰æœ¬åœ°å­˜å‚¨ ğŸ™„</h2><p>å½“æˆ‘ä»¬æ„å»ºå®Œä¸€ä¸ªé•œåƒä¹‹åï¼Œé•œåƒå°±å­˜å‚¨åœ¨äº†æˆ‘ä»¬ docker æœ¬åœ°å­˜å‚¨ç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸º <code>/var/lib/docker</code> ï¼Œä¸‹é¢å°±æ¢å¯»ä¸€ä¸‹é•œåƒæ˜¯ä»¥ä»€ä¹ˆæ ·çš„ç›®å½•ç»“æ„å­˜æ”¾çš„ã€‚åœ¨å¼€å§‹ hack ä¹‹å‰æˆ‘ä»¬å…ˆç»Ÿä¸€ä¸€ä¸‹ç¯å¢ƒä¿¡æ¯ï¼Œæˆ‘ä½¿ç”¨çš„æœºå™¨æ˜¯ Ubuntu 1804ï¼Œ<code>docker info</code> ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">â•­â”€root@sg-02</span> <span class="string">/var/lib/docker</span></span><br><span class="line"><span class="string">â•°â”€#</span> <span class="string">docker</span> <span class="string">info</span></span><br><span class="line"><span class="attr">Client:</span></span><br><span class="line"> <span class="attr">Debug Mode:</span> <span class="literal">false</span></span><br><span class="line"> <span class="attr">Plugins:</span></span><br><span class="line">  <span class="attr">buildx:</span> <span class="string">Build</span> <span class="string">with</span> <span class="string">BuildKit</span> <span class="string">(Docker</span> <span class="string">Inc.,</span> <span class="string">v0.3.1-tp-docker)</span></span><br><span class="line">  <span class="attr">app:</span> <span class="string">Docker</span> <span class="string">Application</span> <span class="string">(Docker</span> <span class="string">Inc.,</span> <span class="string">v0.8.0)</span></span><br><span class="line"><span class="attr">Server:</span></span><br><span class="line"> <span class="attr">Containers:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Running:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Paused:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Stopped:</span> <span class="number">0</span></span><br><span class="line"> <span class="attr">Images:</span> <span class="number">2</span></span><br><span class="line"> <span class="attr">Server Version:</span> <span class="number">19.03</span><span class="number">.5</span></span><br><span class="line"> <span class="attr">Storage Driver:</span> <span class="string">overlay2</span></span><br><span class="line">  <span class="attr">Backing Filesystem:</span> <span class="string">extfs</span></span><br><span class="line">  <span class="attr">Supports d_type:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">Native Overlay Diff:</span> <span class="literal">true</span></span><br><span class="line"> <span class="attr">Logging Driver:</span> <span class="string">json-file</span></span><br><span class="line"> <span class="attr">Cgroup Driver:</span> <span class="string">cgroupfs</span></span><br><span class="line"> <span class="attr">Plugins:</span></span><br><span class="line">  <span class="attr">Volume:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">Network:</span> <span class="string">bridge</span> <span class="string">host</span> <span class="string">ipvlan</span> <span class="string">macvlan</span> <span class="literal">null</span> <span class="string">overlay</span></span><br><span class="line">  <span class="attr">Log:</span> <span class="string">awslogs</span> <span class="string">fluentd</span> <span class="string">gcplogs</span> <span class="string">gelf</span> <span class="string">journald</span> <span class="string">json-file</span> <span class="string">local</span> <span class="string">logentries</span> <span class="string">splunk</span> <span class="string">syslog</span></span><br><span class="line"> <span class="attr">Swarm:</span> <span class="string">inactive</span></span><br><span class="line"> <span class="attr">Runtimes:</span> <span class="string">runc</span></span><br><span class="line"> <span class="attr">Default Runtime:</span> <span class="string">runc</span></span><br><span class="line"> <span class="attr">Init Binary:</span> <span class="string">docker-init</span></span><br><span class="line"> <span class="attr">containerd version:</span> <span class="string">b34a5c8af56e510852c35414db4c1f4fa6172339</span></span><br><span class="line"> <span class="attr">runc version:</span> <span class="string">3e425f80a8c931f88e6d94a8c831b9d5aa481657</span></span><br><span class="line"> <span class="attr">init version:</span> <span class="string">fec3683</span></span><br><span class="line"> <span class="attr">Security Options:</span></span><br><span class="line">  <span class="string">apparmor</span></span><br><span class="line">  <span class="string">seccomp</span></span><br><span class="line">   <span class="attr">Profile:</span> <span class="string">default</span></span><br><span class="line"> <span class="attr">Kernel Version:</span> <span class="number">4.15</span><span class="number">.0</span><span class="number">-1052</span><span class="string">-aws</span></span><br><span class="line"> <span class="attr">Operating System:</span> <span class="string">Ubuntu</span> <span class="number">18.04</span><span class="number">.1</span> <span class="string">LTS</span></span><br><span class="line"> <span class="attr">OSType:</span> <span class="string">linux</span></span><br><span class="line"> <span class="attr">Architecture:</span> <span class="string">x86_64</span></span><br><span class="line"> <span class="attr">CPUs:</span> <span class="number">1</span></span><br><span class="line"> <span class="attr">Total Memory:</span> <span class="number">983.</span><span class="string">9MiB</span></span><br><span class="line"> <span class="attr">Name:</span> <span class="string">sg-02</span></span><br><span class="line"> <span class="attr">ID:</span> <span class="string">B7J5:Y7ZM:Y477:7AS6:WMYI:6NLV:YOMA:W32Y:H4NZ:UQVD:XHDX:Y5EF</span></span><br><span class="line"> <span class="attr">Docker Root Dir:</span> <span class="string">/opt/docker</span></span><br><span class="line"> <span class="attr">Debug Mode:</span> <span class="literal">false</span></span><br><span class="line"> <span class="attr">Username:</span> <span class="string">webpsh</span></span><br><span class="line"> <span class="attr">Registry:</span> <span class="string">https://index.docker.io/v1/</span></span><br><span class="line"> <span class="attr">Labels:</span></span><br><span class="line"> <span class="attr">Experimental:</span> <span class="literal">false</span></span><br><span class="line"> <span class="attr">Insecure Registries:</span></span><br><span class="line">  <span class="number">127.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/8</span></span><br><span class="line"> <span class="attr">Registry Mirrors:</span></span><br><span class="line">  <span class="string">https://registry.k8s.li/</span></span><br><span class="line"> <span class="attr">Live Restore Enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿åˆ†æï¼Œæˆ‘å°†å…¶ä»–çš„ docker image å…¨éƒ¨æ¸…ç©ºæ‰ï¼Œåªä¿ç•™ <code>debian:v1</code> å’Œ <code>debian:v2</code> è¿™ä¸¤ä¸ªé•œåƒï¼Œè¿™ä¸¤ä¸ªé•œåƒè¶³å¤Ÿå¸®åŠ©æˆ‘ä»¬ç†è§£å®¹å™¨é•œåƒæ˜¯å¦‚ä½•å­˜æ”¾çš„ï¼Œé•œåƒå¤šäº†å¤šè¯åˆ†æä¸‹é¢å­˜å‚¨ç›®å½•çš„æ—¶å€™å¯èƒ½ä¸å¤ªæ–¹ä¾¿ï¼ˆï¼ï¹ï¼œï¼‰ï¼Œè¿™ä¸¤ä¸ªé•œåƒæ˜¯æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨ Debian çš„ <code>rootfs.tar.xz</code> æ„å»ºå‡ºæ¥çš„åŸºç¡€é•œåƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/docker</span><br><span class="line">â•°â”€# docker images</span><br><span class="line">REPOSITORY       TAG         IMAGE ID            CREATED             SIZE</span><br><span class="line">debian           v2          e6e782a57a51        22 hours ago        69.2MB</span><br><span class="line">debian           v1          cfba37fd24f8        22 hours ago        69.2MB</span><br></pre></td></tr></table></figure><h3 id="docker-var-lib-docker"><a href="#docker-var-lib-docker" class="headerlink" title="docker (/var/lib/docker)"></a>docker (/var/lib/docker)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/docker</span><br><span class="line">â•°â”€# tree -d -L 1</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ builder</span><br><span class="line">â”œâ”€â”€ buildkit</span><br><span class="line">â”œâ”€â”€ containers</span><br><span class="line">â”œâ”€â”€ image</span><br><span class="line">â”œâ”€â”€ network</span><br><span class="line">â”œâ”€â”€ overlay2</span><br><span class="line">â”œâ”€â”€ plugins</span><br><span class="line">â”œâ”€â”€ runtimes</span><br><span class="line">â”œâ”€â”€ swarm</span><br><span class="line">â”œâ”€â”€ tmp</span><br><span class="line">â”œâ”€â”€ trust</span><br><span class="line">â””â”€â”€ volumes</span><br><span class="line"></span><br><span class="line">12 directories</span><br></pre></td></tr></table></figure><p>æ ¹æ®ç›®å½•çš„åå­—æˆ‘ä»¬å¯ä»¥å¤§è‡´æ¨æ–­å‡ºå…³äºå®¹å™¨é•œåƒçš„å­˜å‚¨ï¼Œæˆ‘ä»¬åªå…³å¿ƒ image å’Œ overlay2 è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹å³å¯ï¼Œå®¹å™¨çš„å…ƒæ•°æ®å­˜æ”¾åœ¨ image ç›®å½•ä¸‹ï¼Œå®¹å™¨çš„ layer æ•°æ®åˆ™å­˜æ”¾åœ¨ overlay2 ç›®å½•ä¸‹ã€‚</p><h3 id="var-lib-docker-image"><a href="#var-lib-docker-image" class="headerlink" title="/var/lib/docker/image"></a>/var/lib/docker/image</h3><p>overlay2 ä»£è¡¨ç€æœ¬åœ° docker å­˜å‚¨ä½¿ç”¨çš„æ˜¯ overlay2 è¯¥å­˜å‚¨é©±åŠ¨ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬çš„ docker é»˜è®¤ä¼˜å…ˆé‡‡ç”¨ <strong>overlay2</strong> ä½œä¸ºå­˜å‚¨é©±åŠ¨ï¼Œå¯¹äºå·²æ”¯æŒè¯¥é©±åŠ¨çš„ Linux å‘è¡Œç‰ˆï¼Œä¸éœ€è¦ä»»ä½•è¿›è¡Œä»»ä½•é¢å¤–çš„é…ç½®ï¼Œå¯ä½¿ç”¨ lsmod å‘½ä»¤æŸ¥çœ‹å½“å‰ç³»ç»Ÿå†…æ ¸æ˜¯å¦æ”¯æŒ overlay2 ã€‚</p><p>å¦å¤–å€¼å¾—ä¸€æçš„æ˜¯<code>devicemapper</code> å­˜å‚¨é©±åŠ¨å·²ç»åœ¨ docker 18.09 ç‰ˆæœ¬ä¸­è¢«åºŸå¼ƒï¼Œdocker å®˜æ–¹æ¨èä½¿ç”¨ <code>overlay2</code> æ›¿ä»£<code>devicemapper</code>ã€‚ï¼ˆä¹‹å‰æˆ‘è€ä¸œå®¶ç”¨çš„ docker 1.13 ç‰ˆæœ¬ï¼Œ<code>devicemapper</code>çš„å­˜å‚¨é©±åŠ¨åœ¨ç”Ÿäº§ç¯å¢ƒç¿»è¿‡è½¦ğŸ˜‚ã€‚æ‰€ä»¥å‘¢ï¼Œéƒ½ 2020 å¹´äº†ï¼Œå½“ä½ ä½¿ç”¨ baidu è¿™ç§åƒåœ¾æœç´ å¼•æ“å»æœç´¢ â€œCentOS å®‰è£… dockerâ€ æ—¶å®ƒä¼šç»™ä½ ä¸€å †åƒåœ¾çš„æ•™ç¨‹ï¼Œå«ä½ å»å®‰è£… <code>device-mapper-persistent-data lvm2</code>ï¼Œå¯¹äºè¿™ç§æŠ„æ¥æŠ„å»çš„åšå®¢å¹³å°ï¼Œç¦»å¾—è¶Šè¿œè¶Šå¥½ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">image</span><br><span class="line">â””â”€â”€ overlay2</span><br><span class="line">    â”œâ”€â”€ distribution</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ diffid-by-digest</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 039b991354af4dcbc534338f687e27643c717bb57e11b87c2e81d50bdd0b2376</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 09a4142c5c9dde2fbf35e7a6e6475eba75a8c28540c375c80be7eade4b7cb438</span><br><span class="line">    â”‚Â Â  â””â”€â”€ v2metadata-by-diffid</span><br><span class="line">    â”‚Â Â      â””â”€â”€ sha256</span><br><span class="line">    â”‚Â Â          â”œâ”€â”€ 0683de2821778aa9546bf3d3e6944df779daba1582631b7ea3517bb36f9e4007</span><br><span class="line">    â”‚Â Â          â”œâ”€â”€ 0f7493e3a35bab1679e587b41b353b041dca1e7043be230670969703f28a1d83</span><br><span class="line">    â”œâ”€â”€ imagedb</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ content</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 708bc6af7e5e539bdb59707bbf1053cc2166622f5e1b17666f0ba5829ca6aaea</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â””â”€â”€ f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span><br><span class="line">    â”‚Â Â  â””â”€â”€ metadata</span><br><span class="line">    â”‚Â Â      â””â”€â”€ sha256</span><br><span class="line">    â”œâ”€â”€ layerdb</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ mounts</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ sha256</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ b9835d6a62886d4e85b65abb120c0ea44ff1b3d116d7a707620785d4664d8c1a</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ cache-id</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ parent</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ size</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ tar-split.json.gz</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â””â”€â”€ d9b567b77bcdb9d8944d3654ea9bb5f6f4f7c4d07a264b2e40b1bb09af171dd3</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ cache-id</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ diff</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ parent</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ size</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â””â”€â”€ tar-split.json.gz</span><br><span class="line">    â”‚Â Â  â””â”€â”€ tmp</span><br><span class="line">    â””â”€â”€ repositories.json</span><br><span class="line">21 directories, 119 files</span><br></pre></td></tr></table></figure><ul><li><code>repositories.json</code></li></ul><p>repositories.json å°±æ˜¯å­˜å‚¨é•œåƒå…ƒæ•°æ®ä¿¡æ¯ï¼Œä¸»è¦æ˜¯ image name å’Œ image id çš„å¯¹åº”ï¼Œdigest å’Œ image id çš„å¯¹åº”ã€‚å½“ pull å®Œä¸€ä¸ªé•œåƒçš„æ—¶å€™ docker ä¼šæ›´æ–°è¿™ä¸ªæ–‡ä»¶ã€‚å½“æˆ‘ä»¬ docker run ä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ä¹Ÿç”¨åˆ°è¿™ä¸ªæ–‡ä»¶å»ç´¢å¼•æœ¬åœ°æ˜¯å¦å­˜åœ¨è¯¥é•œåƒï¼Œæ²¡æœ‰é•œåƒçš„è¯å°±è‡ªåŠ¨å» pull è¿™ä¸ªé•œåƒã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/docker/image/overlay2</span><br><span class="line">â•°â”€# jq "." repositories.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"Repositories"</span>: &#123;</span><br><span class="line">    <span class="attr">"debian"</span>: &#123;</span><br><span class="line">      <span class="attr">"debian:v1"</span>: <span class="string">"sha256:cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d"</span>,</span><br><span class="line">      <span class="attr">"debian:v2"</span>: <span class="string">"sha256:e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"localhost:5000/library/debian"</span>: &#123;</span><br><span class="line">      <span class="attr">"localhost:5000/library/debian:v1"</span>: <span class="string">"sha256:cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d"</span>,</span><br><span class="line">      <span class="attr">"localhost:5000/library/debian:v2"</span>: <span class="string">"sha256:e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df"</span>,</span><br><span class="line">      <span class="attr">"localhost:5000/library/debian@sha256:b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239"</span>: <span class="string">"sha256:cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d"</span>,</span><br><span class="line">      <span class="attr">"localhost:5000/library/debian@sha256:c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11"</span>: <span class="string">"sha256:e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"registry"</span>: &#123;</span><br><span class="line">      <span class="attr">"registry:latest"</span>: <span class="string">"sha256:708bc6af7e5e539bdb59707bbf1053cc2166622f5e1b17666f0ba5829ca6aaea"</span>,</span><br><span class="line">      <span class="attr">"registry@sha256:7d081088e4bfd632a88e3f3bcd9e007ef44a796fddfe3261407a3f9f04abe1e7"</span>: <span class="string">"sha256:708bc6af7e5e539bdb59707bbf1053cc2166622f5e1b17666f0ba5829ca6aaea"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>distribution ç›®å½•ä¸‹</li></ul><p>å­˜æ”¾ç€ layer çš„ diff_id å’Œ digest çš„å¯¹åº”å…³ç³»</p><p>diffid-by-digest :å­˜æ”¾ <code>digest</code> åˆ° <code>diffid</code> çš„å¯¹åº”å…³ç³»</p><p>v2metadata-by-diffid : å­˜æ”¾ <code>diffid</code> åˆ° <code>digest</code> çš„å¯¹åº”å…³ç³»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ distribution</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diffid-by-digest</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 039b991354af4dcbc534338f687e27643c717bb57e11b87c2e81d50bdd0b2376</span><br><span class="line">â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 09a4142c5c9dde2fbf35e7a6e6475eba75a8c28540c375c80be7eade4b7cb438</span><br><span class="line">â”‚Â Â  â””â”€â”€ v2metadata-by-diffid</span><br><span class="line">â”‚Â Â      â””â”€â”€ sha256</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ 0683de2821778aa9546bf3d3e6944df779daba1582631b7ea3517bb36f9e4007</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ 0f7493e3a35bab1679e587b41b353b041dca1e7043be230670969703f28a1d83</span><br></pre></td></tr></table></figure><ul><li>imagedb</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ imagedb</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ content</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 708bc6af7e5e539bdb59707bbf1053cc2166622f5e1b17666f0ba5829ca6aaea</span><br><span class="line">â”‚Â Â  â”‚Â Â      â””â”€â”€ f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span><br><span class="line">â”‚Â Â  â””â”€â”€ metadata</span><br><span class="line">â”‚Â Â      â””â”€â”€ sha256</span><br></pre></td></tr></table></figure><ul><li>layerdb</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ layerdb</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ mounts</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ sha256</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ b9835d6a62886d4e85b65abb120c0ea44ff1b3d116d7a707620785d4664d8c1a</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ cache-id  # docker ä¸‹è½½é•œåƒæ—¶éšæœºç”Ÿæˆçš„ id</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ diff # å­˜æ”¾ layer çš„ diffid</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ parent # æ”¾å½“å‰ layer çš„çˆ¶ layer çš„ diffidï¼Œæœ€åº•å±‚çš„ layer æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ size # è¯¥ layer çš„å¤§å°</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ tar-split.json.gz</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼štar-split.json.gz æ–‡ä»¶æ˜¯ layer tar åŒ…çš„ split æ–‡ä»¶ï¼Œè®°å½•äº† layer è§£å‹åçš„æ–‡ä»¶åœ¨ tar åŒ…ä¸­çš„ä½ç½®ï¼ˆåç§»é‡ï¼‰ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶å¯ä»¥è¿˜åŸ layer çš„ tar åŒ…ï¼Œåœ¨ docker save å¯¼å‡º image çš„æ—¶å€™ä¼šç”¨åˆ°ï¼Œç”±æ ¹æ®å®ƒå¯ä»¥å¼€å€’è½¦æŠŠè§£å‹çš„ layer è¿˜åŸå› tar åŒ…ã€‚è¯¦æƒ…å¯å‚è€ƒ <a href="https://github.com/vbatts/tar-split" target="_blank" rel="noopener">tar-split</a></p><h3 id="var-lib-docker-overlay2"><a href="#var-lib-docker-overlay2" class="headerlink" title="/var/lib/docker/overlay2"></a>/var/lib/docker/overlay2</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">overlay2</span><br><span class="line">â”œâ”€â”€ 259cf6934509a674b1158f0a6c90c60c133fd11189f98945c7c3a524784509ff</span><br><span class="line">â”‚Â Â  â””â”€â”€ diff</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ bin</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ dev</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ etc</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ home</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ media</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ mnt</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ opt</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ proc</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ root</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ run</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ sbin</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ srv</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ sys</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ tmp</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ usr</span><br><span class="line">â”‚Â Â      â””â”€â”€ var</span><br><span class="line">â”œâ”€â”€ 27f9e9b74a88a269121b4e77330a665d6cca4719cb9a58bfc96a2b88a07af805</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”œâ”€â”€ a0df3cc902cfbdee180e8bfa399d946f9022529d12dba3bc0b13fb7534120015</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ bin</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”œâ”€â”€ b2fbebb39522cb6f1f5ecbc22b7bec5e9bc6ecc25ac942d9e26f8f94a028baec</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ etc</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ usr</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ var</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”œâ”€â”€ be8c12f63bebacb3d7d78a09990dce2a5837d86643f674a8fd80e187d8877db9</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ etc</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”œâ”€â”€ e8f6e78aa1afeb96039c56f652bb6cd4bbd3daad172324c2172bad9b6c0a968d</span><br><span class="line">â”‚Â Â  â””â”€â”€ diff</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ bin</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ dev</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ etc</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ home</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ media</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ mnt</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ proc</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ root</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ run</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ sbin</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ srv</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ sys</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ tmp</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ usr</span><br><span class="line">â”‚Â Â      â””â”€â”€ var</span><br><span class="line">â””â”€â”€ l</span><br><span class="line">    â”œâ”€â”€ 526XCHXRJMZXRIHN4YWJH2QLPY -&gt; ../b2fbebb39522cb6f1f5ecbc22b7bec5e9bc6ecc25ac942d9e26f8f94a028baec/diff</span><br><span class="line">    â”œâ”€â”€ 5RZOXYR35NSGAWTI36CVUIRW7U -&gt; ../be8c12f63bebacb3d7d78a09990dce2a5837d86643f674a8fd80e187d8877db9/diff</span><br><span class="line">    â”œâ”€â”€ LBWRL4ZXGBWOTN5JDCDZVNOY7H -&gt; ../a0df3cc902cfbdee180e8bfa399d946f9022529d12dba3bc0b13fb7534120015/diff</span><br><span class="line">    â”œâ”€â”€ MYRYBGZRI4I76MJWQHN7VLZXLW -&gt; ../27f9e9b74a88a269121b4e77330a665d6cca4719cb9a58bfc96a2b88a07af805/diff</span><br><span class="line">    â”œâ”€â”€ PCIS4FYUJP4X2D4RWB7ETFL6K2 -&gt; ../259cf6934509a674b1158f0a6c90c60c133fd11189f98945c7c3a524784509ff/diff</span><br><span class="line">    â””â”€â”€ XK5IA4BWQ2CIS667J3SXPXGQK5 -&gt; ../e8f6e78aa1afeb96039c56f652bb6cd4bbd3daad172324c2172bad9b6c0a968d/diff</span><br></pre></td></tr></table></figure><p>åœ¨ <code>/var/lib/docker/overlay2</code> ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé•œåƒ layer çš„å†…å®¹éƒ½å­˜æ”¾åœ¨ä¸€ä¸ª <code>diff</code> çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œdiff çš„ä¸Šçº§ç›®å½•å°±æ˜¯ä»¥é•œåƒ layer çš„ digest ä¸ºåçš„ç›®å½•ã€‚å…¶ä¸­è¿˜æœ‰ä¸ª <code>l</code> æ–‡ä»¶å¤¹ï¼Œä¸‹é¢æœ‰ä¸€å¨å¨çš„ç¡¬é“¾æ¥æ–‡ä»¶æŒ‡å‘ä¸Šçº§ç›®å½•çš„ layer ç›®å½•ã€‚è¿™ä¸ª l å…¶å®å°±æ˜¯ link çš„ç¼©å†™ï¼Œl ä¸‹çš„æ–‡ä»¶éƒ½æ˜¯ä¸€äº›æ¯” digest æ–‡ä»¶å¤¹åçŸ­ä¸€äº›çš„ï¼Œæ–¹é¢ä¸è‡³äº mount çš„å‚æ•°è¿‡é•¿ã€‚</p><h2 id="é•œåƒæ˜¯æ€ä¹ˆæ¬è¿çš„ğŸ¤£"><a href="#é•œåƒæ˜¯æ€ä¹ˆæ¬è¿çš„ğŸ¤£" class="headerlink" title="é•œåƒæ˜¯æ€ä¹ˆæ¬è¿çš„ğŸ¤£"></a>é•œåƒæ˜¯æ€ä¹ˆæ¬è¿çš„ğŸ¤£</h2><p>å½“æˆ‘ä»¬åœ¨æœ¬åœ°æ„å»ºå®Œæˆä¸€ä¸ªé•œåƒä¹‹åï¼Œå¦‚ä½•ä¼ é€’ç»™ä»–äººå‘¢ï¼Ÿè¿™å°±æ¶‰åŠåˆ°é•œåƒæ˜¯æ€ä¹ˆæ¬è¿çš„ä¸€äº›çŸ¥è¯†ï¼Œæ¬è¿é•œåƒå°±åƒæˆ‘ä»¬åœ¨ GitHub ä¸Šæ¬è¿ä»£ç ä¸€æ ·ï¼Œdocker ä¹Ÿæœ‰ç±»ä¼¼äº git clone å’Œ git push çš„æ¬è¿æ–¹å¼ã€‚docker push å°±å’Œæˆ‘ä»¬ä½¿ç”¨ git push ä¸€æ ·ï¼Œå°†æœ¬åœ°çš„é•œåƒæ¨é€åˆ°ä¸€ä¸ªç§°ä¹‹ä¸º registry çš„é•œåƒä»“åº“ï¼Œè¿™ä¸ª registry é•œåƒä»“åº“å°±åƒ GitHub ç”¨æ¥å­˜æ”¾å…¬å…±/ç§æœ‰çš„é•œåƒï¼Œä¸€ä¸ªä¸­å¿ƒåŒ–çš„é•œåƒä»“åº“æ–¹ä¾¿å¤§å®¶æ¥è¿›è¡Œäº¤æµå’Œæ¬è¿é•œåƒã€‚docker pull å°±åƒæˆ‘ä»¬ä½¿ç”¨ git pull ä¸€æ ·ï¼Œå°†è¿œç¨‹çš„é•œåƒæ‹‰æ‹‰å–æœ¬åœ°ã€‚</p><h3 id="docker-pull"><a href="#docker-pull" class="headerlink" title="docker pull"></a>docker pull</h3><p>ç†è§£ docker pull ä¸€ä¸ªé•œåƒçš„æµç¨‹æœ€å¥½çš„åŠæ³•æ˜¯æŸ¥çœ‹ OCI registry è§„èŒƒä¸­çš„è¿™æ®µæ–‡æ¡£ <a href="https://github.com/opencontainers/distribution-spec/blob/master/spec.md#pulling-an-image" target="_blank" rel="noopener">pulling-an-image</a> ï¼Œåœ¨è¿™é‡Œæˆ‘ç»“åˆå¤§ä½¬çš„åšå®¢ç®€å•æ¢³ç†ä¸€ä¸‹ pull ä¸€ä¸ªé•œåƒçš„å¤§è‡´æµç¨‹ã€‚ä¸‹é¢è¿™å¼ å›¾æ˜¯ä» <a href="https://github.com/helios741/myblog/blob/new/learn_go/src/2019/20191206_docker_disk_storage/README.md" target="_blank" rel="noopener">æµ…è°ˆdockerä¸­é•œåƒå’Œå®¹å™¨åœ¨æœ¬åœ°çš„å­˜å‚¨)</a> å€Ÿæ¥çš„ğŸ˜‚</p><p><img src="https://user-images.githubusercontent.com/12036324/70367494-646d2380-18db-11ea-992a-d2bca4cbfeb0.png" alt="image"></p><p>docker pull å°±å’Œæˆ‘ä»¬ä½¿ç”¨ git clone ä¸€æ ·æ•ˆæœï¼Œå°†è¿œç¨‹çš„é•œåƒä»“åº“æ‹‰å–åˆ°æœ¬åœ°æ¥ç»™å®¹å™¨è¿è¡Œæ—¶ä½¿ç”¨ï¼Œç»“åˆä¸Šå›¾å¤§è‡´çš„æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ä¸€æ­¥åº”è¯¥æ˜¯ä½¿ç”¨<code>~/.docker/config.json</code> ä¸­çš„ auth è®¤è¯ä¿¡æ¯åœ¨ registry é‚£é‡Œè¿›è¡Œé‰´æƒæˆæƒï¼Œæ‹¿åˆ°ä¸€ä¸ª tokenï¼Œåé¢çš„æ‰€æœ‰çš„ HTTP è¯·æ±‚ä¸­éƒ½è¦åŒ…å«ç€è¯¥ token æ‰èƒ½æœ‰æƒé™è¿›è¡Œæ“ä½œã€‚</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# cat ~/.docker/config.json</span><br><span class="line">&#123;</span><br><span class="line">        <span class="attr">"auths"</span>: &#123;</span><br><span class="line">                <span class="attr">"https://registry.k8s.li/v2/"</span>: &#123;</span><br><span class="line">                        <span class="attr">"auth"</span>: <span class="string">"d2VicH855828WM7bSVsslJFpmQE43Sw=="</span></span><br><span class="line">                &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"HttpHeaders"</span>: &#123;</span><br><span class="line">                <span class="attr">"User-Agent"</span>: <span class="string">"Docker-Client/19.03.5 (linux)"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"experimental"</span>: <span class="string">"enabled"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>dockerd å®ˆæŠ¤è¿›ç¨‹è§£æ docker å®¢æˆ·ç«¯å‚æ•°ï¼Œç”±é•œåƒå + tag å‘ registry è¯·æ±‚ Manifest æ–‡ä»¶ï¼ŒHTTP è¯·æ±‚ä¸º<code>GET /v2/&lt;name&gt;/manifests/&lt;reference&gt;</code>ã€‚registry ä¸­ä¸€ä¸ªé•œåƒæœ‰å¤šä¸ª tag æˆ–è€…å¤šä¸ªå¤„ç†å™¨ä½“ç³»æ¶æ„çš„é•œåƒï¼Œåˆ™æ ¹æ®è¿™ä¸ª tag æ¥è¿”å›ç»™å®¢æˆ·ç«¯ä¸ä¹‹å¯¹åº”çš„  manifest æ–‡ä»¶ï¼›</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET /v2/&lt;name&gt;/manifests/&lt;reference&gt;</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"annotations"</span>: &#123;</span><br><span class="line">      <span class="attr">"com.example.key1"</span>: <span class="string">"value1"</span>,</span><br><span class="line">      <span class="attr">"com.example.key2"</span>: <span class="string">"value2"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:6f4e69a5ff18d92e7315e3ee31c62165ebf25bfa05cad05c0d09d8f412dae401"</span>,</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.oci.image.config.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">452</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:6f4e69a5ff18d92e7315e3ee31c62165ebf25bfa05cad05c0d09d8f412dae401"</span>,</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.oci.image.layer.v1.tar+gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">78343</span></span><br><span class="line">      &#125;</span><br><span class="line">   ],</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>dockerd å¾—åˆ° <code>manifest</code> åï¼Œè¯»å–é‡Œé¢ image config æ–‡ä»¶çš„ <code>digest</code>ï¼Œè¿™ä¸ª sha256 å€¼å°±æ˜¯ image çš„ <code>ID</code></li><li>æ ¹æ® <code>ID</code> åœ¨æœ¬åœ°çš„ <code>repositories.json</code>ä¸­æŸ¥æ‰¾æ‰¾æœ‰æ²¡æœ‰å­˜åœ¨åŒæ · <code>ID</code> çš„ imageï¼Œæœ‰çš„è¯å°±ä¸ç”¨ä¸‹è½½äº†</li><li>å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆä¼šç»™ registry æœåŠ¡å™¨å‘è¯·æ±‚æ‹¿åˆ°  image config æ–‡ä»¶</li><li>æ ¹æ® image config æ–‡ä»¶ä¸­çš„ <code>diff_ids</code>åœ¨æœ¬åœ°æ‰¾å¯¹åº”çš„ layer æ˜¯å¦å­˜åœ¨</li><li>å¦‚æœ layer ä¸å­˜åœ¨ï¼Œåˆ™æ ¹æ® <code>manifest</code> é‡Œé¢ layer çš„ <code>sha256</code> å’Œ <code>media type</code> å»æœåŠ¡å™¨æ‹¿ç›¸åº”çš„ layerï¼ˆç›¸å½“å»æ‹¿å‹ç¼©æ ¼å¼çš„åŒ…ï¼‰</li><li>dockerd å®ˆæŠ¤è¿›ç¨‹å¹¶è¡Œä¸‹è½½å„ layer ï¼ŒHTTP è¯·æ±‚ä¸º<code>GET /v2/&lt;name&gt;/blobs/&lt;digest&gt;</code>ã€‚ </li><li>æ‹¿åˆ°åè¿›è¡Œè§£å‹ï¼Œå¹¶æ£€æŸ¥è§£å‹(gzip -d)å tar åŒ…çš„ sha256 æ˜¯å¦å’Œ image config ä¸­çš„ <code>diff_id</code> ç›¸åŒï¼Œä¸ç›¸åŒå°±ç¿»è½¦äº†</li><li>ç­‰æ‰€æœ‰çš„ layer éƒ½ä¸‹è½½å®Œæˆåï¼Œæ•´ä¸ª image çš„ layer å°±ä¸‹è½½å®Œæˆï¼Œæ¥ç€å¼€å§‹è¿›è¡Œè§£å‹(tar -xf) layer çš„ tar åŒ…ã€‚</li><li>dockerd èµ·ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ <code>docker-untar</code> æ¥ gzip è§£å‹ç¼©å·²ç»ä¸‹è½½å®Œæˆçš„ layer æ–‡ä»¶ï¼›å¯¹äºæœ‰äº›æ¯”è¾ƒå¤§çš„é•œåƒï¼ˆæ¯”å¦‚å‡ å GB çš„é•œåƒï¼‰ï¼Œå¾€å¾€é•œåƒçš„ layer å·²ç»ä¸‹è½½å®Œæˆäº†ï¼Œä½†è¿˜æ²¡æœ‰è§£å‹å®ŒğŸ˜‚ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-untar /var/lib/docker/overlay2/a076db6567c7306f3cdab6040cd7d083ef6a39d125171353eedbb8bde7f203b4/diff</span><br></pre></td></tr></table></figure><ul><li>éªŒè¯ image config ä¸­çš„ RootFS.DiffIDs æ˜¯å¦ä¸ä¸‹è½½ï¼ˆè§£å‹åï¼‰hash ç›¸åŒï¼›</li></ul><h3 id="docker-push"><a href="#docker-push" class="headerlink" title="docker push"></a>docker push</h3><p>push æ¨é€ä¸€ä¸ªé•œåƒåˆ°è¿œç¨‹çš„ registry æµç¨‹æ°å¥½å’Œ pull æ‹‰å–é•œåƒåˆ°æœ¬åœ°çš„æµç¨‹ç›¸åã€‚æˆ‘ä»¬ pull ä¸€ä¸ªé•œåƒçš„æ—¶å€™å¾€å¾€éœ€è¦å…ˆè·å–åŒ…å«ç€é•œåƒ layer ä¿¡æ¯çš„ Manifest æ–‡ä»¶ï¼Œç„¶åæ ¹æ®è¿™ä¸ªæ–‡ä»¶ä¸­çš„ layer ä¿¡æ¯å– pull ç›¸åº”çš„ layerã€‚push ä¸€ä¸ªé•œåƒï¼Œéœ€è¦å…ˆå°†é•œåƒçš„å„ä¸ª layer æ¨é€åˆ° registry ï¼Œå½“æ‰€æœ‰çš„é•œåƒ layer ä¸Šä¼ å®Œæ¯•ä¹‹åæœ€åå† push Image Manifest åˆ° registryã€‚å¤§ä½“çš„æµç¨‹å¦‚ä¸‹ï¼š</p><blockquote><p>  All layer uploads use two steps to manage the upload process. The first step starts the upload in the registry service, returning a url to carry out the second step. The second step uses the upload url to transfer the actual data. Uploads are started with a POST request which returns a url that can be used to push data and check upload status.</p></blockquote><ul><li><p>ç¬¬ä¸€æ­¥å’Œ pull ä¸€ä¸ªé•œåƒä¸€æ ·ä¹Ÿæ˜¯è¿›è¡Œé‰´æƒæˆæƒï¼Œæ‹¿åˆ°ä¸€ä¸ª tokenï¼›</p></li><li><p>å‘ registry å‘é€ <code>POST /v2/&lt;name&gt;/blobs/uploads/</code>è¯·æ±‚ï¼Œregistry è¿”å›ä¸€ä¸ªä¸Šä¼ é•œåƒ layer æ—¶è¦åº”åˆ°çš„ URLï¼›</p></li><li><p>å®¢æˆ·ç«¯é€šè¿‡ <code>HEAD /v2/&lt;name&gt;/blobs/&lt;digest&gt;</code> è¯·æ±‚æ£€æŸ¥ registry ä¸­æ˜¯å¦å·²ç»å­˜åœ¨é•œåƒçš„ layerã€‚</p></li><li><p>å®¢æˆ·ç«¯é€šè¿‡URL ä½¿ç”¨ POST æ–¹æ³•æ¥å®æ—¶ä¸Šä¼  layer æ•°æ®ï¼Œä¸Šä¼ é•œåƒ layer åˆ†ä¸º <code>Monolithic Upload</code> ï¼ˆæ•´ä½“ä¸Šä¼ ï¼‰å’Œ<code>Chunked Upload</code>ï¼ˆåˆ†å—ä¸Šä¼ ï¼‰ä¸¤ç§æ–¹å¼ã€‚</p><ul><li>Monolithic Upload </li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PUT /v2/&lt;name&gt;/blobs/uploads/&lt;session_id&gt;?digest=&lt;digest&gt;</span><br><span class="line"><span class="attribute">Content-Length</span>: &lt;size of layer&gt;</span><br><span class="line"><span class="attribute">Content-Type</span>: application/octet-stream</span><br><span class="line"></span><br><span class="line">&lt;Layer Binary Data&gt;</span><br></pre></td></tr></table></figure><ul><li>Chunked Upload</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PATCH /v2/&lt;name&gt;/blobs/uploads/&lt;session_id&gt;</span><br><span class="line"><span class="attribute">Content-Length</span>: &lt;size of chunk&gt;</span><br><span class="line"><span class="attribute">Content-Range</span>: &lt;start of range&gt;-&lt;end of range&gt;</span><br><span class="line"><span class="attribute">Content-Type</span>: application/octet-stream</span><br><span class="line"></span><br><span class="line">&lt;Layer Chunk Binary Data&gt;</span><br></pre></td></tr></table></figure></li><li><p>é•œåƒçš„ layer ä¸Šä¼ å®Œæˆä¹‹åï¼Œå®¢æˆ·ç«¯éœ€è¦å‘ registry å‘é€ä¸€ä¸ª PUT HTTP è¯·æ±‚å‘ŠçŸ¥è¯¥ layer å·²ç»ä¸Šä¼ å®Œæ¯•ã€‚</p></li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT /v2/&lt;name&gt;/blobs/uploads/&lt;session_id&gt;?digest=&lt;digest&gt;</span><br><span class="line"><span class="attribute">Content-Length</span>: &lt;size of chunk&gt;</span><br><span class="line"><span class="attribute">Content-Range</span>: &lt;start of range&gt;-&lt;end of range&gt;</span><br><span class="line"><span class="attribute">Content-Type</span>: application/octet-stream</span><br><span class="line"></span><br><span class="line">&lt;Last Layer Chunk Binary Data&gt;</span><br></pre></td></tr></table></figure><ul><li>æœ€åå½“æ‰€æœ‰çš„ layer ä¸Šä¼ å®Œä¹‹åï¼Œå®¢æˆ·ç«¯å†å°† manifest æ¨é€ä¸Šå»å°±å®Œäº‹å„¿äº†ã€‚</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">PUT /v2/&lt;name&gt;/manifests/&lt;reference&gt;</span><br><span class="line">Content-Type: &lt;manifest media type&gt;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"annotations"</span>: &#123;</span><br><span class="line">      <span class="attr">"com.example.key1"</span>: <span class="string">"value1"</span>,</span><br><span class="line">      <span class="attr">"com.example.key2"</span>: <span class="string">"value2"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:6f4e69a5ff18d92e7315e3ee31c62165ebf25bfa05cad05c0d09d8f412dae401"</span>,</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.oci.image.config.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">452</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:6f4e69a5ff18d92e7315e3ee31c62165ebf25bfa05cad05c0d09d8f412dae401"</span>,</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.oci.image.layer.v1.tar+gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">78343</span></span><br><span class="line">      &#125;</span><br><span class="line">   ],</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Python-docker-drag"><a href="#Python-docker-drag" class="headerlink" title="Python docker-drag"></a>Python <a href="https://github.com/NotGlop/docker-drag" target="_blank" rel="noopener">docker-drag</a></h3><p>è¿™æ˜¯ä¸€ä¸ªå¾ˆç®€å•ç²—æš´çš„ Python è„šæœ¬ï¼Œä½¿ç”¨ request åº“è¯·æ±‚ registry API æ¥ä»é•œåƒä»“åº“ä¸­æ‹‰å–é•œåƒï¼Œå¹¶ä¿å­˜ä¸ºä¸€ä¸ª tar åŒ…ï¼Œæ‹‰å®Œä¹‹åä½¿ç”¨ docker load åŠ è½½ä¸€ä¸‹å°±èƒ½é£Ÿç”¨å•¦ã€‚è¯¥ python è„šæœ¬ç®€å•åˆ°å»æ‰ç©ºè¡Œå’Œæ³¨é‡Šä¸åˆ° 200 è¡Œï¼Œå¦‚æœæŠŠè¿™ä¸ªè„šæœ¬æºç è¯»ä¸€éçš„è¯å°±èƒ½å¤§æ¦‚çŸ¥é“ docker pull å’Œ skopeo copy çš„ä¸€äº›åŸç†ï¼Œä»–ä»¬éƒ½æ˜¯å»è°ƒç”¨ registry çš„ API ï¼Œæ‰€ä»¥è¿˜æ˜¯æ¨èå»è¯»ä¸€ä¸‹è¿™ä¸ªå®ƒçš„æºç ã€‚</p><p>é£Ÿç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•ç›´æ¥ <code>python3 docker_pull.py [image name]</code>ï¼Œè²Œä¼¼åªèƒ½æ‹‰å– docker.io ä¸Šçš„é•œåƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# wget https://raw.githubusercontent.com/NotGlop/docker-drag/master/docker_pull.py</span><br><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# python3 docker_pull.py nginx</span><br><span class="line">Creating image structure in: tmp_nginx_latest</span><br><span class="line">afb6ec6fdc1c: Pull complete [27098756]</span><br><span class="line">dd3ac8106a0b: Pull complete [26210578]                                       ]</span><br><span class="line">8de28bdda69b: Pull complete [538]</span><br><span class="line">a2c431ac2669: Pull complete [900]</span><br><span class="line">e070d03fd1b5: Pull complete [669]</span><br><span class="line">Docker image pulled: library_nginx.tar</span><br><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# docker load -i library_nginx.tar</span><br><span class="line">ffc9b21953f4: Loading layer [==================================================&gt;]  72.49MB/72.49MB</span><br><span class="line">d9c0b16c8d5b: Loading layer [==================================================&gt;]  63.81MB/63.81MB</span><br><span class="line">8c7fd6263c1f: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">077ae58ac205: Loading layer [==================================================&gt;]  4.096kB/4.096kB</span><br><span class="line">787328500ad5: Loading layer [==================================================&gt;]  3.584kB/3.584kB</span><br><span class="line">Loaded image: nginx:latest</span><br></pre></td></tr></table></figure><h3 id="skopeo"><a href="#skopeo" class="headerlink" title="skopeo"></a>skopeo</h3><p>è¿™ä¸ªå·¥å…·æ˜¯çº¢å¸½å­å®¶çš„ï¼Œæ˜¯ Podmanã€Skopeo å’Œ Buildah ï¼ˆç®€ç§° PSB ï¼‰ä¸‹ä¸€ä»£å®¹å™¨æ–°æ¶æ„ä¸­çš„ä¸€å‘˜ï¼Œä¸è¿‡æœ¨å­è§‰ç€ Podman æƒ³è¦å–ä»£ docker å’Œ containerd å®¹å™¨è¿è¡Œæ—¶è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ï¼Œè™½ç„¶å®ƒç¬¦åˆ OCI è§„èŒƒï¼Œä½†å¯¹äºä¼ä¸šæ¥è®²ï¼Œæ›¿æ¢çš„æˆæœ¬å¹¶ä¸å€¼å¾—ä»–ä»¬å»æ¢åˆ° PSB ä¸Šå»ã€‚</p><p>å…¶ä¸­çš„ skopeo è¿™ä¸ªé•œåƒæ¬è¿å·¥å…·ç®€ç›´æ˜¯ä¸ªç¥å™¨ï¼Œå°¤å…¶æ˜¯åœ¨ CI/CD æµæ°´çº¿ä¸­æ¬è¿ä¸¤ä¸ªé•œåƒä»“åº“é‡Œçš„é•œåƒç®€ç›´çˆ½çš„ä¸å¾—äº†ã€‚æˆ‘å…¥èŒæ–°å…¬å¸ååšçš„ä¸€ä¸ªå·¥ä½œå°±æ˜¯ä¼˜åŒ–æˆ‘ä»¬çš„ Jenkins æµæ°´çº¿ä¸­åŒæ­¥ä¸¤ä¸ªé•œåƒä»“åº“çš„è¿‡ç¨‹ï¼Œä½¿ç”¨ äº†skopeo æ›¿ä»£ docker æ¥åŒæ­¥ä¸¤ä¸ªé•œåƒä»“åº“ä¸­çš„é•œåƒï¼Œå°†åŸæ¥éœ€è¦ 2h å°æ—¶ç¼©çŸ­åˆ°äº† 25min ğŸ˜€ã€‚</p><p>å…³äºè¿™ä¸ªå·¥å…·çš„è¯¦ç»†ä½¿ç”¨æ¨èå¤§å®¶å»è¯»ä¸€ä¸‹æˆ‘ä¹‹å‰å†™çš„ä¸€ç¯‡åšå®¢ <a href="https://blog.k8s.li/skopeo.html">é•œåƒæ¬è¿å·¥ skopeo åˆä½“éªŒ</a> ã€‚åœ¨è¿™é‡Œåªè®²ä¸¤ä¸ªæœ¨å­æœ€å¸¸ç”¨çš„åŠŸèƒ½ã€‚</p><h4 id="skopeo-copy"><a href="#skopeo-copy" class="headerlink" title="skopeo copy"></a>skopeo copy</h4><p>ä½¿ç”¨ skopeo copy ä¸¤ä¸ª registry ä¸­çš„é•œåƒæ—¶ï¼Œskopeo è¯·æ±‚ä¸¤ä¸ª registry API ç›´æ¥ copy <code>original blob</code> åˆ°å¦ä¸€ä¸ª registry ï¼Œè¿™æ ·å…å»äº†åƒ docker pull â€“&gt; docker tag â€“&gt; docker push é‚£æ · pull é•œåƒå¯¹é•œåƒè¿›è¡Œè§£å‹ç¼©ï¼Œpush é•œåƒè¿›è¡Œå‹ç¼©ã€‚å°¤å…¶æ˜¯åœ¨æ¬è¿ä¸€äº›è¾ƒå¤§çš„é•œåƒï¼ˆå‡ GB æˆ–è€…å‡ å GBçš„é•œåƒï¼Œæ¯”å¦‚ <code>nvidia/cuda</code> ï¼‰ï¼Œä½¿ç”¨ skopeo copy çš„åŠ é€Ÿæ•ˆæœååˆ†æ˜æ˜¾ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">DEBU[0000] Detected compression format gzip</span><br><span class="line">DEBU[0000] Using original blob without modification</span><br><span class="line"></span><br><span class="line">Getting image source signatures</span><br><span class="line">Copying blob 09a9f6a07669 done</span><br><span class="line">Copying blob f8cdeb3c6c18 done</span><br><span class="line">Copying blob 22c4d5853f25 done</span><br><span class="line">Copying blob 76abc3f50d9b done</span><br><span class="line">Copying blob 3386b7c9ccd4 done</span><br><span class="line">Copying blob b9207193f1af [==============================&gt;-------] 224.2MiB / 271.2MiB</span><br><span class="line">Copying blob 2f32d819e6ce done</span><br><span class="line">Copying blob 5dbc3047e646 done</span><br><span class="line">Copying blob f8dfcc3265c3 [==================&gt;-------------------] 437.1MiB / 864.3MiB</span><br><span class="line">Copying blob 13d3556105d1 done</span><br><span class="line">Copying blob f9b7fa6a027e [=========================&gt;------------] 84.0MiB / 124.3MiB</span><br><span class="line">Copying blob a1a0f6abe73b [====================&gt;-----------------] 417.9MiB / 749.1MiB</span><br><span class="line">Copying blob bcc9947fc8a4 done</span><br><span class="line">Copying blob 9563b2824fef done</span><br><span class="line">Copying blob a1b8faa0044b [===&gt;----------------------------------] 88.0MiB / 830.1MiB</span><br><span class="line">Copying blob 9917e218edfd [===============&gt;----------------------] 348.6MiB / 803.6MiB</span><br><span class="line">Copying blob 776b9ff2f788 done</span><br><span class="line">Copying config d0c3cfd730 done</span><br><span class="line">Writing manifest to image destination</span><br><span class="line">Storing signatures</span><br></pre></td></tr></table></figure><h4 id="skopeo-inspect"><a href="#skopeo-inspect" class="headerlink" title="skopeo inspect"></a>skopeo inspect</h4><p>ç”¨ skopeo inspect å‘½ä»¤å¯ä»¥å¾ˆæ–¹æ–¹ä¾¿åœ°é€šè¿‡ registry çš„ API æ¥æŸ¥çœ‹é•œåƒçš„ manifest æ–‡ä»¶ï¼Œä»¥å‰æˆ‘éƒ½æ˜¯ç”¨ curl å‘½ä»¤çš„ï¼Œè¦ token è¿˜è¦åŠ ä¸€å †å‚æ•°ï¼Œæ‰€ä»¥æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥åæ¥å°±ç”¨ä¸Šäº†  skopeo inspectğŸ˜€ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@deploy:/root # skopeo inspect docker://index.docker.io/webpsh/webps:latest --raw</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">   <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.container.image.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">2534</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:30d9679b0b1ca7e56096eca0cdb7a6eedc29b63968f25156ef60dec27bc7d206"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">2813316</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">8088920</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:54335262c2ed2d4155e62b45b187a1394fbb6f39e0a4a171ab8ce0c93789e6b0"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">262</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:31555b34852eddc7c01f26fa9c0e5e577e36b4e7ccf1b10bec977eb4593a376b"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é•œåƒæ˜¯æ€ä¹ˆå­˜æ”¾çš„-äºŒ-registry-å­˜å‚¨ğŸ™„"><a href="#é•œåƒæ˜¯æ€ä¹ˆå­˜æ”¾çš„-äºŒ-registry-å­˜å‚¨ğŸ™„" class="headerlink" title="é•œåƒæ˜¯æ€ä¹ˆå­˜æ”¾çš„ (äºŒ) registry å­˜å‚¨ğŸ™„"></a>é•œåƒæ˜¯æ€ä¹ˆå­˜æ”¾çš„ (äºŒ) registry å­˜å‚¨ğŸ™„</h2><p>æ–‡ç« çš„å¼€å¤´æˆ‘ä»¬æåˆ°è¿‡ OCI è§„èŒƒä¸­çš„é•œåƒä»“åº“è§„èŒƒ <a href="https://github.com/opencontainers/distribution-spec" target="_blank" rel="noopener">distribution-spec</a>ï¼Œè¯¥è§„èŒƒå°±å®šä¹‰ç€å®¹å™¨é•œåƒå¦‚ä½•å­˜å‚¨åœ¨è¿œç«¯ï¼ˆå³ registryï¼‰ä¸Šã€‚æˆ‘ä»¬å¯ä»¥æŠŠ registry çœ‹ä½œé•œåƒçš„ä»“åº“ï¼Œä½¿ç”¨è¯¥è§„èŒƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠŠè¿™äº›é•œåƒæŒ‰ç…§çº¦å®šä¿—æˆçš„æ ¼å¼æ¥å­˜æ”¾ï¼Œç›®å‰å®ç°è¯¥è§„èŒƒçš„ registry å°± docker å®¶çš„ registry ä½¿ç”¨çš„å¤šä¸€äº›ã€‚å…¶ä»–çš„ registry æ¯”å¦‚ harbor ï¼Œquay.io ä½¿ç”¨çš„ä¹Ÿæ¯”è¾ƒå¤šã€‚</p><h3 id="registry-registry-docker-v2"><a href="#registry-registry-docker-v2" class="headerlink" title="registry (/registry/docker/v2)"></a>registry (/registry/docker/v2)</h3><p>æƒ³è¦åˆ†æä¸€ä¸‹é•œåƒæ˜¯å¦‚ä½•å­˜æ”¾åœ¨ registry ä¸Šçš„ï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°ä½¿ç”¨ docker run æ¥èµ· registry çš„å®¹å™¨å³å¯ï¼Œæˆ‘ä»¬ä»…ä»…æ˜¯æ¥åˆ†æ registry ä¸­é•œåƒæ—¶å¦‚ä½•å­˜å‚¨çš„ï¼Œè¿™ç§åœºæ™¯ä¸‹ä¸å¤ªé€‚åˆç”¨ harbor è¿™ç§é‡é‡çº§çš„ registry ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# docker run -d --name registry -p 5000:5000 -v /var/lib/registry:/var/lib/registry registry</span><br><span class="line">335ea763a2fa4508ebf3ec6f8b11f3b620a11bdcaa0ab43176b781427e0beee6</span><br></pre></td></tr></table></figure><p>å¯åŠ¨å®Œ registry å®¹å™¨ä¹‹åæˆ‘ä»¬ç»™ä¹‹å‰å·²ç»æ„å»ºå¥½çš„é•œåƒé‡æ–°æ‰“ä¸Šæ”¹ registry çš„ tag æ–¹ä¾¿åç»­ push åˆ° registry ä¸Šã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker tag debian:v1  localhost:5000/library/debian:v1</span><br><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# ^v1^v2</span><br><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker tag debian:v2  localhost:5000/library/debian:v2</span><br><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker images</span><br><span class="line">REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">debian                          v2                  e6e782a57a51        5 minutes ago       69.2MB</span><br><span class="line">localhost:5000/library/debian   v2                  e6e782a57a51        5 minutes ago       69.2MB</span><br><span class="line">debian                          v1                  cfba37fd24f8        9 minutes ago       69.2MB</span><br><span class="line">localhost:5000/library/debian   v1                  cfba37fd24f8        9 minutes ago       69.2MB</span><br><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker push localhost:5000/library/debian:v1</span><br><span class="line">The push refers to repository [localhost:5000/library/debian]</span><br><span class="line">d1b85e6186f6: Pushed</span><br><span class="line">v1: digest: sha256:b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239 size: 529</span><br><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker push localhost:5000/library/debian:v2</span><br><span class="line">The push refers to repository [localhost:5000/library/debian]</span><br><span class="line">d1b85e6186f6: Layer already exists</span><br><span class="line">v2: digest: sha256:c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11 size: 529</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬åœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ª registry å®¹å™¨ä¹‹åï¼Œå®¹å™¨å†…é»˜è®¤çš„å­˜å‚¨ä½ç½®ä¸º <code>/var/lib/registry</code> ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å¯åŠ¨çš„æ—¶å€™åŠ äº†å‚æ•° <code>-v /var/lib/registry:/var/lib/registry</code> å°†æœ¬æœºçš„è·¯å¾„æŒ‚è½½åˆ°å®¹å™¨å†…ã€‚è¿›å…¥è¿™é‡Œè·¯å¾„æˆ‘ä»¬ä½¿ç”¨ tree å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªç›®å½•çš„å­˜å‚¨ç»“æ„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# tree -h</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ [4.0K]  blobs</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  aa</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ [ 26M]  data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  b9</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ [ 529]  data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  c8</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ [ 529]  data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  cf</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ [1.4K]  data</span><br><span class="line">â”‚Â Â      â””â”€â”€ [4.0K]  e6</span><br><span class="line">â”‚Â Â          â””â”€â”€ [4.0K]  e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df</span><br><span class="line">â”‚Â Â              â””â”€â”€ [1.4K]  data</span><br><span class="line">â””â”€â”€ [4.0K]  repositories</span><br><span class="line">    â””â”€â”€ [4.0K]  library</span><br><span class="line">        â””â”€â”€ [4.0K]  debian</span><br><span class="line">            â”œâ”€â”€ [4.0K]  _layers</span><br><span class="line">            â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">            â”‚Â Â      â”œâ”€â”€ [4.0K]  aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â      â”œâ”€â”€ [4.0K]  cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â      â””â”€â”€ [4.0K]  e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df</span><br><span class="line">            â”‚Â Â          â””â”€â”€ [  71]  link</span><br><span class="line">            â”œâ”€â”€ [4.0K]  _manifests</span><br><span class="line">            â”‚Â Â  â”œâ”€â”€ [4.0K]  revisions</span><br><span class="line">            â”‚Â Â  â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">            â”‚Â Â  â”‚Â Â      â”œâ”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">            â”‚Â Â  â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â  â”‚Â Â      â””â”€â”€ [4.0K]  c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11</span><br><span class="line">            â”‚Â Â  â”‚Â Â          â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â  â””â”€â”€ [4.0K]  tags</span><br><span class="line">            â”‚Â Â      â”œâ”€â”€ [4.0K]  v1</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â”œâ”€â”€ [4.0K]  current</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  index</span><br><span class="line">            â”‚Â Â      â”‚Â Â      â””â”€â”€ [4.0K]  sha256</span><br><span class="line">            â”‚Â Â      â”‚Â Â          â””â”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">            â”‚Â Â      â”‚Â Â              â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â      â””â”€â”€ [4.0K]  v2</span><br><span class="line">            â”‚Â Â          â”œâ”€â”€ [4.0K]  current</span><br><span class="line">            â”‚Â Â          â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â          â””â”€â”€ [4.0K]  index</span><br><span class="line">            â”‚Â Â              â””â”€â”€ [4.0K]  sha256</span><br><span class="line">            â”‚Â Â                  â””â”€â”€ [4.0K]  c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11</span><br><span class="line">            â”‚Â Â                      â””â”€â”€ [  71]  link</span><br><span class="line">            â””â”€â”€ [4.0K]  _uploads</span><br><span class="line"></span><br><span class="line">37 directories, 14 files</span><br></pre></td></tr></table></figure><p>æ ‘å½¢çš„ç»“æ„çœ‹ç€ä¸å¤ªç›´è§‚ï¼Œæœ¨å­å°±ç”»äº†ä¸€å¼ å±‚çº§ç»“æ„çš„å›¾ï¼š</p><p><img src="img/registry-arch.png" alt="img"></p><h3 id="blobs-ç›®å½•"><a href="#blobs-ç›®å½•" class="headerlink" title="blobs ç›®å½•"></a>blobs ç›®å½•</h3><p>ä¹‹å‰æˆ‘ä»¬å‘ registry ç§æ¨é€äº†ä¸¤ä¸ªé•œåƒï¼Œè¿™ä¸¤ä¸ªé•œåƒçš„ layer ç›¸åŒä½†ä¸æ˜¯ç”¨ä¸€ä¸ªé•œåƒï¼Œåœ¨æˆ‘ä»¬ä¹‹å‰ push image çš„æ—¶å€™ä¹Ÿçœ‹åˆ°äº† <code>d1b85e6186f6: Layer already exists</code>ã€‚ä¹Ÿå°±å¯ä»¥è¯æ˜äº†ï¼Œè™½ç„¶ä¸¤ä¸ªé•œåƒä¸åŒï¼Œä½†å®ƒä»¬çš„ layer åœ¨ registry ä¸­å­˜å‚¨çš„æ—¶å€™å¯èƒ½æ˜¯ç›¸åŒçš„ã€‚</p><p>åœ¨ <code>blobs/sha256</code> ç›®å½•ä¸‹ä¸€å…±æœ‰ 5 ä¸ªåä¸º data çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æµ‹ä¸€ä¸‹æœ€å¤§çš„é‚£ä¸ª <code>[ 26M]</code> åº”è¯¥æ˜¯é•œåƒçš„ layer ï¼Œæœ€å°çš„ <code>[ 529]</code> é‚£ä¸ªåº”è¯¥æ˜¯ manifestï¼Œå‰©ä¸‹çš„é‚£ä¸ª <code>[1.4K]</code> åº”è¯¥å°±æ˜¯ image config æ–‡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/blobs/sha256</span><br><span class="line">â•°â”€# tree -h</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ [4.0K]  aa</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb</span><br><span class="line">â”‚Â Â      â””â”€â”€ [ 26M]  data</span><br><span class="line">â”œâ”€â”€ [4.0K]  b9</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â”‚Â Â      â””â”€â”€ [ 529]  data</span><br><span class="line">â”œâ”€â”€ [4.0K]  c8</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11</span><br><span class="line">â”‚Â Â      â””â”€â”€ [ 529]  data</span><br><span class="line">â”œâ”€â”€ [4.0K]  cf</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d</span><br><span class="line">â”‚Â Â      â””â”€â”€ [1.4K]  data</span><br><span class="line">â””â”€â”€ [4.0K]  e6</span><br><span class="line">    â””â”€â”€ [4.0K]  e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df</span><br><span class="line">        â””â”€â”€ [1.4K]  data</span><br></pre></td></tr></table></figure><p>åœ¨ <code>registry</code> çš„å­˜å‚¨ç›®å½•ä¸‹ï¼Œ<code>blobs</code> ç›®å½•ç”¨æ¥å­˜æ”¾é•œåƒçš„ä¸‰ç§æ–‡ä»¶ï¼š layer çš„çœŸå®æ•°æ®ï¼Œé•œåƒçš„ manifest æ–‡ä»¶ï¼Œé•œåƒçš„ image config æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶éƒ½æ˜¯ä»¥ <code>data</code> ä¸ºåçš„æ–‡ä»¶å­˜æ”¾åœ¨äºè¯¥æ–‡ä»¶ <code>sha256</code> ç›¸å¯¹åº”çš„ç›®å½•ä¸‹ã€‚ ä½¿ç”¨ä»¥å†…å®¹å¯»å€çš„ <code>sha256</code> æ•£åˆ—å­˜å‚¨æ–¹ä¾¿ç´¢å¼•æ–‡ä»¶ï¼Œåœ¨ <code>blob digest</code> ç›®å½•ä¸‹æœ‰ä¸€ä¸ªåä¸º <code>data</code>çš„æ–‡ä»¶ï¼Œå¯¹äº layer æ¥è®²ï¼Œè¿™æ˜¯ä¸ª <code>data</code> æ–‡ä»¶çš„æ ¼å¼æ˜¯ <code>vnd.docker.image.rootfs.diff.tar.gzip</code> ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>tar -xvf</code> å‘½ä»¤å°†è¿™ä¸ª layer è§£å¼€ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ docker pull å‘½ä»¤æ‹‰å–é•œåƒçš„æ—¶å€™ï¼Œä¹Ÿæ˜¯å»ä¸‹è½½è¿™ä¸ª <code>data</code>æ–‡ä»¶ï¼Œä¸‹è½½å®Œæˆä¹‹åä¼šæœ‰ä¸€ä¸ª <code>docker-untar</code>çš„è¿›ç¨‹å°†è¿™ä¸ª <code>data</code>æ–‡ä»¶è§£å¼€å­˜æ”¾åœ¨<code>/var/lib/docker/overlay2/${digest}/diff</code> ç›®å½•ä¸‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ [4.0K]  blobs</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  aa</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ [ 26M]  data</span><br></pre></td></tr></table></figure><h4 id="manifest-æ–‡ä»¶"><a href="#manifest-æ–‡ä»¶" class="headerlink" title="manifest æ–‡ä»¶"></a>manifest æ–‡ä»¶</h4><p>å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ json æ–‡ä»¶å•¦ï¼Œè®°å½•äº†ä¸€ä¸ªé•œåƒæ‰€åŒ…å«çš„ layer ä¿¡æ¯ï¼Œå½“æˆ‘ä»¬ pull é•œåƒçš„æ—¶å€™ä¼šä½¿ç”¨åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/blobs/sha256/b9/b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â•°â”€# cat data</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">   <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.container.image.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">1462</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">27097859</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;#</span><br></pre></td></tr></table></figure><h4 id="image-config-æ–‡ä»¶"><a href="#image-config-æ–‡ä»¶" class="headerlink" title="image config æ–‡ä»¶"></a>image config æ–‡ä»¶</h4><p>image config æ–‡ä»¶é‡Œå¹¶æ²¡æœ‰åŒ…å«é•œåƒçš„ tag ä¿¡æ¯ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/blobs/sha256/e6/e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df</span><br><span class="line">â•°â”€# cat data | jq "."</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">  <span class="attr">"config"</span>: &#123;</span><br><span class="line">    <span class="attr">"Hostname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"User"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"bash"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Image"</span>: <span class="string">"sha256:ba8f577813c7bdf6b737f638dffbc688aa1df2ff28a826a6c46bae722977b549"</span>,</span><br><span class="line">    <span class="attr">"Volumes"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Entrypoint"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OnBuild"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"Labels"</span>: <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"container"</span>: <span class="string">"38501d5aa48c080884f4dc6fd4b1b6590ff1607d9e7a12e1cef1d86a3fdc32df"</span>,</span><br><span class="line">  <span class="attr">"container_config"</span>: &#123;</span><br><span class="line">    <span class="attr">"Hostname"</span>: <span class="string">"38501d5aa48c"</span>,</span><br><span class="line">    <span class="attr">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"User"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"/bin/sh"</span>,</span><br><span class="line">      <span class="string">"-c"</span>,</span><br><span class="line">      <span class="string">"#(nop) "</span>,</span><br><span class="line">      <span class="string">"CMD [\"bash\"]"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Image"</span>: <span class="string">"sha256:ba8f577813c7bdf6b737f638dffbc688aa1df2ff28a826a6c46bae722977b549"</span>,</span><br><span class="line">    <span class="attr">"Volumes"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Entrypoint"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OnBuild"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"Labels"</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"created"</span>: <span class="string">"2020-06-07T01:59:47.348924716Z"</span>,</span><br><span class="line">  <span class="attr">"docker_version"</span>: <span class="string">"19.03.5"</span>,</span><br><span class="line">  <span class="attr">"history"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-06-07T01:59:46.877600299Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop) ADD file:a82014afc29e7b364ac95223b22ebafad46cc9318951a85027a49f9ce1a99461 in / "</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-06-07T01:59:47.348924716Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop)  CMD [\"bash\"]"</span>,</span><br><span class="line">      <span class="attr">"empty_layer"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">  <span class="attr">"rootfs"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"layers"</span>,</span><br><span class="line">    <span class="attr">"diff_ids"</span>: [</span><br><span class="line">      <span class="string">"sha256:d1b85e6186f67d9925c622a7a6e66faa447e767f90f65ae47cdc817c629fa956"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="uploads-æ–‡ä»¶å¤¹"><a href="#uploads-æ–‡ä»¶å¤¹" class="headerlink" title="_uploads æ–‡ä»¶å¤¹"></a>_uploads æ–‡ä»¶å¤¹</h4><p>_uploads æ–‡ä»¶å¤¹æ˜¯ä¸ªä¸´æ—¶çš„æ–‡ä»¶å¤¹ï¼Œä¸»è¦ç”¨æ¥å­˜æ”¾ push é•œåƒè¿‡ç¨‹ä¸­çš„æ–‡ä»¶æ•°æ®ï¼Œå½“é•œåƒ <code>layer</code> ä¸Šä¼ å®Œæˆä¹‹åä¼šæ¸…ç©ºè¯¥æ–‡ä»¶å¤¹ã€‚å…¶ä¸­çš„ <code>data</code> æ–‡ä»¶ä¸Šä¼ å®Œæ¯•åä¼šç§»åŠ¨åˆ° <code>blobs</code> ç›®å½•ä¸‹ï¼Œæ ¹æ®è¯¥æ–‡ä»¶çš„ <code>sha256</code> å€¼æ¥è¿›è¡Œæ•£åˆ—å­˜å‚¨åˆ°ç›¸åº”çš„ç›®å½•ä¸‹ã€‚</p><p>ä¸Šä¼ è¿‡ç¨‹ä¸­çš„ç›®å½•ç»“æ„ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">_uploads</span><br><span class="line">â”œâ”€â”€ [  53]  0d6c996e-638f-4436-b2b6-54fa7ad430d2</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ [198M]  data</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ [  20]  hashstates</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ [  15]  sha256</span><br><span class="line">â”‚Â Â  â”‚Â Â      â””â”€â”€ [ 108]  0</span><br><span class="line">â”‚Â Â  â””â”€â”€ [  20]  startedat</span><br><span class="line">â””â”€â”€ [  53]  ba31818e-4217-47ef-ae46-2784c9222614</span><br><span class="line">    â”œâ”€â”€ [571M]  data</span><br><span class="line">    â”œâ”€â”€ [  20]  hashstates</span><br><span class="line">    â”‚Â Â  â””â”€â”€ [  15]  sha256</span><br><span class="line">    â”‚Â Â      â””â”€â”€ [ 108]  0</span><br><span class="line">    â””â”€â”€ [  20]  startedat</span><br><span class="line"></span><br><span class="line">6 directories, 6 files</span><br></pre></td></tr></table></figure><ul><li>ä¸Šä¼ å®Œé•œåƒä¹‹åï¼Œ<code>_uploads</code> æ–‡ä»¶å¤¹å°±ä¼šè¢«æ¸…ç©ºï¼Œæ­£å¸¸æƒ…å†µä¸‹è¿™ä¸ªæ–‡ä»¶å¤¹æ˜¯ç©ºçš„ã€‚ä½†ä¹Ÿæœ‰å¼‚å¸¸çš„æ—¶å€™ğŸ˜‚ï¼Œæ¯”å¦‚ç½‘ç»œæŠ–åŠ¨å¯¼è‡´ä¸Šä¼ æ„å¤–ä¸­æ–­ï¼Œè¯¥æ–‡ä»¶å¤¹å°±å¯èƒ½ä¸ä¸ºç©ºã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_uploads</span><br><span class="line"></span><br><span class="line">0 directories, 0 files</span><br></pre></td></tr></table></figure><h4 id="manifests-æ–‡ä»¶å¤¹"><a href="#manifests-æ–‡ä»¶å¤¹" class="headerlink" title="_manifests æ–‡ä»¶å¤¹"></a>_manifests æ–‡ä»¶å¤¹</h4><p><code>_manifests</code> æ–‡ä»¶å¤¹æ˜¯é•œåƒä¸Šä¼ å®Œæˆä¹‹åç”± registry æ¥ç”Ÿæˆçš„ï¼Œå¹¶ä¸”è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªåä¸º <code>link</code>çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå®ƒçš„å€¼æŒ‡å‘ blobs ç›®å½•ä¸‹ä¸ä¹‹å¯¹åº”çš„ç›®å½•ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/repositories/library</span><br><span class="line">â•°â”€# find . -type f</span><br><span class="line">./debian/_layers/sha256/aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb/link</span><br><span class="line">./debian/_layers/sha256/e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df/link</span><br><span class="line">./debian/_layers/sha256/cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d/link</span><br><span class="line">./debian/_manifests/tags/v2/current/link</span><br><span class="line">./debian/_manifests/tags/v2/index/sha256/c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11/link</span><br><span class="line">./debian/_manifests/tags/v1/current/link</span><br><span class="line">./debian/_manifests/tags/v1/index/sha256/b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239/link</span><br><span class="line">./debian/_manifests/revisions/sha256/b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239/link</span><br><span class="line">./debian/_manifests/revisions/sha256/c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11/link</span><br></pre></td></tr></table></figure><p><code>_manifests</code> æ–‡ä»¶å¤¹ä¸‹åŒ…å«ç€é•œåƒçš„ <code>tags</code> å’Œ <code>revisions</code> ä¿¡æ¯ï¼Œæ¯ä¸€ä¸ªé•œåƒçš„æ¯ä¸€ä¸ª tag å¯¹åº”ç€äº tag åç›¸åŒçš„ç›®å½•ã€‚é•œåƒçš„ tag å¹¶ä¸å­˜å‚¨åœ¨ image config ä¸­ï¼Œè€Œæ˜¯ä»¥ç›®å½•çš„å½¢å¼æ¥å½¢æˆé•œåƒçš„ tagï¼Œè¿™ä¸€ç‚¹æ¯”è¾ƒå¥‡å¦™ï¼Œè¿™å’Œæˆ‘ä»¬ Dockerfile ä¸­å¹¶ä¸åŒ…å«é•œåƒåå’Œ tag ä¸€ä¸ªé“ç†ï¼Ÿ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ [4.0K]  _layers</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â      â””â”€â”€ [4.0K]  e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df</span><br><span class="line">â”‚Â Â          â””â”€â”€ [  71]  link</span><br><span class="line">â”œâ”€â”€ [4.0K]  _manifests</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ [4.0K]  revisions</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â  â”‚Â Â      â”œâ”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â”‚Â Â  â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â  â”‚Â Â      â””â”€â”€ [4.0K]  c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11</span><br><span class="line">â”‚Â Â  â”‚Â Â          â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  tags</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  v1</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ [4.0K]  current</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  index</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â      â”‚Â Â          â””â”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â”‚Â Â      â”‚Â Â              â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â      â””â”€â”€ [4.0K]  v2</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ [4.0K]  current</span><br><span class="line">â”‚Â Â          â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â          â””â”€â”€ [4.0K]  index</span><br><span class="line">â”‚Â Â              â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â                  â””â”€â”€ [4.0K]  c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11</span><br><span class="line">â”‚Â Â                      â””â”€â”€ [  71]  link</span><br><span class="line">â””â”€â”€ [4.0K]  _uploads</span><br><span class="line"></span><br><span class="line">22 directories, 9 files</span><br></pre></td></tr></table></figure><h4 id="é•œåƒçš„-tag"><a href="#é•œåƒçš„-tag" class="headerlink" title="é•œåƒçš„ tag"></a>é•œåƒçš„ tag</h4><p> æ¯ä¸ª <code>tag</code>åç›®å½•ä¸‹é¢æœ‰ <code>current</code> ç›®å½•å’Œ <code>index</code> ç›®å½•ï¼Œ <code>current</code> ç›®å½•ä¸‹çš„ link æ–‡ä»¶ä¿å­˜äº†è¯¥ tag ç›®å‰çš„ manifest æ–‡ä»¶çš„ sha256 ç¼–ç ï¼Œå¯¹åº”åœ¨ <code>blobs</code> ä¸­çš„ <code>sha256</code> ç›®å½•ä¸‹çš„ <code>data</code> æ–‡ä»¶ï¼Œè€Œ <code>index</code> ç›®å½•åˆ™åˆ—å‡ºäº†è¯¥ <code>tag</code> å†å²ä¸Šä¼ çš„æ‰€æœ‰ç‰ˆæœ¬çš„ <code>sha256</code> ç¼–ç ä¿¡æ¯ã€‚<code>_revisions</code> ç›®å½•é‡Œå­˜æ”¾äº†è¯¥ <code>repository</code> å†å²ä¸Šä¸Šä¼ ç‰ˆæœ¬çš„æ‰€æœ‰ sha256 ç¼–ç ä¿¡æ¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/repositories/library/debian/_manifests/tags/v1</span><br><span class="line">â•°â”€# cat current/link</span><br><span class="line">sha256:b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/blobs/sha256</span><br><span class="line">â•°â”€# tree -h</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ [4.0K]  aa</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb</span><br><span class="line">â”‚Â Â      â””â”€â”€ [ 26M]  data</span><br><span class="line">â”œâ”€â”€ [4.0K]  b9</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â”‚Â Â      â””â”€â”€ [ 529]  data</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ <code>pull</code> é•œåƒçš„æ—¶å€™å¦‚æœä¸æŒ‡å®šé•œåƒçš„ <code>tag</code>åï¼Œé»˜è®¤å°±æ˜¯ latestï¼Œregistry ä¼šä» HTTP è¯·æ±‚ä¸­è§£æåˆ°è¿™ä¸ª tag åï¼Œç„¶åæ ¹æ® tag åç›®å½•ä¸‹çš„ link æ–‡ä»¶æ‰¾åˆ°è¯¥é•œåƒçš„ manifest çš„ä½ç½®è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ¥ç€å»è¯·æ±‚è¿™ä¸ª manifest æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯æ ¹æ®è¿™ä¸ª manifest æ–‡ä»¶æ¥ pull ç›¸åº”çš„é•œåƒ layer ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/repositories/library/debian/_manifests/tags/v1</span><br><span class="line">â•°â”€# cat  /var/lib/registry/docker/registry/v2/blobs/sha256/b9/b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239/data</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">   <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.container.image.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">1462</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">27097859</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åå†è¡¥å……ä¸€ç‚¹å°±æ˜¯ï¼ŒåŒä¸€ä¸ªé•œåƒåœ¨ registry ä¸­å­˜å‚¨çš„ä½ç½®æ˜¯ç›¸åŒçš„ï¼Œå…·ä½“çš„åˆ†æå¯ä»¥å‚è€ƒ <a href="https://supereagle.github.io/2018/04/24/docker-registry/" target="_blank" rel="noopener">é•œåƒä»“åº“ä¸­é•œåƒå­˜å‚¨çš„åŸç†è§£æ</a> è¿™ç¯‡åšå®¢ã€‚</p><blockquote><ul><li>é€šè¿‡ Registry API è·å¾—çš„ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ manifest ä¿¡æ¯å®Œå…¨ç›¸åŒã€‚</li><li>ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ manifest ä¿¡æ¯çš„å­˜å‚¨è·¯å¾„å’Œå†…å®¹å®Œå…¨ç›¸åŒã€‚</li><li>ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ blob ä¿¡æ¯çš„å­˜å‚¨è·¯å¾„å’Œå†…å®¹å®Œå…¨ç›¸åŒã€‚</li></ul></blockquote><p>ä»ä¸Šé¢è¿™ä¸‰ä¸ªç»“è®ºä¸­æˆ‘ä»¬å¯ä»¥æ¨æ–­å‡º registry å­˜å‚¨ç›®å½•é‡Œå¹¶ä¸ä¼šå­˜å‚¨ä¸è¯¥ registry ç›¸å…³çš„ä¿¡æ¯ï¼Œæ¯”æˆ‘ä»¬ push é•œåƒçš„æ—¶å€™éœ€è¦ç»™é•œåƒåŠ ä¸Š <code>localhost:5000</code> è¿™ä¸ªå‰ç¼€ï¼Œè¿™ä¸ªå‰ç¼€å¹¶ä¸ä¼šå­˜å‚¨åœ¨ registry å­˜å‚¨ä¸­ã€‚åŠ å…¥æˆ‘è¦è¿ç§»ä¸€ä¸ªå¾ˆå¤§çš„ registry é•œåƒä»“åº“ï¼Œé•œåƒçš„æ•°é‡åœ¨ 5k ä»¥ä¸Šã€‚æœ€ä¾¿æ·çš„åŠæ³•å°±æ˜¯æ‰“åŒ…è¿™ä¸ª registry å­˜å‚¨ç›®å½•ï¼Œå°†è¿™ä¸ª tar åŒ… rsync åˆ°å¦ä¸€å°æœºå™¨å³å¯ã€‚éœ€è¦å¼ºè°ƒä¸€ç‚¹ï¼Œæ‰“åŒ… registry å­˜å‚¨ç›®å½•çš„æ—¶å€™ä¸éœ€è¦è¿›è¡Œå‹ç¼©ï¼Œç›´æ¥ <code>tar -cvf</code> å³å¯ã€‚å› ä¸º registry å­˜å‚¨çš„é•œåƒ layer å·²ç»æ˜¯ä¸ª <code>tar.gzip</code> æ ¼å¼çš„æ–‡ä»¶ï¼Œå†è¿›è¡Œå‹ç¼©çš„è¯æ•ˆæœç”šå¾®è€Œä¸”è¿˜æµªè´¹ CPU æ—¶é—´å¾—ä¸å¿å¤±ã€‚</p><h3 id="docker-archive"><a href="#docker-archive" class="headerlink" title="docker-archive"></a>docker-archive</h3><p>æœ¬æ¥æˆ‘æƒ³ç€ docker save å‡ºæ¥çš„å¹¶ä¸æ˜¯ä¸€ä¸ªé•œåƒï¼Œè€Œæ˜¯ä¸€ä¸ª <code>.tar</code> æ–‡ä»¶ï¼Œä½†æˆ‘æƒ³äº†åˆæƒ³ï¼Œè¿˜æ˜¯è§‰ç€å®ƒæ˜¯ä¸€ä¸ªé•œåƒï¼Œåªä¸è¿‡å­˜åœ¨çš„æ–¹å¼ä¸åŒè€Œå·²ã€‚äºåœ¨ docker å’Œ registry ä¸­å­˜æ”¾çš„æ–¹å¼ä¸åŒï¼Œä½¿ç”¨ docker save å‡ºæ¥çš„é•œåƒæ˜¯ä¸€ä¸ªå­¤ç«‹çš„å­˜åœ¨ã€‚å°±åƒæ˜¯ä»è›‹ç³•åº—é‡Œæ‹¿å‡ºæ¥çš„è›‹ç³•ï¼Œå¤–é¢è‚¯å®šè¦æœ‰ä¸ªç²¾ç¾çš„åŒ…è£…æ˜¯å§ï¼Œä½ æ€»æ²¡è§è¿‡ã€‚æ”¾åœ¨å“ªé‡Œéƒ½å¯ä»¥ï¼Œä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬ä½¿ç”¨ docker load æ‹†å¼€å¤–åŒ…è£…(<code>.tar</code>)å°±å¯ã€‚æ¯”å¦‚æˆ‘ä»¬ç¦»çº¿éƒ¨ç½² harbor çš„æ—¶å€™å°±æ˜¯ä½¿ç”¨å®˜æ–¹çš„é•œåƒ tar åŒ…æ¥è¿›è¡ŒåŠ è½½é•œåƒå¯åŠ¨å®¹å™¨çš„ã€‚</p><h2 id="é•œåƒæ˜¯æ€ä¹ˆé£Ÿç”¨çš„ğŸ˜‹"><a href="#é•œåƒæ˜¯æ€ä¹ˆé£Ÿç”¨çš„ğŸ˜‹" class="headerlink" title="é•œåƒæ˜¯æ€ä¹ˆé£Ÿç”¨çš„ğŸ˜‹"></a>é•œåƒæ˜¯æ€ä¹ˆé£Ÿç”¨çš„ğŸ˜‹</h2><p>å½“æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªé•œåƒä¹‹åï¼Œå¦‚æœç”¨å®ƒæ¥å¯åŠ¨ä¸€ä¸ªå®¹å™¨å‘¢ï¼Ÿè¿™é‡Œå°±æ¶‰åŠåˆ°äº† OCI è§„èŒƒä¸­çš„å¦ä¸€ä¸ªè§„èŒƒå³è¿è¡Œæ—¶è§„èŒƒ <a href="https://github.com/opencontainers/runtime-spec" target="_blank" rel="noopener">runtime-spec</a> ã€‚å®¹å™¨è¿è¡Œæ—¶é€šè¿‡ä¸€ä¸ªå« <a href="https://github.com/opencontainers/runtime-spec/blob/master/bundle.md" target="_blank" rel="noopener"> OCI runtime filesytem bundle</a> çš„æ ‡å‡†æ ¼å¼å°† OCI é•œåƒé€šè¿‡å·¥å…·è½¬æ¢ä¸º bundle ï¼Œç„¶å OCI å®¹å™¨å¼•æ“èƒ½å¤Ÿè¯†åˆ«è¿™ä¸ª bundle æ¥è¿è¡Œå®¹å™¨ã€‚</p><blockquote><p>filesystem bundle æ˜¯ä¸ªç›®å½•ï¼Œç”¨äºç»™ runtime æä¾›å¯åŠ¨å®¹å™¨å¿…å¤‡çš„é…ç½®æ–‡ä»¶å’Œæ–‡ä»¶ç³»ç»Ÿã€‚æ ‡å‡†çš„å®¹å™¨ bundle åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>config.json: è¯¥æ–‡ä»¶åŒ…å«äº†å®¹å™¨è¿è¡Œçš„é…ç½®ä¿¡æ¯ï¼Œè¯¥æ–‡ä»¶å¿…é¡»å­˜åœ¨ bundle çš„æ ¹ç›®å½•ï¼Œä¸”åå­—å¿…é¡»ä¸º config.json</li><li>å®¹å™¨çš„æ ¹ç›®å½•ï¼Œå¯ä»¥ç”± config.json ä¸­çš„ root.path æŒ‡å®š</li></ul></blockquote><p><img src="img/20200609_oci-04.jpg" alt="img"></p><h3 id="docker-run"><a href="#docker-run" class="headerlink" title="docker run"></a>docker run</h3><p>å½“æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªå®¹å™¨ä¹‹åæˆ‘ä»¬ä½¿ç”¨ tree å‘½ä»¤æ¥åˆ†æä¸€ä¸‹ overlay2 å°±ä¼šå‘ç°ï¼Œè¾ƒä¹‹å‰çš„ç›®å½•ï¼Œå®¹å™¨å¯åŠ¨ä¹‹å overlay2 ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ª <code>merged</code> çš„æ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹å°±æ˜¯å®¹å™¨å†…çœ‹åˆ°çš„ã€‚docker é€šè¿‡ overlayfs è”åˆæŒ‚è½½çš„æŠ€æœ¯å°†é•œåƒçš„å¤šå±‚ layer æŒ‚è½½ä¸ºä¸€å±‚ï¼Œè¿™å±‚çš„å†…å®¹å°±æ˜¯å®¹å™¨é‡Œæ‰€çœ‹åˆ°çš„ï¼Œä¹Ÿå°±æ˜¯ merged æ–‡ä»¶å¤¹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/docker</span><br><span class="line">â•°â”€# tree overlay2 -d -L 3</span><br><span class="line">overlay2</span><br><span class="line">â”œâ”€â”€ 259cf6934509a674b1158f0a6c90c60c133fd11189f98945c7c3a524784509ff</span><br><span class="line">â”‚Â Â  â””â”€â”€ diff</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ bin</span><br><span class="line">|</span><br><span class="line">â”‚Â Â      â””â”€â”€ var</span><br><span class="line">â”œâ”€â”€ 27f9e9b74a88a269121b4e77330a665d6cca4719cb9a58bfc96a2b88a07af805</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”œâ”€â”€ 5f85c914c55220ec2635bce0080d2ad677f739dcfac4fd266b773625e3051844</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ var</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ merged</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ bin</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ dev</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ etc</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ home</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ media</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ mnt</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ proc</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ root</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ run</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ sbin</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ srv</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ sys</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ tmp</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ usr</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ var</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”‚Â Â      â””â”€â”€ work</span><br><span class="line">â”œâ”€â”€ 5f85c914c55220ec2635bce0080d2ad677f739dcfac4fd266b773625e3051844-init</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ dev</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ etc</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”‚Â Â      â””â”€â”€ work</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">overlay on / type overlay (rw,relatime,lowerdir=/opt/docker/overlay2/l/4EPD2X5VF62FH5PZOZHZDKAKGL:/opt/docker/overlay2/l/MYRYBGZRI4I76MJWQHN7VLZXLW:/opt/docker/overlay2/l/5RZOXYR35NSGAWTI36CVUIRW7U:/opt/docker/overlay2/l/LBWRL4ZXGBWOTN5JDCDZVNOY7H:/opt/docker/overlay2/l/526XCHXRJMZXRIHN4YWJH2QLPY:/opt/docker/overlay2/l/XK5IA4BWQ2CIS667J3SXPXGQK5,upperdir=/opt/docker/overlay2/f913d81219134e23eb0827a1c27668494dfaea2f1b5d1d0c70382366eabed629/diff,workdir=/opt/docker/overlay2/f913d81219134e23eb0827a1c27668494dfaea2f1b5d1d0c70382366eabed629/work)</span><br></pre></td></tr></table></figure><p>ä» docker å®˜æ–¹æ–‡æ¡£ <a href="https://docs.docker.com/storage/storagedriver/overlayfs-driver/" target="_blank" rel="noopener">Use the OverlayFS storage driver</a> é‡Œå·æ¥çš„ä¸€å¼ å›¾ç‰‡</p><p><img src="img/overlay_constructs.jpg" alt="overlayfs lowerdir, upperdir, merged"></p><p>å…³äºä¸Šå›¾ä¸­è¿™äº› Dir çš„ä½œç”¨ï¼Œä¸‹é¢æ˜¯ä¸€æ®µä» <a href="https://stackoverflow.com/questions/56550890/docker-image-merged-diff-work-lowerdir-components-of-graphdriver" target="_blank" rel="noopener">StackOverflow</a> ä¸Šæ¬è¿è¿‡æ¥çš„è§£é‡Šã€‚</p><blockquote><p><strong>LowerDir</strong>: these are the read-only layers of an overlay filesystem. For docker, these are the image layers assembled in order.</p><p><strong>UpperDir</strong>: this is the read-write layer of an overlay filesystem. For docker, that is the equivalent of the container specific layer that contains changes made by that container.</p><p><strong>WorkDir</strong>: this is a required directory for overlay, it needs an empty directory for internal use.</p><p><strong>MergedDir</strong>: this is the result of the overlay filesystem. Docker effectively chrootâ€™s into this directory when running the container.</p></blockquote><p>å¦‚æœæƒ³å¯¹ overlayfs æ–‡ä»¶ç³»ç»Ÿæœ‰è¯¦ç»†çš„äº†è§£ï¼Œå¯ä»¥å‚è€ƒ Linux å†…æ ¸å®˜ç½‘ä¸Šçš„è¿™ç¯‡æ–‡æ¡£ <a href="https://www.kernel.org/doc/Documentation/filesystems/overlayfs.txt" target="_blank" rel="noopener">overlayfs.txt</a> ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><h3 id="å®˜æ–¹æ–‡æ¡£"><a href="#å®˜æ–¹æ–‡æ¡£" class="headerlink" title="å®˜æ–¹æ–‡æ¡£"></a>å®˜æ–¹æ–‡æ¡£</h3><ul><li><a href="https://docs.docker.com/develop/develop-images/baseimages/" target="_blank" rel="noopener">Create a base image</a></li><li><a href="https://hub.docker.com/_/scratch" target="_blank" rel="noopener">FROM scratch</a></li><li><a href="https://docs.docker.com/registry/" target="_blank" rel="noopener">Docker Registry</a></li><li><a href="https://github.com/docker/distribution/blob/master/docs/spec/manifest-v2-2.md" target="_blank" rel="noopener">Image Manifest Version 2, Schema 2</a></li><li><a href="https://docs.docker.com/registry/spec/api/" target="_blank" rel="noopener">Docker Registry HTTP API V2</a></li><li><a href="https://github.com/containers/image" target="_blank" rel="noopener">image</a></li><li><a href="https://github.com/opencontainers/image-spec" target="_blank" rel="noopener">OCI Image Manifest Specification</a></li><li><a href="https://github.com/opencontainers/distribution-spec" target="_blank" rel="noopener">distribution-spec</a></li><li><a href="https://doi-janky.infosiftr.net/job/tianon/job/debuerreotype/" target="_blank" rel="noopener">debuerreotype/</a></li><li><a href="https://www.kernel.org/doc/Documentation/filesystems/overlayfs.txt" target="_blank" rel="noopener">overlayfs.txt</a></li></ul><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><ul><li><a href="https://github.com/docker-library/oi-janky-groovy" target="_blank" rel="noopener">oi-janky-groovy</a></li><li><a href="https://github.com/debuerreotype/docker-debian-artifacts" target="_blank" rel="noopener">docker-debian-artifacts</a></li><li><a href="https://github.com/NotGlop/docker-drag" target="_blank" rel="noopener">docker-drag</a></li><li><a href="https://github.com/deislabs/oras" target="_blank" rel="noopener">oras</a></li><li><a href="https://github.com/containers/skopeo" target="_blank" rel="noopener">skopeo</a></li><li><a href="https://github.com/vbatts/tar-split" target="_blank" rel="noopener">tar-split</a></li></ul><h3 id="åšå®¢"><a href="#åšå®¢" class="headerlink" title="åšå®¢"></a>åšå®¢</h3><ul><li><a href="https://supereagle.github.io/2018/04/24/docker-registry/" target="_blank" rel="noopener">é•œåƒä»“åº“ä¸­é•œåƒå­˜å‚¨çš„åŸç†è§£æ</a></li><li><a href="https://fuckcloudnative.io/posts/how-manage-image/" target="_blank" rel="noopener">docker åœ¨æœ¬åœ°å¦‚ä½•ç®¡ç† imageï¼ˆé•œåƒï¼‰?</a></li><li><a href="http://gaocegege.com/Blog/ormb" target="_blank" rel="noopener">ormbï¼šåƒç®¡ç† Docker å®¹å™¨é•œåƒä¸€æ ·ç®¡ç†æœºå™¨å­¦ä¹ æ¨¡å‹</a></li><li><a href="https://blog.fleeto.us/post/how-are-docker-images-built/" target="_blank" rel="noopener">é•œåƒæ˜¯æ€æ ·ç‚¼æˆçš„</a></li><li><a href="https://duyanghao.github.io/docker-registry-pull-manifest-v2/" target="_blank" rel="noopener">docker pullåˆ†æ</a></li><li><a href="https://github.com/helios741/myblog/blob/new/learn_go/src/2019/20191206_docker_disk_storage/README.md" target="_blank" rel="noopener">æµ…è°ˆdockerä¸­é•œåƒå’Œå®¹å™¨åœ¨æœ¬åœ°çš„å­˜å‚¨</a></li><li><a href="https://www.qedev.com/cloud/103860.html" target="_blank" rel="noopener">å®¹å™¨OCIè§„èŒƒ é•œåƒè§„èŒƒ</a></li><li><a href="https://xuanwo.io/2019/08/06/oci-intro/" target="_blank" rel="noopener">å¼€æ”¾å®¹å™¨æ ‡å‡†(OCI) å†…éƒ¨åˆ†äº«</a></li><li><a href="https://wilhelmguo.cn/blog/post/william/%E5%AE%B9%E5%99%A8%E5%BC%80%E6%94%BE%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83%EF%BC%88CRI-OCI%EF%BC%89-2" target="_blank" rel="noopener">å®¹å™¨å¼€æ”¾æ¥å£è§„èŒƒï¼ˆCRI OCIï¼‰</a></li><li><a href="https://segmentfault.com/a/1190000014284289" target="_blank" rel="noopener">Dockeré•œåƒçš„å­˜å‚¨æœºåˆ¶</a></li><li><a href="http://open.daocloud.io/docker-source-code-analysis-part10/" target="_blank" rel="noopener">Dockeræºç åˆ†æï¼ˆåï¼‰ï¼šDockeré•œåƒä¸‹è½½</a></li><li><a href="http://open.daocloud.io/docker-source-code-analysis-part9/" target="_blank" rel="noopener">Dockeræºç åˆ†æï¼ˆä¹ï¼‰ï¼šDockeré•œåƒ</a></li><li><a href="https://www.twblogs.net/a/5b8aab392b71775d1ce86eca" target="_blank" rel="noopener">docker push éç¨‹ distributionæºç¢¼ åˆ†æ</a></li><li><a href="http://open.daocloud.io/tag/allen-tan-docker/" target="_blank" rel="noopener">Allen è°ˆ Docker</a></li><li><a href="http://open.daocloud.io/shen-ru-li-jie-dockerjing-xiang-jsonwen-jian-2/" target="_blank" rel="noopener">æ·±å…¥ç†è§£ Docker é•œåƒ json æ–‡ä»¶</a></li><li><a href="http://open.daocloud.io/docker-jing-xiang-nei-you-sha-cun-na-ntitled/" target="_blank" rel="noopener">Docker é•œåƒå†…æœ‰å•¥ï¼Œå­˜å“ªï¼Ÿ</a></li><li><a href="http://open.daocloud.io/allen-tan-docker-xi-lie-zhi-shen-ke-li-jie-docker-jing-xiang-da-xiao/" target="_blank" rel="noopener">ç†è§£ Docker é•œåƒå¤§å°</a></li><li><a href="http://open.daocloud.io/allen-tan-docker-xi-lie-zhi-tu-kan-jin-docker-rong-qi-wen-jian-xi-tong/" target="_blank" rel="noopener">çœ‹å°½ docker å®¹å™¨æ–‡ä»¶ç³»ç»Ÿ</a></li><li><a href="https://qhh.me/2019/02/17/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-Docker-%E6%9E%84%E5%BB%BA%E4%B8%8A%E4%B8%8B%E6%96%87/" target="_blank" rel="noopener">æ·±å…¥ç†è§£ Docker æ„å»ºä¸Šä¸‹æ–‡</a></li><li><a href="https://cizixs.com/2017/11/05/oci-and-runc/" target="_blank" rel="noopener">OCI å’Œ runcï¼šå®¹å™¨æ ‡å‡†åŒ–å’Œ docker</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;ä¸Šå‘¨åœ¨å†™&lt;a
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="docker" scheme="https://blog.k8s.li/tags/docker/"/>
    
      <category term="registry" scheme="https://blog.k8s.li/tags/registry/"/>
    
      <category term="image" scheme="https://blog.k8s.li/tags/image/"/>
    
  </entry>
  
  <entry>
    <title>mount å‘½ä»¤ä¹‹ --bind æŒ‚è½½å‚æ•°</title>
    <link href="https://blog.k8s.li/mount-bind.html"/>
    <id>https://blog.k8s.li/mount-bind.html</id>
    <published>2020-06-01T16:00:00.000Z</published>
    <updated>2020-09-15T00:28:09.948Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¿»è½¦ï¼ˆï¼š"><a href="#ç¿»è½¦ï¼ˆï¼š" class="headerlink" title="ç¿»è½¦ï¼ˆï¼š"></a>ç¿»è½¦ï¼ˆï¼š</h2><p>ç”±äºæˆ‘çš„ VPS ä¸æ˜¯å¤§ç›˜é¸¡(å°±æ˜¯å¤§å®¹é‡ç£ç›˜æœºå™¨å•¦ğŸ˜‚)ï¼Œ docker å­˜å‚¨ç›®å½• <code>/var/lib/docker</code> æ‰€åœ¨çš„åˆ†åŒºä¸¥é‡ä¸è¶³ï¼Œäºæ˜¯å°±æƒ³ç€åœ¨ä¸æ”¹å˜ docker é…ç½®çš„ä¸‹å°† <code>/opt</code> ç›®å½•ä¸‹çš„åˆ†åŒºåˆ†é…ç»™ <code>/var/lib/docker</code> ç›®å½•ã€‚é¦–å…ˆæƒ³åˆ°çš„æ˜¯æŠŠ <code>/var/lib/docker</code> å¤åˆ¶åˆ° <code>/opt/docker</code>ï¼Œç„¶åå†å°† <code>/opt/docker</code> è½¯é“¾æ¥åˆ° <code>/var/lib/docker</code> ã€‚</p><p>äºæ˜¯æˆ‘å°±ä¸€é¡¿æ“ä½œçŒ›å¦‚è™ï¼Œ<code>mv /var/lib/docker /opt/docker &amp;&amp; ln -s /opt/docker /var/lib/docker</code> ä¸€æŠŠæ¢­ï¼Œç„¶åæˆ‘å¯åŠ¨ä¸€ä¸ªå®¹å™¨çš„æ—¶å€™å½“åœºå°±ç¿»è½¦äº†ğŸ¤£ã€‚</p><p>åŸæ¥æœ‰äº›ç¨‹åºæ˜¯ä¸æ”¯æŒè½¯é“¾æ¥ç›®å½•çš„ï¼Œè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯è½¯é“¾æ¥çš„è·¯å¾„ä¹Ÿæœ‰ç‚¹å‘ã€‚æ¯”å¦‚æˆ‘å°† <code>/opt/docker -&gt; /var/lib/docker/</code> ï¼Œåœ¨ <code>/var/lib/docker</code> ç›®å½•ä¸‹æ‰§è¡Œ <code>ls ../</code> å³å®ƒçš„ä¸Šä¸€çº§ç›®å½•æ˜¯ <code>/opt</code> è€Œä¸æ˜¯ <code>/var/lib</code> ï¼Œå¯¹äºä¸€äº›ä¾èµ–ç›¸å¯¹è·¯å¾„çš„åº”ç”¨ï¼ˆå°¤å…¶æ˜¯ shell è„šæœ¬ï¼‰æ¥è®²è¿™æ ·ä½¿ç”¨è½¯é“¾æ¥çš„æ–¹å¼ä¹Ÿå®¹æ˜“ç¿»è½¦ğŸ˜‚ã€‚</p><p>é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ›´å¥½çš„åŠæ³•å°†ä¸¤ä¸ªç›®å½•è¿›è¡Œâ€œç¡¬é“¾æ¥â€å‘¢ï¼Œæ³¨æ„æˆ‘åœ¨æ­¤ç”¨çš„æ˜¯åŒå¼•å·ï¼Œå¹¶éæ˜¯çœŸæ­£çš„â€ç¡¬é“¾æ¥â€œï¼Œæœäº†ä¸€åœˆå‘ç° mount â€“bind è¿™ç§éªšæ“ä½œã€‚æ— è®ºæˆ‘ä»¬å¯¹æ–‡ä»¶ä½¿ç”¨è½¯é“¾æ¥/ç¡¬é“¾æ¥/bindï¼Œè¿˜æ˜¯å¯¹ç›®å½•ä½¿ç”¨è½¯é“¾æ¥ï¼Œå…¶å®éƒ½æ˜¯å¸Œæœ›æ“ä½œçš„ <code>src</code> å’Œ <code>dest</code> ä»–ä»¬äºŒè€…éƒ½èƒ½ä¿æŒä¸€è‡´ã€‚é€šè¿‡ bind æŒ‚è½½çš„æ–¹å¼å…·æœ‰ç€æŒ‚è½½ç‚¹çš„ä¸€äº›ç‰¹æ€§ï¼Œè¿™æ˜¯é“¾æ¥æ˜¯ä¸å…·æœ‰çš„ï¼Œå¯¹ä¸€äº›ä¸æ”¯æŒé“¾æ¥çš„åº”ç”¨æ¥è®²ï¼Œbind çš„æ–¹å¼è¦å‹å¥½ä¸€äº›ã€‚</p><h2 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h2><p>å…¶å® bind è¿™ä¸ªæŒ‚è½½é€‰é¡¹æˆ‘ä»¬åœ¨ä½¿ç”¨ docker æˆ–è€… kubernetes å¤šå°‘éƒ½ä¼šç”¨åˆ°çš„ï¼Œå°¤å…¶æ˜¯å½“ä½¿ç”¨ kubernetes  æ—¶ kubelet åœ¨å¯åŠ¨å®¹å™¨æŒ‚è½½å­˜å‚¨çš„æ—¶å€™åº•å±‚æ˜¯å°† node èŠ‚ç‚¹æœ¬æœºçš„ <code>/var/lib/kubelet/pods/&lt;Podçš„ID&gt;/volumes/kubernetes.io~&lt;Volumeç±»å‹&gt;/&lt;Volumeåå­—&gt;</code> ç›®å½•é€šè¿‡ bind çš„æ–¹å¼æŒ‚è½½åˆ°å®¹å™¨ä¸­çš„ï¼Œè¯¦ç»†çš„åˆ†æå¯ä»¥å‚è€ƒä¹‹å‰æˆ‘å†™çš„ä¸€ç¯‡åšå®¢ <a href="https://blog.k8s.li/kubelet-mount-volumes-analysis.html">kubelet æŒ‚è½½ volume åŸç†åˆ†æ</a> ã€‚</p><blockquote><ul><li><strong>Volumes</strong> are stored in a part of the host filesystem which is <em>managed by Docker</em> (<code>/var/lib/docker/volumes/</code> on Linux). Non-Docker processes should not modify this part of the filesystem. Volumes are the best way to persist data in Docker.</li><li><strong>Bind mounts</strong> may be stored <em>anywhere</em> on the host system. They may even be important system files or directories. Non-Docker processes on the Docker host or a Docker container can modify them at any time.</li><li><strong><code>tmpfs</code> mounts</strong> are stored in the host systemâ€™s memory only, and are never written to the host systemâ€™s filesystem.</li></ul></blockquote><p>ä¸è¿‡é‚£æ—¶å€™å¹¶æ²¡æœ‰è¯¦ç»†åœ°å»äº†è§£ bind çš„åŸç†ï¼Œç›´åˆ°æœ€è¿‘ç¿»äº†ä¸€æ¬¡è½¦æ‰æƒ³èµ·æ¥ bind ï¼Œäºæ˜¯æ¥ä¸‹æ¥å°±è¯¦ç»†åœ°åˆ†æä»¥ä¸‹ mount â€“bind æŒ‚è½½å‚æ•°ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨è½¯é“¾æ¥é“¾æ¥ç›®å½•</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls -i æ˜¾ç¤ºæ–‡ä»¶/ç›®å½•çš„ inode å·</span></span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ln -s /opt/docker /var/lib/docker</span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ls -i /opt | grep docker</span><br><span class="line">2304916 docker</span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ls -i /var/lib | grep docker</span><br><span class="line">    211 docker</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨ç¡¬é“¾æ¥é“¾æ¥ä¸¤ä¸ªæ–‡ä»¶</span></span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ln /usr/local/bin/docker-compose /usr/bin/docker-compose</span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ls -i /usr/bin/docker-compose</span><br><span class="line">112 /usr/bin/docker-compose</span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ls -i /usr/bin/docker-compose</span><br><span class="line">112 /usr/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨ --<span class="built_in">bind</span> æŒ‚è½½ç›®å½•</span></span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# mount --bind /opt/docker /var/lib/docker</span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ls -i /var/lib | grep docker</span><br><span class="line">2304916 docker</span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ls -i /opt | grep docker</span><br><span class="line">2304916 docker</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“ä½¿ç”¨ä½¿ç”¨ç¡¬é“¾æ¥æˆ– bind æŒ‚è½½ç›®å½•æ—¶ï¼Œä¸¤ä¸ªæ–‡ä»¶ inode å·æ˜¯ç›¸åŒçš„ï¼Œä½¿ç”¨è½¯é“¾æ¥çš„ä¸¤ä¸ªæ–‡ä»¶çš„ inode å·æ˜¯ä¸åŒçš„ã€‚ä½†ç›®å½•åˆä¸èƒ½ä½¿ç”¨ç¡¬é“¾æ¥ï¼Œè€Œä¸”ç¡¬é“¾æ¥ä¸æ”¯æŒè·¨åˆ†åŒºã€‚æˆ‘ä»¬æ˜¯å¦å¯ä»¥å°† bind çš„æ•ˆæœå’Œ<br>â€œç¡¬é“¾æ¥ç›®å½•â€œ æ ·æ¥ä½¿ç”¨å‘¢ï¼Ÿå…¶å®å¯ä»¥è¿™æ ·ç”¨ï¼Œä½†è¿™æ ·ç±»æ¯”å¹¶ä¸ä¸¥è°¨ã€‚</p><p>å½“æˆ‘ä»¬ä½¿ç”¨ bind çš„æ—¶å€™ï¼Œæ˜¯å°†ä¸€ä¸ªç›®å½• A  æŒ‚è½½åˆ°å¦ä¸€ä¸ªç›®å½• B ï¼Œç›®å½• B åŸæœ‰çš„å†…å®¹å°±è¢«å±â€è”½æ‰â€œäº†ï¼Œç›®å½• B é‡Œé¢çš„å†…å®¹å°±æ˜¯ç›®å½• A é‡Œé¢çš„å†…å®¹ã€‚è¿™å’Œæˆ‘ä»¬æŒ‚åœ¨å…¶ä»–åˆ†åŒºåˆ°æŒ‚è½½ç‚¹ç›®å½•ä¸€æ ·ï¼Œç›®å½• B çš„å†…å®¹è¿˜æ˜¯å­˜åœ¨çš„ï¼Œåªä¸è¿‡æ˜¯è¢«â€å±è”½â€œæ‰äº†ï¼Œå½“æˆ‘ä»¬ umount B åï¼ŒåŸå†…å®¹å°±ä¼šå¤ç°ã€‚</p><p>å½“æˆ‘ä»¬ä½¿ç”¨ <code>docker run -v PATH:PATH</code> å¯åŠ¨ä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ï¼Œå®è´¨ä¸Šä¹Ÿæ˜¯ä¼šç”¨åˆ° <code>bind</code>ï¼Œdocker ä¼šå°†ä¸»æœºçš„ç›®å½•é€šè¿‡ <code>bind</code> çš„æ–¹å¼æŒ‚è½½åˆ°å®¹å™¨ç›®å½•ã€‚ä¸‹é¢æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ª alpine å®¹å™¨æ¥å®éªŒä¸€ä¸‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run --name alpine -v /opt/bind/:/var --privileged --rm -it alpine sh</span><br><span class="line">docker inspect alpine</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">"Mounts": [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"Type"</span>: <span class="string">"bind"</span>,</span><br><span class="line">        <span class="attr">"Source"</span>: <span class="string">"/opt/bind"</span>,</span><br><span class="line">        <span class="attr">"Destination"</span>: <span class="string">"/var"</span>,</span><br><span class="line">        <span class="attr">"Mode"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="attr">"RW"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"Propagation"</span>: <span class="string">"rprivate"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>åœ¨å®¹å™¨å†…ä½¿ç”¨ umount å‘½ä»¤å¸è½½æ‰ <code>/var</code> ï¼Œumount æ“ä½œéœ€è¦ root æƒé™ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™åŠ ä¸Š <code>--privileged</code> å‚æ•°æ¥å¯åŠ¨ä¸€ä¸ªç‰¹æƒå®¹å™¨çš„åŸå› ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/ # ls /var/</span><br><span class="line">74898710_p21.jpg    MJSTEALEY.md        docker-compose.yml  letsencrypt         resolv.conf</span><br><span class="line">CONSOLE.md          README.md           hostname            logs                stop-and-remove.sh</span><br><span class="line">LICENSE             config              hosts               nginx               webp-server</span><br><span class="line">/ # umount /var/</span><br><span class="line"><span class="meta">#</span><span class="bash"> umount ä¹‹åå®¹å™¨å†…åŸæ¥çš„ /var ç›®å½•å†…å®¹<span class="string">"æ¢å¤"</span>äº†</span></span><br><span class="line">/ # ls /var/</span><br><span class="line">cache  empty  lib    local  lock   log    mail   opt    run    spool  tmp</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–ç”¨å¤„ğŸ¤”"><a href="#å…¶ä»–ç”¨å¤„ğŸ¤”" class="headerlink" title="å…¶ä»–ç”¨å¤„ğŸ¤”"></a>å…¶ä»–ç”¨å¤„ğŸ¤”</h2><h3 id="æ— ç¼æ›´æ–°-Webp-Server-Go"><a href="#æ— ç¼æ›´æ–°-Webp-Server-Go" class="headerlink" title="æ— ç¼æ›´æ–° Webp Server Go"></a>æ— ç¼æ›´æ–° Webp Server Go</h3><p>åœ¨ <a href="">å°åœŸè±†</a>ã€<a href="">Nona</a> å¤§ä½¬è®¨è®º <a href="">Webp Server Go</a> æ— ç¼æ›´æ–°çš„æ—¶å€™æˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªæ€è·¯ï¼š</p><blockquote><ul><li><p>åœ¨æ›´æ–°ä¹‹å‰å…ˆå¯¹ nginx é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œå»æ‰ webp server çš„ location å­—æ®µï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~* \.(png|jpg|jpeg)$</span> &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://127.0.0.1:3333;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> HOST <span class="variable">$http_host</span>;</span><br><span class="line">    <span class="attribute">add_header</span> Cache-Control <span class="string">'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç„¶åå† nginx -s reload ä¸ä¸­æ–­ reload ä¸€</p></li><li><p>æ¥ç€åœæ‰ webp server æœåŠ¡ <code>systemctl stop webps</code></p></li><li><p>mv webp-server{.bak,}</p></li><li><p>mv ./upload/webp-server-linux-amd64 webp-server</p></li><li><p>æ¥ç€å¯åŠ¨ webp server æœåŠ¡ <code>systemctl start webps</code></p></li><li><p>ç„¶åå¼€å€’è½¦æŠŠ nginx é…ç½®æ–‡ä»¶å†æ”¹å›å»ğŸ</p></li></ul></blockquote><p>åœ¨æ­¤éœ€è¦æå‡ ç‚¹ï¼Œæˆ‘ä»¬å¸Œæœ›<strong>æ— ç¼æ›´æ–°</strong>ï¼Œå³åœ¨æ›´æ–°çš„è¿‡ç¨‹ä¸­ä¸ä¼šå¯¼è‡´ç”¨æˆ·è¯·æ±‚å›¾ç‰‡èµ„æºå¤±è´¥ï¼Œé‚£æ€• <code>+1s</code>éƒ½ä¸è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æš‚æ—¶æ€§åœ°åœ¨ nginx é…ç½®æ–‡ä»¶é‡Œå»æ‰ webp server ï¼Œä½¿å®ƒå»è¯·æ±‚åŸå›¾ç‰‡ï¼Œç­‰æ›´æ–°å®Œ webp server ä¹‹åå†æ·»åŠ ä¸Šå»ã€‚</p><p>å¯¹äºæœ¨å­è¿™ç§ç»å¸¸åˆ åº“è·‘è·¯çš„æ‰‹æ®‹èœé¸Ÿæ¥è®²ï¼Œå¯¹ä¸€ä¸ªé…ç½®æ–‡ä»¶æ”¹æ¥æ”¹å»ä¸æ˜¯å¥½æ–¹æ³•ï¼Œä¸‡ä¸€ nginx é…ç½®æ–‡ä»¶æ”¹æ¥æ”¹å»æ²¡æ”¹å¥½ï¼Œ nginx -s reload ä¸€ä¸‹ nginx æœåŠ¡å°±ç‚¸äº†ğŸ˜‚ã€‚é‚£ä¹ˆä½¿ç”¨ cp å’Œ mv æ€ä¹ˆæ ·ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cp blog.conf&#123;,.bak&#125;</span><br><span class="line">vim blog.conf</span><br><span class="line">nginx -s reload</span><br><span class="line">- update webp server</span><br><span class="line">mv blog.conf&#123;,.bak2&#125;</span><br><span class="line">mv blog.conf&#123;.bak,&#125;</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ bind å‘¢ï¼Ÿå¥½åƒå°‘äº†ä¸€æ­¥ï¼Œä¸‹æ¬¡æ›´æ–° webp server çš„æ—¶å€™åªéœ€è¦ umount ä¸€ä¸‹ï¼Œæ›´æ–°å®Œä¹‹åå† mount ä¸€ä¸‹å°±å¯ä»¥å•¦ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cp blog.conf&#123;,.bak&#125;</span><br><span class="line">vim blog.conf</span><br><span class="line">nginx -s reload</span><br><span class="line">- update webp server</span><br><span class="line">mount --bind blog.conf.bak blohg.conf</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><h3 id="VPS-æ¬å®¶åŠ©æ‰‹"><a href="#VPS-æ¬å®¶åŠ©æ‰‹" class="headerlink" title="VPS æ¬å®¶åŠ©æ‰‹"></a>VPS æ¬å®¶åŠ©æ‰‹</h3><p>å…¶å®è¿˜æœ‰å¾ˆå¤šç”¨é€”å•¦ï¼Œè¿™é‡Œå°±ä¸ç½—åˆ—äº†</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;ç¿»è½¦ï¼ˆï¼š&quot;&gt;&lt;a href=&quot;#ç¿»è½¦ï¼ˆï¼š&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="linux" scheme="https://blog.k8s.li/tags/linux/"/>
    
      <category term="overlay2" scheme="https://blog.k8s.li/tags/overlay2/"/>
    
      <category term="docker" scheme="https://blog.k8s.li/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>é•œåƒæ¬è¿å·¥ skopeo åˆä½“éªŒ</title>
    <link href="https://blog.k8s.li/skopeo.html"/>
    <id>https://blog.k8s.li/skopeo.html</id>
    <published>2020-05-26T16:00:00.000Z</published>
    <updated>2020-05-28T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ¬ç –å·¥å…·"><a href="#æ¬ç –å·¥å…·" class="headerlink" title="æ¬ç –å·¥å…·"></a>æ¬ç –å·¥å…·</h2><p>ä¸Šå‘¨æœ«çš„æ—¶å€™æ›´æ–°å®Œä¸€ç¯‡ã€Šæœ¨å­çš„æ¬ç –å·¥å…·ğŸ˜‚ã€‹ï¼Œæœ€è¿‘å› ä¸ºé¡¹ç›®éœ€æ±‚åˆå‘ç°äº†ä¸ªæ¬ç –å·¥å…·ï¼Œæ‰€ä»¥æ¥æ°´ç¯‡åšå®¢åˆ†äº«ç»™å¤§å®¶ã€‚</p><blockquote><p>  æˆ‘å¸é¡¹ç›®ç»„ä¸­çš„ä¸€ä¸ªéœ€æ±‚å°±æ˜¯ï¼šåœ¨ä¸€å°æœºå™¨ä¸Šå» pull ä¸€ä¸ªé•œåƒåˆ—è¡¨ä¸­çš„é•œåƒï¼Œè¿™äº›é•œåƒå­˜å‚¨åœ¨ registry A Harbor ä¸Šï¼Œpull å®Œè¿™äº›é•œåƒä¹‹åé‡æ–°æ‰“ä¸Š tag ç„¶åå† push åˆ°å¦ä¸€ä¸ª registry B Harbor  ä¸Šå»ã€‚ç›¸å½“äºä¸€ä¸ªåŒæ­¥é•œåƒæ“ä½œï¼Œä½†å’Œ harbor é‡Œåœ¨å¸¦çš„é‚£ä¸ªé•œåƒåŒæ­¥è¿˜æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œæˆ‘ä»¬ä»…ä»…éœ€è¦åŒæ­¥ç‰¹å®š tag çš„é•œåƒï¼Œè€Œä¸æ˜¯æ•´ä¸ª harbor æˆ–è€… project é‡Œçš„å…¨éƒ¨é•œåƒã€‚ç›®å‰æˆ‘ä»¬çš„åšæ³•è¿˜æ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼Œä½¿ç”¨ docker å‘½ä»¤è¡Œçš„æ–¹å¼æ¥ pull é•œåƒï¼Œç„¶åæ‰“ tag æ¥ç€ push åˆ° B harborã€‚ä½†æ˜¯å•Šï¼Œå½“åŒæ­¥äºŒä¸‰ç™¾ä¸ªçš„é•œåƒï¼Œæˆ–è€…é•œåƒçš„æ€»å¤§å°å‡ å GB çš„æ—¶å€™è¿™ç§åŸå§‹çš„æ–¹æ³•é€Ÿåº¦è¿˜æ˜¯å¤ªæ…¢äº†ï¼Œäºæ˜¯å°±æ€è€ƒæœ‰æ²¡æœ‰å¦ä¸€ä¸ªå·¥å…·å¯ä»¥ç›´æ¥å°† registry A ä¸­çš„æŸä¸ªé•œåƒåŒæ­¥åˆ° registry B ä¸­å»ã€‚</p></blockquote><p>ä¹‹å‰æˆ‘çœ‹åˆ°è¿‡ <a href="https://mritd.me/" target="_blank" rel="noopener">æ¼ ç„¶å¤§ä½¬</a> å†™çš„åšå®¢<a href="https://mritd.me/2020/03/31/how-to-download-docker-image-without-docker/" target="_blank" rel="noopener">ã€Šå¦‚ä½•ä¸é€šè¿‡ docker ä¸‹è½½ docker imageã€‹</a> ï¼Œäºæ˜¯å’±ä¹Ÿå°±ä¸Šæ‰‹è¯•ä¸€ä¸‹è¿™ä¸ªå·¥å…·çœ‹çœ‹èƒ½ä¸èƒ½å¸®å’±æ¬ç‚¹ç –ğŸ˜‚ã€‚ç»“åˆè¿™ä¸ªå·¥å…·çš„ä½¿ç”¨ï¼Œåˆä¸€æ¬¡åŠ æ·±äº†å¯¹å®¹å™¨é•œåƒåˆ†å‘å­˜å‚¨çš„äº†è§£ï¼Œæ”¶è·é¢‡ä¸°ğŸ˜‹</p><h3 id="image"><a href="#image" class="headerlink" title="image"></a>image</h3><p>å…³äºé•œåƒçš„è¯¦ç»†åˆ†æå¯ä»¥å‚è€ƒ <a href="https://github.com/helios741/myblog/tree/new/learn_go/src/2019/20191206_docker_disk_storage" target="_blank" rel="noopener">æµ…è°ˆdockerä¸­é•œåƒå’Œå®¹å™¨åœ¨æœ¬åœ°çš„å­˜å‚¨</a></p><h3 id="registry"><a href="#registry" class="headerlink" title="registry"></a>registry</h3><p>æ ¹æ® <a href="https://supereagle.github.io/" target="_blank" rel="noopener">Robin</a> å¤§ä½¬åœ¨ <a href="https://supereagle.github.io/2018/04/24/docker-registry/" target="_blank" rel="noopener">é•œåƒä»“åº“ä¸­é•œåƒå­˜å‚¨çš„åŸç†è§£æ</a> æ–‡ç« é‡Œå¾—å‡ºçš„ç»“è®ºï¼š</p><blockquote><ul><li>é€šè¿‡ Registry API è·å¾—çš„ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ manifest ä¿¡æ¯å®Œå…¨ç›¸åŒã€‚</li><li>ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ manifest ä¿¡æ¯çš„å­˜å‚¨è·¯å¾„å’Œå†…å®¹å®Œå…¨ç›¸åŒã€‚</li><li>ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ blob ä¿¡æ¯çš„å­˜å‚¨è·¯å¾„å’Œå†…å®¹å®Œå…¨ç›¸åŒã€‚</li></ul></blockquote><h3 id="docker-pull-å’Œ-docker-push"><a href="#docker-pull-å’Œ-docker-push" class="headerlink" title="docker pull å’Œ docker push"></a>docker pull å’Œ docker push</h3><p>ä¹‹æ‰€ä»¥æƒ³ä½¿ç”¨ skopeo æ›¿ä»£åŸæœ‰ä½¿ç”¨ docker pull â€“&gt; docker tag â€“&gt; docker push çš„æ“ä½œï¼Œæ˜¯å› ä¸º docker pull é•œåƒçš„æ—¶å€™ï¼Œregistry ä¸­å­˜å‚¨çš„é•œåƒ layer æ ¼å¼æ˜¯ <code>vnd.docker.image.rootfs.diff.tar.gzip</code> ï¼Œè¿™æ˜¯ä¸€ä¸ª tar.gz ç±»å‹çš„æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æœ¬åœ°æ­å»ºä¸€ä¸ª harbor ï¼Œå¹¶å‘ harbor æ¨é€ä¸€ä¸ª alpine:latest é•œåƒï¼Œæ¥åˆ†æä¸€ä¸‹é•œåƒæ˜¯å¦‚ä½•åœ¨ registry ä¸­å­˜å‚¨çš„ã€‚</p><ul><li>harbor çš„å­˜å‚¨ç›®å½•</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">tree</span><br><span class="line">`-- registry</span><br><span class="line">    `-- v2      # registry V2 ç‰ˆæœ¬</span><br><span class="line">        |-- blobs # blobs ç›®å½•ä¸‹å­˜å‚¨é•œåƒçš„ raw æ•°æ®ï¼Œå­˜å‚¨çš„æœ€å°å•å…ƒä¸º layer</span><br><span class="line">        |   `-- sha256</span><br><span class="line">        |       |-- 39</span><br><span class="line">        |       |-- cb</span><br><span class="line">        |       `-- f7</span><br><span class="line">        `-- repositories # é•œåƒçš„å…ƒæ•°æ®ä¿¡æ¯</span><br><span class="line">            `-- library</span><br><span class="line">                `-- alpine</span><br></pre></td></tr></table></figure><ul><li>é•œåƒçš„ <a href="https://github.com/opencontainers/image-spec/blob/master/manifest.md" target="_blank" rel="noopener">manifest</a> æ˜¯é’ˆå¯¹registryæœåŠ¡ç«¯çš„é…ç½®ä¿¡æ¯</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sh-4.2# skopeo inspect docker://index.docker.io/library/alpine:latest --raw</span><br><span class="line">&#123;</span><br><span class="line">   "schemaVersion": 2,</span><br><span class="line">   "mediaType": "application/vnd.docker.distribution.manifest.v2+json",</span><br><span class="line">   "config": &#123;</span><br><span class="line">      "mediaType": "application/vnd.docker.container.image.v1+json",</span><br><span class="line">      "size": 1507,</span><br><span class="line">      "digest": "sha256:f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a"</span><br><span class="line">   &#125;,</span><br><span class="line">   "layers": [</span><br><span class="line">      &#123;</span><br><span class="line">         "mediaType": "application/vnd.docker.image.rootfs.diff.tar.gzip",</span><br><span class="line">         "size": 2813316,</span><br><span class="line">         "digest": "sha256:cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08"</span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä»”ç»†çœ‹ä¸€ä¸‹ <code>digest</code> å’Œä¸‹é¢æ–‡ä»¶å¤¹çš„åç§°ï¼Œä»–ä»¬æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå› ä¸º manifest ä¿¡æ¯å°±æ˜¯é•œåƒåœ¨ registry ä¸­å­˜å‚¨çš„ä¿¡æ¯ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">tree</span><br><span class="line">|-- [  20]  blobs</span><br><span class="line">|   `-- [  36]  sha256</span><br><span class="line">|       |-- [  78]  39</span><br><span class="line">|       |   `-- [  18]  39eda93d15866957feaee28f8fc5adb545276a64147445c64992ef69804dbf01</span><br><span class="line">|       |       `-- [ 528]  data</span><br><span class="line">|       |-- [  78]  cb</span><br><span class="line">|       |   `-- [  18]  cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08</span><br><span class="line">|       |       `-- [2.7M]  data </span><br><span class="line">|       `-- [  78]  f7</span><br><span class="line">|           `-- [  18]  f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span><br><span class="line">|               `-- [1.5K]  data</span><br><span class="line">`-- [  21]  repositories</span><br><span class="line">    `-- [  20]  library</span><br><span class="line">        `-- [  55]  alpine</span><br><span class="line">            |-- [  20]  _layers</span><br><span class="line">            |   `-- [ 150]  sha256</span><br><span class="line">            |       |-- [  18]  cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08</span><br><span class="line">            |       |   `-- [  71]  link</span><br><span class="line">            |       `-- [  18]  f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span><br><span class="line">            |           `-- [  71]  link</span><br><span class="line">            |-- [  35]  _manifests</span><br><span class="line">            |   |-- [  20]  revisions</span><br><span class="line">            |   |   `-- [  78]  sha256</span><br><span class="line">            |   |       `-- [  18]  39eda93d15866957feaee28f8fc5adb545276a64147445c64992ef69804dbf01</span><br><span class="line">            |   |           `-- [  71]  link</span><br><span class="line">            |   `-- [  20]  tags</span><br><span class="line">            |       `-- [  34]  latest</span><br><span class="line">            |           |-- [  18]  current</span><br><span class="line">            |           |   `-- [  71]  link</span><br><span class="line">            |           `-- [  20]  index</span><br><span class="line">            |               `-- [  78]  sha256</span><br><span class="line">            |                   `-- [  18]  39eda93d15866957feaee28f8fc5adb545276a64147445c64992ef69804dbf01</span><br><span class="line">            |                       `-- [  71]  link</span><br><span class="line">            `-- [   6]  _uploads</span><br><span class="line"></span><br><span class="line">26 directories, 8 files</span><br></pre></td></tr></table></figure><ul><li>æˆ‘ä»¬å»çœ‹ä¸€ä¸‹ <code>[2.7M]  data</code>  è¿™ä¸ªæ–‡ä»¶ï¼Œå…¶ä»–æ–‡ä»¶ä¼°è®¡æ˜¯ä¸€äº› json æ–‡æœ¬ç”¨äºä¿å­˜å…ƒæ•°æ®ä¿¡æ¯ã€‚ä½¿ç”¨ file å‘½ä»¤æŸ¥çœ‹ blobs/sha256/cb/cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08 ç›®å½•ä¸‹çš„ <code>data</code> æ–‡ä»¶ã€‚é•œåƒçš„æ¯ä¸€å±‚éƒ½æ˜¯å­˜æ”¾åœ¨ä¸€ä¸ª 64 ä½é•¿åº¦åç§°çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–‡ä»¶åå°±æ˜¯ <code>data</code> ã€‚è€Œä¸”è¿™ä¸ªæ–‡ä»¶è¿˜æ˜¯ä¸ª gzip å‹ç¼©åçš„æ–‡ä»¶ã€‚æˆ‘ä¹ˆå¯ä»¥ä½¿ç”¨ tar å‘½ä»¤å°†å…¶è§£å‹å¼€æ¥ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd registry/v2/blobs/sha256/cb/cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08</span><br><span class="line">sh-4.2# file data</span><br><span class="line">data: gzip compressed data</span><br><span class="line">sh-4.2# mkdir layer</span><br><span class="line">sh-4.2# tar -xvf data -C layer/</span><br></pre></td></tr></table></figure><ul><li>å°†å…¶è§£å‹åˆ° layer ç›®å½•ä¸‹ï¼Œä½¿ç”¨ tree å‘½ä»¤çœ‹ä¸€ä¸‹æ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹å°±ä¼šæ˜ç™½ï¼Œè¿™ä¸å°±æ˜¯æˆ‘ä»¬çš„ alpine é•œåƒçœŸå®çš„å†…å®¹å˜›ğŸ˜‚ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sh-4.2# tree -L 1 -d layer</span><br><span class="line">layer</span><br><span class="line">|-- bin</span><br><span class="line">|-- dev</span><br><span class="line">|-- etc</span><br><span class="line">|-- home</span><br><span class="line">|-- lib</span><br><span class="line">|-- media</span><br><span class="line">|-- mnt</span><br><span class="line">|-- opt</span><br><span class="line">|-- proc</span><br><span class="line">|-- root</span><br><span class="line">|-- run</span><br><span class="line">|-- sbin</span><br><span class="line">|-- srv</span><br><span class="line">|-- sys</span><br><span class="line">|-- tmp</span><br><span class="line">|-- usr</span><br><span class="line">`-- var</span><br></pre></td></tr></table></figure><p>çŸ¥é“äº†é•œåƒåœ¨ registry ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Œæˆ‘ä»¬ä¹Ÿå°±èƒ½å¤Ÿæ˜ç™½åœ¨å½“å‰ä»…ä»…ä¸ºäº†åŒæ­¥ä¸¤ä¸ª registry ä¸Šçš„é•œåƒä½¿ç”¨ docker pull â€“&gt; docker tag â€“&gt; docker push æ“ä½œçš„å¼Šç«¯ã€‚å› ä¸º docker pull é•œåƒæ—¶ä¼šå¯¹ registry ä¸Šçš„ layer è¿›è¡Œè§£å‹ç¼©ï¼Œè¿™ä¸€ç‚¹å’Œæˆ‘ä»¬çš„æµè§ˆå™¨è§£å‹ç¼©ä¸€äº›  gzip å‹ç¼©çš„èµ„æºä¸€æ ·é“ç†ï¼Œä¸ºäº†å‡å°‘ç½‘ç»œä¼ è¾“çš„æµé‡ã€‚å½“æˆ‘ä»¬ pull é•œåƒçš„æ—¶å€™ï¼Œdocker ä¼šæœ‰ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹å¯¹é•œåƒè¿›è¡Œè§£å‹ç¼©ï¼Œåœ¨ä½¿ç”¨ docker pull æ‹‰å–é•œåƒçš„æ—¶å€™ä½¿ç”¨ ps æŸ¥çœ‹ä¸€ä¸‹è¿›ç¨‹å°±ä¼šæ‰¾åˆ° <code>docker-untar</code>  è¿™ä¸ªè¿›ç¨‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-untar /var/lib/docker/overlay2/a076db6567c7306f3cdab6040cd7d083ef6a39d125171353eedbb8bde7f203b4/diff</span><br></pre></td></tr></table></figure><p>å¯¹äºä¸€äº›å¾ˆå¤§çš„é•œåƒæ¯”å¦‚ 2GB ä»¥ä¸Šï¼Œæœ‰æ—¶å€™é•œåƒ layer å·²ç» download å®Œäº†ï¼Œä½†æ˜¯è¿˜åœ¨è¿›è¡Œé•œåƒçš„è§£å‹ç¼©ï¼Œæ€§èƒ½çš„ç“¶é¢ˆä¹Ÿå°±åœ¨äº†è§£å‹é•œåƒè¿™ä¸€å—ã€‚å¯¹äº docker push æ¥è®²ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p>æœ‰æ²¡æœ‰ä¸€ç§åŠæ³•å¯ä»¥ç›´æ¥å°† registry ä¸Šçš„ blob å¤åˆ¶åˆ°å¦ä¸€ä¸ª registryï¼Œä¸­é—´è¿‡ç¨‹ä¸æ¶‰åŠå¯¹é•œåƒ layer çš„è§£å‹ç¼©ï¼Œè¿™å²‚ä¸ç¾å“‰ğŸ˜‚ã€‚</p><h2 id="skopeo-install"><a href="#skopeo-install" class="headerlink" title="skopeo install"></a>skopeo install</h2><h3 id="yum-dnf-zypper-brew"><a href="#yum-dnf-zypper-brew" class="headerlink" title="yum/dnf/zypper/brew"></a>yum/dnf/zypper/brew</h3><p>å®‰è£…æ–¹å¼å¾ˆç®€å•ï¼Œå¯¹äºå¸¸è§çš„å‘ç›¸ä¼´ç›´æ¥ install ä¸€æŠŠæ¢­å°±è¡Œï¼Œä»å®˜æ–¹æ–‡æ¡£å·æ¥çš„å®‰è£…æ–¹å¼ğŸ˜‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo dnf install skopeo</span></span><br></pre></td></tr></table></figure><p>on RHEL/CentOS â‰¤ 7.x:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install skopeo</span></span><br></pre></td></tr></table></figure><p>for openSUSE:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo zypper install skopeo</span></span><br></pre></td></tr></table></figure><p>on alpine:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apk add skopeo</span></span><br></pre></td></tr></table></figure><p>on macOS:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> brew install skopeo</span></span><br></pre></td></tr></table></figure><h3 id="build"><a href="#build" class="headerlink" title="build"></a>build</h3><p>ç”±äºæˆ‘çš„ VPS æœºå™¨æ˜¯ Ubuntu 1804 çš„ OS ï¼Œé…ç½® apt æºå¹¶æ²¡æˆåŠŸï¼Œå½“åœºç¿»è½¦ã€‚ä¸ºäº†èƒ½å¤Ÿå¿«é€Ÿä½“éªŒä¸€æŠŠè¿˜æ˜¯æœ¬åœ°èµ·ä¸€ä¸ª alpine å®¹å™¨ï¼Œåœ¨ alpine é‡Œé€šè¿‡ apk add çš„æ–¹å¼å®‰è£… skopeoã€‚ä½† alpine é‡Œçš„ skopeo ç‰ˆæœ¬ è¿˜æ˜¯ 0.14.0 ğŸ˜¥ï¼ŒGitHub ä¸Šçš„ master åˆ†æ”¯å·²ç» 1.0.0äº†ï¼Œè€Œä¸”å¹¶æ²¡æœ‰ sync çš„é€‰é¡¹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/ # skopeo --help</span><br><span class="line">NAME:</span><br><span class="line">   skopeo - Various operations with container images and container image registries</span><br><span class="line">USAGE:</span><br><span class="line">   skopeo [global options] command [command options] [arguments...]</span><br><span class="line">VERSION:</span><br><span class="line">   0.1.40</span><br><span class="line">COMMANDS:</span><br><span class="line">     copy               Copy an IMAGE-NAME from one location to another</span><br><span class="line">     inspect            Inspect image IMAGE-NAME</span><br><span class="line">     delete             Delete image IMAGE-NAME</span><br><span class="line">     manifest-digest    Compute a manifest digest of a file</span><br><span class="line">     standalone-sign    Create a signature using local files</span><br><span class="line">     standalone-verify  Verify a signature using local files</span><br><span class="line">     help, h            Shows a list of commands or help for one command</span><br></pre></td></tr></table></figure><p>çœŸæ˜¯ä¸€æ³¢ä¸‰æŠ˜å•Šï¼Œç»•äº†ä¸€åœˆæœ€ç»ˆè¿˜æ˜¯äº²è‡ª<del>æŒ‡æŒ¥</del> build ä¸€ä»½å§ï¼Œä¸è¿‡è¿™ä¸ª build è¿‡ç¨‹ä¹Ÿå¾ˆç®€å•ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/containers/skopeo skopeo</span><br><span class="line">cd !$</span><br><span class="line">git checkout v1.0.0</span><br><span class="line">make binary-static DISABLE_CGO=1</span><br><span class="line">cp skopeo /usr/bin/</span><br></pre></td></tr></table></figure><ul><li>åœ¨è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœæ±æƒ³æ„å»ºä¸€ä¸ªåœ¨å„ Linux å‘è¡Œç‰ˆé€šç”¨çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸€å®šè¦ä½¿ç”¨ <code>make binary-static DISABLE_CGO=1</code> ï¼Œä¹‹å‰æˆ‘æ²¡æœ‰ä»”ç»†çœ‹æ–‡æ¡£ç›´æ¥ make ä¸€æŠŠæ¢­ï¼Œç„¶ååœ¨ Ubuntu ä¸Šæ„å»ºå‡ºæ¥çš„äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶æ‹¿åˆ° CentOS ä¸Šå»ç”¨ï¼Œå½“åœºç¿»è½¦æç¤ºä»¥ä¸‹é”™è¯¯ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">skopeo: error while loading shared libraries: libdevmapper.so.1.02.1: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure><ul><li>ç„¶åæˆ‘å‚»ä¹ä¹åœ°å»å®‰è£… CentOS ä¸Šçš„è¿™ä¸ªåº“ï¼Œä½†è¿˜æ˜¯æç¤º <code>libdevmapper.so.1.02.1</code> ä¸å­˜åœ¨ã€‚å› ä¸º Ubuntu ä¸Šçš„è¿™ä¸ªåº“å’Œ CentOS ä¸Šçš„è¿™ä¸ªåº“æ˜¯ä¸ä¸€æ ·åç§°çš„ğŸ˜‘ã€‚æ‰€ä»¥è¯´è¦åœ¨ç¼–è¯‘çš„æ—¶å€™åŠ ä¸Š <code>DISABLE_CGO=1</code> è¿™ä¸ªå‚æ•°è¿›è¡Œé™æ€é“¾æ¥ç¼–è¯‘ï¼Œè¿™æ ·ç¼–è¯‘å‡ºæ¥çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶å°±å¯ä»¥åœ¨ Linux å‘è¡Œç‰ˆä¹‹é—´é€šç”¨äº†ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ldd skopeo_d #</span><br><span class="line">        linux-vdso.so.1 (0x00007ffed9e66000)</span><br><span class="line">        libgpgme.so.11 =&gt; /usr/lib/x86_64-linux-gnu/libgpgme.so.11 (0x00007f94aed2e000)</span><br><span class="line">        libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f94aeb0f000)</span><br><span class="line">        libdevmapper.so.1.02.1 =&gt; /lib/x86_64-linux-gnu/libdevmapper.so.1.02.1 (0x00007f94ae8a4000)</span><br><span class="line">        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f94ae4b3000)</span><br><span class="line">        libassuan.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libassuan.so.0 (0x00007f94ae2a0000)</span><br><span class="line">        libgpg-error.so.0 =&gt; /lib/x86_64-linux-gnu/libgpg-error.so.0 (0x00007f94ae08b000)</span><br><span class="line">        /lib64/ld-linux-x86-64.so.2 (0x00007f94b0ac4000)</span><br><span class="line">        libselinux.so.1 =&gt; /lib/x86_64-linux-gnu/libselinux.so.1 (0x00007f94ade63000)</span><br><span class="line">        libudev.so.1 =&gt; /lib/x86_64-linux-gnu/libudev.so.1 (0x00007f94adc45000)</span><br><span class="line">        libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007f94ad8a7000)</span><br><span class="line">        libpcre.so.3 =&gt; /lib/x86_64-linux-gnu/libpcre.so.3 (0x00007f94ad635000)</span><br><span class="line">        libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f94ad431000)</span><br><span class="line">        librt.so.1 =&gt; /lib/x86_64-linux-gnu/librt.so.1 (0x00007f94ad229000)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åŠ ä¸Š DISABLE_CGO=1 ç¼–è¯‘åçš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶</span></span><br><span class="line">ldd skopeo_s #</span><br><span class="line">        not a dynamic executable</span><br></pre></td></tr></table></figure><h2 id="usage"><a href="#usage" class="headerlink" title="usage"></a>usage</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Various operations with container images and container image registries</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  skopeo [command]</span><br><span class="line"></span><br><span class="line">Available Commands:</span><br><span class="line">  copy                      Copy an IMAGE-NAME from one location to another</span><br><span class="line">  delete                    Delete image IMAGE-NAME</span><br><span class="line">  help                      Help about any command</span><br><span class="line">  inspect                   Inspect image IMAGE-NAME</span><br><span class="line">  list-tags                 List tags in the transport/repository specified by the</span><br><span class="line">  login                     Login to a container registry</span><br><span class="line">  logout                    Logout of a container registry</span><br><span class="line">  manifest-digest           Compute a manifest digest of a file</span><br><span class="line">  standalone-sign           Create a signature using local files</span><br><span class="line">  standalone-verify         Verify a signature using local files</span><br><span class="line">  sync                      Synchronize one or more images from one location to another</span><br><span class="line"></span><br><span class="line">skopeo version 1.0.0 commit: bd162028cd83ceecd8915736f2d66d5ca73ee54a</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°  skopeo çš„åŠŸèƒ½å¾ˆç®€å•ï¼š</p><ul><li>copyï¼šå¤åˆ¶ä¸€ä¸ªé•œåƒä» A åˆ° Bï¼Œè¿™é‡Œçš„ A å’Œ B å¯ä»¥ä¸ºæœ¬åœ° docker é•œåƒæˆ–è€… registry ä¸Šçš„é•œåƒã€‚</li><li>inspectï¼šæŸ¥çœ‹ä¸€ä¸ªé•œåƒçš„ manifest ç«è½¦ image config è¯¦ç»†ä¿¡æ¯</li><li>deleteï¼šåˆ é™¤ä¸€ä¸ªé•œåƒï¼Œå¯ä»¥æ˜¯æœ¬åœ° docker é•œåƒæˆ–è€… registry ä¸Šçš„é•œåƒ</li><li>list-tagsï¼šåˆ—å‡ºä¸€ä¸ª registry ä¸ŠæŸä¸ªé•œåƒçš„æ‰€æœ‰ tag</li><li>loginï¼šç™»å½•åˆ°æŸä¸ª registryï¼Œå’Œ docker login ç±»ä¼¼</li><li>logoutï¼š é€€å‡ºå·²ç»ç™»å½•åˆ°æŸä¸ª registry çš„ auth ä¿¡æ¯ï¼Œå’Œ docker logout ç±»ä¼¼</li><li>manifest-digestã€standalone-signã€standalone-verify è¿™ä¸‰ä¸ªç”¨çš„ä¸å¤š</li><li>syncï¼šåŒæ­¥ä¸€ä¸ªé•œåƒä» A åˆ°  Bï¼Œæ„Ÿè§‰å’Œ copy ä¸€æ ·ï¼Œä½† sync æ”¯æŒçš„å‚æ•°æ›´å¤šï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ã€‚åœ¨ 0.14.0 ç‰ˆæœ¬çš„æ—¶å€™æ˜¯æ²¡æœ‰ sync é€‰é¡¹çš„ï¼Œåˆ°äº† 0.14.2 æ‰æœ‰ï¼Œç°åœ¨æ˜¯ 1.0.0</li></ul><h3 id="IMAGE-NAMES"><a href="#IMAGE-NAMES" class="headerlink" title="IMAGE NAMES"></a>IMAGE NAMES</h3><p>åœ¨ä½¿ç”¨ skopeo ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“åœ¨å‘½ä»¤è¡Œä¸­é•œåƒçš„æ ¼å¼ï¼Œä¸‹é¢æ˜¯å®˜æ–¹è¯¦ç»†çš„æ–‡æ¡£æ ¼å¼ã€‚æ— è®ºæˆ‘ä»¬çš„ src é•œåƒè¿˜æ˜¯ desc é•œåƒéƒ½è¦æ»¡è¶³ä»¥ä¸‹æ ¼å¼æ‰å¯ä»¥ã€‚</p><blockquote><p>  Most commands refer to container images, using a <em>transport<em><code>:</code></em>details</em> format. The following formats are supported:</p><p>  <strong>containers-storage:*</strong>docker-reference* An image located in a local containers/storage image store. Both the location and image store are specified in /etc/containers/storage.conf. (Backend for Podman, CRI-O, Buildah and friends)</p><p>  <strong>dir:*</strong>path* An existing local directory <em>path</em> storing the manifest, layer tarballs and signatures as individual files. This is a non-standardized format, primarily useful for debugging or noninvasive container inspection.</p><p>  <strong>docker://*</strong>docker-reference* An image in a registry implementing the â€œDocker Registry HTTP API V2â€. By default, uses the authorization state in either <code>$XDG_RUNTIME_DIR/containers/auth.json</code>, which is set using <code>(skopeo login)</code>. If the authorization state is not found there, <code>$HOME/.docker/config.json</code> is checked, which is set using <code>(docker login)</code>.</p><p>  <strong>docker-archive:*</strong>path<em>[<strong>:*</strong>docker-reference*] An image is stored in the <code>docker save</code> formatted file. *docker-reference</em> is only used when creating such a file, and it must not contain a digest.</p><p>  <strong>docker-daemon:*</strong>docker-reference* An image <em>docker-reference</em> stored in the docker daemon internal storage. <em>docker-reference</em> must contain either a tag or a digest. Alternatively, when reading images, the format can be docker-daemon:algo:digest (an image ID).</p><p>  <strong>oci:*</strong>path<strong><em>:</em></strong>tag* An image <em>tag</em> in a directory compliant with â€œOpen Container Image Layout Specificationâ€ at <em>path</em>.</p></blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™å‡ ç§é•œåƒçš„åå­—ï¼Œå¯¹åº”ç€é•œåƒå­˜åœ¨çš„æ–¹å¼ï¼Œä¸åŒå­˜åœ¨çš„æ–¹å¼å¯¹é•œåƒçš„ layer å¤„ç†çš„æ–¹å¼ä¹Ÿä¸ä¸€æ ·ï¼Œæ¯”å¦‚ <code>docker://</code> è¿™ç§æ–¹å¼æ˜¯å­˜åœ¨ registry ä¸Šçš„ï¼Œ<code>docker-daemon:</code> æ˜¯å­˜åœ¨æœ¬åœ° docker pull ä¸‹æ¥çš„ï¼Œå†æ¯”å¦‚ <code>docker-archive</code> æ˜¯é€šè¿‡ docker save å‡ºæ¥çš„é•œåƒã€‚åŒä¸€ä¸ªé•œåƒæœ‰è¿™å‡ ç§å­˜åœ¨çš„æ–¹å¼å°±åƒæ°´æœ‰æ°”ä½“ã€æ¶²ä½“ã€å›ºä½“ä¸€æ ·ã€‚å¯ä»¥è¿™æ ·å»ç†è§£ï¼Œä»–ä»¬è¡¨è¿°çš„éƒ½æ˜¯åŒä¸€ä¸ªé•œåƒï¼Œåªä¸è¿‡æ˜¯å­˜åœ¨çš„æ–¹å¼ä¸ä¸€æ ·è€Œå·²ã€‚</p><table><thead><tr><th>IMAGE NAMES</th><th>example</th></tr></thead><tbody><tr><td><strong>containers-storage:</strong></td><td>containers-storage:</td></tr><tr><td><strong>dir:</strong></td><td>dir:/PATH</td></tr><tr><td><strong>docker://</strong></td><td>docker://k8s.gcr.io/kube-apiserver:v1.17.5</td></tr><tr><td><strong>docker-daemon:</strong></td><td>docker-daemon:alpine:latest</td></tr><tr><td><strong>docker-archive:</strong></td><td>docker-archive:alpine.tar (docker save)</td></tr><tr><td><strong>oci:</strong></td><td>oci:alpine:latest</td></tr></tbody></table><h3 id="skopeo-copy"><a href="#skopeo-copy" class="headerlink" title="skopeo copy"></a>skopeo copy</h3><blockquote><p>  Copy an IMAGE-NAME from one location to another </p></blockquote><p>æ³¨æ„ä¸€ä¸‹ï¼Œè¿™é‡Œçš„ location å°±æ˜¯æŒ‡çš„ä¸Šé¢æåˆ°çš„ <code>IMAGE NAMES</code> ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>skopeo copy src dest</code> å¯ä»¥æœ‰6*6=36 ç§ç»„åˆï¼æ¯”å¦‚æˆ‘å¯ä»¥å°†ä¸€ä¸ªé•œåƒä»ä¸€ä¸ª registry å¤åˆ¶åˆ°å¦ä¸€ä¸ª registryï¼Œ<code>skopeo copy docker://IMAGE_NAME docker://IMAGE_NAME</code>ï¼Œå†å¼ºè°ƒä¸€éï¼Œä¸€å®šè¦æ³¨æ„ <code>IMAGE_NAME</code> çš„å‘½åçš„æ ¼å¼ã€‚</p><p>skopeo çš„è¯¦ç»†ä½¿ç”¨å¯ä»¥å‚è€ƒå®˜æ–¹çš„æ–‡æ¡£ï¼Œåœ¨ä½¿ç”¨ä¹‹å‰å…ˆåˆ›å»ºä¸€ä¸ª</p><p>åœ¨ä½¿ç”¨ skopeo ä¹‹å‰å¦‚æœé•œåƒæ˜¯å­˜æ”¾åœ¨ registry ä¸Šçš„è¯ï¼Œéœ€è¦å…ˆç™»å½•åˆ° registryã€‚ä½¿ç”¨ skopeo login æˆ–è€…  docker login éƒ½å¯ä»¥ã€‚æˆåŠŸç™»å½•ä¹‹åä¼šåœ¨æœ¬åœ°ä¿å­˜ä¸€ä¸ªä¸º config.json çš„æ–‡ä»¶ï¼Œé‡Œé¢ä¿å­˜äº†ç™»å½•éœ€è¦çš„éªŒè¯ä¿¡æ¯ï¼Œskopeo æ‹¿åˆ°è¿™ä¸ªéªŒè¯ä¿¡æ¯æ‰æœ‰æƒé™å¾€ registry push é•œåƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu/skopeo â€¹master*â€º</span><br><span class="line">â•°â”€# jq "." ~/.docker/config.json                                                             </span><br><span class="line">&#123;</span><br><span class="line">  "auths": &#123;</span><br><span class="line">    "https://index.docker.io/v1/": &#123;</span><br><span class="line">      "auth": "d2sddaqWM7bSVlJFpmQE43Sw=="</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  "HttpHeaders": &#123;</span><br><span class="line">    "User-Agent": "Docker-Client/19.03.5 (linux)"</span><br><span class="line">  &#125;,</span><br><span class="line">  "experimental": "enabled"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä» <code>k8s.gcr.io/kube-apiserver:v1.17.5</code> å¤åˆ¶é•œåƒåˆ° <code>index.docker.io/webpsh/kube-apiserver:v1.17.5</code> </li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~/skopeo â€¹masterâ€º</span><br><span class="line">â•°â”€# skopeo copy docker://k8s.gcr.io/kube-apiserver:v1.17.5 docker://index.docker.io/webpsh/kube-apiserver:v1.17.5 --dest-authfile /root/.docker/config.json</span><br><span class="line">Getting image source signatures</span><br><span class="line">Copying blob 597de8ba0c30 done</span><br><span class="line">Copying blob e13a88fa950c done</span><br><span class="line">Copying config f640481f6d done</span><br><span class="line">Writing manifest to image destination</span><br><span class="line">Storing signatures</span><br></pre></td></tr></table></figure><ul><li>skopeo è¾“å‡ºçš„æ—¥å¿—æ˜¾ç¤ºæ˜¯ <code>Copying blob 597de8ba0c30 done</code> ï¼Œå¯ä»¥çœ‹åˆ° skopeo æ˜¯ç›´æ¥ copy é•œåƒ layer çš„ blobï¼Œè€Œ blob æ˜¯åœ¨ registry è¿›è¡Œå‹ç¼©å­˜å‚¨çš„æ ¼å¼ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ç„¶åä»é‡æ–° pul ä¸‹æ¥åˆšåˆš push åˆ° docker hub ä¸Šçš„é•œåƒï¼ŒéªŒè¯æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">â•­â”€root@sg-02 ~/skopeo â€¹masterâ€º</span><br><span class="line">â•°â”€# docker pull webpsh/kube-apiserver:v1.17.5</span><br><span class="line">v1.17.5: Pulling from webpsh/kube-apiserver</span><br><span class="line">Digest: sha256:5ddc5c77f52767f2f225a531a257259228d74b32d8aac9cfe087251f998c42f3</span><br><span class="line">Status: Downloaded newer image for webpsh/kube-apiserver:v1.17.5</span><br><span class="line">docker.io/webpsh/kube-apiserver:v1.17.5</span><br></pre></td></tr></table></figure><ul><li>copy é•œåƒåˆ°æœ¬åœ°</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# skopeo copy docker-daemon:alpine:latest oci:alpine</span><br><span class="line">Getting image source signatures</span><br><span class="line">Copying blob 3e207b409db3 done</span><br><span class="line">Copying config af88fdb253 done</span><br><span class="line">Writing manifest to image destination</span><br><span class="line">Storing signatures</span><br><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# tree -h alpine</span><br><span class="line">alpine</span><br><span class="line">â”œâ”€â”€ [4.0K]  blobs</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [ 348]  1c6f747c933450c5169f349f2a57b9d31e833c0452e1ec712b8aab0cbfea4d2c</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [2.8M]  3eee30c545e47333e6fe551863f6f29c3dcd850187ae3f37c606adb991444886</span><br><span class="line">â”‚Â Â      â””â”€â”€ [ 583]  af88fdb253aac46693de7883c9c55244327908c77248d7654841503f744aae8b</span><br><span class="line">â”œâ”€â”€ [ 186]  index.json</span><br><span class="line">â””â”€â”€ [  31]  oci-layout</span><br></pre></td></tr></table></figure><p>æœ‰ç‚¹å¥½å¥‡è¿™ä¸ªé•œåƒæ ¼å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ copy å‡ºæ¥çš„é•œåƒï¼Œå¯ä»¥çœ‹åˆ°åœ¨å¯¼å‡ºæ¥çš„.</p><p>è¿™ä¸ªåº”è¯¥æ˜¯é•œåƒçš„ mainfaet æ–‡ä»¶</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu/alpine/blobs/sha256</span><br><span class="line">â•°â”€# jq "." 1c6f747c933450c5169f349f2a57b9d31e833c0452e1ec712b8aab0cbfea4d2c</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">"config"</span>: &#123;</span><br><span class="line">    <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.oci.image.config.v1+json"</span>,</span><br><span class="line">    <span class="attr">"digest"</span>: <span class="string">"sha256:af88fdb253aac46693de7883c9c55244327908c77248d7654841503f744aae8b"</span>,</span><br><span class="line">    <span class="attr">"size"</span>: <span class="number">583</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"layers"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.oci.image.layer.v1.tar+gzip"</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:3eee30c545e47333e6fe551863f6f29c3dcd850187ae3f37c606adb991444886"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">2898973</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™ä¸ªå°±æ˜¯é•œåƒçš„ image config æ–‡ä»¶</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu/alpine/blobs/sha256</span><br><span class="line">â•°â”€# jq "." af88fdb253aac46693de7883c9c55244327908c77248d7654841503f744aae8b</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"created"</span>: <span class="string">"2020-04-24T01:05:03.92860976Z"</span>,</span><br><span class="line">  <span class="attr">"architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">  <span class="attr">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">  <span class="attr">"config"</span>: &#123;</span><br><span class="line">    <span class="attr">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"/bin/sh"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"rootfs"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"layers"</span>,</span><br><span class="line">    <span class="attr">"diff_ids"</span>: [</span><br><span class="line">      <span class="string">"sha256:3e207b409db364b595ba862cdc12be96dcdad8e36c59a03b7b3b61c946a5741a"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"history"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-04-24T01:05:03.608058404Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop) ADD file:b91adb67b670d3a6ff9463e48b7def903ed516be66fc4282d22c53e41512be49 in / "</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-04-24T01:05:03.92860976Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop)  CMD [\"/bin/sh\"]"</span>,</span><br><span class="line">      <span class="attr">"empty_layer"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="skopeo-inspect"><a href="#skopeo-inspect" class="headerlink" title="skopeo inspect"></a>skopeo inspect</h3><p>è¿™ä¸ªå‘½ä»¤å¯ä»¥æŸ¥çœ‹ä¸€ä¸ªé•œåƒçš„ image config å’Œ mainf æ–‡ä»¶ï¼Œå’Œ docker inspect å‘½ä»¤å·®ä¸å¤š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">â•­â”€root@sg-02 /home/ubuntu/alpine/blobs/sha256</span><br><span class="line">â•°â”€# skopeo inspect docker-daemon:alpine:latest --raw | jq "."</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">  <span class="attr">"config"</span>: &#123;</span><br><span class="line">    <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.container.image.v1+json"</span>,</span><br><span class="line">    <span class="attr">"size"</span>: <span class="number">1507</span>,</span><br><span class="line">    <span class="attr">"digest"</span>: <span class="string">"sha256:f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"layers"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">5878784</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:3e207b409db364b595ba862cdc12be96dcdad8e36c59a03b7b3b61c946a5741a"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="skopeo-delete"><a href="#skopeo-delete" class="headerlink" title="skopeo delete"></a>skopeo delete</h3><p>ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å¯ä»¥åˆ é™¤é•œåƒï¼Œå¯¹äºåˆ é™¤ registry ä¸Šçš„é•œåƒå¾ˆæœ‰å¸®åŠ©ï¼Œå› ä¸ºç›®å‰æƒ³è¦åˆ é™¤ registry ä¸Šçš„é•œåƒå¸¸è§„çš„åšæ³•è¿˜æ˜¯ç™»å½•åˆ° registry åœ¨ WEB ä¸Šæ‰‹åŠ¨åˆ é™¤ã€‚skopeo delete ä¹Ÿæ˜¯è°ƒç”¨ registry çš„ API æ¥è¿›è¡Œåˆ é™¤é•œåƒã€‚</p><h3 id="skopeo-list-tags"><a href="#skopeo-list-tags" class="headerlink" title="skopeo list-tags"></a>skopeo list-tags</h3><p>è¿™ä¸ªå‘½ä»¤å¸¸ç”¨æ¥åˆ—å‡º registry ä¸Šçš„æŸä¸ªé•œåƒçš„æ‰€æœ‰ tag ï¼Œåœ¨ä¸€äº› shell è„šæœ¬ä¸­å¯èƒ½ä¼šåˆç”¨å¾—åˆ°ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;æ¬ç –å·¥å…·&quot;&gt;&lt;a href=&quot;#æ¬ç –å·¥å…·&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="docker" scheme="https://blog.k8s.li/tags/docker/"/>
    
      <category term="registry" scheme="https://blog.k8s.li/tags/registry/"/>
    
      <category term="é•œåƒ" scheme="https://blog.k8s.li/tags/%E9%95%9C%E5%83%8F/"/>
    
      <category term="æ¬ç –å·¥å…·" scheme="https://blog.k8s.li/tags/%E6%90%AC%E7%A0%96%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>æœ¨å­çš„æ¬ç –å·¥å…·ğŸ˜‚</title>
    <link href="https://blog.k8s.li/My-brick-lifting-tools.html"/>
    <id>https://blog.k8s.li/My-brick-lifting-tools.html</id>
    <published>2020-05-21T16:00:00.000Z</published>
    <updated>2020-09-15T00:28:09.940Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å’•å’•å’•"><a href="#å’•å’•å’•" class="headerlink" title="å’•å’•å’•"></a>å’•å’•å’•</h2><p>æœ¬æ¥æ‰“ç®—ä¸Šä¸Šå‘¨å°±è¯¥æ›´æ–°å®Œçš„è¿™ç¯‡åšæ–‡ï¼Œä½†æœ€è¿‘å› ä¸ºç¦»èŒçš„äº‹å®œæ‹–åˆ°ä»Šå¤©æ™šä¸Šæ‰æ¡èµ·æ¥ï¼Œæœ€ç»ˆè¿˜æ˜¯å’•å’•å’•äº†ğŸ˜‚ã€‚è™½ç„¶æ–‡ç« è¿˜æœªè¡¥å……å®Œï¼Œç­‰åˆ°ä»¥åå†ç»§ç»­æ›´æ–°ä¸Šå§ã€‚</p><h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><p>ç¡®åˆ‡åœ°æ¥è®² Linux ä»…ä»…æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„å†…æ ¸ï¼Œè€Œä¸”å®ƒçš„ä»£ç åœ¨ä¸€ä¸ªå‘è¡Œç‰ˆä¸­çš„å ç”¨ç‡ä¹Ÿä¸åˆ° 20%ã€‚</p><h3 id="å…¥é—¨"><a href="#å…¥é—¨" class="headerlink" title="å…¥é—¨"></a>å…¥é—¨</h3><p>å’±ä¸€ç›´è§‰ç€å­¦ä¹ æŠ€æœ¯å§ï¼Œå¹¶ä¸æ˜¯çœ‹ä¹¦çœ‹è§†é¢‘èƒ½å­¦ä¼šçš„ã€‚å¯¹äºä¸€äº›åº•å±‚çš„åªæ˜¯ç¡®å®éœ€è¦ä»”ç»†ç ”è¯»ä¹¦ç±æ¥åƒé€ä»–ï¼Œè¿™è¶Ÿä¼šè®©æˆ‘ä»¬å¯¹æ“ä½œç³»ç»Ÿè¿™ä¸ªä½“ç³»ç»“æ„æœ‰æ›´ä¸‹é€å½»çš„è®¤è¯†ã€‚ä½†æ˜¯å‘¢ï¼Œå…‰çœ‹ä¸ç»ƒè¿˜æ˜¯ä¸è¡Œæ»´ï¼Œå’±å­¦ä¹  Linux çº¯é çç©ï¼ŒçæŠ˜è…¾ã€‚å’±å¤§å­¦æ—¶å­¦æ ¡æ²¡æœ‰å¼€è®¾ Linux è¯¾ç¨‹ï¼Œåªèƒ½é è‡ªå·±è‡ªå­¦ã€‚äºæ˜¯ä¹ï¼Œå’Œå¤§å®¶ä¸€æ ·ï¼Œæ­å»º WordPress ï¼Œä¸€æ­¥æ­¥å®‰è£… LAMP ç¯å¢ƒï¼Œé…ç½® iptablesï¼Œå†™ shell è„šæœ¬å¤‡ä»½ç½‘ç«™ï¼Œæ­å»ºæ¢¯å­ç­‰ç­‰ã€‚å¯è°“æ˜¯ç©å¾—ä¸äº¦ä¹ä¹ğŸ˜‚ã€‚</p><p>æ‰€ä»¥è¯´å­¦ä¹ å’Œå…¥é—¨ Linux å’±è¿˜æ˜¯æ¨èé¸Ÿå“¥çš„ã€Šé¸Ÿå“¥ Linux ç§æˆ¿èœã€‹è¿™æœ¬ä¹¦ï¼Œç»“åˆç€è‡ªå·±æ­å»ºç½‘ç«™ä¸€æ­¥æ­¥æ¥å°±å¯ä»¥ã€‚</p><h3 id="æ”¾å¼ƒ"><a href="#æ”¾å¼ƒ" class="headerlink" title="æ”¾å¼ƒ"></a>æ”¾å¼ƒ</h3><p>å…¥é—¨å®Œ Linux ä¹‹åå°±å¼€å§‹æŒ‘æˆ˜é«˜éš¾åº¦çš„å•¦ï¼Œæ¯”å¦‚ï¼š</p><ul><li>OpenStack</li><li>Docker</li><li>Kubernetes</li><li>CI/CD</li></ul><p>ç›®å‰æ¥è®²åœ¨è¿ç»´è¿™ä¸ªæ¬ç –è¡Œä¸šï¼Œkubernetes äº‘åŸç”Ÿæ— ç–‘æ˜¯æœ€å…·æœ‰æŒ‘æˆ˜æ€§å’Œå‰æ™¯çš„ï¼Œæ‰€ä»¥å¦‚æœæ±æƒ³æ›´è¿‘ä¸€å±‚æ¥¼å°±ä¸å¦¨å­¦ä¹ ä¸€ä¸‹ Docker å’Œ Kuberneets è¿™ä¸€å—ã€‚</p><h3 id="å‘è¡Œç‰ˆ"><a href="#å‘è¡Œç‰ˆ" class="headerlink" title="å‘è¡Œç‰ˆ"></a>å‘è¡Œç‰ˆ</h3><p>ä»è¿ç»´è¿™ä¸ªæ¬ç –è¡Œä¸šæ¥è®²ï¼Œä¼ä¸šå†…éƒ¨ä½¿ç”¨çš„ Linux å‘è¡Œç‰ˆå½“å± RedHat å’Œ Debian å®¶æ—çš„æœ€å¤šï¼Œåƒå…¶ä»–çš„ä»€ä¹ˆ archlinux å’±è¿˜çœŸæ²¡è§è¿‡æœ‰åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„ï¼Œæ¯•ç«Ÿæ»šåŠ¨æ›´æ–°ä¸å°å¿ƒå°±æ»šæŒ‚äº†ä¸å¥½è¯´ğŸ˜‚ã€‚å›½å†…ä¼ä¸šå’Œäº‘è®¡ç®—å‚å•†ä½¿ç”¨æœ€å¤šçš„å½“ç„¶æ˜¯ CentOS å•¦ï¼Œæˆ‘è®°å¾—æ˜¯åœ¨ 2018 å¹´å¹´æœ«çš„æ—¶å€™é˜¿é‡Œäº‘/è…¾è®¯äº‘è¿˜æ²¡æœ‰ Ubuntu 1804 çš„äº‘ä¸»æœºå¯ç”¨ğŸ˜‘ã€‚å›½å¤–ä½¿ç”¨ Ubuntu çš„è¾ƒå¤šä¸€äº›ï¼Œå’±æ˜¯å€¾å‘äºä½¿ç”¨ Ubuntu ğŸ˜</p><p>ä» <a href="https://www.datanyze.com" target="_blank" rel="noopener">datanyze</a> å®¶å·æ¥ä¸€å¼ ä¼ä¸š Linux å¸‚åœºå æœ‰ç‡çš„ç»Ÿè®¡è¡¨æ ¼ <a href="https://www.datanyze.com/market-share/operating-systems--443" target="_blank" rel="noopener">Operating Systems</a>ğŸ˜‚</p><table><thead><tr><th align="center">Ranking</th><th align="left">Technology</th><th align="right">Domains</th><th align="right">Market Share</th></tr></thead><tbody><tr><td align="center">1</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/ubuntu-market-share" target="_blank" rel="noopener">Ubuntu</a></td><td align="right">278,611</td><td align="right">29.30%</td></tr><tr><td align="center">2</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/unix-market-share" target="_blank" rel="noopener">Unix</a></td><td align="right">192,215</td><td align="right">20.21%</td></tr><tr><td align="center">3</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/centos-market-share" target="_blank" rel="noopener">CentOS</a></td><td align="right">165,640</td><td align="right">17.42%</td></tr><tr><td align="center">4</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/debian-market-share" target="_blank" rel="noopener">Debian</a></td><td align="right">108,373</td><td align="right">11.40%</td></tr><tr><td align="center">5</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-market-share" target="_blank" rel="noopener">Linux</a></td><td align="right">24,563</td><td align="right">2.58%</td></tr><tr><td align="center">6</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/windows-server-market-share" target="_blank" rel="noopener">Windows Server</a></td><td align="right">23,872</td><td align="right">2.51%</td></tr><tr><td align="center">7</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/gentoo-market-share" target="_blank" rel="noopener">Gentoo</a></td><td align="right">16,756</td><td align="right">1.76%</td></tr><tr><td align="center">8</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/red-hat-enterprise-linux-market-share" target="_blank" rel="noopener">Red Hat Enterprise Linux</a></td><td align="right">13,659</td><td align="right">1.44%</td></tr><tr><td align="center">9</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/windows-7-market-share" target="_blank" rel="noopener">Windows 7</a></td><td align="right">11,843</td><td align="right">1.25%</td></tr><tr><td align="center">10</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/microsoft-windows-os-market-share" target="_blank" rel="noopener">Microsoft Windows OS</a></td><td align="right">10,986</td><td align="right">1.16%</td></tr></tbody></table><table><thead><tr><th align="left">op Competitors</th><th align="right">Websites</th><th align="right">Market Share</th><th align="right">Versus Page</th></tr></thead><tbody><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/ubuntu-market-share" target="_blank" rel="noopener">Ubuntu</a></td><td align="right">278,611</td><td align="right">29.30%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-ubuntu" target="_blank" rel="noopener">Linux vs. Ubuntu</a></td></tr><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/unix-market-share" target="_blank" rel="noopener">Unix</a></td><td align="right">192,215</td><td align="right">20.21%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-unix" target="_blank" rel="noopener">Linux vs. Unix</a></td></tr><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/centos-market-share" target="_blank" rel="noopener">CentOS</a></td><td align="right">165,640</td><td align="right">17.42%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-centos" target="_blank" rel="noopener">Linux vs. CentOS</a></td></tr><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/debian-market-share" target="_blank" rel="noopener">Debian</a></td><td align="right">108,373</td><td align="right">11.40%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-debian" target="_blank" rel="noopener">Linux vs. Debian</a></td></tr><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/windows-server-market-share" target="_blank" rel="noopener">Windows Server</a></td><td align="right">23,872</td><td align="right">2.51%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-windows-server" target="_blank" rel="noopener">Linux vs. Windows Server</a></td></tr><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/gentoo-market-share" target="_blank" rel="noopener">Gentoo</a></td><td align="right">16,756</td><td align="right">1.76%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-gentoo" target="_blank" rel="noopener">Linux vs. Gentoo</a></td></tr><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/red-hat-enterprise-linux-market-share" target="_blank" rel="noopener">Red Hat Enterprise Linux</a></td><td align="right">13,659</td><td align="right">1.44%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-red-hat-enterprise-linux" target="_blank" rel="noopener">Linux vs. Red Hat Enterprise Linux</a></td></tr><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/windows-7-market-share" target="_blank" rel="noopener">Windows 7</a></td><td align="right">11,843</td><td align="right">1.25%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-windows-7" target="_blank" rel="noopener">Linux vs. Windows 7</a></td></tr><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/microsoft-windows-os-market-share" target="_blank" rel="noopener">Microsoft Windows OS</a></td><td align="right">10,986</td><td align="right">1.16%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-microsoft-windows-os" target="_blank" rel="noopener">Linux vs. Microsoft Windows OS</a></td></tr><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/freebsd-market-share" target="_blank" rel="noopener">FreeBSD</a></td><td align="right">9,633</td><td align="right">1.01%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-freebsd" target="_blank" rel="noopener">Linux vs. FreeBSD</a></td></tr></tbody></table><h4 id="RedHat-CentOS"><a href="#RedHat-CentOS" class="headerlink" title="RedHat/CentOS"></a>RedHat/CentOS</h4><h4 id="Debian-Ubuntu"><a href="#Debian-Ubuntu" class="headerlink" title="Debian/Ubuntu"></a>Debian/Ubuntu</h4><p>å’±çš„ VPS æ¸…ä¸€è‰² Ubuntu 1804 ï¼Œä¸»è¦æ˜¯çœäº‹å„¿ã€‚</p><h2 id="å‘½ä»¤è¡Œå·¥å…·"><a href="#å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="å‘½ä»¤è¡Œå·¥å…·"></a>å‘½ä»¤è¡Œå·¥å…·</h2><h3 id="æ–‡æœ¬å¤„ç†"><a href="#æ–‡æœ¬å¤„ç†" class="headerlink" title="æ–‡æœ¬å¤„ç†"></a>æ–‡æœ¬å¤„ç†</h3><p>æåˆ° Linux ä¸Šçš„æ–‡æœ¬å¤„ç†å·¥å…·å½“ç„¶æ˜¯ç¦»ä¸å¼€ä¸‰å‰‘å®¢ï¼ˆawkã€grepã€sedï¼‰ï¼Œè¿™ä¹Ÿæ˜¯å’±å½“åˆè·Ÿç€ã€Šé¸Ÿå“¥ Linux ç§æˆ¿èœã€‹å­¦æ¥çš„ğŸ˜‚ã€‚</p><h4 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h4><h4 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h4><h4 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h4><h4 id="jq"><a href="#jq" class="headerlink" title="jq"></a>jq</h4><h4 id="tr"><a href="#tr" class="headerlink" title="tr"></a>tr</h4><h4 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h4><h4 id="wc"><a href="#wc" class="headerlink" title="wc"></a>wc</h4><h4 id="join"><a href="#join" class="headerlink" title="join"></a>join</h4><h4 id="cut"><a href="#cut" class="headerlink" title="cut"></a>cut</h4><h3 id="ç³»ç»Ÿä¿¡æ¯"><a href="#ç³»ç»Ÿä¿¡æ¯" class="headerlink" title="ç³»ç»Ÿä¿¡æ¯"></a>ç³»ç»Ÿä¿¡æ¯</h3><h4 id="htop"><a href="#htop" class="headerlink" title="htop"></a>htop</h4><p>top é»‘ä¹ä¹çš„é¢œå€¼å¤ªä½äº†ï¼Œå’±è¿˜æ˜¯å–œæ¬¢èŠ±èŠ±ç»¿ç»¿çš„ htop ï¼ˆå¤§é›¾</p><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> RHEL/CentOS</span></span><br><span class="line">yum install htop</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian/Ubuntu</span></span><br><span class="line">apt install htop</span><br></pre></td></tr></table></figure><p><img src="img/20200506142544440.png" alt="image-20200506142544440"></p><h3 id="bashtop"><a href="#bashtop" class="headerlink" title="bashtop"></a><a href="https://github.com/aristocratos/bashtop" target="_blank" rel="noopener">bashtop</a></h3><p>bashtop ç›¸æ¯”äº htop æœ‰ç§åŠç‚¸å¤©çš„æ„Ÿè§‰ï¼Œç‚«é…·æ— æ¯”ğŸ˜„</p><ul><li>install</li></ul><p>å®‰è£…èµ·æ¥å¾ˆç®€å•ï¼Œå…¶å®è¿™æ˜¯ä¸€ä¸ª shell å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç›´æ¥ä½¿ç”¨ curl æˆ–è€… wget å‘½ä»¤ä¸‹è½½åˆ°æœ¬åœ°å¹¶èµ‹äºˆ +x æƒé™å³å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://raw.githubusercontent.com/aristocratos/bashtop/master/bashtop -o /usr/bin/bashtop &amp;&amp; chmod +x /usr/bin/bashtop</span><br></pre></td></tr></table></figure><p>å›½å†…ç”¨æˆ·æ¨èä½¿ç”¨ jsdelivr.net çš„ CDN æ¥ä¸‹è½½è¯¥è„šæœ¬ğŸ˜‘ï¼Œï¼ˆfuck GFW by jsdelivrğŸ˜¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://cdn.jsdelivr.net/gh/aristocratos/bashtop/bashtop  -o /usr/bin/bashtop ;chmod +x /usr/bin/bashtop</span><br></pre></td></tr></table></figure><p><img src="img/20200506151706148.png" alt="image-20200506151706148"></p><h4 id="pstree"><a href="#pstree" class="headerlink" title="pstree"></a>pstree</h4><p>ä»¥æ ‘çŠ¶å›¾çš„æ–¹å¼å±•ç°è¿›ç¨‹ä¹‹é—´çš„æ´¾ç”Ÿå…³ç³»ï¼Œæ˜¾ç¤ºæ•ˆæœæ¯” ps æ›´ç›´è§‚ä¸€äº›ï¼Œå¯ä»¥å¾ˆæ¸…æ¥šåœ°åˆ†è¾¨å‡ºå­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹ä¹‹é—´çš„å…³ç³»ã€‚å¯ä»¥ç”¨æ¥æ’æŸ¥ä¸€äº›å­¤å„¿è¿›ç¨‹ã€‚</p><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> RHEL/CentOS</span></span><br><span class="line">yum install psmisc</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian/Ubuntu</span></span><br><span class="line">apt install psmisc</span><br></pre></td></tr></table></figure><ul><li>output example</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-node-3 /proc</span><br><span class="line">â•°â”€# pstree</span><br><span class="line">systemdâ”€â”¬â”€agetty</span><br><span class="line">        â”œâ”€auditdâ”€â”€â”€&#123;auditd&#125;</span><br><span class="line">        â”œâ”€containerdâ”€â”¬â”€6*[containerd-shimâ”€â”¬â”€pause]</span><br><span class="line">        â”‚            â”‚                    â””â”€9*[&#123;containerd-shim&#125;]]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€kube-proxyâ”€â”€â”€12*[&#123;kube-proxy&#125;]</span><br><span class="line">        â”‚            â”‚                 â””â”€9*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€4*[containerd-shimâ”€â”¬â”€pause]</span><br><span class="line">        â”‚            â”‚                    â””â”€10*[&#123;containerd-shim&#125;]]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€lvscareâ”€â”€â”€11*[&#123;lvscare&#125;]</span><br><span class="line">        â”‚            â”‚                 â””â”€10*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€agentâ”€â”€â”€10*[&#123;agent&#125;]</span><br><span class="line">        â”‚            â”‚                 â””â”€10*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€runsvdirâ”€â”¬â”€runsvâ”€â”€â”€bird6</span><br><span class="line">        â”‚            â”‚                 â”‚          â”œâ”€runsvâ”€â”€â”€calico-nodeâ”€â”€â”€18*[&#123;calico-node&#125;]</span><br><span class="line">        â”‚            â”‚                 â”‚          â”œâ”€runsvâ”€â”€â”€calico-nodeâ”€â”€â”€15*[&#123;calico-node&#125;]</span><br><span class="line">        â”‚            â”‚                 â”‚          â””â”€runsvâ”€â”€â”€bird</span><br><span class="line">        â”‚            â”‚                 â””â”€12*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€node_exporterâ”€â”€â”€4*[&#123;node_exporter&#125;]</span><br><span class="line">        â”‚            â”‚                 â””â”€10*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€nginx-proxyâ”€â”¬â”€confdâ”€â”€â”€11*[&#123;confd&#125;]</span><br><span class="line">        â”‚            â”‚                 â”‚             â””â”€nginxâ”€â”€â”€nginx</span><br><span class="line">        â”‚            â”‚                 â””â”€9*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€deploy.shâ”€â”€â”€sleep</span><br><span class="line">        â”‚            â”‚                 â””â”€10*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€nginx-ingressâ”€â”¬â”€nginxâ”€â”€â”€4*[nginx]</span><br><span class="line">        â”‚            â”‚                 â”‚               â””â”€14*[&#123;nginx-ingress&#125;]</span><br><span class="line">        â”‚            â”‚                 â””â”€10*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€configmap-reloaâ”€â”€â”€4*[&#123;configmap-reloa&#125;]</span><br><span class="line">        â”‚            â”‚                 â””â”€9*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€bash</span><br><span class="line">        â”‚            â”‚                 â””â”€9*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€ruby2.3â”€â”¬â”€ruby2.3â”€â”€â”€4*[&#123;ruby2.3&#125;]</span><br><span class="line">        â”‚            â”‚                 â”‚         â””â”€11*[&#123;ruby2.3&#125;]</span><br><span class="line">        â”‚            â”‚                 â””â”€10*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â””â”€46*[&#123;containerd&#125;]</span><br><span class="line">        â”œâ”€crond</span><br><span class="line">        â”œâ”€dbus-daemonâ”€â”€â”€&#123;dbus-daemon&#125;</span><br><span class="line">        â”œâ”€dockerdâ”€â”€â”€25*[&#123;dockerd&#125;]</span><br><span class="line">        â”œâ”€gssproxyâ”€â”€â”€5*[&#123;gssproxy&#125;]</span><br><span class="line">        â”œâ”€irqbalance</span><br><span class="line">        â”œâ”€kubeletâ”€â”€â”€26*[&#123;kubelet&#125;]</span><br><span class="line">        â”œâ”€lvmetad</span><br><span class="line">        â”œâ”€polkitdâ”€â”€â”€6*[&#123;polkitd&#125;]</span><br><span class="line">        â”œâ”€rpc.idmapd</span><br><span class="line">        â”œâ”€rpc.mountd</span><br><span class="line">        â”œâ”€rpc.statd</span><br><span class="line">        â”œâ”€rpcbind</span><br><span class="line">        â”œâ”€rsyslogdâ”€â”€â”€2*[&#123;rsyslogd&#125;]</span><br><span class="line">        â”œâ”€sshdâ”€â”€â”€sshdâ”€â”€â”€zshâ”€â”€â”€pstree</span><br><span class="line">        â”œâ”€systemd-journal</span><br><span class="line">        â”œâ”€systemd-logind</span><br><span class="line">        â”œâ”€systemd-udevd</span><br><span class="line">        â””â”€tunedâ”€â”€â”€4*[&#123;tuned&#125;]</span><br></pre></td></tr></table></figure><ul><li><p>å¯ä»¥çœ‹åˆ° init è¿›ç¨‹ systemd ä¸ºç³»ç»Ÿçš„ PID 1 å·è¿›ç¨‹ï¼Œæ‰€æœ‰çš„è¿›ç¨‹éƒ½åœ¨ systemd çš„ç®¡ç†ä¹‹ä¸‹ã€‚</p></li><li><p>åœ¨è¿è¡Œ docker çš„æœåŠ¡å™¨ä¸Šï¼Œå®¹å™¨è¿›ç¨‹çš„çˆ¶è¿›ç¨‹å¹¶ä¸æ˜¯ dockerd è¿™ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œè€Œæ˜¯ä¸€ä¸ªåä¸ºã€€<code>containerd-shim-${container_name}</code>ã€€è€Œ containerd-shim çš„çˆ¶è¿›ç¨‹ä¸ºå®¹å™¨è¿è¡Œæ—¶ <a href="https://containerd.io/" target="_blank" rel="noopener">containerd</a>ï¼Œdocker æ˜¯é€šè¿‡ gRPC åè®®ä¸ containerd è¿›ç¨‹é€šä¿¡æ¥ï¼Œä»¥æ­¤æ¥è¿›è¡Œç®¡ç†æ‰€è¿è¡Œçš„å®¹å™¨ã€‚å…³äºå®¹å™¨è¿è¡Œæ—¶çš„å…³ç³»å¯ä»¥å‚è€ƒ <a href="https://xuanwo.io/2019/08/06/oci-intro/" target="_blank" rel="noopener">å¼€æ”¾å®¹å™¨æ ‡å‡†(OCI) å†…éƒ¨åˆ†äº«</a>ï¼Œå½“æ—¶ç†è§£ dockerd ã€containerdã€containerd-shim è¿™äº›å…³ç³»æ—¶æ„Ÿè§‰æœ‰ç‚¹ç»•ï¼Œä¸è¿‡ç”¨ pstree å‘½ä»¤çœ‹ä¸€ä¸‹è¿›ç¨‹æ ‘ç»“æ„å°±ä¸€ç›®äº†ç„¶äº†ğŸ˜‚ï¼Œå¯¹ç†è§£è¿›ç¨‹ä¹‹é—´çš„å…³ç³»å¾ˆæœ‰å¸®åŠ©ã€‚</p></li></ul><h4 id="ncdu"><a href="#ncdu" class="headerlink" title="ncdu"></a>ncdu</h4><p>é¢è¯•çš„æ—¶å€™è¢«é—®é“è¿‡ <code>Linux ä¸‹å¦‚ä½•æŸ¥çœ‹æ–‡ä»¶è§å¤§å°ï¼Ÿ</code>ï¼Œå½“ç„¶æ˜¯ <code>du -sh</code> å•¦ğŸ˜‚ã€‚ä¸è¿‡å’±è¿˜æ˜¯å–œæ¬¢ç”¨ ncdu</p><p>ä½¿ç”¨ <code>ncdu</code> çš„å¥½å¤„å°±æ˜¯å¯ä»¥é€šè¿‡äº¤äº’å¼çš„æ–¹å¼æŸ¥çœ‹ç›®å½•å ç”¨ç©ºé—´çš„å¤§å°ï¼Œè¦æ¯” <code>du -sh</code> å‘½ä»¤æ–¹ä¾¿å¾ˆå¤šï¼Œä¸è¿‡ç¼ºç‚¹ä¹Ÿæœ‰ï¼Œå°±æ˜¯è¯¥å‘½ä»¤ä¸ºæ‰«æç›®æ ‡ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¾ˆè€—æ—¶ï¼å¦‚æœæƒ³è¦ç«‹å³æŸ¥çœ‹ä¸€ä¸‹ç›®å½•å ç”¨çš„å¤§å°ï¼Œè¿˜æ˜¯ç”¨ <code>du -sh</code> æœ€æ–¹ä¾¿ï¼Œä½¿ç”¨ ncdu å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ†ææ–‡ä»¶å¤¹ä¸‹å„ä¸ªæ–‡ä»¶å ç”¨çš„æƒ…å†µã€‚</p><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> RHEL/CentOS</span></span><br><span class="line">yum install ncdu</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian/Ubuntu</span></span><br><span class="line">apt install ncdu</span><br></pre></td></tr></table></figure><ul><li>output example</li></ul><p>ä½¿ç”¨åå‘é”®å’Œå›è½¦é”®è¿›è¡Œç›®å½•å¥‡å¹»ï¼Œå¾ˆæ–¹ä¾¿çš„è¯´ğŸ˜‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">ncdu 1.13 ~ Use the arrow keys to navigate, press ? for help</span><br><span class="line">--- / ------------</span><br><span class="line">    5.2 GiB [##########] /var</span><br><span class="line">    2.2 GiB [####      ] /opt</span><br><span class="line">    2.0 GiB [###       ] /usr</span><br><span class="line">  363.6 MiB [          ] /root</span><br><span class="line">45.8 MiB [          ] /boot</span><br><span class="line">45.2 MiB [          ] /run</span><br><span class="line"> 4.6 MiB [          ] /etc</span><br><span class="line">44.0 KiB [          ] /tmp</span><br><span class="line">24.0 KiB [          ] /home</span><br><span class="line">e  16.0 KiB [          ] /lost+found</span><br><span class="line"> 8.0 KiB [          ] /media</span><br><span class="line">e   4.0 KiB [          ] /srv</span><br><span class="line">e   4.0 KiB [          ] /mnt</span><br><span class="line">.   0.0   B [          ] /proc</span><br><span class="line"> 0.0   B [          ] /sys</span><br><span class="line"> 0.0   B [          ] /dev</span><br><span class="line">@   0.0   B [          ]  initrd.img.old</span><br><span class="line">@   0.0   B [          ]  initrd.img</span><br><span class="line">@   0.0   B [          ]  vmlinuz.old</span><br><span class="line">@   0.0   B [          ]  vmlinuz</span><br><span class="line">@   0.0   B [          ]  libx32</span><br><span class="line">@   0.0   B [          ]  lib64</span><br><span class="line">@   0.0   B [          ]  lib32</span><br><span class="line">@   0.0   B [          ]  sbin</span><br><span class="line"></span><br><span class="line">ncdu 1.13 ~ Use the arrow keys to navigate, press ? for help</span><br><span class="line">--- /var --------------</span><br><span class="line"> 3.5 GiB [##########] /lib</span><br><span class="line"> 1.4 GiB [####      ] /opt</span><br><span class="line">  156.9 MiB [          ] /cache</span><br><span class="line">79.6 MiB [          ] /log</span><br><span class="line"> 1.8 MiB [          ] /backups</span><br><span class="line">20.0 KiB [          ] /tmp</span><br><span class="line">16.0 KiB [          ] /spool</span><br><span class="line">e   4.0 KiB [          ] /mail</span><br><span class="line">e   4.0 KiB [          ] /local</span><br><span class="line">@   0.0   B [          ]  lock</span><br><span class="line">@   0.0   B [          ]  run</span><br></pre></td></tr></table></figure><ul><li>G/GB</li></ul><blockquote><p>The SIZE argument is an integer and optional unit (example: 10K is 10*1024). Units are K,M,G,T,P,E,Z,Y (powers of 1024) or KB,MB,â€¦ (powers of 1000).</p></blockquote><h4 id="nload"><a href="#nload" class="headerlink" title="nload"></a>nload</h4><p>nload å‘½ä»¤æ˜¯ä¸€ä¸ªå®æ—¶ç›‘æ§ç½‘ç»œæµé‡å’Œå¸¦å®½ä½¿ç”¨çš„æ§åˆ¶å°åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨ä¸¤ä¸ªå›¾è¡¨å¯è§†åŒ–åœ°å±•ç¤ºæ¥æ”¶å’Œå‘é€çš„æµé‡ï¼Œå¹¶æä¾›è¯¸å¦‚æ•°æ®äº¤æ¢æ€»é‡ã€æœ€å°/æœ€å¤§ç½‘ç»œå¸¦å®½ä½¿ç”¨é‡ç­‰é™„åŠ ä¿¡æ¯ã€‚</p><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> RHEL/CentOS</span></span><br><span class="line">yum install nload</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian/Ubuntu</span></span><br><span class="line">apt install nload</span><br></pre></td></tr></table></figure><ul><li>output example</li></ul><p>æŒ‰ä¸‹å›è½¦é”®å¯ä»¥åˆ‡æ¢ä¸åŒçš„ç½‘å¡</p><p><img src="img/20200506143310955.png" alt="image-20200506143310955"></p><h3 id="ls-å…„å¼Ÿä»¬"><a href="#ls-å…„å¼Ÿä»¬" class="headerlink" title="ls å…„å¼Ÿä»¬"></a>ls å…„å¼Ÿä»¬</h3><p>ä»¥ ls å¼€å¤´çš„å‘½ä»¤å¤§å¤šéƒ½æ˜¯åˆ—å‡º XX ä¿¡æ¯ï¼Œè¿™äº›å·¥å…·ä¹Ÿå¯ä»¥æ–¹ä¾¿æˆ‘ä»¬å¿«é€Ÿäº†è§£ä¸€ä¸‹ç›®å‰ç³»ç»Ÿçš„çŠ¶æ€ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># ls</span></span><br><span class="line">ls           lsblk        LS_COLORS    lsinitramfs  lslogins     lsns         lspgpot</span><br><span class="line">lsa          lsb_release  lscpu        lsipc        lsmem        lsof</span><br><span class="line">lsattr       LSCOLORS     lshw         lslocks      lsmod        lspci</span><br></pre></td></tr></table></figure><h4 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h4><blockquote><p>ls - list directory contents åˆ—å‡ºæ–‡ä»¶å¤¹å†…å®¹</p></blockquote><h4 id="lsattr"><a href="#lsattr" class="headerlink" title="lsattr"></a>lsattr</h4><blockquote><p>lsattr - list file attributes on a Linux second extended file system</p></blockquote><p>åˆ—å‡ºæ–‡ä»¶çš„å±æ€§ï¼Œ</p><h4 id="lsblk"><a href="#lsblk" class="headerlink" title="lsblk"></a>lsblk</h4><blockquote><p>lsblk - list block devices åˆ—å‡ºå—è®¾å¤‡</p></blockquote><p>è¿™ä¸ªå‘½ä»¤åœ¨æŸ¥çœ‹å—è®¾å¤‡ï¼ˆç£ç›˜) åˆ†åŒºå’ŒæŒ‚è½½ç‚¹ï¼Œä»¥åŠç£ç›˜å°šæœªåˆ†é…çš„ç©ºé—´ä¿¡æ¯å¾ˆæœ‰å¸®åŠ©ï¼Œè¦æ¯” fdisk æ›´ç›´è§‚ä¸€äº›ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># lsblk</span></span><br><span class="line">NAME                      MAJ:MIN RM SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda                         8:0    0  30G  0 disk</span><br><span class="line">â”œâ”€sda1                      8:1    0   1M  0 part</span><br><span class="line">â”œâ”€sda2                      8:2    0   1G  0 part /boot</span><br><span class="line">â””â”€sda3                      8:3    0  29G  0 part</span><br><span class="line">  â””â”€ubuntu--vg-ubuntu--lv 253:0    0  28G  0 lvm  /</span><br></pre></td></tr></table></figure><h4 id="lsb-release"><a href="#lsb-release" class="headerlink" title="lsb_release"></a>lsb_release</h4><blockquote><p>lsb_release - print distribution-specific information æ‰“å°å‘è¡Œç‰ˆè¯¦æƒ…</p></blockquote><p>æœ‰äº›å‘è¡Œç‰ˆå°šæœªå®‰è£…</p><h4 id="lscpu"><a href="#lscpu" class="headerlink" title="lscpu"></a>lscpu</h4><blockquote><p>lscpu - display information about the CPU architecture</p></blockquote><p>åˆ—å‡º CPU çš„ä¿¡æ¯ï¼Œå’Œ cat /proc/cpuinfo è¾“å‡ºç»“æœç±»ä¼¼ã€‚ç›¸å½“äº Linux ä¸‹çš„ CPU-Z ğŸ˜‚</p><ul><li>output example</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">â•­â”€root@gitlab</span> <span class="string">/opt</span></span><br><span class="line"><span class="string">â•°â”€#</span> <span class="string">lscpu</span></span><br><span class="line"><span class="attr">Architecture:</span>        <span class="string">x86_64</span></span><br><span class="line"><span class="string">CPU</span> <span class="string">op-mode(s):</span>      <span class="number">32</span><span class="string">-bit,</span> <span class="number">64</span><span class="string">-bit</span></span><br><span class="line"><span class="attr">Byte Order:</span>          <span class="string">Little</span> <span class="string">Endian</span></span><br><span class="line"><span class="string">CPU(s):</span>              <span class="number">4</span></span><br><span class="line"><span class="string">On-line</span> <span class="string">CPU(s)</span> <span class="attr">list:</span> <span class="number">0</span><span class="number">-3</span></span><br><span class="line"><span class="string">Thread(s)</span> <span class="attr">per core:</span>  <span class="number">1</span></span><br><span class="line"><span class="string">Core(s)</span> <span class="attr">per socket:</span>  <span class="number">1</span></span><br><span class="line"><span class="string">Socket(s):</span>           <span class="number">4</span></span><br><span class="line"><span class="string">NUMA</span> <span class="string">node(s):</span>        <span class="number">1</span></span><br><span class="line"><span class="attr">Vendor ID:</span>           <span class="string">GenuineIntel</span></span><br><span class="line"><span class="attr">CPU family:</span>          <span class="number">6</span></span><br><span class="line"><span class="attr">Model:</span>               <span class="number">60</span></span><br><span class="line"><span class="attr">Model name:</span>          <span class="string">Intel(R)</span> <span class="string">Xeon(R)</span> <span class="string">CPU</span> <span class="string">E3-1271</span> <span class="string">v3</span> <span class="string">@</span> <span class="number">3.</span><span class="string">60GHz</span></span><br><span class="line"><span class="attr">Stepping:</span>            <span class="number">3</span></span><br><span class="line"><span class="attr">CPU MHz:</span>             <span class="number">3591.683</span></span><br><span class="line"><span class="attr">BogoMIPS:</span>            <span class="number">7183.36</span></span><br><span class="line"><span class="attr">Hypervisor vendor:</span>   <span class="string">VMware</span></span><br><span class="line"><span class="attr">Virtualization type:</span> <span class="string">full</span></span><br><span class="line"><span class="attr">L1d cache:</span>           <span class="string">32K</span></span><br><span class="line"><span class="attr">L1i cache:</span>           <span class="string">32K</span></span><br><span class="line"><span class="attr">L2 cache:</span>            <span class="string">256K</span></span><br><span class="line"><span class="attr">L3 cache:</span>            <span class="string">8192K</span></span><br><span class="line"><span class="string">NUMA</span> <span class="string">node0</span> <span class="string">CPU(s):</span>   <span class="number">0</span><span class="number">-3</span></span><br><span class="line"><span class="attr">Flags:</span>               <span class="string">fpu</span> <span class="string">vme</span> <span class="string">de</span> <span class="string">pse</span> <span class="string">tsc</span> <span class="string">msr</span> <span class="string">pae</span> <span class="string">mce</span> <span class="string">cx8</span> <span class="string">apic</span> <span class="string">sep</span> <span class="string">mtrr</span> <span class="string">pge</span> <span class="string">mca</span> <span class="string">cmov</span> <span class="string">pat</span> <span class="string">pse36</span> <span class="string">clflush</span> <span class="string">dts</span> <span class="string">mmx</span> <span class="string">fxsr</span> <span class="string">sse</span> <span class="string">sse2</span> <span class="string">ss</span> <span class="string">syscall</span> <span class="string">nx</span> <span class="string">pdpe1gb</span> <span class="string">rdtscp</span> <span class="string">lm</span> <span class="string">constant_tsc</span> <span class="string">arch_perfmon</span> <span class="string">pebs</span> <span class="string">bts</span> <span class="string">nopl</span> <span class="string">xtopology</span> <span class="string">tsc_reliable</span> <span class="string">nonstop_tsc</span> <span class="string">cpuid</span> <span class="string">aperfmperf</span> <span class="string">pni</span> <span class="string">pclmulqdq</span> <span class="string">ssse3</span> <span class="string">fma</span> <span class="string">cx16</span> <span class="string">pcid</span> <span class="string">sse4_1</span> <span class="string">sse4_2</span> <span class="string">x2apic</span> <span class="string">movbe</span> <span class="string">popcnt</span> <span class="string">tsc_deadline_timer</span> <span class="string">aes</span> <span class="string">xsave</span> <span class="string">avx</span> <span class="string">f16c</span> <span class="string">rdrand</span> <span class="string">hypervisor</span> <span class="string">lahf_lm</span> <span class="string">abm</span> <span class="string">cpuid_fault</span> <span class="string">epb</span> <span class="string">invpcid_single</span> <span class="string">pti</span> <span class="string">fsgsbase</span> <span class="string">tsc_adjust</span> <span class="string">bmi1</span> <span class="string">avx2</span> <span class="string">smep</span> <span class="string">bmi2</span> <span class="string">invpcid</span> <span class="string">xsaveopt</span> <span class="string">dtherm</span> <span class="string">ida</span> <span class="string">arat</span> <span class="string">pln</span> <span class="string">pts</span></span><br></pre></td></tr></table></figure><p><code>cat /proc/cpuinfo</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">â•­â”€root@gitlab</span> <span class="string">/opt</span></span><br><span class="line"><span class="string">â•°â”€#</span> <span class="string">cat</span> <span class="string">/proc/cpuinfo</span></span><br><span class="line"><span class="attr">processor       :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">vendor_id       :</span> <span class="string">GenuineIntel</span></span><br><span class="line"><span class="attr">cpu family      :</span> <span class="number">6</span></span><br><span class="line"><span class="attr">model           :</span> <span class="number">60</span></span><br><span class="line"><span class="attr">model name      :</span> <span class="string">Intel(R)</span> <span class="string">Xeon(R)</span> <span class="string">CPU</span> <span class="string">E3-1271</span> <span class="string">v3</span> <span class="string">@</span> <span class="number">3.</span><span class="string">60GHz</span></span><br><span class="line"><span class="attr">stepping        :</span> <span class="number">3</span></span><br><span class="line"><span class="attr">microcode       :</span> <span class="number">0x1c</span></span><br><span class="line"><span class="attr">cpu MHz         :</span> <span class="number">3591.683</span></span><br><span class="line"><span class="attr">cache size      :</span> <span class="number">8192</span> <span class="string">KB</span></span><br><span class="line"><span class="attr">physical id     :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">siblings        :</span> <span class="number">1</span></span><br><span class="line"><span class="attr">core id         :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">cpu cores       :</span> <span class="number">1</span></span><br><span class="line"><span class="attr">apicid          :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">initial apicid  :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">fpu             :</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">fpu_exception   :</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">cpuid level     :</span> <span class="number">13</span></span><br><span class="line"><span class="attr">wp              :</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">flags           :</span> <span class="string">fpu</span> <span class="string">vme</span> <span class="string">de</span> <span class="string">pse</span> <span class="string">tsc</span> <span class="string">msr</span> <span class="string">pae</span> <span class="string">mce</span> <span class="string">cx8</span> <span class="string">apic</span> <span class="string">sep</span> <span class="string">mtrr</span> <span class="string">pge</span> <span class="string">mca</span> <span class="string">cmov</span> <span class="string">pat</span> <span class="string">pse36</span> <span class="string">clflush</span> <span class="string">dts</span> <span class="string">mmx</span> <span class="string">fxsr</span> <span class="string">sse</span> <span class="string">sse2</span> <span class="string">ss</span> <span class="string">syscall</span> <span class="string">nx</span> <span class="string">pdpe1gb</span> <span class="string">rdtscp</span> <span class="string">lm</span> <span class="string">constant_tsc</span> <span class="string">arch_perfmon</span> <span class="string">pebs</span> <span class="string">bts</span> <span class="string">nopl</span> <span class="string">xtopology</span> <span class="string">tsc_reliable</span> <span class="string">nonstop_tsc</span> <span class="string">cpuid</span> <span class="string">aperfmperf</span> <span class="string">pni</span> <span class="string">pclmulqdq</span> <span class="string">ssse3</span> <span class="string">fma</span> <span class="string">cx16</span> <span class="string">pcid</span> <span class="string">sse4_1</span> <span class="string">sse4_2</span> <span class="string">x2apic</span> <span class="string">movbe</span> <span class="string">popcnt</span> <span class="string">tsc_deadline_timer</span> <span class="string">aes</span> <span class="string">xsave</span> <span class="string">avx</span> <span class="string">f16c</span> <span class="string">rdrand</span> <span class="string">hypervisor</span> <span class="string">lahf_lm</span> <span class="string">abm</span> <span class="string">cpuid_fault</span> <span class="string">epb</span> <span class="string">invpcid_single</span> <span class="string">pti</span> <span class="string">fsgsbase</span> <span class="string">tsc_adjust</span> <span class="string">bmi1</span> <span class="string">avx2</span> <span class="string">smep</span> <span class="string">bmi2</span> <span class="string">invpcid</span> <span class="string">xsaveopt</span> <span class="string">dtherm</span> <span class="string">ida</span> <span class="string">arat</span> <span class="string">pln</span> <span class="string">pts</span></span><br><span class="line"><span class="attr">bugs            :</span> <span class="string">cpu_meltdown</span> <span class="string">spectre_v1</span> <span class="string">spectre_v2</span> <span class="string">spec_store_bypass</span> <span class="string">l1tf</span> <span class="string">mds</span> <span class="string">swapgs</span></span><br><span class="line"><span class="attr">bogomips        :</span> <span class="number">7183.36</span></span><br><span class="line"><span class="attr">clflush size    :</span> <span class="number">64</span></span><br><span class="line"><span class="attr">cache_alignment :</span> <span class="number">64</span></span><br><span class="line"><span class="attr">address sizes   :</span> <span class="number">42</span> <span class="string">bits</span> <span class="string">physical,</span> <span class="number">48</span> <span class="string">bits</span> <span class="string">virtual</span></span><br><span class="line"><span class="attr">power management:</span></span><br></pre></td></tr></table></figure><h4 id="lshw"><a href="#lshw" class="headerlink" title="lshw"></a>lshw</h4><blockquote><p>lshw - list hardware åˆ—å‡ºç¡¬ä»¶è®¾å¤‡</p><p>lshw is a small tool to extract detailed information on the hardware configuration of the machine. It  can report exact memory configuration, firmware version, mainboard configuration, CPU version and speed, cache configuration, bus speed, etc. on DMI-capable x86 or IA-64 systems and on some PowerPC machines  (PowerMac G4 is known to work).It  currently  supports  DMI (x86 and IA-64 only), OpenFirmware device tree (PowerPC only), PCI/AGP, CPUID (x86), IDE/ATA/ATAPI, PCMCIA (only tested on x86), SCSI and USB.</p></blockquote><p>è¿™ä¸ªå‘½ä»¤å°±ç›¸å½“äº Windows ä¸‹çš„è®¾å¤‡ç®¡ç†å™¨ï¼Œåˆ—å‡ºç³»ç»Ÿé‡Œçš„ç¡¬ä»¶è®¾å¤‡ã€‚</p><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> RHEL/CentOS</span></span><br><span class="line">yum install lshw</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian/Ubuntu</span></span><br><span class="line">apt install lshw</span><br></pre></td></tr></table></figure><ul><li>output example</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# lshw</span><br><span class="line">sg-02</span><br><span class="line"> description: Computer</span><br><span class="line"> product: HVM domU</span><br><span class="line"> vendor: Xen</span><br><span class="line"> version: 4.2.amazon</span><br><span class="line"> serial: ec2c5773-d127-c5a4-60a3-221becf4e6ae</span><br><span class="line"> width: 64 bits</span><br><span class="line"> capabilities: smbios-2.7 dmi-2.7 vsyscall32</span><br><span class="line"> configuration: boot=normal uuid=73572CEC-27D1-A4C5-60A3-221BECF4E6AE</span><br><span class="line">  *-core</span><br><span class="line"> description: Motherboard</span><br><span class="line"> physical id: 0</span><br><span class="line">  *-firmware</span><br><span class="line"> description: BIOS</span><br><span class="line"> vendor: Xen</span><br><span class="line"> physical id: 0</span><br><span class="line"> version: 4.2.amazon</span><br><span class="line"> date: 08/24/2006</span><br><span class="line"> size: 96KiB</span><br><span class="line"> capabilities: pci edd</span><br><span class="line">  *-cpu</span><br><span class="line"> description: CPU</span><br><span class="line"> product: Intel(R) Xeon(R) CPU E5-2676 v3 @ 2.40GHz</span><br><span class="line"> vendor: Intel Corp.</span><br><span class="line"> physical id: 401</span><br><span class="line"> bus info: cpu@0</span><br><span class="line"> slot: CPU 1</span><br><span class="line"> size: 2400MHz</span><br><span class="line"> capacity: 2400MHz</span><br><span class="line"> width: 64 bits</span><br><span class="line"> capabilities: fpu fpu_exception wp vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx rdtscp x86-64 constant_tsc rep_good nopl xtopology cpuid pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm cpuid_fault invpcid_single pti fsgsbase bmi1 avx2 smep bmi2 erms invpcid xsaveopt</span><br><span class="line">  *-memory</span><br><span class="line"> description: System Memory</span><br><span class="line"> physical id: 1000</span><br><span class="line"> size: 1GiB</span><br><span class="line"> capacity: 1GiB</span><br><span class="line"> capabilities: ecc</span><br><span class="line"> configuration: errordetection=multi-bit-ecc</span><br><span class="line">  *-bank</span><br><span class="line"> description: DIMM RAM</span><br><span class="line"> physical id: 0</span><br><span class="line"> slot: DIMM 0</span><br><span class="line"> size: 1GiB</span><br><span class="line"> width: 64 bits</span><br><span class="line">  *-pci</span><br><span class="line"> description: Host bridge</span><br><span class="line"> product: 440FX - 82441FX PMC [Natoma]</span><br><span class="line"> vendor: Intel Corporation</span><br><span class="line"> physical id: 100</span><br><span class="line"> bus info: pci@0000:00:00.0</span><br><span class="line"> version: 02</span><br><span class="line"> width: 32 bits</span><br><span class="line"> clock: 33MHz</span><br><span class="line">  *-isa</span><br><span class="line"> description: ISA bridge</span><br><span class="line"> product: 82371SB PIIX3 ISA [Natoma/Triton II]</span><br><span class="line"> vendor: Intel Corporation</span><br><span class="line"> physical id: 1</span><br><span class="line"> bus info: pci@0000:00:01.0</span><br><span class="line"> version: 00</span><br><span class="line"> width: 32 bits</span><br><span class="line"> clock: 33MHz</span><br><span class="line"> capabilities: isa bus_master</span><br><span class="line"> configuration: latency=0</span><br><span class="line">  *-ide</span><br><span class="line"> description: IDE interface</span><br><span class="line"> product: 82371SB PIIX3 IDE [Natoma/Triton II]</span><br><span class="line"> vendor: Intel Corporation</span><br><span class="line"> physical id: 1.1</span><br><span class="line"> bus info: pci@0000:00:01.1</span><br><span class="line"> version: 00</span><br><span class="line"> width: 32 bits</span><br><span class="line"> clock: 33MHz</span><br><span class="line"> capabilities: ide bus_master</span><br><span class="line"> configuration: driver=ata_piix latency=64</span><br><span class="line"> resources: irq:0 ioport:1f0(size=8) ioport:3f6 ioport:170(size=8) ioport:376 ioport:c100(size=16)</span><br><span class="line">  *-bridge UNCLAIMED</span><br><span class="line"> description: Bridge</span><br><span class="line"> product: 82371AB/EB/MB PIIX4 ACPI</span><br><span class="line"> vendor: Intel Corporation</span><br><span class="line"> physical id: 1.3</span><br><span class="line"> bus info: pci@0000:00:01.3</span><br><span class="line"> version: 01</span><br><span class="line"> width: 32 bits</span><br><span class="line"> clock: 33MHz</span><br><span class="line"> capabilities: bridge bus_master</span><br><span class="line"> configuration: latency=0</span><br><span class="line">  *-display UNCLAIMED</span><br><span class="line"> description: VGA compatible controller</span><br><span class="line"> product: GD 5446</span><br><span class="line"> vendor: Cirrus Logic</span><br><span class="line"> physical id: 2</span><br><span class="line"> bus info: pci@0000:00:02.0</span><br><span class="line"> version: 00</span><br><span class="line"> width: 32 bits</span><br><span class="line"> clock: 33MHz</span><br><span class="line"> capabilities: vga_controller bus_master</span><br><span class="line"> configuration: latency=0</span><br><span class="line"> resources: memory:f0000000-f1ffffff memory:f3000000-f3000fff memory:c0000-dffff</span><br><span class="line">  *-generic</span><br><span class="line"> description: Unassigned class</span><br><span class="line"> product: Xen Platform Device</span><br><span class="line"> vendor: XenSource, Inc.</span><br><span class="line"> physical id: 3</span><br><span class="line"> bus info: pci@0000:00:03.0</span><br><span class="line"> version: 01</span><br><span class="line"> width: 32 bits</span><br><span class="line"> clock: 33MHz</span><br><span class="line"> capabilities: bus_master</span><br><span class="line"> configuration: driver=xen-platform-pci latency=0</span><br><span class="line"> resources: irq:28 ioport:c000(size=256) memory:f2000000-f2ffffff</span><br><span class="line">  *-network:0</span><br><span class="line"> description: Ethernet interface</span><br><span class="line"> physical id: 1</span><br><span class="line"> logical name: eth0</span><br><span class="line"> serial: 02:24:d2:49:f2:94</span><br><span class="line"> capabilities: ethernet physical</span><br><span class="line"> configuration: broadcast=yes driver=vif ip=172.26.17.53 link=yes multicast=yes</span><br><span class="line">  *-network:1</span><br><span class="line"> description: Ethernet interface</span><br><span class="line"> physical id: 2</span><br><span class="line"> logical name: docker0</span><br><span class="line"> serial: 02:42:37:cf:cf:aa</span><br><span class="line"> capabilities: ethernet physical</span><br><span class="line"> configuration: broadcast=yes driver=bridge driverversion=2.3 firmware=N/A ip=172.17.0.1 link=no multicast=yes</span><br><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€#</span><br></pre></td></tr></table></figure><h4 id="lsinitramfs"><a href="#lsinitramfs" class="headerlink" title="lsinitramfs"></a>lsinitramfs</h4><blockquote><p>lsinitramfs - list content of an initramfs image</p><p>The  lsinitramfs  command  lists the content of given initramfs images. It allows one to quickly check the content of one (or multiple) specified initramfs files.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># lsinitramfs /boot/initrd.img-4.15.0-58-generic | head -n 10</span></span><br><span class="line">.</span><br><span class="line">usr</span><br><span class="line">usr/share</span><br><span class="line">usr/share/plymouth</span><br><span class="line">usr/share/plymouth/themes</span><br><span class="line">usr/share/plymouth/themes/details</span><br><span class="line">usr/share/plymouth/themes/details/details.plymouth</span><br><span class="line">usr/share/plymouth/themes/text.plymouth</span><br><span class="line">usr/share/plymouth/themes/ubuntu-text</span><br><span class="line">usr/share/plymouth/themes/ubuntu-text/ubuntu-text.plymouth.in</span><br></pre></td></tr></table></figure><h4 id="lsipc"><a href="#lsipc" class="headerlink" title="lsipc"></a>lsipc</h4><blockquote><p>lsipc - show information on IPC facilities currently employed in the system</p><p>lsipc  shows  information on the inter-process communication facilities for which the calling process has read access.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># lsipc</span></span><br><span class="line">RESOURCE DESCRIPTION                                     LIMIT USED  USE%</span><br><span class="line">MSGMNI   Number of message queues                        32000    0 0.00%</span><br><span class="line">MSGMAX   Max size of message (bytes)                      8192    -     -</span><br><span class="line">MSGMNB   Default max size of queue (bytes)               16384    -     -</span><br><span class="line">SHMMNI   Shared memory segments                           4096    1 0.02%</span><br><span class="line">SHMALL   Shared memory pages                           4194304    0 0.00%</span><br><span class="line">SHMMAX   Max size of shared memory segment (bytes) 17179869184    -     -</span><br><span class="line">SHMMIN   Min size of shared memory segment (bytes)           1    -     -</span><br><span class="line">SEMMNI   Number of semaphore identifiers                   262    0 0.00%</span><br><span class="line">SEMMNS   Total number of semaphores                      32000    0 0.00%</span><br><span class="line">SEMMSL   Max semaphores per semaphore <span class="built_in">set</span>.                 250    -     -</span><br><span class="line">SEMOPM   Max number of operations per semop(2)              32    -     -</span><br><span class="line">SEMVMX   Semaphore max value                             32767    -     -</span><br></pre></td></tr></table></figure><h4 id="lslocks"><a href="#lslocks" class="headerlink" title="lslocks"></a>lslocks</h4><blockquote><p>lslocks - list local system locks</p><p>lslocks lists information about all the currently held file locks in a Linux system</p></blockquote><p>åˆ—å‡ºå½“å‰ç³»ç»Ÿä¸­è¢«åŠ é”çš„æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># lslocks</span></span><br><span class="line">COMMAND           PID  TYPE SIZE MODE  M START END PATH</span><br><span class="line">cron              900 FLOCK   4B WRITE 0     0   0 /run/crond.pid</span><br><span class="line">svlogd          53065 FLOCK   0B WRITE 0     0   0 /var/<span class="built_in">log</span>/gitlab/redis/lock</span><br><span class="line">runsv           54095 FLOCK   0B WRITE 0     0   0 /opt/gitlab/sv/sidekiq/supervise/lock</span><br><span class="line">runsv           54095 FLOCK   0B WRITE 0     0   0 /opt/gitlab/sv/sidekiq/<span class="built_in">log</span>/supervise/lock</span><br></pre></td></tr></table></figure><h4 id="lslogins"><a href="#lslogins" class="headerlink" title="lslogins"></a>lslogins</h4><p>åˆ—å‡ºå½“å‰å·²ç»ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯</p><blockquote><p>lslogins - display information about known users in the system</p><p>Examine the wtmp and btmp logs, /etc/shadow (if necessary) and /etc/passwd and output the desired data. The default action is to list info about all the users in the system.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># lslogins</span></span><br><span class="line">  UID USER              PROC PWD-LOCK PWD-DENY LAST-LOGIN GECOS</span><br><span class="line"> 0 root               211        0        0      06:58 root</span><br><span class="line"> 1 daemon               1        0        1            daemon</span><br><span class="line"> 2 bin                  0        0        1            bin</span><br><span class="line"> 3 sys                  0        0        1            sys</span><br><span class="line"> 4 sync                 0        0        1            sync</span><br><span class="line"> 5 games                0        0        1            games</span><br><span class="line"> 6 man                  0        0        1            man</span><br><span class="line"> 7 lp                   0        0        1            lp</span><br><span class="line"> 8 mail                 0        0        1            mail</span><br><span class="line"> 9 news                 0        0        1            news</span><br><span class="line">10 uucp                 0        0        1            uucp</span><br><span class="line">13 proxy                0        0        1            proxy</span><br><span class="line">33 www-data             0        0        1            www-data</span><br><span class="line">34 backup               0        0        1            backup</span><br><span class="line">38 list                 0        0        1            Mailing List Manager</span><br><span class="line">39 irc                  0        0        1            ircd</span><br><span class="line">41 gnats                0        0        1            Gnats Bug-Reporting System (admin)</span><br><span class="line">  100 systemd-network      1        0        1            systemd Network Management,,,</span><br><span class="line">  101 systemd-resolve      1        0        1            systemd Resolver,,,</span><br><span class="line">  102 syslog               1        0        1</span><br><span class="line">  103 messagebus           1        0        1</span><br><span class="line">  104 _apt                 0        0        1</span><br><span class="line">  105 lxd                  0        0        1</span><br><span class="line">  106 uuidd                0        0        1</span><br><span class="line">  107 dnsmasq              0        0        1            dnsmasq,,,</span><br><span class="line">  108 landscape            0        0        1</span><br><span class="line">  109 pollinate            0        0        1</span><br><span class="line">  110 sshd                 0        0        1</span><br><span class="line">  995 gitlab-prometheus    4        0        1</span><br><span class="line">  996 gitlab-psql         18        0        1</span><br><span class="line">  997 gitlab-redis         2        0        1</span><br><span class="line">  998 git                 16        0        1</span><br><span class="line">  999 gitlab-www           5        0        1</span><br><span class="line"> 1000 ubuntu               0        0        0 2019-Aug28 ubuntu</span><br><span class="line">65534 nobody               0        0        1            nobody</span><br></pre></td></tr></table></figure><h4 id="lsmem"><a href="#lsmem" class="headerlink" title="lsmem"></a>lsmem</h4><blockquote><p>lsmem - list the ranges of available memory with their online status</p><p>The  lsmem command lists the ranges of available memory with their online status. The listed memory blocks correspond to the memory block representation in sysfs. The command also shows the memory block  size  and the amount of memory in online and offline state.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># lsmem                                                                                                     127 â†µ</span></span><br><span class="line">RANGE                                  SIZE  STATE REMOVABLE BLOCK</span><br><span class="line">0x0000000000000000-0x0000000007ffffff  128M online        no     0</span><br><span class="line">0x0000000008000000-0x000000000fffffff  128M online       yes     1</span><br><span class="line">0x0000000010000000-0x000000001fffffff  256M online        no   2-3</span><br><span class="line">0x0000000020000000-0x0000000027ffffff  128M online       yes     4</span><br><span class="line">0x0000000028000000-0x0000000037ffffff  256M online        no   5-6</span><br><span class="line">0x0000000038000000-0x000000003fffffff  128M online       yes     7</span><br><span class="line">0x0000000040000000-0x000000006fffffff  768M online        no  8-13</span><br><span class="line">0x0000000070000000-0x0000000077ffffff  128M online       yes    14</span><br><span class="line">0x0000000078000000-0x00000000bfffffff  1.1G online        no 15-23</span><br><span class="line">0x0000000100000000-0x000000013fffffff    1G online        no 32-39</span><br><span class="line"></span><br><span class="line">Memory block size:       128M</span><br><span class="line">Total online memory:       4G</span><br><span class="line">Total offline memory:      0B</span><br></pre></td></tr></table></figure><h4 id="lsmod"><a href="#lsmod" class="headerlink" title="lsmod"></a>lsmod</h4><p>åˆ—å‡ºç³»ç»Ÿå†…æ ¸æ¨¡å—</p><blockquote><p>lsmod - Show the status of modules in the Linux Kernel</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># lsmod</span></span><br><span class="line">Module                  Size  Used by</span><br><span class="line">tcp_diag               16384  0</span><br><span class="line">inet_diag              24576  1 tcp_diag</span><br><span class="line">joydev                 24576  0</span><br><span class="line">input_leds             16384  0</span><br><span class="line">vmw_balloon            20480  0</span><br><span class="line">serio_raw              16384  0</span><br><span class="line">vmw_vsock_vmci_transport    28672  1</span><br><span class="line">vsock                  36864  2 vmw_vsock_vmci_transport</span><br><span class="line">vmw_vmci               69632  2 vmw_balloon,vmw_vsock_vmci_transport</span><br><span class="line">sch_fq_codel           20480  5</span><br><span class="line">ib_iser                49152  0</span><br><span class="line">rdma_cm                61440  1 ib_iser</span><br><span class="line">iw_cm                  45056  1 rdma_cm</span><br><span class="line">ib_cm                  53248  1 rdma_cm</span><br><span class="line">ib_core               225280  4 rdma_cm,iw_cm,ib_iser,ib_cm</span><br><span class="line">iscsi_tcp              20480  0</span><br><span class="line">libiscsi_tcp           20480  1 iscsi_tcp</span><br><span class="line">libiscsi               53248  3 libiscsi_tcp,iscsi_tcp,ib_iser</span><br><span class="line">scsi_transport_iscsi    98304  3 iscsi_tcp,ib_iser,libiscsi</span><br><span class="line">ip_tables              28672  0</span><br><span class="line">x_tables               40960  1 ip_tables</span><br><span class="line">autofs4                40960  2</span><br><span class="line">btrfs                1130496  0</span><br><span class="line">zstd_compress         163840  1 btrfs</span><br><span class="line">raid10                 53248  0</span><br><span class="line">raid456               143360  0</span><br><span class="line">async_raid6_recov      20480  1 raid456</span><br><span class="line">async_memcpy           16384  2 raid456,async_raid6_recov</span><br><span class="line">async_pq               16384  2 raid456,async_raid6_recov</span><br><span class="line">async_xor              16384  3 async_pq,raid456,async_raid6_recov</span><br><span class="line">async_tx               16384  5 async_pq,async_memcpy,async_xor,raid456,async_raid6_recov</span><br><span class="line">xor                    24576  2 async_xor,btrfs</span><br><span class="line">raid6_pq              114688  4 async_pq,btrfs,raid456,async_raid6_recov</span><br><span class="line">libcrc32c              16384  1 raid456</span><br><span class="line">raid1                  40960  0</span><br><span class="line">raid0                  20480  0</span><br><span class="line">multipath              16384  0</span><br><span class="line">linear                 16384  0</span><br><span class="line">crct10dif_pclmul       16384  0</span><br><span class="line">crc32_pclmul           16384  0</span><br><span class="line">ghash_clmulni_intel    16384  0</span><br><span class="line">pcbc                   16384  0</span><br><span class="line">vmwgfx                274432  1</span><br><span class="line">ttm                   106496  1 vmwgfx</span><br><span class="line">drm_kms_helper        172032  1 vmwgfx</span><br><span class="line">aesni_intel           188416  0</span><br><span class="line">syscopyarea            16384  1 drm_kms_helper</span><br><span class="line">aes_x86_64             20480  1 aesni_intel</span><br><span class="line">sysfillrect            16384  1 drm_kms_helper</span><br><span class="line">crypto_simd            16384  1 aesni_intel</span><br><span class="line">sysimgblt              16384  1 drm_kms_helper</span><br><span class="line">glue_helper            16384  1 aesni_intel</span><br><span class="line">fb_sys_fops            16384  1 drm_kms_helper</span><br><span class="line">cryptd                 24576  3 crypto_simd,ghash_clmulni_intel,aesni_intel</span><br><span class="line">psmouse               147456  0</span><br><span class="line">drm                   401408  4 vmwgfx,drm_kms_helper,ttm</span><br><span class="line">mptspi                 24576  2</span><br><span class="line">mptscsih               40960  1 mptspi</span><br><span class="line">mptbase               102400  2 mptspi,mptscsih</span><br><span class="line">ahci                   40960  0</span><br><span class="line">libahci                32768  1 ahci</span><br><span class="line">i2c_piix4              24576  0</span><br><span class="line">vmxnet3                57344  0</span><br><span class="line">scsi_transport_spi     32768  1 mptspi</span><br><span class="line">pata_acpi              16384  0</span><br></pre></td></tr></table></figure><h4 id="lsns-list-namespaces"><a href="#lsns-list-namespaces" class="headerlink" title="lsns - list namespaces"></a>lsns - list namespaces</h4><p>lsns  lists  information  about all the currently accessible namespaces or about the given namespace.  The namespace identifier is an inode number.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># lsns</span></span><br><span class="line">  NS TYPE   NPROCS   PID USER             COMMAND</span><br><span class="line">4026531835 cgroup    264     1 root             /lib/systemd/systemd --system --deserialize 39</span><br><span class="line">4026531836 pid       264     1 root             /lib/systemd/systemd --system --deserialize 39</span><br><span class="line">4026531837 user      264     1 root             /lib/systemd/systemd --system --deserialize 39</span><br><span class="line">4026531838 uts       264     1 root             /lib/systemd/systemd --system --deserialize 39</span><br><span class="line">4026531839 ipc       264     1 root             /lib/systemd/systemd --system --deserialize 39</span><br><span class="line">4026531840 mnt       259     1 root             /lib/systemd/systemd --system --deserialize 39</span><br><span class="line">4026531861 mnt         1    31 root             kdevtmpfs</span><br><span class="line">4026531993 net       264     1 root             /lib/systemd/systemd --system --deserialize 39</span><br><span class="line">4026532531 mnt         1 37609 root             /lib/systemd/systemd-udevd</span><br><span class="line">4026532556 mnt         1 42954 systemd-timesync /lib/systemd/systemd-timesyncd</span><br><span class="line">4026532557 mnt         1 42900 systemd-network  /lib/systemd/systemd-networkd</span><br><span class="line">4026532603 mnt         1 42924 systemd-resolve  /lib/systemd/systemd-resolved</span><br></pre></td></tr></table></figure><h4 id="lsof-list-open-files"><a href="#lsof-list-open-files" class="headerlink" title="lsof - list open files"></a>lsof - list open files</h4><p>lsof åˆ—å‡ºæ‰“å¼€çš„æ–‡ä»¶ã€‚ç»å¯¹æ˜¯ä¸ªæ’æŸ¥æ•…éšœçš„åˆ©å™¨ï¼Œåœ¨ä¸€åˆ‡çš†æ–‡ä»¶çš„ Linux ä¸–ç•Œé‡Œï¼Œlsof å¯ä»¥æŸ¥çœ‹æ‰“å¼€çš„æ–‡ä»¶æ˜¯ï¼š</p><ul><li>æ™®é€šæ–‡ä»¶</li><li>ç›®å½•</li><li>ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶</li><li>å­—ç¬¦æˆ–è®¾å¤‡æ–‡ä»¶</li><li>(å‡½æ•°)å…±äº«åº“</li><li>ç®¡é“ã€å‘½åç®¡é“</li><li>ç¬¦å·é“¾æ¥</li><li>ç½‘ç»œæ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼šNFS fileã€ç½‘ç»œsocketï¼ŒunixåŸŸåsocketï¼‰</li><li>è¿˜æœ‰å…¶å®ƒç±»å‹çš„æ–‡ä»¶ï¼Œç­‰ç­‰</li></ul><p>å¦å¤– lsof å‘½ä»¤ä¹Ÿæ˜¯æœ‰ç€æœ€å¤šé€‰é¡¹çš„Linux/Unixå‘½ä»¤ä¹‹ä¸€ï¼Œå¦ä¸€ä¸ª nc å‘½ä»¤ä¹Ÿæ˜¯å¦‚æ­¤ğŸ˜‚ã€‚</p><ul><li>åˆ—å‡ºç«¯å£å·å ç”¨çš„è¿›ç¨‹</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@blog &#x2F;opt&#x2F;shell</span><br><span class="line">â•°â”€# lsof -i :53      â†µ</span><br><span class="line">COMMAND   PID            USER   FD   TYPE DEVICE SIZE&#x2F;OFF NODE NAME</span><br><span class="line">systemd-r 538 systemd-resolve   12u  IPv4  13925      0t0  UDP localhost:domain</span><br><span class="line">systemd-r 538 systemd-resolve   13u  IPv4  13926      0t0  TCP localhost:domain (LISTEN)</span><br></pre></td></tr></table></figure><blockquote><p>PSï¼šæœ€è¿‘é¢è¯•çš„æ—¶å€™è¢«é—®åˆ°è¿‡</p><p>Qï¼š Linux ä¸‹æŸ¥çœ‹ç«¯å£å ç”¨çš„å‘½ä»¤ï¼Ÿ</p><p>Aï¼š<code>netstat -tunlp</code> ã€<code>ss -tua</code>ã€<code>lsof -i</code> ğŸ˜‚</p></blockquote><h4 id="lspci-list-all-PCI-devices"><a href="#lspci-list-all-PCI-devices" class="headerlink" title="lspci - list all PCI devices"></a>lspci - list all PCI devices</h4><p>åˆ—å‡º PCI è®¾å¤‡ï¼Œæ¯”å¦‚æ˜¾å¡</p><blockquote><p>lspci is a utility for displaying information about PCI buses in the system and devices connected to them.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># lspci</span></span><br><span class="line">00:00.0 Host bridge: Intel Corporation 440BX/ZX/DX - 82443BX/ZX/DX Host bridge (rev 01)</span><br><span class="line">00:01.0 PCI bridge: Intel Corporation 440BX/ZX/DX - 82443BX/ZX/DX AGP bridge (rev 01)</span><br><span class="line">00:07.0 ISA bridge: Intel Corporation 82371AB/EB/MB PIIX4 ISA (rev 08)</span><br><span class="line">00:07.1 IDE interface: Intel Corporation 82371AB/EB/MB PIIX4 IDE (rev 01)</span><br><span class="line">00:07.3 Bridge: Intel Corporation 82371AB/EB/MB PIIX4 ACPI (rev 08)</span><br><span class="line">00:07.7 System peripheral: VMware Virtual Machine Communication Interface (rev 10)</span><br><span class="line">00:0f.0 VGA compatible controller: VMware SVGA II Adapter</span><br><span class="line">00:10.0 SCSI storage controller: LSI Logic / Symbios Logic 53c1030 PCI-X Fusion-MPT Dual Ultra320 SCSI (rev 01)</span><br><span class="line">00:11.0 PCI bridge: VMware PCI bridge (rev 02)</span><br></pre></td></tr></table></figure><h3 id="proc"><a href="#proc" class="headerlink" title="proc"></a>proc</h3><p>ç¡®åˆ‡æ¥è¯´è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œè€Œæ˜¯ Linux çš„å†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£ä¸€äº›ç³»ç»Ÿä¿¡æ¯ï¼Œæ–¹ä¾¿æ’æŸ¥ä¸€äº›æ•…éšœç­‰ã€‚</p><h4 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h4><p><code>cat /proc/cpuinfo</code> å’Œ <code>lscpu</code> äºŒè€…è¾“å‡ºç±»ä¼¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@k8s-master-01</span> <span class="string">~]#</span> <span class="string">cat</span> <span class="string">/proc/cpuinfo</span></span><br><span class="line"><span class="attr">processor       :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">vendor_id       :</span> <span class="string">GenuineIntel</span></span><br><span class="line"><span class="attr">cpu family      :</span> <span class="number">6</span></span><br><span class="line"><span class="attr">model           :</span> <span class="number">60</span></span><br><span class="line"><span class="attr">model name      :</span> <span class="string">Intel(R)</span> <span class="string">Xeon(R)</span> <span class="string">CPU</span> <span class="string">E3-1271</span> <span class="string">v3</span> <span class="string">@</span> <span class="number">3.</span><span class="string">60GHz</span></span><br><span class="line"><span class="attr">stepping        :</span> <span class="number">3</span></span><br><span class="line"><span class="attr">microcode       :</span> <span class="number">0x1c</span></span><br><span class="line"><span class="attr">cpu MHz         :</span> <span class="number">3591.683</span></span><br><span class="line"><span class="attr">cache size      :</span> <span class="number">8192</span> <span class="string">KB</span></span><br><span class="line"><span class="attr">physical id     :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">siblings        :</span> <span class="number">1</span></span><br><span class="line"><span class="attr">core id         :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">cpu cores       :</span> <span class="number">1</span></span><br><span class="line"><span class="attr">apicid          :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">initial apicid  :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">fpu             :</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">fpu_exception   :</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">cpuid level     :</span> <span class="number">13</span></span><br><span class="line"><span class="attr">wp              :</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">flags           :</span> <span class="string">fpu</span> <span class="string">vme</span> <span class="string">de</span> <span class="string">pse</span> <span class="string">tsc</span> <span class="string">msr</span> <span class="string">pae</span> <span class="string">mce</span> <span class="string">cx8</span> <span class="string">apic</span> <span class="string">sep</span> <span class="string">mtrr</span> <span class="string">pge</span> <span class="string">mca</span> <span class="string">cmov</span> <span class="string">pat</span> <span class="string">pse36</span> <span class="string">clflush</span> <span class="string">dts</span> <span class="string">mmx</span> <span class="string">fxsr</span> <span class="string">sse</span> <span class="string">sse2</span> <span class="string">ss</span> <span class="string">syscall</span> <span class="string">nx</span> <span class="string">pdpe1gb</span> <span class="string">rdtscp</span> <span class="string">lm</span> <span class="string">constant_tsc</span> <span class="string">arch_perfmon</span> <span class="string">pebs</span> <span class="string">bts</span> <span class="string">nopl</span> <span class="string">xtopology</span> <span class="string">tsc_reliable</span> <span class="string">nonstop_tsc</span> <span class="string">aperfmperf</span> <span class="string">eagerfpu</span> <span class="string">pni</span> <span class="string">pclmulqdq</span> <span class="string">ssse3</span> <span class="string">fma</span> <span class="string">cx16</span> <span class="string">pcid</span> <span class="string">sse4_1</span> <span class="string">sse4_2</span> <span class="string">x2apic</span> <span class="string">movbe</span> <span class="string">popcnt</span> <span class="string">tsc_deadline_timer</span> <span class="string">aes</span> <span class="string">xsave</span> <span class="string">avx</span> <span class="string">f16c</span> <span class="string">rdrand</span> <span class="string">hypervisor</span> <span class="string">lahf_lm</span> <span class="string">abm</span> <span class="string">epb</span> <span class="string">fsgsbase</span> <span class="string">tsc_adjust</span> <span class="string">bmi1</span> <span class="string">avx2</span> <span class="string">smep</span> <span class="string">bmi2</span> <span class="string">invpcid</span> <span class="string">xsaveopt</span> <span class="string">dtherm</span> <span class="string">ida</span> <span class="string">arat</span> <span class="string">pln</span> <span class="string">pts</span></span><br><span class="line"><span class="attr">bogomips        :</span> <span class="number">7183.36</span></span><br><span class="line"><span class="attr">clflush size    :</span> <span class="number">64</span></span><br><span class="line"><span class="attr">cache_alignment :</span> <span class="number">64</span></span><br><span class="line"><span class="attr">address sizes   :</span> <span class="number">42</span> <span class="string">bits</span> <span class="string">physical,</span> <span class="number">48</span> <span class="string">bits</span> <span class="string">virtual</span></span><br><span class="line"><span class="attr">power management:</span></span><br></pre></td></tr></table></figure><h4 id="RAM"><a href="#RAM" class="headerlink" title="RAM"></a>RAM</h4><p>ç”¨æ¥æŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿå†…å­˜çš„ä¿¡æ¯ï¼Œå¦å¤– free å‘½ä»¤æ˜¯ä» /proc/meminfo ä¸­è¯»å–ä¿¡æ¯çš„ï¼Œè·Ÿæˆ‘ä»¬ç›´æ¥è¯»åˆ°çš„ç»“æœä¸€æ ·ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@k8s-master-01</span> <span class="string">proc]#</span> <span class="string">cat</span> <span class="string">meminfo</span></span><br><span class="line"><span class="attr">MemTotal:</span>        <span class="number">3863636</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">MemFree:</span>          <span class="number">247016</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">MemAvailable:</span>    <span class="number">2096628</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Buffers:</span>           <span class="number">85612</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Cached:</span>          <span class="number">1952072</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">SwapCached:</span>            <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Active:</span>          <span class="number">2250028</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Inactive:</span>        <span class="number">1003588</span> <span class="string">kB</span></span><br><span class="line"><span class="string">Active(anon):</span>    <span class="number">1224120</span> <span class="string">kB</span></span><br><span class="line"><span class="string">Inactive(anon):</span>    <span class="number">21344</span> <span class="string">kB</span></span><br><span class="line"><span class="string">Active(file):</span>    <span class="number">1025908</span> <span class="string">kB</span></span><br><span class="line"><span class="string">Inactive(file):</span>   <span class="number">982244</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Unevictable:</span>           <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Mlocked:</span>               <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">SwapTotal:</span>             <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">SwapFree:</span>              <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Dirty:</span>               <span class="number">128</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Writeback:</span>             <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">AnonPages:</span>       <span class="number">1215816</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Mapped:</span>           <span class="number">196080</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Shmem:</span>             <span class="number">29532</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Slab:</span>             <span class="number">222544</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">SReclaimable:</span>      <span class="number">92156</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">SUnreclaim:</span>       <span class="number">130388</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">KernelStack:</span>       <span class="number">15904</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">PageTables:</span>        <span class="number">13024</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">NFS_Unstable:</span>          <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Bounce:</span>                <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">WritebackTmp:</span>          <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">CommitLimit:</span>     <span class="number">1931816</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Committed_AS:</span>    <span class="number">7402668</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">VmallocTotal:</span>   <span class="number">34359738367</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">VmallocUsed:</span>      <span class="number">187276</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">VmallocChunk:</span>   <span class="number">34359310332</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">HardwareCorrupted:</span>     <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">AnonHugePages:</span>    <span class="number">264192</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">CmaTotal:</span>              <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">CmaFree:</span>               <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">HugePages_Total:</span>       <span class="number">0</span></span><br><span class="line"><span class="attr">HugePages_Free:</span>        <span class="number">0</span></span><br><span class="line"><span class="attr">HugePages_Rsvd:</span>        <span class="number">0</span></span><br><span class="line"><span class="attr">HugePages_Surp:</span>        <span class="number">0</span></span><br><span class="line"><span class="attr">Hugepagesize:</span>       <span class="number">2048</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">DirectMap4k:</span>      <span class="number">206720</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">DirectMap2M:</span>     <span class="number">3987456</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">DirectMap1G:</span>     <span class="number">2097152</span> <span class="string">kB</span></span><br></pre></td></tr></table></figure><ul><li><p>bufferï¼šè¡¨ç¤ºå—è®¾å¤‡(block device)æ‰€å ç”¨çš„ç¼“å­˜é¡µï¼ŒåŒ…æ‹¬ï¼šç›´æ¥è¯»å†™å—è®¾å¤‡ã€ä»¥åŠæ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®(metadata)æ¯”å¦‚SuperBlockæ‰€ä½¿ç”¨çš„ç¼“å­˜é¡µï¼›</p></li><li><p>cacheï¼šè¡¨ç¤ºæ™®é€šæ–‡ä»¶æ•°æ®æ‰€å ç”¨çš„ç¼“å­˜é¡µã€‚</p></li></ul><p>äºŒè€…çš„åŒºåˆ«æ¨èé˜…è¯» <a href="http://linuxperf.com/?p=32" target="_blank" rel="noopener">FREEå‘½ä»¤æ˜¾ç¤ºçš„BUFFERSä¸CACHEDçš„åŒºåˆ«</a>ï¼Œä» Linux å†…æ ¸æºç æ¥åŒºåˆ†ã€‚</p><h4 id="net"><a href="#net" class="headerlink" title="net"></a>net</h4><ul><li>arp</li></ul><p>ç”¨æ¥æŸ¥çœ‹ç³»ç»Ÿ arp ç¼“å­˜çš„æ˜ å°„è¡¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-node-3 /proc/net</span><br><span class="line">â•°â”€# cat arp</span><br><span class="line">IP address       HW type     Flags       HW address            Mask     Device</span><br><span class="line">169.254.169.254  0x1         0x0         00:00:00:00:00:00     *        ens160</span><br><span class="line">100.78.36.67     0x1         0x2         ee:25:17:a5:e9:3b     *        cali35f7ecfd8a4</span><br><span class="line">10.20.172.212    0x1         0x2         00:0c:29:16:f5:1f     *        ens160</span><br><span class="line">100.78.36.65     0x1         0x2         d6:80:af:8a:22:c7     *        calid838acfbeda</span><br><span class="line">10.20.172.1      0x1         0x2         00:00:5e:00:01:3a     *        ens160</span><br><span class="line">10.20.172.102    0x1         0x2         00:21:91:53:e8:a3     *        ens160</span><br><span class="line">10.20.172.254    0x1         0x2         5c:dd:70:05:e8:53     *        ens160</span><br><span class="line">10.20.172.106    0x1         0x2         98:90:96:d0:86:8a     *        ens160</span><br></pre></td></tr></table></figure><ul><li>route</li></ul><p>ä»¥æ ‘çº§ç»“æ„åˆ—å‡ºç³»ç»Ÿçš„è·¯ç”±è¡¨ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-node-3 ~</span><br><span class="line">â•°â”€# cat /proc/net/fib_trie</span><br><span class="line">Main:</span><br><span class="line">  +-- 0.0.0.0/0 3 1 5</span><br><span class="line">  +-- 0.0.0.0/4 2 0 2</span><br><span class="line">  |-- 0.0.0.0</span><br><span class="line">  /0 universe UNICAST</span><br><span class="line">  +-- 10.0.0.0/9 2 0 2</span><br><span class="line">  +-- 10.20.172.0/24 2 1 2</span><br><span class="line">  |-- 10.20.172.0</span><br><span class="line">  /32 link BROADCAST</span><br><span class="line">  /24 link UNICAST</span><br><span class="line">  +-- 10.20.172.192/26 2 0 2</span><br><span class="line">  |-- 10.20.172.211</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.20.172.255</span><br><span class="line">  /32 link BROADCAST</span><br><span class="line">  +-- 10.96.0.0/12 4 1 7</span><br><span class="line">  +-- 10.96.0.0/16 2 0 1</span><br><span class="line">  +-- 10.96.0.0/28 2 0 2</span><br><span class="line">  |-- 10.96.0.1</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.96.0.10</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.96.94.140</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.96.130.114</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.99.89.188</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.101.71.131</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.104.241.211</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.107.246.53</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.108.171.54</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.109.20.145</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.110.206.28</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.111.25.53</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  +-- 96.0.0.0/3 2 0 2</span><br><span class="line">  +-- 100.64.0.0/10 3 0 3</span><br><span class="line">  +-- 100.78.36.64/26 3 0 6</span><br><span class="line">  +-- 100.78.36.64/30 2 0 0</span><br><span class="line">  |-- 100.78.36.64</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  /32 link BROADCAST</span><br><span class="line">  /26 universe BLACKHOLE</span><br><span class="line">  |-- 100.78.36.65</span><br><span class="line">  /32 link UNICAST</span><br><span class="line">  |-- 100.78.36.66</span><br><span class="line">  /32 link UNICAST</span><br><span class="line">  |-- 100.78.36.67</span><br><span class="line">  /32 link UNICAST</span><br><span class="line">  |-- 100.78.36.105</span><br><span class="line">  /32 link UNICAST</span><br><span class="line">  |-- 100.87.114.192</span><br><span class="line">  /26 universe UNICAST</span><br><span class="line">  |-- 100.107.127.64</span><br><span class="line">  /26 universe UNICAST</span><br><span class="line">  |-- 100.112.151.128</span><br><span class="line">  /26 universe UNICAST</span><br><span class="line">  |-- 100.123.190.192</span><br><span class="line">  /26 universe UNICAST</span><br><span class="line">  +-- 127.0.0.0/8 2 0 2</span><br><span class="line">  +-- 127.0.0.0/31 1 0 0</span><br><span class="line">  |-- 127.0.0.0</span><br><span class="line">  /32 link BROADCAST</span><br><span class="line">  /8 host LOCAL</span><br><span class="line">  |-- 127.0.0.1</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 127.255.255.255</span><br><span class="line">  /32 link BROADCAST</span><br><span class="line">  +-- 168.0.0.0/5 2 0 2</span><br><span class="line">  |-- 169.254.0.0</span><br><span class="line">  /16 link UNICAST</span><br><span class="line">  +-- 172.16.0.0/14 3 0 6</span><br><span class="line">  +-- 172.17.0.0/31 1 0 0</span><br><span class="line">  |-- 172.17.0.0</span><br><span class="line">  /32 link BROADCAST</span><br><span class="line">  /16 link UNICAST</span><br><span class="line">  |-- 172.17.0.1</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 172.17.255.255</span><br><span class="line">  /32 link BROADCAST</span><br></pre></td></tr></table></figure><ul><li>nf_conntrack</li></ul><blockquote><p>nf_conntrack(åœ¨è€ç‰ˆæœ¬çš„ Linux å†…æ ¸ä¸­å« ip_conntrack)æ˜¯ä¸€ä¸ªå†…æ ¸æ¨¡å—,ç”¨äºè·Ÿè¸ªä¸€ä¸ªè¿æ¥çš„çŠ¶æ€çš„ã€‚è¿æ¥çŠ¶æ€è·Ÿè¸ªå¯ä»¥ä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨,æœ€å¸¸è§çš„ä¸¤ä¸ªä½¿ç”¨åœºæ™¯æ˜¯ iptables çš„ nat çš„ state æ¨¡å—ã€‚ iptables çš„ nat é€šè¿‡è§„åˆ™æ¥ä¿®æ”¹ç›®çš„/æºåœ°å€,ä½†å…‰ä¿®æ”¹åœ°å€ä¸è¡Œ,æˆ‘ä»¬è¿˜éœ€è¦èƒ½è®©å›æ¥çš„åŒ…èƒ½è·¯ç”±åˆ°æœ€åˆçš„æ¥æºä¸»æœºã€‚è¿™å°±éœ€è¦å€ŸåŠ© nf_conntrack æ¥æ‰¾åˆ°åŸæ¥é‚£ä¸ªè¿æ¥çš„è®°å½•æ‰è¡Œã€‚è€Œ state æ¨¡å—åˆ™æ˜¯ç›´æ¥ä½¿ç”¨ nf_conntrack é‡Œè®°å½•çš„è¿æ¥çš„çŠ¶æ€æ¥åŒ¹é…ç”¨æˆ·å®šä¹‰çš„ç›¸å…³è§„åˆ™ã€‚ä¾‹å¦‚ä¸‹é¢è¿™æ¡ INPUT è§„åˆ™ç”¨äºæ”¾è¡Œ 80 ç«¯å£ä¸Šçš„çŠ¶æ€ä¸º NEW çš„è¿æ¥ä¸Šçš„åŒ…ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-node-3 /proc/net</span><br><span class="line">â•°â”€# cat nf_conntrack | head -n 4</span><br><span class="line">ipv4     2 tcp      6 102 SYN_SENT src=10.20.172.211 dst=10.10.107.214 sport=42562 dport=179 [UNREPLIED] src=10.10.107.214 dst=10.20.172.211 sport=179 dport=42562 mark=0 secctx=system_u:object_r:unlabeled_t:s0 zone=0 use=2</span><br><span class="line">ipv4     2 tcp      6 79 SYN_SENT src=10.20.172.211 dst=10.10.107.214 sport=60579 dport=179 [UNREPLIED] src=10.10.107.214 dst=10.20.172.211 sport=179 dport=60579 mark=0 secctx=system_u:object_r:unlabeled_t:s0 zone=0 use=2</span><br><span class="line">ipv4     2 tcp      6 86366 ESTABLISHED src=10.20.172.211 dst=10.10.107.121 sport=58589 dport=179 src=10.10.107.121 dst=10.20.172.211 sport=179 dport=58589 [ASSURED] mark=0 secctx=system_u:object_r:unlabeled_t:s0 zone=0 use=2</span><br><span class="line">ipv4     2 tcp      6 62 SYN_SENT src=10.20.172.211 dst=10.10.107.214 sport=37531 dport=179 [UNREPLIED] src=10.10.107.214 dst=10.20.172.211 sport=179 dport=37531 mark=0 secctx=system_u:object_r:unlabeled_t:s0 zone=0 use=2</span><br></pre></td></tr></table></figure><ul><li><a href="http://www.linvon.cn/post/%E8%BF%9E%E6%8E%A5%E8%B7%9F%E8%B8%AAnf_conntrack%E4%B8%8Enat%E5%92%8C%E7%8A%B6%E6%80%81iptables/" target="_blank" rel="noopener">è¿æ¥è·Ÿè¸ªnf_conntrackä¸NATå’ŒçŠ¶æ€é˜²ç«å¢™</a></li><li><a href="https://www.cnblogs.com/liushaodong/archive/2013/02/26/2933593.html" target="_blank" rel="noopener">netfilter é“¾æ¥è·Ÿè¸ªæœºåˆ¶ä¸NATåŸç†</a></li><li><a href="http://blog.chinaunix.net/uid-23069658-id-3169450.html" target="_blank" rel="noopener">(äº”)æ´æ‚‰linuxä¸‹çš„Netfilter&amp;iptablesï¼šå¦‚ä½•ç†è§£è¿æ¥è·Ÿè¸ªæœºåˆ¶ï¼Ÿ</a></li><li><a href="https://clodfisher.github.io/2018/09/nf_conntrack/" target="_blank" rel="noopener">Iptablesä¹‹nf_conntrackæ¨¡å—</a></li></ul><h4 id="kernel"><a href="#kernel" class="headerlink" title="kernel"></a>kernel</h4><p>å¯ä»¥ç”¨æ¥æŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-01 proc]# uname -a</span><br><span class="line">Linux k8s-master-01 3.10.0-862.el7.x86_64 #1 SMP Fri Apr 20 16:44:24 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line">[root@k8s-master-01 proc]# cat version</span><br><span class="line">Linux version 3.10.0-862.el7.x86_64 (builder@kbuilder.dev.centos.org) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-28) (GCC) ) #1 SMP Fri Apr 20 16:44:24 UTC 2018</span><br></pre></td></tr></table></figure><h3 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h3><h4 id="nc-netcat"><a href="#nc-netcat" class="headerlink" title="nc netcat"></a>nc netcat</h4><p>nc æ˜¯ä¸ªç‘å£«å†›åˆ€å•Šï¼Œä½ èƒ½æƒ³åˆ°çš„ä½ æƒ³ä¸åˆ°çš„éƒ½èƒ½åšï¼Œåœ¨è¿™é‡Œä»…ä»…åˆ—å‡ºå‡ ä¸ªå¸¸ç”¨å¸¸ç”¨çš„å‘½ä»¤ï¼Œå’±å¹³æ—¶ä¸»è¦ç”¨æ¥åˆ¤æ–­ä¸»æœºç«¯å£æ˜¯å¦æ­£å¸¸ï¼Œæƒ³è¦å®Œæ•´åœ°äº†è§£æ¨èé˜…è¯»ä¸‹é¢æåˆ°çš„æ–‡ç« ã€‚ä¹‹å‰ç¼–ç¨‹éšæƒ³å¤§ä½¬ä¹Ÿå†™è¿‡ nc å‘½ä»¤çš„ä½¿ç”¨è¯¦è§£ã€‚</p><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> RHEL/CentOS</span></span><br><span class="line">yum install netcat</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian/Ubuntu</span></span><br><span class="line">apt install netcat</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ä¸»æœºç«¯å£æ˜¯å¦æ‰“å¼€</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹è¿œç¨‹ä¸»æœºç«¯å£æ˜¯å¦æ‰“å¼€</span></span><br><span class="line">â•­â”€root@blog /opt/shell</span><br><span class="line">â•°â”€# nc -vz bing.com 443</span><br><span class="line">DNS fwd/rev mismatch: bing.com != a-0001.a-msedge.net</span><br><span class="line">Warning: inverse host lookup failed for 13.107.21.200: Unknown host</span><br><span class="line">bing.com [204.79.197.200] 443 (https) open</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æœ¬æœºç«¯å£æ˜¯å¦è¢«å ç”¨</span></span><br><span class="line">â•­â”€root@blog /opt/shell</span><br><span class="line">â•°â”€# nc -lp 80 -v                                                                    1 â†µ</span><br><span class="line">retrying local 0.0.0.0:80 : Address already in use</span><br></pre></td></tr></table></figure><ul><li>ç”¨ nc ä¼ è¾“æ–‡ä»¶</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ¥æ”¶ç«¯ã€‘ï¼ˆB ä¸»æœºï¼‰è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ˆå…¶ä¸­çš„ xxx æ˜¯ç«¯å£å·ï¼‰</span></span><br><span class="line">nc -l -p xxx &gt; file2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç„¶ååœ¨ã€å‘é€ç«¯ã€‘ï¼ˆA ä¸»æœºï¼‰è¿è¡Œå¦‚ä¸‹å‘½ä»¤</span></span><br><span class="line">nc x.x.x.x xxx &lt; file1</span><br></pre></td></tr></table></figure><ul><li><a href="https://program-think.blogspot.com/2019/09/Netcat-Tricks.html" target="_blank" rel="noopener">æ‰«ç›² netcatï¼ˆç½‘çŒ«ï¼‰çš„ N ç§ç”¨æ³•â€”â€”ä»â€œç½‘ç»œè¯Šæ–­â€åˆ°â€œç³»ç»Ÿå…¥ä¾µâ€</a></li></ul><h4 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h4><p>nmap å‘½ä»¤ç”¨çš„æœ€å¤šçš„å°±æ˜¯ç«¯å£æ‰«æï¼Œåœ¨æ¸—é€é¢†åŸŸå¤šç”¨æ¥æ‰«æå†…ç½‘æœºå™¨ã€‚</p><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> RHEL/CentOS</span></span><br><span class="line">yum install nmap</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian/Ubuntu</span></span><br><span class="line">apt install nmap</span><br></pre></td></tr></table></figure><ul><li>æ‰«æç±»å‹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-sT    TCP connect() æ‰«æï¼Œè¿™æ˜¯æœ€åŸºæœ¬çš„ TCP æ‰«ææ–¹å¼ã€‚è¿™ç§æ‰«æå¾ˆå®¹æ˜“è¢«æ£€æµ‹åˆ°ï¼Œåœ¨ç›®æ ‡ä¸»æœºçš„æ—¥å¿—ä¸­ä¼šè®°å½•å¤§æ‰¹çš„è¿æ¥è¯·æ±‚ä»¥åŠé”™è¯¯ä¿¡æ¯ã€‚</span><br><span class="line">-sS    TCP åŒæ­¥æ‰«æ (TCP SYN)ï¼Œå› ä¸ºä¸å¿…å…¨éƒ¨æ‰“å¼€ä¸€ä¸ª TCP è¿æ¥ï¼Œæ‰€ä»¥è¿™é¡¹æŠ€æœ¯é€šå¸¸ç§°ä¸ºåŠå¼€æ‰«æ (half-open)ã€‚è¿™é¡¹æŠ€æœ¯æœ€å¤§çš„å¥½å¤„æ˜¯ï¼Œå¾ˆå°‘æœ‰ç³»ç»Ÿèƒ½å¤ŸæŠŠè¿™è®°å…¥ç³»ç»Ÿæ—¥å¿—ã€‚ä¸è¿‡ï¼Œä½ éœ€è¦ root æƒé™æ¥å®šåˆ¶ SYN æ•°æ®åŒ…ã€‚</span><br><span class="line">-sF,-sX,-sN    ç§˜å¯† FIN æ•°æ®åŒ…æ‰«æã€åœ£è¯æ ‘ (Xmas Tree)ã€ç©º (Null) æ‰«ææ¨¡å¼ã€‚è¿™äº›æ‰«ææ–¹å¼çš„ç†è®ºä¾æ®æ˜¯ï¼šå…³é—­çš„ç«¯å£éœ€è¦å¯¹ä½ çš„æ¢æµ‹åŒ…å›åº” RST åŒ…ï¼Œè€Œæ‰“å¼€çš„ç«¯å£å¿…éœ€å¿½ç•¥æœ‰é—®é¢˜çš„åŒ…ï¼ˆå‚è€ƒ RFC 793 ç¬¬ 64 é¡µï¼‰ã€‚</span><br><span class="line">-sP    ping æ‰«æï¼Œç”¨ ping æ–¹å¼æ£€æŸ¥ç½‘ç»œä¸Šå“ªäº›ä¸»æœºæ­£åœ¨è¿è¡Œã€‚å½“ä¸»æœºé˜»å¡ ICMP echo è¯·æ±‚åŒ…æ˜¯ ping æ‰«ææ˜¯æ— æ•ˆçš„ã€‚nmap åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¼šè¿›è¡Œ ping æ‰«æï¼Œåªæœ‰ç›®æ ‡ä¸»æœºå¤„äºè¿è¡ŒçŠ¶æ€ï¼Œæ‰ä¼šè¿›è¡Œåç»­çš„æ‰«æã€‚</span><br><span class="line">-sU    UDP çš„æ•°æ®åŒ…è¿›è¡Œæ‰«æï¼Œå¦‚æœä½ æƒ³çŸ¥é“åœ¨æŸå°ä¸»æœºä¸Šæä¾›å“ªäº› UDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼ŒRFC768) æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨æ­¤é€‰é¡¹ã€‚</span><br><span class="line">-sA    ACK æ‰«æï¼Œè¿™é¡¹é«˜çº§çš„æ‰«ææ–¹æ³•é€šå¸¸å¯ä»¥ç”¨æ¥ç©¿è¿‡é˜²ç«å¢™ã€‚</span><br><span class="line">-sW    æ»‘åŠ¨çª—å£æ‰«æï¼Œéå¸¸ç±»ä¼¼äº ACK çš„æ‰«æã€‚</span><br><span class="line">-sR    RPC æ‰«æï¼Œå’Œå…¶å®ƒä¸åŒçš„ç«¯å£æ‰«ææ–¹æ³•ç»“åˆä½¿ç”¨ã€‚</span><br><span class="line">-b    FTP åå¼¹æ”»å‡» (bounce attack)ï¼Œè¿æ¥åˆ°é˜²ç«å¢™åé¢çš„ä¸€å° FTP æœåŠ¡å™¨åšä»£ç†ï¼Œæ¥ç€è¿›è¡Œç«¯å£æ‰«æã€‚</span><br></pre></td></tr></table></figure><ul><li>æ‰«æå‚æ•°</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-P0    åœ¨æ‰«æä¹‹å‰ï¼Œä¸ ping ä¸»æœºã€‚</span><br><span class="line">-PT    æ‰«æä¹‹å‰ï¼Œä½¿ç”¨ TCP ping ç¡®å®šå“ªäº›ä¸»æœºæ­£åœ¨è¿è¡Œã€‚</span><br><span class="line">-PS    å¯¹äº root ç”¨æˆ·ï¼Œè¿™ä¸ªé€‰é¡¹è®© nmap ä½¿ç”¨ SYN åŒ…è€Œä¸æ˜¯ ACK åŒ…æ¥å¯¹ç›®æ ‡ä¸»æœºè¿›è¡Œæ‰«æã€‚</span><br><span class="line">-PI    è®¾ç½®è¿™ä¸ªé€‰é¡¹ï¼Œè®© nmap ä½¿ç”¨çœŸæ­£çš„ ping(ICMP echo è¯·æ±‚ï¼‰æ¥æ‰«æç›®æ ‡ä¸»æœºæ˜¯å¦æ­£åœ¨è¿è¡Œã€‚</span><br><span class="line">-PB    è¿™æ˜¯é»˜è®¤çš„ ping æ‰«æé€‰é¡¹ã€‚å®ƒä½¿ç”¨ ACK(-PT) å’Œ ICMP(-PI) ä¸¤ç§æ‰«æç±»å‹å¹¶è¡Œæ‰«æã€‚å¦‚æœé˜²ç«å¢™èƒ½å¤Ÿè¿‡æ»¤å…¶ä¸­ä¸€ç§åŒ…ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œä½ å°±èƒ½å¤Ÿç©¿è¿‡é˜²ç«å¢™ã€‚</span><br><span class="line">-O    è¿™ä¸ªé€‰é¡¹æ¿€æ´»å¯¹ TCP/IP æŒ‡çº¹ç‰¹å¾ (fingerprinting) çš„æ‰«æï¼Œè·å¾—è¿œç¨‹ä¸»æœºçš„æ ‡å¿—ï¼Œä¹Ÿå°±æ˜¯æ“ä½œç³»ç»Ÿç±»å‹ã€‚</span><br><span class="line">-I    æ‰“å¼€ nmap çš„åå‘æ ‡å¿—æ‰«æåŠŸèƒ½ã€‚</span><br><span class="line">-f    ä½¿ç”¨ç¢ç‰‡ IP æ•°æ®åŒ…å‘é€ SYNã€FINã€XMASã€NULLã€‚åŒ…å¢åŠ åŒ…è¿‡æ»¤ã€å…¥ä¾µæ£€æµ‹ç³»ç»Ÿçš„éš¾åº¦ï¼Œä½¿å…¶æ— æ³•çŸ¥é“ä½ çš„ä¼å›¾ã€‚</span><br><span class="line">-v    å†—ä½™æ¨¡å¼ã€‚å¼ºçƒˆæ¨èä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œå®ƒä¼šç»™å‡ºæ‰«æè¿‡ç¨‹ä¸­çš„è¯¦ç»†ä¿¡æ¯ã€‚</span><br><span class="line">-S &lt;IP&gt;    åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œnmap å¯èƒ½æ— æ³•ç¡®å®šä½ çš„æºåœ°å€ (nmap ä¼šå‘Šè¯‰ä½ ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä½¿ç”¨è¿™ä¸ªé€‰é¡¹ç»™å‡ºä½ çš„ IP åœ°å€ã€‚</span><br><span class="line">-g port    è®¾ç½®æ‰«æçš„æºç«¯å£ã€‚ä¸€äº›å¤©çœŸçš„é˜²ç«å¢™å’ŒåŒ…è¿‡æ»¤å™¨çš„è§„åˆ™é›†å…è®¸æºç«¯å£ä¸º DNS(53) æˆ–è€… FTP-DATA(20) çš„åŒ…é€šè¿‡å’Œå®ç°è¿æ¥ã€‚æ˜¾ç„¶ï¼Œå¦‚æœæ”»å‡»è€…æŠŠæºç«¯å£ä¿®æ”¹ä¸º 20 æˆ–è€… 53ï¼Œå°±å¯ä»¥æ‘§æ¯é˜²ç«å¢™çš„é˜²æŠ¤ã€‚</span><br><span class="line">-oN    æŠŠæ‰«æç»“æœé‡å®šå‘åˆ°ä¸€ä¸ªå¯è¯»çš„æ–‡ä»¶ logfilename ä¸­ã€‚</span><br><span class="line">-oS    æ‰«æç»“æœè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚</span><br><span class="line">--host_timeout    è®¾ç½®æ‰«æä¸€å°ä¸»æœºçš„æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰è¶…æ—¶é™åˆ¶ã€‚</span><br><span class="line">--max_rtt_timeout    è®¾ç½®å¯¹æ¯æ¬¡æ¢æµ‹çš„ç­‰å¾…æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚å¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´é™åˆ¶å°±é‡ä¼ æˆ–è€…è¶…æ—¶ã€‚é»˜è®¤å€¼æ˜¯å¤§çº¦ 9000 æ¯«ç§’ã€‚</span><br><span class="line">--min_rtt_timeout    è®¾ç½® nmap å¯¹æ¯æ¬¡æ¢æµ‹è‡³å°‘ç­‰å¾…ä½ æŒ‡å®šçš„æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚</span><br><span class="line">-M count    ç½®è¿›è¡Œ TCP connect() æ‰«ææ—¶ï¼Œæœ€å¤šä½¿ç”¨å¤šå°‘ä¸ªå¥—æ¥å­—è¿›è¡Œå¹¶è¡Œçš„æ‰«æã€‚</span><br></pre></td></tr></table></figure><ul><li>è·å–è¿œç¨‹ä¸»æœºç³»ç»Ÿç±»å‹å’Œå¼€æ”¾ç«¯å£</li></ul><p>ç²—æš´ç‚¹å°± <code>nmap -A IP</code>ï¼Œæˆ–è€… <code>nmap -sS -P0 -sV -O</code></p><ul><li>æ¢æµ‹å†…ç½‘åœ¨çº¿ä¸»æœº</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.0.0/24</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><h4 id="fio"><a href="#fio" class="headerlink" title="fio"></a><a href="https://github.com/axboe/fio" target="_blank" rel="noopener">fio</a></h4><p>ç”¨æ¥åšç£ç›˜æ€§èƒ½æµ‹è¯•ï¼Œååˆ†å¼ºå¤§çš„ç£ç›˜æ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œå¯é…ç½®é¡¹å’Œå‚æ•°ä¹Ÿå¾ˆä¸°å¯Œã€‚</p><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> RHEL/CentOS</span></span><br><span class="line">yum install fio</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian/Ubuntu</span></span><br><span class="line">apt install fio</span><br></pre></td></tr></table></figure><ul><li>usage</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">filename</span>=/tmp        <span class="comment"># æµ‹è¯•æ–‡ä»¶åç§°ï¼Œé€šå¸¸é€‰æ‹©éœ€è¦æµ‹è¯•çš„ç›˜çš„ data ç›®å½•</span></span><br><span class="line"><span class="attr">direct</span>=<span class="number">1</span>             <span class="comment"># æµ‹è¯•è¿‡ç¨‹ç»•è¿‡æœºå™¨è‡ªå¸¦çš„ bufferã€‚ä½¿æµ‹è¯•ç»“æœæ›´çœŸå®</span></span><br><span class="line"><span class="attr">rw</span>=randwrite         <span class="comment"># æµ‹è¯•éšæœºå†™çš„ I/O</span></span><br><span class="line"><span class="attr">rw</span>=randrw            <span class="comment"># æµ‹è¯•éšæœºå†™å’Œè¯»çš„ I/O</span></span><br><span class="line"><span class="attr">bs</span>=<span class="number">16</span>k               <span class="comment"># å•æ¬¡ io çš„å—æ–‡ä»¶å¤§å°ä¸º 16k</span></span><br><span class="line"><span class="attr">bsrange</span>=<span class="number">512</span>-<span class="number">2048</span>     <span class="comment"># åŒä¸Šï¼Œæå®šæ•°æ®å—çš„å¤§å°èŒƒå›´</span></span><br><span class="line"><span class="attr">size</span>=<span class="number">5</span>G              <span class="comment"># æœ¬æ¬¡çš„æµ‹è¯•æ–‡ä»¶å¤§å°ä¸º 5gï¼Œä»¥æ¯æ¬¡ 4k çš„ io è¿›è¡Œæµ‹è¯•</span></span><br><span class="line"><span class="attr">numjobs</span>=<span class="number">30</span>           <span class="comment"># æœ¬æ¬¡çš„æµ‹è¯•çº¿ç¨‹ä¸º 30 ä¸ª</span></span><br><span class="line"><span class="attr">runtime</span>=<span class="number">1000</span>         <span class="comment"># æµ‹è¯•æ—¶é—´ 1000 ç§’ï¼Œå¦‚æœä¸å†™åˆ™ä¸€ç›´å°† 5g æ–‡ä»¶åˆ† 4k æ¯æ¬¡å†™å®Œä¸ºæ­¢</span></span><br><span class="line"><span class="attr">ioengine</span>=psync       <span class="comment">#io å¼•æ“ä½¿ç”¨ psync æ–¹å¼</span></span><br><span class="line"><span class="attr">rwmixwrite</span>=<span class="number">30</span>        <span class="comment"># åœ¨æ··åˆè¯»å†™çš„æ¨¡å¼ä¸‹ï¼Œå†™å  30%</span></span><br><span class="line">group_reporting      # å…³äºæ˜¾ç¤ºç»“æœçš„ï¼Œæ±‡æ€»æ¯ä¸ªè¿›ç¨‹çš„ä¿¡æ¯</span><br><span class="line"></span><br><span class="line"><span class="attr">lockmem</span>=<span class="number">1</span>G           <span class="comment"># åªä½¿ç”¨ 1g å†…å­˜è¿›è¡Œæµ‹è¯•s</span></span><br><span class="line">zero_buffers         # ç”¨ 0 åˆå§‹åŒ–ç³»ç»Ÿ buffer</span><br><span class="line"><span class="attr">nrfiles</span>=<span class="number">8</span>            <span class="comment"># æ¯ä¸ªè¿›ç¨‹ç”Ÿæˆæ–‡ä»¶çš„æ•°é‡</span></span><br></pre></td></tr></table></figure><p><code>æ³¨æ„ï¼š</code> åªè¦ä¸æ˜¯æµ‹è¯•ç©ºç›˜ï¼Œ<code>filename</code> å‚æ•°åƒä¸‡ä¸è¦ä½¿ç”¨ç±»ä¼¼ <code>/dev/sda</code> è¿™æ— å¼‚äºåˆ åº“è·‘è·¯ğŸ˜‚ã€‚æ‰€ä»¥æ¨èä½¿ç”¨è·¯å¾„è€Œä¸æ˜¯è®¾å¤‡ã€‚</p><ul><li>output example</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@nfs ~</span><br><span class="line">â•°â”€# fio -filename=/tmp/test.file -direct=1 -iodepth 1 -thread -rw=randrw -rwmixread=70 -ioengine=psync -bs=16k -size=1G -numjobs=30 -runtime=100 -group_reporting -name=mytest1</span><br><span class="line">mytest1: (g=0): rw=randrw, bs=(R) 16.0KiB-16.0KiB, (W) 16.0KiB-16.0KiB, (T) 16.0KiB-16.0KiB, ioengine=psync, iodepth=1</span><br><span class="line">...</span><br><span class="line">fio-3.7</span><br><span class="line">Starting 30 threads</span><br><span class="line">mytest1: Laying out IO file (1 file / 1024MiB)</span><br><span class="line">Jobs: 30 (f=30): [m(30)][100.0%][r=1265KiB/s,w=560KiB/s][r=79,w=35 IOPS][eta 00m:00s]</span><br><span class="line">mytest1: (groupid=0, jobs=30): err= 0: pid=45930: Mon Apr 27 23:09:21 2020</span><br><span class="line">read: IOPS=71, BW=1149KiB/s (1177kB/s)(113MiB/100321msec)</span><br><span class="line"> clat (usec): min=349, max=999812, avg=292473.60, stdev=188905.70</span><br><span class="line">  lat (usec): min=349, max=999813, avg=292473.83, stdev=188905.69</span><br><span class="line"> clat percentiles (msec):</span><br><span class="line">  |  1.00th=[    5],  5.00th=[    8], 10.00th=[   11], 20.00th=[   24],</span><br><span class="line">  | 30.00th=[  247], 40.00th=[  313], 50.00th=[  342], 60.00th=[  372],</span><br><span class="line">  | 70.00th=[  401], 80.00th=[  430], 90.00th=[  481], 95.00th=[  542],</span><br><span class="line">  | 99.00th=[  751], 99.50th=[  818], 99.90th=[  894], 99.95th=[  936],</span><br><span class="line">  | 99.99th=[ 1003]</span><br><span class="line">bw (  KiB/s): min=   31, max=   96, per=3.53%, avg=40.55, stdev=14.30, samples=5661</span><br><span class="line">iops        : min=    1, max=    6, avg= 2.48, stdev= 0.93, samples=5661</span><br><span class="line">  write: IOPS=30, BW=483KiB/s (494kB/s)(47.3MiB/100321msec)</span><br><span class="line"> clat (msec): min=2, max=937, avg=297.02, stdev=194.75</span><br><span class="line">  lat (msec): min=2, max=937, avg=297.02, stdev=194.75</span><br><span class="line"> clat percentiles (msec):</span><br><span class="line">  |  1.00th=[    5],  5.00th=[    9], 10.00th=[   11], 20.00th=[   16],</span><br><span class="line">  | 30.00th=[  266], 40.00th=[  326], 50.00th=[  355], 60.00th=[  380],</span><br><span class="line">  | 70.00th=[  405], 80.00th=[  435], 90.00th=[  481], 95.00th=[  550],</span><br><span class="line">  | 99.00th=[  760], 99.50th=[  810], 99.90th=[  902], 99.95th=[  927],</span><br><span class="line">  | 99.99th=[  936]</span><br><span class="line">bw (  KiB/s): min=   31, max=  256, per=9.65%, avg=46.52, stdev=25.43, samples=2071</span><br><span class="line">iops        : min=    1, max=   16, avg= 2.85, stdev= 1.61, samples=2071</span><br><span class="line">  lat (usec)   : 500=0.02%, 750=0.02%</span><br><span class="line">  lat (msec)   : 4=0.28%, 10=8.53%, 20=10.86%, 50=6.42%, 100=0.90%</span><br><span class="line">  lat (msec)   : 250=2.90%, 500=62.21%, 750=6.79%, 1000=1.06%</span><br><span class="line">  cpu          : usr=0.00%, sys=0.01%, ctx=19413, majf=0, minf=7</span><br><span class="line">  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%</span><br><span class="line">  submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">  complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">  issued rwts: total=7204,3026,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br><span class="line">  latency   : target=0, window=0, percentile=100.00%, depth=1</span><br><span class="line"></span><br><span class="line">Run status group 0 (all jobs):</span><br><span class="line">READ: bw=1149KiB/s (1177kB/s), 1149KiB/s-1149KiB/s (1177kB/s-1177kB/s), io=113MiB (118MB), run=100321-100321msec</span><br><span class="line">  WRITE: bw=483KiB/s (494kB/s), 483KiB/s-483KiB/s (494kB/s-494kB/s), io=47.3MiB (49.6MB), run=100321-100321msec</span><br><span class="line"></span><br><span class="line">Disk stats (read/write):</span><br><span class="line"> dm-0: ios=7750/3320, merge=0/0, ticks=200950/123253, in_queue=324237, util=99.83%, aggrios=7765/3135, aggrmerge=0/192, aggrticks=201237/111717, aggrin_queue=312951, aggrutil=99.81%</span><br><span class="line">  sda: ios=7765/3135, merge=0/192, ticks=201237/111717, in_queue=312951, util=99.81%</span><br></pre></td></tr></table></figure><h4 id="qperf"><a href="#qperf" class="headerlink" title="qperf"></a>qperf</h4><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install qperf</span><br><span class="line">apt install qperf</span><br></pre></td></tr></table></figure><ul><li>usage</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@debian /opt/trojan</span><br><span class="line">â•°â”€# qperf --help examples</span><br><span class="line">In these examples, we first run qperf on a node called myserver in server</span><br><span class="line">mode by invoking it with no arguments.  In all the subsequent examples, we</span><br><span class="line">run qperf on another node and connect to the server which we assume has a</span><br><span class="line">hostname of myserver.</span><br><span class="line"> * To run a TCP bandwidth and latency test:</span><br><span class="line">  qperf myserver tcp_bw tcp_lat</span><br><span class="line"> * To run a SDP bandwidth test for 10 seconds:</span><br><span class="line">  qperf myserver -t 10 sdp_bw</span><br><span class="line"> * To run a UDP latency test and then cause the server to terminate:</span><br><span class="line">  qperf myserver udp_lat quit</span><br><span class="line"> * To measure the RDMA UD latency and bandwidth:</span><br><span class="line">  qperf myserver ud_lat ud_bw</span><br><span class="line"> * To measure RDMA UC bi-directional bandwidth:</span><br><span class="line">  qperf myserver rc_bi_bw</span><br><span class="line"> * To get a range of TCP latencies with a message size from 1 to 64K</span><br><span class="line">  qperf myserver -oo msg_size:1:64K:*2 -vu tcp_lat</span><br></pre></td></tr></table></figure><ul><li>output example</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">root@debian-node-02-656868cc46-72lc9:/# qperf  -t 30 100.107.127.100 -v tcp_bw udp_bw tcp_lat udp_lat conf</span><br><span class="line">tcp_bw:</span><br><span class="line"> bw              =  3.24 GB/sec</span><br><span class="line"> msg_rate        =  49.4 K/sec</span><br><span class="line"> time            =    30 sec</span><br><span class="line"> send_cost       =   542 ms/GB</span><br><span class="line"> recv_cost       =   542 ms/GB</span><br><span class="line"> send_cpus_used  =   176 % cpus</span><br><span class="line"> recv_cpus_used  =   176 % cpus</span><br><span class="line">udp_bw:</span><br><span class="line"> send_bw         =  2.62 GB/sec</span><br><span class="line"> recv_bw         =  2.37 GB/sec</span><br><span class="line"> msg_rate        =  72.3 K/sec</span><br><span class="line"> time            =    30 sec</span><br><span class="line"> send_cost       =   542 ms/GB</span><br><span class="line"> recv_cost       =   598 ms/GB</span><br><span class="line"> send_cpus_used  =   142 % cpus</span><br><span class="line"> recv_cpus_used  =   142 % cpus</span><br><span class="line">tcp_lat:</span><br><span class="line"> latency        =  17.3 us</span><br><span class="line"> msg_rate       =  57.7 K/sec</span><br><span class="line"> time           =    30 sec</span><br><span class="line"> loc_cpus_used  =   110 % cpus</span><br><span class="line"> rem_cpus_used  =   110 % cpus</span><br><span class="line">udp_lat:</span><br><span class="line"> latency        =  15.4 us</span><br><span class="line"> msg_rate       =  64.8 K/sec</span><br><span class="line"> time           =    30 sec</span><br><span class="line"> loc_cpus_used  =   111 % cpus</span><br><span class="line"> rem_cpus_used  =   111 % cpus</span><br><span class="line">conf:</span><br><span class="line"> loc_node   =  debian-node-02-656868cc46-72lc9</span><br><span class="line"> loc_cpu    =  8 Cores: Intel Xeon E3-1271 v3 @ 3.60GHz</span><br><span class="line"> loc_os     =  Linux 3.10.0-862.el7.x86_64</span><br><span class="line"> loc_qperf  =  0.4.11</span><br><span class="line"> rem_node   =  debian-node-02-656868cc46-xftvq</span><br><span class="line"> rem_cpu    =  8 Cores: Intel Xeon E3-1271 v3 @ 3.60GHz</span><br><span class="line"> rem_os     =  Linux 3.10.0-862.el7.x86_64</span><br><span class="line"> rem_qperf  =  0.4.11</span><br></pre></td></tr></table></figure><h4 id="iperf"><a href="#iperf" class="headerlink" title="iperf"></a>iperf</h4><ul><li><p>install</p></li><li><p>usage</p></li><li><p>output example</p></li></ul><h4 id="wrk"><a href="#wrk" class="headerlink" title="wrk"></a><a href="https://github.com/wg/wrk/" target="_blank" rel="noopener">wrk</a></h4><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/wg/wrk.git --depth=1</span><br><span class="line">cd wrk</span><br><span class="line">make</span><br></pre></td></tr></table></figure><ul><li>usage</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">./wrk</span><br><span class="line">Usage: wrk &lt;options&gt; &lt;url&gt;</span><br><span class="line">  Options:</span><br><span class="line"> -c, --connections &lt;N&gt;  Connections to keep open éœ€è¦æ¨¡æ‹Ÿçš„ä¸ªå¹¶å‘è¯·æ±‚è¿æ¥æ•°é‡</span><br><span class="line"> -d, --duration    &lt;T&gt;  Duration of test æµ‹è¯•çš„æµ‹è¯•æ—¶é•¿</span><br><span class="line"> -t, --threads     &lt;N&gt;  Number of threads to use å¹¶å‘çº¿ç¨‹æ•°é‡</span><br><span class="line"> -s, --script      &lt;S&gt;  Load Lua script file  æŒ‡å®š Lua è„šæœ¬çš„è·¯å¾„</span><br><span class="line"> -H, --header      &lt;H&gt;  Add header to request æŒ‡å®šè¯·æ±‚å¸¦çš„ Header å‚æ•°</span><br><span class="line">  --latency          Print latency statistics æ˜¯å¦æ‰“å°è¯·æ±‚å»¶è¿Ÿç»Ÿè®¡</span><br><span class="line">  --timeout     &lt;T&gt;  Socket/request timeout è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´</span><br></pre></td></tr></table></figure><ul><li>output example</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¯¹ 10.20.172.196 nginx æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•</span></span><br><span class="line">â•­â”€root@test ~/wrk â€¹masterâ€º</span><br><span class="line">â•°â”€# ./wrk -t100 -c512 -d30s http://10.20.172.196</span><br><span class="line">Running 30s test @ http://10.20.172.196</span><br><span class="line">  100 threads and 512 connections</span><br><span class="line">  Thread Stats   Avg      Stdev     Max   +/- Stdev</span><br><span class="line"> Latency    44.71ms  108.75ms   1.99s    89.05%</span><br><span class="line"> Req/Sec   369.78    207.57     1.68k    71.50%</span><br><span class="line">  987158 requests in 30.10s, 840.66MB read</span><br><span class="line">  Socket errors: connect 0, read 0, write 0, timeout 22</span><br><span class="line">Requests/sec:  32797.65</span><br><span class="line">Transfer/sec:     27.93MB</span><br><span class="line"><span class="meta">#</span><span class="bash"> æµ‹è¯•ç»“æœï¼ŒåŸºæœ¬èƒ½è¾¾åˆ° 3W+ çš„ QPS çš„æ€§èƒ½</span></span><br></pre></td></tr></table></figure><h4 id="httperf"><a href="#httperf" class="headerlink" title="httperf"></a>httperf</h4><ul><li><p>install</p></li><li><p>usage</p></li><li><p>output example</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@ubuntu-238 ~</span><br><span class="line">â•°â”€# httperf --server 10.20.172.196 --port 80 --num-conns 100 --rate 10 --timeout 1</span><br><span class="line">httperf --timeout=1 --client=0/1 --server=10.20.172.196 --port=80 --uri=/ --rate=10 --send-buffer=4096 --recv-buffer=16384 --num-conns=100 --num-calls=1</span><br><span class="line">httperf: warning: open file limit &gt; FD_SETSIZE; limiting max. # of open files to FD_SETSIZE</span><br><span class="line">Maximum connect burst length: 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> å“åº”é€Ÿç‡</span></span><br><span class="line">Total: connections 100 requests 100 replies 100 test-duration 9.900 s</span><br><span class="line">Connection rate: 10.1 conn/s (99.0 ms/conn, &lt;=1 concurrent connections)</span><br><span class="line">Connection time [ms]: min 0.1 avg 0.1 max 0.2 median 0.5 stddev 0.0</span><br><span class="line">Connection time [ms]: connect 0.0</span><br><span class="line">Connection length [replies/conn]: 1.000</span><br><span class="line">Request rate: 10.1 req/s (99.0 ms/req)</span><br><span class="line">Request size [B]: 66.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡å™¨ä»è¯·æ±‚ä¸­æ¥æ”¶åˆ°ç¬¬ä¸€ä¸ªå­—èŠ‚å¼€å§‹ï¼Œåˆ°è¿æ¥æ”¶åˆ°ç¬¬ä¸€ä¸ªå­—èŠ‚æ‰€æ¶ˆè€—çš„æ—¶é—´</span></span><br><span class="line">Reply rate [replies/s]: min 10.0 avg 10.0 max 10.0 stddev 0.0 (1 samples)</span><br><span class="line">Reply time [ms]: response 0.1 transfer 0.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç»Ÿè®¡æ¯ä¸ªå›å¤çš„å¤§å°ï¼Œæ¯ä¸ªç»´åº¦çš„å•ä½éƒ½æ˜¯å­—èŠ‚(bytes),ä¸”éƒ½æ˜¯å¹³å‡æ•°</span></span><br><span class="line">Reply size [B]: header 244.0 content 649.0 footer 0.0 (total 893.0)</span><br><span class="line">Reply status: 1xx=0 2xx=100 3xx=0 4xx=0 5xx=0</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯CPUä½¿ç”¨ç‡çš„ç»Ÿè®¡ï¼ŒUserç”¨æˆ·æ¨¡å¼ï¼ŒSystemæ¨¡å¼</span></span><br><span class="line">CPU time [s]: user 3.85 system 6.05 (user 38.9% system 61.1% total 100.0%)</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç½‘ç»œçš„ååé‡</span></span><br><span class="line">Net I/O: 9.5 KB/s (0.1*10^6 bps)</span><br><span class="line"><span class="meta">#</span><span class="bash"> å‘ç”Ÿé”™è¯¯çš„æ€»æ•°,å®¢æˆ·ç«¯è¶…æ—¶è®¡æ•°ï¼Œæ¯æ¬¡ä»ç”Ÿæˆè¯·æ±‚å¼€å§‹ï¼Œå¦‚æœæ²¡æœ‰å“åº”å³è¶…æ—¶,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> TCPè¿æ¥å¤±è´¥</span></span><br><span class="line">Errors: total 0 client-timo 0 socket-timo 0 connrefused 0 connreset 0</span><br><span class="line">Errors: fd-unavail 0 addrunavail 0 ftab-full 0 other 0</span><br></pre></td></tr></table></figure><h4 id="ab"><a href="#ab" class="headerlink" title="ab"></a><a href="">ab</a></h4><ul><li><p>install</p></li><li><p>usage</p></li><li><p>output example</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@test ~</span><br><span class="line">â•°â”€# ab -n 1000 -c 1000 http://10.20.172.196/</span><br><span class="line">This is ApacheBench, Version 2.3 &lt;$Revision: 1430300 $&gt;</span><br><span class="line">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class="line">Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class="line">Benchmarking 10.20.172.196 (be patient)</span><br><span class="line">Completed 100 requests</span><br><span class="line">Completed 200 requests</span><br><span class="line">Completed 300 requests</span><br><span class="line">Completed 400 requests</span><br><span class="line">Completed 500 requests</span><br><span class="line">Completed 600 requests</span><br><span class="line">Completed 700 requests</span><br><span class="line">Completed 800 requests</span><br><span class="line">Completed 900 requests</span><br><span class="line">Completed 1000 requests</span><br><span class="line">Finished 1000 requests</span><br><span class="line">Server Software:        nginx/1.15.8.1</span><br><span class="line">Server Hostname:        10.20.172.196</span><br><span class="line">Server Port:            80</span><br><span class="line">Document Path:          /</span><br><span class="line">Document Length:        649 bytes</span><br><span class="line">Concurrency Level:      1000</span><br><span class="line">Time taken for tests:   0.107 seconds</span><br><span class="line">Complete requests:      1000</span><br><span class="line">Failed requests:        0</span><br><span class="line">Write errors:           0</span><br><span class="line">Total transferred:      888000 bytes</span><br><span class="line">HTML transferred:       649000 bytes</span><br><span class="line">Requests per second:    9313.50 [#/sec] (mean)</span><br><span class="line">Time per request:       107.371 [ms] (mean)</span><br><span class="line">Time per request:       0.107 [ms] (mean, across all concurrent requests)</span><br><span class="line">Transfer rate:          8076.55 [Kbytes/sec] received</span><br><span class="line"></span><br><span class="line">Connection Times (ms)</span><br><span class="line">  min  mean[+/-sd] median   max</span><br><span class="line">Connect:        0   29   8.1     29      42</span><br><span class="line">Processing:    17   36  14.3     45      51</span><br><span class="line">Waiting:        0   35  14.3     44      50</span><br><span class="line">Total:         42   65   9.0     64      87</span><br><span class="line"></span><br><span class="line">Percentage of the requests served within a certain time (ms)</span><br><span class="line"><span class="meta">  50%</span><span class="bash">     64</span></span><br><span class="line"><span class="meta">  66%</span><span class="bash">     69</span></span><br><span class="line"><span class="meta">  75%</span><span class="bash">     71</span></span><br><span class="line"><span class="meta">  80%</span><span class="bash">     73</span></span><br><span class="line"><span class="meta">  90%</span><span class="bash">     78</span></span><br><span class="line"><span class="meta">  95%</span><span class="bash">     81</span></span><br><span class="line"><span class="meta">  98%</span><span class="bash">     84</span></span><br><span class="line"><span class="meta">  99%</span><span class="bash">     86</span></span><br><span class="line"><span class="meta"> 100%</span><span class="bash">     87 (longest request)</span></span><br></pre></td></tr></table></figure><h4 id="stress"><a href="#stress" class="headerlink" title="stress"></a>stress</h4><blockquote><p><a href="https://www.tecmint.com/linux-cpu-load-stress-test-with-stress-ng-tool/" target="_blank" rel="noopener">Stress/Stress-NG</a>æ˜¯Linuxä¸‹ä¸¤ä¸ªå¸¸ç”¨çš„ç³»ç»Ÿçº§å‹åŠ›æµ‹è¯•å·¥å…·ï¼Œ<strong>stress</strong>å‘½ä»¤ç®€å•æ˜“ç”¨ï¼Œ<strong>stress-ng</strong>æ˜¯stressçš„å‡çº§ç‰ˆï¼Œæ”¯æŒ<strong>æ•°ç™¾ä¸ªå‚æ•°å®šåˆ¶å„ç§å‹CPUã€å†…å­˜ã€IOã€ç½‘ç»œ</strong>çš„å§¿åŠ¿ã€‚åœ¨ç³»ç»Ÿè¿‡è½½çš„åœºæ™¯ä¸‹ï¼Œåº”ç”¨æœåŠ¡å¯èƒ½ä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„é”™è¯¯æˆ–å¼‚å¸¸ï¼Œåœ¨æµ‹è¯•<strong>è´Ÿè½½å‡è¡¡å’Œç†”æ–­é™çº§</strong>æ—¶éå¸¸æœ‰ç”¨ã€‚è¿™é‡Œåªåˆ—ä¸¾äº†å‡ ä¸ªå¸¸ç”¨çš„å‘½ä»¤ï¼Œè¯¦ç»†ä½¿ç”¨å‚è€ƒâ€stress-ng â€“helpâ€æˆ–â€man stress-ngâ€ã€‚å¦å¤–ï¼Œè¿™äº›â€œçƒ¤æœºâ€å‘½ä»¤æ¥æµ‹è¯•æœåŠ¡å™¨æ€§èƒ½ä¹Ÿæ˜¯ä¸é”™çš„ã€‚</p></blockquote><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> RHRL/CentOS</span></span><br><span class="line">yum install epel-release</span><br><span class="line">yum install stress stress-ng</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian/Ubuntu</span></span><br><span class="line">apt install stress stress-ng</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> stress-ng åŸºæœ¬ç”¨æ³•ä¸stresså®Œå…¨å…¼å®¹ï¼Œä½†æœ‰æ›´å¤šçš„å‚æ•°å¯é€‰ï¼Œå¹¶ä¸”å¯ä»¥æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><ul><li>usage</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åœ¨ä¸¤ä¸ªCPUæ ¸å¿ƒä¸Šè·‘å¼€æ–¹è¿ç®—ï¼Œå¹¶ä¸”å¯åŠ¨ä¸€ä¸ªä¸æ–­åˆ†é…é‡Šæ”¾1Gå†…å­˜çš„çº¿ç¨‹ï¼Œè¿è¡Œ10ç§’ååœæ­¢</span></span><br><span class="line">stress --cpu 2 --vm 1 --vm-bytes 1G  -v --timeout 10</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ä¸æ–­æ‰§è¡Œsyncç³»ç»Ÿè°ƒç”¨å›å†™ç£ç›˜ç¼“å­˜ï¼Œå¹¶ä¸”å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ä¸åœåœ°å†™å…¥åˆ é™¤512MBæ•°æ®ï¼Œè¿è¡Œ10ç§’åœæ­¢</span></span><br><span class="line">stress --io 1 --hdd 1 --hdd-bytes 512M -v --timeout 10</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> --sock å¯ä»¥æ¨¡æ‹Ÿå¤§é‡çš„socketè¿æ¥æ–­å¼€ä»¥åŠæ•°æ®çš„å‘é€æ¥æ”¶ç­‰ç­‰</span></span><br><span class="line">stress-ng --sock 2 -v --timeout 10 --metrics-brief</span><br></pre></td></tr></table></figure><ul><li>output example</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@debian /bashtop  â€¹masterâ€º</span><br><span class="line">â•°â”€# stress --cpu 4 --vm 1 --vm-bytes 1G  -v --timeout 3</span><br><span class="line">stress: info: [18174] dispatching hogs: 4 cpu, 0 io, 1 vm, 0 hdd</span><br><span class="line">stress: dbug: [18174] using backoff sleep of 3000us</span><br><span class="line">stress: dbug: [18174] setting timeout to 3s</span><br><span class="line">stress: dbug: [18174] --&gt; hogcpu worker 1 [18179] forked</span><br><span class="line">stress: dbug: [18176] allocating 1073741824 bytes ...</span><br><span class="line">stress: dbug: [18176] allocating 1073741824 bytes ...</span><br><span class="line">stress: dbug: [18176] touching bytes in strides of 4096 bytes ...</span><br><span class="line">stress: dbug: [18174] &lt;-- worker 18175 signalled normally</span><br><span class="line">stress: dbug: [18174] &lt;-- worker 18177 signalled normally</span><br><span class="line">stress: dbug: [18174] &lt;-- worker 18178 signalled normally</span><br><span class="line">stress: dbug: [18174] &lt;-- worker 18179 signalled normally</span><br><span class="line">stress: dbug: [18174] &lt;-- worker 18176 signalled normally</span><br><span class="line">stress: info: [18174] successful run completed in 3s</span><br></pre></td></tr></table></figure><p><img src="img/20200506154459952.png" alt="image-20200506154459952"></p><h3 id="å°å·¥å…·"><a href="#å°å·¥å…·" class="headerlink" title="å°å·¥å…·"></a>å°å·¥å…·</h3><h3 id="é•œåƒæº"><a href="#é•œåƒæº" class="headerlink" title="é•œåƒæº"></a>é•œåƒæº</h3><h2 id="å‘è¡Œç‰ˆ-1"><a href="#å‘è¡Œç‰ˆ-1" class="headerlink" title="å‘è¡Œç‰ˆ"></a>å‘è¡Œç‰ˆ</h2><h3 id="pxder"><a href="#pxder" class="headerlink" title="pxder"></a>pxder</h3><p>ä¸‹ç­ä¹‹åå›åˆ°å°çªä¹‹åå°±å¼€å§‹ä¸€å¤©ä¸­æœ€æœ€æ„‰æ‚¦çš„æ—¶åˆ»ï¼Œåœ¨ pixiv.net ä¸Šåˆ·å›¾ã€‚æ”¶è—å–œæ¬¢çš„<del>è€å©†</del>æ’ç”»ã€‚ä¸ºäº†ç®¡ç†å’Œä¸‹è½½è‡ªå·±æ”¶è—çš„æ’ç”»ä½œå“ï¼Œå½“ç„¶è¿˜æ˜¯é€‰æ‹©é£Ÿç”¨å·¥å…·æ¥ä¸‹è½½å•¦ğŸ˜‚ã€‚</p><p>åœ¨äºŒæœˆä»½çš„æ—¶å€™å¸®å°åœŸè±†å’Œ nova åŒå­¦æµ‹è¯• webp server go çš„ benchmark ï¼Œè¿™ä¸ª pxder å¸®äº†å’±å¾ˆå¤§çš„å¿™ï¼Œä¸‹è½½äº† 3W å¤šå¼ å›¾ç‰‡åšæµ‹è¯•æ ·æœ¬ï¼Œæœ€ç»ˆä½¿ç”¨è„šæœ¬ç­›é€‰å‡ºåˆé€‚çš„æ–‡ä»¶å¤§å°æ¥è¿›è¡Œ prefetc æµ‹è¯•ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€debian@debian /mnt/f/illustrations</span><br><span class="line">â•°â”€$ du -sh</span><br><span class="line">50G     .</span><br><span class="line">â•­â”€debian@debian /mnt/f/illustrations</span><br><span class="line">â•°â”€$ tree</span><br><span class="line">203 directories, 31831 files</span><br></pre></td></tr></table></figure><h3 id="æ‚ä¸ƒæ‚å…«çš„"><a href="#æ‚ä¸ƒæ‚å…«çš„" class="headerlink" title="æ‚ä¸ƒæ‚å…«çš„"></a>æ‚ä¸ƒæ‚å…«çš„</h3><h4 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h4><p>nginxï¼Œé™¤äº†å»ºç«™ç•¶ Web æœå‹™å™¨ï¼Œæ˜¯å’±åœ¨ openwrt ä¸Šè£çš„ï¼Œç›®çš„æ˜¯ç‚ºäº†æ“ºè„« ip çš„è¾¦å®šé™åˆ¶ã€‚å› ç‚ºæœ‰äº›è¨­å‚™é€šéåŸŸåä¾†è¨ªå•ï¼Œæ›´æ›ç¶²çµ¡ç’°å¢ƒï¼Œæ¯”å¦‚æ¬å®¶ä¹‹å¾Œåªéœ€è¦ç¶­ä¿®æ”¹ä¸€ä¸‹åŸŸåè§£æå³å¯ã€‚æ¯”å¦‚å’±ä½¿ç”¨ X.lo.502.li ä½œç‚ºä¸‰ç´šå­åŸŸååˆ†é…çµ¦æœ¬åœ°å…§ç¶²æ©Ÿå™¨ç”¨ã€‚</p><h4 id="ffmpeg"><a href="#ffmpeg" class="headerlink" title="ffmpeg"></a>ffmpeg</h4><p>ffmpeg èƒ½å¹²çš„äº‹æƒ…å¤ªå¤šäº†ï¼Œå’±ä½¿ç”¨æœ€å¤šçš„è¿˜æ˜¯åˆå¹¶è§†é¢‘è½¬ç è§†é¢‘ï¼Œæ¯”å¦‚å’±çš„ <a href="">mbcf</a> ï¼Œå…¨ç§° Merge bilibili cilent file</p><h4 id="pandoc"><a href="#pandoc" class="headerlink" title="pandoc"></a><a href="https://github.com/jgm/pandoc" target="_blank" rel="noopener">pandoc</a></h4><h4 id="rsync"><a href="#rsync" class="headerlink" title="rsync"></a>rsync</h4><h4 id="resilio-sync"><a href="#resilio-sync" class="headerlink" title="resilio sync"></a>resilio sync</h4><p>resilio sync ï¼Œæ˜¯å’±æœ€é‡è¦çš„æ•¸æ“šå‚™ä»½å·¥å…·ï¼Œæ¯”å¦‚å’±ä½¿ç”¨ pxder ä¸‹è¼‰å¥½æ”¶è—çš„è€å©†å€‘ï¼Œç‚ºäº†åœ¨æ‰‹æ©Ÿä¸Šä»”ç´°æ¬£è³è€å©†å€‘ï¼Œå’±å°±ç”¨ã€‚resilio sync å°‡ç›®éŒ„åŒæ­¥åˆ°æ‰‹æ©Ÿä¸Šï¼Œä¸¦ä¸”ä½¿ç”¨å®ƒä¾†èˆ‡ PCï¼ŒiPhone ï¼ŒAndroid ï¼ŒLinux ä¸‰è€…ç„¡ç¸«åŒæ­¥ã€‚ç°¡ç›´å¥½ç”¨æ¥µäº†ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè·¨å…¬ç¶²åŒæ­¥ï¼Œåœ¨ä¸€äº›ç¶²çµ¡ç’°å¢ƒä¸‹å› ç‚º GFW çš„ç·£æ•…ï¼Œç„¡æ³•å»ºç«‹èµ·éˆæ¥ï¼Œé€™æ™‚å€™éœ€è¦ä½¿ç”¨åˆ°é å®šç¾©ä¸»æ©Ÿã€‚å…¶ä¸­æœ‰å…©ç¨®æ¯”è¼ƒå¥½çš„æ–¹æ¡ˆï¼Œä¸€æ˜¯åœ¨å…¬ç¶² VPS æ©Ÿå™¨ä¸Šå®‰è£ resilio sync ä¸¦ä¸”åŠ å…¥åˆ°åŒæ­¥ä¸»æ©Ÿç•¶ä¸­ã€‚é€™é»ç¼ºé»ä¹Ÿæ˜é¡¯ï¼Œéœ€è¦ä½”ç”¨ç£ç›¤ç©ºé–“ï¼Œå¦‚æœåŒæ­¥å¤§é‡æ–‡ä»¶ä»¥åŠå¹¾åå¹¾ç™¾GBç´šåˆ¥çš„è©±ï¼Œå°ç›¤æ©Ÿæ˜¯æ‰›ä¸ä½çš„ï¼Œéœ€è¦å¦å¤–æ·»åŠ ç£ç›¤ã€‚æ–¹æ³•äºŒæ˜¯å’±æƒ³åˆ°çš„ï¼Œå±¢è©¦ä¸çˆ½ï¼Œå°±æ˜¯å°‡æœ¬æ©Ÿçš„ resilio sync ç›£è½ç«¯å£ 11354 ä½¿ç”¨ frp å…§ç¶²ç©¿é€åˆ°å…¬ç¶²æœå‹™å™¨ï¼Œç„¶å¾Œåœ¨å¦ä¸€å°æ©Ÿå™¨ä¸Šæ·»åŠ ä¸Šé å®šç¾©ä¸»æ©Ÿï¼ŒIP å°±æ˜¯ frp æœå‹™å™¨çš„ IPï¼Œç«¯å£å°±æ˜¯ frp å…§ç¶²ç©¿é€çš„ remote portã€‚é€™æ¨£æ·»åŠ å¥½é è¨‚èˆ‡ä¸»æ©Ÿä¹‹å¾Œï¼Œä¸åˆ°ä¸€åˆ†é˜å°±èƒ½ç™¼ç¾ä¸»æ©Ÿä¸¦å»ºç«‹èµ·é€£æ¥ã€‚</p><h4 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h4><h4 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h4><h4 id="oh-my-zsh"><a href="#oh-my-zsh" class="headerlink" title="oh-my-zsh"></a>oh-my-zsh</h4><h4 id="zsh"><a href="#zsh" class="headerlink" title="zsh"></a>zsh</h4><h4 id="frp"><a href="#frp" class="headerlink" title="frp"></a>frp</h4><h4 id="openwrt"><a href="#openwrt" class="headerlink" title="openwrt"></a>openwrt</h4><h4 id="Trojan"><a href="#Trojan" class="headerlink" title="Trojan"></a>Trojan</h4><h3 id="shell-å¸¸ç”¨è„šæœ¬"><a href="#shell-å¸¸ç”¨è„šæœ¬" class="headerlink" title="shell å¸¸ç”¨è„šæœ¬"></a>shell å¸¸ç”¨è„šæœ¬</h3><h4 id="VPS-init"><a href="#VPS-init" class="headerlink" title="VPS init"></a>VPS init</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install nload ncdu zsh git wget curl htop sysstat psmisc nginx-full fail2ban</span><br><span class="line">curl  https://get.acme.sh | sh</span><br><span class="line">sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"</span><br><span class="line">sed -i 's/ZSH_THEME="robbyrussell"/ZSH_THEME="bira"/g' ~/.zshrc</span><br></pre></td></tr></table></figure><h4 id="rawg"><a href="#rawg" class="headerlink" title="rawg"></a>rawg</h4><p>raw wget çš„ç¼©å†™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> data: 2020-03-31</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> author: muzi502</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span>: Fuck GFW and download some raw file form github without proxy using jsDelivr CDN</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> usage: save the .she to your <span class="built_in">local</span> such as /usr/bin/rawg, and chmod +x /usr/bin/rawg</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> use rawg https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh to download</span></span><br><span class="line"></span><br><span class="line">set -xue</span><br><span class="line"><span class="meta">#</span><span class="bash"> GitHub rul: https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> jsDelivr url: https://cdn.jsdelivr.net/gh/ohmyzsh/ohmyzsh/tools/install.sh</span></span><br><span class="line"></span><br><span class="line">wget $(echo $1 | sed 's/raw.githubusercontent.com/cdn.jsdelivr.net\/gh/' \</span><br><span class="line">                | sed 's/github.com/cdn.jsdelivr.net\/gh/' \</span><br><span class="line">                | sed 's/\/master//' | sed 's/\/blob//' )</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> curl $(<span class="built_in">echo</span> <span class="variable">$1</span> | sed <span class="string">'s/raw.githubusercontent.com/cdn.jsdelivr.net\/gh/'</span> \</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                | sed <span class="string">'s/github.com/cdn.jsdelivr.net\/gh/'</span> \</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                | sed <span class="string">'s/\/master//'</span> | sed <span class="string">'s/\/blob//'</span> )</span></span><br></pre></td></tr></table></figure><h4 id="kubeadm-pull-images"><a href="#kubeadm-pull-images" class="headerlink" title="kubeadm pull images"></a>kubeadm pull images</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span>: pull kubeamd images and get kubeadm kubectl kubelet binary</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> date: 2020-04-29</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> author: muzi502</span></span><br><span class="line"></span><br><span class="line">set -xue</span><br><span class="line">apt-get update &amp;&amp; apt-get install -y apt-transport-https curl</span><br><span class="line">curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -</span><br><span class="line">cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span><br><span class="line">deb https://apt.kubernetes.io/ kubernetes-xenial main</span><br><span class="line">EOF</span><br><span class="line">apt-get update</span><br><span class="line"></span><br><span class="line">for version in 1.17.5</span><br><span class="line">do</span><br><span class="line">    apt purge -y kubeadm kubelet kubectl</span><br><span class="line">    apt install -y kubeadm=$&#123;version&#125;-00 kubelet=$&#123;version&#125;-00 kubectl=$&#123;version&#125;-00</span><br><span class="line">    mkdir -p $&#123;version&#125;/bin</span><br><span class="line">    rm -rf $&#123;version&#125;/bin/*</span><br><span class="line">    cp -a $(whereis kubelet | awk -F ":" '&#123;print $2&#125;') $&#123;version&#125;/bin/</span><br><span class="line">    cp -a $(whereis kubeadm | awk -F ":" '&#123;print $2&#125;') $&#123;version&#125;/bin/</span><br><span class="line">    cp -a $(whereis kubectl | awk -F ":" '&#123;print $2&#125;') $&#123;version&#125;/bin/</span><br><span class="line">    kubeadm config images pull --kubernetes-version=$&#123;version&#125;</span><br><span class="line">    docker save -o kubeadm_v$&#123;version&#125;.tar `kubeadm config images list --kubernetes-version=$&#123;version&#125;`</span><br><span class="line">    mv kubeadm_v$&#123;version&#125;.tar $&#123;version&#125;</span><br><span class="line">    tar -czvf $&#123;version&#125;&#123;.tar.gz,&#125;</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h4 id="ss-obfs"><a href="#ss-obfs" class="headerlink" title="ss-obfs"></a>ss-obfs</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span>: install shadowsocks-libev and obfs</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> date: 2019-03-11</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> by: muzi502</span></span><br><span class="line">apt-get update</span><br><span class="line">apt-get -y  install shadowsocks-libev simple-obfs rng-tools</span><br><span class="line">rngd -r /dev/urandom</span><br><span class="line">mkdir -p /etc/shadowsocks-libev/</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/shadowsocks-libev/config.json &lt;&lt;EOF</span><br><span class="line">&#123;</span><br><span class="line">    "server":"0.0.0.0",</span><br><span class="line">    "server_port":8964,</span><br><span class="line">    "local_port":1080,</span><br><span class="line">    "password":"1984fuckGFW",</span><br><span class="line">    "timeout":60,</span><br><span class="line">    "method":"chacha20",</span><br><span class="line">    "plugin":"obfs-server",</span><br><span class="line">    "plugin_opts":"obfs=http"</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">systemctl restart shadowsocks-libev.service</span><br><span class="line">modprobe tcp_bbr</span><br><span class="line">echo "tcp_bbr" &gt;&gt; /etc/modules-load.d/modules.conf</span><br><span class="line">echo "net.core.default_qdisc=fq" &gt;&gt; /etc/sysctl.conf</span><br><span class="line">echo "net.ipv4.tcp_congestion_control=bbr" &gt;&gt; /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br><span class="line">sysctl net.ipv4.tcp_available_congestion_control</span><br><span class="line">sysctl net.ipv4.tcp_congestion_control</span><br><span class="line">touch /etc/sysctl.d/local.conf</span><br><span class="line">echo "net.core.wmem_max = 67108864" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.core.rmem_default = 65536" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.core.wmem_default = 65536" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.core.netdev_max_backlog = 4096" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.core.somaxconn = 4096" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_syncookies = 1" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_tw_reuse = 1" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_tw_recycle = 0" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_fin_timeout = 30" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_keepalive_time = 1200" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.ip_local_port_range = 10000 65000" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_max_syn_backlog = 4096" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_max_tw_buckets = 5000" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_fastopen = 3" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_rmem = 4096 87380 67108864" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_wmem = 4096 65536 67108864" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_mtu_probing = 1" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">sysctl --system</span><br><span class="line">lsmod | grep bbr</span><br></pre></td></tr></table></figure><h4 id="mcbf"><a href="#mcbf" class="headerlink" title="mcbf"></a>mcbf</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span>: bulk merge bilibili UWP download file *.flv</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> by: blog.502.li</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> date: 2019-01-12</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°†è¯¥è„šæ”¾åˆ° UWP å®¢æˆ·ç«¯ä¸‹è½½ç¼“å­˜ä¸»ç›®å½•ä¸‹æ‰§è¡Œï¼Œå®‰è£… ffmpegã€jq</span></span><br><span class="line"></span><br><span class="line">set -xu</span><br><span class="line">download_dir=$(pwd)</span><br><span class="line">mp4_dir=$&#123;download_dir&#125;/mp4</span><br><span class="line">mkdir -p $&#123;mp4_dir&#125;</span><br><span class="line"></span><br><span class="line">for video_dir in $(ls | sort -n | grep -E -v "\.|mp4")</span><br><span class="line">do</span><br><span class="line">  cd $&#123;download_dir&#125;/$&#123;video_dir&#125;</span><br><span class="line">  up_name=$(jq ".Uploader" *.dvi | tr -d "[:punct:]\040\011\012\015")</span><br><span class="line">  mkdir -p $&#123;mp4_dir&#125;/$&#123;up_name&#125;</span><br><span class="line">  for p_dir in $(ls | sort -n | grep -v "\.")</span><br><span class="line">  do</span><br><span class="line">    cd $&#123;download_dir&#125;/$&#123;video_dir&#125;/$&#123;p_dir&#125;</span><br><span class="line">    video_name=$(jq ".Title" *.info | tr -d "[:punct:]\040\011\012\015")</span><br><span class="line">    part_name=$(jq ".PartName" *.info | tr -d "[:punct:]\040\011\012\015")</span><br><span class="line">    upload_time=$(grep -Eo "20[0-9][0-9]-[0-9][0-9]-[0-9][0-9]" *.info)</span><br><span class="line">    Uploader=$(jq ".Uploader" *.info | tr -d "[:punct:]\040\011\012\015")</span><br><span class="line">    mp4_audio=$(jq ".VideoDashInfo" *.info | tr -d "[:punct:]\040\011\012\015")</span><br><span class="line"></span><br><span class="line">    if [ "null" = "$&#123;part_name&#125;" ];then</span><br><span class="line">    mp4_file_name=$&#123;video_name&#125;.mp4</span><br><span class="line">    else</span><br><span class="line">    mp4_file_name=$&#123;video_name&#125;_$&#123;p_dir&#125;_$&#123;part_name&#125;.mp4</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    if [ "null" = "$&#123;mp4_audio&#125;" ];then</span><br><span class="line">    ls *.flv | sort -n &gt; ff.txt</span><br><span class="line">    sed -i 's/^/file /g' ff.txt</span><br><span class="line">    ffmpeg -f concat -i ff.txt -c copy $&#123;mp4_dir&#125;/$&#123;up_name&#125;/"$&#123;mp4_file_name&#125;";rm -rf ff.txt</span><br><span class="line">    else</span><br><span class="line">    ffmpeg  -i video.mp4 -i audio1.mp4 -c:v copy -c:a copy $&#123;mp4_dir&#125;/$&#123;up_name&#125;/"$&#123;mp4_file_name&#125;"</span><br><span class="line">    fi</span><br><span class="line">    cd $&#123;download_dir&#125;/$&#123;video_dir&#125;</span><br><span class="line">  cd $&#123;download_dir&#125;</span><br><span class="line">  done</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœéœ€è¦ä¿ç•™åŸè§†é¢‘è¯·æ³¨é‡Šæ‰ä¸‹é¢è¿™ä¸€è¡Œ</span></span><br><span class="line"><span class="meta">#</span><span class="bash">rm -rf <span class="variable">$&#123;download_dir&#125;</span>/<span class="variable">$&#123;video_dir&#125;</span></span></span><br><span class="line">done</span><br></pre></td></tr></table></figure><h4 id="conoha-wallpaper-download"><a href="#conoha-wallpaper-download" class="headerlink" title="conoha wallpaper download"></a>conoha wallpaper download</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span>: download conoha wallpaper</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> by: muzi502</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> date: 2020-02-11</span></span><br><span class="line">set -xue</span><br><span class="line"></span><br><span class="line">p=$(curl https://conoha.mikumo.com/wallpaper/ \</span><br><span class="line">| grep li | grep data-wallpaper-design= \</span><br><span class="line">| sed -e 's/&lt;li//g' | sed -e 's/"&gt;//g' | sed -e 's/^[ \t]*//g' \</span><br><span class="line">| sed -e 's/data-wallpaper-design="//g' \</span><br><span class="line">| sed 's/^/https:\/\/conoha.mikumo.com\/wp-content\/themes\/conohamikumo\/images\/wallpaper\//')</span><br><span class="line"></span><br><span class="line">for pic in $&#123;p&#125;</span><br><span class="line">do</span><br><span class="line">    file_name=$(echo $&#123;pic&#125; | awk -F "/" '&#123;print $9&#125;')</span><br><span class="line">    wget $&#123;pic&#125;/1080_1920.jpg -O $&#123;file_name&#125;_1080.jpg</span><br><span class="line">    wget $&#123;pic&#125;/2560_1440.jpg -O $&#123;file_name&#125;_1440.jpg</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="http://code2life.top/2019/05/02/0035-fault-injection/" target="_blank" rel="noopener">[DevOps] Linuxæ“ä½œç³»ç»Ÿå±‚çš„æ•…éšœæ³¨å…¥</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;å’•å’•å’•&quot;&gt;&lt;a href=&quot;#å’•å’•å’•&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Linux" scheme="https://blog.k8s.li/tags/Linux/"/>
    
      <category term="æ¬ç –" scheme="https://blog.k8s.li/tags/%E6%90%AC%E7%A0%96/"/>
    
      <category term="å·¥å…·" scheme="https://blog.k8s.li/tags/%E5%B7%A5%E5%85%B7/"/>
    
      <category term="å‘½ä»¤è¡Œ" scheme="https://blog.k8s.li/tags/%E5%91%BD%E4%BB%A4%E8%A1%8C/"/>
    
  </entry>
  
  <entry>
    <title>æ— ç –å¯æ¬çš„æ—¥å­|æ¢å‚è®°</title>
    <link href="https://blog.k8s.li/Brick-removal-note.html"/>
    <id>https://blog.k8s.li/Brick-removal-note.html</id>
    <published>2020-05-16T16:00:00.000Z</published>
    <updated>2020-09-15T00:28:09.944Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å’•å’•å’•"><a href="#å’•å’•å’•" class="headerlink" title="å’•å’•å’•"></a>å’•å’•å’•</h2><p>æœ¬æ¥æ‰“ç®—å†™ä¸€ç¯‡ã€Šæ¬ç –æ—¥è®°ä¸æ€è€ƒã€‹çš„ï¼Œè€Œä¸”æƒ³å†™çš„å†…å®¹éƒ½å·²ç»ä¿å­˜åœ¨äº†æˆ‘çš„ telegram é‡Œï¼Œä½†æ˜¯åæ¥è€ƒè™‘åˆ°æˆ‘çš„åšå®¢å°†ä¼šå…¬å¸ƒç»™åŒäº‹ä»¬ï¼Œä¸ºäº†ä¸å¿…è¦çš„å½±å“è¿˜æ˜¯å°†ä¸€äº›å†²å¡”çš„å†…å®¹ä¿å­˜åœ¨è‡ªå·±çš„æ—¥è®°é‡Œï¼Œç­‰ä»¥åå†å…¬å¸ƒå§ï¼Œæˆ–è®¸æ˜¯åå¹´äºŒåå¹´ä¹‹åå§ã€‚ä¸‹é¢çš„å†…å®¹å°±æ˜¯æˆ‘ä»å‰å…¬å¸ç¦»èŒåè¿™æ®µæ—¶é—´çš„ä¸€äº›ç»å†å§(â—Ë‡âˆ€Ë‡â—)ï¼Œå› ä¸ºæ˜¯ç¦»èŒäº†ï¼Œè¿™æ®µæ—¶é—´æš‚æ—¶æ€§åœ°æˆä¸ºäº†æ— ä¸šæ¸¸æ°‘ï¼Œä¹Ÿå°±æ— ç –å¯æ¬äº†ğŸ˜‚ï¼Œæ‰€ä»¥é¢˜åå°±å«ã€Šæ— ç –å¯æ¬çš„æ—¥å­|æ¢å‚è®°ã€‹å§ğŸ¤£</p><h2 id="é¢è¯•å°ç»“"><a href="#é¢è¯•å°ç»“" class="headerlink" title="é¢è¯•å°ç»“"></a>é¢è¯•å°ç»“</h2><table><thead><tr><th align="center">å…¬å¸</th><th align="center">åŸå¸‚</th><th align="center">æ–¹å¼</th><th align="center">é¢è¯•</th><th align="center">offer</th></tr></thead><tbody><tr><td align="center">XX</td><td align="center">æ·±åœ³</td><td align="center">Email</td><td align="center">âŒ</td><td align="center">âŒ</td></tr><tr><td align="center">XX</td><td align="center">ä¸Šæµ·</td><td align="center">Email</td><td align="center">â­•</td><td align="center">âŒ</td></tr><tr><td align="center">XX</td><td align="center">ä¸Šæµ·</td><td align="center">Email</td><td align="center">âŒ</td><td align="center">âŒ</td></tr><tr><td align="center">XXç§‘æŠ€</td><td align="center">æ­å·</td><td align="center">BOSS</td><td align="center">âœ…âœ…</td><td align="center">âœ…</td></tr><tr><td align="center">XXç§‘æŠ€</td><td align="center">æ·±åœ³</td><td align="center">Email</td><td align="center">âœ…</td><td align="center">âœ…</td></tr><tr><td align="center">XXç§‘æŠ€</td><td align="center">æ·±åœ³</td><td align="center">BOSS</td><td align="center">âŒ</td><td align="center">âŒ</td></tr><tr><td align="center">XXç§‘æŠ€</td><td align="center">ä¸Šæµ·</td><td align="center">BOSS</td><td align="center">âœ…âŒ</td><td align="center">âŒ</td></tr><tr><td align="center">è…¾è®¯äº‘</td><td align="center">æ·±åœ³</td><td align="center">BOSS</td><td align="center">âœ…âœ…âŒ</td><td align="center">âŒ</td></tr><tr><td align="center">XX</td><td align="center">æ­å·</td><td align="center">BOSS</td><td align="center">âœ…âŒ</td><td align="center">âŒ</td></tr><tr><td align="center">XX</td><td align="center">æ·±åœ³</td><td align="center">BOSS</td><td align="center">âœ…âœ…</td><td align="center">âœ…</td></tr><tr><td align="center">XX</td><td align="center">æ·±åœ³</td><td align="center">Email</td><td align="center">âœ…âœ…</td><td align="center">âœ…</td></tr></tbody></table><h2 id="9-å·"><a href="#9-å·" class="headerlink" title="9 å·"></a>9 å·</h2><p>æ—©ä¸Šå»äº†åŠå…¬å®¤ä¸Šç­ï¼Œæ”¶æ‹¾äº†ä¸€ä¸‹ç”µè„‘ï¼ŒæŠŠè‡ªå·±çš„å›ºæ€ç¡¬ç›˜æ‹†ä¸‹æ¥ï¼Œåˆé‡æ–°å®‰è£…äº† Windows æ–¹ä¾¿äº¤æ¥ç»™åŒäº‹ã€‚ä¹‹åå†æ‰¾é¢†å¯¼å’Œå…¬å¸è‘£äº‹ç­¾å­—ï¼Œè§åˆ°å…¬å¸çš„è‘£äº‹ï¼Œå¿ƒé‡Œè¿˜æ˜¯æˆ˜æˆ˜å…¢å…¢çš„ã€‚ä¸è¿‡å‡ºä¹æ„æ–™ï¼Œè¿‡ç¨‹å¾ˆé¡ºåˆ©ï¼Œå…¬å¸è‘£äº‹ä¹Ÿå¾ˆè´´åˆ‡ä¸´èµ°å‰ç®€å•åœ°ç¥ç¦äº†å‡ å¥ã€‚ç­¾å­—å®Œæˆä¹‹åè¿˜è¦å›å…¬å¸æœ¬éƒ¨åŠç†è´¢åŠ¡ç»“ç®—ä»¥åŠåŠ³åŠ¡åˆåŒç»ˆæ­¢åè®®ã€‚ä¹˜ç€åœ°é“æ¥åˆ°å…¬å¸ï¼Œæµ‹é‡ä½“æ¸©ç™»è®°å°±ä¸Šæ¥¼æ‰¾åˆ°äººäº‹ã€‚å’Œäººäº‹éƒ¨é—¨ç»ç†ç®€å•èŠäº†ä¸€ä¸‹ï¼Œä¸»è¦æ˜¯é—®äº†äº›è–ªèµ„å¾…é‡ã€ä¸ºä»€ä¹ˆè¦å»ä¸€çº¿åŸå¸‚çš„åŸå› ç­‰ç­‰ï¼Œè¿™äº›é—®é¢˜åœ¨æˆ‘é¢è¯•çš„è¿‡ç¨‹ä¸­ä¹Ÿè¢«ç»å¸¸é—®åˆ°è¿‡ï¼Œä¹Ÿå°±å¦‚å®åœ°å›ç­”äº†ã€‚</p><p>è¯´å®è¯ï¼Œå‰å…¬å¸æ— è®ºæ—¶å¾…é‡è¿˜æ˜¯åŒäº‹å…³ç³»ä¸Šï¼Œéƒ½å¾ˆå¥½ï¼Œè€Œä¸”åœ¨æˆ‘ç¦»èŒè´¢åŠ¡ç»“ç®—çš„æ—¶å€™ï¼Œæˆ‘æœ¬æ¥éœ€è¦ç¼´çº³ä¸€ç¬” 5000 å…ƒå·¦å³çš„æ¬¾é¡¹ï¼Œä½†æ˜¯å…¬å¸é¢†å¯¼å±‚è€ƒè™‘åˆ°æˆ‘è¿˜åˆšåˆšæ¯•ä¸šä¸€å¹´ï¼Œä¸ºæˆ‘çš„å‰ç¨‹ç€æƒ³æš‚æ—¶ä¸äºˆæ‰£é™¤ã€‚å¯¹æˆ‘æ¥è¯´è¿™ç¬”é’±ç®€ç›´æ˜¯ä¸ªå¤§æ•‘æ˜Ÿï¼Œå› ä¸ºåœ¨äº”ä¸€ä¹‹åèº«ä¸Šçš„ä½™é¢ä¸åˆ° 1 ä¸‡å…ƒï¼Œè‹¥æ˜¯æ²¡æœ‰å…¬å¸çš„è¿™ç¬”æ¬¾é¡¹è±å…ï¼Œæˆ–è®¸ç°åœ¨çš„æˆ‘åªèƒ½ç¡å‡ ç™¾å—é’±çš„é’æ—…ï¼Œå°†å°±ç€ä½å‡ ä¸ªæœˆæ‰èƒ½ç¼“è§£ä¸‹æ¥ï¼Œè¿™ä¸€ç‚¹çš„ç¡®å¯¹äºæˆ‘æ¥è¯´æ˜¯æå¤§çš„å¸®åŠ©ã€‚</p><p>å’Œå›½å†…æŸäº›å¤§å‚ç›¸æ¯”ï¼Œä¸œå®¶å¯¹å¾…ç¦»èŒå‘˜å·¥çš„æ€åº¦çœŸæ˜¯é«˜ä¸‹ç«‹åˆ¤å•ŠğŸ˜‚ã€‚çœ‹æ¥è‡ªå·±è¿˜æ˜¯å¾ˆå¹¸è¿å»å¹´æ¯•ä¸šçš„æ—¶å€™é‡åˆ°è¿™ä¹ˆå¥½çš„å…¬å¸ï¼Œè™½ç„¶å·²ç»ç¦»å¼€äº†é‚£é‡Œï¼Œä½†æ˜¯å¾ˆæ„Ÿè°¢ä»–ä»¬åœ¨è¿™æ®µæ—¶é—´ç»™äºˆçš„å¸®åŠ©ã€‚</p><p><img src="img/20200516131617183.png" alt="image-20200516131617183"></p><p>è¿˜æœ‰ä¸€ç‚¹ï¼Œåœ¨å››æœˆä»½æå‡ºç¦»èŒç”³è¯·çš„æ—¶å€™ï¼Œå¿ƒé‡Œååˆ†æ„§ç–šï¼Œå› ä¸ºåœ¨å»å¹´å…¥èŒçš„æ—¶å€™åˆšç­”åº”äº†é¢†å¯¼è¦åœ¨è¿™é‡Œå‘†ä¸‹å»çš„ã€‚è€Œä¸”é¢†å¯¼å¯¹æˆ‘ä»¬æ–°äººä¹Ÿæ˜¯ååˆ†å…³ç…§æœ‰åŠ ï¼šå»å¹´çš„æ—¶å€™å»å¤–åœ°å‡ºå·®ï¼Œé‚£å‡ å¤©ä¸€ç›´æ˜¯é¢†å¯¼è¯·å®¢åƒé¥­ï¼›ä¸Šä¸ªæœˆå…¬å¸ç»„ç»‡å»ä½“æ£€ï¼Œæˆ‘ä¸Šåˆä½“æ£€å®Œå›æ¥åä¸­åˆå–œæ 38 åº¦å‘çƒ­å¤§ç¤¼åŒ…ğŸ˜‚ã€‚ç„¶åå»åŒ»é™¢åšå·æ–°å† ç—…æ¯’æ£€éªŒï¼ŒæœŸé—´é¢†å¯¼ä¸€ç›´åœ¨æ‰“ç”µè¯ï¼Œå‰å‰ååä¸€å…±æ‰“äº†äºŒåä¸ªç”µè¯ï¼Œä¸€ç›´å…³æ³¨ç€æˆ‘èº«ä½“æƒ…å†µæ€ä¹ˆæ ·ï¼Œæœ‰æ²¡æœ‰å¥½è½¬ï¼Œæ™šä¸Šç¡è§‰å‰åˆæ‰“ç”µè¯é—®é€€çƒ§æ²¡æœ‰ã€‚ç”Ÿç—…çš„é‚£å‡ å¤©ï¼Œæ²¡æœ‰å’Œå®¶äººè¯´ï¼ŒçœŸæ­£æ‹…å¿ƒåˆ°æˆ‘çš„ä¹Ÿåªæœ‰é¢†å¯¼ä»¥åŠæˆ‘çš„å¦ä¸€ä¸ªåŒäº‹ã€‚é‚£ç‚¹æ—¶é—´æ‰è§‰ç€ï¼Œç°å®ä¸–ç•Œæ‰æ˜¯æˆ‘ä»¬åˆ‡åˆ‡å®å®èƒ½æ„Ÿè§¦åˆ°çš„ï¼Œåœ¨è‡ªå·±æœ€éš¾è¿‡çš„æ—¶å€™ï¼Œèƒ½ä¸»åŠ¨å¸®è‡ªå·±çš„äººæ˜¯å€¼å¾—çæƒœç»ˆç”Ÿçš„æœ‹å‹ã€‚</p><p>åŠå®Œç¦»èŒæ‰‹ç»­ï¼Œæ‹¿åˆ°ã€Šç»ˆæ­¢åŠ³åŠ¨åˆåŒé€šçŸ¥ä¹¦ã€‹ï¼Œæœ‰ç‚¹åƒå¤§å­¦çš„å½•å–é€šçŸ¥ä¹¦ğŸ˜‚ï¼Œå”¯æœ‰æ‹¿ç€å®ƒæ‰èƒ½å»ä¸‹ä¸€å®¶å…¬å¸å…¥èŒæŠ¥åˆ°ã€‚è¿˜æœ‰ä¸€ä»½ä¹‹å‰ç­¾è®¢çš„ä¿å¯†åè®®ï¼Œå› ä¸ºä»äº‹çš„å²—ä½æ¶‰åŠæœºå¯†ä¿¡æ¯ï¼Œæœ‰ä¸€ç‚¹é™åˆ¶ï¼Œæ¯”å¦‚ç¦»å¢ƒæˆ–å‡ºå›½ä¹‹å‰éœ€è¦æŠ¥å¤‡ï¼Œè¿™ä¸€ç‚¹æ¯”è¾ƒéº»çƒ¦ã€‚ä¸è¿‡è¿˜å¥½å•¦ï¼Œä¾ç…§ç›®å‰çš„ç–«æƒ…æƒ…å†µï¼Œä¼°è®¡ä¸€å¹´ä¹‹å†…ä¸ä¼šç¦»å¢ƒæˆ–å‡ºå›½äº†ã€‚</p><p>æ™šä¸Šçš„æ—¶å€™åœ¨ä½çš„å°åŒºé™„è¿‘åƒå®Œäº†æœ€åä¸€é¡¿æ™šé¥­ï¼Œé‚£ç§æ„Ÿè§‰çœŸæ˜¯â€¦â€¦æ­¤ç”Ÿå¯æ‹ğŸ˜­</p><blockquote class="twitter-tweet"><p lang="zh" dir="ltr">æ™šä¸Šåƒçš„è¿™é“èœå« â€œç«çˆ†èŒ„å­â€ï¼Œçš„ç¡®å¤Ÿç«çˆ†çš„ğŸ˜¡ï¼Œåƒå®Œä¹‹åæˆ‘ç«å†’ä¸‰ä¸ˆæƒ³ç ¸æ¡Œå­ï¼Œè‚šå­é‡Œä»¿ä½›æœ‰åƒåªè‰æ³¥é©¬å¥”è…¾ç€è€Œè¿‡â€¦â€¦èŠèŠ±è¦é­å— DDoS æ”»å‡»äº†ğŸ˜­ <a href="https://t.co/V4whuhJFwQ" target="_blank" rel="noopener">pic.twitter.com/V4whuhJFwQ</a></p>&mdash; æœ¨å­ (@muzi_ii) <a href="https://twitter.com/muzi_ii/status/1259090385491488770?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">May 9, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>æ™šä¸Šçš„æ—¶å€™è¿›è¡Œäº†æœ€åä¸€åœºé¢è¯•ï¼Œé¢è¯•çš„è¿‡ç¨‹è¿˜ç®—é¡ºåˆ©ï¼Œè™½ç„¶è¿˜ä¸çŸ¥é“ç»“æœï¼Œä½†æ˜¯ä¸ºäº†ä¿åº•çš„é€‰æ‹©ï¼Œè¿˜æ˜¯åŠ¨èº«å‰å¾€æ·±åœ³ã€‚å› ä¸ºæ·±åœ³çš„è¿™å®¶å…¬å¸è¦æ±‚çš„å…¥èŒæ—¶é—´å°±åœ¨è¿‘å‡ å¤©ï¼Œåˆ°é‚£é‡Œè¿˜è¦ç§Ÿæˆ¿ä½“æ£€ç­‰ä¸€å †æ‚äº‹å„¿è¦åšï¼Œè¿™éœ€è¦å‡ å¤©çš„å‡†å¤‡æ—¶é—´ã€‚</p><h2 id="10-å·"><a href="#10-å·" class="headerlink" title="10 å·"></a>10 å·</h2><p>ç¬¬äºŒå¤©æ—©ä¸Šè¿˜æ˜¯æŒ‰ç…§å¾€å¸¸çš„æ—¶é—´èµ·åºŠï¼Œæ”¶æ‹¾å¥½è¡Œæï¼Œä¸´èµ°ä¹‹å‰ç¯é¡¾äº†ä¸€ä¸‹ç”Ÿæ´»äº†ä¸€å¹´çš„å°çªï¼Œå¤šå°‘æœ‰ç‚¹ä¸èˆç¦»å¼€è¿™åº§ç”Ÿæ´»äº†äº”å¹´çš„åŸå¸‚ã€‚å›æƒ³èµ·å¤§ä¸€æ—¶ä»åƒé‡Œä¹‹å¤–çš„å®¶ä¹¡æ¥åˆ°è¿™é‡Œæ±‚å­¦è¯»ä¹¦ï¼Œåœ¨è¿™é‡Œå››äº”å¹´çš„ç”Ÿæ´»ï¼Œæ¸æ¸åœ°ä¹ æƒ¯äº†è¿™åº§åŸå¸‚ã€‚å¤§å­¦å’Œå‰å¥³å‹æ‹çˆ±çš„é‚£æ®µæ—¶é—´ä¹Ÿæ›¾è®¡åˆ’æˆ–å°†æ¥è¦åœ¨è¿™é‡Œå®‰èº«ç«‹å‘½ï¼Œæˆå®¶ç«‹ä¸šï¼Œæœ‰ä¸€ä¸ªå¹¸ç¦ç¾æ»¡çš„å®¶åº­ã€‚æˆ‘æƒ³è¿™ä¹Ÿæ˜¯å¤§å¤šæ•°äººçš„æ­£å¸¸ç”Ÿæ´»å’Œå½’å®¿å§ã€‚ä¸å¹¸çš„æ˜¯åæ¥è¿˜æ˜¯å’Œå‰å¥³å‹åˆ†æ‰‹äº†ï¼Œè‡ªé‚£ä»¥åä¹Ÿå†ä¹Ÿä¸æƒ³æ‹çˆ±äº†ï¼Œå› ä¸ºè‡ªå·±è¿˜æ˜¯å–œæ¬¢ä¸€ä¸ªäººçš„ç”Ÿæ´»ï¼Œè€Œä¸”å–œæ¬¢/çˆ±ä¸Šä»–äººæ˜¯ç§ä¸è‡ªç”±çš„ç”Ÿæ´»ï¼Œè¦è€ƒè™‘å¯¹æ–¹çš„æ„Ÿå—ï¼Œæœ‰æ—¶ä¸ºäº†ç»´ç³»äº²å¯†å…³ç³»ä¸å¾—ä¸è¿èƒŒè‡ªå·±çš„åŸåˆ™ï¼Œè¿™æ ·çš„ç”Ÿæ´»çœŸçš„çƒ­çˆ±ä¸èµ·æ¥ï¼Œè¿˜æ˜¯ä¸€ä¸ªäººç©æ³¥å·´çˆ½å‘€ğŸ˜‹ã€‚</p><p>å»å¹´æ¯•ä¸šä¹‹åå°±æ‰¾åˆ°è¿™é‡Œä½çš„ï¼Œä¸Šä¸‹é“ºçš„é’æ—…ï¼Œå››äººé—´æ¯äºº 300å…ƒï¼Œå¯¹äºåˆšæ¯•ä¸šçš„æˆ‘æ¥è¯´è¿™é‡Œæ— ç–‘æ˜¯æœ€å¥½çš„å½’å®¿ï¼Œå› ä¸ºå½“æ—¶å®ä¹ çš„å·¥èµ„æ¯å¤©ä¹Ÿå°± 120 å…ƒï¼Œè‡ªå·±åœ¨å…¬å¸é™„è¿‘å•ç‹¬ä½ä¸€é—´æˆ¿å­çš„è¯ï¼Œæ¯ä¸ªæœˆä½æˆ¿è´¹ç”¨è‡³å°‘è¦ 1300+ ï¼Œè€Œä½é’æ—…çš„è¯æ¯ä¸ªæœˆèƒ½èŠ‚çœ 1000 å…ƒã€‚å…¶æ¬¡é€‰åœ¨ä½åœ¨è¿™é‡Œæ˜¯å› ä¸ºè·ç¦»å…¬å¸åªæœ‰ 5 åˆ†é’Ÿçš„æ­¥è¡Œè·¯ç¨‹ï¼Œä¸­åˆçš„æ—¶å€™è¿˜èƒ½å›æ¥åˆä¼‘ç¡ä¸€ä¼šï¼Œç®€ç›´èˆ’æœæäº†ï¼Œç›¸æ¯”äºä¸€å—å…¥èŒçš„åŒäº‹æ¯å¤©è¦ 2 ä¸ªå¤šå°æ—¶çš„ä¸Šä¸‹ç­è·¯ç¨‹å¥½å¾ˆå¤šã€‚æœ¬æ¥å½“æ—¶æ‰“ç®—ä½åˆ°è½¬æ­£ä¹‹åå†æ¬å‡ºå»ä½çš„ï¼Œä¸è¿‡ç­‰åˆ°è½¬æ­£ä¹‹åï¼Œå‘ç°æ¸æ¸åœ°ä¹ æƒ¯ä¸Šäº†ï¼Œæ¥ç€ä½ä¸‹å»ä¹Ÿæ²¡é—®é¢˜ï¼Œäºæ˜¯å°±ä¸€ç›´ä½åˆ°æˆ‘ç¦»å¼€è¿™é‡Œï¼Œå°†è¿‘ä¸€å¹´çš„æ—¶é—´ã€‚</p><p>è€Œä¸‹ä¸€åº§åŸå¸‚ï¼ˆæ·±åœ³ï¼‰ä¹Ÿæ˜¯æ‰¾åˆ°ä¸Šä¸‹é“ºçš„é’æ—…ï¼Œå®åœ¨æ˜¯ä½ä¸èµ·å…¬å¸é™„è¿‘çš„æˆ¿å­ï¼Œå¯¹äºå‡ä»· 3000+ è€Œä¸”æŠ¼ä¸€ä»˜ä¸‰çš„æˆ¿å­æ¥è¯´ï¼Œæ¥è¿‘ 1 ä¸‡çš„ç§Ÿæˆ¿è´¹ç”¨å°±å¥½èŠ±è´¹æˆ‘æ‰€æœ‰çš„ç§¯è“„äº†ï¼Œæ²¡åŠæ³•åªèƒ½å†å»ä½ä¸Šä¸‹é“ºçš„é’æ—…æ¥ç»´æŒç”Ÿè®¡äº†ï¼Œä¸€ä¸ªå­—ï¼Œç©·å•Šï¼ˆï¼ˆï¼ˆ</p><blockquote class="twitter-tweet"><p lang="zh" dir="ltr">æºœäº†æºœäº†ï¼Œç¦»å¼€äº†å±…ä½äº†ä¸€å¹´çš„å°çªå’Œç”Ÿæ´»äº†äº”å¹´çš„åŸå¸‚ï¼‰<br><br>åªæ˜¯å†ä¹Ÿæ‰¾ä¸åˆ°æ¯æœˆä¸‰ç™¾å—é’±çš„æˆ¿å­äº†ï¼ˆ <a href="https://t.co/HIIoYTo95P" target="_blank" rel="noopener">pic.twitter.com/HIIoYTo95P</a></p>&mdash; æœ¨å­ (@muzi_ii) <a href="https://twitter.com/muzi_ii/status/1259296422228197376?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">May 10, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>åˆ°äº†æ—¶é—´ç‚¹å°±åŠ¨èº«å‰å¾€æœºåœºï¼Œè·¯ç¨‹äº”ååˆ†é’Ÿå·¦å³ï¼Œåœ¨è½¦ä¸Šæ‹¿èµ· kindle æ¥ç€çœ‹å¾è´²çš„ã€Šäººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†ã€‹ã€‚å› ä¸ºåœ¨äºŒæœˆä»½çš„æ—¶å€™å‰©ä½™ä»·å€¼é‡Œçš„ä¸€æœŸèŠ‚ç›®ä¸­æåˆ°è¿‡ã€Šå¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆã€‹è¿™æœ¬ä¹¦ï¼Œè€Œè¿™æœ¬ä¹¦çš„åºè¨€æ­£æ˜¯å¾è´²è€å¸ˆå†™çš„ï¼Œä¹‹å‰æˆ‘ä¹Ÿè¯»è¿‡ä»–çš„è®ºæ–‡ <a href="https://matters.news/@philosophia1979/å¾è´²-ä¸­å›½çš„-æ–°ææƒä¸»ä¹‰-åŠå…¶æœ«ä¸–æ™¯è±¡-é‡å…½èè¯»-bafyreiegbg5tti3ljc7newaah5wp36ncf7fvb2oaovd6p7elc4xqfhbcd4" target="_blank" rel="noopener">ã€Šä¸­å›½çš„â€œæ–°ææƒä¸»ä¹‰â€åŠå…¶æœ«ä¸–æ™¯è±¡ã€‹</a>) ï¼Œéšæ„å¯¹ä»–å…³æ³¨çš„å†…å®¹ä¹Ÿæœ‰æ‰€äº†è§£ã€‚æ€»æ„Ÿè§‰è¿™æœ¬ä¹¦æ›´åƒæ˜¯é˜¿ä¼¦ç‰¹ã€åŠ ç¼ªã€è¨ç‰¹ã€å“ˆç»´å°”ç­‰äººå¯¹äºææƒä¸»ä¹‰è‘—ä½œåŠæ€æƒ³çš„è§£æã€‚å°±åƒåœ¨å‰©ä½™ä»·å€¼é‡Œæåˆ°çš„ï¼Œæˆ‘ä»¬è¯»è¿™äº›å†å²çš„æ—¶å€™ï¼Œè€Œå½“ä¸‹å°±ä»¿ä½›ç½®èº«äºå†å²ä¹‹ä¸­ä¸€æ ·ã€‚ä¹¦ä¸­è®°å½•è‹è”å’Œçº³ç²¹å¾·å›½ææƒç»Ÿæ²»æ”¹é€ äººæ€§çš„è¨€è®ºå®¡æŸ¥ã€ç§˜å¯†è­¦å¯Ÿã€é›†ä¸­è¥ã€æ— è¨€è®ºè‡ªç”±å’Œæ–°é—»è‡ªç”±ã€å…šåª’æ„šæ°‘æ´—è„‘ç­‰ï¼Œè¿™äº›æè¿°ææƒç»Ÿæ²»çš„å†å²ï¼Œå†çœ‹ä¸€çœ‹å½“ä¸‹ï¼Œæˆ‘ä»¬ä¸æ­£ç½®èº«äºå…¶ä¸­å—ï¼Ÿ</p><p>æ¥åˆ°æœºåœºåœ¨æœºåœºè¿‡å®‰æ£€æ£€æŸ¥è¡Œæçš„æ—¶å€™ï¼Œä¸€å—ç¥–ä¼ çš„æ°¸ç£é“è¢«æ‰£ä¸‹äº†ï¼Œï¼ˆè¿™å—ç£é“æ˜¯æˆ‘é«˜ä¸­æ—¶ä»å®¶é‡Œç ´æ—§çš„éŸ³å“ä¸Šæ‹†ä¸‹æ¥çš„ï¼Œä¸€ç›´æ‹¿æ¥ç£å¸ä¸€äº›èºä¸ç”¨ï¼Œåƒåœ¾ä½¬å¸¸ç”¨çš„å·¥å…·ï¼‰ã€‚è¿™æ‰çŸ¥é“é£æœºä¸Šæ˜¯ä¸èƒ½æºå¸¦ç£é“çš„â‰¡(â–”ï¹â–”)â‰¡ï¼Œæ²¡åŠæ³•ï¼Œåªèƒ½ä¸¢ä¸‹äº†ã€‚</p><p>é¡ºåˆ©è¿‡äº†å®‰æ£€ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´å¼€å§‹ç™»æœºï¼Œåº§ä½åœ¨é£æœºé çª—çš„ä½ç½®ï¼Œä¸­é€”çš„é£æ™¯è¿˜ä¸é”™ã€‚çœ‹åˆ°çª—å¤–çš„äº‘æœµï¼Œæƒ³èµ·äº†ã€Šåœ°çƒçš„æ¼”å˜æ•…äº‹ã€‹é‡Œæœ‰å…³å¤§æ°”å±‚çš„ç§‘æ™®ï¼š</p><blockquote><p>åœ°çƒå‘¨å›´çš„å¤§æ°”å±‚åœ¨å‚ç›´æ–¹å‘ä¸Šå¯ä»¥åˆ†ä¸ºå¯¹æµå±‚ã€å¹³æµå±‚ã€ä¸­é—´å±‚ã€çƒ­å±‚å’Œå¤–å±‚ã€‚å…¶ä¸­å¯¹æµå±‚æ˜¯æœ€ä½çš„ä¸€å±‚ï¼Œå’Œäººç±»çš„å…³ç³»æœ€ä¸ºå¯†åˆ‡ã€‚è€Œå¤§ä¸­å‹é£æœºé™¤èµ·é£å’Œé™è½å¤–ï¼Œå¤šæ˜¯åœ¨å¹³æµå±‚ä¸­é£è¡Œã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºï¼šå¹³æµå±‚ä¸­å¤§æ°”å‚ç›´è¿åŠ¨å¾ˆå°‘ï¼Œä»¥å¹³æµè¿åŠ¨ä¸ºä¸»ï¼Œé£æœºåœ¨å…¶ä¸­å—åŠ›æ¯”è¾ƒç¨³å®šï¼›æ°´æ±½å’Œå°˜åŸƒå«é‡å°‘ï¼Œèƒ½è§åº¦å¾ˆé«˜ï¼›å¯¹åœ°é¢çš„å™ªå£°æ±¡æŸ“ç›¸å¯¹è¾ƒå°ï¼›é£é¸Ÿé£è¡Œçš„é«˜åº¦ä¸€èˆ¬è¾¾ä¸åˆ°å¹³æµå±‚ï¼Œå¯ä»¥é¿å…æœºé¸Ÿç›¸æ’çš„äº‹æ•…ã€‚å¹³æµå±‚çš„è¿™äº›ç‰¹ç‚¹ï¼Œå†³å®šäº†é£æœºé€‚å®œåœ¨è¿™å±‚å¤§æ°”ä¸­é£è¡Œã€‚å¹³æµå±‚çš„æµ·æ‹”é«˜åº¦ä¸çº¬åº¦æœ‰å¾ˆå¤§å…³ç³»ã€‚ä½çº¬åº¦åœ°åŒºå¹³å‡åœ¨16ï½18åƒç±³ä»¥ä¸Šï¼Œä¸­çº¬åº¦åœ°åŒºå¹³å‡åœ¨10ï½12åƒç±³ä»¥ä¸Šï¼›é«˜çº¬åº¦åœ°åŒºå¹³å‡åœ¨8ï½9åƒç±³ä»¥ä¸Šã€‚</p><p>æˆ‘å›½æ°‘èˆªè§„å®šï¼Œä¸­å‹ä»¥ä¸Šçš„æ°‘èˆªé£æœºéƒ½åœ¨é«˜ç©ºé£è¡Œï¼Œæ­¤å¤„çš„é«˜ç©ºæ˜¯æŒ‡æµ·æ‹”7000ï½12000ç±³çš„ç©ºé—´ã€‚é£è¡Œé«˜åº¦å±‚é«˜åº¦8400ç±³ï¼ˆå«ï¼‰ä»¥ä¸‹ï¼Œæ¯300ç±³ä¸ºä¸€ä¸ªé£è¡Œé«˜åº¦å±‚ï¼›é£è¡Œé«˜åº¦å±‚é«˜åº¦8400ç±³ï¼ˆä¸å«ï¼‰ä»¥ä¸Šï¼Œæ¯600ç±³ä¸ºä¸€ä¸ªé£è¡Œé«˜åº¦å±‚ã€‚é£æœºåœ¨ç›¸å¯¹ã€äº¤å‰ã€è¶…è¶Šé£è¡Œæ—¶ï¼Œå¿…é¡»ä¿æŒä¸å¾—å°äºè§„å®šé«˜åº¦å±‚ç±³æ•°çš„å‚ç›´é—´éš”ï¼Œä»¥ç¡®ä¿é£è¡Œå®‰å…¨å’Œäº¤é€šé¡ºç•…ã€‚ æ­¤å¤–ï¼Œå°å‹é£æœºæ´»åŠ¨åŒºåŸŸä¸€èˆ¬åœ¨3000ç±³ä»¥ä¸‹ã€‚</p></blockquote><p><img src="img/20200510_045930999_iOS.jpg" alt="image-20200516201412794"></p><p>ä¸‹äº†é£æœºä¹‹åä¹˜ååœ°é“åˆ°å…¬å¸é™„è¿‘çš„åœ°é“ç«™ï¼Œå’Œæˆ¿ä¸œçº¦å®šå¥½äº†æ¥æ¥æˆ‘ã€‚å‡ºç«™ä¹‹åæˆ¿ä¸œå¸¦é¢†ç€å»å¥¹å®¶ï¼Œåˆ°äº†ä¹‹åæ„Ÿè§‰è½å·®ååˆ†å·¨å¤§w(ï¾ŸĞ”ï¾Ÿ)wã€‚åœ¨ä¸åˆ° 5 å¹³ç±³çš„æˆ¿é—´é‡Œå¡ä¸‹ä¸€å¼  0.8m*2mçš„åºŠï¼Œå¦å¤–åŠè¾¹æ˜¯ä¸åˆ°ä¸€ç±³çš„è¿‡é“ã€‚è¿™ä¹Ÿæ˜¯è¿«ä¸å¾—å·²çš„é€‰æ‹©å§ï¼Œå› ä¸ºé™„è¿‘çš„æˆ¿å­åŸºæœ¬ä¸Šéƒ½æ˜¯æŠ¼ä¸€ä»˜ä¸‰ï¼Œè€Œä¸”ä»·æ ¼æ™®éåœ¨ 3000+ ï¼Œå†ç¨å¾®è¿œä¸€ç‚¹èƒ½æ‰¾åˆ° 1500+ å·¦å³çš„æˆ¿å­ï¼Œä¸è¿‡å¯¹äºæŠ¼ä¸€ä»˜ä¸‰æ¥è¯´æˆ‘ä¾æ—§æ— æ³•æ‰¿æ‹…çš„èµ·ã€‚æ‰“ç®—å…ˆæš‚æ—¶åœ¨è¿™é‡Œå°†å°±ä¸€æ®µæ—¶é—´ï¼Œç­‰å­˜æ¬¾è¶³å¤Ÿäº†å°±æ¬å‡ºå»å•ç‹¬ä½ä¸€é—´ã€‚è¿™é‡Œçš„ä»·æ ¼ä¹Ÿä¸ä¾¿å®œï¼Œæ¯æœˆæˆ¿ç§Ÿ 800ï¼ŒæŠ¼é‡‘ 850ï¼Œä¸éœ€è¦äº¤æ°´ç”µæš–è´¹ç”¨ã€‚å’Œæˆ‘ä»¥å‰ä½çš„ 300 å—é’±çš„é’æ—…ç¯å¢ƒè¿˜æ˜¯å·®å¤ªè¿œäº†ğŸ˜‚ã€‚</p><p><img src="img/2020-05-10_19-35-42.jpg" alt="img"></p><p>æ™šä¸Šåœ¨é™„è¿‘åƒäº†ä¸‰èœä¸€æ±¤çš„å¿«é¤ï¼Œæ™šä¸Šç¡è§‰çš„æ—¶å€™ååˆ†é…¸ç—›ï¼Œæˆ‘çš„è¡Œæè¿˜æ²¡æœ‰åˆ°ï¼Œåªèƒ½ç”¨åºŠå•ç®€å•åœ°ç›–åœ¨èº«ä¸Šã€‚åœ¨è¿™é‡Œç¡äº†å‡ æ™šï¼Œæ­¤ç”Ÿå¯æ‹ï¼Œä»¥åå†ä¹Ÿä¸æƒ³ä½é’æ—…äº†ã€‚æˆ‘è§‰ç€è¿˜æ˜¯åº”è¯¥å¯¹è‡ªå·±å¥½ä¸€ç‚¹ï¼Œæ‹¥æœ‰ä¸€ä¸ªè‡ªå·±ç‹¬ç«‹çš„å°çªå¤šä¹ˆåœ°é‡è¦ã€‚æ¯•ç«Ÿè°ä¹Ÿä¸çŸ¥é“è‡ªå·±ä¼šä¸ä¼šå‘ç”Ÿæ„å¤–çªç„¶ç¦»å¼€è¿™ä¸ªä¸–ç•Œï¼Œå¦‚æœç”Ÿå‰æ´»å¾—åƒæˆ‘è¿™æ ·åœ¨æ˜¯å¤ªæƒ¨äº†ğŸ˜‚ã€‚æ„Ÿè§‰åº”è¯¥å¯¹è‡ªå·±æ›´å¥½ä¸€ç‚¹ï¼Œæ¯”å¦‚å›å®¶çš„æ—¶å€™ä¹°ç«è½¦ç¥¨çš„æ—¶å€™ä¸èƒ½å†åƒä»¥å‰é‚£æ ·ä¹°äºŒåå‡ ä¸ªå°æ—¶çš„ç¡¬åº§ï¼Œè‡ªå·±èƒ½èµšé’±äº†åº”è¯¥é€‰æ‹©æ›´çœæ—¶èˆ’é€‚çš„å‡ºè¡Œæ–¹å¼ï¼Œåº”è¯¥å¤šå¤šæ”¹å–„ä¸€ä¸‹è‡ªå·±çš„ç”Ÿæ´»ï¼Œä¸èƒ½å†åƒä»¥å‰ç©·å­¦ç”Ÿä¸€æ ·è¿‡å¾—æƒ¨å…®å…®ğŸ˜‚</p><h2 id="11-å·"><a href="#11-å·" class="headerlink" title="11 å·"></a>11 å·</h2><p>æ—©èµ·å…«ç‚¹å¤šå»åŒ»é™¢ä½“æ£€ï¼Œå»åŒ»é™¢æœ‰ç‚¹å®³æ€•ã€‚å› ä¸ºä¸Šä¸ªæœˆå…¬å¸ç»„ç»‡å»åŒ»é™¢ä½“æ£€ï¼Œä»åŒ»é™¢å›æ¥ä¹‹åæˆ‘å°±çªç„¶å‘çƒ§äº†ï¼Œè¡€æ¸…æ£€æµ‹æ˜¯å› ä¸ºç»†èŒæ„ŸæŸ“ã€‚å¯¹äºæˆ‘è¿™ç§é•¿æœŸï¼ˆå…­å¹´ï¼‰ç´ é£Ÿçš„äººæ¥è¯´ï¼Œå¦‚æœä¸æ³¨é‡è¥å…»å‡è¡¡ï¼Œå…ç–«åŠ›ä¼šä¸‹é™çš„ï¼Œç°åœ¨æˆ‘å°±å±äºé‚£ç§å…ç–«åŠ›ä½ä¸‹çš„äººç¾¤ï¼Œç¨æœ‰ä¸æ…å°±ä¼šç”Ÿç—…ğŸ˜ã€‚ä¸è¿‡ä¸ºäº†åšæŒè‡ªå·±çš„åŸåˆ™ï¼Œè¿™ç‚¹ç‰ºç‰²è¿˜æ˜¯å¯ä»¥æ‰¿å—çš„(â—Ë‡âˆ€Ë‡â—)ã€‚</p><p>æ²¡æƒ³åˆ°åŒ»é™¢ä½“æ£€çš„äººæ•°é‚£ä¹ˆå¤šï¼Œéœ€è¦é¢„çº¦åˆ°åå¤©æ‰æœ‰ç©ºä½ï¼Œæœ€ç»ˆè¿˜æ˜¯é¢„çº¦åˆ°äº†åå¤©ã€‚é¢„çº¦å®Œä½“æ£€çš„æ—¶é—´ä¹‹åå°±å›åˆ°ä½çš„åœ°æ–¹ï¼Œå¤©æ°”å®åœ¨æ˜¯å¤ªçƒ­äº†ï¼Œåˆšæ¥è¿˜æ˜¯ä¸å¤ªä¹ æƒ¯ï¼ŒåŠ ä¸Šåˆæ˜¯ç‹­çª„çš„ç©ºé—´ï¼Œç»™äººä¸€ç§å¾ˆçƒ¦èºçš„æ„Ÿè§‰ã€‚è”ç³»äº†ä¸€ä¸‹å¦ä¸€å®¶å…¬å¸çš„ HR ï¼Œ(ä¹Ÿå°±æ˜¯ç°åœ¨æœ€ç»ˆå…¥èŒçš„å…¬å¸)ï¼Œç»™çš„å›å¤æ˜¯ä¸‰å¤©ä¹‹å†…ç»™å‡ºé¢è¯•ç»“æœã€‚å†…å¿ƒä¹Ÿååˆ†ç„¦æ€¥åœ°ç­‰å¾…ç€ï¼Œè‡ªå·±æ„Ÿè§‰åªæœ‰ä¸‰æˆçš„æŠŠæ¡æ‹¿åˆ° offerã€‚å¦‚æœæ‹¿åˆ°çš„è¯å°±è¦è€ƒè™‘ç¦»å¼€è¿™åº§åŸå¸‚ï¼Œåˆè¦ä»å¤´å¼€å§‹ï¼Œæ‰¾æˆ¿å­ï¼Œå¯„è¡Œæï¼Œä¹°æœºç¥¨ç­‰ç­‰ã€‚</p><p>èººåºŠä¸Šä¼‘æ¯ä¼šå„¿ï¼ŒåºŠæ¿å­å¤ªç¡¬äº†ï¼Œè¿˜æ˜¯åèµ·æ¥æ‹¿ç€ kindle çœ‹äº†ä¼šä¹¦ï¼Œä¸€ä¼šçš„æ—¶é—´å°±æŠŠã€Šä¸ƒå ‚æç®€ç‰©ç†è¯¾ã€‹çœ‹å®Œäº†ï¼Œè¿™æœ¬ä¹¦â€¦â€¦å†™çš„çœŸçš„ä¸å¤ªå¥½ï¼Œå¯¹äºå…·å¤‡åªæ˜¯ä¸€äº›ç®€å•çš„æ„Ÿå¿µæ™®åŠè€Œå·²ï¼Œå€’ä¸å¦‚å»çœ‹çœ‹ã€Šæ˜Ÿç©ºçš„ç´å¼¦ã€‹æˆ–è€…ã€Šä¸‡ç‰©ç®€å²ã€‹ã€‚</p><p>ä¸‹åˆçš„æ—¶å€™é¡ºä¸°å¿«é€’å¸ˆå‚…æ‰“ç”µè¯è®©æˆ‘å»å–ä»¶ï¼Œé‚®å¯„è¿‡æ¥çš„è¡Œæå·²ç»åˆ°äº†ã€‚70 å…¬æ–¤çš„è¡Œæä»å°åŒºé—¨å£æ¬è¿åˆ° 18 æ¥¼ï¼Œè¿˜å¥½å¿«é€’å¸ˆå‚…å€Ÿç»™äº†æˆ‘æ‰‹æ¨è½¦æ–¹ä¾¿äº†äº›ã€‚æŠŠè¡Œææ‹†å¼€åˆé‡æ–°åˆ†æ‹£äº†ä¸€ä¸‹</p><p>æ™šä¸Šçš„æ—¶å€™ç»ˆäºæ”¶åˆ°äº†é¢è¯•é€šè¿‡çš„æ¶ˆæ¯ï¼Œç®€å•è°ˆäº†ä¸€ä¸‹è–ªèµ„ã€‚æ¯”ç°åœ¨çš„è¿™å®¶å…¬å¸è–ªèµ„è¦ä½ 1kï¼Œè™½ç„¶ä½äº†ä¸€ç‚¹ä½†è¿˜æ˜¯èƒ½æ¥å—ã€‚äºæ˜¯å°±è®¡åˆ’ä¸€ä¸‹æ˜å¤©çš„äº‹æƒ…ï¼Œæ—©æ—©åœ°ç¡è§‰äº†ã€‚</p><h2 id="12-å·"><a href="#12-å·" class="headerlink" title="12 å·"></a>12 å·</h2><p>æ—©èµ·å»åŒ»é™¢å–æ¶ˆäº†ä½“æ£€é€€æ¬¾å¾ˆå¿«å°±åˆ°è´¦äº†ã€‚å›æ¥ä¹‹åå°±æ”¶æ‹¾è¡Œæï¼ŒæŠŠä¸€äº›æ²¡ç”¨çš„ç ´ç©æ„éƒ½æ‰”äº†ï¼Œæœºç®±å–å‡ºæ¥è‡ªå·±å¸¦åœ¨èº«ä¸Šã€‚ä¸ºäº†å‡è½»é‡é‡ï¼Œä¸Šæ¬¡é‚®å¯„å›æ¥ 70KG èŠ±äº† 318ï¿¥ğŸ˜­ã€‚è¿™æ¬¡æœ€ç»ˆå‡è½»åˆ° 50KG ï¼Œé‚®å¯„è´¹ç”¨ 210ï¿¥ï¼Œè¿˜ç®—èƒ½æ¥å—çš„èŒƒå›´ã€‚çœŸçš„<strong>æ˜¯ä¹°ä¹¦ä¸€æ—¶çˆ½ï¼Œæ¬å®¶ç«è‘¬åœºï¼</strong>å‡ åæ–¤ä¸­çš„ä¹¦ç±æ¬å®¶çœŸçš„æ˜¯ä¸ªç´¯èµ˜ğŸ˜­ã€‚æ”¶æ‹¾å®Œæ¯•åè”ç³»æ˜¨å¤©ç»™æˆ‘æ´¾é€å¿«é€’çš„å¸ˆå‚…é‚®å¯„å¿«é€’ï¼Œç”±äºåœ°ç‚¹æˆ¿å­è¿˜æ²¡æœ‰æ‰¾å¥½ï¼Œåœ°å€å°±å¡«å†™äº†å…¬å¸å¯¹é¢çš„å°åŒºï¼Œå¸Œæœ›åœ¨é‚£ä¸ªå°åŒºé‡Œæ‰¾åˆ°åˆé€‚çš„æˆ¿å­å§ã€‚</p><p>ä¸Šåˆåä¸€ç‚¹å¤šçš„æ—¶å€™æ”¶åˆ°äº†å…¬å¸çš„æ­£å¼ offer ï¼Œçº¦å®šå¥½ 18 å·å…¥èŒã€‚éšåè”ç³»å°†è¦ï¼ˆ13å·ï¼‰å…¥èŒçš„ A å…¬å¸ HR ï¼Œå‘å¥¹é“æ­‰å¹¶å¦‚å®åœ°è¯´æ˜äº†ä¸èƒ½å…¥èŒçš„åŸå› ã€‚å¤šå°‘æœ‰ç‚¹æ„§ç–šï¼Œå› ä¸ºç¬¬äºŒå¤©å°±è¦å…¥èŒäº†ï¼Œåœ¨å‰ä¸€å¤©å†é€šçŸ¥äººå®¶è¯´ä¸å»äº†ï¼Œæ¢åšè°éƒ½å¾ˆæ°”æ„¤å§ã€‚</p><p>ä¸‹åˆçš„æ—¶å€™ï¼Œæ”¶æ‹¾å¥½è¡Œäº†å°±å»æœºåœºé™„è¿‘çš„é…’åº—ï¼Œç”±äºæ˜¯æ—©ä¸Šçš„é£æœºï¼Œæ—¶é—´ç´§è¿«åªå¥½ä½åœ¨é…’åº—é™„è¿‘äº†ï¼Œè¿˜å¥½é…’åº—æä¾›å…è´¹æ¥é€çš„æœåŠ¡ï¼Œåœ¨å‰å°ç™»è®°ä¸€ä¸‹å‡ºå‘æ—¶é—´ï¼Œç¬¬äºŒå¤©å¸æœºå¸ˆå‚…ä¼šå¼€è½¦é€åˆ°æœºåœºã€‚</p><p>æ™šä¸Šçš„æ—¶å€™çº¦æœ‹å‹åƒé¥­ï¼Œä¸€ä¸ªé«˜ä¸­åŒå­¦ï¼Œå…³ç³»è¿˜å¯ä»¥ã€‚è¿™ä½æœ‹å‹æœ‰ç‚¹å¥‡è‘©ï¼Œå¤§ä¸€çš„æ—¶å€™æ˜¯åœ¨å¤§è¿æµ·äº‹å¤§å­¦ä¸Šçš„èˆªæµ·ä¸“ä¸šï¼Œå¤§ä¸€ä¸Šå®Œä¹‹åçš„æš‘å‡åˆé€€å­¦å›å®¶å¤è¯»ä¸€å¹´ï¼Œæœ€ç»ˆè€ƒä¸Šäº†ä¸€æ‰€ 211 å¤§å­¦å¹¶å­¦çš„è®¡ç®—æœºä¸“ä¸šï¼Œç°åœ¨åœ¨ BAT åšåç«¯å¼€å‘ï¼Œè–ªèµ„æ¯”æˆ‘é«˜å¾ˆå¤šï¼Œè€Œä¸”è¿˜æ‹¿åˆ°äº† shoppe çš„ offer ï¼Œæœ‰ç‚¹åŒè¾ˆå‹åŠ›ğŸï¼Œæ„Ÿè§‰è‡ªå·±å¤ªèœäº†ğŸ˜¥ã€‚äº¤è°ˆçš„è¿‡ç¨‹ä¸­æœ¬ä»¥ä¸ºä»–è¿˜æ˜¯ä»¥å¾€é‚£æ ·å²æœˆé™å¥½ï¼Œä¸è¿‡å°è±¡å¤§åè½¬ã€‚åŸæ¥æ˜¯ä»–å®¶ä¹Ÿé­å—åˆ°ç¤¾ä¼šä¸»ä¹‰é“æ‹³çš„é‡é”¤ğŸ˜‚ï¼Œå’Œæˆ‘ä¸€æ ·çš„æ„Ÿå—ã€‚ç„¶åè°ˆäº†å‡ ä½é«˜ä¸­åŒå­¦çš„ç°çŠ¶ï¼Œä»–è¿˜å˜²è®½å¦å‡ ä½å²æœˆé™å¥½çš„åŒç­åŒå­¦æ²¡æœ‰é­å—ç¤¾ä¼šé“æ‹³çš„æ¯’æ‰“ğŸ¤£ã€‚å“ˆå“ˆå•¥ï¼Œæˆ‘å€’æ˜¯è§‰ç€å²æœˆé™å¥½æ²¡æœ‰ä»€ä¹ˆä¸å¯¹çš„ï¼Œæˆ‘å¸Œæœ›ç¥ç¦ä»–ä»¬èƒ½è¿™æ ·å®‰å®‰ç¨³ç¨³åœ°ç”Ÿæ´»ä¸‹å»å§ï¼Œä½†æ„¿ä»–ä»¬ä¸è¦æƒ³æˆ‘è¿™æ ·é­å—ç¤¾ä¼šä¸»ä¹‰é“æ‹³çš„é‡é”¤ã€‚ã€Šå¿ƒç†æµ‹é‡è€…ã€‹å°è¯´é‡Œæ›¾æåˆ°è¿‡è¿™æ ·ä¸€æ®µå¯¹è¯ï¼š</p><blockquote><p>â€œå®‰å…¨ï¼Œå®Œç¾çš„ç¤¾ä¼šåªæ˜¯ä¸ªå¹»æƒ³ç½¢äº†ã€‚æˆ‘ä»¬ç”Ÿæ´»çš„ç¤¾ä¼šå¦‚ä»Šè¿˜æ˜¯â€˜å±é™©ç¤¾ä¼šâ€™â€</p><p>â€œä»€ä¹ˆæ„æ€â€¦â€¦ï¼Ÿâ€</p><p>â€œå¾ˆä¹…ä»¥å‰â€¦â€¦å¾·å›½è¿˜ç®—ä¸ªå›½å®¶çš„æ—¶å€™ï¼Œæœ‰ä¸ªç¤¾ä¼šå­¦å®¶ï¼Œä¹Œå°”å¸Œé‡ŒÂ·è´å…‹ï¼ˆç»å¸¸è¯´çš„è¯ã€‚æŒ‡ç¤¾ä¼šä¾èµ–â€˜ä¾¿åˆ©ä½†å±é™©â€™çš„ä¸œè¥¿ï¼Œæ”¿åºœè®©æˆ‘ä»¬èƒŒè´Ÿèµ·é£é™©â€¦â€¦ä½†é£é™©è¢«å·§å¦™åœ°åˆ†æ•£ï¼Œåˆ†é…ä»¥è‡³äºè°ä¹Ÿæ²¡è§‰å¯Ÿåˆ°ï¼Œä¸å¯¹ï¼Œä¸æ˜¯æ²¡è§‰å¯Ÿåˆ°ï¼Œè€Œæ˜¯å³ä½¿è§‰å¯Ÿäº†ä¹Ÿå½“æ²¡çœ‹è§ï¼Œæˆ–è®¸æ¯ä¸ªäººéƒ½åœ¨çä¸€åªé—­ä¸€åªçœ¼ï¼Œå±é™©å›ºç„¶å­˜åœ¨ï¼Œä½†å¦‚æœä¸åè¿‡æ¥å½“ä½œå…¶ä¸å­˜åœ¨çš„è¯å°±æ— æ³•ä¿æŒç†æ™ºã€‚ â€œè¿™åº§åŸå¸‚çš„å¸‚æ°‘ï¼Œä¼šæƒ³åˆ°è¿™ä¹ˆå¤šä¹ˆï¼Œå°±è¿æˆ‘ä¹Ÿç®—åœ¨å†…ã€‚â€œ</p></blockquote><p>æˆ‘ä»¬å…±åŒèƒŒè´Ÿç€æ”¿åºœå¼ºåŠ ç»™æˆ‘ä»¬çš„å±é™©ï¼Œè€Œè¿™ç§å±é™©æ¥è‡ªäºæƒåŠ›çš„é›†ä¸­åŒ–ã€‚è¿™ç§å±é™©å·§å¦™åœ°åˆ†æ•£åˆ°æ¯ä¸ªäººèº«ä¸Šï¼Œä»¥è‡³äºè°ä¹Ÿå¯Ÿè§‰ä¸åˆ°å®ƒçš„å­˜åœ¨ï¼Œå³ä¾¿æ˜¯å¯Ÿè§‰åˆ°ï¼Œä¹Ÿåªèƒ½çä¸€åªçœ¼é—­ä¸€åªçœ¼ã€‚å¦‚æœä¸æŠŠå®ƒå½“ä½œä¸å­˜åœ¨çš„è¯ï¼Œå°±æ— æ³•åœ¨è¿™ä¸ªç¤¾ä¼šç”Ÿå­˜ä¸‹å»ã€‚</p><p>å’Œæœ‹å‹å·²å¿«åˆ°æµ·è¾¹é€›äº†ä¸€ä¼šå„¿ï¼Œå¤§æ™šä¸Šçš„æµ·è¾¹çš„é£æ™¯ç¡®å®æ²¡æœ‰ä»€ä¹ˆå€¼å¾—æ¬£èµçš„ï¼Œä¹‹åå°±å›åˆ°é…’åº—ä¼‘æ¯äº†ã€‚</p><h2 id="13-å·"><a href="#13-å·" class="headerlink" title="13 å·"></a>13 å·</h2><p>å‡Œæ™¨ä¹˜é£æœºå‡ºå‘ï¼Œè¿˜å¥½é…’åº—çš„å¸ˆå‚…å…è´¹å¼€è½¦é€åˆ°æœºåœºï¼Œåœ¨åŠç†è¡Œææ‰˜è¿çš„æ—¶å€™ï¼Œè¡Œæè¶…é‡äº† 5KGï¼Œå°±æŠŠæˆ‘çš„å°å¼æœºæœºç®±å–äº†å‡ºæ¥æŠ±åœ¨æ€€é‡Œéšèº«æºå¸¦è€…å§ï¼Œä¹Ÿä¸çŸ¥é“èƒ½ä¸èƒ½è¿‡æ¡ˆä»¶ï¼Œæ¯•ç«Ÿæ˜¯æ¥è¿‘ 5KG çš„é‡è´§ã€‚è¿‡å®‰æ£€çš„æ—¶å€™æ²¡æƒ³åˆ°å¤§æ‘‡å¤§æ‘†åœ°æŠ±ç€æœºç®±å°±è¿‡äº†å®‰æ£€ï¼Œæœ‰ç‚¹å‡ºä¹æ„æ–™ã€‚é¡ºåˆ©ç™»æœºåååœ¨äº†é çª—çš„ä½ç½®ï¼Œä¼‘æ¯ä¸¤ä¸ªå°æ—¶ä¹‹åå°±åˆ°è¾¾äº†ç›®çš„åŸå¸‚ã€‚</p><p>ä¸‹é£æœºååæœºåœºå·´å£«åˆ°é…’åº—ï¼Œä¹Ÿæ˜¯åœ¨å…¬å¸é™„è¿‘ã€‚æ­‡æ¯ä¸€ä¼šå„¿åå¼€å§‹æ´—è¡£æœï¼Œé”™æŠŠé…’åº—æ´—è¡£æˆ¿é‡Œçš„æ¼‚ç™½ç²‰å½“ä½œæ´—è¡£ç²‰ç”¨äº†ï¼Œä¸€è‚¡è„‘åœ°æ”¾äº†ä¸€å¤§å‹ºå†æ´—è¡£æœºé‡Œï¼Œæ´—å®Œä¹‹åæˆ‘é‚£ä»¶é»‘è‰²çš„ USTC LUG å®šåˆ¶ç‰ˆ T æ¤è¢«åŠ ä¸Šäº†ä¸€å±‚çº¢è¤è‰²çš„æ»¤é•œï¼Œæˆ‘æ¬²å“­æˆ‘ç´¯ğŸ˜­ï¼Œå¤ªéš¾å—äº†ï¼Œæœ¬æ‰“ç®—ä¸‹å‘¨å…¥èŒçš„é‚£å¤©è¦ç©¿çš„ğŸ˜­ã€‚ä¸€ä»¶å¥½å¥½åœ° T æ¤å°±è¿™æ ·è¢«æ‘§æ®‹äº†ï¼Œéš¾å—æ­»äº†ğŸ˜‘ã€‚</p><p>ä¸‹åˆä¼‘æ¯äº†ä¸€ä¼šå»çœ‹æˆ¿ï¼Œè”ç³»çš„è›‹å£³å…¬å¯“ï¼Œçœ‹äº†ä¸¤æˆ·æˆ¿å­ï¼Œè¿˜ç®—æ»¡æ„ï¼Œå¹¶ä¸”å¯ä»¥æŠ¼ä¸€ä»˜ä¸€ï¼Œæ€»ä»·æ ¼ä¸åˆ° 3000 å…ƒï¼Œè¿˜èƒ½æ¥å—ã€‚ä¸è¿‡åˆ°æœ€åè›‹å£³å…¬å¯“çš„è€å“¥æ‰ç»™æˆ‘è°ˆåˆ†æœŸä»˜æ¬¾çš„äº‹å„¿ã€‚ä¹‹å‰æˆ‘ä»æœªä½è¿‡è¿™ç§è¿é”å…¬å¯“ï¼Œæ²¡æƒ³åˆ°éœ€è¦å’Œå¾®ä¼—é“¶è¡Œç­¾è®¢ä¸€å¹´çš„åˆ†æœŸåè®®ï¼Œè¿™ä¸€ç‚¹å¾ˆå‘ï¼Œè™½ç„¶ä»·æ ¼è¯±äººä½†æˆ‘æœ¬äººå¯¹è¿™ç§åˆ†æœŸçš„æ–¹å¼åŠå…¶åæ„Ÿäºæ˜¯è¿˜æ˜¯æ”¾å¼ƒäº†åœ¨è›‹å£³å…¬å¯“ä¸Šç§Ÿæˆ¿ã€‚æˆ¿å­å’Œå¸¦æˆ‘çœ‹æˆ¿çš„è€å“¥éƒ½å¾ˆæ»¡æ„ï¼Œåªæ˜¯ä¸æƒ³ä½¿ç”¨åˆ†æœŸä»˜æ¬¾çš„è¿™ç§æ–¹å¼ã€‚ä¹‹åå†æ”¯ä¹ä¸Šçœ‹åˆ°äº† <a href="https://zhuanlan.zhihu.com/p/139490531" target="_blank" rel="noopener">ä½†æœ‰â€œè›‹å£³â€æ–¹é¢çš„ç§Ÿæˆ¿æ‰¾ä½ ï¼Œåº”å±Šç”Ÿè¯·åŠ¡å¿…çœ‹å®Œè¿™ç¯‡æ–‡ç« </a>ï¼Œè¿˜å¥½æˆ‘æ²¡æœ‰è¸©å‘ï¼Œåº†å¹¸åº†å¹¸ã€‚ä¹‹ååˆè”ç³»äº†è‡ªå¦‚çš„æˆ¿å­ï¼Œè‡ªå¦‚æŠ¼ä¸€ä»˜ä¸€çš„æˆ¿å­ä»·æ ¼è´µäº†ä¸€å¤§æˆªï¼Œæˆ¿ç§Ÿæ¯æœˆè¦ 2100ï¼ŒæŠ¼é‡‘ 2000 æœ‰ç‚¹æ¥å—ä¸äº†å°±æ²¡æœ‰å†è€ƒè™‘ã€‚è´«ç©·ä½¿æˆ‘ä½ä¸èµ·æˆ¿ï¼ˆï¼ˆ</p><p>ç»ˆäºåœ¨é—²é±¼ä¸Šè”ç³»åˆ°ä¸€ä¸ªè€å“¥ï¼Œè¯´æ˜¯è½¬ç§Ÿçš„æˆ¿å­ï¼Œè€Œä¸”ä¸éœ€è¦æŠ¼é‡‘ï¼Œæ¯æœˆä»˜æˆ¿ç§Ÿå°±å¯ä»¥ï¼Œè¿™ç‚¹å¾ˆè¯±äººå•Šã€‚äºæ˜¯å°±è¿«ä¸åŠå¾…åœ°çœ‹æˆ¿ï¼Œæœ€ç»ˆè§é¢ä¹‹åï¼Œå¾ˆç—›å¿«çš„å®Œæˆäº†äº¤æ˜“ï¼Œç»ˆäºè§£å†³äº†æœ€å¤´ç–¼å¾—ä¸€ä»¶äº‹å„¿ã€‚</p><h2 id="14-å·"><a href="#14-å·" class="headerlink" title="14 å·"></a>14 å·</h2><p>ä¸Šåˆé…’åº—é€€æˆ¿ï¼Œæ¬åˆ°æ–°ä½çš„åœ°æ–¹ï¼Œæ”¶æ‹¾ä¸€ä¸‹æˆ¿é—´ï¼Œæ‹¿ä»¥å‰çš„æ¯›å·¾ç”¨æ‰‹æ‹–å®Œäº†åœ°æ¿ï¼Œåšäº†ä¸€ä¼šå®¶åŠ¡ã€‚ä¸‹åˆçš„æ—¶å€™é¡ºä¸°å¿«é€’å¯„è¡Œæï¼Œè¡Œæé€åˆ°å°åŒºé—¨å£ï¼Œ50å…¬æ–¤çš„è¡Œæï¼Œä»å°åŒºé—¨å£åˆ°æ¥¼ä¸‹å¤§æ¦‚ 200 ç±³çš„è·ç¦»ï¼Œæ‰›èµ·æ¥çœŸçš„æ˜¯æœ‰ç‚¹è¿œå•ŠğŸ˜­ï¼Œå› ä¸ºæ˜¯è‡ªä»ä¸Šå¤§å­¦ä¹‹åå°±æ²¡å†æ¬ç –å¹²å†œæ´»çš„åŸå› ï¼Œä½“åŠ›å¤§ä¸å¦‚ä»å‰ï¼Œæ‰›ç€ 100 æ–¤çš„è¡Œæï¼Œ200 ç±³çš„è·ç¦»æ¢äº†åå‡ æ¬¡çš„è‚©åœä¸‹æ¥æ­‡æ¯å‡ åˆ†é’Ÿï¼Œè¿œè¿œä½äºä¸šç•Œ 100KG/5KM ä¸æ¢è‚©çš„æ ‡å‡†ï¼Œå®åœ¨æ˜¯æ„§å¯¹äºè‡ªå·±çš„è‚Œè‚‰å•ŠğŸ™ƒï¼Œæƒ­æ„§æƒ­æ„§ï¼ˆä»¥å‰æˆ‘åäº”å²è¾å­¦å†å·¥åœ°ä¸Šæ¬ç –é‚£å¹´ï¼Œè‡ªå·±ä¸€ä¸ªäººæ‰›ä¸€ç™¾å¤šæ–¤ä¸­çš„æœºå™¨åœ¨å·¥åœ°ä¸Šè¡Œäº‘æµæ°´ç©¿æ¢­äºå„ä¸ªæ²Ÿé“ä¹‹é—´ï¼Œï¼ˆå·ç¬‘ï¼Œäººè€äº†å•Šï¼Œå¤±å»äº†å¹´è½»æ—¶çš„çƒ­è¡€.jpg</p><p>æ™šä¸Šä¹°äº›ç”Ÿæ´»ç”¨å“ï¼Œå°åœŸè±†å‘Šè¯‰æˆ‘åœ¨<code>è¿˜ä¸æ™š</code>ä¸Šä¹°åˆé€‚ï¼Œä»·æ ¼ä¾¿å®œè€Œä¸”ç§ç±»é½å…¨ã€‚è´«ç©·å¦‚æˆ‘åªèƒ½é æŠ å’Œè–…æ¥æ»¡è¶³ç”Ÿæ´»äº†ï¼Œå¬å°åœŸè±†çš„å»ºè®®åœ¨é©¬äº‘å®¶é€›äº†ä¸€ä¸ªå¤šå°æ—¶ä¹°å¥½äº†ä»¥åè¦ç”¨åˆ°çš„ç”Ÿæ´»ç‰©å“ã€‚æ¥ç€çœ‹äº†ä¸€ä¼šå¾è´²çš„ä¹¦å°±ç¡ç€äº†ï¼Œè‡ªå·±ç”±äºå¤ªå¿™çš„åŸå› é˜…è¯»çš„æ—¶é—´è¿œä¸å¦‚ä»å‰äº†ï¼ï¸¿ï¼œ</p><h2 id="15-å·"><a href="#15-å·" class="headerlink" title="15 å·"></a>15 å·</h2><p>æ—©ä¸Šèµ·æ¥ä¹‹åå‡ºé—¨éª‘è½¦å•è½¦å¾€å…¬å¸é™„è¿‘é€›ä¸€åœˆï¼Œç†Ÿæ‚‰ä¸€ä¸‹ä¸Šç­æ—¶çš„è·¯çº¿ï¼Œçœ‹çœ‹éœ€è¦èŠ±è´¹å¤šé•¿æ—¶é—´ã€‚å›æ¥ä¹‹åå°±æ¥ç€å»é“¶è¡ŒåŠç†é“¶è¡Œå¡ç”¨ä½œå·¥èµ„å¡ã€‚æ¥ç€å®Œæˆä¹‹ååˆå»äº†ç…§ç›¸é¦†æ‹ 1 å¯¸çš„ç…§ç‰‡ï¼ŒåŠç†ç¤¾ä¿å¡çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚ä¸­åˆçš„æ—¶å€™åœ¨é“¶è¡Œé™„è¿‘çš„å…°å·æ‹‰é¢é¤é¦†é‡Œåƒäº†ç¢—é¸¡è›‹æ‹‰é¢ï¼Œå‘³é“è¿˜æ˜¯æ­£å®—çš„å…°å·æ‹‰é¢ã€‚è€æ¿å’Œå¨å¸ˆçœ‹æ ·å­ä¹Ÿæ˜¯å›æ—äººã€‚çœ‹äº†ä¸€ä¸‹èœå•ï¼Œç•ªèŒ„ç‚’é¥­ã€é…¸è¾£ç™½èœã€é…¸è¾£åœŸè±†ä¸ã€é¸¡è›‹æ‹‰é¢ç­‰ã€‚å“ˆå“ˆå“ˆï¼Œè¿™å°±æ˜¯ä»¥åå¸¸æ¥åƒé¥­çš„åœ°æ–¹äº†ğŸ˜‚ã€‚</p><h2 id="16-å·"><a href="#16-å·" class="headerlink" title="16 å·"></a>16 å·</h2><p>æ—©ä¸Šå…«ç‚¹çš„æ—¶å€™å’Œé—²é±¼ä¸Šçš„è€å“¥çº¦å¥½å»æŸåœ°é¢åŸºäº¤æ˜“å±±åœ°è½¦ï¼Œå› ä¸ºè·ç¦»æ¯”è¾ƒè¿œæ‰€ä»¥å°±ä¹˜åå…¬äº¤åˆ°äº†çº¦å®šå¥½çš„åœ°æ–¹ã€‚è§é¢ä¹‹åç®€å•å¯’æš„äº†ä¸€ä¸‹ï¼Œå…ˆè¯•éª‘äº†ä¸€æ®µè·ç¦»ï¼Œåˆ¹è½¦å’Œå˜é€Ÿéƒ½è¿˜å¯ä»¥ï¼Œå°±å¾ˆç—›å¿«åœ°ä¹°ä¸‹æ¥è¿™è¾†è½¦ã€‚ä»æ­¤ä¹Ÿæ˜¯æœ‰è½¦ä¸€æ—äº†ï¼ˆå·ç¬‘ã€‚æœ‰äº†ä¸€è¾†è½¦çœŸæ˜¯æ–¹ä¾¿å•Šï¼Œä¹‹å‰ä¸‹æ¥¼åæ­¥è¡Œåˆ°å°åŒºé—¨å£éœ€è¦ 5 åˆ†é’Ÿï¼Œç°åœ¨éª‘è½¦åªéœ€ 1 åˆ†é’Ÿå°±å¤Ÿäº†ï¼Œæ¯”ä»¥å¾€å¿«äº†å¾ˆå¤šã€‚ä¹‹æ‰€ä»¥ä¹°ä¸€è¾†äºŒæ‰‹çš„å±±åœ°è½¦æ˜¯å› ä¸ºæ—©ä¸Šä¸Šç­æ—¶å°åŒºé—¨å£çš„å…±äº«å•è½¦éƒ½è¢«ä¸Šç­æ—éª‘èµ°äº†ï¼Œä¸ºäº†èŠ‚çœæ—¶é—´è¿˜æ˜¯æ•´è¾†è‡ªå·±çš„å•è½¦å§ï¼Œè€Œä¸”å…±äº«å•è½¦éª‘èµ·æ¥çœŸè´¹åŠ²ï¼Œé€Ÿåº¦å¤ªæ…¢äº†ã€‚æ¢åš 24 é€Ÿçš„å±±åœ°è½¦é€Ÿåº¦æå‡ä¸€å€ï¼Œæ—¶é—´ä¹Ÿèƒ½ç¼©çŸ­ä¸€åŠï¼Œä»¥å¾€ 15 åˆ†é’Ÿçš„éª‘è¡Œè·¯ç¨‹ç°åœ¨éª‘å¿«ä¸€ç‚¹çš„è¯åªéœ€è¦ 10 åˆ†é’Ÿã€‚é‚£è¿˜æ˜¯æŒ‰ç…§å¾€å¸¸é‚£æ · 8 ç‚¹åŠå‡ºå‘ï¼Œ9 ç‚¹ä¹‹å‰èµ¶åˆ°å…¬å¸æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚è€Œä¸”è‡ªå·±æœ€å–œæ¬¢çš„è¿åŠ¨ä¹Ÿæ˜¯éª‘è¡Œï¼Œé«˜ä¸­çš„æ˜¯åŸºæœ¬ä¸Šéƒ½æ˜¯éª‘è½¦å»ä¸Šå­¦ï¼Œé«˜è€ƒå®Œçš„æ—¶å€™æ›¾è‡ªå·±ä¸€ä¸ªäººéª‘è½¦å»åŒ—äº¬ã€‚æ¥å› 1000å…¬é‡Œçš„è·ç¦»ï¼Œæƒ³æƒ³å½“åˆä¹Ÿæ˜¯é—²ç€è›‹ç–¼ã€‚æ›¾åœ¨å¤§ä¸€çš„æ—¶å€™è®¡åˆ’æˆ–è¦å»éª‘è¡Œå·è—çº¿ï¼Œå››å¹´ä¹‹åçœ‹æ¥è¿™ä¸ªå°ç›®æ ‡è¦æ‰“æ°´æ¼‚äº†ã€‚æˆ–è€…ç­‰åˆ°å›½åº†çš„æ—¶å€™å‡†å¤‡éª‘è¡Œå»ç©å„¿ï¼Œéª‘è¡Œå»æµ·è¾¹ç©å„¿ï¼Œå—¯ï¼Œå°±è¿™æ ·å®šä¸‹æ¥äº†ï¼Œå¦‚æœè¯»è€…åˆæƒ³å»çš„è¯å¯ä»¥è”ç³»å’±ä¸€å—å»ğŸ˜‚</p><p>ä¸‹åˆä¿®ç©ºè°ƒï¼Œæ„Ÿè§‰è¢«å®°äº†ï¼Œæˆ‘ä¼°è®¡ç€åº”è¯¥å°±æ˜¯ä¸€æ ¹è·³çº¿æ²¡æœ‰æ¥å¥½æˆ–è€…æ¥å¯¹å¯¼è‡´ç©ºè°ƒä¸»æœºæ— æ³•å¼€å¯ã€‚è¦æ˜¯æ¢ä½œæˆ‘å®¶çš„ç©ºè°ƒï¼Œè¿™ç§å°é—®é¢˜è‡ªå·±å°±èƒ½è§£å†³ï¼Œæ¯•ç«Ÿå®¶é‡Œçš„ç”µç£ç‚‰æ´—è¡£æœºç©ºè°ƒç”µè§†æœºç”µé£æ‰‡ç­‰ç­‰å®¶ç”µè‡ªå·±éƒ½æ‹†è¿‡ä¿®è¿‡ğŸ˜‚ã€‚å› ä¸ºæˆ¿ä¸œå®¶çš„ç©ºè°ƒæ˜¯ä¸­å¤®ç©ºè°ƒä»·æ ¼æ˜‚è´µè‡ªå·±è¿˜æ˜¯ä¸æ•¢è½»æ˜“å°è¯•ï¼Œæ‰€ä»¥è¿˜æ˜¯è®©æˆ¿ä¸œæ¥è¯·ç»´ä¿®å·¥äººå¤„ç†å§ã€‚ä¸‹åˆçš„æ—¶å€™æˆ¿ä¸œè¯·æ¥çš„ç»´ä¿®å·¥äººå€’è…¾ä¸€ä¼šå„¿ç¡¬æ˜¯ç»™æˆ‘è¯´ä¸»æ¿åäº†(* ï¿£ï¸¿ï¿£)ã€‚äºæ˜¯å¥½æˆä¸Šåœºï¼Œæˆ‘å°±å’Œç»´ä¿®å·¥äººæ ä¸Šäº†ã€‚æˆ‘é—®ä»–ä¸»æ¿å“ªé‡Œåäº†ï¼Ÿä»–è¯´ç”µå®¹åäº†ï¼Œéœ€è¦æ›´æ¢ä¸»æ¿ã€‚æˆ‘å†…å¿ƒä¸€ä¸‡åŒ¹è‰æ³¥é©¬å¥”è…¾è€Œè¿‡ï¼Œä¸€ä¸ªç”µå®¹åäº†å°±è¦æ¢æ•´ä¸ªä¸»æ¿ï¼Ÿï¼Ÿï¼Ÿï¼Ÿæˆ‘å½“åœºæå‡ºæˆ‘ç¥–ä¼ çš„ç”µçƒ™é“è¦ç»™ä»–æ¼”ç¤ºä¸€ä¸‹æ€ä¹ˆæ¢ç”µå®¹ï¼Œé£çº¿æ¢ç”µå®¹æ¤çƒç­‰ç­‰è¿™ç‚¹æœ¬é¢†å’±è¿˜æ˜¯æœ‰æ»´ï¼Œç”µå®¹åäº†æ¢ç”µå®¹ä¸å¾—äº†ï¼Ÿå½“æˆ‘å‚»å­æ¥å¿½æ‚ å˜›ã€‚å·´æ‹‰å·´æ‹‰å’Œä»–æ‰¯äº†åŠå¤©ï¼Œæœ€ç»ˆâ€¦â€¦è¿˜æ˜¯æ”¶äº† 640ï¿¥ã€‚è™½ç„¶è¿™ç¬”é’±æ˜¯æˆ¿ä¸œæ¥ä»˜çš„ï¼Œä½†æ˜¯è¿˜æ˜¯å¾ˆä¸å¿ƒç”˜æƒ…æ„¿ï¼Œå°±è¿™æ ·è¢«åˆ«äººå®°ä¸€åˆ€ï¼Œæ— è®ºå®°åˆ°è°èº«ä¸Šéƒ½ä¸å¥½å—ã€‚</p><p><strong>ä¸»æ¿åäº†</strong> è¿™æ‹›å¯¹äºå®¶ç”µæˆ–è€…ç”µå­ç»´ä¿®æ˜‚è¡Œä¸šçš„ç¥å™¨å‘€ï¼Œç©ºè°ƒå°æ¯›ç—…ç»™ä½ æ•´ä¸ªä¸»æ¿åäº†çš„æ¥å£ä»ä½ èº«ä¸Šè–…ä¸€æŠŠç¾Šæ¯›ã€‚ç±»ä¼¼çš„äº‹æƒ…åœ¨ä¿®ç†ç¬”è®°æœ¬ç”µè„‘æˆ–è€…ç”µè§†æœºç­‰ç­‰éƒ½æ˜¯å¸¸è§çš„äº‹æƒ…ã€‚</p><p>ä¸‹åˆçš„æ—¶å€™æ•£çƒ­ç¡…è„‚å’Œ CPU å»¶é•¿çº¿åˆ°äº†ï¼Œæ‹¿äº†å¿«é€’ä¹‹åå°±å¼€å§‹ç»„è£…å°å¼æœºã€‚åœ¨æ‹†ä¸»æ¿çš„æ—¶å€™ï¼Œç®€ç›´éœ‡æƒŠæ­»æˆ‘ï¼Œæ²¡æƒ³åˆ°æˆ‘çš„ä¸»æ¿ CPU 4PIN å»¶é•¿çº¿å·²ç»è€åŒ–çŸ­è·¯çƒ§æ¯äº†ï¼Œæˆ‘ä½¿ç”¨äº†ä¸€å¹´ç«Ÿç„¶æµ‘ç„¶ä¸çŸ¥ã€‚ä¹‹å‰åœ¨ç»™ <a href="https://github.com/webp-sh/webp_server_go" target="_blank" rel="noopener">Webp Server Go</a> åš benchmark çš„æ—¶å€™ï¼ŒCPU ä¸€æ—¦æ»¡è½½å°±ç›´æ¥é»‘å±ï¼Œå„ç§æ’æŸ¥éƒ½æ²¡æœ‰æ‰¾åˆ°åŸå› ã€‚ç›´åˆ°ä»Šå¤©æˆ‘æ‰æ˜ç™½ï¼ŒåŸæ¥æ˜¯ CPU ä¾›ç”µçº¿çš„é—®é¢˜â€¦â€¦ï¼Œæˆ‘å†…å¿ƒä¸€ä¸‡åŒ¹è‰æ³¥é©¬ã€‚æ— è‰¯å•†å®¶å‘æƒ¨æˆ‘äº†ï¼Œå»å¹´çš„æ—¶å€™è£…æœºæ²¡æœ‰æ³¨æ„åˆ°è¿™æ ¹çº¿çš„è´¨é‡è¿™ä¹ˆå·®ï¼Œè¿˜å¥½ç°åœ¨æ‹†æœºçš„æ—¶å€™å‘ç°äº†ï¼Œä¸ç„¶é‚£ä¸€å¤©è¿™æ ¹çº¿æŠ½æäº†çªç„¶å°± BOOM å¯ä¸å¥½äº†ğŸ˜¡ã€‚</p><p><img src="img/20200514_070432138_iOS.jpg" alt="image-20200517101303617"></p><p>ç»„è£…åçš„å°å¼æœºæ•ˆæœå›¾ï¼ŒæŠŠè·¯ç”±å™¨æ”¾åœ¨äº†æœºç®±ä¸Šé¢ã€‚ä¸»è·¯ç”±å™¨è¿˜æ˜¯åŸæ¥çš„ <a href="https://www.netgear.com/support/product/R6300v2.aspx" target="_blank" rel="noopener">R6300V2</a> ï¼Œæ˜¯å»å¹´çš„æ—¶å€™èŠ±äº† 170ï¿¥ åœ¨é—²é±¼ä¸Šæ¡åƒåœ¾ææ¥çš„ã€‚æ—è¾¹ç™½è‰²çš„å°±æ˜¯ N1 ç›’å­ï¼Œå½“è½¯è·¯ç”±æ¥ç”¨(<a href="https://blog.k8s.li/N1-openwrt.html">N1 ç›’å­åˆ·å…¥ OpenWrt å¹¶éƒ¨ç½² K3s</a>)ã€‚R6300V2 çš„æ€§èƒ½è¿˜æ˜¯å¤ªå¼±ï¼Œå°¤å…¶æ˜¯å¯¹äº AES-256 æˆ–è€…  GCM-256 è¿™ç§åŠ å¯†ç®—æ³•è¿˜æ˜¯åŠ›ä¸ä»å¿ƒï¼ŒN1 ç›’å­å°é’¢ç‚®å½“æ—è·¯ç½‘å…³å†é€‚åˆä¸è¿‡äº†ã€‚å¦å¤–ä» R6300V2 çš„ USB æ¥å£ç»™ ESP8266 å¼€å‘æ¿ä¾›ç”µï¼Œç”¨æ¥è¿œç¨‹å¼€å…³æœº(<a href="https://blog.k8s.li/esp8266-pc-switch.html">ä½¿ç”¨ ESP8266 NodeMCU æ‰“é€  WiFi å¼€å…³</a>)ã€‚</p><p><img src="img/20200517_022447573_iOS.jpg" alt="img"></p><h2 id="17-å·"><a href="#17-å·" class="headerlink" title="17 å·"></a>17 å·</h2><p>ä»Šå¤©åˆæ˜¯ä¸€ä¸ªå¹³å‡¡çš„æ—¥å¸¸ï¼Œæ— éå°±æ˜¯æ‹¿äº†äº›å¿«é€’ï¼Œåœ¨ç½‘ä¸Šä¹°çš„ç”Ÿæ´»ç”¨å“ä¹Ÿåˆ°é½äº†ï¼Œä¹Ÿæ¸æ¸åœ°ä¹ æƒ¯äº†è¿™é‡Œçš„ç”Ÿæ´»ï¼Œæ…¢æ…¢åœ°èå…¥åˆ°è¿™é‡Œã€‚ä¹°äº†ä¸€ç®±æ‰‹æŠ“é¥¼å’Œä¸€äº›è”¬èœï¼Œå‡†å¤‡æ—©ä¸Šè‡ªå·±åšé¥­åƒï¼Œç´ é£Ÿè€…çš„ç¦éŸ³å‘€ï¼Œä¸€å¼ é¥¼è£¹ä¸Šå‡ ç‰‡èœå¶å­ï¼Œå†åŠ ä¸Šä¸€ä¸ªç…è›‹ï¼ŒæŠ¹ä¸Šç•ªèŒ„é…±å’Œæ²™æ‹‰é…±ï¼Œæœ´ç´ ä¸€é¤ğŸ˜‹</p><p>æ˜å¤©å°±è¦å…¥èŒå¼€å§‹æ¬ç –äº†ï¼Œåƒæ–°ç”Ÿå¼€å­¦ä¸€æ ·ï¼Œå……æ»¡ç€æœŸå¾…åˆæœ‰ä¸€ç‚¹å®³æ€•ï¼Œå¸Œæœ›æ˜å¤©é¡ºåˆ©å§ã€‚æ„Ÿè§‰å°±åƒæ˜¯å¤§ä¸€æ–°ç”Ÿå¼€å­¦ä¸€æ ·ï¼Œç¦»å¼€ç†Ÿæ‚‰å·²ä¹…å®¶æ¥åˆ°è¿™ä¸ªé™Œç”Ÿçš„åŸå¸‚ï¼Œæ‹¿ç€<del>å½•å–é€šçŸ¥ä¹¦</del>ã€Šå½•ç”¨é€šçŸ¥ä¹¦ã€‹å’Œã€Šç¦»èŒè¯æ˜ã€‹åˆ°æ–°å…¬å¸å…¥èŒï¼Œè®¤è¯†æ–°çš„æœ‹å‹ï¼Œå¼€å§‹ä¸€æ®µæ–°çš„æ—…ç¨‹ã€‚</p><p>å›æƒ³èµ·è¿™å‡ å¤©çš„ç»å†ï¼Œæˆ‘ä»æœªæƒ³è¿‡ä¼šæ¥åˆ°è¿™é‡Œï¼Œä¹Ÿä»æœªæƒ³è¿‡ä¼šç¦»å¼€ç”Ÿæ´»å·²ä¹…çš„åŸå¸‚ã€‚è‹¥æ˜¯è¯´è¿™ä¸€åˆ‡çš„èµ·ç‚¹ï¼Œå°±ç¿»äº†ç¿»å»å¹´å†™çš„<a href="https://blog.k8s.li/thinking-2019.html">ã€Šæ¯•ä¸šåçš„ä¸€ç‚¹æ€è€ƒã€‹</a></p><blockquote><p>æˆ‘ä¾ç¨€è®°å¾—é«˜ä¸­æ¯•ä¸šæ—¶æœ€åä¸€å ‚è¯¾ä¸Šï¼Œæˆ‘ä»¬çš„ç­ä¸»ä»»ç»™æˆ‘ä»¬ç­åŒå­¦è®²è¿‡ä¸€å¥è¯<strong>ä½ æ‰€è¯»è¿‡çš„ä¹¦å’Œä½ æ¥è§¦çš„äººï¼Œå†³å®šäº†ä½ ä»¥åèƒ½èµ°ä»€ä¹ˆæ ·çš„è·¯</strong>ï¼Œæˆ‘ä¸€ç›´é“­è®°è‡³ä»Šï¼Œå¹¶æŠŠå®ƒå½“ä½œå¤§å­¦å››å¹´çš„å”¯ä¸€ä¿¡æ¡ï¼Œå¾ˆåº†å¹¸ï¼Œæ­£æ˜¯è¿™åˆ™ä¿¡æ¡ä¼´éšç€æˆ‘å®Œæˆäº†æ€æƒ³çš„æ”¹é€ å’Œé‡å¡‘ã€‚ç°åœ¨æˆ‘æ‰‹æœºä¸Šè¿˜ä¿ç•™ç€å½“æ—¶ç­ä¸»ä»»è®²è¯æ—¶çš„å½•éŸ³ï¼Œæˆ–è®¸è¿™æ˜¯æˆ‘å€¼å¾—ä¿å­˜ä¼—ç”Ÿçš„è´¢å¯Œã€‚</p></blockquote><p>ä¹Ÿæ­£æ˜¯å› ä¸ºè¿™ç¯‡æ–‡ç« çš„å½±å“ï¼Œè®©æˆ‘è®¤è¯†åˆ°äº†ä¸€äº›æ–°çš„å°ä¼™ä¼´ï¼š<a href="https://nova.moe/" target="_blank" rel="noopener">nova</a> å’Œ <a href="https://dmesg.app/" target="_blank" rel="noopener">å°åœŸè±†</a> ã€‚è®¤è¯†åˆ°ä»–ä»¬ä¹‹åæœ‰ç‚¹åŒè¾ˆå‹åŠ›ğŸï¼Œä»–ä¿©éƒ½åœ¨å¾ˆç‰›é€¼çš„å…¬å¸ä¸Šç­ï¼Œè‡ªå·±å´åœ¨ä¸€ä¸ªäºŒçº¿å°åŸå¸‚è¿‡ç€å®‰é€¸çš„ç”Ÿæ´»ï¼Œè¿™ä¹Ÿè¿«ä½¿æˆ‘æƒ³è¦èµ°å‡ºå¿ƒé‡Œèˆ’é€‚åœˆï¼Œå»ä¸Šæµ·æˆ–æ·±åœ³é—¯ä¸€é—¯ï¼Œè€Œä¸”å’Œå°åœŸè±†ä¹Ÿçº¦å®šå¥½äº†ä¸€èµ·å»åŒä¸€ä¸ªåŸå¸‚ã€‚æœ€åè¿˜æ˜¯è¦æ„Ÿè°¢ä¸€ä¸‹å°åœŸè±†ï¼Œåœ¨æˆ‘åˆšå¼€å§‹æŠ•ç®€å†é¢è¯•çš„é‚£å‡ å¤©ç»™äºˆå¾ˆå¤šç²¾ç¥ä¸Šçš„å¸®åŠ©ğŸ˜˜ã€‚é‚£æ®µæ—¶é—´ç¡®å®å„ç§å‹åŠ›ã€æŒ«è´¥æ„Ÿã€è‡ªæˆ‘æ€€ç–‘å¦å®šã€æŠ‘éƒç­‰è´Ÿé¢æƒ…ç»ªç‰¹åˆ«ä¸¥é‡ï¼Œæœ‰æ—¶é¢è¯•ä¸‹æ¥è¿å‘¼å¸éƒ½æ„Ÿå—åˆ°å‹åŠ›èƒ¸é—·ã€‚æ²¡æœ‰è¿™ä¸¤ä½æœ‹å‹çš„å¸®åŠ©ï¼Œæˆ–è®¸åˆšæƒ³è¦ç ´å£³è€Œå‡ºçš„æˆ‘å› ä¸ºå®³æ€•å°±æ”¾å¼ƒäº†ï¼Œç°åœ¨å¯èƒ½è¿˜æ˜¯åŸåœ°ä¸åŠ¨ã€‚æ”¾å¼ƒå®‰å®‰ç¨³ç¨³çš„ç”Ÿæ´»èµ°å‡ºå¿ƒé‡Œèˆ’é€‚åœˆï¼Œç¡®å®é‚£ç§å‹åŠ›æ„Ÿä¸å¤ªå¥½å—ï¼Œä¼¤å¿ƒéš¾è¿‡çš„æ—¶å€™å°±æ‰¾ä¸ªæœ‹å‹æ¥å€¾è¯‰ä¸€ä¸‹ï¼Œä¸è¦ä¸€ä¸ªäººæ†‹ç€(oã‚œâ–½ã‚œ)oâ˜†ã€‚</p><p>Bless, Bless!</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;å’•å’•å’•&quot;&gt;&lt;a href=&quot;#å’•å’•å’•&quot;
        
      
    
    </summary>
    
    
      <category term="ç”Ÿæ´»" scheme="https://blog.k8s.li/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
  </entry>
  
</feed>
