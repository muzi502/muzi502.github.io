<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æœ¨å­</title>
  <icon>https://blog.k8s.li/icon.png</icon>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://blog.k8s.li/"/>
  <updated>2020-06-13T16:00:00.000Z</updated>
  <id>https://blog.k8s.li/</id>
  
  <author>
    <name>æœ¨å­</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æ·±å…¥æµ…å‡ºå®¹å™¨é•œåƒçš„ä¸€ç”ŸğŸ¤”</title>
    <link href="https://blog.k8s.li/Exploring-container-image.html"/>
    <id>https://blog.k8s.li/Exploring-container-image.html</id>
    <published>2020-06-13T16:00:00.000Z</published>
    <updated>2020-06-13T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸Šå‘¨åœ¨å†™<a href="https://blog.k8s.li/skopeo.html">ã€Šé•œåƒæ¬è¿å·¥ skopeo ã€‹</a> çš„æ—¶å€™çœ‹äº†å¾ˆå¤šå…³äºå®¹å™¨é•œåƒç›¸å…³çš„åšå®¢ï¼Œä»å¤§ä½¬ä»¬é‚£é‡Œå·å·å­¦äº†ä¸å°‘çŸ¥è¯†ï¼Œå¯¹å®¹å™¨é•œåƒæœ‰äº†ä¸€ç‚¹ç‚¹æ·±å…¥çš„äº†è§£ã€‚è¿™å‘¨æœ«ä¸€ä¸ªäººé—²ç€å®…åœ¨å®¶é‡Œæ²¡äº‹å°±æŠŠæœ€è¿‘æ‰€å­¦çš„çŸ¥è¯†æ•´ç†ä¸€ä¸‹åˆ†äº«å‡ºæ¥ï¼Œä¾›å¤§å®¶ä¸€èµ·æ¥é£Ÿç”¨ã€‚å†…å®¹æ¯”è¾ƒå¤šï¼Œè€å¿ƒçœ‹å®Œçš„è¯ï¼Œè¿˜æ˜¯èƒ½æ”¶è·ä¸€äº›<del>æ²¡ç”¨çš„</del>çŸ¥è¯†æ»´ğŸ˜‚ã€‚</p><h2 id="æ›´æ–°è®°å½•"><a href="#æ›´æ–°è®°å½•" class="headerlink" title="æ›´æ–°è®°å½•"></a>æ›´æ–°è®°å½•</h2><ul><li>2020-06-13ï¼šè¿˜æœ‰ä¸€äº›æ²¡æœ‰å†™å®Œï¼Œåç»­è¡¥å……</li><li>2020-06-06ï¼š åˆç¨¿</li></ul><h2 id="é•œåƒæ˜¯æ€æ ·ç‚¼æˆçš„ğŸ¤”"><a href="#é•œåƒæ˜¯æ€æ ·ç‚¼æˆçš„ğŸ¤”" class="headerlink" title="é•œåƒæ˜¯æ€æ ·ç‚¼æˆçš„ğŸ¤”"></a>é•œåƒæ˜¯æ€æ ·ç‚¼æˆçš„ğŸ¤”</h2><p>æ‰€è°“ç‚¼æˆåƒå°±æ˜¯æ„å»ºé•œåƒå•¦ï¼Œä¸‹é¢ç”¨åˆ°çš„<strong>æ“</strong>å’Œ<strong>ç‚¼åˆ¶</strong>éƒ½æ˜¯æŒ‡çš„æ„å»ºé•œåƒå•¦ï¼Œåªæ˜¯ä¸ªäººä¹ æƒ¯ç”¨è¯­è€Œå·²ğŸ˜‚ã€‚</p><p>æåˆ°å®¹å™¨é•œåƒå°±ä¸å¾—ä¸æä¸€ä¸‹ OCI ï¼Œå³ Open Container Initiative æ—¨åœ¨å›´ç»•å®¹å™¨æ ¼å¼å’Œè¿è¡Œæ—¶åˆ¶å®šä¸€ä¸ªå¼€æ”¾çš„å·¥ä¸šåŒ–æ ‡å‡†ã€‚ç›®å‰ OCI ä¸»è¦æœ‰ä¸‰ä¸ªè§„èŒƒï¼šè¿è¡Œæ—¶è§„èŒƒ <a href="https://github.com/opencontainers/runtime-spec" target="_blank" rel="noopener">runtime-spec</a> ï¼Œé•œåƒè§„èŒƒ <a href="http://www.github.com/opencontainers/image-spec" target="_blank" rel="noopener">image-spec</a> ä»¥åŠä¸å¸¸è§çš„é•œåƒä»“åº“è§„èŒƒ <a href="https://github.com/opencontainers/distribution-spec" target="_blank" rel="noopener">distribution-spec</a> ã€‚å…³äº OCI è¿™äº›è§„èŒƒçš„ä½œç”¨çš„ä½œç”¨ï¼Œå°±å¼•ç”¨ä¸€ä¸‹ <a href="https://wilhelmguo.cn/blog/post/william/%E5%AE%B9%E5%99%A8%E5%BC%80%E6%94%BE%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83%EF%BC%88CRI-OCI%EF%BC%89-2" target="_blank" rel="noopener">å®¹å™¨å¼€æ”¾æ¥å£è§„èŒƒï¼ˆCRI OCIï¼‰</a> ä¸­çš„å†…å®¹ï¼Œæˆ‘ä¹Ÿå°±æ‡’å¾—è‡ªå·±ç»„ç»‡è¯­è¨€çŒæ°´äº†ğŸ˜‚ï¼ˆå‡‘å­—æ•°</p><blockquote><p>åˆ¶å®šå®¹å™¨æ ¼å¼æ ‡å‡†çš„å®—æ—¨æ¦‚æ‹¬æ¥è¯´å°±æ˜¯ä¸å—ä¸Šå±‚ç»“æ„çš„ç»‘å®šï¼Œå¦‚ç‰¹å®šçš„å®¢æˆ·ç«¯ã€ç¼–æ’æ ˆç­‰ï¼ŒåŒæ—¶ä¹Ÿä¸å—ç‰¹å®šçš„ä¾›åº”å•†æˆ–é¡¹ç›®çš„ç»‘å®šï¼Œå³ä¸é™äºæŸç§ç‰¹å®šæ“ä½œç³»ç»Ÿã€ç¡¬ä»¶ã€CPUæ¶æ„ã€å…¬æœ‰äº‘ç­‰ã€‚</p><p>è¿™ä¸¤ä¸ªåè®®é€šè¿‡ OCI runtime filesytem bundle çš„æ ‡å‡†æ ¼å¼è¿æ¥åœ¨ä¸€èµ·ï¼ŒOCI é•œåƒå¯ä»¥é€šè¿‡å·¥å…·è½¬æ¢æˆ bundleï¼Œç„¶å OCI å®¹å™¨å¼•æ“èƒ½å¤Ÿè¯†åˆ«è¿™ä¸ª bundle æ¥è¿è¡Œå®¹å™¨</p><ul><li>æ“ä½œæ ‡å‡†åŒ–ï¼šå®¹å™¨çš„æ ‡å‡†åŒ–æ“ä½œåŒ…æ‹¬ä½¿ç”¨æ ‡å‡†å®¹å™¨åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢å®¹å™¨ï¼Œä½¿ç”¨æ ‡å‡†æ–‡ä»¶ç³»ç»Ÿå·¥å…·å¤åˆ¶å’Œåˆ›å»ºå®¹å™¨å¿«ç…§ï¼Œä½¿ç”¨æ ‡å‡†åŒ–ç½‘ç»œå·¥å…·è¿›è¡Œä¸‹è½½å’Œä¸Šä¼ ã€‚</li><li>å†…å®¹æ— å…³ï¼šå†…å®¹æ— å…³æŒ‡ä¸ç®¡é’ˆå¯¹çš„å…·ä½“å®¹å™¨å†…å®¹æ˜¯ä»€ä¹ˆï¼Œå®¹å™¨æ ‡å‡†æ“ä½œæ‰§è¡Œåéƒ½èƒ½äº§ç”ŸåŒæ ·çš„æ•ˆæœã€‚å¦‚å®¹å™¨å¯ä»¥ç”¨åŒæ ·çš„æ–¹å¼ä¸Šä¼ ã€å¯åŠ¨ï¼Œä¸ç®¡æ˜¯PHPåº”ç”¨è¿˜æ˜¯MySQLæ•°æ®åº“æœåŠ¡ã€‚</li><li>åŸºç¡€è®¾æ–½æ— å…³ï¼šæ— è®ºæ˜¯ä¸ªäººçš„ç¬”è®°æœ¬ç”µè„‘è¿˜æ˜¯AWS S3ï¼Œäº¦æˆ–æ˜¯OpenStackï¼Œæˆ–è€…å…¶å®ƒåŸºç¡€è®¾æ–½ï¼Œéƒ½åº”è¯¥å¯¹æ”¯æŒå®¹å™¨çš„å„é¡¹æ“ä½œã€‚</li><li>ä¸ºè‡ªåŠ¨åŒ–é‡èº«å®šåˆ¶ï¼šåˆ¶å®šå®¹å™¨ç»Ÿä¸€æ ‡å‡†ï¼Œæ˜¯çš„æ“ä½œå†…å®¹æ— å…³åŒ–ã€å¹³å°æ— å…³åŒ–çš„æ ¹æœ¬ç›®çš„ä¹‹ä¸€ï¼Œå°±æ˜¯ä¸ºäº†å¯ä»¥ä½¿å®¹å™¨æ“ä½œå…¨å¹³å°è‡ªåŠ¨åŒ–ã€‚</li><li>å·¥ä¸šçº§äº¤ä»˜ï¼šåˆ¶å®šå®¹å™¨æ ‡å‡†ä¸€å¤§ç›®æ ‡ï¼Œå°±æ˜¯ä½¿è½¯ä»¶åˆ†å‘å¯ä»¥è¾¾åˆ°å·¥ä¸šçº§äº¤ä»˜æˆä¸ºç°å®</li></ul></blockquote><p>å…¶å® OCI è§„èŒƒå°±æ˜¯ä¸€å † markdown æ–‡ä»¶å•¦ï¼Œå†…å®¹ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œä¸åƒ RFC å’Œ ISO é‚£ä¹ˆé«˜æ·±è«æµ‹ï¼Œæ‰€ä»¥æ±æƒ³å¯¹å®¹å™¨é•œåƒæœ‰ä¸ªæ·±å…¥çš„äº†è§£è¿˜æ˜¯æ¨èå¤§å®¶å»è¯»ä¸€ä¸‹è¿™äº› markdown æ–‡ä»¶ğŸ˜‚ã€‚OCI è§„èŒƒæ˜¯å…è´¹çš„å“¦ï¼Œä¸åƒå¤§å¤šæ•° ISO è§„èŒƒè¿˜è¦äº¤é’±æ‰èƒ½çœ‹ï¼ˆï¸¶^ï¸¶ï¼‰å“¼ã€‚</p><h3 id="OCI-image-spec"><a href="#OCI-image-spec" class="headerlink" title="OCI image-spec"></a>OCI image-spec</h3><p>OCI è§„èŒƒä¸­çš„é•œåƒè§„èŒƒ <a href="http://www.github.com/opencontainers/image-spec" target="_blank" rel="noopener">image-spec</a> å†³å®šäº†æˆ‘ä»¬çš„é•œåƒæŒ‰ç…§ä»€ä¹ˆæ ‡å‡†æ¥æ„å»ºï¼Œä»¥åŠæ„å»ºå®Œé•œåƒä¹‹åå¦‚ä½•å­˜æ”¾ï¼Œæ¥ç€ä¸‹æ–‡æåˆ°çš„ Dockerfile åˆ™å†³å®šäº†é•œåƒçš„ layer å†…å®¹ä»¥åŠé•œåƒçš„ä¸€äº›å…ƒæ•°æ®ä¿¡æ¯ã€‚ä¸€ä¸ªé•œåƒè§„èŒƒ image-spec å’Œä¸€ä¸ª Dockerfile å°±æŒ‡å¯¼ç€æˆ‘ä»¬æ„å»ºä¸€ä¸ªé•œåƒï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±ç®€å•äº†è§£ä¸€ä¸‹è¿™ä¸ªé•œåƒè§„èŒƒï¼Œçœ‹çœ‹é•œåƒæ˜¯é•¿ä»€ä¹ˆæ ·å­çš„ï¼Œå¯¹é•œåƒæœ‰ä¸ªå¤§ä½“çš„ä¸»è§‚è®¤è¯†ã€‚</p><p>æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„æè¿°ï¼ŒOCI é•œåƒè§„èŒƒçš„ä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ª markdown æ–‡ä»¶ç»„æˆï¼š</p><blockquote><ul><li><a href="https://github.com/opencontainers/image-spec/blob/master/manifest.md" target="_blank" rel="noopener">Image Manifest</a> - a document describing the components that make up a container image</li><li><a href="https://github.com/opencontainers/image-spec/blob/master/image-index.md" target="_blank" rel="noopener">Image Index</a> - an annotated index of image manifests</li><li><a href="https://github.com/opencontainers/image-spec/blob/master/image-layout.md" target="_blank" rel="noopener">Image Layout</a> - a filesystem layout representing the contents of an image</li><li><a href="https://github.com/opencontainers/image-spec/blob/master/layer.md" target="_blank" rel="noopener">Filesystem Layer</a> - a changeset that describes a containerâ€™s filesystem</li><li><a href="https://github.com/opencontainers/image-spec/blob/master/config.md" target="_blank" rel="noopener">Image Configuration</a> - a document determining layer ordering and configuration of the image suitable for translation into a <a href="https://github.com/opencontainers/runtime-spec" target="_blank" rel="noopener">runtime bundle</a></li><li><a href="https://github.com/opencontainers/image-spec/blob/master/conversion.md" target="_blank" rel="noopener">Conversion</a> - a document describing how this translation should occur</li><li><a href="https://github.com/opencontainers/image-spec/blob/master/descriptor.md" target="_blank" rel="noopener">Descriptor</a> - a reference that describes the type, metadata and content address of referenced content</li></ul></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ annotations.md         # æ³¨è§£è§„èŒƒ</span><br><span class="line">â”œâ”€â”€ config.md              # image config æ–‡ä»¶è§„èŒƒ</span><br><span class="line">â”œâ”€â”€ considerations.md      # æ³¨æ„äº‹é¡¹</span><br><span class="line">â”œâ”€â”€ conversion.md          # è½¬æ¢ä¸º OCI è¿è¡Œæ—¶</span><br><span class="line">â”œâ”€â”€ descriptor.md          # OCI Content Descriptors å†…å®¹æè¿°</span><br><span class="line">â”œâ”€â”€ image-index.md         # manifest list æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ image-layout.md        # é•œåƒçš„å¸ƒå±€</span><br><span class="line">â”œâ”€â”€ implementations.md     # ä½¿ç”¨ OCI è§„èŒƒçš„é¡¹ç›®</span><br><span class="line">â”œâ”€â”€ layer.md               # é•œåƒå±‚ layer è§„èŒƒ</span><br><span class="line">â”œâ”€â”€ manifest.md            # manifest è§„èŒƒ</span><br><span class="line">â”œâ”€â”€ media-types.md         # æ–‡ä»¶ç±»å‹</span><br><span class="line">â”œâ”€â”€ README.md              # README æ–‡æ¡£</span><br><span class="line">â”œâ”€â”€ spec.md                # OCI é•œåƒè§„èŒƒçš„æ¦‚è§ˆ</span><br></pre></td></tr></table></figure><p>æ€»ç»“ä»¥ä¸Šå‡ ä¸ª markdown æ–‡ä»¶ï¼Œ OCI å®¹å™¨é•œåƒè§„èŒƒä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ å—å†…å®¹ï¼š</p><h4 id="layer"><a href="#layer" class="headerlink" title="layer"></a>layer</h4><p><a href="https://github.com/opencontainers/image-spec/blob/master/layer.md" target="_blank" rel="noopener">æ–‡ä»¶ç³»ç»Ÿ</a>ï¼šä»¥ layer ï¼ˆé•œåƒå±‚ï¼‰ä¿å­˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯ä¸ª layer ä¿å­˜äº†å’Œä¸Šå±‚ä¹‹é—´å˜åŒ–çš„éƒ¨åˆ†ï¼Œlayer åº”è¯¥ä¿å­˜å“ªäº›æ–‡ä»¶ï¼Œæ€ä¹ˆè¡¨ç¤ºå¢åŠ ã€ä¿®æ”¹å’Œåˆ é™¤çš„æ–‡ä»¶ç­‰ã€‚</p><h4 id="image-config"><a href="#image-config" class="headerlink" title="image config"></a>image config</h4><p><a href="https://github.com/opencontainers/image-spec/blob/master/config.md" target="_blank" rel="noopener">image config æ–‡ä»¶</a>ï¼šä¿å­˜äº†æ–‡ä»¶ç³»ç»Ÿçš„å±‚çº§ä¿¡æ¯ï¼ˆæ¯ä¸ªå±‚çº§çš„ hash å€¼ï¼Œä»¥åŠå†å²ä¿¡æ¯ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡Œæ—¶éœ€è¦çš„ä¸€äº›ä¿¡æ¯ï¼ˆæ¯”å¦‚ç¯å¢ƒå˜é‡ã€å·¥ä½œç›®å½•ã€å‘½ä»¤å‚æ•°ã€mount åˆ—è¡¨ï¼‰ï¼ŒæŒ‡å®šäº†é•œåƒåœ¨æŸä¸ªç‰¹å®šå¹³å°å’Œç³»ç»Ÿçš„é…ç½®ï¼Œæ¯”è¾ƒæ¥è¿‘æˆ‘ä»¬ä½¿ç”¨ <code>docker inspect &lt;image_id&gt;</code> çœ‹åˆ°çš„å†…å®¹ã€‚</p><ul><li>example</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">  <span class="attr">"config"</span>: &#123;</span><br><span class="line">    <span class="attr">"Hostname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"User"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"bash"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Image"</span>: <span class="string">"sha256:ba8f577813c7bdf6b737f638dffbc688aa1df2ff28a826a6c46bae722977b549"</span>,</span><br><span class="line">    <span class="attr">"Volumes"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Entrypoint"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OnBuild"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"Labels"</span>: <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"container"</span>: <span class="string">"38501d5aa48c080884f4dc6fd4b1b6590ff1607d9e7a12e1cef1d86a3fdc32df"</span>,</span><br><span class="line">  <span class="attr">"container_config"</span>: &#123;</span><br><span class="line">    <span class="attr">"Hostname"</span>: <span class="string">"38501d5aa48c"</span>,</span><br><span class="line">    <span class="attr">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"User"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"/bin/sh"</span>,</span><br><span class="line">      <span class="string">"-c"</span>,</span><br><span class="line">      <span class="string">"#(nop) "</span>,</span><br><span class="line">      <span class="string">"CMD [\"bash\"]"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Image"</span>: <span class="string">"sha256:ba8f577813c7bdf6b737f638dffbc688aa1df2ff28a826a6c46bae722977b549"</span>,</span><br><span class="line">    <span class="attr">"Volumes"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Entrypoint"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OnBuild"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"Labels"</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"created"</span>: <span class="string">"2020-06-07T01:59:47.348924716Z"</span>,</span><br><span class="line">  <span class="attr">"docker_version"</span>: <span class="string">"19.03.5"</span>,</span><br><span class="line">  <span class="attr">"history"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-06-07T01:59:46.877600299Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop) ADD file:a82014afc29e7b364ac95223b22ebafad46cc9318951a85027a49f9ce1a99461 in / "</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-06-07T01:59:47.348924716Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop)  CMD [\"bash\"]"</span>,</span><br><span class="line">      <span class="attr">"empty_layer"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">  <span class="attr">"rootfs"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"layers"</span>,</span><br><span class="line">    <span class="attr">"diff_ids"</span>: [</span><br><span class="line">      <span class="string">"sha256:d1b85e6186f67d9925c622a7a6e66faa447e767f90f65ae47cdc817c629fa956"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="manifest"><a href="#manifest" class="headerlink" title="manifest"></a>manifest</h4><p><a href="https://github.com/opencontainers/image-spec/blob/master/manifest.md" target="_blank" rel="noopener">manifest æ–‡ä»¶</a> ï¼šé•œåƒçš„ config æ–‡ä»¶ç´¢å¼•ï¼Œæœ‰å“ªäº› layerï¼Œé¢å¤–çš„ annotation ä¿¡æ¯ï¼Œmanifest æ–‡ä»¶ä¸­ä¿å­˜äº†å¾ˆå¤šå’Œå½“å‰å¹³å°æœ‰å…³çš„ä¿¡æ¯ã€‚å¦å¤– manifest ä¸­çš„ layer å’Œ config ä¸­çš„ layer è¡¨è¾¾çš„è™½ç„¶éƒ½æ˜¯é•œåƒçš„ layer ï¼Œä½†äºŒè€…ä»£è¡¨çš„æ„ä¹‰ä¸å¤ªä¸€æ ·ï¼Œç¨åä¼šè®²åˆ°ã€‚manifest æ–‡ä»¶æ˜¯å­˜æ”¾åœ¨ registry ä¸­ï¼Œå½“æˆ‘ä»¬æ‹‰å–é•œåƒçš„æ—¶å€™ï¼Œä¼šæ ¹æ®è¯¥æ–‡ä»¶æ‹‰å–ç›¸åº”çš„ layer ã€‚æ ¹æ® OCI image-spec è§„èŒƒä¸­ <a href="https://github.com/opencontainers/image-spec/blob/master/manifest.md" target="_blank" rel="noopener">OCI Image Manifest Specification</a> çš„å®šä¹‰å¯ä»¥å¾—çŸ¥ï¼Œé•œåƒçš„ manifest æ–‡ä»¶ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªç›®æ ‡ï¼šï¼ˆè‹±è¯­ä¸å¥½å°±ä¸ç¿»è¯‘äº†ğŸ˜¥</p><blockquote><p>There are three main goals of the Image Manifest Specification.</p><ul><li>The first goal is content-addressable images, by supporting an image model where the imageâ€™s configuration can be hashed to generate a unique ID for the image and its components.</li><li>The second goal is to allow multi-architecture images, through a â€œfat manifestâ€ which references image manifests for platform-specific versions of an image. In OCI, this is codified in an <a href="https://github.com/opencontainers/image-spec/blob/master/image-index.md" target="_blank" rel="noopener">image index</a>.</li><li>The third goal is to be <a href="https://github.com/opencontainers/image-spec/blob/master/conversion.md" target="_blank" rel="noopener">translatable</a> to the <a href="https://github.com/opencontainers/runtime-spec" target="_blank" rel="noopener">OCI Runtime Specification</a>.</li></ul></blockquote><p>å¦å¤– manifest ä¹Ÿåˆ†å¥½å‡ ä¸ªç‰ˆæœ¬ï¼Œç›®å‰ä¸»æµçš„ç‰ˆæœ¬æ˜¯  <code>Manifest Version 2, Schema 2</code> ï¼Œå¯ä»¥å‚è€ƒ docker çš„å®˜æ–¹æ–‡æ¡£ <a href="https://github.com/docker/distribution/blob/master/docs/spec/manifest-v2-2.md" target="_blank" rel="noopener">Image Manifest Version 2, Schema 2</a> ã€‚registry ä¸­ä¼šæœ‰ä¸ª <code>Manifest List</code> æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æ˜¯ä¸ºä¸åŒå¤„ç†å™¨ä½“ç³»æ¶æ„è€Œè®¾è®¡çš„ï¼Œé€šè¿‡è¯¥æ–‡ä»¶æŒ‡å‘ä¸è¯¥å¤„ç†å™¨ä½“ç³»æ¶æ„ç›¸å¯¹åº”çš„ Image Manifest ï¼Œè¿™ä¸€ç‚¹ä¸è¦ææ··ã€‚</p><ul><li>Example Manifest List</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.list.v2+json"</span>,</span><br><span class="line">  <span class="attr">"manifests"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">7143</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:e692418e4cbaf90ca69d05a66403747baa33ee08806650b51fab815ad7fc331f"</span>,</span><br><span class="line">      <span class="attr">"platform"</span>: &#123;</span><br><span class="line">        <span class="attr">"architecture"</span>: <span class="string">"ppc64le"</span>,</span><br><span class="line">        <span class="attr">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">7682</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:5b0bcabd1ed22e9fb1310cf6c2dec7cdef19f0ad69efa1f392e94a4333501270"</span>,</span><br><span class="line">      <span class="attr">"platform"</span>: &#123;</span><br><span class="line">        <span class="attr">"architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">        <span class="attr">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">        <span class="attr">"features"</span>: [</span><br><span class="line">          <span class="string">"sse4"</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Image Manifest</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "schemaVersion": 2,</span><br><span class="line">  "mediaType": "application/vnd.docker.distribution.manifest.v2+json",</span><br><span class="line">  "config": &#123;</span><br><span class="line">    "mediaType": "application/vnd.docker.container.image.v1+json",</span><br><span class="line">    "size": 1509,</span><br><span class="line">    "digest": "sha256:a24bb4013296f61e89ba57005a7b3e52274d8edd3ae2077d04395f806b63d83e"</span><br><span class="line">  &#125;,</span><br><span class="line">  "layers": [</span><br><span class="line">    &#123;</span><br><span class="line">      "mediaType": "application/vnd.docker.image.rootfs.diff.tar.gzip",</span><br><span class="line">      "size": 5844992,</span><br><span class="line">      "digest": "sha256:50644c29ef5a27c9a40c393a73ece2479de78325cae7d762ef3cdc19bf42dd0a"</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åå†è¡¥å……ä¸€æ®µé«˜ç­–å¤§ä½¬çš„ <a href="http://gaocegege.com/Blog/ormb" target="_blank" rel="noopener">è§£é‡Š</a> ï¼š</p><blockquote><p>Manifest æ˜¯ä¸€ä¸ª JSON æ–‡ä»¶ï¼Œå…¶å®šä¹‰åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ <a href="https://github.com/opencontainers/image-spec/blob/master/config.md" target="_blank" rel="noopener">Config</a> å’Œ <a href="https://github.com/opencontainers/image-spec/blob/master/layer.md" target="_blank" rel="noopener">Layers</a>ã€‚Config æ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼ŒLayers æ˜¯ä¸€ä¸ªç”± JSON å¯¹è±¡ç»„æˆçš„æ•°ç»„ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒConfig ä¸ Layers ä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡çš„ç»“æ„ç›¸åŒï¼Œéƒ½åŒ…æ‹¬ä¸‰ä¸ªå­—æ®µï¼Œåˆ†åˆ«æ˜¯ digestã€mediaType å’Œ sizeã€‚å…¶ä¸­ digest å¯ä»¥ç†è§£ä¸ºæ˜¯è¿™ä¸€å¯¹è±¡çš„ IDã€‚mediaType è¡¨æ˜äº†è¿™ä¸€å†…å®¹çš„ç±»å‹ã€‚size æ˜¯è¿™ä¸€å†…å®¹çš„å¤§å°ã€‚</p><p>å®¹å™¨é•œåƒçš„ Config æœ‰ç€å›ºå®šçš„ mediaType <code>application/vnd.oci.image.config.v1+json</code>ã€‚ä¸€ä¸ª Config çš„ç¤ºä¾‹é…ç½®å¦‚ä¸‹ï¼Œå®ƒè®°å½•äº†å…³äºå®¹å™¨é•œåƒçš„é…ç½®ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯é•œåƒçš„å…ƒæ•°æ®ã€‚é€šå¸¸å®ƒä¼šè¢«é•œåƒä»“åº“ç”¨æ¥åœ¨ UI ä¸­å±•ç¤ºä¿¡æ¯ï¼Œä»¥åŠåŒºåˆ†ä¸åŒæ“ä½œç³»ç»Ÿçš„æ„å»ºç­‰ã€‚</p><p>è€Œå®¹å™¨é•œåƒçš„ Layers æ˜¯ç”±å¤šå±‚ mediaType ä¸º <code>application/vnd.oci.image.layer.v1.*</code>ï¼ˆå…¶ä¸­æœ€å¸¸è§çš„æ˜¯ <code>application/vnd.oci.image.layer.v1.tar+gzip</code>) çš„å†…å®¹ç»„æˆçš„ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œå®¹å™¨é•œåƒæ˜¯åˆ†å±‚æ„å»ºçš„ï¼Œæ¯ä¸€å±‚å°±å¯¹åº”ç€ Layers ä¸­çš„ä¸€ä¸ªå¯¹è±¡ã€‚</p><p>å®¹å™¨é•œåƒçš„ Configï¼Œå’Œ Layers ä¸­çš„æ¯ä¸€å±‚ï¼Œéƒ½æ˜¯ä»¥ Blob çš„æ–¹å¼å­˜å‚¨åœ¨é•œåƒä»“åº“ä¸­çš„ï¼Œå®ƒä»¬çš„ digest ä½œä¸º Key å­˜åœ¨ã€‚å› æ­¤ï¼Œåœ¨è¯·æ±‚åˆ°é•œåƒçš„ Manifest åï¼ŒDocker ä¼šåˆ©ç”¨ digest å¹¶è¡Œä¸‹è½½æ‰€æœ‰çš„ Blobsï¼Œå…¶ä¸­å°±åŒ…æ‹¬ Config å’Œæ‰€æœ‰çš„ Layersã€‚</p></blockquote><h4 id="image-manifest-index"><a href="#image-manifest-index" class="headerlink" title="image manifest index"></a>image manifest index</h4><p><a href="https://github.com/opencontainers/image-spec/blob/master/image-index.md" target="_blank" rel="noopener">index æ–‡ä»¶</a> ï¼šå…¶å®å°±æ˜¯æˆ‘ä»¬ä¸Šé¢æåˆ°çš„ Manifest List å•¦ã€‚åœ¨ docker çš„ <a href="https://github.com/docker/distribution" target="_blank" rel="noopener">distribution</a> ä¸­ç§°ä¹‹ä¸º <code>Manifest List</code> åœ¨ OCI ä¸­å°±å« <a href="https://github.com/opencontainers/image-spec/blob/master/image-index.md" target="_blank" rel="noopener">OCI Image Index Specification</a> ã€‚å…¶å®ä¸¤è€…æ˜¯æŒ‡çš„åŒä¸€ä¸ªæ–‡ä»¶ï¼Œç”šè‡³ä¸¤è€… GitHub ä¸Šæ–‡æ¡£ç»™çš„ example éƒ½ä¸€ä¸€æ¨¡æ ·ğŸ¤£ï¼Œåº”è¯¥æ˜¯ OCI å¤åˆ¶ç²˜è´´ Docker çš„æ–‡æ¡£ğŸ˜‚ã€‚index æ–‡ä»¶æ˜¯ä¸ªå¯é€‰çš„æ–‡ä»¶ï¼ŒåŒ…å«ç€ä¸€ä¸ªåˆ—è¡¨ä¸ºåŒä¸€ä¸ªé•œåƒä¸åŒçš„å¤„ç†å™¨ arch æŒ‡å‘ä¸åŒå¹³å°çš„ manifest æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶èƒ½ä¿è¯ä¸€ä¸ªé•œåƒå¯ä»¥è·¨å¹³å°ä½¿ç”¨ï¼Œæ¯ä¸ªå¤„ç†å™¨ arch å¹³å°æ‹¥æœ‰ä¸åŒçš„ manifest æ–‡ä»¶ï¼Œä½¿ç”¨ index ä½œä¸ºç´¢å¼•ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ arm æ¶æ„çš„å¤„ç†å™¨æ—¶è¦é¢å¤–æ³¨æ„ï¼Œåœ¨æ‹‰å–é•œåƒçš„æ—¶å€™è¦æ‹‰å– arm æ¶æ„çš„é•œåƒï¼Œä¸€èˆ¬å¤„ç†å™¨çš„æ¶æ„éƒ½æ¥åœ¨é•œåƒçš„ tag åé¢ï¼Œé»˜è®¤ latest tag çš„é•œåƒæ˜¯ x86 çš„ï¼Œåœ¨ arm å¤„ç†å™¨çš„æœºå™¨è¿™äº›é•œåƒä¸Šæ˜¯è·‘ä¸èµ·æ¥çš„ã€‚</p><h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><p>ä¼—æ‰€å‘¨çŸ¥ docker é•œåƒéœ€è¦ä¸€ä¸ª Dockerfile æ¥æ„å»ºè€Œæˆï¼Œå½“æˆ‘ä»¬å¯¹ OCI é•œåƒè§„èŒƒæœ‰äº†ä¸ªå¤§è‡´çš„äº†è§£ä¹‹åï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±æ‹¿ç€ Dockerfile è¿™ä¸ª â€å›¾çº¸â€œ å»ä¸€æ­¥æ­¥æ„å»ºé•œåƒã€‚æœ¬æ–‡ä¸å†ç»†è®² Dockerfile çš„è¯¦ç»†ä¹¦å†™å’ŒæŠ€å·§ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šä¼—æ‰€å‘¨çŸ¥çš„å…³äºå†™å¥½ Dockerfile çš„æŠ€å·§ï¼Œæ¯”å¦‚æˆ‘ä¹‹å‰æ°´è¿‡çš„ä¸€ç¯‡ <a href="https://blog.k8s.li/dockerfile-tips.html">Dockerfile æ“é•œåƒçš„å°æŠ€å·§</a> ã€‚</p><p>ä¸‹é¢å°±æ˜¯ <a href="https://webp.sh" target="_blank" rel="noopener">webp server go</a> Dockerfile çš„ä¾‹å­ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> golang:alpine as builder</span><br><span class="line"><span class="keyword">ARG</span> IMG_PATH=/opt/pics</span><br><span class="line"><span class="keyword">ARG</span> EXHAUST_PATH=/opt/exhaust</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apk update ;\</span></span><br><span class="line"><span class="bash">    apk add alpine-sdk ;\</span></span><br><span class="line"><span class="bash">    git <span class="built_in">clone</span> https://github.com/webp-sh/webp_server_go /build ;\</span></span><br><span class="line"><span class="bash">    <span class="built_in">cd</span> /build ;\</span></span><br><span class="line"><span class="bash">    sed -i <span class="string">"s|.\/pics|<span class="variable">$&#123;IMG_PATH&#125;</span>|g"</span> config.json ;\</span></span><br><span class="line"><span class="bash">    sed -i <span class="string">"s|\"\"|\"<span class="variable">$&#123;EXHAUST_PATH&#125;</span>\"|g"</span> config.json ;\</span></span><br><span class="line"><span class="bash">    sed -i <span class="string">'s/127.0.0.1/0.0.0.0/g'</span> config.json</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /build</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> go build -o webp-server .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> alpine</span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> --from=builder /build/webp-server  /usr/bin/webp-server</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> --from=builder /build/config.json /etc/config.json</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /opt</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /opt/exhaust</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"/usr/bin/webp-server"</span>, <span class="string">"--config"</span>, <span class="string">"/etc/config.json"</span>]</span></span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ RUN æŒ‡ä»¤çš„æ¯è¡Œç»“å°¾æˆ‘ä½¿ç”¨çš„æ˜¯ <code>;\</code> æ¥æ¥ä¸‹ä¸€è¡Œ shell ï¼Œå¦ä¸€ç§å†™æ³•æ˜¯ <code>&amp;&amp;</code> ã€‚äºŒè€…æœ‰æœ¬è´¨çš„åŒºåˆ«ï¼Œæ¯”å¦‚ COMMAND 1;COMMAND 2 ï¼Œå½“ COMMAND 1 è¿è¡Œå¤±è´¥æ—¶ä¼šç»§ç»­è¿è¡Œ COMMAND2 ï¼Œå¹¶ä¸ä¼šé€€å‡ºã€‚è€Œ COMMAND 1&amp;&amp; COMMAND 2ï¼Œæ—¶ COMMAND 1 è¿è¡ŒæˆåŠŸæ—¶æ‰æ¥ç€è¿è¡Œ COMMAND 2 ï¼ŒCOMMAND 1 è¿è¡Œå¤±è´¥ä¼šé€€å‡ºã€‚å¦‚æœæ²¡æœ‰åè¶³çš„æŠŠæ¡ä¿è¯æ¯ä¸€è¡Œ shell éƒ½èƒ½æ¯æ¬¡è¿è¡ŒæˆåŠŸå»ºè®®ç”¨ <code>&amp;&amp;</code> ï¼Œè¿™æ ·å¤±è´¥äº†å°±é€€å‡ºæ„å»ºé•œåƒï¼Œä¸ç„¶æ„å»ºå‡ºæ¥çš„é•œåƒä¼šæœ‰é—®é¢˜ã€‚å¦‚æœæ˜¯è€å¸æœºğŸš— çš„è¯å»ºè®®ç”¨ <code>;</code> ï¼Œé€›äº†ä¸€åœˆ docker hub å®˜æ–¹é•œåƒä¸­ç”¨ <code>;</code> è¾ƒå¤šä¸€äº›ï¼Œå› ä¸º <code>;</code> æ¯” <code>&amp;&amp;</code> è¦ç¾è§‚ä¸€äº›ï¼ˆå¤§é›¾ğŸ˜‚ã€‚</p><ul><li>é£æ ¼ä¸€ï¼šæ¯”å¦‚ <a href="https://github.com/nginxinc/docker-nginx/blob/master/stable/buster/Dockerfile" target="_blank" rel="noopener">nginx</a> å®˜æ–¹é•œåƒæ˜¯ç”¨çš„ <code>&amp;&amp;</code>ï¼Œè²Œä¼¼ä¹Ÿæ··å…¥äº† <code>;</code>ğŸ¤£</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">RUN set -x \</span><br><span class="line"><span class="meta">#</span><span class="bash"> create nginx user/group first, to be consistent throughout docker variants</span></span><br><span class="line">    &amp;&amp; addgroup --system --gid 101 nginx \</span><br><span class="line">    &amp;&amp; adduser --system --disabled-login --ingroup nginx --no-create-home --home /nonexistent --gecos "nginx user" --shell /bin/false --uid 101 nginx \</span><br><span class="line">    &amp;&amp; apt-get update \</span><br><span class="line">    &amp;&amp; apt-get install --no-install-recommends --no-install-suggests -y gnupg1 ca-certificates \</span><br><span class="line">    &amp;&amp; \</span><br><span class="line">    NGINX_GPGKEY=573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62; \</span><br><span class="line">    found=''; \</span><br><span class="line">    for server in \</span><br><span class="line">        ha.pool.sks-keyservers.net \</span><br><span class="line">        hkp://keyserver.ubuntu.com:80 \</span><br><span class="line">        hkp://p80.pool.sks-keyservers.net:80 \</span><br><span class="line">        pgp.mit.edu \</span><br><span class="line">    ; do \</span><br></pre></td></tr></table></figure><ul><li>é£æ ¼äºŒï¼šæ¯”å¦‚ <a href="https://github.com/docker-library/redis/blob/23af5b6adb271bcebbcebc93308884438512a4af/6.0/Dockerfile" target="_blank" rel="noopener">redis</a> å®˜æ–¹é•œåƒå°±æ¸…ä¸€è‰²ä½¿ç”¨çš„ <code>;</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">RUN set -eux; \</span><br><span class="line">savedAptMark="$(apt-mark showmanual)"; \</span><br><span class="line">apt-get update; \</span><br><span class="line">apt-get install -y --no-install-recommends ca-certificates dirmngr gnupg wget; \</span><br><span class="line">rm -rf /var/lib/apt/lists/*; \</span><br><span class="line">dpkgArch="$(dpkg --print-architecture | awk -F- '&#123; print $NF &#125;')"; \</span><br><span class="line">wget -O /usr/local/bin/gosu "https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch"; \</span><br><span class="line">wget -O /usr/local/bin/gosu.asc "https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc"; \</span><br><span class="line">export GNUPGHOME="$(mktemp -d)"; \</span><br><span class="line">gpg --batch --keyserver hkps://keys.openpgp.org --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4; \</span><br><span class="line">gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu; \</span><br><span class="line">gpgconf --kill all; \</span><br><span class="line">rm -rf "$GNUPGHOME" /usr/local/bin/gosu.asc; \</span><br><span class="line">apt-mark auto '.*' &gt; /dev/null; \</span><br><span class="line">[ -z "$savedAptMark" ] || apt-mark manual $savedAptMark &gt; /dev/null; \</span><br><span class="line">apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \</span><br><span class="line">chmod +x /usr/local/bin/gosu; \</span><br><span class="line">gosu --version; \</span><br><span class="line">gosu nobody true</span><br></pre></td></tr></table></figure><p>æ±å–œæ¬¢å“ªç§é£æ ¼å‘¢ï¼Ÿå¿«åœ¨è¯„è®ºåŒºç•™è¨€å§ğŸ˜‹</p><h4 id="é•œåƒå·¥å‚ğŸ› "><a href="#é•œåƒå·¥å‚ğŸ› " class="headerlink" title="é•œåƒå·¥å‚ğŸ› "></a>é•œåƒå·¥å‚ğŸ› </h4><blockquote><p>Docker æ˜¯ä¸€ä¸ªå…¸å‹çš„ C/S æ¶æ„çš„åº”ç”¨ï¼Œåˆ†ä¸º Docker å®¢æˆ·ç«¯ï¼ˆå³å¹³æ—¶æ•²çš„ docker å‘½ä»¤ï¼‰ Docker æœåŠ¡ç«¯ï¼ˆdockerd å®ˆæŠ¤è¿›ç¨‹ï¼‰ã€‚</p><p>Docker å®¢æˆ·ç«¯é€šè¿‡ REST API å’ŒæœåŠ¡ç«¯è¿›è¡Œäº¤äº’ï¼Œdocker å®¢æˆ·ç«¯æ¯å‘é€ä¸€æ¡æŒ‡ä»¤ï¼Œåº•å±‚éƒ½ä¼šè½¬åŒ–æˆ REST API è°ƒç”¨çš„å½¢å¼å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å¤„ç†å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚å¹¶ç»™å‡ºå“åº”ã€‚</p><p>Docker é•œåƒçš„æ„å»ºã€å®¹å™¨åˆ›å»ºã€å®¹å™¨è¿è¡Œç­‰å·¥ä½œéƒ½æ˜¯ Docker æœåŠ¡ç«¯æ¥å®Œæˆçš„ï¼ŒDocker å®¢æˆ·ç«¯åªæ˜¯æ‰¿æ‹…å‘é€æŒ‡ä»¤çš„è§’è‰²ã€‚</p><p>Docker å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯ä»¥åœ¨åŒä¸€ä¸ªå®¿ä¸»æœºï¼Œä¹Ÿå¯ä»¥åœ¨ä¸åŒçš„å®¿ä¸»æœºï¼Œå¦‚æœåœ¨åŒä¸€ä¸ªå®¿ä¸»æœºçš„è¯ï¼ŒDocker å®¢æˆ·ç«¯é»˜è®¤é€šè¿‡ UNIX å¥—æ¥å­—(<code>/var/run/docker.sock</code>)å’ŒæœåŠ¡ç«¯é€šä¿¡ã€‚</p></blockquote><p>ç±»æ¯”äºé’¢é“æ˜¯æ€æ ·ç‚¼æˆçš„ï¼Œå¦‚æœè¯´ç‚¼åˆ¶é•œåƒä¹Ÿéœ€è¦ä¸ªå·¥å‚çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ dockerd è¿™ä¸ªå®ˆæŠ¤è¿›ç¨‹å°±æ˜¯ä¸ªç”Ÿäº§é•œåƒçš„å·¥å‚ã€‚èƒ½ç”Ÿäº§é•œåƒçš„ä¸æ­¢ docker ä¸€å®¶ï¼Œçº¢å¸½å­å®¶çš„ <a href="https://buildah.io/" target="_blank" rel="noopener">buildah</a> ä¹Ÿèƒ½ç”Ÿäº§é•œåƒï¼Œä¸è¿‡ç”¨çš„äººå¹¶ä¸å¤šã€‚äºŒè€…çš„æœ€å¤§åŒºåˆ«åœ¨äº buildah å¯ä»¥ä¸ç”¨ root æƒé™æ¥æ„å»ºé•œåƒï¼Œè€Œä½¿ç”¨ docker æ„å»ºé•œåƒæ—¶éœ€è¦ç”¨åˆ° root æƒé™ï¼Œæ²¡æœ‰ root æƒé™çš„ç”¨æˆ·æ„å»ºé•œåƒä¼šå½“åœºç¿»è½¦ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock:</span><br></pre></td></tr></table></figure><p>ä¸è¿‡ buildah æ„å»ºå‡ºæ¥çš„é•œåƒæœ‰ä¸€å †å †çš„å…¼å®¹æ€§é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ docker æ¥æ„å»ºé•œåƒå§ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ docker build å‘½ä»¤æ„å»ºä¸€ä¸ªé•œåƒçš„æ—¶å€™ç¬¬ä¸€è¡Œæ—¥å¿—å°±æ˜¯ <code>Sending build context to Docker daemon xx MB</code>ã€‚è¿™ä¸€æ­¥æ˜¯ docker cli è¿™ä¸ªå‘½ä»¤è¡Œå®¢æˆ·ç«¯å°†æˆ‘ä»¬å½“å‰ç›®å½•ï¼ˆå³æ„å»ºä¸Šä¸‹æ–‡ï¼‰ <code>build context</code> æ‰“åŒ…å‘é€ <code>Docker daemon</code> å®ˆæŠ¤è¿›ç¨‹ ï¼ˆå³ dockerdï¼‰çš„è¿‡ç¨‹ã€‚</p><p><img src="img/docker-architecture.png" alt="img"></p><p>docker build æ„å»ºé•œåƒçš„æµç¨‹å¤§æ¦‚å°±æ˜¯ï¼š</p><ul><li>æ‰§è¡Œ <code>docker build -t &lt;imageName:Tag&gt; .</code>ï¼Œå¯ä»¥ä½¿ç”¨ <code>-f</code>å‚æ•°æ¥æŒ‡å®š Dockerfile æ–‡ä»¶ï¼›</li><li>docker å®¢æˆ·ç«¯ä¼šå°†æ„å»ºå‘½ä»¤åé¢æŒ‡å®šçš„è·¯å¾„(<code>.</code>)ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ª tar åŒ…ï¼Œå‘é€ç»™ Docker æœåŠ¡ç«¯;</li><li>docker æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„ tar åŒ…ï¼Œç„¶åè§£å‹ï¼Œæ¥ä¸‹æ¥æ ¹æ® Dockerfile é‡Œé¢çš„æŒ‡ä»¤è¿›è¡Œé•œåƒçš„åˆ†å±‚æ„å»ºï¼›</li><li>docker ä¸‹è½½ FROM è¯­å¥ä¸­æŒ‡å®šçš„åŸºç¡€é•œåƒï¼Œç„¶åå°†åŸºç¡€é•œåƒçš„ layer è”åˆæŒ‚è½½ä¸ºä¸€å±‚ï¼Œå¹¶åœ¨ä¸Šé¢åˆ›å»ºä¸€ä¸ªç©ºç›®å½•ï¼›</li><li>æ¥ç€å¯åŠ¨ä¸€ä¸ªä¸´æ—¶çš„å®¹å™¨å¹¶åœ¨ chroot ä¸­å¯åŠ¨ä¸€ä¸ª bashï¼Œè¿è¡Œ <code>RUN</code> è¯­å¥ä¸­çš„å‘½ä»¤ï¼š<code>RUN: chroot . /bin/bash -c &quot;apt get updateâ€¦â€¦&quot;</code>ï¼›</li><li>ä¸€æ¡ <code>RUN</code> å‘½ä»¤ç»“æŸåï¼Œä¼šæŠŠä¸Šå±‚ç›®å½•å‹ç¼©ï¼Œå½¢æˆæ–°é•œåƒä¸­çš„æ–°çš„ä¸€å±‚ï¼›</li><li>å¦‚æœ Dockerfile ä¸­åŒ…å«å…¶å®ƒå‘½ä»¤ï¼Œå°±ä»¥ä¹‹å‰æ„å»ºçš„å±‚æ¬¡ä¸ºåŸºç¡€ï¼Œä»ç¬¬äºŒæ­¥å¼€å§‹é‡å¤åˆ›å»ºæ–°å±‚ï¼Œç›´åˆ°å®Œæˆæ‰€æœ‰è¯­å¥åé€€å‡ºï¼›</li><li>æ„å»ºå®Œæˆä¹‹åä¸ºè¯¥é•œåƒæ‰“ä¸Š tagï¼›</li></ul><p>ä»¥ä¸Šå°±æ˜¯æ„å»ºé•œåƒçš„å¤§è‡´æµç¨‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ <code>docker history &lt;imageName:Tag&gt;</code> å‘½ä»¤æ¥é€†å‘æ¨ç®—å‡º docker build çš„è¿‡ç¨‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker history webpsh/webps</span><br><span class="line">IMAGE               CREATED             CREATED BY          SIZE                COMMENT</span><br><span class="line">30d9679b0b1c        2 weeks ago         /bin/sh -c #(nop)  CMD ["/usr/bin/webp-serveâ€¦   0B</span><br><span class="line">&lt;missing&gt;           2 weeks ago         /bin/sh -c #(nop)  VOLUME [/opt/exhaust]        0B</span><br><span class="line">&lt;missing&gt;           2 weeks ago         /bin/sh -c #(nop) WORKDIR /opt                  0B</span><br><span class="line">&lt;missing&gt;           2 weeks ago         /bin/sh -c #(nop) COPY file:1497d882aeef5f77â€¦   168B</span><br><span class="line">&lt;missing&gt;           2 weeks ago         /bin/sh -c #(nop) COPY file:327020918e4dc998â€¦   14.9MB</span><br><span class="line">&lt;missing&gt;           6 weeks ago         /bin/sh -c #(nop)  CMD ["/bin/sh"]              0B</span><br><span class="line">&lt;missing&gt;           6 weeks ago         /bin/sh -c #(nop) ADD file:b91adb67b670d3a6fâ€¦   5.61MB</span><br><span class="line"></span><br><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker history debian:v2</span><br><span class="line">IMAGE               CREATED             CREATED BY           SIZE                COMMENT</span><br><span class="line">e6e782a57a51        38 hours ago        /bin/sh -c #(nop)  CMD ["bash"]                 0B</span><br><span class="line">ba8f577813c7        38 hours ago        /bin/sh -c #(nop) ADD file:a82014afc29e7b364â€¦   69.2MB</span><br></pre></td></tr></table></figure><h4 id="base-image"><a href="#base-image" class="headerlink" title="base image"></a>base image</h4><p>å½“æˆ‘ä»¬åœ¨å†™ Dockerfile çš„æ—¶å€™éƒ½éœ€è¦ç”¨ <code>FROM</code> è¯­å¥æ¥æŒ‡å®šä¸€ä¸ªåŸºç¡€é•œåƒï¼Œè¿™äº›åŸºç¡€é•œåƒå¹¶ä¸æ˜¯æ— ä¸­ç”Ÿæœ‰ï¼Œä¹Ÿéœ€è¦ä¸€ä¸ª Dockerfile æ¥æ„å»ºæˆé•œåƒã€‚ä¸‹é¢æˆ‘ä»¬æ‹¿æ¥ <a href="https://hub.docker.com/_/debian" target="_blank" rel="noopener">debian:buster</a> è¿™ä¸ªåŸºç¡€é•œåƒçš„ <a href="https://github.com/debuerreotype/docker-debian-artifacts/blob/18cb4d0418be1c80fb19141b69ac2e0600b2d601/buster/Dockerfile" target="_blank" rel="noopener">Dockerfile</a> æ¥çœ‹ä¸€ä¸‹åŸºç¡€é•œåƒæ˜¯å¦‚ä½•ç‚¼æˆçš„ã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> scratch</span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> rootfs.tar.xz /</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"bash"</span>]</span></span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªåŸºç¡€é•œåƒçš„ Dockerfile ä¸€èˆ¬ä»…æœ‰ä¸‰è¡Œã€‚ç¬¬ä¸€è¡Œ <code>FROM scratch</code> ä¸­çš„<code>scratch</code> è¿™ä¸ªé•œåƒå¹¶ä¸çœŸå®çš„å­˜åœ¨ã€‚å½“ä½ ä½¿ç”¨ <code>docker pull scratch</code> å‘½ä»¤æ¥æ‹‰å–è¿™ä¸ªé•œåƒçš„æ—¶å€™ä¼šç¿»è½¦å“¦ï¼Œæç¤º <code>Error response from daemon: &#39;scratch&#39; is a reserved name</code>ã€‚è¿™æ˜¯å› ä¸ºè‡ªä» docker 1.5 ç‰ˆæœ¬å¼€å§‹ï¼Œåœ¨ Dockerfile ä¸­ <code>FROM scratch</code> æŒ‡ä»¤å¹¶ä¸è¿›è¡Œä»»ä½•æ“ä½œï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šåˆ›å»ºä¸€ä¸ªé•œåƒå±‚ï¼›æ¥ç€ç¬¬äºŒè¡Œçš„ <code>ADD rootfs.tar.xz /</code> ä¼šè‡ªåŠ¨æŠŠ <code>rootfs.tar.xz</code>  è§£å‹åˆ° <code>/</code> ç›®å½•ä¸‹ï¼Œç”±æ­¤äº§ç”Ÿçš„ä¸€å±‚é•œåƒå°±æ˜¯æœ€ç»ˆæ„å»ºçš„é•œåƒçœŸå®çš„ layer å†…å®¹ï¼›ç¬¬ä¸‰è¡Œ <code>CMD [&quot;bash&quot;]</code> æŒ‡å®šè¿™é•œåƒåœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™æ‰§è¡Œçš„åº”ç”¨ç¨‹åºï¼Œä¸€èˆ¬åŸºç¡€é•œåƒçš„ CMD é»˜è®¤ä¸º bash æˆ–è€… sh ã€‚</p><blockquote><p>As of Docker 1.5.0 (specifically, <a href="https://github.com/docker/docker/pull/8827" target="_blank" rel="noopener"><code>docker/docker#8827</code></a>), <code>FROM scratch</code> is a no-op in the Dockerfile , and will not create an extra layer in your image (so a previously 2-layer image will be a 1-layer image instead).</p></blockquote><p><code>ADD rootfs.tar.xz /</code> ä¸­ï¼Œè¿™ä¸ª <code>rootfs.tar.xz</code> å°±æ˜¯æˆ‘ä»¬ç»è¿‡ä¸€ç³»åˆ—éªšæ“ä½œï¼ˆä¸€èˆ¬æ˜¯å‘è¡Œç‰ˆæºç ç¼–è¯‘ï¼‰æ“å‡ºæ¥çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™ä¸ªæ“ä½œæ¯”è¾ƒå¤æ‚ï¼Œæœ¨å­å¤ªèœäº†ğŸ¥¬å°±ä¸åœ¨è¿™é‡Œçæ°æ°äº†ğŸ™ƒï¼Œå¦‚æœæ±å¯¹æºç æ„å»º <code>rootfs.tar.xz</code> è¿™ä¸ªè¿‡ç¨‹æ„Ÿå…´è¶£å¯ä»¥å»çœ‹ä¸€ä¸‹æ„å»º debian åŸºç¡€é•œåƒçš„ Jenkins æµæ°´çº¿ä»»åŠ¡ <a href="https://doi-janky.infosiftr.net/job/tianon/job/debuerreotype/" target="_blank" rel="noopener">debuerreotype</a>ï¼Œä¸Šé¢æœ‰æ„å»ºè¿™ä¸ª <code>rootfs.tar.xz</code> å®Œæ•´è¿‡ç¨‹ï¼Œæˆ–è€…å‚è€ƒ Debian å®˜æ–¹çš„ <a href="https://github.com/debuerreotype/docker-debian-artifacts" target="_blank" rel="noopener">docker-debian-artifacts</a> è¿™ä¸ª repo é‡Œçš„ shell è„šæœ¬ã€‚</p><p>éœ€è¦é¢å¤–æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨è¿™é‡Œå¾€é•œåƒé‡Œæ·»åŠ  <code>rootfs.tar.xz</code> æ—¶ä½¿ç”¨çš„æ˜¯ <code>ADD</code> è€Œä¸æ˜¯ <code>COPY</code> ï¼Œå› ä¸ºåœ¨ Dockerfile ä¸­çš„ ADD æŒ‡ä»¤ src æ–‡ä»¶å¦‚æœæ˜¯ä¸ª tar åŒ…ï¼Œåœ¨æ„å»ºçš„æ—¶å€™ docker ä¼šå¸®æˆ‘ä»¬æŠŠ tar åŒ…è§£å¼€åˆ°æŒ‡å®šç›®å½•ï¼Œä½¿ç”¨ copy æŒ‡ä»¤åˆ™ä¸ä¼šè§£å¼€ tar åŒ…ã€‚å¦å¤–ä¸€ç‚¹åŒºåˆ«å°±æ˜¯ ADD æŒ‡ä»¤æ˜¯æ·»åŠ ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥æ˜¯æ„å»ºä¸Šä¸‹æ–‡ç¯å¢ƒä¸­çš„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸ª URLï¼Œè€Œ COPY åˆ™åªèƒ½æ·»åŠ æ„å»ºä¸Šä¸‹æ–‡ä¸­çš„æ–‡ä»¶ï¼Œæ‰€è°“çš„æ„å»ºä¸Šä¸‹æ–‡å°±æ˜¯æˆ‘ä»¬æ„å»ºé•œåƒçš„æ—¶å€™æœ€åä¸€ä¸ªå‚æ•°å•¦ã€‚</p><blockquote><p>PSï¼šé¢è¯•çš„æ—¶å€™ç»å¸¸è¢«é—® ADD ä¸ COPY çš„åŒºåˆ«ï¼›CMD ä¸ ENTRYPOINT çš„åŒºåˆ«ğŸ˜‚ã€‚</p></blockquote><p>æ“è¿™ä¸ª <code>rootfs.tar.xz</code> ä¸åŒçš„å‘è¡Œç‰ˆæ–¹æ³•å¯èƒ½ä¸å¤ªä¸€æ ·ï¼ŒDebian å‘è¡Œç‰ˆçš„ <code>rootfs.tar.xz</code> å¯ä»¥åœ¨ <a href="https://github.com/debuerreotype/docker-debian-artifacts" target="_blank" rel="noopener">docker-debian-artifacts</a> è¿™ä¸ª repo ä¸Šæ‰¾åˆ°ï¼Œæ ¹æ®ä¸åŒå¤„ç†å™¨ arch é€‰æ‹©ç›¸åº”çš„ branch ï¼Œç„¶åè¿™ä¸ª branch ä¸‹çš„ç›®å½•å°±å¯¹åº”ç€è¯¥å‘è¡Œç‰ˆçš„ä¸åŒçš„ç‰ˆæœ¬çš„ä»£å·ã€‚æ„å¤–å‘ç° Debian å®˜æ–¹æ˜¯å°†æ‰€æœ‰ arch å’Œæ‰€æœ‰ç‰ˆæœ¬çš„ <code>rootfs.tar.xz</code> éƒ½æ”¾åœ¨è¿™ä¸ª repo é‡Œçš„ï¼Œä»¥è‡³äºè¿™ä¸ª repo çš„å¤§å°æ¥è¿‘ 2.88 GiB ğŸ˜¨ï¼Œå½“ç½‘ç›˜æ¥ç”¨çš„å˜›ğŸ¤£ï¼ˆï¼šæ‰‹åŠ¨æ»‘ç¨½</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~</span><br><span class="line">â•°â”€# git clone https://github.com/debuerreotype/docker-debian-artifacts</span><br><span class="line">Cloning into 'docker-debian-artifacts'...</span><br><span class="line">remote: Enumerating objects: 278, done.</span><br><span class="line">remote: Counting objects: 100% (278/278), done.</span><br><span class="line">Receiving objects:  67% (443/660), 1.60 GiB | 16.96 MiB/s</span><br><span class="line">remote: Total 660 (delta 130), reused 244 (delta 97), pack-reused 382</span><br><span class="line">Receiving objects: 100% (660/660), 2.88 GiB | 16.63 MiB/s, done.</span><br><span class="line">Resolving deltas: 100% (267/267), done.</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠè¿™ä¸ª <code>rootfs.tar.xz</code> è§£å¼€å°±å¯ä»¥çœ‹åˆ°ï¼Œè¿™å°±æ˜¯ä¸€ä¸ª Linux çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œä¸åŒäºæˆ‘ä»¬ä½¿ç”¨ ISO å®‰è£…ç³»ç»Ÿçš„é‚£ä¸ªæ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™ä¸ªæ ¹æ–‡ä»¶ç³»ç»Ÿæ˜¯ç»è¿‡ä¸€ç³»åˆ—çš„è£å‰ªï¼Œå»æ‰äº†ä¸€äº›åœ¨å®¹å™¨è¿è¡Œä¸­ä¸å¿…è¦çš„æ–‡ä»¶ï¼Œä½¿ä¹‹æ›´åŠ è½»é‡é€‚ç”¨äºå®¹å™¨è¿è¡Œçš„åœºæ™¯ï¼Œæ•´ä¸ªæ ¹æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°ä¸º 125Mï¼Œå¦‚æœä½¿ç”¨ slim çš„<code>rootfs.tar.xz</code> ä¼šæ›´å°ä¸€äº›ï¼Œä»…ä»… 76Mã€‚å½“ç„¶ç›¸æ¯”äºä»…ä»…å‡  M çš„ <code>alpine</code> ï¼Œè¿™ç®—æ˜¯å¤Ÿå¤§çš„äº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# git checkout dist-amd64</span><br><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# cd buster</span><br><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# mkdir rootfs</span><br><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# tar -xvf rootfs.tar.xz -C !$</span><br><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# ls rootfs/</span><br><span class="line">bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# du -sh rootfs</span><br><span class="line">125M    rootfs</span><br><span class="line">â•­â”€root@sg-02 ~/docker-debian-artifacts/buster â€¹dist-amd64*â€º</span><br><span class="line">â•°â”€# du -sh slim/rootfs</span><br><span class="line">76M     slim/rootfs</span><br></pre></td></tr></table></figure><p>æƒ³è¦è‡ªå·±æ„å»ºä¸€ä¸ª <code>debian:buster</code> åŸºç¡€é•œåƒå…¶å®å¾ˆç®€å•ï¼Œå°±åƒä¸‹é¢è¿™æ ·ä¸€æŠŠæ¢­æ“ä½œä¸‹æ¥å°±è¡ŒğŸ˜‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/debuerreotype/docker-debian-artifacts debian</span><br><span class="line">cd !$</span><br><span class="line">git checkout dist-amd64</span><br><span class="line">cd buster</span><br><span class="line">docker build -t debian:buster .</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å°±æ˜¯æ„å»º Debian åŸºç¡€é•œåƒçš„è¿‡ç¨‹ï¼Œæ­£å¦‚ Dockerfile ä¸­çš„é‚£æ ·ï¼Œæœ€ç»ˆåªäº§ç”Ÿäº†ä¸€å±‚é•œåƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker build -t debian:buster .</span><br><span class="line">Sending build context to Docker daemon  30.12MB</span><br><span class="line">Step 1/3 : FROM scratch</span><br><span class="line"><span class="meta"> ---&gt;</span></span><br><span class="line">Step 2/3 : ADD rootfs.tar.xz /</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 1756d6a585ae</span></span><br><span class="line">Step 3/3 : CMD ["bash"]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> c86a8b6deb3d</span></span><br><span class="line">Removing intermediate container c86a8b6deb3d</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 04948daa3c2e</span></span><br><span class="line">Successfully built 04948daa3c2e</span><br><span class="line">Successfully tagged debian:buster</span><br></pre></td></tr></table></figure><h2 id="é•œåƒæ˜¯æ€æ ·å­˜æ”¾çš„-ï¼ˆä¸€ï¼‰æœ¬åœ°å­˜å‚¨-ğŸ™„"><a href="#é•œåƒæ˜¯æ€æ ·å­˜æ”¾çš„-ï¼ˆä¸€ï¼‰æœ¬åœ°å­˜å‚¨-ğŸ™„" class="headerlink" title="é•œåƒæ˜¯æ€æ ·å­˜æ”¾çš„ ï¼ˆä¸€ï¼‰æœ¬åœ°å­˜å‚¨ ğŸ™„"></a>é•œåƒæ˜¯æ€æ ·å­˜æ”¾çš„ ï¼ˆä¸€ï¼‰æœ¬åœ°å­˜å‚¨ ğŸ™„</h2><p>å½“æˆ‘ä»¬æ„å»ºå®Œä¸€ä¸ªé•œåƒä¹‹åï¼Œé•œåƒå°±å­˜å‚¨åœ¨äº†æˆ‘ä»¬ docker æœ¬åœ°å­˜å‚¨ç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸º <code>/var/lib/docker</code> ï¼Œä¸‹é¢å°±æ¢å¯»ä¸€ä¸‹é•œåƒæ˜¯ä»¥ä»€ä¹ˆæ ·çš„ç›®å½•ç»“æ„å­˜æ”¾çš„ã€‚åœ¨å¼€å§‹ hack ä¹‹å‰æˆ‘ä»¬å…ˆç»Ÿä¸€ä¸€ä¸‹ç¯å¢ƒä¿¡æ¯ï¼Œæˆ‘ä½¿ç”¨çš„æœºå™¨æ˜¯ Ubuntu 1804ï¼Œ<code>docker info</code> ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">â•­â”€root@sg-02</span> <span class="string">/var/lib/docker</span></span><br><span class="line"><span class="string">â•°â”€#</span> <span class="string">docker</span> <span class="string">info</span></span><br><span class="line"><span class="attr">Client:</span></span><br><span class="line"> <span class="attr">Debug Mode:</span> <span class="literal">false</span></span><br><span class="line"> <span class="attr">Plugins:</span></span><br><span class="line">  <span class="attr">buildx:</span> <span class="string">Build</span> <span class="string">with</span> <span class="string">BuildKit</span> <span class="string">(Docker</span> <span class="string">Inc.,</span> <span class="string">v0.3.1-tp-docker)</span></span><br><span class="line">  <span class="attr">app:</span> <span class="string">Docker</span> <span class="string">Application</span> <span class="string">(Docker</span> <span class="string">Inc.,</span> <span class="string">v0.8.0)</span></span><br><span class="line"><span class="attr">Server:</span></span><br><span class="line"> <span class="attr">Containers:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Running:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Paused:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Stopped:</span> <span class="number">0</span></span><br><span class="line"> <span class="attr">Images:</span> <span class="number">2</span></span><br><span class="line"> <span class="attr">Server Version:</span> <span class="number">19.03</span><span class="number">.5</span></span><br><span class="line"> <span class="attr">Storage Driver:</span> <span class="string">overlay2</span></span><br><span class="line">  <span class="attr">Backing Filesystem:</span> <span class="string">extfs</span></span><br><span class="line">  <span class="attr">Supports d_type:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">Native Overlay Diff:</span> <span class="literal">true</span></span><br><span class="line"> <span class="attr">Logging Driver:</span> <span class="string">json-file</span></span><br><span class="line"> <span class="attr">Cgroup Driver:</span> <span class="string">cgroupfs</span></span><br><span class="line"> <span class="attr">Plugins:</span></span><br><span class="line">  <span class="attr">Volume:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">Network:</span> <span class="string">bridge</span> <span class="string">host</span> <span class="string">ipvlan</span> <span class="string">macvlan</span> <span class="literal">null</span> <span class="string">overlay</span></span><br><span class="line">  <span class="attr">Log:</span> <span class="string">awslogs</span> <span class="string">fluentd</span> <span class="string">gcplogs</span> <span class="string">gelf</span> <span class="string">journald</span> <span class="string">json-file</span> <span class="string">local</span> <span class="string">logentries</span> <span class="string">splunk</span> <span class="string">syslog</span></span><br><span class="line"> <span class="attr">Swarm:</span> <span class="string">inactive</span></span><br><span class="line"> <span class="attr">Runtimes:</span> <span class="string">runc</span></span><br><span class="line"> <span class="attr">Default Runtime:</span> <span class="string">runc</span></span><br><span class="line"> <span class="attr">Init Binary:</span> <span class="string">docker-init</span></span><br><span class="line"> <span class="attr">containerd version:</span> <span class="string">b34a5c8af56e510852c35414db4c1f4fa6172339</span></span><br><span class="line"> <span class="attr">runc version:</span> <span class="string">3e425f80a8c931f88e6d94a8c831b9d5aa481657</span></span><br><span class="line"> <span class="attr">init version:</span> <span class="string">fec3683</span></span><br><span class="line"> <span class="attr">Security Options:</span></span><br><span class="line">  <span class="string">apparmor</span></span><br><span class="line">  <span class="string">seccomp</span></span><br><span class="line">   <span class="attr">Profile:</span> <span class="string">default</span></span><br><span class="line"> <span class="attr">Kernel Version:</span> <span class="number">4.15</span><span class="number">.0</span><span class="number">-1052</span><span class="string">-aws</span></span><br><span class="line"> <span class="attr">Operating System:</span> <span class="string">Ubuntu</span> <span class="number">18.04</span><span class="number">.1</span> <span class="string">LTS</span></span><br><span class="line"> <span class="attr">OSType:</span> <span class="string">linux</span></span><br><span class="line"> <span class="attr">Architecture:</span> <span class="string">x86_64</span></span><br><span class="line"> <span class="attr">CPUs:</span> <span class="number">1</span></span><br><span class="line"> <span class="attr">Total Memory:</span> <span class="number">983.</span><span class="string">9MiB</span></span><br><span class="line"> <span class="attr">Name:</span> <span class="string">sg-02</span></span><br><span class="line"> <span class="attr">ID:</span> <span class="string">B7J5:Y7ZM:Y477:7AS6:WMYI:6NLV:YOMA:W32Y:H4NZ:UQVD:XHDX:Y5EF</span></span><br><span class="line"> <span class="attr">Docker Root Dir:</span> <span class="string">/opt/docker</span></span><br><span class="line"> <span class="attr">Debug Mode:</span> <span class="literal">false</span></span><br><span class="line"> <span class="attr">Username:</span> <span class="string">webpsh</span></span><br><span class="line"> <span class="attr">Registry:</span> <span class="string">https://index.docker.io/v1/</span></span><br><span class="line"> <span class="attr">Labels:</span></span><br><span class="line"> <span class="attr">Experimental:</span> <span class="literal">false</span></span><br><span class="line"> <span class="attr">Insecure Registries:</span></span><br><span class="line">  <span class="number">127.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/8</span></span><br><span class="line"> <span class="attr">Registry Mirrors:</span></span><br><span class="line">  <span class="string">https://registry.k8s.li/</span></span><br><span class="line"> <span class="attr">Live Restore Enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿åˆ†æï¼Œæˆ‘å°†å…¶ä»–çš„ docker image å…¨éƒ¨æ¸…ç©ºæ‰ï¼Œåªä¿ç•™ <code>debian:v1</code> å’Œ <code>debian:v2</code> è¿™ä¸¤ä¸ªé•œåƒï¼Œè¿™ä¸¤ä¸ªé•œåƒè¶³å¤Ÿå¸®åŠ©æˆ‘ä»¬ç†è§£å®¹å™¨é•œåƒæ˜¯å¦‚ä½•å­˜æ”¾çš„ï¼Œé•œåƒå¤šäº†å¤šè¯åˆ†æä¸‹é¢å­˜å‚¨ç›®å½•çš„æ—¶å€™å¯èƒ½ä¸å¤ªæ–¹ä¾¿ï¼ˆï¼ï¹ï¼œï¼‰ï¼Œè¿™ä¸¤ä¸ªé•œåƒæ˜¯æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨ Debian çš„ <code>rootfs.tar.xz</code> æ„å»ºå‡ºæ¥çš„åŸºç¡€é•œåƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/docker</span><br><span class="line">â•°â”€# docker images</span><br><span class="line">REPOSITORY       TAG         IMAGE ID            CREATED             SIZE</span><br><span class="line">debian           v2          e6e782a57a51        22 hours ago        69.2MB</span><br><span class="line">debian           v1          cfba37fd24f8        22 hours ago        69.2MB</span><br></pre></td></tr></table></figure><h3 id="docker-var-lib-docker"><a href="#docker-var-lib-docker" class="headerlink" title="docker (/var/lib/docker)"></a>docker (/var/lib/docker)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/docker</span><br><span class="line">â•°â”€# tree -d -L 1</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ builder</span><br><span class="line">â”œâ”€â”€ buildkit</span><br><span class="line">â”œâ”€â”€ containers</span><br><span class="line">â”œâ”€â”€ image</span><br><span class="line">â”œâ”€â”€ network</span><br><span class="line">â”œâ”€â”€ overlay2</span><br><span class="line">â”œâ”€â”€ plugins</span><br><span class="line">â”œâ”€â”€ runtimes</span><br><span class="line">â”œâ”€â”€ swarm</span><br><span class="line">â”œâ”€â”€ tmp</span><br><span class="line">â”œâ”€â”€ trust</span><br><span class="line">â””â”€â”€ volumes</span><br><span class="line"></span><br><span class="line">12 directories</span><br></pre></td></tr></table></figure><p>æ ¹æ®ç›®å½•çš„åå­—æˆ‘ä»¬å¯ä»¥å¤§è‡´æ¨æ–­å‡ºå…³äºå®¹å™¨é•œåƒçš„å­˜å‚¨ï¼Œæˆ‘ä»¬åªå…³å¿ƒ image å’Œ overlay2 è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹å³å¯ï¼Œå®¹å™¨çš„å…ƒæ•°æ®å­˜æ”¾åœ¨ image ç›®å½•ä¸‹ï¼Œå®¹å™¨çš„ layer æ•°æ®åˆ™å­˜æ”¾åœ¨ overlay2 ç›®å½•ä¸‹ã€‚</p><h3 id="var-lib-docker-image-ç›®å½•ç»“æ„"><a href="#var-lib-docker-image-ç›®å½•ç»“æ„" class="headerlink" title="/var/lib/docker/image ç›®å½•ç»“æ„"></a>/var/lib/docker/image ç›®å½•ç»“æ„</h3><p>overlay2 ä»£è¡¨ç€æœ¬åœ° docker å­˜å‚¨ä½¿ç”¨çš„æ˜¯ overlay2 è¯¥å­˜å‚¨é©±åŠ¨ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬çš„ docker é»˜è®¤ä¼˜å…ˆé‡‡ç”¨ <strong>overlay2</strong> ä½œä¸ºå­˜å‚¨é©±åŠ¨ï¼Œå¯¹äºå·²æ”¯æŒè¯¥é©±åŠ¨çš„ Linux å‘è¡Œç‰ˆï¼Œä¸éœ€è¦ä»»ä½•è¿›è¡Œä»»ä½•é¢å¤–çš„é…ç½®ï¼Œå¯ä½¿ç”¨ lsmod å‘½ä»¤æŸ¥çœ‹å½“å‰ç³»ç»Ÿå†…æ ¸æ˜¯å¦æ”¯æŒ overlay2 ã€‚</p><p>å¦å¤–å€¼å¾—ä¸€æçš„æ˜¯<code>devicemapper</code> å­˜å‚¨é©±åŠ¨å·²ç»åœ¨ docker 18.09 ç‰ˆæœ¬ä¸­è¢«åºŸå¼ƒï¼Œdocker å®˜æ–¹æ¨èä½¿ç”¨ <code>overlay2</code> æ›¿ä»£<code>devicemapper</code>ã€‚ï¼ˆä¹‹å‰æˆ‘è€ä¸œå®¶ç”¨çš„ docker 1.13 ç‰ˆæœ¬ï¼Œ<code>devicemapper</code>çš„å­˜å‚¨é©±åŠ¨åœ¨ç”Ÿäº§ç¯å¢ƒç¿»è¿‡è½¦ğŸ˜‚ã€‚æ‰€ä»¥å‘¢ï¼Œéƒ½ 2020 å¹´äº†ï¼Œå½“ä½ ä½¿ç”¨ baidu è¿™ç§åƒåœ¾æœç´ å¼•æ“å»æœç´¢ â€œCentOS å®‰è£… dockerâ€ æ—¶å®ƒä¼šç»™ä½ ä¸€å †åƒåœ¾çš„æ•™ç¨‹ï¼Œå«ä½ å»å®‰è£… <code>device-mapper-persistent-data lvm2</code>ï¼Œå¯¹äºè¿™ç§æŠ„æ¥æŠ„å»çš„åšå®¢å¹³å°ï¼Œç¦»å¾—è¶Šè¿œè¶Šå¥½ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">image</span><br><span class="line">â””â”€â”€ overlay2</span><br><span class="line">    â”œâ”€â”€ distribution</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ diffid-by-digest</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 039b991354af4dcbc534338f687e27643c717bb57e11b87c2e81d50bdd0b2376</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 09a4142c5c9dde2fbf35e7a6e6475eba75a8c28540c375c80be7eade4b7cb438</span><br><span class="line">    â”‚Â Â  â””â”€â”€ v2metadata-by-diffid</span><br><span class="line">    â”‚Â Â      â””â”€â”€ sha256</span><br><span class="line">    â”‚Â Â          â”œâ”€â”€ 0683de2821778aa9546bf3d3e6944df779daba1582631b7ea3517bb36f9e4007</span><br><span class="line">    â”‚Â Â          â”œâ”€â”€ 0f7493e3a35bab1679e587b41b353b041dca1e7043be230670969703f28a1d83</span><br><span class="line">    â”œâ”€â”€ imagedb</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ content</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â””â”€â”€ sha256</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 708bc6af7e5e539bdb59707bbf1053cc2166622f5e1b17666f0ba5829ca6aaea</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â””â”€â”€ f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span><br><span class="line">    â”‚Â Â  â””â”€â”€ metadata</span><br><span class="line">    â”‚Â Â      â””â”€â”€ sha256</span><br><span class="line">    â”œâ”€â”€ layerdb</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ mounts</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ sha256</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ b9835d6a62886d4e85b65abb120c0ea44ff1b3d116d7a707620785d4664d8c1a</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ cache-id</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ parent</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ size</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ tar-split.json.gz</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â””â”€â”€ d9b567b77bcdb9d8944d3654ea9bb5f6f4f7c4d07a264b2e40b1bb09af171dd3</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ cache-id</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ diff</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ parent</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ size</span><br><span class="line">    â”‚Â Â  â”‚Â Â      â””â”€â”€ tar-split.json.gz</span><br><span class="line">    â”‚Â Â  â””â”€â”€ tmp</span><br><span class="line">    â””â”€â”€ repositories.json</span><br><span class="line">21 directories, 119 files</span><br></pre></td></tr></table></figure><ul><li><code>repositories.json</code></li></ul><p>repositories.json å°±æ˜¯å­˜å‚¨é•œåƒå…ƒæ•°æ®ä¿¡æ¯ï¼Œä¸»è¦æ˜¯ image name å’Œ image id çš„å¯¹åº”ï¼Œdigest å’Œ image id çš„å¯¹åº”ã€‚å½“ pull å®Œä¸€ä¸ªé•œåƒçš„æ—¶å€™ docker ä¼šæ›´æ–°è¿™ä¸ªæ–‡ä»¶ã€‚å½“æˆ‘ä»¬ docker run ä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ä¹Ÿç”¨åˆ°è¿™ä¸ªæ–‡ä»¶å»ç´¢å¼•æœ¬åœ°æ˜¯å¦å­˜åœ¨è¯¥é•œåƒï¼Œæ²¡æœ‰é•œåƒçš„è¯å°±è‡ªåŠ¨å» pull è¿™ä¸ªé•œåƒã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/docker/image/overlay2</span><br><span class="line">â•°â”€# jq "." repositories.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"Repositories"</span>: &#123;</span><br><span class="line">    <span class="attr">"debian"</span>: &#123;</span><br><span class="line">      <span class="attr">"debian:v1"</span>: <span class="string">"sha256:cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d"</span>,</span><br><span class="line">      <span class="attr">"debian:v2"</span>: <span class="string">"sha256:e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"localhost:5000/library/debian"</span>: &#123;</span><br><span class="line">      <span class="attr">"localhost:5000/library/debian:v1"</span>: <span class="string">"sha256:cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d"</span>,</span><br><span class="line">      <span class="attr">"localhost:5000/library/debian:v2"</span>: <span class="string">"sha256:e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df"</span>,</span><br><span class="line">      <span class="attr">"localhost:5000/library/debian@sha256:b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239"</span>: <span class="string">"sha256:cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d"</span>,</span><br><span class="line">      <span class="attr">"localhost:5000/library/debian@sha256:c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11"</span>: <span class="string">"sha256:e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"registry"</span>: &#123;</span><br><span class="line">      <span class="attr">"registry:latest"</span>: <span class="string">"sha256:708bc6af7e5e539bdb59707bbf1053cc2166622f5e1b17666f0ba5829ca6aaea"</span>,</span><br><span class="line">      <span class="attr">"registry@sha256:7d081088e4bfd632a88e3f3bcd9e007ef44a796fddfe3261407a3f9f04abe1e7"</span>: <span class="string">"sha256:708bc6af7e5e539bdb59707bbf1053cc2166622f5e1b17666f0ba5829ca6aaea"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="var-lib-docker-overlay2"><a href="#var-lib-docker-overlay2" class="headerlink" title="/var/lib/docker/overlay2"></a>/var/lib/docker/overlay2</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">overlay2</span><br><span class="line">â”œâ”€â”€ 259cf6934509a674b1158f0a6c90c60c133fd11189f98945c7c3a524784509ff</span><br><span class="line">â”‚Â Â  â””â”€â”€ diff</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ bin</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ dev</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ etc</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ home</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ media</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ mnt</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ opt</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ proc</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ root</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ run</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ sbin</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ srv</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ sys</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ tmp</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ usr</span><br><span class="line">â”‚Â Â      â””â”€â”€ var</span><br><span class="line">â”œâ”€â”€ 27f9e9b74a88a269121b4e77330a665d6cca4719cb9a58bfc96a2b88a07af805</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”œâ”€â”€ a0df3cc902cfbdee180e8bfa399d946f9022529d12dba3bc0b13fb7534120015</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ bin</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”œâ”€â”€ b2fbebb39522cb6f1f5ecbc22b7bec5e9bc6ecc25ac942d9e26f8f94a028baec</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ etc</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ usr</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ var</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”œâ”€â”€ be8c12f63bebacb3d7d78a09990dce2a5837d86643f674a8fd80e187d8877db9</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ etc</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”œâ”€â”€ e8f6e78aa1afeb96039c56f652bb6cd4bbd3daad172324c2172bad9b6c0a968d</span><br><span class="line">â”‚Â Â  â””â”€â”€ diff</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ bin</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ dev</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ etc</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ home</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ media</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ mnt</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ proc</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ root</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ run</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ sbin</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ srv</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ sys</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ tmp</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ usr</span><br><span class="line">â”‚Â Â      â””â”€â”€ var</span><br><span class="line">â””â”€â”€ l</span><br><span class="line">    â”œâ”€â”€ 526XCHXRJMZXRIHN4YWJH2QLPY -&gt; ../b2fbebb39522cb6f1f5ecbc22b7bec5e9bc6ecc25ac942d9e26f8f94a028baec/diff</span><br><span class="line">    â”œâ”€â”€ 5RZOXYR35NSGAWTI36CVUIRW7U -&gt; ../be8c12f63bebacb3d7d78a09990dce2a5837d86643f674a8fd80e187d8877db9/diff</span><br><span class="line">    â”œâ”€â”€ LBWRL4ZXGBWOTN5JDCDZVNOY7H -&gt; ../a0df3cc902cfbdee180e8bfa399d946f9022529d12dba3bc0b13fb7534120015/diff</span><br><span class="line">    â”œâ”€â”€ MYRYBGZRI4I76MJWQHN7VLZXLW -&gt; ../27f9e9b74a88a269121b4e77330a665d6cca4719cb9a58bfc96a2b88a07af805/diff</span><br><span class="line">    â”œâ”€â”€ PCIS4FYUJP4X2D4RWB7ETFL6K2 -&gt; ../259cf6934509a674b1158f0a6c90c60c133fd11189f98945c7c3a524784509ff/diff</span><br><span class="line">    â””â”€â”€ XK5IA4BWQ2CIS667J3SXPXGQK5 -&gt; ../e8f6e78aa1afeb96039c56f652bb6cd4bbd3daad172324c2172bad9b6c0a968d/diff</span><br></pre></td></tr></table></figure><p>åœ¨ <code>/var/lib/docker/overlay2</code> ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé•œåƒ layer çš„å†…å®¹éƒ½å­˜æ”¾åœ¨ä¸€ä¸ª <code>diff</code> çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œdiff çš„ä¸Šçº§ç›®å½•å°±æ˜¯ä»¥é•œåƒ layer çš„ digest ä¸ºåçš„ç›®å½•ã€‚å…¶ä¸­è¿˜æœ‰ä¸ª <code>l</code> æ–‡ä»¶å¤¹ï¼Œä¸‹é¢æœ‰ä¸€å¨å¨çš„ç¡¬é“¾æ¥æ–‡ä»¶æŒ‡å‘ä¸Šçº§ç›®å½•çš„ layer ç›®å½•ã€‚è¿™ä¸ª l å…¶å®å°±æ˜¯ link çš„ç¼©å†™ï¼Œl ä¸‹çš„æ–‡ä»¶éƒ½æ˜¯ä¸€äº›æ¯” digest æ–‡ä»¶å¤¹åçŸ­ä¸€äº›çš„ï¼Œæ–¹é¢ä¸è‡³äº mount çš„å‚æ•°è¿‡é•¿ã€‚</p><h2 id="é•œåƒæ˜¯æ€ä¹ˆæ¬è¿çš„ğŸ¤£"><a href="#é•œåƒæ˜¯æ€ä¹ˆæ¬è¿çš„ğŸ¤£" class="headerlink" title="é•œåƒæ˜¯æ€ä¹ˆæ¬è¿çš„ğŸ¤£"></a>é•œåƒæ˜¯æ€ä¹ˆæ¬è¿çš„ğŸ¤£</h2><p>å½“æˆ‘ä»¬åœ¨æœ¬åœ°æ„å»ºå®Œæˆä¸€ä¸ªé•œåƒä¹‹åï¼Œå¦‚ä½•ä¼ é€’ç»™ä»–äººå‘¢ï¼Ÿè¿™å°±æ¶‰åŠåˆ°é•œåƒæ˜¯æ€ä¹ˆæ¬è¿çš„ä¸€äº›çŸ¥è¯†ï¼Œæ¬è¿é•œåƒå°±åƒæˆ‘ä»¬åœ¨ GitHub ä¸Šæ¬è¿ä»£ç ä¸€æ ·ï¼Œdocker ä¹Ÿæœ‰ç±»ä¼¼äº git clone å’Œ git push çš„æ¬è¿æ–¹å¼ã€‚docker push å°±å’Œæˆ‘ä»¬ä½¿ç”¨ git push ä¸€æ ·ï¼Œå°†æœ¬åœ°çš„é•œåƒæ¨é€åˆ°ä¸€ä¸ªç§°ä¹‹ä¸º registry çš„é•œåƒä»“åº“ï¼Œè¿™ä¸ª registry é•œåƒä»“åº“å°±åƒ GitHub ç”¨æ¥å­˜æ”¾å…¬å…±/ç§æœ‰çš„é•œåƒï¼Œä¸€ä¸ªä¸­å¿ƒåŒ–çš„é•œåƒä»“åº“æ–¹ä¾¿å¤§å®¶æ¥è¿›è¡Œäº¤æµå’Œæ¬è¿é•œåƒã€‚docker pull å°±åƒæˆ‘ä»¬ä½¿ç”¨ git pull ä¸€æ ·ï¼Œå°†è¿œç¨‹çš„é•œåƒæ‹‰æ‹‰å–æœ¬åœ°ã€‚</p><h3 id="docker-pull"><a href="#docker-pull" class="headerlink" title="docker pull"></a>docker pull</h3><p>ç†è§£ docker pull ä¸€ä¸ªé•œåƒçš„æµç¨‹æœ€å¥½çš„åŠæ³•æ˜¯æŸ¥çœ‹ OCI registry è§„èŒƒä¸­çš„è¿™æ®µæ–‡æ¡£ <a href="https://github.com/opencontainers/distribution-spec/blob/master/spec.md#pulling-an-image" target="_blank" rel="noopener">pulling-an-image</a> ï¼Œåœ¨è¿™é‡Œæˆ‘ç»“åˆå¤§ä½¬çš„åšå®¢ç®€å•æ¢³ç†ä¸€ä¸‹ pull ä¸€ä¸ªé•œåƒçš„å¤§è‡´æµç¨‹ã€‚ä¸‹é¢è¿™å¼ å›¾æ˜¯ä» <a href="https://github.com/helios741/myblog/blob/new/learn_go/src/2019/20191206_docker_disk_storage/README.md" target="_blank" rel="noopener">æµ…è°ˆdockerä¸­é•œåƒå’Œå®¹å™¨åœ¨æœ¬åœ°çš„å­˜å‚¨)</a> å€Ÿæ¥çš„ğŸ˜‚</p><p><img src="https://user-images.githubusercontent.com/12036324/70367494-646d2380-18db-11ea-992a-d2bca4cbfeb0.png" alt="image"></p><p>docker pull å°±å’Œæˆ‘ä»¬ä½¿ç”¨ git clone ä¸€æ ·æ•ˆæœï¼Œå°†è¿œç¨‹çš„é•œåƒä»“åº“æ‹‰å–åˆ°æœ¬åœ°æ¥ç»™å®¹å™¨è¿è¡Œæ—¶ä½¿ç”¨ï¼Œç»“åˆä¸Šå›¾å¤§è‡´çš„æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ä¸€æ­¥åº”è¯¥æ˜¯ä½¿ç”¨<code>~/.docker/config.json</code> ä¸­çš„ auth è®¤è¯ä¿¡æ¯åœ¨ registry é‚£é‡Œè¿›è¡Œé‰´æƒæˆæƒï¼Œæ‹¿åˆ°ä¸€ä¸ª tokenï¼Œåé¢çš„æ‰€æœ‰çš„ HTTP è¯·æ±‚ä¸­éƒ½è¦åŒ…å«ç€è¯¥ token æ‰èƒ½æœ‰æƒé™è¿›è¡Œæ“ä½œã€‚</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# cat ~/.docker/config.json</span><br><span class="line">&#123;</span><br><span class="line">        <span class="attr">"auths"</span>: &#123;</span><br><span class="line">                <span class="attr">"https://registry.k8s.li/v2/"</span>: &#123;</span><br><span class="line">                        <span class="attr">"auth"</span>: <span class="string">"d2VicH855828WM7bSVsslJFpmQE43Sw=="</span></span><br><span class="line">                &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"HttpHeaders"</span>: &#123;</span><br><span class="line">                <span class="attr">"User-Agent"</span>: <span class="string">"Docker-Client/19.03.5 (linux)"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"experimental"</span>: <span class="string">"enabled"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>dockerd å®ˆæŠ¤è¿›ç¨‹è§£æ docker å®¢æˆ·ç«¯å‚æ•°ï¼Œç”±é•œåƒå + tag å‘ registry è¯·æ±‚ Manifest æ–‡ä»¶ï¼ŒHTTP è¯·æ±‚ä¸º<code>GET /v2/&lt;name&gt;/manifests/&lt;reference&gt;</code>ã€‚registry ä¸­ä¸€ä¸ªé•œåƒæœ‰å¤šä¸ª tag æˆ–è€…å¤šä¸ªå¤„ç†å™¨ä½“ç³»æ¶æ„çš„é•œåƒï¼Œåˆ™æ ¹æ®è¿™ä¸ª tag æ¥è¿”å›ç»™å®¢æˆ·ç«¯ä¸ä¹‹å¯¹åº”çš„  manifest æ–‡ä»¶ï¼›</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET /v2/&lt;name&gt;/manifests/&lt;reference&gt;</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"annotations"</span>: &#123;</span><br><span class="line">      <span class="attr">"com.example.key1"</span>: <span class="string">"value1"</span>,</span><br><span class="line">      <span class="attr">"com.example.key2"</span>: <span class="string">"value2"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:6f4e69a5ff18d92e7315e3ee31c62165ebf25bfa05cad05c0d09d8f412dae401"</span>,</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.oci.image.config.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">452</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:6f4e69a5ff18d92e7315e3ee31c62165ebf25bfa05cad05c0d09d8f412dae401"</span>,</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.oci.image.layer.v1.tar+gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">78343</span></span><br><span class="line">      &#125;</span><br><span class="line">   ],</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>docker å®ˆæŠ¤è¿›ç¨‹è§£æè¿™ä¸ª Manifest æ–‡ä»¶è·å–é•œåƒçš„ layer çš„ä¿¡æ¯ï¼›</p></li><li><p>dockerd å®ˆæŠ¤è¿›ç¨‹å¹¶è¡Œä¸‹è½½å„ layer ï¼ŒHTTP è¯·æ±‚ä¸º<code>GET /v2/&lt;name&gt;/blobs/&lt;digest&gt;</code>ã€‚ </p></li><li><p>dockerd èµ·ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ <code>docker-untar</code> æ¥ gzip è§£å‹ç¼©å·²ç»ä¸‹è½½å®Œæˆçš„ layer æ–‡ä»¶ï¼›å¯¹äºæœ‰äº›æ¯”è¾ƒå¤§çš„é•œåƒï¼ˆæ¯”å¦‚å‡ å GB çš„é•œåƒï¼‰ï¼Œå¾€å¾€é•œåƒçš„ layer å·²ç»ä¸‹è½½å®Œæˆäº†ï¼Œä½†è¿˜æ²¡æœ‰è§£å‹å®ŒğŸ˜‚ã€‚</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-untar /var/lib/docker/overlay2/a076db6567c7306f3cdab6040cd7d083ef6a39d125171353eedbb8bde7f203b4/diff</span><br></pre></td></tr></table></figure><ul><li><p>éªŒè¯ image config ä¸­çš„ RootFS.DiffIDs æ˜¯å¦ä¸ä¸‹è½½ï¼ˆè§£å‹åï¼‰hash ç›¸åŒï¼›</p></li><li><p>è§£æ Manifest è·å–é•œåƒ Configurationï¼ŒéªŒè¯é•œåƒæ˜¯å¦æ­£ç¡®ã€‚</p></li></ul><h3 id="docker-push"><a href="#docker-push" class="headerlink" title="docker push"></a>docker push</h3><p>push æ¨é€ä¸€ä¸ªé•œåƒåˆ°è¿œç¨‹çš„ registry æµç¨‹æ°å¥½å’Œ pull æ‹‰å–é•œåƒåˆ°æœ¬åœ°çš„æµç¨‹ç›¸åã€‚æˆ‘ä»¬ pull ä¸€ä¸ªé•œåƒçš„æ—¶å€™å¾€å¾€éœ€è¦å…ˆè·å–åŒ…å«ç€é•œåƒ layer ä¿¡æ¯çš„ Manifest æ–‡ä»¶ï¼Œç„¶åæ ¹æ®è¿™ä¸ªæ–‡ä»¶ä¸­çš„ layer ä¿¡æ¯å– pull ç›¸åº”çš„ layerã€‚push ä¸€ä¸ªé•œåƒï¼Œéœ€è¦å…ˆå°†é•œåƒçš„å„ä¸ª layer æ¨é€åˆ° registry ï¼Œå½“æ‰€æœ‰çš„é•œåƒ layer ä¸Šä¼ å®Œæ¯•ä¹‹åæœ€åå† push Image Manifest åˆ° registryã€‚å¤§ä½“çš„æµç¨‹å¦‚ä¸‹ï¼š</p><blockquote><p>  All layer uploads use two steps to manage the upload process. The first step starts the upload in the registry service, returning a url to carry out the second step. The second step uses the upload url to transfer the actual data. Uploads are started with a POST request which returns a url that can be used to push data and check upload status.</p></blockquote><ul><li><p>ç¬¬ä¸€æ­¥å’Œ pull ä¸€ä¸ªé•œåƒä¸€æ ·ä¹Ÿæ˜¯è¿›è¡Œé‰´æƒæˆæƒï¼Œæ‹¿åˆ°ä¸€ä¸ª tokenï¼›</p></li><li><p>å‘ registry å‘é€ <code>POST /v2/&lt;name&gt;/blobs/uploads/</code>è¯·æ±‚ï¼Œregistry è¿”å›ä¸€ä¸ªä¸Šä¼ é•œåƒ layer æ—¶è¦åº”åˆ°çš„ URLï¼›</p></li><li><p>å®¢æˆ·ç«¯é€šè¿‡ <code>HEAD /v2/&lt;name&gt;/blobs/&lt;digest&gt;</code> è¯·æ±‚æ£€æŸ¥ registry ä¸­æ˜¯å¦å·²ç»å­˜åœ¨é•œåƒçš„ layerã€‚</p></li><li><p>å®¢æˆ·ç«¯é€šè¿‡URL ä½¿ç”¨ POST æ–¹æ³•æ¥å®æ—¶ä¸Šä¼  layer æ•°æ®ï¼Œä¸Šä¼ é•œåƒ layer åˆ†ä¸º <code>Monolithic Upload</code> ï¼ˆæ•´ä½“ä¸Šä¼ ï¼‰å’Œ<code>Chunked Upload</code>ï¼ˆåˆ†å—ä¸Šä¼ ï¼‰ä¸¤ç§æ–¹å¼ã€‚</p><ul><li>Monolithic Upload </li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PUT /v2/&lt;name&gt;/blobs/uploads/&lt;session_id&gt;?digest=&lt;digest&gt;</span><br><span class="line"><span class="attribute">Content-Length</span>: &lt;size of layer&gt;</span><br><span class="line"><span class="attribute">Content-Type</span>: application/octet-stream</span><br><span class="line"></span><br><span class="line">&lt;Layer Binary Data&gt;</span><br></pre></td></tr></table></figure><ul><li>Chunked Upload</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PATCH /v2/&lt;name&gt;/blobs/uploads/&lt;session_id&gt;</span><br><span class="line"><span class="attribute">Content-Length</span>: &lt;size of chunk&gt;</span><br><span class="line"><span class="attribute">Content-Range</span>: &lt;start of range&gt;-&lt;end of range&gt;</span><br><span class="line"><span class="attribute">Content-Type</span>: application/octet-stream</span><br><span class="line"></span><br><span class="line">&lt;Layer Chunk Binary Data&gt;</span><br></pre></td></tr></table></figure></li><li><p>é•œåƒçš„ layer ä¸Šä¼ å®Œæˆä¹‹åï¼Œå®¢æˆ·ç«¯éœ€è¦å‘ registry å‘é€ä¸€ä¸ª PUT HTTP è¯·æ±‚å‘ŠçŸ¥è¯¥ layer å·²ç»ä¸Šä¼ å®Œæ¯•ã€‚</p></li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT /v2/&lt;name&gt;/blobs/uploads/&lt;session_id&gt;?digest=&lt;digest&gt;</span><br><span class="line"><span class="attribute">Content-Length</span>: &lt;size of chunk&gt;</span><br><span class="line"><span class="attribute">Content-Range</span>: &lt;start of range&gt;-&lt;end of range&gt;</span><br><span class="line"><span class="attribute">Content-Type</span>: application/octet-stream</span><br><span class="line"></span><br><span class="line">&lt;Last Layer Chunk Binary Data&gt;</span><br></pre></td></tr></table></figure><ul><li>æœ€åå½“æ‰€æœ‰çš„ layer ä¸Šä¼ å®Œä¹‹åï¼Œå®¢æˆ·ç«¯å†è®² manifest æ¨é€ä¸Šå»å°±å®Œäº‹å„¿äº†ã€‚</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">PUT /v2/&lt;name&gt;/manifests/&lt;reference&gt;</span><br><span class="line">Content-Type: &lt;manifest media type&gt;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"annotations"</span>: &#123;</span><br><span class="line">      <span class="attr">"com.example.key1"</span>: <span class="string">"value1"</span>,</span><br><span class="line">      <span class="attr">"com.example.key2"</span>: <span class="string">"value2"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:6f4e69a5ff18d92e7315e3ee31c62165ebf25bfa05cad05c0d09d8f412dae401"</span>,</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.oci.image.config.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">452</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:6f4e69a5ff18d92e7315e3ee31c62165ebf25bfa05cad05c0d09d8f412dae401"</span>,</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.oci.image.layer.v1.tar+gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">78343</span></span><br><span class="line">      &#125;</span><br><span class="line">   ],</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Python-docker-drag"><a href="#Python-docker-drag" class="headerlink" title="Python docker-drag"></a>Python <a href="https://github.com/NotGlop/docker-drag" target="_blank" rel="noopener">docker-drag</a></h3><p>è¿™æ˜¯ä¸€ä¸ªå¾ˆç®€å•ç²—æš´çš„ Python è„šæœ¬ï¼Œä½¿ç”¨ request åº“è¯·æ±‚ registry API æ¥ä»é•œåƒä»“åº“ä¸­æ‹‰å–é•œåƒï¼Œå¹¶ä¿å­˜ä¸ºä¸€ä¸ª tar åŒ…ï¼Œæ‹‰å®Œä¹‹åä½¿ç”¨ docker load åŠ è½½ä¸€ä¸‹å°±èƒ½é£Ÿç”¨å•¦ã€‚è¯¥ python è„šæœ¬ç®€å•åˆ°å»æ‰ç©ºè¡Œå’Œæ³¨é‡Šä¸åˆ° 200 è¡Œï¼Œå¦‚æœæŠŠè¿™ä¸ªè„šæœ¬æºç è¯»ä¸€éçš„è¯å°±èƒ½å¤§æ¦‚çŸ¥é“ docker pull å’Œ skopeo copy çš„ä¸€äº›åŸç†ï¼Œä»–ä»¬éƒ½æ˜¯å»è°ƒç”¨ registry çš„ API ï¼Œæ‰€ä»¥è¿˜æ˜¯æ¨èå»è¯»ä¸€ä¸‹è¿™ä¸ªå®ƒçš„æºç ã€‚</p><p>é£Ÿç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•ç›´æ¥ <code>python3 docker_pull.py [image name]</code>ï¼Œè²Œä¼¼åªèƒ½æ‹‰å– docker.io ä¸Šçš„é•œåƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# wget https://raw.githubusercontent.com/NotGlop/docker-drag/master/docker_pull.py</span><br><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# python3 docker_pull.py nginx</span><br><span class="line">Creating image structure in: tmp_nginx_latest</span><br><span class="line">afb6ec6fdc1c: Pull complete [27098756]</span><br><span class="line">dd3ac8106a0b: Pull complete [26210578]                                       ]</span><br><span class="line">8de28bdda69b: Pull complete [538]</span><br><span class="line">a2c431ac2669: Pull complete [900]</span><br><span class="line">e070d03fd1b5: Pull complete [669]</span><br><span class="line">Docker image pulled: library_nginx.tar</span><br><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# docker load -i library_nginx.tar</span><br><span class="line">ffc9b21953f4: Loading layer [==================================================&gt;]  72.49MB/72.49MB</span><br><span class="line">d9c0b16c8d5b: Loading layer [==================================================&gt;]  63.81MB/63.81MB</span><br><span class="line">8c7fd6263c1f: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">077ae58ac205: Loading layer [==================================================&gt;]  4.096kB/4.096kB</span><br><span class="line">787328500ad5: Loading layer [==================================================&gt;]  3.584kB/3.584kB</span><br><span class="line">Loaded image: nginx:latest</span><br></pre></td></tr></table></figure><h3 id="skopeo"><a href="#skopeo" class="headerlink" title="skopeo"></a>skopeo</h3><p>è¿™ä¸ªå·¥å…·æ˜¯çº¢å¸½å­å®¶çš„ï¼Œæ˜¯ Podmanã€Skopeo å’Œ Buildah ï¼ˆç®€ç§° PSB ï¼‰ä¸‹ä¸€ä»£å®¹å™¨æ–°æ¶æ„ä¸­çš„ä¸€å‘˜ï¼Œä¸è¿‡æœ¨å­è§‰ç€ Podman æƒ³è¦å–ä»£ docker å’Œ containerd å®¹å™¨è¿è¡Œæ—¶è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ï¼Œè™½ç„¶å®ƒç¬¦åˆ OCI è§„èŒƒï¼Œä½†å¯¹äºä¼ä¸šæ¥è®²ï¼Œæ›¿æ¢çš„æˆæœ¬å¹¶ä¸å€¼å¾—ä»–ä»¬å»æ¢åˆ° PSB ä¸Šå»ã€‚</p><p>å…¶ä¸­çš„ skopeo è¿™ä¸ªé•œåƒæ¬è¿å·¥å…·ç®€ç›´æ˜¯ä¸ªç¥å™¨ï¼Œå°¤å…¶æ˜¯åœ¨ CI/CD æµæ°´çº¿ä¸­æ¬è¿ä¸¤ä¸ªé•œåƒä»“åº“é‡Œçš„é•œåƒç®€ç›´çˆ½çš„ä¸å¾—äº†ã€‚æˆ‘å…¥èŒæ–°å…¬å¸ååšçš„ä¸€ä¸ªå·¥ä½œå°±æ˜¯ä¼˜åŒ–æˆ‘ä»¬çš„ Jenkins æµæ°´çº¿ä¸­åŒæ­¥ä¸¤ä¸ªé•œåƒä»“åº“çš„è¿‡ç¨‹ï¼Œä½¿ç”¨ äº†skopeo æ›¿ä»£ docker æ¥åŒæ­¥ä¸¤ä¸ªé•œåƒä»“åº“ä¸­çš„é•œåƒï¼Œå°†åŸæ¥éœ€è¦ 2h å°æ—¶ç¼©çŸ­åˆ°äº† 25min ğŸ˜€ã€‚</p><p>å…³äºè¿™ä¸ªå·¥å…·çš„è¯¦ç»†ä½¿ç”¨æ¨èå¤§å®¶å»è¯»ä¸€ä¸‹æˆ‘ä¹‹å‰å†™çš„ä¸€ç¯‡åšå®¢ <a href="https://blog.k8s.li/skopeo.html">é•œåƒæ¬è¿å·¥ skopeo åˆä½“éªŒ</a> ã€‚åœ¨è¿™é‡Œåªè®²ä¸¤ä¸ªæœ¨å­æœ€å¸¸ç”¨çš„åŠŸèƒ½ã€‚</p><h4 id="skopeo-copy"><a href="#skopeo-copy" class="headerlink" title="skopeo copy"></a>skopeo copy</h4><p>ä½¿ç”¨ skopeo copy ä¸¤ä¸ª registry ä¸­çš„é•œåƒæ—¶ï¼Œskopeo è¯·æ±‚ä¸¤ä¸ª registry API ç›´æ¥ copy <code>original blob</code> åˆ°å¦ä¸€ä¸ª registry ï¼Œè¿™æ ·å…å»äº†åƒ docker pull â€“&gt; docker tag â€“&gt; docker push é‚£æ · pull é•œåƒå¯¹é•œåƒè¿›è¡Œè§£å‹ç¼©ï¼Œpush é•œåƒè¿›è¡Œå‹ç¼©ã€‚å°¤å…¶æ˜¯åœ¨æ¬è¿ä¸€äº›è¾ƒå¤§çš„é•œåƒï¼ˆå‡ GB æˆ–è€…å‡ å GBçš„é•œåƒï¼Œæ¯”å¦‚ <code>nvidia/cuda</code> ï¼‰ï¼Œä½¿ç”¨ skopeo copy çš„åŠ é€Ÿæ•ˆæœååˆ†æ˜æ˜¾ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">DEBU[0000] Detected compression format gzip</span><br><span class="line">DEBU[0000] Using original blob without modification</span><br><span class="line"></span><br><span class="line">Getting image source signatures</span><br><span class="line">Copying blob 09a9f6a07669 done</span><br><span class="line">Copying blob f8cdeb3c6c18 done</span><br><span class="line">Copying blob 22c4d5853f25 done</span><br><span class="line">Copying blob 76abc3f50d9b done</span><br><span class="line">Copying blob 3386b7c9ccd4 done</span><br><span class="line">Copying blob b9207193f1af [==============================&gt;-------] 224.2MiB / 271.2MiB</span><br><span class="line">Copying blob 2f32d819e6ce done</span><br><span class="line">Copying blob 5dbc3047e646 done</span><br><span class="line">Copying blob f8dfcc3265c3 [==================&gt;-------------------] 437.1MiB / 864.3MiB</span><br><span class="line">Copying blob 13d3556105d1 done</span><br><span class="line">Copying blob f9b7fa6a027e [=========================&gt;------------] 84.0MiB / 124.3MiB</span><br><span class="line">Copying blob a1a0f6abe73b [====================&gt;-----------------] 417.9MiB / 749.1MiB</span><br><span class="line">Copying blob bcc9947fc8a4 done</span><br><span class="line">Copying blob 9563b2824fef done</span><br><span class="line">Copying blob a1b8faa0044b [===&gt;----------------------------------] 88.0MiB / 830.1MiB</span><br><span class="line">Copying blob 9917e218edfd [===============&gt;----------------------] 348.6MiB / 803.6MiB</span><br><span class="line">Copying blob 776b9ff2f788 done</span><br><span class="line">Copying config d0c3cfd730 done</span><br><span class="line">Writing manifest to image destination</span><br><span class="line">Storing signatures</span><br></pre></td></tr></table></figure><h4 id="skopeo-inspect"><a href="#skopeo-inspect" class="headerlink" title="skopeo inspect"></a>skopeo inspect</h4><p>ç”¨ skopeo inspect å‘½ä»¤å¯ä»¥å¾ˆæ–¹æ–¹ä¾¿åœ°é€šè¿‡ registry çš„ API æ¥æŸ¥çœ‹é•œåƒçš„ manifest æ–‡ä»¶ï¼Œä»¥å‰æˆ‘éƒ½æ˜¯ç”¨ curl å‘½ä»¤çš„ï¼Œè¦ token è¿˜è¦åŠ ä¸€å †å‚æ•°ï¼Œæ‰€ä»¥æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥åæ¥å°±ç”¨ä¸Šäº†  skopeo inspectğŸ˜€ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@deploy:/root # skopeo inspect docker://index.docker.io/webpsh/webps:latest --raw</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">   <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.container.image.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">2534</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:30d9679b0b1ca7e56096eca0cdb7a6eedc29b63968f25156ef60dec27bc7d206"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">2813316</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">8088920</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:54335262c2ed2d4155e62b45b187a1394fbb6f39e0a4a171ab8ce0c93789e6b0"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">262</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:31555b34852eddc7c01f26fa9c0e5e577e36b4e7ccf1b10bec977eb4593a376b"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é•œåƒæ˜¯æ€ä¹ˆå­˜æ”¾çš„-äºŒ-registry-å­˜å‚¨ğŸ™„"><a href="#é•œåƒæ˜¯æ€ä¹ˆå­˜æ”¾çš„-äºŒ-registry-å­˜å‚¨ğŸ™„" class="headerlink" title="é•œåƒæ˜¯æ€ä¹ˆå­˜æ”¾çš„ (äºŒ) registry å­˜å‚¨ğŸ™„"></a>é•œåƒæ˜¯æ€ä¹ˆå­˜æ”¾çš„ (äºŒ) registry å­˜å‚¨ğŸ™„</h2><p>æ–‡ç« çš„å¼€å¤´æˆ‘ä»¬æåˆ°è¿‡ OCI è§„èŒƒä¸­çš„é•œåƒä»“åº“è§„èŒƒ <a href="https://github.com/opencontainers/distribution-spec" target="_blank" rel="noopener">distribution-spec</a>ï¼Œè¯¥è§„èŒƒå°±å®šä¹‰ç€å®¹å™¨é•œåƒå¦‚ä½•å­˜å‚¨åœ¨è¿œç«¯ï¼ˆå³ registryï¼‰ä¸Šã€‚æˆ‘ä»¬å¯ä»¥æŠŠ registry çœ‹ä½œé•œåƒçš„ä»“åº“ï¼Œä½¿ç”¨è¯¥è§„èŒƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠŠè¿™äº›é•œåƒæŒ‰ç…§çº¦å®šä¿—æˆçš„æ ¼å¼æ¥å­˜æ”¾ï¼Œç›®å‰å®ç°è¯¥è§„èŒƒçš„ registry å°± docker å®¶çš„ registry ä½¿ç”¨çš„å¤šä¸€äº›ã€‚å…¶ä»–çš„ registry æ¯”å¦‚ harbor ï¼Œquay.io ä½¿ç”¨çš„ä¹Ÿæ¯”è¾ƒå¤šã€‚</p><h3 id="registry-registry-docker-v2"><a href="#registry-registry-docker-v2" class="headerlink" title="registry (/registry/docker/v2)"></a>registry (/registry/docker/v2)</h3><p>æƒ³è¦åˆ†æä¸€ä¸‹é•œåƒæ˜¯å¦‚ä½•å­˜æ”¾åœ¨ registry ä¸Šçš„ï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°ä½¿ç”¨ docker run æ¥èµ· registry çš„å®¹å™¨å³å¯ï¼Œæˆ‘ä»¬ä»…ä»…æ˜¯æ¥åˆ†æ registry ä¸­é•œåƒæ—¶å¦‚ä½•å­˜å‚¨çš„ï¼Œè¿™ç§åœºæ™¯ä¸‹ä¸å¤ªé€‚åˆç”¨ harbor è¿™ç§é‡é‡çº§çš„ registry ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# docker run -d --name registry -p 5000:5000 -v /var/lib/registry:/var/lib/registry registry</span><br><span class="line">335ea763a2fa4508ebf3ec6f8b11f3b620a11bdcaa0ab43176b781427e0beee6</span><br></pre></td></tr></table></figure><p>å¯åŠ¨å®Œ registry å®¹å™¨ä¹‹åæˆ‘ä»¬ç»™ä¹‹å‰å·²ç»æ„å»ºå¥½çš„é•œåƒé‡æ–°æ‰“ä¸Šæ”¹ registry çš„ tag æ–¹ä¾¿åç»­ push åˆ° registry ä¸Šã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker tag debian:v1  localhost:5000/library/debian:v1</span><br><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# ^v1^v2</span><br><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker tag debian:v2  localhost:5000/library/debian:v2</span><br><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker images</span><br><span class="line">REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">debian                          v2                  e6e782a57a51        5 minutes ago       69.2MB</span><br><span class="line">localhost:5000/library/debian   v2                  e6e782a57a51        5 minutes ago       69.2MB</span><br><span class="line">debian                          v1                  cfba37fd24f8        9 minutes ago       69.2MB</span><br><span class="line">localhost:5000/library/debian   v1                  cfba37fd24f8        9 minutes ago       69.2MB</span><br><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker push localhost:5000/library/debian:v1</span><br><span class="line">The push refers to repository [localhost:5000/library/debian]</span><br><span class="line">d1b85e6186f6: Pushed</span><br><span class="line">v1: digest: sha256:b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239 size: 529</span><br><span class="line">â•­â”€root@sg-02 ~/buster/slim</span><br><span class="line">â•°â”€# docker push localhost:5000/library/debian:v2</span><br><span class="line">The push refers to repository [localhost:5000/library/debian]</span><br><span class="line">d1b85e6186f6: Layer already exists</span><br><span class="line">v2: digest: sha256:c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11 size: 529</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬åœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ª registry å®¹å™¨ä¹‹åï¼Œå®¹å™¨å†…é»˜è®¤çš„å­˜å‚¨ä½ç½®ä¸º <code>/var/lib/registry</code> ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å¯åŠ¨çš„æ—¶å€™åŠ äº†å‚æ•° <code>-v /var/lib/registry:/var/lib/registry</code> å°†æœ¬æœºçš„è·¯å¾„æŒ‚è½½åˆ°å®¹å™¨å†…ã€‚è¿›å…¥è¿™é‡Œè·¯å¾„æˆ‘ä»¬ä½¿ç”¨ tree å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªç›®å½•çš„å­˜å‚¨ç»“æ„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2</span><br><span class="line">â•°â”€# tree -h</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ [4.0K]  blobs</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  aa</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ [ 26M]  data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  b9</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ [ 529]  data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  c8</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ [ 529]  data</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  cf</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ [1.4K]  data</span><br><span class="line">â”‚Â Â      â””â”€â”€ [4.0K]  e6</span><br><span class="line">â”‚Â Â          â””â”€â”€ [4.0K]  e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df</span><br><span class="line">â”‚Â Â              â””â”€â”€ [1.4K]  data</span><br><span class="line">â””â”€â”€ [4.0K]  repositories</span><br><span class="line">    â””â”€â”€ [4.0K]  library</span><br><span class="line">        â””â”€â”€ [4.0K]  debian</span><br><span class="line">            â”œâ”€â”€ [4.0K]  _layers</span><br><span class="line">            â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">            â”‚Â Â      â”œâ”€â”€ [4.0K]  aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â      â”œâ”€â”€ [4.0K]  cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â      â””â”€â”€ [4.0K]  e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df</span><br><span class="line">            â”‚Â Â          â””â”€â”€ [  71]  link</span><br><span class="line">            â”œâ”€â”€ [4.0K]  _manifests</span><br><span class="line">            â”‚Â Â  â”œâ”€â”€ [4.0K]  revisions</span><br><span class="line">            â”‚Â Â  â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">            â”‚Â Â  â”‚Â Â      â”œâ”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">            â”‚Â Â  â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â  â”‚Â Â      â””â”€â”€ [4.0K]  c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11</span><br><span class="line">            â”‚Â Â  â”‚Â Â          â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â  â””â”€â”€ [4.0K]  tags</span><br><span class="line">            â”‚Â Â      â”œâ”€â”€ [4.0K]  v1</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â”œâ”€â”€ [4.0K]  current</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  index</span><br><span class="line">            â”‚Â Â      â”‚Â Â      â””â”€â”€ [4.0K]  sha256</span><br><span class="line">            â”‚Â Â      â”‚Â Â          â””â”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">            â”‚Â Â      â”‚Â Â              â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â      â””â”€â”€ [4.0K]  v2</span><br><span class="line">            â”‚Â Â          â”œâ”€â”€ [4.0K]  current</span><br><span class="line">            â”‚Â Â          â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">            â”‚Â Â          â””â”€â”€ [4.0K]  index</span><br><span class="line">            â”‚Â Â              â””â”€â”€ [4.0K]  sha256</span><br><span class="line">            â”‚Â Â                  â””â”€â”€ [4.0K]  c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11</span><br><span class="line">            â”‚Â Â                      â””â”€â”€ [  71]  link</span><br><span class="line">            â””â”€â”€ [4.0K]  _uploads</span><br><span class="line"></span><br><span class="line">37 directories, 14 files</span><br></pre></td></tr></table></figure><p>æ ‘å½¢çš„ç»“æ„çœ‹ç€ä¸å¤ªç›´è§‚ï¼Œæœ¨å­å°±ç”»äº†ä¸€å¼ å±‚çº§ç»“æ„çš„å›¾ï¼š</p><p><img src="img/registry-arch.png" alt="img"></p><h3 id="blobs-ç›®å½•"><a href="#blobs-ç›®å½•" class="headerlink" title="blobs ç›®å½•"></a>blobs ç›®å½•</h3><p>ä¹‹å‰æˆ‘ä»¬å‘ registry ç§æ¨é€äº†ä¸¤ä¸ªé•œåƒï¼Œè¿™ä¸¤ä¸ªé•œåƒçš„ layer ç›¸åŒä½†ä¸æ˜¯ç”¨ä¸€ä¸ªé•œåƒï¼Œåœ¨æˆ‘ä»¬ä¹‹å‰ push image çš„æ—¶å€™ä¹Ÿçœ‹åˆ°äº† <code>d1b85e6186f6: Layer already exists</code>ã€‚ä¹Ÿå°±å¯ä»¥è¯æ˜äº†ï¼Œè™½ç„¶ä¸¤ä¸ªé•œåƒä¸åŒï¼Œä½†å®ƒä»¬çš„ layer åœ¨ registry ä¸­å­˜å‚¨çš„æ—¶å€™å¯èƒ½æ˜¯ç›¸åŒçš„ã€‚</p><p>åœ¨ <code>blobs/sha256</code> ç›®å½•ä¸‹ä¸€å…±æœ‰ 5 ä¸ªåä¸º data çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æµ‹ä¸€ä¸‹æœ€å¤§çš„é‚£ä¸ª <code>[ 26M]</code> åº”è¯¥æ˜¯é•œåƒçš„ layer ï¼Œæœ€å°çš„ <code>[ 529]</code> é‚£ä¸ªåº”è¯¥æ˜¯ manifestï¼Œå‰©ä¸‹çš„é‚£ä¸ª <code>[1.4K]</code> åº”è¯¥å°±æ˜¯ image config æ–‡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/blobs/sha256</span><br><span class="line">â•°â”€# tree -h</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ [4.0K]  aa</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb</span><br><span class="line">â”‚Â Â      â””â”€â”€ [ 26M]  data</span><br><span class="line">â”œâ”€â”€ [4.0K]  b9</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â”‚Â Â      â””â”€â”€ [ 529]  data</span><br><span class="line">â”œâ”€â”€ [4.0K]  c8</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11</span><br><span class="line">â”‚Â Â      â””â”€â”€ [ 529]  data</span><br><span class="line">â”œâ”€â”€ [4.0K]  cf</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d</span><br><span class="line">â”‚Â Â      â””â”€â”€ [1.4K]  data</span><br><span class="line">â””â”€â”€ [4.0K]  e6</span><br><span class="line">    â””â”€â”€ [4.0K]  e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df</span><br><span class="line">        â””â”€â”€ [1.4K]  data</span><br></pre></td></tr></table></figure><p>åœ¨ <code>registry</code> çš„å­˜å‚¨ç›®å½•ä¸‹ï¼Œ<code>blobs</code> ç›®å½•ç”¨æ¥å­˜æ”¾é•œåƒçš„ä¸‰ç§æ–‡ä»¶ï¼š layer çš„çœŸå®æ•°æ®ï¼Œé•œåƒçš„ manifest æ–‡ä»¶ï¼Œé•œåƒçš„ image config æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶éƒ½æ˜¯ä»¥ <code>data</code> ä¸ºåçš„æ–‡ä»¶å­˜æ”¾åœ¨äºè¯¥æ–‡ä»¶ <code>sha256</code> ç›¸å¯¹åº”çš„ç›®å½•ä¸‹ã€‚ ä½¿ç”¨ä»¥å†…å®¹å¯»å€çš„ <code>sha256</code> æ•£åˆ—å­˜å‚¨æ–¹ä¾¿ç´¢å¼•æ–‡ä»¶ï¼Œåœ¨ <code>blob digest</code> ç›®å½•ä¸‹æœ‰ä¸€ä¸ªåä¸º <code>data</code>çš„æ–‡ä»¶ï¼Œå¯¹äº layer æ¥è®²ï¼Œè¿™æ˜¯ä¸ª <code>data</code> æ–‡ä»¶çš„æ ¼å¼æ˜¯ <code>vnd.docker.image.rootfs.diff.tar.gzip</code> ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>tar -xvf</code> å‘½ä»¤å°†è¿™ä¸ª layer è§£å¼€ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ docker pull å‘½ä»¤æ‹‰å–é•œåƒçš„æ—¶å€™ï¼Œä¹Ÿæ˜¯å»ä¸‹è½½è¿™ä¸ª <code>data</code>æ–‡ä»¶ï¼Œä¸‹è½½å®Œæˆä¹‹åä¼šæœ‰ä¸€ä¸ª <code>docker-untar</code>çš„è¿›ç¨‹å°†è¿™ä¸ª <code>data</code>æ–‡ä»¶è§£å¼€å­˜æ”¾åœ¨<code>/var/lib/docker/overlay2/${digest}/diff</code> ç›®å½•ä¸‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ [4.0K]  blobs</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  aa</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ [ 26M]  data</span><br></pre></td></tr></table></figure><h4 id="manifest-æ–‡ä»¶"><a href="#manifest-æ–‡ä»¶" class="headerlink" title="manifest æ–‡ä»¶"></a>manifest æ–‡ä»¶</h4><p>å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ json æ–‡ä»¶å•¦ï¼Œè®°å½•äº†ä¸€ä¸ªé•œåƒæ‰€åŒ…å«çš„ layer ä¿¡æ¯ï¼Œå½“æˆ‘ä»¬ pull é•œåƒçš„æ—¶å€™ä¼šä½¿ç”¨åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/blobs/sha256/b9/b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â•°â”€# cat data</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">   <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.container.image.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">1462</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">27097859</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;#</span><br></pre></td></tr></table></figure><h4 id="image-config-æ–‡ä»¶"><a href="#image-config-æ–‡ä»¶" class="headerlink" title="image config æ–‡ä»¶"></a>image config æ–‡ä»¶</h4><p>image config æ–‡ä»¶é‡Œå¹¶æ²¡æœ‰åŒ…å«é•œåƒçš„ tag ä¿¡æ¯ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/blobs/sha256/e6/e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df</span><br><span class="line">â•°â”€# cat data | jq "."</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">  <span class="attr">"config"</span>: &#123;</span><br><span class="line">    <span class="attr">"Hostname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"User"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"bash"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Image"</span>: <span class="string">"sha256:ba8f577813c7bdf6b737f638dffbc688aa1df2ff28a826a6c46bae722977b549"</span>,</span><br><span class="line">    <span class="attr">"Volumes"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Entrypoint"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OnBuild"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"Labels"</span>: <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"container"</span>: <span class="string">"38501d5aa48c080884f4dc6fd4b1b6590ff1607d9e7a12e1cef1d86a3fdc32df"</span>,</span><br><span class="line">  <span class="attr">"container_config"</span>: &#123;</span><br><span class="line">    <span class="attr">"Hostname"</span>: <span class="string">"38501d5aa48c"</span>,</span><br><span class="line">    <span class="attr">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"User"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"/bin/sh"</span>,</span><br><span class="line">      <span class="string">"-c"</span>,</span><br><span class="line">      <span class="string">"#(nop) "</span>,</span><br><span class="line">      <span class="string">"CMD [\"bash\"]"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Image"</span>: <span class="string">"sha256:ba8f577813c7bdf6b737f638dffbc688aa1df2ff28a826a6c46bae722977b549"</span>,</span><br><span class="line">    <span class="attr">"Volumes"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"Entrypoint"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OnBuild"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"Labels"</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"created"</span>: <span class="string">"2020-06-07T01:59:47.348924716Z"</span>,</span><br><span class="line">  <span class="attr">"docker_version"</span>: <span class="string">"19.03.5"</span>,</span><br><span class="line">  <span class="attr">"history"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-06-07T01:59:46.877600299Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop) ADD file:a82014afc29e7b364ac95223b22ebafad46cc9318951a85027a49f9ce1a99461 in / "</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-06-07T01:59:47.348924716Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop)  CMD [\"bash\"]"</span>,</span><br><span class="line">      <span class="attr">"empty_layer"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">  <span class="attr">"rootfs"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"layers"</span>,</span><br><span class="line">    <span class="attr">"diff_ids"</span>: [</span><br><span class="line">      <span class="string">"sha256:d1b85e6186f67d9925c622a7a6e66faa447e767f90f65ae47cdc817c629fa956"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="uploads-æ–‡ä»¶å¤¹"><a href="#uploads-æ–‡ä»¶å¤¹" class="headerlink" title="_uploads æ–‡ä»¶å¤¹"></a>_uploads æ–‡ä»¶å¤¹</h4><p>_uploads æ–‡ä»¶å¤¹æ˜¯ä¸ªä¸´æ—¶çš„æ–‡ä»¶å¤¹ï¼Œä¸»è¦ç”¨æ¥å­˜æ”¾ push é•œåƒè¿‡ç¨‹ä¸­çš„æ–‡ä»¶æ•°æ®ï¼Œå½“é•œåƒ <code>layer</code> ä¸Šä¼ å®Œæˆä¹‹åä¼šæ¸…ç©ºè¯¥æ–‡ä»¶å¤¹ã€‚å…¶ä¸­çš„ <code>data</code> æ–‡ä»¶ä¸Šä¼ å®Œæ¯•åä¼šç§»åŠ¨åˆ° <code>blobs</code> ç›®å½•ä¸‹ï¼Œæ ¹æ®è¯¥æ–‡ä»¶çš„ <code>sha256</code> å€¼æ¥è¿›è¡Œæ•£åˆ—å­˜å‚¨åˆ°ç›¸åº”çš„ç›®å½•ä¸‹ã€‚</p><p>ä¸Šä¼ è¿‡ç¨‹ä¸­çš„ç›®å½•ç»“æ„ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">_uploads</span><br><span class="line">â”œâ”€â”€ [  53]  0d6c996e-638f-4436-b2b6-54fa7ad430d2</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ [198M]  data</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ [  20]  hashstates</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ [  15]  sha256</span><br><span class="line">â”‚Â Â  â”‚Â Â      â””â”€â”€ [ 108]  0</span><br><span class="line">â”‚Â Â  â””â”€â”€ [  20]  startedat</span><br><span class="line">â””â”€â”€ [  53]  ba31818e-4217-47ef-ae46-2784c9222614</span><br><span class="line">    â”œâ”€â”€ [571M]  data</span><br><span class="line">    â”œâ”€â”€ [  20]  hashstates</span><br><span class="line">    â”‚Â Â  â””â”€â”€ [  15]  sha256</span><br><span class="line">    â”‚Â Â      â””â”€â”€ [ 108]  0</span><br><span class="line">    â””â”€â”€ [  20]  startedat</span><br><span class="line"></span><br><span class="line">6 directories, 6 files</span><br></pre></td></tr></table></figure><ul><li>ä¸Šä¼ å®Œé•œåƒä¹‹åï¼Œ<code>_uploads</code> æ–‡ä»¶å¤¹å°±ä¼šè¢«æ¸…ç©ºï¼Œæ­£å¸¸æƒ…å†µä¸‹è¿™ä¸ªæ–‡ä»¶å¤¹æ˜¯ç©ºçš„ã€‚ä½†ä¹Ÿæœ‰å¼‚å¸¸çš„æ—¶å€™ğŸ˜‚ï¼Œæ¯”å¦‚ç½‘ç»œæŠ–åŠ¨å¯¼è‡´ä¸Šä¼ æ„å¤–ä¸­æ–­ï¼Œè¯¥æ–‡ä»¶å¤¹å°±å¯èƒ½ä¸ä¸ºç©ºã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_uploads</span><br><span class="line"></span><br><span class="line">0 directories, 0 files</span><br></pre></td></tr></table></figure><h4 id="manifests-æ–‡ä»¶å¤¹"><a href="#manifests-æ–‡ä»¶å¤¹" class="headerlink" title="_manifests æ–‡ä»¶å¤¹"></a>_manifests æ–‡ä»¶å¤¹</h4><p><code>_manifests</code> æ–‡ä»¶å¤¹æ˜¯é•œåƒä¸Šä¼ å®Œæˆä¹‹åç”± registry æ¥ç”Ÿæˆçš„ï¼Œå¹¶ä¸”è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªåä¸º <code>link</code>çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå®ƒçš„å€¼æŒ‡å‘ blobs ç›®å½•ä¸‹ä¸ä¹‹å¯¹åº”çš„ç›®å½•ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/repositories/library</span><br><span class="line">â•°â”€# find . -type f</span><br><span class="line">./debian/_layers/sha256/aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb/link</span><br><span class="line">./debian/_layers/sha256/e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df/link</span><br><span class="line">./debian/_layers/sha256/cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d/link</span><br><span class="line">./debian/_manifests/tags/v2/current/link</span><br><span class="line">./debian/_manifests/tags/v2/index/sha256/c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11/link</span><br><span class="line">./debian/_manifests/tags/v1/current/link</span><br><span class="line">./debian/_manifests/tags/v1/index/sha256/b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239/link</span><br><span class="line">./debian/_manifests/revisions/sha256/b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239/link</span><br><span class="line">./debian/_manifests/revisions/sha256/c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11/link</span><br></pre></td></tr></table></figure><p><code>_manifests</code> æ–‡ä»¶å¤¹ä¸‹åŒ…å«ç€é•œåƒçš„ <code>tags</code> å’Œ <code>revisions</code> ä¿¡æ¯ï¼Œæ¯ä¸€ä¸ªé•œåƒçš„æ¯ä¸€ä¸ª tag å¯¹åº”ç€äº tag åç›¸åŒçš„ç›®å½•ã€‚é•œåƒçš„ tag å¹¶ä¸å­˜å‚¨åœ¨ image config ä¸­ï¼Œè€Œæ˜¯ä»¥ç›®å½•çš„å½¢å¼æ¥å½¢æˆé•œåƒçš„ tagï¼Œè¿™ä¸€ç‚¹æ¯”è¾ƒå¥‡å¦™ï¼Œè¿™å’Œæˆ‘ä»¬ Dockerfile ä¸­å¹¶ä¸åŒ…å«é•œåƒåå’Œ tag ä¸€ä¸ªé“ç†ï¼Ÿ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ [4.0K]  _layers</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â      â””â”€â”€ [4.0K]  e6e782a57a51d01168907938beb5cd5af24fcb7ebed8f0b32c203137ace6d3df</span><br><span class="line">â”‚Â Â          â””â”€â”€ [  71]  link</span><br><span class="line">â”œâ”€â”€ [4.0K]  _manifests</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ [4.0K]  revisions</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â  â”‚Â Â      â”œâ”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â”‚Â Â  â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â  â”‚Â Â      â””â”€â”€ [4.0K]  c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11</span><br><span class="line">â”‚Â Â  â”‚Â Â          â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  tags</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [4.0K]  v1</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ [4.0K]  current</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [4.0K]  index</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â      â”‚Â Â          â””â”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â”‚Â Â      â”‚Â Â              â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â      â””â”€â”€ [4.0K]  v2</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ [4.0K]  current</span><br><span class="line">â”‚Â Â          â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â          â””â”€â”€ [4.0K]  index</span><br><span class="line">â”‚Â Â              â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â                  â””â”€â”€ [4.0K]  c805f078bb47c575e9602b09af7568eb27fd1c92073199acba68c187bc5bcf11</span><br><span class="line">â”‚Â Â                      â””â”€â”€ [  71]  link</span><br><span class="line">â””â”€â”€ [4.0K]  _uploads</span><br><span class="line"></span><br><span class="line">22 directories, 9 files</span><br></pre></td></tr></table></figure><h4 id="é•œåƒçš„-tag"><a href="#é•œåƒçš„-tag" class="headerlink" title="é•œåƒçš„ tag"></a>é•œåƒçš„ tag</h4><p> æ¯ä¸ª <code>tag</code>åç›®å½•ä¸‹é¢æœ‰ <code>current</code> ç›®å½•å’Œ <code>index</code> ç›®å½•ï¼Œ <code>current</code> ç›®å½•ä¸‹çš„ link æ–‡ä»¶ä¿å­˜äº†è¯¥ tag ç›®å‰çš„ manifest æ–‡ä»¶çš„ sha256 ç¼–ç ï¼Œå¯¹åº”åœ¨ <code>blobs</code> ä¸­çš„ <code>sha256</code> ç›®å½•ä¸‹çš„ <code>data</code> æ–‡ä»¶ï¼Œè€Œ <code>index</code> ç›®å½•åˆ™åˆ—å‡ºäº†è¯¥ <code>tag</code> å†å²ä¸Šä¼ çš„æ‰€æœ‰ç‰ˆæœ¬çš„ <code>sha256</code> ç¼–ç ä¿¡æ¯ã€‚<code>_revisions</code> ç›®å½•é‡Œå­˜æ”¾äº†è¯¥ <code>repository</code> å†å²ä¸Šä¸Šä¼ ç‰ˆæœ¬çš„æ‰€æœ‰ sha256 ç¼–ç ä¿¡æ¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/repositories/library/debian/_manifests/tags/v1</span><br><span class="line">â•°â”€# cat current/link</span><br><span class="line">sha256:b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/blobs/sha256</span><br><span class="line">â•°â”€# tree -h</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ [4.0K]  aa</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb</span><br><span class="line">â”‚Â Â      â””â”€â”€ [ 26M]  data</span><br><span class="line">â”œâ”€â”€ [4.0K]  b9</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239</span><br><span class="line">â”‚Â Â      â””â”€â”€ [ 529]  data</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ <code>pull</code> é•œåƒçš„æ—¶å€™å¦‚æœä¸æŒ‡å®šé•œåƒçš„ <code>tag</code>åï¼Œé»˜è®¤å°±æ˜¯ latestï¼Œregistry ä¼šä» HTTP è¯·æ±‚ä¸­è§£æåˆ°è¿™ä¸ª tag åï¼Œç„¶åæ ¹æ® tag åç›®å½•ä¸‹çš„ link æ–‡ä»¶æ‰¾åˆ°è¯¥é•œåƒçš„ manifest çš„ä½ç½®è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ¥ç€å»è¯·æ±‚è¿™ä¸ª manifest æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯æ ¹æ®è¿™ä¸ª manifest æ–‡ä»¶æ¥ pull ç›¸åº”çš„é•œåƒ layer ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/registry/docker/registry/v2/repositories/library/debian/_manifests/tags/v1</span><br><span class="line">â•°â”€# cat  /var/lib/registry/docker/registry/v2/blobs/sha256/b9/b9caca385021f231e15aee34929eac332c49402372a79808d07ee66866792239/data</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">   <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">   <span class="attr">"config"</span>: &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.container.image.v1+json"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">1462</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:cfba37fd24f80f59e5d7c1f7735cae7a383e887d8cff7e2762fdd78c0d73568d"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="attr">"size"</span>: <span class="number">27097859</span>,</span><br><span class="line">         <span class="attr">"digest"</span>: <span class="string">"sha256:aaae33815489895f602207ac5a583422b8a8755b3f67fc6286ca9484ba685bdb"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åå†è¡¥å……ä¸€ç‚¹å°±æ˜¯ï¼ŒåŒä¸€ä¸ªé•œåƒåœ¨ registry ä¸­å­˜å‚¨çš„ä½ç½®æ˜¯ç›¸åŒçš„ï¼Œå…·ä½“çš„åˆ†æå¯ä»¥å‚è€ƒ <a href="https://supereagle.github.io/2018/04/24/docker-registry/" target="_blank" rel="noopener">é•œåƒä»“åº“ä¸­é•œåƒå­˜å‚¨çš„åŸç†è§£æ</a> è¿™ç¯‡åšå®¢ã€‚</p><blockquote><ul><li>é€šè¿‡ Registry API è·å¾—çš„ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ manifest ä¿¡æ¯å®Œå…¨ç›¸åŒã€‚</li><li>ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ manifest ä¿¡æ¯çš„å­˜å‚¨è·¯å¾„å’Œå†…å®¹å®Œå…¨ç›¸åŒã€‚</li><li>ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ blob ä¿¡æ¯çš„å­˜å‚¨è·¯å¾„å’Œå†…å®¹å®Œå…¨ç›¸åŒã€‚</li></ul></blockquote><p>ä»ä¸Šé¢è¿™ä¸‰ä¸ªç»“è®ºä¸­æˆ‘ä»¬å¯ä»¥æ¨æ–­å‡º registry å­˜å‚¨ç›®å½•é‡Œå¹¶ä¸ä¼šå­˜å‚¨ä¸è¯¥ registry ç›¸å…³çš„ä¿¡æ¯ï¼Œæ¯”æˆ‘ä»¬ push é•œåƒçš„æ—¶å€™éœ€è¦ç»™é•œåƒåŠ ä¸Š <code>localhost:5000</code> è¿™ä¸ªå‰ç¼€ï¼Œè¿™ä¸ªå‰ç¼€å¹¶ä¸ä¼šå­˜å‚¨åœ¨ registry å­˜å‚¨ä¸­ã€‚åŠ å…¥æˆ‘è¦è¿ç§»ä¸€ä¸ªå¾ˆå¤§çš„ registry é•œåƒä»“åº“ï¼Œé•œåƒçš„æ•°é‡åœ¨ 5k ä»¥ä¸Šã€‚æœ€ä¾¿æ·çš„åŠæ³•å°±æ˜¯æ‰“åŒ…è¿™ä¸ª registry å­˜å‚¨ç›®å½•ï¼Œå°†è¿™ä¸ª tar åŒ… rsync åˆ°å¦ä¸€å°æœºå™¨å³å¯ã€‚éœ€è¦å¼ºè°ƒä¸€ç‚¹ï¼Œæ‰“åŒ… registry å­˜å‚¨ç›®å½•çš„æ—¶å€™ä¸éœ€è¦è¿›è¡Œå‹ç¼©ï¼Œç›´æ¥ <code>tar -cvf</code> å³å¯ã€‚å› ä¸º registry å­˜å‚¨çš„é•œåƒ layer å·²ç»æ˜¯ä¸ª <code>tar.gzip</code> æ ¼å¼çš„æ–‡ä»¶ï¼Œå†è¿›è¡Œå‹ç¼©çš„è¯æ•ˆæœç”šå¾®è€Œä¸”è¿˜æµªè´¹ CPU æ—¶é—´å¾—ä¸å¿å¤±ã€‚</p><h3 id="docker-archive"><a href="#docker-archive" class="headerlink" title="docker-archive"></a>docker-archive</h3><p>æœ¬æ¥æˆ‘æƒ³ç€ docker save å‡ºæ¥çš„å¹¶ä¸æ˜¯ä¸€ä¸ªé•œåƒï¼Œè€Œæ˜¯ä¸€ä¸ª <code>.tar</code> æ–‡ä»¶ï¼Œä½†æˆ‘æƒ³äº†åˆæƒ³ï¼Œè¿˜æ˜¯è§‰ç€å®ƒæ˜¯ä¸€ä¸ªé•œåƒï¼Œåªä¸è¿‡å­˜åœ¨çš„æ–¹å¼ä¸åŒè€Œå·²ã€‚äºåœ¨ docker å’Œ registry ä¸­å­˜æ”¾çš„æ–¹å¼ä¸åŒï¼Œä½¿ç”¨ docker save å‡ºæ¥çš„é•œåƒæ˜¯ä¸€ä¸ªå­¤ç«‹çš„å­˜åœ¨ã€‚å°±åƒæ˜¯ä»è›‹ç³•åº—é‡Œæ‹¿å‡ºæ¥çš„è›‹ç³•ï¼Œå¤–é¢è‚¯å®šè¦æœ‰ä¸ªç²¾ç¾çš„åŒ…è£…æ˜¯å§ï¼Œä½ æ€»æ²¡è§è¿‡ã€‚æ”¾åœ¨å“ªé‡Œéƒ½å¯ä»¥ï¼Œä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬ä½¿ç”¨ docker load æ‹†å¼€å¤–åŒ…è£…(<code>.tar</code>)å°±å¯ã€‚æ¯”å¦‚æˆ‘ä»¬ç¦»çº¿éƒ¨ç½² harbor çš„æ—¶å€™å°±æ˜¯ä½¿ç”¨å®˜æ–¹çš„é•œåƒ tar åŒ…æ¥è¿›è¡ŒåŠ è½½é•œåƒå¯åŠ¨å®¹å™¨çš„ã€‚</p><h2 id="é•œåƒæ˜¯æ€ä¹ˆé£Ÿç”¨çš„ğŸ˜‹"><a href="#é•œåƒæ˜¯æ€ä¹ˆé£Ÿç”¨çš„ğŸ˜‹" class="headerlink" title="é•œåƒæ˜¯æ€ä¹ˆé£Ÿç”¨çš„ğŸ˜‹"></a>é•œåƒæ˜¯æ€ä¹ˆé£Ÿç”¨çš„ğŸ˜‹</h2><p>å½“æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªé•œåƒä¹‹åï¼Œå¦‚æœç”¨å®ƒæ¥å¯åŠ¨ä¸€ä¸ªå®¹å™¨å‘¢ï¼Ÿè¿™é‡Œå°±æ¶‰åŠåˆ°äº† OCI è§„èŒƒä¸­çš„å¦ä¸€ä¸ªè§„èŒƒå³è¿è¡Œæ—¶è§„èŒƒ <a href="https://github.com/opencontainers/runtime-spec" target="_blank" rel="noopener">runtime-spec</a> ã€‚å®¹å™¨è¿è¡Œæ—¶é€šè¿‡ä¸€ä¸ªå« <a href="https://github.com/opencontainers/runtime-spec/blob/master/bundle.md" target="_blank" rel="noopener"> OCI runtime filesytem bundle</a> çš„æ ‡å‡†æ ¼å¼å°† OCI é•œåƒé€šè¿‡å·¥å…·è½¬æ¢ä¸º bundle ï¼Œç„¶å OCI å®¹å™¨å¼•æ“èƒ½å¤Ÿè¯†åˆ«è¿™ä¸ª bundle æ¥è¿è¡Œå®¹å™¨ã€‚</p><blockquote><p>filesystem bundle æ˜¯ä¸ªç›®å½•ï¼Œç”¨äºç»™ runtime æä¾›å¯åŠ¨å®¹å™¨å¿…å¤‡çš„é…ç½®æ–‡ä»¶å’Œæ–‡ä»¶ç³»ç»Ÿã€‚æ ‡å‡†çš„å®¹å™¨ bundle åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>config.json: è¯¥æ–‡ä»¶åŒ…å«äº†å®¹å™¨è¿è¡Œçš„é…ç½®ä¿¡æ¯ï¼Œè¯¥æ–‡ä»¶å¿…é¡»å­˜åœ¨ bundle çš„æ ¹ç›®å½•ï¼Œä¸”åå­—å¿…é¡»ä¸º config.json</li><li>å®¹å™¨çš„æ ¹ç›®å½•ï¼Œå¯ä»¥ç”± config.json ä¸­çš„ root.path æŒ‡å®š</li></ul></blockquote><p><img src="img/006tNc79gy1fl7l7qihpmj30vi0lj756.jpg" alt="img"></p><h3 id="docker-run"><a href="#docker-run" class="headerlink" title="docker run"></a>docker run</h3><p>å½“æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªå®¹å™¨ä¹‹åæˆ‘ä»¬ä½¿ç”¨ tree å‘½ä»¤æ¥åˆ†æä¸€ä¸‹ overlay2 å°±ä¼šå‘ç°ï¼Œè¾ƒä¹‹å‰çš„ç›®å½•ï¼Œå®¹å™¨å¯åŠ¨ä¹‹å overlay2 ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ª <code>merged</code> çš„æ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹å°±æ˜¯å®¹å™¨å†…çœ‹åˆ°çš„ã€‚docker é€šè¿‡ overlayfs è”åˆæŒ‚è½½çš„æŠ€æœ¯å°†é•œåƒçš„å¤šå±‚ layer æŒ‚è½½ä¸ºä¸€å±‚ï¼Œè¿™å±‚çš„å†…å®¹å°±æ˜¯å®¹å™¨é‡Œæ‰€çœ‹åˆ°çš„ï¼Œä¹Ÿå°±æ˜¯ merged æ–‡ä»¶å¤¹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /var/lib/docker</span><br><span class="line">â•°â”€# tree overlay2 -d -L 3</span><br><span class="line">overlay2</span><br><span class="line">â”œâ”€â”€ 259cf6934509a674b1158f0a6c90c60c133fd11189f98945c7c3a524784509ff</span><br><span class="line">â”‚Â Â  â””â”€â”€ diff</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ bin</span><br><span class="line">|</span><br><span class="line">â”‚Â Â      â””â”€â”€ var</span><br><span class="line">â”œâ”€â”€ 27f9e9b74a88a269121b4e77330a665d6cca4719cb9a58bfc96a2b88a07af805</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”œâ”€â”€ 5f85c914c55220ec2635bce0080d2ad677f739dcfac4fd266b773625e3051844</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ var</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ merged</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ bin</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ dev</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ etc</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ home</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ media</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ mnt</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ proc</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ root</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ run</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ sbin</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ srv</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ sys</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ tmp</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ usr</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ var</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”‚Â Â      â””â”€â”€ work</span><br><span class="line">â”œâ”€â”€ 5f85c914c55220ec2635bce0080d2ad677f739dcfac4fd266b773625e3051844-init</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ diff</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ dev</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ etc</span><br><span class="line">â”‚Â Â  â””â”€â”€ work</span><br><span class="line">â”‚Â Â      â””â”€â”€ work</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">overlay on / type overlay (rw,relatime,lowerdir=/opt/docker/overlay2/l/4EPD2X5VF62FH5PZOZHZDKAKGL:/opt/docker/overlay2/l/MYRYBGZRI4I76MJWQHN7VLZXLW:/opt/docker/overlay2/l/5RZOXYR35NSGAWTI36CVUIRW7U:/opt/docker/overlay2/l/LBWRL4ZXGBWOTN5JDCDZVNOY7H:/opt/docker/overlay2/l/526XCHXRJMZXRIHN4YWJH2QLPY:/opt/docker/overlay2/l/XK5IA4BWQ2CIS667J3SXPXGQK5,upperdir=/opt/docker/overlay2/f913d81219134e23eb0827a1c27668494dfaea2f1b5d1d0c70382366eabed629/diff,workdir=/opt/docker/overlay2/f913d81219134e23eb0827a1c27668494dfaea2f1b5d1d0c70382366eabed629/work)</span><br></pre></td></tr></table></figure><p>ä» docker å®˜æ–¹æ–‡æ¡£ <a href="https://docs.docker.com/storage/storagedriver/overlayfs-driver/" target="_blank" rel="noopener">Use the OverlayFS storage driver</a> é‡Œå·æ¥çš„ä¸€å¼ å›¾ç‰‡</p><p><img src="img/overlay_constructs.jpg" alt="overlayfs lowerdir, upperdir, merged"></p><p>å…³äºä¸Šå›¾ä¸­è¿™äº› Dir çš„ä½œç”¨ï¼Œä¸‹é¢æ˜¯ä¸€æ®µä» <a href="https://stackoverflow.com/questions/56550890/docker-image-merged-diff-work-lowerdir-components-of-graphdriver" target="_blank" rel="noopener">StackOverflow</a> ä¸Šæ¬è¿è¿‡æ¥çš„è§£é‡Šã€‚</p><blockquote><p><strong>LowerDir</strong>: these are the read-only layers of an overlay filesystem. For docker, these are the image layers assembled in order.</p><p><strong>UpperDir</strong>: this is the read-write layer of an overlay filesystem. For docker, that is the equivalent of the container specific layer that contains changes made by that container.</p><p><strong>WorkDir</strong>: this is a required directory for overlay, it needs an empty directory for internal use.</p><p><strong>MergedDir</strong>: this is the result of the overlay filesystem. Docker effectively chrootâ€™s into this directory when running the container.</p></blockquote><p>å¦‚æœæƒ³å¯¹ overlayfs æ–‡ä»¶ç³»ç»Ÿæœ‰è¯¦ç»†çš„äº†è§£ï¼Œå¯ä»¥å‚è€ƒ Linux å†…æ ¸å®˜ç½‘ä¸Šçš„è¿™ç¯‡æ–‡æ¡£ <a href="https://www.kernel.org/doc/Documentation/filesystems/overlayfs.txt" target="_blank" rel="noopener">overlayfs.txt</a> ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><h3 id="å®˜æ–¹æ–‡æ¡£"><a href="#å®˜æ–¹æ–‡æ¡£" class="headerlink" title="å®˜æ–¹æ–‡æ¡£"></a>å®˜æ–¹æ–‡æ¡£</h3><ul><li><a href="https://docs.docker.com/develop/develop-images/baseimages/" target="_blank" rel="noopener">Create a base image</a></li><li><a href="https://hub.docker.com/_/scratch" target="_blank" rel="noopener">FROM scratch</a></li><li><a href="https://docs.docker.com/registry/" target="_blank" rel="noopener">Docker Registry</a></li><li><a href="https://github.com/docker/distribution/blob/master/docs/spec/manifest-v2-2.md" target="_blank" rel="noopener">Image Manifest Version 2, Schema 2</a></li><li><a href="https://docs.docker.com/registry/spec/api/" target="_blank" rel="noopener">Docker Registry HTTP API V2</a></li><li><a href="https://github.com/containers/image" target="_blank" rel="noopener">image</a></li><li><a href="https://github.com/opencontainers/image-spec" target="_blank" rel="noopener">OCI Image Manifest Specification</a></li><li><a href="https://github.com/opencontainers/distribution-spec" target="_blank" rel="noopener">distribution-spec</a></li><li><a href="https://doi-janky.infosiftr.net/job/tianon/job/debuerreotype/" target="_blank" rel="noopener">debuerreotype/</a></li><li><a href="https://www.kernel.org/doc/Documentation/filesystems/overlayfs.txt" target="_blank" rel="noopener">overlayfs.txt</a></li></ul><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><ul><li><a href="https://github.com/docker-library/oi-janky-groovy" target="_blank" rel="noopener">oi-janky-groovy</a></li><li><a href="https://github.com/debuerreotype/docker-debian-artifacts" target="_blank" rel="noopener">docker-debian-artifacts</a></li><li><a href="https://github.com/NotGlop/docker-drag" target="_blank" rel="noopener">docker-drag</a></li><li><a href="https://github.com/deislabs/oras" target="_blank" rel="noopener">oras</a></li><li><a href="https://github.com/containers/skopeo" target="_blank" rel="noopener">skopeo</a></li><li><a href="https://github.com/vbatts/tar-split" target="_blank" rel="noopener">tar-split</a></li></ul><h3 id="åšå®¢"><a href="#åšå®¢" class="headerlink" title="åšå®¢"></a>åšå®¢</h3><ul><li><a href="https://supereagle.github.io/2018/04/24/docker-registry/" target="_blank" rel="noopener">é•œåƒä»“åº“ä¸­é•œåƒå­˜å‚¨çš„åŸç†è§£æ</a></li><li><a href="http://gaocegege.com/Blog/ormb" target="_blank" rel="noopener">ormbï¼šåƒç®¡ç† Docker å®¹å™¨é•œåƒä¸€æ ·ç®¡ç†æœºå™¨å­¦ä¹ æ¨¡å‹</a></li><li><a href="https://blog.fleeto.us/post/how-are-docker-images-built/" target="_blank" rel="noopener">é•œåƒæ˜¯æ€æ ·ç‚¼æˆçš„</a></li><li><a href="https://duyanghao.github.io/docker-registry-pull-manifest-v2/" target="_blank" rel="noopener">docker pullåˆ†æ</a></li><li><a href="https://github.com/helios741/myblog/blob/new/learn_go/src/2019/20191206_docker_disk_storage/README.md" target="_blank" rel="noopener">æµ…è°ˆdockerä¸­é•œåƒå’Œå®¹å™¨åœ¨æœ¬åœ°çš„å­˜å‚¨</a></li><li><a href="https://www.qedev.com/cloud/103860.html" target="_blank" rel="noopener">å®¹å™¨OCIè§„èŒƒ é•œåƒè§„èŒƒ</a></li><li><a href="https://xuanwo.io/2019/08/06/oci-intro/" target="_blank" rel="noopener">å¼€æ”¾å®¹å™¨æ ‡å‡†(OCI) å†…éƒ¨åˆ†äº«</a></li><li><a href="https://wilhelmguo.cn/blog/post/william/%E5%AE%B9%E5%99%A8%E5%BC%80%E6%94%BE%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83%EF%BC%88CRI-OCI%EF%BC%89-2" target="_blank" rel="noopener">å®¹å™¨å¼€æ”¾æ¥å£è§„èŒƒï¼ˆCRI OCIï¼‰</a></li><li><a href="https://segmentfault.com/a/1190000014284289" target="_blank" rel="noopener">Dockeré•œåƒçš„å­˜å‚¨æœºåˆ¶</a></li><li><a href="http://open.daocloud.io/docker-source-code-analysis-part10/" target="_blank" rel="noopener">Dockeræºç åˆ†æï¼ˆåï¼‰ï¼šDockeré•œåƒä¸‹è½½</a></li><li><a href="http://open.daocloud.io/docker-source-code-analysis-part9/" target="_blank" rel="noopener">Dockeræºç åˆ†æï¼ˆä¹ï¼‰ï¼šDockeré•œåƒ</a></li><li><a href="https://www.twblogs.net/a/5b8aab392b71775d1ce86eca" target="_blank" rel="noopener">docker push éç¨‹ distributionæºç¢¼ åˆ†æ</a></li><li><a href="http://open.daocloud.io/tag/allen-tan-docker/" target="_blank" rel="noopener">Allen è°ˆ Docker</a></li><li><a href="http://open.daocloud.io/shen-ru-li-jie-dockerjing-xiang-jsonwen-jian-2/" target="_blank" rel="noopener">æ·±å…¥ç†è§£ Docker é•œåƒ json æ–‡ä»¶</a></li><li><a href="http://open.daocloud.io/docker-jing-xiang-nei-you-sha-cun-na-ntitled/" target="_blank" rel="noopener">Docker é•œåƒå†…æœ‰å•¥ï¼Œå­˜å“ªï¼Ÿ</a></li><li><a href="http://open.daocloud.io/allen-tan-docker-xi-lie-zhi-shen-ke-li-jie-docker-jing-xiang-da-xiao/" target="_blank" rel="noopener">ç†è§£ Docker é•œåƒå¤§å°</a></li><li><a href="http://open.daocloud.io/allen-tan-docker-xi-lie-zhi-tu-kan-jin-docker-rong-qi-wen-jian-xi-tong/" target="_blank" rel="noopener">çœ‹å°½ docker å®¹å™¨æ–‡ä»¶ç³»ç»Ÿ</a></li><li><a href="https://qhh.me/2019/02/17/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-Docker-%E6%9E%84%E5%BB%BA%E4%B8%8A%E4%B8%8B%E6%96%87/" target="_blank" rel="noopener">æ·±å…¥ç†è§£ Docker æ„å»ºä¸Šä¸‹æ–‡</a></li><li><a href="https://cizixs.com/2017/11/05/oci-and-runc/" target="_blank" rel="noopener">OCI å’Œ runcï¼šå®¹å™¨æ ‡å‡†åŒ–å’Œ docker</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;ä¸Šå‘¨åœ¨å†™&lt;a
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="docker" scheme="https://blog.k8s.li/tags/docker/"/>
    
      <category term="registry" scheme="https://blog.k8s.li/tags/registry/"/>
    
      <category term="image" scheme="https://blog.k8s.li/tags/image/"/>
    
  </entry>
  
  <entry>
    <title>mount å‘½ä»¤ä¹‹ --bind æŒ‚è½½å‚æ•°</title>
    <link href="https://blog.k8s.li/mount-bind.html"/>
    <id>https://blog.k8s.li/mount-bind.html</id>
    <published>2020-06-01T16:00:00.000Z</published>
    <updated>2020-06-18T14:28:38.129Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¿»è½¦ï¼ˆï¼š"><a href="#ç¿»è½¦ï¼ˆï¼š" class="headerlink" title="ç¿»è½¦ï¼ˆï¼š"></a>ç¿»è½¦ï¼ˆï¼š</h2><p>ç”±äºæˆ‘çš„ VPS ä¸æ˜¯å¤§ç›˜é¸¡(å°±æ˜¯å¤§å®¹é‡ç£ç›˜æœºå™¨å•¦ğŸ˜‚)ï¼Œ docker å­˜å‚¨ç›®å½• <code>/var/lib/docker</code> æ‰€åœ¨çš„åˆ†åŒºä¸¥é‡ä¸è¶³ï¼Œäºæ˜¯å°±æƒ³ç€åœ¨ä¸æ”¹å˜ docker é…ç½®çš„ä¸‹å°† <code>/opt</code> ç›®å½•ä¸‹çš„åˆ†åŒºåˆ†é…ç»™ <code>/var/lib/docker</code> ç›®å½•ã€‚é¦–å…ˆæƒ³åˆ°çš„æ˜¯æŠŠ <code>/var/lib/docker</code> å¤åˆ¶åˆ° <code>/opt/docker</code>ï¼Œç„¶åå†å°† <code>/opt/docker</code> è½¯é“¾æ¥åˆ° <code>/var/lib/docker</code> ã€‚</p><p>äºæ˜¯æˆ‘å°±ä¸€é¡¿æ“ä½œçŒ›å¦‚è™ï¼Œ<code>mv /var/lib/docker /opt/docker &amp;&amp; ln -s /opt/docker /var/lib/docker</code> ä¸€æŠŠæ¢­ï¼Œç„¶åæˆ‘å¯åŠ¨ä¸€ä¸ªå®¹å™¨çš„æ—¶å€™å½“åœºå°±ç¿»è½¦äº†ğŸ¤£ã€‚</p><p>åŸæ¥æœ‰äº›ç¨‹åºæ˜¯ä¸æ”¯æŒè½¯é“¾æ¥ç›®å½•çš„ï¼Œè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯è½¯é“¾æ¥çš„è·¯å¾„ä¹Ÿæœ‰ç‚¹å‘ã€‚æ¯”å¦‚æˆ‘å°† <code>/opt/docker -&gt; /var/lib/docker/</code> ï¼Œåœ¨ <code>/var/lib/docker</code> ç›®å½•ä¸‹æ‰§è¡Œ <code>ls ../</code> å³å®ƒçš„ä¸Šä¸€çº§ç›®å½•æ˜¯ <code>/opt</code> è€Œä¸æ˜¯ <code>/var/lib</code> ï¼Œå¯¹äºä¸€äº›ä¾èµ–ç›¸å¯¹è·¯å¾„çš„åº”ç”¨ï¼ˆå°¤å…¶æ˜¯ shell è„šæœ¬ï¼‰æ¥è®²è¿™æ ·ä½¿ç”¨è½¯é“¾æ¥çš„æ–¹å¼ä¹Ÿå®¹æ˜“ç¿»è½¦ğŸ˜‚ã€‚</p><p>é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ›´å¥½çš„åŠæ³•å°†ä¸¤ä¸ªç›®å½•è¿›è¡Œâ€œç¡¬é“¾æ¥â€å‘¢ï¼Œæ³¨æ„æˆ‘åœ¨æ­¤ç”¨çš„æ˜¯åŒå¼•å·ï¼Œå¹¶éæ˜¯çœŸæ­£çš„â€ç¡¬é“¾æ¥â€œï¼Œæœäº†ä¸€åœˆå‘ç° mount â€“bind è¿™ç§éªšæ“ä½œã€‚æ— è®ºæˆ‘ä»¬å¯¹æ–‡ä»¶ä½¿ç”¨è½¯é“¾æ¥/ç¡¬é“¾æ¥/bindï¼Œè¿˜æ˜¯å¯¹ç›®å½•ä½¿ç”¨è½¯é“¾æ¥ï¼Œå…¶å®éƒ½æ˜¯å¸Œæœ›æ“ä½œçš„ <code>src</code> å’Œ <code>dest</code> ä»–ä»¬äºŒè€…éƒ½èƒ½ä¿æŒä¸€è‡´ã€‚é€šè¿‡ bind æŒ‚è½½çš„æ–¹å¼å…·æœ‰ç€æŒ‚è½½ç‚¹çš„ä¸€äº›ç‰¹æ€§ï¼Œè¿™æ˜¯é“¾æ¥æ˜¯ä¸å…·æœ‰çš„ï¼Œå¯¹ä¸€äº›ä¸æ”¯æŒé“¾æ¥çš„åº”ç”¨æ¥è®²ï¼Œbind çš„æ–¹å¼è¦å‹å¥½ä¸€äº›ã€‚</p><h2 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h2><p>å…¶å® bind è¿™ä¸ªæŒ‚è½½é€‰é¡¹æˆ‘ä»¬åœ¨ä½¿ç”¨ docker æˆ–è€… kubernetes å¤šå°‘éƒ½ä¼šç”¨åˆ°çš„ï¼Œå°¤å…¶æ˜¯å½“ä½¿ç”¨ kubernetes  æ—¶ kubelet åœ¨å¯åŠ¨å®¹å™¨æŒ‚è½½å­˜å‚¨çš„æ—¶å€™åº•å±‚æ˜¯å°† node èŠ‚ç‚¹æœ¬æœºçš„ <code>/var/lib/kubelet/pods/&lt;Podçš„ID&gt;/volumes/kubernetes.io~&lt;Volumeç±»å‹&gt;/&lt;Volumeåå­—&gt;</code> ç›®å½•é€šè¿‡ bind çš„æ–¹å¼æŒ‚è½½åˆ°å®¹å™¨ä¸­çš„ï¼Œè¯¦ç»†çš„åˆ†æå¯ä»¥å‚è€ƒä¹‹å‰æˆ‘å†™çš„ä¸€ç¯‡åšå®¢ <a href="https://blog.k8s.li/kubelet-mount-volumes-analysis.html">kubelet æŒ‚è½½ volume åŸç†åˆ†æ</a> ã€‚</p><blockquote><ul><li><strong>Volumes</strong> are stored in a part of the host filesystem which is <em>managed by Docker</em> (<code>/var/lib/docker/volumes/</code> on Linux). Non-Docker processes should not modify this part of the filesystem. Volumes are the best way to persist data in Docker.</li><li><strong>Bind mounts</strong> may be stored <em>anywhere</em> on the host system. They may even be important system files or directories. Non-Docker processes on the Docker host or a Docker container can modify them at any time.</li><li><strong><code>tmpfs</code> mounts</strong> are stored in the host systemâ€™s memory only, and are never written to the host systemâ€™s filesystem.</li></ul></blockquote><p>ä¸è¿‡é‚£æ—¶å€™å¹¶æ²¡æœ‰è¯¦ç»†åœ°å»äº†è§£ bind çš„åŸç†ï¼Œç›´åˆ°æœ€è¿‘ç¿»äº†ä¸€æ¬¡è½¦æ‰æƒ³èµ·æ¥ bind ï¼Œäºæ˜¯æ¥ä¸‹æ¥å°±è¯¦ç»†åœ°åˆ†æä»¥ä¸‹ mount â€“bind æŒ‚è½½å‚æ•°ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨è½¯é“¾æ¥é“¾æ¥ç›®å½•</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls -i æ˜¾ç¤ºæ–‡ä»¶/ç›®å½•çš„ inode å·</span></span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ln -s /opt/docker /var/lib/docker</span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ls -i /opt | grep docker</span><br><span class="line">2304916 docker</span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ls -i /var/lib | grep docker</span><br><span class="line">    211 docker</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨ç¡¬é“¾æ¥é“¾æ¥ä¸¤ä¸ªæ–‡ä»¶</span></span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ln /usr/local/bin/docker-compose /usr/bin/docker-compose</span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ls -i /usr/bin/docker-compose</span><br><span class="line">112 /usr/bin/docker-compose</span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ls -i /usr/bin/docker-compose</span><br><span class="line">112 /usr/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨ --<span class="built_in">bind</span> æŒ‚è½½ç›®å½•</span></span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# mount --bind /opt/docker /var/lib/docker</span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ls -i /var/lib | grep docker</span><br><span class="line">2304916 docker</span><br><span class="line">â•­â”€root@sg-02 /var/lib</span><br><span class="line">â•°â”€# ls -i /opt | grep docker</span><br><span class="line">2304916 docker</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“ä½¿ç”¨ä½¿ç”¨ç¡¬é“¾æ¥æˆ– bind æŒ‚è½½ç›®å½•æ—¶ï¼Œä¸¤ä¸ªæ–‡ä»¶ inode å·æ˜¯ç›¸åŒçš„ï¼Œä½¿ç”¨è½¯é“¾æ¥çš„ä¸¤ä¸ªæ–‡ä»¶çš„ inode å·æ˜¯ä¸åŒçš„ã€‚ä½†ç›®å½•åˆä¸èƒ½ä½¿ç”¨ç¡¬é“¾æ¥ï¼Œè€Œä¸”ç¡¬é“¾æ¥ä¸æ”¯æŒè·¨åˆ†åŒºã€‚æˆ‘ä»¬æ˜¯å¦å¯ä»¥å°† bind çš„æ•ˆæœå’Œ<br>â€œç¡¬é“¾æ¥ç›®å½•â€œ æ ·æ¥ä½¿ç”¨å‘¢ï¼Ÿå…¶å®å¯ä»¥è¿™æ ·ç”¨ï¼Œä½†è¿™æ ·ç±»æ¯”å¹¶ä¸ä¸¥è°¨ã€‚</p><p>å½“æˆ‘ä»¬ä½¿ç”¨ bind çš„æ—¶å€™ï¼Œæ˜¯å°†ä¸€ä¸ªç›®å½• A  æŒ‚è½½åˆ°å¦ä¸€ä¸ªç›®å½• B ï¼Œç›®å½• B åŸæœ‰çš„å†…å®¹å°±è¢«å±â€è”½æ‰â€œäº†ï¼Œç›®å½• B é‡Œé¢çš„å†…å®¹å°±æ˜¯ç›®å½• A é‡Œé¢çš„å†…å®¹ã€‚è¿™å’Œæˆ‘ä»¬æŒ‚åœ¨å…¶ä»–åˆ†åŒºåˆ°æŒ‚è½½ç‚¹ç›®å½•ä¸€æ ·ï¼Œç›®å½• B çš„å†…å®¹è¿˜æ˜¯å­˜åœ¨çš„ï¼Œåªä¸è¿‡æ˜¯è¢«â€å±è”½â€œæ‰äº†ï¼Œå½“æˆ‘ä»¬ umount B åï¼ŒåŸå†…å®¹å°±ä¼šå¤ç°ã€‚</p><p>å½“æˆ‘ä»¬ä½¿ç”¨ <code>docker run -v PATH:PATH</code> å¯åŠ¨ä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ï¼Œå®è´¨ä¸Šä¹Ÿæ˜¯ä¼šç”¨åˆ° <code>bind</code>ï¼Œdocker ä¼šå°†ä¸»æœºçš„ç›®å½•é€šè¿‡ <code>bind</code> çš„æ–¹å¼æŒ‚è½½åˆ°å®¹å™¨ç›®å½•ã€‚ä¸‹é¢æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ª alpine å®¹å™¨æ¥å®éªŒä¸€ä¸‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run --name alpine -v /opt/bind/:/var --privileged --rm -it alpine sh</span><br><span class="line">docker inspect alpine</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">"Mounts": [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"Type"</span>: <span class="string">"bind"</span>,</span><br><span class="line">        <span class="attr">"Source"</span>: <span class="string">"/opt/bind"</span>,</span><br><span class="line">        <span class="attr">"Destination"</span>: <span class="string">"/var"</span>,</span><br><span class="line">        <span class="attr">"Mode"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="attr">"RW"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"Propagation"</span>: <span class="string">"rprivate"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>åœ¨å®¹å™¨å†…ä½¿ç”¨ umount å‘½ä»¤å¸è½½æ‰ <code>/var</code> ï¼Œumount æ“ä½œéœ€è¦ root æƒé™ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™åŠ ä¸Š <code>--privileged</code> å‚æ•°æ¥å¯åŠ¨ä¸€ä¸ªç‰¹æƒå®¹å™¨çš„åŸå› ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/ # ls /var/</span><br><span class="line">74898710_p21.jpg    MJSTEALEY.md        docker-compose.yml  letsencrypt         resolv.conf</span><br><span class="line">CONSOLE.md          README.md           hostname            logs                stop-and-remove.sh</span><br><span class="line">LICENSE             config              hosts               nginx               webp-server</span><br><span class="line">/ # umount /var/</span><br><span class="line"><span class="meta">#</span><span class="bash"> umount ä¹‹åå®¹å™¨å†…åŸæ¥çš„ /var ç›®å½•å†…å®¹<span class="string">"æ¢å¤"</span>äº†</span></span><br><span class="line">/ # ls /var/</span><br><span class="line">cache  empty  lib    local  lock   log    mail   opt    run    spool  tmp</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–ç”¨å¤„ğŸ¤”"><a href="#å…¶ä»–ç”¨å¤„ğŸ¤”" class="headerlink" title="å…¶ä»–ç”¨å¤„ğŸ¤”"></a>å…¶ä»–ç”¨å¤„ğŸ¤”</h2><h3 id="æ— ç¼æ›´æ–°-Webp-Server-Go"><a href="#æ— ç¼æ›´æ–°-Webp-Server-Go" class="headerlink" title="æ— ç¼æ›´æ–° Webp Server Go"></a>æ— ç¼æ›´æ–° Webp Server Go</h3><p>åœ¨ <a href="">å°åœŸè±†</a>ã€<a href="">Nona</a> å¤§ä½¬è®¨è®º <a href="">Webp Server Go</a> æ— ç¼æ›´æ–°çš„æ—¶å€™æˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªæ€è·¯ï¼š</p><blockquote><ul><li><p>åœ¨æ›´æ–°ä¹‹å‰å…ˆå¯¹ nginx é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œå»æ‰ webp server çš„ location å­—æ®µï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~* \.(png|jpg|jpeg)$</span> &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://127.0.0.1:3333;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> HOST <span class="variable">$http_host</span>;</span><br><span class="line">    <span class="attribute">add_header</span> Cache-Control <span class="string">'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç„¶åå† nginx -s reload ä¸ä¸­æ–­ reload ä¸€</p></li><li><p>æ¥ç€åœæ‰ webp server æœåŠ¡ <code>systemctl stop webps</code></p></li><li><p>mv webp-server{.bak,}</p></li><li><p>mv ./upload/webp-server-linux-amd64 webp-server</p></li><li><p>æ¥ç€å¯åŠ¨ webp server æœåŠ¡ <code>systemctl start webps</code></p></li><li><p>ç„¶åå¼€å€’è½¦æŠŠ nginx é…ç½®æ–‡ä»¶å†æ”¹å›å»ğŸ</p></li></ul></blockquote><p>åœ¨æ­¤éœ€è¦æå‡ ç‚¹ï¼Œæˆ‘ä»¬å¸Œæœ›<strong>æ— ç¼æ›´æ–°</strong>ï¼Œå³åœ¨æ›´æ–°çš„è¿‡ç¨‹ä¸­ä¸ä¼šå¯¼è‡´ç”¨æˆ·è¯·æ±‚å›¾ç‰‡èµ„æºå¤±è´¥ï¼Œé‚£æ€• <code>+1s</code>éƒ½ä¸è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æš‚æ—¶æ€§åœ°åœ¨ nginx é…ç½®æ–‡ä»¶é‡Œå»æ‰ webp server ï¼Œä½¿å®ƒå»è¯·æ±‚åŸå›¾ç‰‡ï¼Œç­‰æ›´æ–°å®Œ webp server ä¹‹åå†æ·»åŠ ä¸Šå»ã€‚</p><p>å¯¹äºæœ¨å­è¿™ç§ç»å¸¸åˆ åº“è·‘è·¯çš„æ‰‹æ®‹èœé¸Ÿæ¥è®²ï¼Œå¯¹ä¸€ä¸ªé…ç½®æ–‡ä»¶æ”¹æ¥æ”¹å»ä¸æ˜¯å¥½æ–¹æ³•ï¼Œä¸‡ä¸€ nginx é…ç½®æ–‡ä»¶æ”¹æ¥æ”¹å»æ²¡æ”¹å¥½ï¼Œ nginx -s reload ä¸€ä¸‹ nginx æœåŠ¡å°±ç‚¸äº†ğŸ˜‚ã€‚é‚£ä¹ˆä½¿ç”¨ cp å’Œ mv æ€ä¹ˆæ ·ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cp blog.conf&#123;,.bak&#125;</span><br><span class="line">vim blog.conf</span><br><span class="line">nginx -s reload</span><br><span class="line">- update webp server</span><br><span class="line">mv blog.conf&#123;,.bak2&#125;</span><br><span class="line">mv blog.conf&#123;.bak,&#125;</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ bind å‘¢ï¼Ÿå¥½åƒå°‘äº†ä¸€æ­¥ï¼Œä¸‹æ¬¡æ›´æ–° webp server çš„æ—¶å€™åªéœ€è¦ umount ä¸€ä¸‹ï¼Œæ›´æ–°å®Œä¹‹åå† mount ä¸€ä¸‹å°±å¯ä»¥å•¦ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cp blog.conf&#123;,.bak&#125;</span><br><span class="line">vim blog.conf</span><br><span class="line">nginx -s reload</span><br><span class="line">- update webp server</span><br><span class="line">mount --bind blog.conf.bak blohg.conf</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><h3 id="VPS-æ¬å®¶åŠ©æ‰‹"><a href="#VPS-æ¬å®¶åŠ©æ‰‹" class="headerlink" title="VPS æ¬å®¶åŠ©æ‰‹"></a>VPS æ¬å®¶åŠ©æ‰‹</h3><p>å…¶å®è¿˜æœ‰å¾ˆå¤šç”¨é€”å•¦ï¼Œè¿™é‡Œå°±ä¸ç½—åˆ—äº†</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;ç¿»è½¦ï¼ˆï¼š&quot;&gt;&lt;a href=&quot;#ç¿»è½¦ï¼ˆï¼š&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="linux" scheme="https://blog.k8s.li/tags/linux/"/>
    
      <category term="overlay2" scheme="https://blog.k8s.li/tags/overlay2/"/>
    
      <category term="docker" scheme="https://blog.k8s.li/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>é•œåƒæ¬è¿å·¥ skopeo åˆä½“éªŒ</title>
    <link href="https://blog.k8s.li/skopeo.html"/>
    <id>https://blog.k8s.li/skopeo.html</id>
    <published>2020-05-26T16:00:00.000Z</published>
    <updated>2020-05-28T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ¬ç –å·¥å…·"><a href="#æ¬ç –å·¥å…·" class="headerlink" title="æ¬ç –å·¥å…·"></a>æ¬ç –å·¥å…·</h2><p>ä¸Šå‘¨æœ«çš„æ—¶å€™æ›´æ–°å®Œä¸€ç¯‡ã€Šæœ¨å­çš„æ¬ç –å·¥å…·ğŸ˜‚ã€‹ï¼Œæœ€è¿‘å› ä¸ºé¡¹ç›®éœ€æ±‚åˆå‘ç°äº†ä¸ªæ¬ç –å·¥å…·ï¼Œæ‰€ä»¥æ¥æ°´ç¯‡åšå®¢åˆ†äº«ç»™å¤§å®¶ã€‚</p><blockquote><p>  æˆ‘å¸é¡¹ç›®ç»„ä¸­çš„ä¸€ä¸ªéœ€æ±‚å°±æ˜¯ï¼šåœ¨ä¸€å°æœºå™¨ä¸Šå» pull ä¸€ä¸ªé•œåƒåˆ—è¡¨ä¸­çš„é•œåƒï¼Œè¿™äº›é•œåƒå­˜å‚¨åœ¨ registry A Harbor ä¸Šï¼Œpull å®Œè¿™äº›é•œåƒä¹‹åé‡æ–°æ‰“ä¸Š tag ç„¶åå† push åˆ°å¦ä¸€ä¸ª registry B Harbor  ä¸Šå»ã€‚ç›¸å½“äºä¸€ä¸ªåŒæ­¥é•œåƒæ“ä½œï¼Œä½†å’Œ harbor é‡Œåœ¨å¸¦çš„é‚£ä¸ªé•œåƒåŒæ­¥è¿˜æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œæˆ‘ä»¬ä»…ä»…éœ€è¦åŒæ­¥ç‰¹å®š tag çš„é•œåƒï¼Œè€Œä¸æ˜¯æ•´ä¸ª harbor æˆ–è€… project é‡Œçš„å…¨éƒ¨é•œåƒã€‚ç›®å‰æˆ‘ä»¬çš„åšæ³•è¿˜æ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼Œä½¿ç”¨ docker å‘½ä»¤è¡Œçš„æ–¹å¼æ¥ pull é•œåƒï¼Œç„¶åæ‰“ tag æ¥ç€ push åˆ° B harborã€‚ä½†æ˜¯å•Šï¼Œå½“åŒæ­¥äºŒä¸‰ç™¾ä¸ªçš„é•œåƒï¼Œæˆ–è€…é•œåƒçš„æ€»å¤§å°å‡ å GB çš„æ—¶å€™è¿™ç§åŸå§‹çš„æ–¹æ³•é€Ÿåº¦è¿˜æ˜¯å¤ªæ…¢äº†ï¼Œäºæ˜¯å°±æ€è€ƒæœ‰æ²¡æœ‰å¦ä¸€ä¸ªå·¥å…·å¯ä»¥ç›´æ¥å°† registry A ä¸­çš„æŸä¸ªé•œåƒåŒæ­¥åˆ° registry B ä¸­å»ã€‚</p></blockquote><p>ä¹‹å‰æˆ‘çœ‹åˆ°è¿‡ <a href="https://mritd.me/" target="_blank" rel="noopener">æ¼ ç„¶å¤§ä½¬</a> å†™çš„åšå®¢<a href="https://mritd.me/2020/03/31/how-to-download-docker-image-without-docker/" target="_blank" rel="noopener">ã€Šå¦‚ä½•ä¸é€šè¿‡ docker ä¸‹è½½ docker imageã€‹</a> ï¼Œäºæ˜¯å’±ä¹Ÿå°±ä¸Šæ‰‹è¯•ä¸€ä¸‹è¿™ä¸ªå·¥å…·çœ‹çœ‹èƒ½ä¸èƒ½å¸®å’±æ¬ç‚¹ç –ğŸ˜‚ã€‚ç»“åˆè¿™ä¸ªå·¥å…·çš„ä½¿ç”¨ï¼Œåˆä¸€æ¬¡åŠ æ·±äº†å¯¹å®¹å™¨é•œåƒåˆ†å‘å­˜å‚¨çš„äº†è§£ï¼Œæ”¶è·é¢‡ä¸°ğŸ˜‹</p><h3 id="image"><a href="#image" class="headerlink" title="image"></a>image</h3><p>å…³äºé•œåƒçš„è¯¦ç»†åˆ†æå¯ä»¥å‚è€ƒ <a href="https://github.com/helios741/myblog/tree/new/learn_go/src/2019/20191206_docker_disk_storage" target="_blank" rel="noopener">æµ…è°ˆdockerä¸­é•œåƒå’Œå®¹å™¨åœ¨æœ¬åœ°çš„å­˜å‚¨</a></p><h3 id="registry"><a href="#registry" class="headerlink" title="registry"></a>registry</h3><p>æ ¹æ® <a href="https://supereagle.github.io/" target="_blank" rel="noopener">Robin</a> å¤§ä½¬åœ¨ <a href="https://supereagle.github.io/2018/04/24/docker-registry/" target="_blank" rel="noopener">é•œåƒä»“åº“ä¸­é•œåƒå­˜å‚¨çš„åŸç†è§£æ</a> æ–‡ç« é‡Œå¾—å‡ºçš„ç»“è®ºï¼š</p><blockquote><ul><li>é€šè¿‡ Registry API è·å¾—çš„ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ manifest ä¿¡æ¯å®Œå…¨ç›¸åŒã€‚</li><li>ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ manifest ä¿¡æ¯çš„å­˜å‚¨è·¯å¾„å’Œå†…å®¹å®Œå…¨ç›¸åŒã€‚</li><li>ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ blob ä¿¡æ¯çš„å­˜å‚¨è·¯å¾„å’Œå†…å®¹å®Œå…¨ç›¸åŒã€‚</li></ul></blockquote><h3 id="docker-pull-å’Œ-docker-push"><a href="#docker-pull-å’Œ-docker-push" class="headerlink" title="docker pull å’Œ docker push"></a>docker pull å’Œ docker push</h3><p>ä¹‹æ‰€ä»¥æƒ³ä½¿ç”¨ skopeo æ›¿ä»£åŸæœ‰ä½¿ç”¨ docker pull â€“&gt; docker tag â€“&gt; docker push çš„æ“ä½œï¼Œæ˜¯å› ä¸º docker pull é•œåƒçš„æ—¶å€™ï¼Œregistry ä¸­å­˜å‚¨çš„é•œåƒ layer æ ¼å¼æ˜¯ <code>vnd.docker.image.rootfs.diff.tar.gzip</code> ï¼Œè¿™æ˜¯ä¸€ä¸ª tar.gz ç±»å‹çš„æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æœ¬åœ°æ­å»ºä¸€ä¸ª harbor ï¼Œå¹¶å‘ harbor æ¨é€ä¸€ä¸ª alpine:latest é•œåƒï¼Œæ¥åˆ†æä¸€ä¸‹é•œåƒæ˜¯å¦‚ä½•åœ¨ registry ä¸­å­˜å‚¨çš„ã€‚</p><ul><li>harbor çš„å­˜å‚¨ç›®å½•</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">tree</span><br><span class="line">`-- registry</span><br><span class="line">    `-- v2      # registry V2 ç‰ˆæœ¬</span><br><span class="line">        |-- blobs # blobs ç›®å½•ä¸‹å­˜å‚¨é•œåƒçš„ raw æ•°æ®ï¼Œå­˜å‚¨çš„æœ€å°å•å…ƒä¸º layer</span><br><span class="line">        |   `-- sha256</span><br><span class="line">        |       |-- 39</span><br><span class="line">        |       |-- cb</span><br><span class="line">        |       `-- f7</span><br><span class="line">        `-- repositories # é•œåƒçš„å…ƒæ•°æ®ä¿¡æ¯</span><br><span class="line">            `-- library</span><br><span class="line">                `-- alpine</span><br></pre></td></tr></table></figure><ul><li>é•œåƒçš„ <a href="https://github.com/opencontainers/image-spec/blob/master/manifest.md" target="_blank" rel="noopener">manifest</a> æ˜¯é’ˆå¯¹registryæœåŠ¡ç«¯çš„é…ç½®ä¿¡æ¯</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sh-4.2# skopeo inspect docker://index.docker.io/library/alpine:latest --raw</span><br><span class="line">&#123;</span><br><span class="line">   "schemaVersion": 2,</span><br><span class="line">   "mediaType": "application/vnd.docker.distribution.manifest.v2+json",</span><br><span class="line">   "config": &#123;</span><br><span class="line">      "mediaType": "application/vnd.docker.container.image.v1+json",</span><br><span class="line">      "size": 1507,</span><br><span class="line">      "digest": "sha256:f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a"</span><br><span class="line">   &#125;,</span><br><span class="line">   "layers": [</span><br><span class="line">      &#123;</span><br><span class="line">         "mediaType": "application/vnd.docker.image.rootfs.diff.tar.gzip",</span><br><span class="line">         "size": 2813316,</span><br><span class="line">         "digest": "sha256:cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08"</span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä»”ç»†çœ‹ä¸€ä¸‹ <code>digest</code> å’Œä¸‹é¢æ–‡ä»¶å¤¹çš„åç§°ï¼Œä»–ä»¬æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå› ä¸º manifest ä¿¡æ¯å°±æ˜¯é•œåƒåœ¨ registry ä¸­å­˜å‚¨çš„ä¿¡æ¯ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">tree</span><br><span class="line">|-- [  20]  blobs</span><br><span class="line">|   `-- [  36]  sha256</span><br><span class="line">|       |-- [  78]  39</span><br><span class="line">|       |   `-- [  18]  39eda93d15866957feaee28f8fc5adb545276a64147445c64992ef69804dbf01</span><br><span class="line">|       |       `-- [ 528]  data</span><br><span class="line">|       |-- [  78]  cb</span><br><span class="line">|       |   `-- [  18]  cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08</span><br><span class="line">|       |       `-- [2.7M]  data </span><br><span class="line">|       `-- [  78]  f7</span><br><span class="line">|           `-- [  18]  f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span><br><span class="line">|               `-- [1.5K]  data</span><br><span class="line">`-- [  21]  repositories</span><br><span class="line">    `-- [  20]  library</span><br><span class="line">        `-- [  55]  alpine</span><br><span class="line">            |-- [  20]  _layers</span><br><span class="line">            |   `-- [ 150]  sha256</span><br><span class="line">            |       |-- [  18]  cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08</span><br><span class="line">            |       |   `-- [  71]  link</span><br><span class="line">            |       `-- [  18]  f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span><br><span class="line">            |           `-- [  71]  link</span><br><span class="line">            |-- [  35]  _manifests</span><br><span class="line">            |   |-- [  20]  revisions</span><br><span class="line">            |   |   `-- [  78]  sha256</span><br><span class="line">            |   |       `-- [  18]  39eda93d15866957feaee28f8fc5adb545276a64147445c64992ef69804dbf01</span><br><span class="line">            |   |           `-- [  71]  link</span><br><span class="line">            |   `-- [  20]  tags</span><br><span class="line">            |       `-- [  34]  latest</span><br><span class="line">            |           |-- [  18]  current</span><br><span class="line">            |           |   `-- [  71]  link</span><br><span class="line">            |           `-- [  20]  index</span><br><span class="line">            |               `-- [  78]  sha256</span><br><span class="line">            |                   `-- [  18]  39eda93d15866957feaee28f8fc5adb545276a64147445c64992ef69804dbf01</span><br><span class="line">            |                       `-- [  71]  link</span><br><span class="line">            `-- [   6]  _uploads</span><br><span class="line"></span><br><span class="line">26 directories, 8 files</span><br></pre></td></tr></table></figure><ul><li>æˆ‘ä»¬å»çœ‹ä¸€ä¸‹ <code>[2.7M]  data</code>  è¿™ä¸ªæ–‡ä»¶ï¼Œå…¶ä»–æ–‡ä»¶ä¼°è®¡æ˜¯ä¸€äº› json æ–‡æœ¬ç”¨äºä¿å­˜å…ƒæ•°æ®ä¿¡æ¯ã€‚ä½¿ç”¨ file å‘½ä»¤æŸ¥çœ‹ blobs/sha256/cb/cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08 ç›®å½•ä¸‹çš„ <code>data</code> æ–‡ä»¶ã€‚é•œåƒçš„æ¯ä¸€å±‚éƒ½æ˜¯å­˜æ”¾åœ¨ä¸€ä¸ª 64 ä½é•¿åº¦åç§°çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–‡ä»¶åå°±æ˜¯ <code>data</code> ã€‚è€Œä¸”è¿™ä¸ªæ–‡ä»¶è¿˜æ˜¯ä¸ª gzip å‹ç¼©åçš„æ–‡ä»¶ã€‚æˆ‘ä¹ˆå¯ä»¥ä½¿ç”¨ tar å‘½ä»¤å°†å…¶è§£å‹å¼€æ¥ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd registry/v2/blobs/sha256/cb/cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08</span><br><span class="line">sh-4.2# file data</span><br><span class="line">data: gzip compressed data</span><br><span class="line">sh-4.2# mkdir layer</span><br><span class="line">sh-4.2# tar -xvf data -C layer/</span><br></pre></td></tr></table></figure><ul><li>å°†å…¶è§£å‹åˆ° layer ç›®å½•ä¸‹ï¼Œä½¿ç”¨ tree å‘½ä»¤çœ‹ä¸€ä¸‹æ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹å°±ä¼šæ˜ç™½ï¼Œè¿™ä¸å°±æ˜¯æˆ‘ä»¬çš„ alpine é•œåƒçœŸå®çš„å†…å®¹å˜›ğŸ˜‚ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sh-4.2# tree -L 1 -d layer</span><br><span class="line">layer</span><br><span class="line">|-- bin</span><br><span class="line">|-- dev</span><br><span class="line">|-- etc</span><br><span class="line">|-- home</span><br><span class="line">|-- lib</span><br><span class="line">|-- media</span><br><span class="line">|-- mnt</span><br><span class="line">|-- opt</span><br><span class="line">|-- proc</span><br><span class="line">|-- root</span><br><span class="line">|-- run</span><br><span class="line">|-- sbin</span><br><span class="line">|-- srv</span><br><span class="line">|-- sys</span><br><span class="line">|-- tmp</span><br><span class="line">|-- usr</span><br><span class="line">`-- var</span><br></pre></td></tr></table></figure><p>çŸ¥é“äº†é•œåƒåœ¨ registry ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Œæˆ‘ä»¬ä¹Ÿå°±èƒ½å¤Ÿæ˜ç™½åœ¨å½“å‰ä»…ä»…ä¸ºäº†åŒæ­¥ä¸¤ä¸ª registry ä¸Šçš„é•œåƒä½¿ç”¨ docker pull â€“&gt; docker tag â€“&gt; docker push æ“ä½œçš„å¼Šç«¯ã€‚å› ä¸º docker pull é•œåƒæ—¶ä¼šå¯¹ registry ä¸Šçš„ layer è¿›è¡Œè§£å‹ç¼©ï¼Œè¿™ä¸€ç‚¹å’Œæˆ‘ä»¬çš„æµè§ˆå™¨è§£å‹ç¼©ä¸€äº›  gzip å‹ç¼©çš„èµ„æºä¸€æ ·é“ç†ï¼Œä¸ºäº†å‡å°‘ç½‘ç»œä¼ è¾“çš„æµé‡ã€‚å½“æˆ‘ä»¬ pull é•œåƒçš„æ—¶å€™ï¼Œdocker ä¼šæœ‰ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹å¯¹é•œåƒè¿›è¡Œè§£å‹ç¼©ï¼Œåœ¨ä½¿ç”¨ docker pull æ‹‰å–é•œåƒçš„æ—¶å€™ä½¿ç”¨ ps æŸ¥çœ‹ä¸€ä¸‹è¿›ç¨‹å°±ä¼šæ‰¾åˆ° <code>docker-untar</code>  è¿™ä¸ªè¿›ç¨‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-untar /var/lib/docker/overlay2/a076db6567c7306f3cdab6040cd7d083ef6a39d125171353eedbb8bde7f203b4/diff</span><br></pre></td></tr></table></figure><p>å¯¹äºä¸€äº›å¾ˆå¤§çš„é•œåƒæ¯”å¦‚ 2GB ä»¥ä¸Šï¼Œæœ‰æ—¶å€™é•œåƒ layer å·²ç» download å®Œäº†ï¼Œä½†æ˜¯è¿˜åœ¨è¿›è¡Œé•œåƒçš„è§£å‹ç¼©ï¼Œæ€§èƒ½çš„ç“¶é¢ˆä¹Ÿå°±åœ¨äº†è§£å‹é•œåƒè¿™ä¸€å—ã€‚å¯¹äº docker push æ¥è®²ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p>æœ‰æ²¡æœ‰ä¸€ç§åŠæ³•å¯ä»¥ç›´æ¥å°† registry ä¸Šçš„ blob å¤åˆ¶åˆ°å¦ä¸€ä¸ª registryï¼Œä¸­é—´è¿‡ç¨‹ä¸æ¶‰åŠå¯¹é•œåƒ layer çš„è§£å‹ç¼©ï¼Œè¿™å²‚ä¸ç¾å“‰ğŸ˜‚ã€‚</p><h2 id="skopeo-install"><a href="#skopeo-install" class="headerlink" title="skopeo install"></a>skopeo install</h2><h3 id="yum-dnf-zypper-brew"><a href="#yum-dnf-zypper-brew" class="headerlink" title="yum/dnf/zypper/brew"></a>yum/dnf/zypper/brew</h3><p>å®‰è£…æ–¹å¼å¾ˆç®€å•ï¼Œå¯¹äºå¸¸è§çš„å‘ç›¸ä¼´ç›´æ¥ install ä¸€æŠŠæ¢­å°±è¡Œï¼Œä»å®˜æ–¹æ–‡æ¡£å·æ¥çš„å®‰è£…æ–¹å¼ğŸ˜‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo dnf install skopeo</span></span><br></pre></td></tr></table></figure><p>on RHEL/CentOS â‰¤ 7.x:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install skopeo</span></span><br></pre></td></tr></table></figure><p>for openSUSE:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo zypper install skopeo</span></span><br></pre></td></tr></table></figure><p>on alpine:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apk add skopeo</span></span><br></pre></td></tr></table></figure><p>on macOS:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> brew install skopeo</span></span><br></pre></td></tr></table></figure><h3 id="build"><a href="#build" class="headerlink" title="build"></a>build</h3><p>ç”±äºæˆ‘çš„ VPS æœºå™¨æ˜¯ Ubuntu 1804 çš„ OS ï¼Œé…ç½® apt æºå¹¶æ²¡æˆåŠŸï¼Œå½“åœºç¿»è½¦ã€‚ä¸ºäº†èƒ½å¤Ÿå¿«é€Ÿä½“éªŒä¸€æŠŠè¿˜æ˜¯æœ¬åœ°èµ·ä¸€ä¸ª alpine å®¹å™¨ï¼Œåœ¨ alpine é‡Œé€šè¿‡ apk add çš„æ–¹å¼å®‰è£… skopeoã€‚ä½† alpine é‡Œçš„ skopeo ç‰ˆæœ¬ è¿˜æ˜¯ 0.14.0 ğŸ˜¥ï¼ŒGitHub ä¸Šçš„ master åˆ†æ”¯å·²ç» 1.0.0äº†ï¼Œè€Œä¸”å¹¶æ²¡æœ‰ sync çš„é€‰é¡¹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/ # skopeo --help</span><br><span class="line">NAME:</span><br><span class="line">   skopeo - Various operations with container images and container image registries</span><br><span class="line">USAGE:</span><br><span class="line">   skopeo [global options] command [command options] [arguments...]</span><br><span class="line">VERSION:</span><br><span class="line">   0.1.40</span><br><span class="line">COMMANDS:</span><br><span class="line">     copy               Copy an IMAGE-NAME from one location to another</span><br><span class="line">     inspect            Inspect image IMAGE-NAME</span><br><span class="line">     delete             Delete image IMAGE-NAME</span><br><span class="line">     manifest-digest    Compute a manifest digest of a file</span><br><span class="line">     standalone-sign    Create a signature using local files</span><br><span class="line">     standalone-verify  Verify a signature using local files</span><br><span class="line">     help, h            Shows a list of commands or help for one command</span><br></pre></td></tr></table></figure><p>çœŸæ˜¯ä¸€æ³¢ä¸‰æŠ˜å•Šï¼Œç»•äº†ä¸€åœˆæœ€ç»ˆè¿˜æ˜¯äº²è‡ª<del>æŒ‡æŒ¥</del> build ä¸€ä»½å§ï¼Œä¸è¿‡è¿™ä¸ª build è¿‡ç¨‹ä¹Ÿå¾ˆç®€å•ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/containers/skopeo skopeo</span><br><span class="line">cd !$</span><br><span class="line">git checkout v1.0.0</span><br><span class="line">make binary-static DISABLE_CGO=1</span><br><span class="line">cp skopeo /usr/bin/</span><br></pre></td></tr></table></figure><ul><li>åœ¨è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœæ±æƒ³æ„å»ºä¸€ä¸ªåœ¨å„ Linux å‘è¡Œç‰ˆé€šç”¨çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸€å®šè¦ä½¿ç”¨ <code>make binary-static DISABLE_CGO=1</code> ï¼Œä¹‹å‰æˆ‘æ²¡æœ‰ä»”ç»†çœ‹æ–‡æ¡£ç›´æ¥ make ä¸€æŠŠæ¢­ï¼Œç„¶ååœ¨ Ubuntu ä¸Šæ„å»ºå‡ºæ¥çš„äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶æ‹¿åˆ° CentOS ä¸Šå»ç”¨ï¼Œå½“åœºç¿»è½¦æç¤ºä»¥ä¸‹é”™è¯¯ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">skopeo: error while loading shared libraries: libdevmapper.so.1.02.1: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure><ul><li>ç„¶åæˆ‘å‚»ä¹ä¹åœ°å»å®‰è£… CentOS ä¸Šçš„è¿™ä¸ªåº“ï¼Œä½†è¿˜æ˜¯æç¤º <code>libdevmapper.so.1.02.1</code> ä¸å­˜åœ¨ã€‚å› ä¸º Ubuntu ä¸Šçš„è¿™ä¸ªåº“å’Œ CentOS ä¸Šçš„è¿™ä¸ªåº“æ˜¯ä¸ä¸€æ ·åç§°çš„ğŸ˜‘ã€‚æ‰€ä»¥è¯´è¦åœ¨ç¼–è¯‘çš„æ—¶å€™åŠ ä¸Š <code>DISABLE_CGO=1</code> è¿™ä¸ªå‚æ•°è¿›è¡Œé™æ€é“¾æ¥ç¼–è¯‘ï¼Œè¿™æ ·ç¼–è¯‘å‡ºæ¥çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶å°±å¯ä»¥åœ¨ Linux å‘è¡Œç‰ˆä¹‹é—´é€šç”¨äº†ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ldd skopeo_d #</span><br><span class="line">        linux-vdso.so.1 (0x00007ffed9e66000)</span><br><span class="line">        libgpgme.so.11 =&gt; /usr/lib/x86_64-linux-gnu/libgpgme.so.11 (0x00007f94aed2e000)</span><br><span class="line">        libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f94aeb0f000)</span><br><span class="line">        libdevmapper.so.1.02.1 =&gt; /lib/x86_64-linux-gnu/libdevmapper.so.1.02.1 (0x00007f94ae8a4000)</span><br><span class="line">        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f94ae4b3000)</span><br><span class="line">        libassuan.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libassuan.so.0 (0x00007f94ae2a0000)</span><br><span class="line">        libgpg-error.so.0 =&gt; /lib/x86_64-linux-gnu/libgpg-error.so.0 (0x00007f94ae08b000)</span><br><span class="line">        /lib64/ld-linux-x86-64.so.2 (0x00007f94b0ac4000)</span><br><span class="line">        libselinux.so.1 =&gt; /lib/x86_64-linux-gnu/libselinux.so.1 (0x00007f94ade63000)</span><br><span class="line">        libudev.so.1 =&gt; /lib/x86_64-linux-gnu/libudev.so.1 (0x00007f94adc45000)</span><br><span class="line">        libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007f94ad8a7000)</span><br><span class="line">        libpcre.so.3 =&gt; /lib/x86_64-linux-gnu/libpcre.so.3 (0x00007f94ad635000)</span><br><span class="line">        libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f94ad431000)</span><br><span class="line">        librt.so.1 =&gt; /lib/x86_64-linux-gnu/librt.so.1 (0x00007f94ad229000)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åŠ ä¸Š DISABLE_CGO=1 ç¼–è¯‘åçš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶</span></span><br><span class="line">ldd skopeo_s #</span><br><span class="line">        not a dynamic executable</span><br></pre></td></tr></table></figure><h2 id="usage"><a href="#usage" class="headerlink" title="usage"></a>usage</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Various operations with container images and container image registries</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  skopeo [command]</span><br><span class="line"></span><br><span class="line">Available Commands:</span><br><span class="line">  copy                      Copy an IMAGE-NAME from one location to another</span><br><span class="line">  delete                    Delete image IMAGE-NAME</span><br><span class="line">  help                      Help about any command</span><br><span class="line">  inspect                   Inspect image IMAGE-NAME</span><br><span class="line">  list-tags                 List tags in the transport/repository specified by the</span><br><span class="line">  login                     Login to a container registry</span><br><span class="line">  logout                    Logout of a container registry</span><br><span class="line">  manifest-digest           Compute a manifest digest of a file</span><br><span class="line">  standalone-sign           Create a signature using local files</span><br><span class="line">  standalone-verify         Verify a signature using local files</span><br><span class="line">  sync                      Synchronize one or more images from one location to another</span><br><span class="line"></span><br><span class="line">skopeo version 1.0.0 commit: bd162028cd83ceecd8915736f2d66d5ca73ee54a</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°  skopeo çš„åŠŸèƒ½å¾ˆç®€å•ï¼š</p><ul><li>copyï¼šå¤åˆ¶ä¸€ä¸ªé•œåƒä» A åˆ° Bï¼Œè¿™é‡Œçš„ A å’Œ B å¯ä»¥ä¸ºæœ¬åœ° docker é•œåƒæˆ–è€… registry ä¸Šçš„é•œåƒã€‚</li><li>inspectï¼šæŸ¥çœ‹ä¸€ä¸ªé•œåƒçš„ manifest ç«è½¦ image config è¯¦ç»†ä¿¡æ¯</li><li>deleteï¼šåˆ é™¤ä¸€ä¸ªé•œåƒï¼Œå¯ä»¥æ˜¯æœ¬åœ° docker é•œåƒæˆ–è€… registry ä¸Šçš„é•œåƒ</li><li>list-tagsï¼šåˆ—å‡ºä¸€ä¸ª registry ä¸ŠæŸä¸ªé•œåƒçš„æ‰€æœ‰ tag</li><li>loginï¼šç™»å½•åˆ°æŸä¸ª registryï¼Œå’Œ docker login ç±»ä¼¼</li><li>logoutï¼š é€€å‡ºå·²ç»ç™»å½•åˆ°æŸä¸ª registry çš„ auth ä¿¡æ¯ï¼Œå’Œ docker logout ç±»ä¼¼</li><li>manifest-digestã€standalone-signã€standalone-verify è¿™ä¸‰ä¸ªç”¨çš„ä¸å¤š</li><li>syncï¼šåŒæ­¥ä¸€ä¸ªé•œåƒä» A åˆ°  Bï¼Œæ„Ÿè§‰å’Œ copy ä¸€æ ·ï¼Œä½† sync æ”¯æŒçš„å‚æ•°æ›´å¤šï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ã€‚åœ¨ 0.14.0 ç‰ˆæœ¬çš„æ—¶å€™æ˜¯æ²¡æœ‰ sync é€‰é¡¹çš„ï¼Œåˆ°äº† 0.14.2 æ‰æœ‰ï¼Œç°åœ¨æ˜¯ 1.0.0</li></ul><h3 id="IMAGE-NAMES"><a href="#IMAGE-NAMES" class="headerlink" title="IMAGE NAMES"></a>IMAGE NAMES</h3><p>åœ¨ä½¿ç”¨ skopeo ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“åœ¨å‘½ä»¤è¡Œä¸­é•œåƒçš„æ ¼å¼ï¼Œä¸‹é¢æ˜¯å®˜æ–¹è¯¦ç»†çš„æ–‡æ¡£æ ¼å¼ã€‚æ— è®ºæˆ‘ä»¬çš„ src é•œåƒè¿˜æ˜¯ desc é•œåƒéƒ½è¦æ»¡è¶³ä»¥ä¸‹æ ¼å¼æ‰å¯ä»¥ã€‚</p><blockquote><p>  Most commands refer to container images, using a <em>transport<em><code>:</code></em>details</em> format. The following formats are supported:</p><p>  <strong>containers-storage:*</strong>docker-reference* An image located in a local containers/storage image store. Both the location and image store are specified in /etc/containers/storage.conf. (Backend for Podman, CRI-O, Buildah and friends)</p><p>  <strong>dir:*</strong>path* An existing local directory <em>path</em> storing the manifest, layer tarballs and signatures as individual files. This is a non-standardized format, primarily useful for debugging or noninvasive container inspection.</p><p>  <strong>docker://*</strong>docker-reference* An image in a registry implementing the â€œDocker Registry HTTP API V2â€. By default, uses the authorization state in either <code>$XDG_RUNTIME_DIR/containers/auth.json</code>, which is set using <code>(skopeo login)</code>. If the authorization state is not found there, <code>$HOME/.docker/config.json</code> is checked, which is set using <code>(docker login)</code>.</p><p>  <strong>docker-archive:*</strong>path<em>[<strong>:*</strong>docker-reference*] An image is stored in the <code>docker save</code> formatted file. *docker-reference</em> is only used when creating such a file, and it must not contain a digest.</p><p>  <strong>docker-daemon:*</strong>docker-reference* An image <em>docker-reference</em> stored in the docker daemon internal storage. <em>docker-reference</em> must contain either a tag or a digest. Alternatively, when reading images, the format can be docker-daemon:algo:digest (an image ID).</p><p>  <strong>oci:*</strong>path<strong><em>:</em></strong>tag* An image <em>tag</em> in a directory compliant with â€œOpen Container Image Layout Specificationâ€ at <em>path</em>.</p></blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™å‡ ç§é•œåƒçš„åå­—ï¼Œå¯¹åº”ç€é•œåƒå­˜åœ¨çš„æ–¹å¼ï¼Œä¸åŒå­˜åœ¨çš„æ–¹å¼å¯¹é•œåƒçš„ layer å¤„ç†çš„æ–¹å¼ä¹Ÿä¸ä¸€æ ·ï¼Œæ¯”å¦‚ <code>docker://</code> è¿™ç§æ–¹å¼æ˜¯å­˜åœ¨ registry ä¸Šçš„ï¼Œ<code>docker-daemon:</code> æ˜¯å­˜åœ¨æœ¬åœ° docker pull ä¸‹æ¥çš„ï¼Œå†æ¯”å¦‚ <code>docker-archive</code> æ˜¯é€šè¿‡ docker save å‡ºæ¥çš„é•œåƒã€‚åŒä¸€ä¸ªé•œåƒæœ‰è¿™å‡ ç§å­˜åœ¨çš„æ–¹å¼å°±åƒæ°´æœ‰æ°”ä½“ã€æ¶²ä½“ã€å›ºä½“ä¸€æ ·ã€‚å¯ä»¥è¿™æ ·å»ç†è§£ï¼Œä»–ä»¬è¡¨è¿°çš„éƒ½æ˜¯åŒä¸€ä¸ªé•œåƒï¼Œåªä¸è¿‡æ˜¯å­˜åœ¨çš„æ–¹å¼ä¸ä¸€æ ·è€Œå·²ã€‚</p><table><thead><tr><th>IMAGE NAMES</th><th>example</th></tr></thead><tbody><tr><td><strong>containers-storage:</strong></td><td>containers-storage:</td></tr><tr><td><strong>dir:</strong></td><td>dir:/PATH</td></tr><tr><td><strong>docker://</strong></td><td>docker://k8s.gcr.io/kube-apiserver:v1.17.5</td></tr><tr><td><strong>docker-daemon:</strong></td><td>docker-daemon:alpine:latest</td></tr><tr><td><strong>docker-archive:</strong></td><td>docker-archive:alpine.tar (docker save)</td></tr><tr><td><strong>oci:</strong></td><td>oci:alpine:latest</td></tr></tbody></table><h3 id="skopeo-copy"><a href="#skopeo-copy" class="headerlink" title="skopeo copy"></a>skopeo copy</h3><blockquote><p>  Copy an IMAGE-NAME from one location to another </p></blockquote><p>æ³¨æ„ä¸€ä¸‹ï¼Œè¿™é‡Œçš„ location å°±æ˜¯æŒ‡çš„ä¸Šé¢æåˆ°çš„ <code>IMAGE NAMES</code> ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>skopeo copy src dest</code> å¯ä»¥æœ‰6*6=36 ç§ç»„åˆï¼æ¯”å¦‚æˆ‘å¯ä»¥å°†ä¸€ä¸ªé•œåƒä»ä¸€ä¸ª registry å¤åˆ¶åˆ°å¦ä¸€ä¸ª registryï¼Œ<code>skopeo copy docker://IMAGE_NAME docker://IMAGE_NAME</code>ï¼Œå†å¼ºè°ƒä¸€éï¼Œä¸€å®šè¦æ³¨æ„ <code>IMAGE_NAME</code> çš„å‘½åçš„æ ¼å¼ã€‚</p><p>skopeo çš„è¯¦ç»†ä½¿ç”¨å¯ä»¥å‚è€ƒå®˜æ–¹çš„æ–‡æ¡£ï¼Œåœ¨ä½¿ç”¨ä¹‹å‰å…ˆåˆ›å»ºä¸€ä¸ª</p><p>åœ¨ä½¿ç”¨ skopeo ä¹‹å‰å¦‚æœé•œåƒæ˜¯å­˜æ”¾åœ¨ registry ä¸Šçš„è¯ï¼Œéœ€è¦å…ˆç™»å½•åˆ° registryã€‚ä½¿ç”¨ skopeo login æˆ–è€…  docker login éƒ½å¯ä»¥ã€‚æˆåŠŸç™»å½•ä¹‹åä¼šåœ¨æœ¬åœ°ä¿å­˜ä¸€ä¸ªä¸º config.json çš„æ–‡ä»¶ï¼Œé‡Œé¢ä¿å­˜äº†ç™»å½•éœ€è¦çš„éªŒè¯ä¿¡æ¯ï¼Œskopeo æ‹¿åˆ°è¿™ä¸ªéªŒè¯ä¿¡æ¯æ‰æœ‰æƒé™å¾€ registry push é•œåƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu/skopeo â€¹master*â€º</span><br><span class="line">â•°â”€# jq "." ~/.docker/config.json                                                             </span><br><span class="line">&#123;</span><br><span class="line">  "auths": &#123;</span><br><span class="line">    "https://index.docker.io/v1/": &#123;</span><br><span class="line">      "auth": "d2sddaqWM7bSVlJFpmQE43Sw=="</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  "HttpHeaders": &#123;</span><br><span class="line">    "User-Agent": "Docker-Client/19.03.5 (linux)"</span><br><span class="line">  &#125;,</span><br><span class="line">  "experimental": "enabled"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä» <code>k8s.gcr.io/kube-apiserver:v1.17.5</code> å¤åˆ¶é•œåƒåˆ° <code>index.docker.io/webpsh/kube-apiserver:v1.17.5</code> </li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~/skopeo â€¹masterâ€º</span><br><span class="line">â•°â”€# skopeo copy docker://k8s.gcr.io/kube-apiserver:v1.17.5 docker://index.docker.io/webpsh/kube-apiserver:v1.17.5 --dest-authfile /root/.docker/config.json</span><br><span class="line">Getting image source signatures</span><br><span class="line">Copying blob 597de8ba0c30 done</span><br><span class="line">Copying blob e13a88fa950c done</span><br><span class="line">Copying config f640481f6d done</span><br><span class="line">Writing manifest to image destination</span><br><span class="line">Storing signatures</span><br></pre></td></tr></table></figure><ul><li>skopeo è¾“å‡ºçš„æ—¥å¿—æ˜¾ç¤ºæ˜¯ <code>Copying blob 597de8ba0c30 done</code> ï¼Œå¯ä»¥çœ‹åˆ° skopeo æ˜¯ç›´æ¥ copy é•œåƒ layer çš„ blobï¼Œè€Œ blob æ˜¯åœ¨ registry è¿›è¡Œå‹ç¼©å­˜å‚¨çš„æ ¼å¼ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ç„¶åä»é‡æ–° pul ä¸‹æ¥åˆšåˆš push åˆ° docker hub ä¸Šçš„é•œåƒï¼ŒéªŒè¯æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">â•­â”€root@sg-02 ~/skopeo â€¹masterâ€º</span><br><span class="line">â•°â”€# docker pull webpsh/kube-apiserver:v1.17.5</span><br><span class="line">v1.17.5: Pulling from webpsh/kube-apiserver</span><br><span class="line">Digest: sha256:5ddc5c77f52767f2f225a531a257259228d74b32d8aac9cfe087251f998c42f3</span><br><span class="line">Status: Downloaded newer image for webpsh/kube-apiserver:v1.17.5</span><br><span class="line">docker.io/webpsh/kube-apiserver:v1.17.5</span><br></pre></td></tr></table></figure><ul><li>copy é•œåƒåˆ°æœ¬åœ°</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# skopeo copy docker-daemon:alpine:latest oci:alpine</span><br><span class="line">Getting image source signatures</span><br><span class="line">Copying blob 3e207b409db3 done</span><br><span class="line">Copying config af88fdb253 done</span><br><span class="line">Writing manifest to image destination</span><br><span class="line">Storing signatures</span><br><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# tree -h alpine</span><br><span class="line">alpine</span><br><span class="line">â”œâ”€â”€ [4.0K]  blobs</span><br><span class="line">â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [ 348]  1c6f747c933450c5169f349f2a57b9d31e833c0452e1ec712b8aab0cbfea4d2c</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [2.8M]  3eee30c545e47333e6fe551863f6f29c3dcd850187ae3f37c606adb991444886</span><br><span class="line">â”‚Â Â      â””â”€â”€ [ 583]  af88fdb253aac46693de7883c9c55244327908c77248d7654841503f744aae8b</span><br><span class="line">â”œâ”€â”€ [ 186]  index.json</span><br><span class="line">â””â”€â”€ [  31]  oci-layout</span><br></pre></td></tr></table></figure><p>æœ‰ç‚¹å¥½å¥‡è¿™ä¸ªé•œåƒæ ¼å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ copy å‡ºæ¥çš„é•œåƒï¼Œå¯ä»¥çœ‹åˆ°åœ¨å¯¼å‡ºæ¥çš„.</p><p>è¿™ä¸ªåº”è¯¥æ˜¯é•œåƒçš„ mainfaet æ–‡ä»¶</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu/alpine/blobs/sha256</span><br><span class="line">â•°â”€# jq "." 1c6f747c933450c5169f349f2a57b9d31e833c0452e1ec712b8aab0cbfea4d2c</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">"config"</span>: &#123;</span><br><span class="line">    <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.oci.image.config.v1+json"</span>,</span><br><span class="line">    <span class="attr">"digest"</span>: <span class="string">"sha256:af88fdb253aac46693de7883c9c55244327908c77248d7654841503f744aae8b"</span>,</span><br><span class="line">    <span class="attr">"size"</span>: <span class="number">583</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"layers"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.oci.image.layer.v1.tar+gzip"</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:3eee30c545e47333e6fe551863f6f29c3dcd850187ae3f37c606adb991444886"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">2898973</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™ä¸ªå°±æ˜¯é•œåƒçš„ image config æ–‡ä»¶</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu/alpine/blobs/sha256</span><br><span class="line">â•°â”€# jq "." af88fdb253aac46693de7883c9c55244327908c77248d7654841503f744aae8b</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"created"</span>: <span class="string">"2020-04-24T01:05:03.92860976Z"</span>,</span><br><span class="line">  <span class="attr">"architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">  <span class="attr">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">  <span class="attr">"config"</span>: &#123;</span><br><span class="line">    <span class="attr">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"/bin/sh"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"rootfs"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"layers"</span>,</span><br><span class="line">    <span class="attr">"diff_ids"</span>: [</span><br><span class="line">      <span class="string">"sha256:3e207b409db364b595ba862cdc12be96dcdad8e36c59a03b7b3b61c946a5741a"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"history"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-04-24T01:05:03.608058404Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop) ADD file:b91adb67b670d3a6ff9463e48b7def903ed516be66fc4282d22c53e41512be49 in / "</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"created"</span>: <span class="string">"2020-04-24T01:05:03.92860976Z"</span>,</span><br><span class="line">      <span class="attr">"created_by"</span>: <span class="string">"/bin/sh -c #(nop)  CMD [\"/bin/sh\"]"</span>,</span><br><span class="line">      <span class="attr">"empty_layer"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="skopeo-inspect"><a href="#skopeo-inspect" class="headerlink" title="skopeo inspect"></a>skopeo inspect</h3><p>è¿™ä¸ªå‘½ä»¤å¯ä»¥æŸ¥çœ‹ä¸€ä¸ªé•œåƒçš„ image config å’Œ mainf æ–‡ä»¶ï¼Œå’Œ docker inspect å‘½ä»¤å·®ä¸å¤š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">â•­â”€root@sg-02 /home/ubuntu/alpine/blobs/sha256</span><br><span class="line">â•°â”€# skopeo inspect docker-daemon:alpine:latest --raw | jq "."</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schemaVersion"</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">  <span class="attr">"config"</span>: &#123;</span><br><span class="line">    <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.container.image.v1+json"</span>,</span><br><span class="line">    <span class="attr">"size"</span>: <span class="number">1507</span>,</span><br><span class="line">    <span class="attr">"digest"</span>: <span class="string">"sha256:f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"layers"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">5878784</span>,</span><br><span class="line">      <span class="attr">"digest"</span>: <span class="string">"sha256:3e207b409db364b595ba862cdc12be96dcdad8e36c59a03b7b3b61c946a5741a"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="skopeo-delete"><a href="#skopeo-delete" class="headerlink" title="skopeo delete"></a>skopeo delete</h3><p>ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å¯ä»¥åˆ é™¤é•œåƒï¼Œå¯¹äºåˆ é™¤ registry ä¸Šçš„é•œåƒå¾ˆæœ‰å¸®åŠ©ï¼Œå› ä¸ºç›®å‰æƒ³è¦åˆ é™¤ registry ä¸Šçš„é•œåƒå¸¸è§„çš„åšæ³•è¿˜æ˜¯ç™»å½•åˆ° registry åœ¨ WEB ä¸Šæ‰‹åŠ¨åˆ é™¤ã€‚skopeo delete ä¹Ÿæ˜¯è°ƒç”¨ registry çš„ API æ¥è¿›è¡Œåˆ é™¤é•œåƒã€‚</p><h3 id="skopeo-list-tags"><a href="#skopeo-list-tags" class="headerlink" title="skopeo list-tags"></a>skopeo list-tags</h3><p>è¿™ä¸ªå‘½ä»¤å¸¸ç”¨æ¥åˆ—å‡º registry ä¸Šçš„æŸä¸ªé•œåƒçš„æ‰€æœ‰ tag ï¼Œåœ¨ä¸€äº› shell è„šæœ¬ä¸­å¯èƒ½ä¼šåˆç”¨å¾—åˆ°ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;æ¬ç –å·¥å…·&quot;&gt;&lt;a href=&quot;#æ¬ç –å·¥å…·&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="docker" scheme="https://blog.k8s.li/tags/docker/"/>
    
      <category term="registry" scheme="https://blog.k8s.li/tags/registry/"/>
    
      <category term="é•œåƒ" scheme="https://blog.k8s.li/tags/%E9%95%9C%E5%83%8F/"/>
    
      <category term="æ¬ç –å·¥å…·" scheme="https://blog.k8s.li/tags/%E6%90%AC%E7%A0%96%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>æœ¨å­çš„æ¬ç –å·¥å…·ğŸ˜‚</title>
    <link href="https://blog.k8s.li/My-brick-lifting-tools.html"/>
    <id>https://blog.k8s.li/My-brick-lifting-tools.html</id>
    <published>2020-05-21T16:00:00.000Z</published>
    <updated>2020-06-18T14:28:38.129Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å’•å’•å’•"><a href="#å’•å’•å’•" class="headerlink" title="å’•å’•å’•"></a>å’•å’•å’•</h2><p>æœ¬æ¥æ‰“ç®—ä¸Šä¸Šå‘¨å°±è¯¥æ›´æ–°å®Œçš„è¿™ç¯‡åšæ–‡ï¼Œä½†æœ€è¿‘å› ä¸ºç¦»èŒçš„äº‹å®œæ‹–åˆ°ä»Šå¤©æ™šä¸Šæ‰æ¡èµ·æ¥ï¼Œæœ€ç»ˆè¿˜æ˜¯å’•å’•å’•äº†ğŸ˜‚ã€‚è™½ç„¶æ–‡ç« è¿˜æœªè¡¥å……å®Œï¼Œç­‰åˆ°ä»¥åå†ç»§ç»­æ›´æ–°ä¸Šå§ã€‚</p><h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><p>ç¡®åˆ‡åœ°æ¥è®² Linux ä»…ä»…æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„å†…æ ¸ï¼Œè€Œä¸”å®ƒçš„ä»£ç åœ¨ä¸€ä¸ªå‘è¡Œç‰ˆä¸­çš„å ç”¨ç‡ä¹Ÿä¸åˆ° 20%ã€‚</p><h3 id="å…¥é—¨"><a href="#å…¥é—¨" class="headerlink" title="å…¥é—¨"></a>å…¥é—¨</h3><p>å’±ä¸€ç›´è§‰ç€å­¦ä¹ æŠ€æœ¯å§ï¼Œå¹¶ä¸æ˜¯çœ‹ä¹¦çœ‹è§†é¢‘èƒ½å­¦ä¼šçš„ã€‚å¯¹äºä¸€äº›åº•å±‚çš„åªæ˜¯ç¡®å®éœ€è¦ä»”ç»†ç ”è¯»ä¹¦ç±æ¥åƒé€ä»–ï¼Œè¿™è¶Ÿä¼šè®©æˆ‘ä»¬å¯¹æ“ä½œç³»ç»Ÿè¿™ä¸ªä½“ç³»ç»“æ„æœ‰æ›´ä¸‹é€å½»çš„è®¤è¯†ã€‚ä½†æ˜¯å‘¢ï¼Œå…‰çœ‹ä¸ç»ƒè¿˜æ˜¯ä¸è¡Œæ»´ï¼Œå’±å­¦ä¹  Linux çº¯é çç©ï¼ŒçæŠ˜è…¾ã€‚å’±å¤§å­¦æ—¶å­¦æ ¡æ²¡æœ‰å¼€è®¾ Linux è¯¾ç¨‹ï¼Œåªèƒ½é è‡ªå·±è‡ªå­¦ã€‚äºæ˜¯ä¹ï¼Œå’Œå¤§å®¶ä¸€æ ·ï¼Œæ­å»º WordPress ï¼Œä¸€æ­¥æ­¥å®‰è£… LAMP ç¯å¢ƒï¼Œé…ç½® iptablesï¼Œå†™ shell è„šæœ¬å¤‡ä»½ç½‘ç«™ï¼Œæ­å»ºæ¢¯å­ç­‰ç­‰ã€‚å¯è°“æ˜¯ç©å¾—ä¸äº¦ä¹ä¹ğŸ˜‚ã€‚</p><p>æ‰€ä»¥è¯´å­¦ä¹ å’Œå…¥é—¨ Linux å’±è¿˜æ˜¯æ¨èé¸Ÿå“¥çš„ã€Šé¸Ÿå“¥ Linux ç§æˆ¿èœã€‹è¿™æœ¬ä¹¦ï¼Œç»“åˆç€è‡ªå·±æ­å»ºç½‘ç«™ä¸€æ­¥æ­¥æ¥å°±å¯ä»¥ã€‚</p><h3 id="æ”¾å¼ƒ"><a href="#æ”¾å¼ƒ" class="headerlink" title="æ”¾å¼ƒ"></a>æ”¾å¼ƒ</h3><p>å…¥é—¨å®Œ Linux ä¹‹åå°±å¼€å§‹æŒ‘æˆ˜é«˜éš¾åº¦çš„å•¦ï¼Œæ¯”å¦‚ï¼š</p><ul><li>OpenStack</li><li>Docker</li><li>Kubernetes</li><li>CI/CD</li></ul><p>ç›®å‰æ¥è®²åœ¨è¿ç»´è¿™ä¸ªæ¬ç –è¡Œä¸šï¼Œkubernetes äº‘åŸç”Ÿæ— ç–‘æ˜¯æœ€å…·æœ‰æŒ‘æˆ˜æ€§å’Œå‰æ™¯çš„ï¼Œæ‰€ä»¥å¦‚æœæ±æƒ³æ›´è¿‘ä¸€å±‚æ¥¼å°±ä¸å¦¨å­¦ä¹ ä¸€ä¸‹ Docker å’Œ Kuberneets è¿™ä¸€å—ã€‚</p><h3 id="å‘è¡Œç‰ˆ"><a href="#å‘è¡Œç‰ˆ" class="headerlink" title="å‘è¡Œç‰ˆ"></a>å‘è¡Œç‰ˆ</h3><p>ä»è¿ç»´è¿™ä¸ªæ¬ç –è¡Œä¸šæ¥è®²ï¼Œä¼ä¸šå†…éƒ¨ä½¿ç”¨çš„ Linux å‘è¡Œç‰ˆå½“å± RedHat å’Œ Debian å®¶æ—çš„æœ€å¤šï¼Œåƒå…¶ä»–çš„ä»€ä¹ˆ archlinux å’±è¿˜çœŸæ²¡è§è¿‡æœ‰åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„ï¼Œæ¯•ç«Ÿæ»šåŠ¨æ›´æ–°ä¸å°å¿ƒå°±æ»šæŒ‚äº†ä¸å¥½è¯´ğŸ˜‚ã€‚å›½å†…ä¼ä¸šå’Œäº‘è®¡ç®—å‚å•†ä½¿ç”¨æœ€å¤šçš„å½“ç„¶æ˜¯ CentOS å•¦ï¼Œæˆ‘è®°å¾—æ˜¯åœ¨ 2018 å¹´å¹´æœ«çš„æ—¶å€™é˜¿é‡Œäº‘/è…¾è®¯äº‘è¿˜æ²¡æœ‰ Ubuntu 1804 çš„äº‘ä¸»æœºå¯ç”¨ğŸ˜‘ã€‚å›½å¤–ä½¿ç”¨ Ubuntu çš„è¾ƒå¤šä¸€äº›ï¼Œå’±æ˜¯å€¾å‘äºä½¿ç”¨ Ubuntu ğŸ˜</p><p>ä» <a href="https://www.datanyze.com" target="_blank" rel="noopener">datanyze</a> å®¶å·æ¥ä¸€å¼ ä¼ä¸š Linux å¸‚åœºå æœ‰ç‡çš„ç»Ÿè®¡è¡¨æ ¼ <a href="https://www.datanyze.com/market-share/operating-systems--443" target="_blank" rel="noopener">Operating Systems</a>ğŸ˜‚</p><table><thead><tr><th align="center">Ranking</th><th align="left">Technology</th><th align="right">Domains</th><th align="right">Market Share</th></tr></thead><tbody><tr><td align="center">1</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/ubuntu-market-share" target="_blank" rel="noopener">Ubuntu</a></td><td align="right">278,611</td><td align="right">29.30%</td></tr><tr><td align="center">2</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/unix-market-share" target="_blank" rel="noopener">Unix</a></td><td align="right">192,215</td><td align="right">20.21%</td></tr><tr><td align="center">3</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/centos-market-share" target="_blank" rel="noopener">CentOS</a></td><td align="right">165,640</td><td align="right">17.42%</td></tr><tr><td align="center">4</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/debian-market-share" target="_blank" rel="noopener">Debian</a></td><td align="right">108,373</td><td align="right">11.40%</td></tr><tr><td align="center">5</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-market-share" target="_blank" rel="noopener">Linux</a></td><td align="right">24,563</td><td align="right">2.58%</td></tr><tr><td align="center">6</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/windows-server-market-share" target="_blank" rel="noopener">Windows Server</a></td><td align="right">23,872</td><td align="right">2.51%</td></tr><tr><td align="center">7</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/gentoo-market-share" target="_blank" rel="noopener">Gentoo</a></td><td align="right">16,756</td><td align="right">1.76%</td></tr><tr><td align="center">8</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/red-hat-enterprise-linux-market-share" target="_blank" rel="noopener">Red Hat Enterprise Linux</a></td><td align="right">13,659</td><td align="right">1.44%</td></tr><tr><td align="center">9</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/windows-7-market-share" target="_blank" rel="noopener">Windows 7</a></td><td align="right">11,843</td><td align="right">1.25%</td></tr><tr><td align="center">10</td><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/microsoft-windows-os-market-share" target="_blank" rel="noopener">Microsoft Windows OS</a></td><td align="right">10,986</td><td align="right">1.16%</td></tr></tbody></table><table><thead><tr><th align="left">op Competitors</th><th align="right">Websites</th><th align="right">Market Share</th><th align="right">Versus Page</th></tr></thead><tbody><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/ubuntu-market-share" target="_blank" rel="noopener">Ubuntu</a></td><td align="right">278,611</td><td align="right">29.30%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-ubuntu" target="_blank" rel="noopener">Linux vs. Ubuntu</a></td></tr><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/unix-market-share" target="_blank" rel="noopener">Unix</a></td><td align="right">192,215</td><td align="right">20.21%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-unix" target="_blank" rel="noopener">Linux vs. Unix</a></td></tr><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/centos-market-share" target="_blank" rel="noopener">CentOS</a></td><td align="right">165,640</td><td align="right">17.42%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-centos" target="_blank" rel="noopener">Linux vs. CentOS</a></td></tr><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/debian-market-share" target="_blank" rel="noopener">Debian</a></td><td align="right">108,373</td><td align="right">11.40%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-debian" target="_blank" rel="noopener">Linux vs. Debian</a></td></tr><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/windows-server-market-share" target="_blank" rel="noopener">Windows Server</a></td><td align="right">23,872</td><td align="right">2.51%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-windows-server" target="_blank" rel="noopener">Linux vs. Windows Server</a></td></tr><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/gentoo-market-share" target="_blank" rel="noopener">Gentoo</a></td><td align="right">16,756</td><td align="right">1.76%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-gentoo" target="_blank" rel="noopener">Linux vs. Gentoo</a></td></tr><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/red-hat-enterprise-linux-market-share" target="_blank" rel="noopener">Red Hat Enterprise Linux</a></td><td align="right">13,659</td><td align="right">1.44%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-red-hat-enterprise-linux" target="_blank" rel="noopener">Linux vs. Red Hat Enterprise Linux</a></td></tr><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/windows-7-market-share" target="_blank" rel="noopener">Windows 7</a></td><td align="right">11,843</td><td align="right">1.25%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-windows-7" target="_blank" rel="noopener">Linux vs. Windows 7</a></td></tr><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/microsoft-windows-os-market-share" target="_blank" rel="noopener">Microsoft Windows OS</a></td><td align="right">10,986</td><td align="right">1.16%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-microsoft-windows-os" target="_blank" rel="noopener">Linux vs. Microsoft Windows OS</a></td></tr><tr><td align="left"><a href="https://www.datanyze.com/market-share/operating-systems--443/freebsd-market-share" target="_blank" rel="noopener">FreeBSD</a></td><td align="right">9,633</td><td align="right">1.01%</td><td align="right"><a href="https://www.datanyze.com/market-share/operating-systems--443/linux-vs-freebsd" target="_blank" rel="noopener">Linux vs. FreeBSD</a></td></tr></tbody></table><h4 id="RedHat-CentOS"><a href="#RedHat-CentOS" class="headerlink" title="RedHat/CentOS"></a>RedHat/CentOS</h4><h4 id="Debian-Ubuntu"><a href="#Debian-Ubuntu" class="headerlink" title="Debian/Ubuntu"></a>Debian/Ubuntu</h4><p>å’±çš„ VPS æ¸…ä¸€è‰² Ubuntu 1804 ï¼Œä¸»è¦æ˜¯çœäº‹å„¿ã€‚</p><h2 id="å‘½ä»¤è¡Œå·¥å…·"><a href="#å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="å‘½ä»¤è¡Œå·¥å…·"></a>å‘½ä»¤è¡Œå·¥å…·</h2><h3 id="æ–‡æœ¬å¤„ç†"><a href="#æ–‡æœ¬å¤„ç†" class="headerlink" title="æ–‡æœ¬å¤„ç†"></a>æ–‡æœ¬å¤„ç†</h3><p>æåˆ° Linux ä¸Šçš„æ–‡æœ¬å¤„ç†å·¥å…·å½“ç„¶æ˜¯ç¦»ä¸å¼€ä¸‰å‰‘å®¢ï¼ˆawkã€grepã€sedï¼‰ï¼Œè¿™ä¹Ÿæ˜¯å’±å½“åˆè·Ÿç€ã€Šé¸Ÿå“¥ Linux ç§æˆ¿èœã€‹å­¦æ¥çš„ğŸ˜‚ã€‚</p><h4 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h4><h4 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h4><h4 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h4><h4 id="jq"><a href="#jq" class="headerlink" title="jq"></a>jq</h4><h4 id="tr"><a href="#tr" class="headerlink" title="tr"></a>tr</h4><h4 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h4><h4 id="wc"><a href="#wc" class="headerlink" title="wc"></a>wc</h4><h4 id="join"><a href="#join" class="headerlink" title="join"></a>join</h4><h4 id="cut"><a href="#cut" class="headerlink" title="cut"></a>cut</h4><h3 id="ç³»ç»Ÿä¿¡æ¯"><a href="#ç³»ç»Ÿä¿¡æ¯" class="headerlink" title="ç³»ç»Ÿä¿¡æ¯"></a>ç³»ç»Ÿä¿¡æ¯</h3><h4 id="htop"><a href="#htop" class="headerlink" title="htop"></a>htop</h4><p>top é»‘ä¹ä¹çš„é¢œå€¼å¤ªä½äº†ï¼Œå’±è¿˜æ˜¯å–œæ¬¢èŠ±èŠ±ç»¿ç»¿çš„ htop ï¼ˆå¤§é›¾</p><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> RHEL/CentOS</span></span><br><span class="line">yum install htop</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian/Ubuntu</span></span><br><span class="line">apt install htop</span><br></pre></td></tr></table></figure><p><img src="img/image-20200506142544440.png" alt="image-20200506142544440"></p><h3 id="bashtop"><a href="#bashtop" class="headerlink" title="bashtop"></a><a href="https://github.com/aristocratos/bashtop" target="_blank" rel="noopener">bashtop</a></h3><p>bashtop ç›¸æ¯”äº htop æœ‰ç§åŠç‚¸å¤©çš„æ„Ÿè§‰ï¼Œç‚«é…·æ— æ¯”ğŸ˜„</p><ul><li>install</li></ul><p>å®‰è£…èµ·æ¥å¾ˆç®€å•ï¼Œå…¶å®è¿™æ˜¯ä¸€ä¸ª shell å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç›´æ¥ä½¿ç”¨ curl æˆ–è€… wget å‘½ä»¤ä¸‹è½½åˆ°æœ¬åœ°å¹¶èµ‹äºˆ +x æƒé™å³å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://raw.githubusercontent.com/aristocratos/bashtop/master/bashtop -o /usr/bin/bashtop &amp;&amp; chmod +x /usr/bin/bashtop</span><br></pre></td></tr></table></figure><p>å›½å†…ç”¨æˆ·æ¨èä½¿ç”¨ jsdelivr.net çš„ CDN æ¥ä¸‹è½½è¯¥è„šæœ¬ğŸ˜‘ï¼Œï¼ˆfuck GFW by jsdelivrğŸ˜¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://cdn.jsdelivr.net/gh/aristocratos/bashtop/bashtop  -o /usr/bin/bashtop ;chmod +x /usr/bin/bashtop</span><br></pre></td></tr></table></figure><p><img src="img/image-20200506151706148.png" alt="image-20200506151706148"></p><h4 id="pstree"><a href="#pstree" class="headerlink" title="pstree"></a>pstree</h4><p>ä»¥æ ‘çŠ¶å›¾çš„æ–¹å¼å±•ç°è¿›ç¨‹ä¹‹é—´çš„æ´¾ç”Ÿå…³ç³»ï¼Œæ˜¾ç¤ºæ•ˆæœæ¯” ps æ›´ç›´è§‚ä¸€äº›ï¼Œå¯ä»¥å¾ˆæ¸…æ¥šåœ°åˆ†è¾¨å‡ºå­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹ä¹‹é—´çš„å…³ç³»ã€‚å¯ä»¥ç”¨æ¥æ’æŸ¥ä¸€äº›å­¤å„¿è¿›ç¨‹ã€‚</p><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> RHEL/CentOS</span></span><br><span class="line">yum install psmisc</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian/Ubuntu</span></span><br><span class="line">apt install psmisc</span><br></pre></td></tr></table></figure><ul><li>output example</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-node-3 /proc</span><br><span class="line">â•°â”€# pstree</span><br><span class="line">systemdâ”€â”¬â”€agetty</span><br><span class="line">        â”œâ”€auditdâ”€â”€â”€&#123;auditd&#125;</span><br><span class="line">        â”œâ”€containerdâ”€â”¬â”€6*[containerd-shimâ”€â”¬â”€pause]</span><br><span class="line">        â”‚            â”‚                    â””â”€9*[&#123;containerd-shim&#125;]]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€kube-proxyâ”€â”€â”€12*[&#123;kube-proxy&#125;]</span><br><span class="line">        â”‚            â”‚                 â””â”€9*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€4*[containerd-shimâ”€â”¬â”€pause]</span><br><span class="line">        â”‚            â”‚                    â””â”€10*[&#123;containerd-shim&#125;]]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€lvscareâ”€â”€â”€11*[&#123;lvscare&#125;]</span><br><span class="line">        â”‚            â”‚                 â””â”€10*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€agentâ”€â”€â”€10*[&#123;agent&#125;]</span><br><span class="line">        â”‚            â”‚                 â””â”€10*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€runsvdirâ”€â”¬â”€runsvâ”€â”€â”€bird6</span><br><span class="line">        â”‚            â”‚                 â”‚          â”œâ”€runsvâ”€â”€â”€calico-nodeâ”€â”€â”€18*[&#123;calico-node&#125;]</span><br><span class="line">        â”‚            â”‚                 â”‚          â”œâ”€runsvâ”€â”€â”€calico-nodeâ”€â”€â”€15*[&#123;calico-node&#125;]</span><br><span class="line">        â”‚            â”‚                 â”‚          â””â”€runsvâ”€â”€â”€bird</span><br><span class="line">        â”‚            â”‚                 â””â”€12*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€node_exporterâ”€â”€â”€4*[&#123;node_exporter&#125;]</span><br><span class="line">        â”‚            â”‚                 â””â”€10*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€nginx-proxyâ”€â”¬â”€confdâ”€â”€â”€11*[&#123;confd&#125;]</span><br><span class="line">        â”‚            â”‚                 â”‚             â””â”€nginxâ”€â”€â”€nginx</span><br><span class="line">        â”‚            â”‚                 â””â”€9*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€deploy.shâ”€â”€â”€sleep</span><br><span class="line">        â”‚            â”‚                 â””â”€10*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€nginx-ingressâ”€â”¬â”€nginxâ”€â”€â”€4*[nginx]</span><br><span class="line">        â”‚            â”‚                 â”‚               â””â”€14*[&#123;nginx-ingress&#125;]</span><br><span class="line">        â”‚            â”‚                 â””â”€10*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€configmap-reloaâ”€â”€â”€4*[&#123;configmap-reloa&#125;]</span><br><span class="line">        â”‚            â”‚                 â””â”€9*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€bash</span><br><span class="line">        â”‚            â”‚                 â””â”€9*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â”œâ”€containerd-shimâ”€â”¬â”€ruby2.3â”€â”¬â”€ruby2.3â”€â”€â”€4*[&#123;ruby2.3&#125;]</span><br><span class="line">        â”‚            â”‚                 â”‚         â””â”€11*[&#123;ruby2.3&#125;]</span><br><span class="line">        â”‚            â”‚                 â””â”€10*[&#123;containerd-shim&#125;]</span><br><span class="line">        â”‚            â””â”€46*[&#123;containerd&#125;]</span><br><span class="line">        â”œâ”€crond</span><br><span class="line">        â”œâ”€dbus-daemonâ”€â”€â”€&#123;dbus-daemon&#125;</span><br><span class="line">        â”œâ”€dockerdâ”€â”€â”€25*[&#123;dockerd&#125;]</span><br><span class="line">        â”œâ”€gssproxyâ”€â”€â”€5*[&#123;gssproxy&#125;]</span><br><span class="line">        â”œâ”€irqbalance</span><br><span class="line">        â”œâ”€kubeletâ”€â”€â”€26*[&#123;kubelet&#125;]</span><br><span class="line">        â”œâ”€lvmetad</span><br><span class="line">        â”œâ”€polkitdâ”€â”€â”€6*[&#123;polkitd&#125;]</span><br><span class="line">        â”œâ”€rpc.idmapd</span><br><span class="line">        â”œâ”€rpc.mountd</span><br><span class="line">        â”œâ”€rpc.statd</span><br><span class="line">        â”œâ”€rpcbind</span><br><span class="line">        â”œâ”€rsyslogdâ”€â”€â”€2*[&#123;rsyslogd&#125;]</span><br><span class="line">        â”œâ”€sshdâ”€â”€â”€sshdâ”€â”€â”€zshâ”€â”€â”€pstree</span><br><span class="line">        â”œâ”€systemd-journal</span><br><span class="line">        â”œâ”€systemd-logind</span><br><span class="line">        â”œâ”€systemd-udevd</span><br><span class="line">        â””â”€tunedâ”€â”€â”€4*[&#123;tuned&#125;]</span><br></pre></td></tr></table></figure><ul><li><p>å¯ä»¥çœ‹åˆ° init è¿›ç¨‹ systemd ä¸ºç³»ç»Ÿçš„ PID 1 å·è¿›ç¨‹ï¼Œæ‰€æœ‰çš„è¿›ç¨‹éƒ½åœ¨ systemd çš„ç®¡ç†ä¹‹ä¸‹ã€‚</p></li><li><p>åœ¨è¿è¡Œ docker çš„æœåŠ¡å™¨ä¸Šï¼Œå®¹å™¨è¿›ç¨‹çš„çˆ¶è¿›ç¨‹å¹¶ä¸æ˜¯ dockerd è¿™ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œè€Œæ˜¯ä¸€ä¸ªåä¸ºã€€<code>containerd-shim-${container_name}</code>ã€€è€Œ containerd-shim çš„çˆ¶è¿›ç¨‹ä¸ºå®¹å™¨è¿è¡Œæ—¶ <a href="https://containerd.io/" target="_blank" rel="noopener">containerd</a>ï¼Œdocker æ˜¯é€šè¿‡ gRPC åè®®ä¸ containerd è¿›ç¨‹é€šä¿¡æ¥ï¼Œä»¥æ­¤æ¥è¿›è¡Œç®¡ç†æ‰€è¿è¡Œçš„å®¹å™¨ã€‚å…³äºå®¹å™¨è¿è¡Œæ—¶çš„å…³ç³»å¯ä»¥å‚è€ƒ <a href="https://xuanwo.io/2019/08/06/oci-intro/" target="_blank" rel="noopener">å¼€æ”¾å®¹å™¨æ ‡å‡†(OCI) å†…éƒ¨åˆ†äº«</a>ï¼Œå½“æ—¶ç†è§£ dockerd ã€containerdã€containerd-shim è¿™äº›å…³ç³»æ—¶æ„Ÿè§‰æœ‰ç‚¹ç»•ï¼Œä¸è¿‡ç”¨ pstree å‘½ä»¤çœ‹ä¸€ä¸‹è¿›ç¨‹æ ‘ç»“æ„å°±ä¸€ç›®äº†ç„¶äº†ğŸ˜‚ï¼Œå¯¹ç†è§£è¿›ç¨‹ä¹‹é—´çš„å…³ç³»å¾ˆæœ‰å¸®åŠ©ã€‚</p></li></ul><h4 id="ncdu"><a href="#ncdu" class="headerlink" title="ncdu"></a>ncdu</h4><p>é¢è¯•çš„æ—¶å€™è¢«é—®é“è¿‡ <code>Linux ä¸‹å¦‚ä½•æŸ¥çœ‹æ–‡ä»¶è§å¤§å°ï¼Ÿ</code>ï¼Œå½“ç„¶æ˜¯ <code>du -sh</code> å•¦ğŸ˜‚ã€‚ä¸è¿‡å’±è¿˜æ˜¯å–œæ¬¢ç”¨ ncdu</p><p>ä½¿ç”¨ <code>ncdu</code> çš„å¥½å¤„å°±æ˜¯å¯ä»¥é€šè¿‡äº¤äº’å¼çš„æ–¹å¼æŸ¥çœ‹ç›®å½•å ç”¨ç©ºé—´çš„å¤§å°ï¼Œè¦æ¯” <code>du -sh</code> å‘½ä»¤æ–¹ä¾¿å¾ˆå¤šï¼Œä¸è¿‡ç¼ºç‚¹ä¹Ÿæœ‰ï¼Œå°±æ˜¯è¯¥å‘½ä»¤ä¸ºæ‰«æç›®æ ‡ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¾ˆè€—æ—¶ï¼å¦‚æœæƒ³è¦ç«‹å³æŸ¥çœ‹ä¸€ä¸‹ç›®å½•å ç”¨çš„å¤§å°ï¼Œè¿˜æ˜¯ç”¨ <code>du -sh</code> æœ€æ–¹ä¾¿ï¼Œä½¿ç”¨ ncdu å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ†ææ–‡ä»¶å¤¹ä¸‹å„ä¸ªæ–‡ä»¶å ç”¨çš„æƒ…å†µã€‚</p><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> RHEL/CentOS</span></span><br><span class="line">yum install ncdu</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian/Ubuntu</span></span><br><span class="line">apt install ncdu</span><br></pre></td></tr></table></figure><ul><li>output example</li></ul><p>ä½¿ç”¨åå‘é”®å’Œå›è½¦é”®è¿›è¡Œç›®å½•å¥‡å¹»ï¼Œå¾ˆæ–¹ä¾¿çš„è¯´ğŸ˜‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">ncdu 1.13 ~ Use the arrow keys to navigate, press ? for help</span><br><span class="line">--- / ------------</span><br><span class="line">    5.2 GiB [##########] /var</span><br><span class="line">    2.2 GiB [####      ] /opt</span><br><span class="line">    2.0 GiB [###       ] /usr</span><br><span class="line">  363.6 MiB [          ] /root</span><br><span class="line">45.8 MiB [          ] /boot</span><br><span class="line">45.2 MiB [          ] /run</span><br><span class="line"> 4.6 MiB [          ] /etc</span><br><span class="line">44.0 KiB [          ] /tmp</span><br><span class="line">24.0 KiB [          ] /home</span><br><span class="line">e  16.0 KiB [          ] /lost+found</span><br><span class="line"> 8.0 KiB [          ] /media</span><br><span class="line">e   4.0 KiB [          ] /srv</span><br><span class="line">e   4.0 KiB [          ] /mnt</span><br><span class="line">.   0.0   B [          ] /proc</span><br><span class="line"> 0.0   B [          ] /sys</span><br><span class="line"> 0.0   B [          ] /dev</span><br><span class="line">@   0.0   B [          ]  initrd.img.old</span><br><span class="line">@   0.0   B [          ]  initrd.img</span><br><span class="line">@   0.0   B [          ]  vmlinuz.old</span><br><span class="line">@   0.0   B [          ]  vmlinuz</span><br><span class="line">@   0.0   B [          ]  libx32</span><br><span class="line">@   0.0   B [          ]  lib64</span><br><span class="line">@   0.0   B [          ]  lib32</span><br><span class="line">@   0.0   B [          ]  sbin</span><br><span class="line"></span><br><span class="line">ncdu 1.13 ~ Use the arrow keys to navigate, press ? for help</span><br><span class="line">--- /var --------------</span><br><span class="line"> 3.5 GiB [##########] /lib</span><br><span class="line"> 1.4 GiB [####      ] /opt</span><br><span class="line">  156.9 MiB [          ] /cache</span><br><span class="line">79.6 MiB [          ] /log</span><br><span class="line"> 1.8 MiB [          ] /backups</span><br><span class="line">20.0 KiB [          ] /tmp</span><br><span class="line">16.0 KiB [          ] /spool</span><br><span class="line">e   4.0 KiB [          ] /mail</span><br><span class="line">e   4.0 KiB [          ] /local</span><br><span class="line">@   0.0   B [          ]  lock</span><br><span class="line">@   0.0   B [          ]  run</span><br></pre></td></tr></table></figure><ul><li>G/GB</li></ul><blockquote><p>The SIZE argument is an integer and optional unit (example: 10K is 10*1024). Units are K,M,G,T,P,E,Z,Y (powers of 1024) or KB,MB,â€¦ (powers of 1000).</p></blockquote><h4 id="nload"><a href="#nload" class="headerlink" title="nload"></a>nload</h4><p>nload å‘½ä»¤æ˜¯ä¸€ä¸ªå®æ—¶ç›‘æ§ç½‘ç»œæµé‡å’Œå¸¦å®½ä½¿ç”¨çš„æ§åˆ¶å°åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨ä¸¤ä¸ªå›¾è¡¨å¯è§†åŒ–åœ°å±•ç¤ºæ¥æ”¶å’Œå‘é€çš„æµé‡ï¼Œå¹¶æä¾›è¯¸å¦‚æ•°æ®äº¤æ¢æ€»é‡ã€æœ€å°/æœ€å¤§ç½‘ç»œå¸¦å®½ä½¿ç”¨é‡ç­‰é™„åŠ ä¿¡æ¯ã€‚</p><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> RHEL/CentOS</span></span><br><span class="line">yum install nload</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian/Ubuntu</span></span><br><span class="line">apt install nload</span><br></pre></td></tr></table></figure><ul><li>output example</li></ul><p>æŒ‰ä¸‹å›è½¦é”®å¯ä»¥åˆ‡æ¢ä¸åŒçš„ç½‘å¡</p><p><img src="img/image-20200506143310955.png" alt="image-20200506143310955"></p><h3 id="ls-å…„å¼Ÿä»¬"><a href="#ls-å…„å¼Ÿä»¬" class="headerlink" title="ls å…„å¼Ÿä»¬"></a>ls å…„å¼Ÿä»¬</h3><p>ä»¥ ls å¼€å¤´çš„å‘½ä»¤å¤§å¤šéƒ½æ˜¯åˆ—å‡º XX ä¿¡æ¯ï¼Œè¿™äº›å·¥å…·ä¹Ÿå¯ä»¥æ–¹ä¾¿æˆ‘ä»¬å¿«é€Ÿäº†è§£ä¸€ä¸‹ç›®å‰ç³»ç»Ÿçš„çŠ¶æ€ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># ls</span></span><br><span class="line">ls           lsblk        LS_COLORS    lsinitramfs  lslogins     lsns         lspgpot</span><br><span class="line">lsa          lsb_release  lscpu        lsipc        lsmem        lsof</span><br><span class="line">lsattr       LSCOLORS     lshw         lslocks      lsmod        lspci</span><br></pre></td></tr></table></figure><h4 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h4><blockquote><p>ls - list directory contents åˆ—å‡ºæ–‡ä»¶å¤¹å†…å®¹</p></blockquote><h4 id="lsattr"><a href="#lsattr" class="headerlink" title="lsattr"></a>lsattr</h4><blockquote><p>lsattr - list file attributes on a Linux second extended file system</p></blockquote><p>åˆ—å‡ºæ–‡ä»¶çš„å±æ€§ï¼Œ</p><h4 id="lsblk"><a href="#lsblk" class="headerlink" title="lsblk"></a>lsblk</h4><blockquote><p>lsblk - list block devices åˆ—å‡ºå—è®¾å¤‡</p></blockquote><p>è¿™ä¸ªå‘½ä»¤åœ¨æŸ¥çœ‹å—è®¾å¤‡ï¼ˆç£ç›˜) åˆ†åŒºå’ŒæŒ‚è½½ç‚¹ï¼Œä»¥åŠç£ç›˜å°šæœªåˆ†é…çš„ç©ºé—´ä¿¡æ¯å¾ˆæœ‰å¸®åŠ©ï¼Œè¦æ¯” fdisk æ›´ç›´è§‚ä¸€äº›ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># lsblk</span></span><br><span class="line">NAME                      MAJ:MIN RM SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda                         8:0    0  30G  0 disk</span><br><span class="line">â”œâ”€sda1                      8:1    0   1M  0 part</span><br><span class="line">â”œâ”€sda2                      8:2    0   1G  0 part /boot</span><br><span class="line">â””â”€sda3                      8:3    0  29G  0 part</span><br><span class="line">  â””â”€ubuntu--vg-ubuntu--lv 253:0    0  28G  0 lvm  /</span><br></pre></td></tr></table></figure><h4 id="lsb-release"><a href="#lsb-release" class="headerlink" title="lsb_release"></a>lsb_release</h4><blockquote><p>lsb_release - print distribution-specific information æ‰“å°å‘è¡Œç‰ˆè¯¦æƒ…</p></blockquote><p>æœ‰äº›å‘è¡Œç‰ˆå°šæœªå®‰è£…</p><h4 id="lscpu"><a href="#lscpu" class="headerlink" title="lscpu"></a>lscpu</h4><blockquote><p>lscpu - display information about the CPU architecture</p></blockquote><p>åˆ—å‡º CPU çš„ä¿¡æ¯ï¼Œå’Œ cat /proc/cpuinfo è¾“å‡ºç»“æœç±»ä¼¼ã€‚ç›¸å½“äº Linux ä¸‹çš„ CPU-Z ğŸ˜‚</p><ul><li>output example</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">â•­â”€root@gitlab</span> <span class="string">/opt</span></span><br><span class="line"><span class="string">â•°â”€#</span> <span class="string">lscpu</span></span><br><span class="line"><span class="attr">Architecture:</span>        <span class="string">x86_64</span></span><br><span class="line"><span class="string">CPU</span> <span class="string">op-mode(s):</span>      <span class="number">32</span><span class="string">-bit,</span> <span class="number">64</span><span class="string">-bit</span></span><br><span class="line"><span class="attr">Byte Order:</span>          <span class="string">Little</span> <span class="string">Endian</span></span><br><span class="line"><span class="string">CPU(s):</span>              <span class="number">4</span></span><br><span class="line"><span class="string">On-line</span> <span class="string">CPU(s)</span> <span class="attr">list:</span> <span class="number">0</span><span class="number">-3</span></span><br><span class="line"><span class="string">Thread(s)</span> <span class="attr">per core:</span>  <span class="number">1</span></span><br><span class="line"><span class="string">Core(s)</span> <span class="attr">per socket:</span>  <span class="number">1</span></span><br><span class="line"><span class="string">Socket(s):</span>           <span class="number">4</span></span><br><span class="line"><span class="string">NUMA</span> <span class="string">node(s):</span>        <span class="number">1</span></span><br><span class="line"><span class="attr">Vendor ID:</span>           <span class="string">GenuineIntel</span></span><br><span class="line"><span class="attr">CPU family:</span>          <span class="number">6</span></span><br><span class="line"><span class="attr">Model:</span>               <span class="number">60</span></span><br><span class="line"><span class="attr">Model name:</span>          <span class="string">Intel(R)</span> <span class="string">Xeon(R)</span> <span class="string">CPU</span> <span class="string">E3-1271</span> <span class="string">v3</span> <span class="string">@</span> <span class="number">3.</span><span class="string">60GHz</span></span><br><span class="line"><span class="attr">Stepping:</span>            <span class="number">3</span></span><br><span class="line"><span class="attr">CPU MHz:</span>             <span class="number">3591.683</span></span><br><span class="line"><span class="attr">BogoMIPS:</span>            <span class="number">7183.36</span></span><br><span class="line"><span class="attr">Hypervisor vendor:</span>   <span class="string">VMware</span></span><br><span class="line"><span class="attr">Virtualization type:</span> <span class="string">full</span></span><br><span class="line"><span class="attr">L1d cache:</span>           <span class="string">32K</span></span><br><span class="line"><span class="attr">L1i cache:</span>           <span class="string">32K</span></span><br><span class="line"><span class="attr">L2 cache:</span>            <span class="string">256K</span></span><br><span class="line"><span class="attr">L3 cache:</span>            <span class="string">8192K</span></span><br><span class="line"><span class="string">NUMA</span> <span class="string">node0</span> <span class="string">CPU(s):</span>   <span class="number">0</span><span class="number">-3</span></span><br><span class="line"><span class="attr">Flags:</span>               <span class="string">fpu</span> <span class="string">vme</span> <span class="string">de</span> <span class="string">pse</span> <span class="string">tsc</span> <span class="string">msr</span> <span class="string">pae</span> <span class="string">mce</span> <span class="string">cx8</span> <span class="string">apic</span> <span class="string">sep</span> <span class="string">mtrr</span> <span class="string">pge</span> <span class="string">mca</span> <span class="string">cmov</span> <span class="string">pat</span> <span class="string">pse36</span> <span class="string">clflush</span> <span class="string">dts</span> <span class="string">mmx</span> <span class="string">fxsr</span> <span class="string">sse</span> <span class="string">sse2</span> <span class="string">ss</span> <span class="string">syscall</span> <span class="string">nx</span> <span class="string">pdpe1gb</span> <span class="string">rdtscp</span> <span class="string">lm</span> <span class="string">constant_tsc</span> <span class="string">arch_perfmon</span> <span class="string">pebs</span> <span class="string">bts</span> <span class="string">nopl</span> <span class="string">xtopology</span> <span class="string">tsc_reliable</span> <span class="string">nonstop_tsc</span> <span class="string">cpuid</span> <span class="string">aperfmperf</span> <span class="string">pni</span> <span class="string">pclmulqdq</span> <span class="string">ssse3</span> <span class="string">fma</span> <span class="string">cx16</span> <span class="string">pcid</span> <span class="string">sse4_1</span> <span class="string">sse4_2</span> <span class="string">x2apic</span> <span class="string">movbe</span> <span class="string">popcnt</span> <span class="string">tsc_deadline_timer</span> <span class="string">aes</span> <span class="string">xsave</span> <span class="string">avx</span> <span class="string">f16c</span> <span class="string">rdrand</span> <span class="string">hypervisor</span> <span class="string">lahf_lm</span> <span class="string">abm</span> <span class="string">cpuid_fault</span> <span class="string">epb</span> <span class="string">invpcid_single</span> <span class="string">pti</span> <span class="string">fsgsbase</span> <span class="string">tsc_adjust</span> <span class="string">bmi1</span> <span class="string">avx2</span> <span class="string">smep</span> <span class="string">bmi2</span> <span class="string">invpcid</span> <span class="string">xsaveopt</span> <span class="string">dtherm</span> <span class="string">ida</span> <span class="string">arat</span> <span class="string">pln</span> <span class="string">pts</span></span><br></pre></td></tr></table></figure><p><code>cat /proc/cpuinfo</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">â•­â”€root@gitlab</span> <span class="string">/opt</span></span><br><span class="line"><span class="string">â•°â”€#</span> <span class="string">cat</span> <span class="string">/proc/cpuinfo</span></span><br><span class="line"><span class="attr">processor       :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">vendor_id       :</span> <span class="string">GenuineIntel</span></span><br><span class="line"><span class="attr">cpu family      :</span> <span class="number">6</span></span><br><span class="line"><span class="attr">model           :</span> <span class="number">60</span></span><br><span class="line"><span class="attr">model name      :</span> <span class="string">Intel(R)</span> <span class="string">Xeon(R)</span> <span class="string">CPU</span> <span class="string">E3-1271</span> <span class="string">v3</span> <span class="string">@</span> <span class="number">3.</span><span class="string">60GHz</span></span><br><span class="line"><span class="attr">stepping        :</span> <span class="number">3</span></span><br><span class="line"><span class="attr">microcode       :</span> <span class="number">0x1c</span></span><br><span class="line"><span class="attr">cpu MHz         :</span> <span class="number">3591.683</span></span><br><span class="line"><span class="attr">cache size      :</span> <span class="number">8192</span> <span class="string">KB</span></span><br><span class="line"><span class="attr">physical id     :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">siblings        :</span> <span class="number">1</span></span><br><span class="line"><span class="attr">core id         :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">cpu cores       :</span> <span class="number">1</span></span><br><span class="line"><span class="attr">apicid          :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">initial apicid  :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">fpu             :</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">fpu_exception   :</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">cpuid level     :</span> <span class="number">13</span></span><br><span class="line"><span class="attr">wp              :</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">flags           :</span> <span class="string">fpu</span> <span class="string">vme</span> <span class="string">de</span> <span class="string">pse</span> <span class="string">tsc</span> <span class="string">msr</span> <span class="string">pae</span> <span class="string">mce</span> <span class="string">cx8</span> <span class="string">apic</span> <span class="string">sep</span> <span class="string">mtrr</span> <span class="string">pge</span> <span class="string">mca</span> <span class="string">cmov</span> <span class="string">pat</span> <span class="string">pse36</span> <span class="string">clflush</span> <span class="string">dts</span> <span class="string">mmx</span> <span class="string">fxsr</span> <span class="string">sse</span> <span class="string">sse2</span> <span class="string">ss</span> <span class="string">syscall</span> <span class="string">nx</span> <span class="string">pdpe1gb</span> <span class="string">rdtscp</span> <span class="string">lm</span> <span class="string">constant_tsc</span> <span class="string">arch_perfmon</span> <span class="string">pebs</span> <span class="string">bts</span> <span class="string">nopl</span> <span class="string">xtopology</span> <span class="string">tsc_reliable</span> <span class="string">nonstop_tsc</span> <span class="string">cpuid</span> <span class="string">aperfmperf</span> <span class="string">pni</span> <span class="string">pclmulqdq</span> <span class="string">ssse3</span> <span class="string">fma</span> <span class="string">cx16</span> <span class="string">pcid</span> <span class="string">sse4_1</span> <span class="string">sse4_2</span> <span class="string">x2apic</span> <span class="string">movbe</span> <span class="string">popcnt</span> <span class="string">tsc_deadline_timer</span> <span class="string">aes</span> <span class="string">xsave</span> <span class="string">avx</span> <span class="string">f16c</span> <span class="string">rdrand</span> <span class="string">hypervisor</span> <span class="string">lahf_lm</span> <span class="string">abm</span> <span class="string">cpuid_fault</span> <span class="string">epb</span> <span class="string">invpcid_single</span> <span class="string">pti</span> <span class="string">fsgsbase</span> <span class="string">tsc_adjust</span> <span class="string">bmi1</span> <span class="string">avx2</span> <span class="string">smep</span> <span class="string">bmi2</span> <span class="string">invpcid</span> <span class="string">xsaveopt</span> <span class="string">dtherm</span> <span class="string">ida</span> <span class="string">arat</span> <span class="string">pln</span> <span class="string">pts</span></span><br><span class="line"><span class="attr">bugs            :</span> <span class="string">cpu_meltdown</span> <span class="string">spectre_v1</span> <span class="string">spectre_v2</span> <span class="string">spec_store_bypass</span> <span class="string">l1tf</span> <span class="string">mds</span> <span class="string">swapgs</span></span><br><span class="line"><span class="attr">bogomips        :</span> <span class="number">7183.36</span></span><br><span class="line"><span class="attr">clflush size    :</span> <span class="number">64</span></span><br><span class="line"><span class="attr">cache_alignment :</span> <span class="number">64</span></span><br><span class="line"><span class="attr">address sizes   :</span> <span class="number">42</span> <span class="string">bits</span> <span class="string">physical,</span> <span class="number">48</span> <span class="string">bits</span> <span class="string">virtual</span></span><br><span class="line"><span class="attr">power management:</span></span><br></pre></td></tr></table></figure><h4 id="lshw"><a href="#lshw" class="headerlink" title="lshw"></a>lshw</h4><blockquote><p>lshw - list hardware åˆ—å‡ºç¡¬ä»¶è®¾å¤‡</p><p>lshw is a small tool to extract detailed information on the hardware configuration of the machine. It  can report exact memory configuration, firmware version, mainboard configuration, CPU version and speed, cache configuration, bus speed, etc. on DMI-capable x86 or IA-64 systems and on some PowerPC machines  (PowerMac G4 is known to work).It  currently  supports  DMI (x86 and IA-64 only), OpenFirmware device tree (PowerPC only), PCI/AGP, CPUID (x86), IDE/ATA/ATAPI, PCMCIA (only tested on x86), SCSI and USB.</p></blockquote><p>è¿™ä¸ªå‘½ä»¤å°±ç›¸å½“äº Windows ä¸‹çš„è®¾å¤‡ç®¡ç†å™¨ï¼Œåˆ—å‡ºç³»ç»Ÿé‡Œçš„ç¡¬ä»¶è®¾å¤‡ã€‚</p><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> RHEL/CentOS</span></span><br><span class="line">yum install lshw</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian/Ubuntu</span></span><br><span class="line">apt install lshw</span><br></pre></td></tr></table></figure><ul><li>output example</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# lshw</span><br><span class="line">sg-02</span><br><span class="line"> description: Computer</span><br><span class="line"> product: HVM domU</span><br><span class="line"> vendor: Xen</span><br><span class="line"> version: 4.2.amazon</span><br><span class="line"> serial: ec2c5773-d127-c5a4-60a3-221becf4e6ae</span><br><span class="line"> width: 64 bits</span><br><span class="line"> capabilities: smbios-2.7 dmi-2.7 vsyscall32</span><br><span class="line"> configuration: boot=normal uuid=73572CEC-27D1-A4C5-60A3-221BECF4E6AE</span><br><span class="line">  *-core</span><br><span class="line"> description: Motherboard</span><br><span class="line"> physical id: 0</span><br><span class="line">  *-firmware</span><br><span class="line"> description: BIOS</span><br><span class="line"> vendor: Xen</span><br><span class="line"> physical id: 0</span><br><span class="line"> version: 4.2.amazon</span><br><span class="line"> date: 08/24/2006</span><br><span class="line"> size: 96KiB</span><br><span class="line"> capabilities: pci edd</span><br><span class="line">  *-cpu</span><br><span class="line"> description: CPU</span><br><span class="line"> product: Intel(R) Xeon(R) CPU E5-2676 v3 @ 2.40GHz</span><br><span class="line"> vendor: Intel Corp.</span><br><span class="line"> physical id: 401</span><br><span class="line"> bus info: cpu@0</span><br><span class="line"> slot: CPU 1</span><br><span class="line"> size: 2400MHz</span><br><span class="line"> capacity: 2400MHz</span><br><span class="line"> width: 64 bits</span><br><span class="line"> capabilities: fpu fpu_exception wp vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx rdtscp x86-64 constant_tsc rep_good nopl xtopology cpuid pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm cpuid_fault invpcid_single pti fsgsbase bmi1 avx2 smep bmi2 erms invpcid xsaveopt</span><br><span class="line">  *-memory</span><br><span class="line"> description: System Memory</span><br><span class="line"> physical id: 1000</span><br><span class="line"> size: 1GiB</span><br><span class="line"> capacity: 1GiB</span><br><span class="line"> capabilities: ecc</span><br><span class="line"> configuration: errordetection=multi-bit-ecc</span><br><span class="line">  *-bank</span><br><span class="line"> description: DIMM RAM</span><br><span class="line"> physical id: 0</span><br><span class="line"> slot: DIMM 0</span><br><span class="line"> size: 1GiB</span><br><span class="line"> width: 64 bits</span><br><span class="line">  *-pci</span><br><span class="line"> description: Host bridge</span><br><span class="line"> product: 440FX - 82441FX PMC [Natoma]</span><br><span class="line"> vendor: Intel Corporation</span><br><span class="line"> physical id: 100</span><br><span class="line"> bus info: pci@0000:00:00.0</span><br><span class="line"> version: 02</span><br><span class="line"> width: 32 bits</span><br><span class="line"> clock: 33MHz</span><br><span class="line">  *-isa</span><br><span class="line"> description: ISA bridge</span><br><span class="line"> product: 82371SB PIIX3 ISA [Natoma/Triton II]</span><br><span class="line"> vendor: Intel Corporation</span><br><span class="line"> physical id: 1</span><br><span class="line"> bus info: pci@0000:00:01.0</span><br><span class="line"> version: 00</span><br><span class="line"> width: 32 bits</span><br><span class="line"> clock: 33MHz</span><br><span class="line"> capabilities: isa bus_master</span><br><span class="line"> configuration: latency=0</span><br><span class="line">  *-ide</span><br><span class="line"> description: IDE interface</span><br><span class="line"> product: 82371SB PIIX3 IDE [Natoma/Triton II]</span><br><span class="line"> vendor: Intel Corporation</span><br><span class="line"> physical id: 1.1</span><br><span class="line"> bus info: pci@0000:00:01.1</span><br><span class="line"> version: 00</span><br><span class="line"> width: 32 bits</span><br><span class="line"> clock: 33MHz</span><br><span class="line"> capabilities: ide bus_master</span><br><span class="line"> configuration: driver=ata_piix latency=64</span><br><span class="line"> resources: irq:0 ioport:1f0(size=8) ioport:3f6 ioport:170(size=8) ioport:376 ioport:c100(size=16)</span><br><span class="line">  *-bridge UNCLAIMED</span><br><span class="line"> description: Bridge</span><br><span class="line"> product: 82371AB/EB/MB PIIX4 ACPI</span><br><span class="line"> vendor: Intel Corporation</span><br><span class="line"> physical id: 1.3</span><br><span class="line"> bus info: pci@0000:00:01.3</span><br><span class="line"> version: 01</span><br><span class="line"> width: 32 bits</span><br><span class="line"> clock: 33MHz</span><br><span class="line"> capabilities: bridge bus_master</span><br><span class="line"> configuration: latency=0</span><br><span class="line">  *-display UNCLAIMED</span><br><span class="line"> description: VGA compatible controller</span><br><span class="line"> product: GD 5446</span><br><span class="line"> vendor: Cirrus Logic</span><br><span class="line"> physical id: 2</span><br><span class="line"> bus info: pci@0000:00:02.0</span><br><span class="line"> version: 00</span><br><span class="line"> width: 32 bits</span><br><span class="line"> clock: 33MHz</span><br><span class="line"> capabilities: vga_controller bus_master</span><br><span class="line"> configuration: latency=0</span><br><span class="line"> resources: memory:f0000000-f1ffffff memory:f3000000-f3000fff memory:c0000-dffff</span><br><span class="line">  *-generic</span><br><span class="line"> description: Unassigned class</span><br><span class="line"> product: Xen Platform Device</span><br><span class="line"> vendor: XenSource, Inc.</span><br><span class="line"> physical id: 3</span><br><span class="line"> bus info: pci@0000:00:03.0</span><br><span class="line"> version: 01</span><br><span class="line"> width: 32 bits</span><br><span class="line"> clock: 33MHz</span><br><span class="line"> capabilities: bus_master</span><br><span class="line"> configuration: driver=xen-platform-pci latency=0</span><br><span class="line"> resources: irq:28 ioport:c000(size=256) memory:f2000000-f2ffffff</span><br><span class="line">  *-network:0</span><br><span class="line"> description: Ethernet interface</span><br><span class="line"> physical id: 1</span><br><span class="line"> logical name: eth0</span><br><span class="line"> serial: 02:24:d2:49:f2:94</span><br><span class="line"> capabilities: ethernet physical</span><br><span class="line"> configuration: broadcast=yes driver=vif ip=172.26.17.53 link=yes multicast=yes</span><br><span class="line">  *-network:1</span><br><span class="line"> description: Ethernet interface</span><br><span class="line"> physical id: 2</span><br><span class="line"> logical name: docker0</span><br><span class="line"> serial: 02:42:37:cf:cf:aa</span><br><span class="line"> capabilities: ethernet physical</span><br><span class="line"> configuration: broadcast=yes driver=bridge driverversion=2.3 firmware=N/A ip=172.17.0.1 link=no multicast=yes</span><br><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€#</span><br></pre></td></tr></table></figure><h4 id="lsinitramfs"><a href="#lsinitramfs" class="headerlink" title="lsinitramfs"></a>lsinitramfs</h4><blockquote><p>lsinitramfs - list content of an initramfs image</p><p>The  lsinitramfs  command  lists the content of given initramfs images. It allows one to quickly check the content of one (or multiple) specified initramfs files.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># lsinitramfs /boot/initrd.img-4.15.0-58-generic | head -n 10</span></span><br><span class="line">.</span><br><span class="line">usr</span><br><span class="line">usr/share</span><br><span class="line">usr/share/plymouth</span><br><span class="line">usr/share/plymouth/themes</span><br><span class="line">usr/share/plymouth/themes/details</span><br><span class="line">usr/share/plymouth/themes/details/details.plymouth</span><br><span class="line">usr/share/plymouth/themes/text.plymouth</span><br><span class="line">usr/share/plymouth/themes/ubuntu-text</span><br><span class="line">usr/share/plymouth/themes/ubuntu-text/ubuntu-text.plymouth.in</span><br></pre></td></tr></table></figure><h4 id="lsipc"><a href="#lsipc" class="headerlink" title="lsipc"></a>lsipc</h4><blockquote><p>lsipc - show information on IPC facilities currently employed in the system</p><p>lsipc  shows  information on the inter-process communication facilities for which the calling process has read access.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># lsipc</span></span><br><span class="line">RESOURCE DESCRIPTION                                     LIMIT USED  USE%</span><br><span class="line">MSGMNI   Number of message queues                        32000    0 0.00%</span><br><span class="line">MSGMAX   Max size of message (bytes)                      8192    -     -</span><br><span class="line">MSGMNB   Default max size of queue (bytes)               16384    -     -</span><br><span class="line">SHMMNI   Shared memory segments                           4096    1 0.02%</span><br><span class="line">SHMALL   Shared memory pages                           4194304    0 0.00%</span><br><span class="line">SHMMAX   Max size of shared memory segment (bytes) 17179869184    -     -</span><br><span class="line">SHMMIN   Min size of shared memory segment (bytes)           1    -     -</span><br><span class="line">SEMMNI   Number of semaphore identifiers                   262    0 0.00%</span><br><span class="line">SEMMNS   Total number of semaphores                      32000    0 0.00%</span><br><span class="line">SEMMSL   Max semaphores per semaphore <span class="built_in">set</span>.                 250    -     -</span><br><span class="line">SEMOPM   Max number of operations per semop(2)              32    -     -</span><br><span class="line">SEMVMX   Semaphore max value                             32767    -     -</span><br></pre></td></tr></table></figure><h4 id="lslocks"><a href="#lslocks" class="headerlink" title="lslocks"></a>lslocks</h4><blockquote><p>lslocks - list local system locks</p><p>lslocks lists information about all the currently held file locks in a Linux system</p></blockquote><p>åˆ—å‡ºå½“å‰ç³»ç»Ÿä¸­è¢«åŠ é”çš„æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># lslocks</span></span><br><span class="line">COMMAND           PID  TYPE SIZE MODE  M START END PATH</span><br><span class="line">cron              900 FLOCK   4B WRITE 0     0   0 /run/crond.pid</span><br><span class="line">svlogd          53065 FLOCK   0B WRITE 0     0   0 /var/<span class="built_in">log</span>/gitlab/redis/lock</span><br><span class="line">runsv           54095 FLOCK   0B WRITE 0     0   0 /opt/gitlab/sv/sidekiq/supervise/lock</span><br><span class="line">runsv           54095 FLOCK   0B WRITE 0     0   0 /opt/gitlab/sv/sidekiq/<span class="built_in">log</span>/supervise/lock</span><br></pre></td></tr></table></figure><h4 id="lslogins"><a href="#lslogins" class="headerlink" title="lslogins"></a>lslogins</h4><p>åˆ—å‡ºå½“å‰å·²ç»ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯</p><blockquote><p>lslogins - display information about known users in the system</p><p>Examine the wtmp and btmp logs, /etc/shadow (if necessary) and /etc/passwd and output the desired data. The default action is to list info about all the users in the system.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># lslogins</span></span><br><span class="line">  UID USER              PROC PWD-LOCK PWD-DENY LAST-LOGIN GECOS</span><br><span class="line"> 0 root               211        0        0      06:58 root</span><br><span class="line"> 1 daemon               1        0        1            daemon</span><br><span class="line"> 2 bin                  0        0        1            bin</span><br><span class="line"> 3 sys                  0        0        1            sys</span><br><span class="line"> 4 sync                 0        0        1            sync</span><br><span class="line"> 5 games                0        0        1            games</span><br><span class="line"> 6 man                  0        0        1            man</span><br><span class="line"> 7 lp                   0        0        1            lp</span><br><span class="line"> 8 mail                 0        0        1            mail</span><br><span class="line"> 9 news                 0        0        1            news</span><br><span class="line">10 uucp                 0        0        1            uucp</span><br><span class="line">13 proxy                0        0        1            proxy</span><br><span class="line">33 www-data             0        0        1            www-data</span><br><span class="line">34 backup               0        0        1            backup</span><br><span class="line">38 list                 0        0        1            Mailing List Manager</span><br><span class="line">39 irc                  0        0        1            ircd</span><br><span class="line">41 gnats                0        0        1            Gnats Bug-Reporting System (admin)</span><br><span class="line">  100 systemd-network      1        0        1            systemd Network Management,,,</span><br><span class="line">  101 systemd-resolve      1        0        1            systemd Resolver,,,</span><br><span class="line">  102 syslog               1        0        1</span><br><span class="line">  103 messagebus           1        0        1</span><br><span class="line">  104 _apt                 0        0        1</span><br><span class="line">  105 lxd                  0        0        1</span><br><span class="line">  106 uuidd                0        0        1</span><br><span class="line">  107 dnsmasq              0        0        1            dnsmasq,,,</span><br><span class="line">  108 landscape            0        0        1</span><br><span class="line">  109 pollinate            0        0        1</span><br><span class="line">  110 sshd                 0        0        1</span><br><span class="line">  995 gitlab-prometheus    4        0        1</span><br><span class="line">  996 gitlab-psql         18        0        1</span><br><span class="line">  997 gitlab-redis         2        0        1</span><br><span class="line">  998 git                 16        0        1</span><br><span class="line">  999 gitlab-www           5        0        1</span><br><span class="line"> 1000 ubuntu               0        0        0 2019-Aug28 ubuntu</span><br><span class="line">65534 nobody               0        0        1            nobody</span><br></pre></td></tr></table></figure><h4 id="lsmem"><a href="#lsmem" class="headerlink" title="lsmem"></a>lsmem</h4><blockquote><p>lsmem - list the ranges of available memory with their online status</p><p>The  lsmem command lists the ranges of available memory with their online status. The listed memory blocks correspond to the memory block representation in sysfs. The command also shows the memory block  size  and the amount of memory in online and offline state.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># lsmem                                                                                                     127 â†µ</span></span><br><span class="line">RANGE                                  SIZE  STATE REMOVABLE BLOCK</span><br><span class="line">0x0000000000000000-0x0000000007ffffff  128M online        no     0</span><br><span class="line">0x0000000008000000-0x000000000fffffff  128M online       yes     1</span><br><span class="line">0x0000000010000000-0x000000001fffffff  256M online        no   2-3</span><br><span class="line">0x0000000020000000-0x0000000027ffffff  128M online       yes     4</span><br><span class="line">0x0000000028000000-0x0000000037ffffff  256M online        no   5-6</span><br><span class="line">0x0000000038000000-0x000000003fffffff  128M online       yes     7</span><br><span class="line">0x0000000040000000-0x000000006fffffff  768M online        no  8-13</span><br><span class="line">0x0000000070000000-0x0000000077ffffff  128M online       yes    14</span><br><span class="line">0x0000000078000000-0x00000000bfffffff  1.1G online        no 15-23</span><br><span class="line">0x0000000100000000-0x000000013fffffff    1G online        no 32-39</span><br><span class="line"></span><br><span class="line">Memory block size:       128M</span><br><span class="line">Total online memory:       4G</span><br><span class="line">Total offline memory:      0B</span><br></pre></td></tr></table></figure><h4 id="lsmod"><a href="#lsmod" class="headerlink" title="lsmod"></a>lsmod</h4><p>åˆ—å‡ºç³»ç»Ÿå†…æ ¸æ¨¡å—</p><blockquote><p>lsmod - Show the status of modules in the Linux Kernel</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># lsmod</span></span><br><span class="line">Module                  Size  Used by</span><br><span class="line">tcp_diag               16384  0</span><br><span class="line">inet_diag              24576  1 tcp_diag</span><br><span class="line">joydev                 24576  0</span><br><span class="line">input_leds             16384  0</span><br><span class="line">vmw_balloon            20480  0</span><br><span class="line">serio_raw              16384  0</span><br><span class="line">vmw_vsock_vmci_transport    28672  1</span><br><span class="line">vsock                  36864  2 vmw_vsock_vmci_transport</span><br><span class="line">vmw_vmci               69632  2 vmw_balloon,vmw_vsock_vmci_transport</span><br><span class="line">sch_fq_codel           20480  5</span><br><span class="line">ib_iser                49152  0</span><br><span class="line">rdma_cm                61440  1 ib_iser</span><br><span class="line">iw_cm                  45056  1 rdma_cm</span><br><span class="line">ib_cm                  53248  1 rdma_cm</span><br><span class="line">ib_core               225280  4 rdma_cm,iw_cm,ib_iser,ib_cm</span><br><span class="line">iscsi_tcp              20480  0</span><br><span class="line">libiscsi_tcp           20480  1 iscsi_tcp</span><br><span class="line">libiscsi               53248  3 libiscsi_tcp,iscsi_tcp,ib_iser</span><br><span class="line">scsi_transport_iscsi    98304  3 iscsi_tcp,ib_iser,libiscsi</span><br><span class="line">ip_tables              28672  0</span><br><span class="line">x_tables               40960  1 ip_tables</span><br><span class="line">autofs4                40960  2</span><br><span class="line">btrfs                1130496  0</span><br><span class="line">zstd_compress         163840  1 btrfs</span><br><span class="line">raid10                 53248  0</span><br><span class="line">raid456               143360  0</span><br><span class="line">async_raid6_recov      20480  1 raid456</span><br><span class="line">async_memcpy           16384  2 raid456,async_raid6_recov</span><br><span class="line">async_pq               16384  2 raid456,async_raid6_recov</span><br><span class="line">async_xor              16384  3 async_pq,raid456,async_raid6_recov</span><br><span class="line">async_tx               16384  5 async_pq,async_memcpy,async_xor,raid456,async_raid6_recov</span><br><span class="line">xor                    24576  2 async_xor,btrfs</span><br><span class="line">raid6_pq              114688  4 async_pq,btrfs,raid456,async_raid6_recov</span><br><span class="line">libcrc32c              16384  1 raid456</span><br><span class="line">raid1                  40960  0</span><br><span class="line">raid0                  20480  0</span><br><span class="line">multipath              16384  0</span><br><span class="line">linear                 16384  0</span><br><span class="line">crct10dif_pclmul       16384  0</span><br><span class="line">crc32_pclmul           16384  0</span><br><span class="line">ghash_clmulni_intel    16384  0</span><br><span class="line">pcbc                   16384  0</span><br><span class="line">vmwgfx                274432  1</span><br><span class="line">ttm                   106496  1 vmwgfx</span><br><span class="line">drm_kms_helper        172032  1 vmwgfx</span><br><span class="line">aesni_intel           188416  0</span><br><span class="line">syscopyarea            16384  1 drm_kms_helper</span><br><span class="line">aes_x86_64             20480  1 aesni_intel</span><br><span class="line">sysfillrect            16384  1 drm_kms_helper</span><br><span class="line">crypto_simd            16384  1 aesni_intel</span><br><span class="line">sysimgblt              16384  1 drm_kms_helper</span><br><span class="line">glue_helper            16384  1 aesni_intel</span><br><span class="line">fb_sys_fops            16384  1 drm_kms_helper</span><br><span class="line">cryptd                 24576  3 crypto_simd,ghash_clmulni_intel,aesni_intel</span><br><span class="line">psmouse               147456  0</span><br><span class="line">drm                   401408  4 vmwgfx,drm_kms_helper,ttm</span><br><span class="line">mptspi                 24576  2</span><br><span class="line">mptscsih               40960  1 mptspi</span><br><span class="line">mptbase               102400  2 mptspi,mptscsih</span><br><span class="line">ahci                   40960  0</span><br><span class="line">libahci                32768  1 ahci</span><br><span class="line">i2c_piix4              24576  0</span><br><span class="line">vmxnet3                57344  0</span><br><span class="line">scsi_transport_spi     32768  1 mptspi</span><br><span class="line">pata_acpi              16384  0</span><br></pre></td></tr></table></figure><h4 id="lsns-list-namespaces"><a href="#lsns-list-namespaces" class="headerlink" title="lsns - list namespaces"></a>lsns - list namespaces</h4><p>lsns  lists  information  about all the currently accessible namespaces or about the given namespace.  The namespace identifier is an inode number.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># lsns</span></span><br><span class="line">  NS TYPE   NPROCS   PID USER             COMMAND</span><br><span class="line">4026531835 cgroup    264     1 root             /lib/systemd/systemd --system --deserialize 39</span><br><span class="line">4026531836 pid       264     1 root             /lib/systemd/systemd --system --deserialize 39</span><br><span class="line">4026531837 user      264     1 root             /lib/systemd/systemd --system --deserialize 39</span><br><span class="line">4026531838 uts       264     1 root             /lib/systemd/systemd --system --deserialize 39</span><br><span class="line">4026531839 ipc       264     1 root             /lib/systemd/systemd --system --deserialize 39</span><br><span class="line">4026531840 mnt       259     1 root             /lib/systemd/systemd --system --deserialize 39</span><br><span class="line">4026531861 mnt         1    31 root             kdevtmpfs</span><br><span class="line">4026531993 net       264     1 root             /lib/systemd/systemd --system --deserialize 39</span><br><span class="line">4026532531 mnt         1 37609 root             /lib/systemd/systemd-udevd</span><br><span class="line">4026532556 mnt         1 42954 systemd-timesync /lib/systemd/systemd-timesyncd</span><br><span class="line">4026532557 mnt         1 42900 systemd-network  /lib/systemd/systemd-networkd</span><br><span class="line">4026532603 mnt         1 42924 systemd-resolve  /lib/systemd/systemd-resolved</span><br></pre></td></tr></table></figure><h4 id="lsof-list-open-files"><a href="#lsof-list-open-files" class="headerlink" title="lsof - list open files"></a>lsof - list open files</h4><p>lsof åˆ—å‡ºæ‰“å¼€çš„æ–‡ä»¶ã€‚ç»å¯¹æ˜¯ä¸ªæ’æŸ¥æ•…éšœçš„åˆ©å™¨ï¼Œåœ¨ä¸€åˆ‡çš†æ–‡ä»¶çš„ Linux ä¸–ç•Œé‡Œï¼Œlsof å¯ä»¥æŸ¥çœ‹æ‰“å¼€çš„æ–‡ä»¶æ˜¯ï¼š</p><ul><li>æ™®é€šæ–‡ä»¶</li><li>ç›®å½•</li><li>ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶</li><li>å­—ç¬¦æˆ–è®¾å¤‡æ–‡ä»¶</li><li>(å‡½æ•°)å…±äº«åº“</li><li>ç®¡é“ã€å‘½åç®¡é“</li><li>ç¬¦å·é“¾æ¥</li><li>ç½‘ç»œæ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼šNFS fileã€ç½‘ç»œsocketï¼ŒunixåŸŸåsocketï¼‰</li><li>è¿˜æœ‰å…¶å®ƒç±»å‹çš„æ–‡ä»¶ï¼Œç­‰ç­‰</li></ul><p>å¦å¤– lsof å‘½ä»¤ä¹Ÿæ˜¯æœ‰ç€æœ€å¤šé€‰é¡¹çš„Linux/Unixå‘½ä»¤ä¹‹ä¸€ï¼Œå¦ä¸€ä¸ª nc å‘½ä»¤ä¹Ÿæ˜¯å¦‚æ­¤ğŸ˜‚ã€‚</p><ul><li>åˆ—å‡ºç«¯å£å·å ç”¨çš„è¿›ç¨‹</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@blog &#x2F;opt&#x2F;shell</span><br><span class="line">â•°â”€# lsof -i :53      â†µ</span><br><span class="line">COMMAND   PID            USER   FD   TYPE DEVICE SIZE&#x2F;OFF NODE NAME</span><br><span class="line">systemd-r 538 systemd-resolve   12u  IPv4  13925      0t0  UDP localhost:domain</span><br><span class="line">systemd-r 538 systemd-resolve   13u  IPv4  13926      0t0  TCP localhost:domain (LISTEN)</span><br></pre></td></tr></table></figure><blockquote><p>PSï¼šæœ€è¿‘é¢è¯•çš„æ—¶å€™è¢«é—®åˆ°è¿‡</p><p>Qï¼š Linux ä¸‹æŸ¥çœ‹ç«¯å£å ç”¨çš„å‘½ä»¤ï¼Ÿ</p><p>Aï¼š<code>netstat -tunlp</code> ã€<code>ss -tua</code>ã€<code>lsof -i</code> ğŸ˜‚</p></blockquote><h4 id="lspci-list-all-PCI-devices"><a href="#lspci-list-all-PCI-devices" class="headerlink" title="lspci - list all PCI devices"></a>lspci - list all PCI devices</h4><p>åˆ—å‡º PCI è®¾å¤‡ï¼Œæ¯”å¦‚æ˜¾å¡</p><blockquote><p>lspci is a utility for displaying information about PCI buses in the system and devices connected to them.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab /opt</span><br><span class="line">â•°â”€<span class="comment"># lspci</span></span><br><span class="line">00:00.0 Host bridge: Intel Corporation 440BX/ZX/DX - 82443BX/ZX/DX Host bridge (rev 01)</span><br><span class="line">00:01.0 PCI bridge: Intel Corporation 440BX/ZX/DX - 82443BX/ZX/DX AGP bridge (rev 01)</span><br><span class="line">00:07.0 ISA bridge: Intel Corporation 82371AB/EB/MB PIIX4 ISA (rev 08)</span><br><span class="line">00:07.1 IDE interface: Intel Corporation 82371AB/EB/MB PIIX4 IDE (rev 01)</span><br><span class="line">00:07.3 Bridge: Intel Corporation 82371AB/EB/MB PIIX4 ACPI (rev 08)</span><br><span class="line">00:07.7 System peripheral: VMware Virtual Machine Communication Interface (rev 10)</span><br><span class="line">00:0f.0 VGA compatible controller: VMware SVGA II Adapter</span><br><span class="line">00:10.0 SCSI storage controller: LSI Logic / Symbios Logic 53c1030 PCI-X Fusion-MPT Dual Ultra320 SCSI (rev 01)</span><br><span class="line">00:11.0 PCI bridge: VMware PCI bridge (rev 02)</span><br></pre></td></tr></table></figure><h3 id="proc"><a href="#proc" class="headerlink" title="proc"></a>proc</h3><p>ç¡®åˆ‡æ¥è¯´è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œè€Œæ˜¯ Linux çš„å†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£ä¸€äº›ç³»ç»Ÿä¿¡æ¯ï¼Œæ–¹ä¾¿æ’æŸ¥ä¸€äº›æ•…éšœç­‰ã€‚</p><h4 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h4><p><code>cat /proc/cpuinfo</code> å’Œ <code>lscpu</code> äºŒè€…è¾“å‡ºç±»ä¼¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@k8s-master-01</span> <span class="string">~]#</span> <span class="string">cat</span> <span class="string">/proc/cpuinfo</span></span><br><span class="line"><span class="attr">processor       :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">vendor_id       :</span> <span class="string">GenuineIntel</span></span><br><span class="line"><span class="attr">cpu family      :</span> <span class="number">6</span></span><br><span class="line"><span class="attr">model           :</span> <span class="number">60</span></span><br><span class="line"><span class="attr">model name      :</span> <span class="string">Intel(R)</span> <span class="string">Xeon(R)</span> <span class="string">CPU</span> <span class="string">E3-1271</span> <span class="string">v3</span> <span class="string">@</span> <span class="number">3.</span><span class="string">60GHz</span></span><br><span class="line"><span class="attr">stepping        :</span> <span class="number">3</span></span><br><span class="line"><span class="attr">microcode       :</span> <span class="number">0x1c</span></span><br><span class="line"><span class="attr">cpu MHz         :</span> <span class="number">3591.683</span></span><br><span class="line"><span class="attr">cache size      :</span> <span class="number">8192</span> <span class="string">KB</span></span><br><span class="line"><span class="attr">physical id     :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">siblings        :</span> <span class="number">1</span></span><br><span class="line"><span class="attr">core id         :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">cpu cores       :</span> <span class="number">1</span></span><br><span class="line"><span class="attr">apicid          :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">initial apicid  :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">fpu             :</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">fpu_exception   :</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">cpuid level     :</span> <span class="number">13</span></span><br><span class="line"><span class="attr">wp              :</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">flags           :</span> <span class="string">fpu</span> <span class="string">vme</span> <span class="string">de</span> <span class="string">pse</span> <span class="string">tsc</span> <span class="string">msr</span> <span class="string">pae</span> <span class="string">mce</span> <span class="string">cx8</span> <span class="string">apic</span> <span class="string">sep</span> <span class="string">mtrr</span> <span class="string">pge</span> <span class="string">mca</span> <span class="string">cmov</span> <span class="string">pat</span> <span class="string">pse36</span> <span class="string">clflush</span> <span class="string">dts</span> <span class="string">mmx</span> <span class="string">fxsr</span> <span class="string">sse</span> <span class="string">sse2</span> <span class="string">ss</span> <span class="string">syscall</span> <span class="string">nx</span> <span class="string">pdpe1gb</span> <span class="string">rdtscp</span> <span class="string">lm</span> <span class="string">constant_tsc</span> <span class="string">arch_perfmon</span> <span class="string">pebs</span> <span class="string">bts</span> <span class="string">nopl</span> <span class="string">xtopology</span> <span class="string">tsc_reliable</span> <span class="string">nonstop_tsc</span> <span class="string">aperfmperf</span> <span class="string">eagerfpu</span> <span class="string">pni</span> <span class="string">pclmulqdq</span> <span class="string">ssse3</span> <span class="string">fma</span> <span class="string">cx16</span> <span class="string">pcid</span> <span class="string">sse4_1</span> <span class="string">sse4_2</span> <span class="string">x2apic</span> <span class="string">movbe</span> <span class="string">popcnt</span> <span class="string">tsc_deadline_timer</span> <span class="string">aes</span> <span class="string">xsave</span> <span class="string">avx</span> <span class="string">f16c</span> <span class="string">rdrand</span> <span class="string">hypervisor</span> <span class="string">lahf_lm</span> <span class="string">abm</span> <span class="string">epb</span> <span class="string">fsgsbase</span> <span class="string">tsc_adjust</span> <span class="string">bmi1</span> <span class="string">avx2</span> <span class="string">smep</span> <span class="string">bmi2</span> <span class="string">invpcid</span> <span class="string">xsaveopt</span> <span class="string">dtherm</span> <span class="string">ida</span> <span class="string">arat</span> <span class="string">pln</span> <span class="string">pts</span></span><br><span class="line"><span class="attr">bogomips        :</span> <span class="number">7183.36</span></span><br><span class="line"><span class="attr">clflush size    :</span> <span class="number">64</span></span><br><span class="line"><span class="attr">cache_alignment :</span> <span class="number">64</span></span><br><span class="line"><span class="attr">address sizes   :</span> <span class="number">42</span> <span class="string">bits</span> <span class="string">physical,</span> <span class="number">48</span> <span class="string">bits</span> <span class="string">virtual</span></span><br><span class="line"><span class="attr">power management:</span></span><br></pre></td></tr></table></figure><h4 id="RAM"><a href="#RAM" class="headerlink" title="RAM"></a>RAM</h4><p>ç”¨æ¥æŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿå†…å­˜çš„ä¿¡æ¯ï¼Œå¦å¤– free å‘½ä»¤æ˜¯ä» /proc/meminfo ä¸­è¯»å–ä¿¡æ¯çš„ï¼Œè·Ÿæˆ‘ä»¬ç›´æ¥è¯»åˆ°çš„ç»“æœä¸€æ ·ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@k8s-master-01</span> <span class="string">proc]#</span> <span class="string">cat</span> <span class="string">meminfo</span></span><br><span class="line"><span class="attr">MemTotal:</span>        <span class="number">3863636</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">MemFree:</span>          <span class="number">247016</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">MemAvailable:</span>    <span class="number">2096628</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Buffers:</span>           <span class="number">85612</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Cached:</span>          <span class="number">1952072</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">SwapCached:</span>            <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Active:</span>          <span class="number">2250028</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Inactive:</span>        <span class="number">1003588</span> <span class="string">kB</span></span><br><span class="line"><span class="string">Active(anon):</span>    <span class="number">1224120</span> <span class="string">kB</span></span><br><span class="line"><span class="string">Inactive(anon):</span>    <span class="number">21344</span> <span class="string">kB</span></span><br><span class="line"><span class="string">Active(file):</span>    <span class="number">1025908</span> <span class="string">kB</span></span><br><span class="line"><span class="string">Inactive(file):</span>   <span class="number">982244</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Unevictable:</span>           <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Mlocked:</span>               <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">SwapTotal:</span>             <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">SwapFree:</span>              <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Dirty:</span>               <span class="number">128</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Writeback:</span>             <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">AnonPages:</span>       <span class="number">1215816</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Mapped:</span>           <span class="number">196080</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Shmem:</span>             <span class="number">29532</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Slab:</span>             <span class="number">222544</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">SReclaimable:</span>      <span class="number">92156</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">SUnreclaim:</span>       <span class="number">130388</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">KernelStack:</span>       <span class="number">15904</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">PageTables:</span>        <span class="number">13024</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">NFS_Unstable:</span>          <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Bounce:</span>                <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">WritebackTmp:</span>          <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">CommitLimit:</span>     <span class="number">1931816</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">Committed_AS:</span>    <span class="number">7402668</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">VmallocTotal:</span>   <span class="number">34359738367</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">VmallocUsed:</span>      <span class="number">187276</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">VmallocChunk:</span>   <span class="number">34359310332</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">HardwareCorrupted:</span>     <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">AnonHugePages:</span>    <span class="number">264192</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">CmaTotal:</span>              <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">CmaFree:</span>               <span class="number">0</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">HugePages_Total:</span>       <span class="number">0</span></span><br><span class="line"><span class="attr">HugePages_Free:</span>        <span class="number">0</span></span><br><span class="line"><span class="attr">HugePages_Rsvd:</span>        <span class="number">0</span></span><br><span class="line"><span class="attr">HugePages_Surp:</span>        <span class="number">0</span></span><br><span class="line"><span class="attr">Hugepagesize:</span>       <span class="number">2048</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">DirectMap4k:</span>      <span class="number">206720</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">DirectMap2M:</span>     <span class="number">3987456</span> <span class="string">kB</span></span><br><span class="line"><span class="attr">DirectMap1G:</span>     <span class="number">2097152</span> <span class="string">kB</span></span><br></pre></td></tr></table></figure><ul><li><p>bufferï¼šè¡¨ç¤ºå—è®¾å¤‡(block device)æ‰€å ç”¨çš„ç¼“å­˜é¡µï¼ŒåŒ…æ‹¬ï¼šç›´æ¥è¯»å†™å—è®¾å¤‡ã€ä»¥åŠæ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®(metadata)æ¯”å¦‚SuperBlockæ‰€ä½¿ç”¨çš„ç¼“å­˜é¡µï¼›</p></li><li><p>cacheï¼šè¡¨ç¤ºæ™®é€šæ–‡ä»¶æ•°æ®æ‰€å ç”¨çš„ç¼“å­˜é¡µã€‚</p></li></ul><p>äºŒè€…çš„åŒºåˆ«æ¨èé˜…è¯» <a href="http://linuxperf.com/?p=32" target="_blank" rel="noopener">FREEå‘½ä»¤æ˜¾ç¤ºçš„BUFFERSä¸CACHEDçš„åŒºåˆ«</a>ï¼Œä» Linux å†…æ ¸æºç æ¥åŒºåˆ†ã€‚</p><h4 id="net"><a href="#net" class="headerlink" title="net"></a>net</h4><ul><li>arp</li></ul><p>ç”¨æ¥æŸ¥çœ‹ç³»ç»Ÿ arp ç¼“å­˜çš„æ˜ å°„è¡¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-node-3 /proc/net</span><br><span class="line">â•°â”€# cat arp</span><br><span class="line">IP address       HW type     Flags       HW address            Mask     Device</span><br><span class="line">169.254.169.254  0x1         0x0         00:00:00:00:00:00     *        ens160</span><br><span class="line">100.78.36.67     0x1         0x2         ee:25:17:a5:e9:3b     *        cali35f7ecfd8a4</span><br><span class="line">10.20.172.212    0x1         0x2         00:0c:29:16:f5:1f     *        ens160</span><br><span class="line">100.78.36.65     0x1         0x2         d6:80:af:8a:22:c7     *        calid838acfbeda</span><br><span class="line">10.20.172.1      0x1         0x2         00:00:5e:00:01:3a     *        ens160</span><br><span class="line">10.20.172.102    0x1         0x2         00:21:91:53:e8:a3     *        ens160</span><br><span class="line">10.20.172.254    0x1         0x2         5c:dd:70:05:e8:53     *        ens160</span><br><span class="line">10.20.172.106    0x1         0x2         98:90:96:d0:86:8a     *        ens160</span><br></pre></td></tr></table></figure><ul><li>route</li></ul><p>ä»¥æ ‘çº§ç»“æ„åˆ—å‡ºç³»ç»Ÿçš„è·¯ç”±è¡¨ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-node-3 ~</span><br><span class="line">â•°â”€# cat /proc/net/fib_trie</span><br><span class="line">Main:</span><br><span class="line">  +-- 0.0.0.0/0 3 1 5</span><br><span class="line">  +-- 0.0.0.0/4 2 0 2</span><br><span class="line">  |-- 0.0.0.0</span><br><span class="line">  /0 universe UNICAST</span><br><span class="line">  +-- 10.0.0.0/9 2 0 2</span><br><span class="line">  +-- 10.20.172.0/24 2 1 2</span><br><span class="line">  |-- 10.20.172.0</span><br><span class="line">  /32 link BROADCAST</span><br><span class="line">  /24 link UNICAST</span><br><span class="line">  +-- 10.20.172.192/26 2 0 2</span><br><span class="line">  |-- 10.20.172.211</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.20.172.255</span><br><span class="line">  /32 link BROADCAST</span><br><span class="line">  +-- 10.96.0.0/12 4 1 7</span><br><span class="line">  +-- 10.96.0.0/16 2 0 1</span><br><span class="line">  +-- 10.96.0.0/28 2 0 2</span><br><span class="line">  |-- 10.96.0.1</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.96.0.10</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.96.94.140</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.96.130.114</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.99.89.188</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.101.71.131</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.104.241.211</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.107.246.53</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.108.171.54</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.109.20.145</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.110.206.28</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 10.111.25.53</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  +-- 96.0.0.0/3 2 0 2</span><br><span class="line">  +-- 100.64.0.0/10 3 0 3</span><br><span class="line">  +-- 100.78.36.64/26 3 0 6</span><br><span class="line">  +-- 100.78.36.64/30 2 0 0</span><br><span class="line">  |-- 100.78.36.64</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  /32 link BROADCAST</span><br><span class="line">  /26 universe BLACKHOLE</span><br><span class="line">  |-- 100.78.36.65</span><br><span class="line">  /32 link UNICAST</span><br><span class="line">  |-- 100.78.36.66</span><br><span class="line">  /32 link UNICAST</span><br><span class="line">  |-- 100.78.36.67</span><br><span class="line">  /32 link UNICAST</span><br><span class="line">  |-- 100.78.36.105</span><br><span class="line">  /32 link UNICAST</span><br><span class="line">  |-- 100.87.114.192</span><br><span class="line">  /26 universe UNICAST</span><br><span class="line">  |-- 100.107.127.64</span><br><span class="line">  /26 universe UNICAST</span><br><span class="line">  |-- 100.112.151.128</span><br><span class="line">  /26 universe UNICAST</span><br><span class="line">  |-- 100.123.190.192</span><br><span class="line">  /26 universe UNICAST</span><br><span class="line">  +-- 127.0.0.0/8 2 0 2</span><br><span class="line">  +-- 127.0.0.0/31 1 0 0</span><br><span class="line">  |-- 127.0.0.0</span><br><span class="line">  /32 link BROADCAST</span><br><span class="line">  /8 host LOCAL</span><br><span class="line">  |-- 127.0.0.1</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 127.255.255.255</span><br><span class="line">  /32 link BROADCAST</span><br><span class="line">  +-- 168.0.0.0/5 2 0 2</span><br><span class="line">  |-- 169.254.0.0</span><br><span class="line">  /16 link UNICAST</span><br><span class="line">  +-- 172.16.0.0/14 3 0 6</span><br><span class="line">  +-- 172.17.0.0/31 1 0 0</span><br><span class="line">  |-- 172.17.0.0</span><br><span class="line">  /32 link BROADCAST</span><br><span class="line">  /16 link UNICAST</span><br><span class="line">  |-- 172.17.0.1</span><br><span class="line">  /32 host LOCAL</span><br><span class="line">  |-- 172.17.255.255</span><br><span class="line">  /32 link BROADCAST</span><br></pre></td></tr></table></figure><ul><li>nf_conntrack</li></ul><blockquote><p>nf_conntrack(åœ¨è€ç‰ˆæœ¬çš„ Linux å†…æ ¸ä¸­å« ip_conntrack)æ˜¯ä¸€ä¸ªå†…æ ¸æ¨¡å—,ç”¨äºè·Ÿè¸ªä¸€ä¸ªè¿æ¥çš„çŠ¶æ€çš„ã€‚è¿æ¥çŠ¶æ€è·Ÿè¸ªå¯ä»¥ä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨,æœ€å¸¸è§çš„ä¸¤ä¸ªä½¿ç”¨åœºæ™¯æ˜¯ iptables çš„ nat çš„ state æ¨¡å—ã€‚ iptables çš„ nat é€šè¿‡è§„åˆ™æ¥ä¿®æ”¹ç›®çš„/æºåœ°å€,ä½†å…‰ä¿®æ”¹åœ°å€ä¸è¡Œ,æˆ‘ä»¬è¿˜éœ€è¦èƒ½è®©å›æ¥çš„åŒ…èƒ½è·¯ç”±åˆ°æœ€åˆçš„æ¥æºä¸»æœºã€‚è¿™å°±éœ€è¦å€ŸåŠ© nf_conntrack æ¥æ‰¾åˆ°åŸæ¥é‚£ä¸ªè¿æ¥çš„è®°å½•æ‰è¡Œã€‚è€Œ state æ¨¡å—åˆ™æ˜¯ç›´æ¥ä½¿ç”¨ nf_conntrack é‡Œè®°å½•çš„è¿æ¥çš„çŠ¶æ€æ¥åŒ¹é…ç”¨æˆ·å®šä¹‰çš„ç›¸å…³è§„åˆ™ã€‚ä¾‹å¦‚ä¸‹é¢è¿™æ¡ INPUT è§„åˆ™ç”¨äºæ”¾è¡Œ 80 ç«¯å£ä¸Šçš„çŠ¶æ€ä¸º NEW çš„è¿æ¥ä¸Šçš„åŒ…ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-node-3 /proc/net</span><br><span class="line">â•°â”€# cat nf_conntrack | head -n 4</span><br><span class="line">ipv4     2 tcp      6 102 SYN_SENT src=10.20.172.211 dst=10.10.107.214 sport=42562 dport=179 [UNREPLIED] src=10.10.107.214 dst=10.20.172.211 sport=179 dport=42562 mark=0 secctx=system_u:object_r:unlabeled_t:s0 zone=0 use=2</span><br><span class="line">ipv4     2 tcp      6 79 SYN_SENT src=10.20.172.211 dst=10.10.107.214 sport=60579 dport=179 [UNREPLIED] src=10.10.107.214 dst=10.20.172.211 sport=179 dport=60579 mark=0 secctx=system_u:object_r:unlabeled_t:s0 zone=0 use=2</span><br><span class="line">ipv4     2 tcp      6 86366 ESTABLISHED src=10.20.172.211 dst=10.10.107.121 sport=58589 dport=179 src=10.10.107.121 dst=10.20.172.211 sport=179 dport=58589 [ASSURED] mark=0 secctx=system_u:object_r:unlabeled_t:s0 zone=0 use=2</span><br><span class="line">ipv4     2 tcp      6 62 SYN_SENT src=10.20.172.211 dst=10.10.107.214 sport=37531 dport=179 [UNREPLIED] src=10.10.107.214 dst=10.20.172.211 sport=179 dport=37531 mark=0 secctx=system_u:object_r:unlabeled_t:s0 zone=0 use=2</span><br></pre></td></tr></table></figure><ul><li><a href="http://www.linvon.cn/post/%E8%BF%9E%E6%8E%A5%E8%B7%9F%E8%B8%AAnf_conntrack%E4%B8%8Enat%E5%92%8C%E7%8A%B6%E6%80%81iptables/" target="_blank" rel="noopener">è¿æ¥è·Ÿè¸ªnf_conntrackä¸NATå’ŒçŠ¶æ€é˜²ç«å¢™</a></li><li><a href="https://www.cnblogs.com/liushaodong/archive/2013/02/26/2933593.html" target="_blank" rel="noopener">netfilter é“¾æ¥è·Ÿè¸ªæœºåˆ¶ä¸NATåŸç†</a></li><li><a href="http://blog.chinaunix.net/uid-23069658-id-3169450.html" target="_blank" rel="noopener">(äº”)æ´æ‚‰linuxä¸‹çš„Netfilter&amp;iptablesï¼šå¦‚ä½•ç†è§£è¿æ¥è·Ÿè¸ªæœºåˆ¶ï¼Ÿ</a></li><li><a href="https://clodfisher.github.io/2018/09/nf_conntrack/" target="_blank" rel="noopener">Iptablesä¹‹nf_conntrackæ¨¡å—</a></li></ul><h4 id="kernel"><a href="#kernel" class="headerlink" title="kernel"></a>kernel</h4><p>å¯ä»¥ç”¨æ¥æŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-01 proc]# uname -a</span><br><span class="line">Linux k8s-master-01 3.10.0-862.el7.x86_64 #1 SMP Fri Apr 20 16:44:24 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line">[root@k8s-master-01 proc]# cat version</span><br><span class="line">Linux version 3.10.0-862.el7.x86_64 (builder@kbuilder.dev.centos.org) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-28) (GCC) ) #1 SMP Fri Apr 20 16:44:24 UTC 2018</span><br></pre></td></tr></table></figure><h3 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h3><h4 id="nc-netcat"><a href="#nc-netcat" class="headerlink" title="nc netcat"></a>nc netcat</h4><p>nc æ˜¯ä¸ªç‘å£«å†›åˆ€å•Šï¼Œä½ èƒ½æƒ³åˆ°çš„ä½ æƒ³ä¸åˆ°çš„éƒ½èƒ½åšï¼Œåœ¨è¿™é‡Œä»…ä»…åˆ—å‡ºå‡ ä¸ªå¸¸ç”¨å¸¸ç”¨çš„å‘½ä»¤ï¼Œå’±å¹³æ—¶ä¸»è¦ç”¨æ¥åˆ¤æ–­ä¸»æœºç«¯å£æ˜¯å¦æ­£å¸¸ï¼Œæƒ³è¦å®Œæ•´åœ°äº†è§£æ¨èé˜…è¯»ä¸‹é¢æåˆ°çš„æ–‡ç« ã€‚ä¹‹å‰ç¼–ç¨‹éšæƒ³å¤§ä½¬ä¹Ÿå†™è¿‡ nc å‘½ä»¤çš„ä½¿ç”¨è¯¦è§£ã€‚</p><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> RHEL/CentOS</span></span><br><span class="line">yum install netcat</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian/Ubuntu</span></span><br><span class="line">apt install netcat</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ä¸»æœºç«¯å£æ˜¯å¦æ‰“å¼€</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹è¿œç¨‹ä¸»æœºç«¯å£æ˜¯å¦æ‰“å¼€</span></span><br><span class="line">â•­â”€root@blog /opt/shell</span><br><span class="line">â•°â”€# nc -vz bing.com 443</span><br><span class="line">DNS fwd/rev mismatch: bing.com != a-0001.a-msedge.net</span><br><span class="line">Warning: inverse host lookup failed for 13.107.21.200: Unknown host</span><br><span class="line">bing.com [204.79.197.200] 443 (https) open</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æœ¬æœºç«¯å£æ˜¯å¦è¢«å ç”¨</span></span><br><span class="line">â•­â”€root@blog /opt/shell</span><br><span class="line">â•°â”€# nc -lp 80 -v                                                                    1 â†µ</span><br><span class="line">retrying local 0.0.0.0:80 : Address already in use</span><br></pre></td></tr></table></figure><ul><li>ç”¨ nc ä¼ è¾“æ–‡ä»¶</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ¥æ”¶ç«¯ã€‘ï¼ˆB ä¸»æœºï¼‰è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ˆå…¶ä¸­çš„ xxx æ˜¯ç«¯å£å·ï¼‰</span></span><br><span class="line">nc -l -p xxx &gt; file2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç„¶ååœ¨ã€å‘é€ç«¯ã€‘ï¼ˆA ä¸»æœºï¼‰è¿è¡Œå¦‚ä¸‹å‘½ä»¤</span></span><br><span class="line">nc x.x.x.x xxx &lt; file1</span><br></pre></td></tr></table></figure><ul><li><a href="https://program-think.blogspot.com/2019/09/Netcat-Tricks.html" target="_blank" rel="noopener">æ‰«ç›² netcatï¼ˆç½‘çŒ«ï¼‰çš„ N ç§ç”¨æ³•â€”â€”ä»â€œç½‘ç»œè¯Šæ–­â€åˆ°â€œç³»ç»Ÿå…¥ä¾µâ€</a></li></ul><h4 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h4><p>nmap å‘½ä»¤ç”¨çš„æœ€å¤šçš„å°±æ˜¯ç«¯å£æ‰«æï¼Œåœ¨æ¸—é€é¢†åŸŸå¤šç”¨æ¥æ‰«æå†…ç½‘æœºå™¨ã€‚</p><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> RHEL/CentOS</span></span><br><span class="line">yum install nmap</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian/Ubuntu</span></span><br><span class="line">apt install nmap</span><br></pre></td></tr></table></figure><ul><li>æ‰«æç±»å‹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-sT    TCP connect() æ‰«æï¼Œè¿™æ˜¯æœ€åŸºæœ¬çš„ TCP æ‰«ææ–¹å¼ã€‚è¿™ç§æ‰«æå¾ˆå®¹æ˜“è¢«æ£€æµ‹åˆ°ï¼Œåœ¨ç›®æ ‡ä¸»æœºçš„æ—¥å¿—ä¸­ä¼šè®°å½•å¤§æ‰¹çš„è¿æ¥è¯·æ±‚ä»¥åŠé”™è¯¯ä¿¡æ¯ã€‚</span><br><span class="line">-sS    TCP åŒæ­¥æ‰«æ (TCP SYN)ï¼Œå› ä¸ºä¸å¿…å…¨éƒ¨æ‰“å¼€ä¸€ä¸ª TCP è¿æ¥ï¼Œæ‰€ä»¥è¿™é¡¹æŠ€æœ¯é€šå¸¸ç§°ä¸ºåŠå¼€æ‰«æ (half-open)ã€‚è¿™é¡¹æŠ€æœ¯æœ€å¤§çš„å¥½å¤„æ˜¯ï¼Œå¾ˆå°‘æœ‰ç³»ç»Ÿèƒ½å¤ŸæŠŠè¿™è®°å…¥ç³»ç»Ÿæ—¥å¿—ã€‚ä¸è¿‡ï¼Œä½ éœ€è¦ root æƒé™æ¥å®šåˆ¶ SYN æ•°æ®åŒ…ã€‚</span><br><span class="line">-sF,-sX,-sN    ç§˜å¯† FIN æ•°æ®åŒ…æ‰«æã€åœ£è¯æ ‘ (Xmas Tree)ã€ç©º (Null) æ‰«ææ¨¡å¼ã€‚è¿™äº›æ‰«ææ–¹å¼çš„ç†è®ºä¾æ®æ˜¯ï¼šå…³é—­çš„ç«¯å£éœ€è¦å¯¹ä½ çš„æ¢æµ‹åŒ…å›åº” RST åŒ…ï¼Œè€Œæ‰“å¼€çš„ç«¯å£å¿…éœ€å¿½ç•¥æœ‰é—®é¢˜çš„åŒ…ï¼ˆå‚è€ƒ RFC 793 ç¬¬ 64 é¡µï¼‰ã€‚</span><br><span class="line">-sP    ping æ‰«æï¼Œç”¨ ping æ–¹å¼æ£€æŸ¥ç½‘ç»œä¸Šå“ªäº›ä¸»æœºæ­£åœ¨è¿è¡Œã€‚å½“ä¸»æœºé˜»å¡ ICMP echo è¯·æ±‚åŒ…æ˜¯ ping æ‰«ææ˜¯æ— æ•ˆçš„ã€‚nmap åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¼šè¿›è¡Œ ping æ‰«æï¼Œåªæœ‰ç›®æ ‡ä¸»æœºå¤„äºè¿è¡ŒçŠ¶æ€ï¼Œæ‰ä¼šè¿›è¡Œåç»­çš„æ‰«æã€‚</span><br><span class="line">-sU    UDP çš„æ•°æ®åŒ…è¿›è¡Œæ‰«æï¼Œå¦‚æœä½ æƒ³çŸ¥é“åœ¨æŸå°ä¸»æœºä¸Šæä¾›å“ªäº› UDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼ŒRFC768) æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨æ­¤é€‰é¡¹ã€‚</span><br><span class="line">-sA    ACK æ‰«æï¼Œè¿™é¡¹é«˜çº§çš„æ‰«ææ–¹æ³•é€šå¸¸å¯ä»¥ç”¨æ¥ç©¿è¿‡é˜²ç«å¢™ã€‚</span><br><span class="line">-sW    æ»‘åŠ¨çª—å£æ‰«æï¼Œéå¸¸ç±»ä¼¼äº ACK çš„æ‰«æã€‚</span><br><span class="line">-sR    RPC æ‰«æï¼Œå’Œå…¶å®ƒä¸åŒçš„ç«¯å£æ‰«ææ–¹æ³•ç»“åˆä½¿ç”¨ã€‚</span><br><span class="line">-b    FTP åå¼¹æ”»å‡» (bounce attack)ï¼Œè¿æ¥åˆ°é˜²ç«å¢™åé¢çš„ä¸€å° FTP æœåŠ¡å™¨åšä»£ç†ï¼Œæ¥ç€è¿›è¡Œç«¯å£æ‰«æã€‚</span><br></pre></td></tr></table></figure><ul><li>æ‰«æå‚æ•°</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-P0    åœ¨æ‰«æä¹‹å‰ï¼Œä¸ ping ä¸»æœºã€‚</span><br><span class="line">-PT    æ‰«æä¹‹å‰ï¼Œä½¿ç”¨ TCP ping ç¡®å®šå“ªäº›ä¸»æœºæ­£åœ¨è¿è¡Œã€‚</span><br><span class="line">-PS    å¯¹äº root ç”¨æˆ·ï¼Œè¿™ä¸ªé€‰é¡¹è®© nmap ä½¿ç”¨ SYN åŒ…è€Œä¸æ˜¯ ACK åŒ…æ¥å¯¹ç›®æ ‡ä¸»æœºè¿›è¡Œæ‰«æã€‚</span><br><span class="line">-PI    è®¾ç½®è¿™ä¸ªé€‰é¡¹ï¼Œè®© nmap ä½¿ç”¨çœŸæ­£çš„ ping(ICMP echo è¯·æ±‚ï¼‰æ¥æ‰«æç›®æ ‡ä¸»æœºæ˜¯å¦æ­£åœ¨è¿è¡Œã€‚</span><br><span class="line">-PB    è¿™æ˜¯é»˜è®¤çš„ ping æ‰«æé€‰é¡¹ã€‚å®ƒä½¿ç”¨ ACK(-PT) å’Œ ICMP(-PI) ä¸¤ç§æ‰«æç±»å‹å¹¶è¡Œæ‰«æã€‚å¦‚æœé˜²ç«å¢™èƒ½å¤Ÿè¿‡æ»¤å…¶ä¸­ä¸€ç§åŒ…ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œä½ å°±èƒ½å¤Ÿç©¿è¿‡é˜²ç«å¢™ã€‚</span><br><span class="line">-O    è¿™ä¸ªé€‰é¡¹æ¿€æ´»å¯¹ TCP/IP æŒ‡çº¹ç‰¹å¾ (fingerprinting) çš„æ‰«æï¼Œè·å¾—è¿œç¨‹ä¸»æœºçš„æ ‡å¿—ï¼Œä¹Ÿå°±æ˜¯æ“ä½œç³»ç»Ÿç±»å‹ã€‚</span><br><span class="line">-I    æ‰“å¼€ nmap çš„åå‘æ ‡å¿—æ‰«æåŠŸèƒ½ã€‚</span><br><span class="line">-f    ä½¿ç”¨ç¢ç‰‡ IP æ•°æ®åŒ…å‘é€ SYNã€FINã€XMASã€NULLã€‚åŒ…å¢åŠ åŒ…è¿‡æ»¤ã€å…¥ä¾µæ£€æµ‹ç³»ç»Ÿçš„éš¾åº¦ï¼Œä½¿å…¶æ— æ³•çŸ¥é“ä½ çš„ä¼å›¾ã€‚</span><br><span class="line">-v    å†—ä½™æ¨¡å¼ã€‚å¼ºçƒˆæ¨èä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œå®ƒä¼šç»™å‡ºæ‰«æè¿‡ç¨‹ä¸­çš„è¯¦ç»†ä¿¡æ¯ã€‚</span><br><span class="line">-S &lt;IP&gt;    åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œnmap å¯èƒ½æ— æ³•ç¡®å®šä½ çš„æºåœ°å€ (nmap ä¼šå‘Šè¯‰ä½ ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä½¿ç”¨è¿™ä¸ªé€‰é¡¹ç»™å‡ºä½ çš„ IP åœ°å€ã€‚</span><br><span class="line">-g port    è®¾ç½®æ‰«æçš„æºç«¯å£ã€‚ä¸€äº›å¤©çœŸçš„é˜²ç«å¢™å’ŒåŒ…è¿‡æ»¤å™¨çš„è§„åˆ™é›†å…è®¸æºç«¯å£ä¸º DNS(53) æˆ–è€… FTP-DATA(20) çš„åŒ…é€šè¿‡å’Œå®ç°è¿æ¥ã€‚æ˜¾ç„¶ï¼Œå¦‚æœæ”»å‡»è€…æŠŠæºç«¯å£ä¿®æ”¹ä¸º 20 æˆ–è€… 53ï¼Œå°±å¯ä»¥æ‘§æ¯é˜²ç«å¢™çš„é˜²æŠ¤ã€‚</span><br><span class="line">-oN    æŠŠæ‰«æç»“æœé‡å®šå‘åˆ°ä¸€ä¸ªå¯è¯»çš„æ–‡ä»¶ logfilename ä¸­ã€‚</span><br><span class="line">-oS    æ‰«æç»“æœè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚</span><br><span class="line">--host_timeout    è®¾ç½®æ‰«æä¸€å°ä¸»æœºçš„æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰è¶…æ—¶é™åˆ¶ã€‚</span><br><span class="line">--max_rtt_timeout    è®¾ç½®å¯¹æ¯æ¬¡æ¢æµ‹çš„ç­‰å¾…æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚å¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´é™åˆ¶å°±é‡ä¼ æˆ–è€…è¶…æ—¶ã€‚é»˜è®¤å€¼æ˜¯å¤§çº¦ 9000 æ¯«ç§’ã€‚</span><br><span class="line">--min_rtt_timeout    è®¾ç½® nmap å¯¹æ¯æ¬¡æ¢æµ‹è‡³å°‘ç­‰å¾…ä½ æŒ‡å®šçš„æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚</span><br><span class="line">-M count    ç½®è¿›è¡Œ TCP connect() æ‰«ææ—¶ï¼Œæœ€å¤šä½¿ç”¨å¤šå°‘ä¸ªå¥—æ¥å­—è¿›è¡Œå¹¶è¡Œçš„æ‰«æã€‚</span><br></pre></td></tr></table></figure><ul><li>è·å–è¿œç¨‹ä¸»æœºç³»ç»Ÿç±»å‹å’Œå¼€æ”¾ç«¯å£</li></ul><p>ç²—æš´ç‚¹å°± <code>nmap -A IP</code>ï¼Œæˆ–è€… <code>nmap -sS -P0 -sV -O</code></p><ul><li>æ¢æµ‹å†…ç½‘åœ¨çº¿ä¸»æœº</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.0.0/24</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><h4 id="fio"><a href="#fio" class="headerlink" title="fio"></a><a href="https://github.com/axboe/fio" target="_blank" rel="noopener">fio</a></h4><p>ç”¨æ¥åšç£ç›˜æ€§èƒ½æµ‹è¯•ï¼Œååˆ†å¼ºå¤§çš„ç£ç›˜æ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œå¯é…ç½®é¡¹å’Œå‚æ•°ä¹Ÿå¾ˆä¸°å¯Œã€‚</p><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> RHEL/CentOS</span></span><br><span class="line">yum install fio</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian/Ubuntu</span></span><br><span class="line">apt install fio</span><br></pre></td></tr></table></figure><ul><li>usage</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">filename</span>=/tmp        <span class="comment"># æµ‹è¯•æ–‡ä»¶åç§°ï¼Œé€šå¸¸é€‰æ‹©éœ€è¦æµ‹è¯•çš„ç›˜çš„ data ç›®å½•</span></span><br><span class="line"><span class="attr">direct</span>=<span class="number">1</span>             <span class="comment"># æµ‹è¯•è¿‡ç¨‹ç»•è¿‡æœºå™¨è‡ªå¸¦çš„ bufferã€‚ä½¿æµ‹è¯•ç»“æœæ›´çœŸå®</span></span><br><span class="line"><span class="attr">rw</span>=randwrite         <span class="comment"># æµ‹è¯•éšæœºå†™çš„ I/O</span></span><br><span class="line"><span class="attr">rw</span>=randrw            <span class="comment"># æµ‹è¯•éšæœºå†™å’Œè¯»çš„ I/O</span></span><br><span class="line"><span class="attr">bs</span>=<span class="number">16</span>k               <span class="comment"># å•æ¬¡ io çš„å—æ–‡ä»¶å¤§å°ä¸º 16k</span></span><br><span class="line"><span class="attr">bsrange</span>=<span class="number">512</span>-<span class="number">2048</span>     <span class="comment"># åŒä¸Šï¼Œæå®šæ•°æ®å—çš„å¤§å°èŒƒå›´</span></span><br><span class="line"><span class="attr">size</span>=<span class="number">5</span>G              <span class="comment"># æœ¬æ¬¡çš„æµ‹è¯•æ–‡ä»¶å¤§å°ä¸º 5gï¼Œä»¥æ¯æ¬¡ 4k çš„ io è¿›è¡Œæµ‹è¯•</span></span><br><span class="line"><span class="attr">numjobs</span>=<span class="number">30</span>           <span class="comment"># æœ¬æ¬¡çš„æµ‹è¯•çº¿ç¨‹ä¸º 30 ä¸ª</span></span><br><span class="line"><span class="attr">runtime</span>=<span class="number">1000</span>         <span class="comment"># æµ‹è¯•æ—¶é—´ 1000 ç§’ï¼Œå¦‚æœä¸å†™åˆ™ä¸€ç›´å°† 5g æ–‡ä»¶åˆ† 4k æ¯æ¬¡å†™å®Œä¸ºæ­¢</span></span><br><span class="line"><span class="attr">ioengine</span>=psync       <span class="comment">#io å¼•æ“ä½¿ç”¨ psync æ–¹å¼</span></span><br><span class="line"><span class="attr">rwmixwrite</span>=<span class="number">30</span>        <span class="comment"># åœ¨æ··åˆè¯»å†™çš„æ¨¡å¼ä¸‹ï¼Œå†™å  30%</span></span><br><span class="line">group_reporting      # å…³äºæ˜¾ç¤ºç»“æœçš„ï¼Œæ±‡æ€»æ¯ä¸ªè¿›ç¨‹çš„ä¿¡æ¯</span><br><span class="line"></span><br><span class="line"><span class="attr">lockmem</span>=<span class="number">1</span>G           <span class="comment"># åªä½¿ç”¨ 1g å†…å­˜è¿›è¡Œæµ‹è¯•s</span></span><br><span class="line">zero_buffers         # ç”¨ 0 åˆå§‹åŒ–ç³»ç»Ÿ buffer</span><br><span class="line"><span class="attr">nrfiles</span>=<span class="number">8</span>            <span class="comment"># æ¯ä¸ªè¿›ç¨‹ç”Ÿæˆæ–‡ä»¶çš„æ•°é‡</span></span><br></pre></td></tr></table></figure><p><code>æ³¨æ„ï¼š</code> åªè¦ä¸æ˜¯æµ‹è¯•ç©ºç›˜ï¼Œ<code>filename</code> å‚æ•°åƒä¸‡ä¸è¦ä½¿ç”¨ç±»ä¼¼ <code>/dev/sda</code> è¿™æ— å¼‚äºåˆ åº“è·‘è·¯ğŸ˜‚ã€‚æ‰€ä»¥æ¨èä½¿ç”¨è·¯å¾„è€Œä¸æ˜¯è®¾å¤‡ã€‚</p><ul><li>output example</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@nfs ~</span><br><span class="line">â•°â”€# fio -filename=/tmp/test.file -direct=1 -iodepth 1 -thread -rw=randrw -rwmixread=70 -ioengine=psync -bs=16k -size=1G -numjobs=30 -runtime=100 -group_reporting -name=mytest1</span><br><span class="line">mytest1: (g=0): rw=randrw, bs=(R) 16.0KiB-16.0KiB, (W) 16.0KiB-16.0KiB, (T) 16.0KiB-16.0KiB, ioengine=psync, iodepth=1</span><br><span class="line">...</span><br><span class="line">fio-3.7</span><br><span class="line">Starting 30 threads</span><br><span class="line">mytest1: Laying out IO file (1 file / 1024MiB)</span><br><span class="line">Jobs: 30 (f=30): [m(30)][100.0%][r=1265KiB/s,w=560KiB/s][r=79,w=35 IOPS][eta 00m:00s]</span><br><span class="line">mytest1: (groupid=0, jobs=30): err= 0: pid=45930: Mon Apr 27 23:09:21 2020</span><br><span class="line">read: IOPS=71, BW=1149KiB/s (1177kB/s)(113MiB/100321msec)</span><br><span class="line"> clat (usec): min=349, max=999812, avg=292473.60, stdev=188905.70</span><br><span class="line">  lat (usec): min=349, max=999813, avg=292473.83, stdev=188905.69</span><br><span class="line"> clat percentiles (msec):</span><br><span class="line">  |  1.00th=[    5],  5.00th=[    8], 10.00th=[   11], 20.00th=[   24],</span><br><span class="line">  | 30.00th=[  247], 40.00th=[  313], 50.00th=[  342], 60.00th=[  372],</span><br><span class="line">  | 70.00th=[  401], 80.00th=[  430], 90.00th=[  481], 95.00th=[  542],</span><br><span class="line">  | 99.00th=[  751], 99.50th=[  818], 99.90th=[  894], 99.95th=[  936],</span><br><span class="line">  | 99.99th=[ 1003]</span><br><span class="line">bw (  KiB/s): min=   31, max=   96, per=3.53%, avg=40.55, stdev=14.30, samples=5661</span><br><span class="line">iops        : min=    1, max=    6, avg= 2.48, stdev= 0.93, samples=5661</span><br><span class="line">  write: IOPS=30, BW=483KiB/s (494kB/s)(47.3MiB/100321msec)</span><br><span class="line"> clat (msec): min=2, max=937, avg=297.02, stdev=194.75</span><br><span class="line">  lat (msec): min=2, max=937, avg=297.02, stdev=194.75</span><br><span class="line"> clat percentiles (msec):</span><br><span class="line">  |  1.00th=[    5],  5.00th=[    9], 10.00th=[   11], 20.00th=[   16],</span><br><span class="line">  | 30.00th=[  266], 40.00th=[  326], 50.00th=[  355], 60.00th=[  380],</span><br><span class="line">  | 70.00th=[  405], 80.00th=[  435], 90.00th=[  481], 95.00th=[  550],</span><br><span class="line">  | 99.00th=[  760], 99.50th=[  810], 99.90th=[  902], 99.95th=[  927],</span><br><span class="line">  | 99.99th=[  936]</span><br><span class="line">bw (  KiB/s): min=   31, max=  256, per=9.65%, avg=46.52, stdev=25.43, samples=2071</span><br><span class="line">iops        : min=    1, max=   16, avg= 2.85, stdev= 1.61, samples=2071</span><br><span class="line">  lat (usec)   : 500=0.02%, 750=0.02%</span><br><span class="line">  lat (msec)   : 4=0.28%, 10=8.53%, 20=10.86%, 50=6.42%, 100=0.90%</span><br><span class="line">  lat (msec)   : 250=2.90%, 500=62.21%, 750=6.79%, 1000=1.06%</span><br><span class="line">  cpu          : usr=0.00%, sys=0.01%, ctx=19413, majf=0, minf=7</span><br><span class="line">  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%</span><br><span class="line">  submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">  complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">  issued rwts: total=7204,3026,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br><span class="line">  latency   : target=0, window=0, percentile=100.00%, depth=1</span><br><span class="line"></span><br><span class="line">Run status group 0 (all jobs):</span><br><span class="line">READ: bw=1149KiB/s (1177kB/s), 1149KiB/s-1149KiB/s (1177kB/s-1177kB/s), io=113MiB (118MB), run=100321-100321msec</span><br><span class="line">  WRITE: bw=483KiB/s (494kB/s), 483KiB/s-483KiB/s (494kB/s-494kB/s), io=47.3MiB (49.6MB), run=100321-100321msec</span><br><span class="line"></span><br><span class="line">Disk stats (read/write):</span><br><span class="line"> dm-0: ios=7750/3320, merge=0/0, ticks=200950/123253, in_queue=324237, util=99.83%, aggrios=7765/3135, aggrmerge=0/192, aggrticks=201237/111717, aggrin_queue=312951, aggrutil=99.81%</span><br><span class="line">  sda: ios=7765/3135, merge=0/192, ticks=201237/111717, in_queue=312951, util=99.81%</span><br></pre></td></tr></table></figure><h4 id="qperf"><a href="#qperf" class="headerlink" title="qperf"></a>qperf</h4><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install qperf</span><br><span class="line">apt install qperf</span><br></pre></td></tr></table></figure><ul><li>usage</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@debian /opt/trojan</span><br><span class="line">â•°â”€# qperf --help examples</span><br><span class="line">In these examples, we first run qperf on a node called myserver in server</span><br><span class="line">mode by invoking it with no arguments.  In all the subsequent examples, we</span><br><span class="line">run qperf on another node and connect to the server which we assume has a</span><br><span class="line">hostname of myserver.</span><br><span class="line"> * To run a TCP bandwidth and latency test:</span><br><span class="line">  qperf myserver tcp_bw tcp_lat</span><br><span class="line"> * To run a SDP bandwidth test for 10 seconds:</span><br><span class="line">  qperf myserver -t 10 sdp_bw</span><br><span class="line"> * To run a UDP latency test and then cause the server to terminate:</span><br><span class="line">  qperf myserver udp_lat quit</span><br><span class="line"> * To measure the RDMA UD latency and bandwidth:</span><br><span class="line">  qperf myserver ud_lat ud_bw</span><br><span class="line"> * To measure RDMA UC bi-directional bandwidth:</span><br><span class="line">  qperf myserver rc_bi_bw</span><br><span class="line"> * To get a range of TCP latencies with a message size from 1 to 64K</span><br><span class="line">  qperf myserver -oo msg_size:1:64K:*2 -vu tcp_lat</span><br></pre></td></tr></table></figure><ul><li>output example</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">root@debian-node-02-656868cc46-72lc9:/# qperf  -t 30 100.107.127.100 -v tcp_bw udp_bw tcp_lat udp_lat conf</span><br><span class="line">tcp_bw:</span><br><span class="line"> bw              =  3.24 GB/sec</span><br><span class="line"> msg_rate        =  49.4 K/sec</span><br><span class="line"> time            =    30 sec</span><br><span class="line"> send_cost       =   542 ms/GB</span><br><span class="line"> recv_cost       =   542 ms/GB</span><br><span class="line"> send_cpus_used  =   176 % cpus</span><br><span class="line"> recv_cpus_used  =   176 % cpus</span><br><span class="line">udp_bw:</span><br><span class="line"> send_bw         =  2.62 GB/sec</span><br><span class="line"> recv_bw         =  2.37 GB/sec</span><br><span class="line"> msg_rate        =  72.3 K/sec</span><br><span class="line"> time            =    30 sec</span><br><span class="line"> send_cost       =   542 ms/GB</span><br><span class="line"> recv_cost       =   598 ms/GB</span><br><span class="line"> send_cpus_used  =   142 % cpus</span><br><span class="line"> recv_cpus_used  =   142 % cpus</span><br><span class="line">tcp_lat:</span><br><span class="line"> latency        =  17.3 us</span><br><span class="line"> msg_rate       =  57.7 K/sec</span><br><span class="line"> time           =    30 sec</span><br><span class="line"> loc_cpus_used  =   110 % cpus</span><br><span class="line"> rem_cpus_used  =   110 % cpus</span><br><span class="line">udp_lat:</span><br><span class="line"> latency        =  15.4 us</span><br><span class="line"> msg_rate       =  64.8 K/sec</span><br><span class="line"> time           =    30 sec</span><br><span class="line"> loc_cpus_used  =   111 % cpus</span><br><span class="line"> rem_cpus_used  =   111 % cpus</span><br><span class="line">conf:</span><br><span class="line"> loc_node   =  debian-node-02-656868cc46-72lc9</span><br><span class="line"> loc_cpu    =  8 Cores: Intel Xeon E3-1271 v3 @ 3.60GHz</span><br><span class="line"> loc_os     =  Linux 3.10.0-862.el7.x86_64</span><br><span class="line"> loc_qperf  =  0.4.11</span><br><span class="line"> rem_node   =  debian-node-02-656868cc46-xftvq</span><br><span class="line"> rem_cpu    =  8 Cores: Intel Xeon E3-1271 v3 @ 3.60GHz</span><br><span class="line"> rem_os     =  Linux 3.10.0-862.el7.x86_64</span><br><span class="line"> rem_qperf  =  0.4.11</span><br></pre></td></tr></table></figure><h4 id="iperf"><a href="#iperf" class="headerlink" title="iperf"></a>iperf</h4><ul><li><p>install</p></li><li><p>usage</p></li><li><p>output example</p></li></ul><h4 id="wrk"><a href="#wrk" class="headerlink" title="wrk"></a><a href="https://github.com/wg/wrk/" target="_blank" rel="noopener">wrk</a></h4><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/wg/wrk.git --depth=1</span><br><span class="line">cd wrk</span><br><span class="line">make</span><br></pre></td></tr></table></figure><ul><li>usage</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">./wrk</span><br><span class="line">Usage: wrk &lt;options&gt; &lt;url&gt;</span><br><span class="line">  Options:</span><br><span class="line"> -c, --connections &lt;N&gt;  Connections to keep open éœ€è¦æ¨¡æ‹Ÿçš„ä¸ªå¹¶å‘è¯·æ±‚è¿æ¥æ•°é‡</span><br><span class="line"> -d, --duration    &lt;T&gt;  Duration of test æµ‹è¯•çš„æµ‹è¯•æ—¶é•¿</span><br><span class="line"> -t, --threads     &lt;N&gt;  Number of threads to use å¹¶å‘çº¿ç¨‹æ•°é‡</span><br><span class="line"> -s, --script      &lt;S&gt;  Load Lua script file  æŒ‡å®š Lua è„šæœ¬çš„è·¯å¾„</span><br><span class="line"> -H, --header      &lt;H&gt;  Add header to request æŒ‡å®šè¯·æ±‚å¸¦çš„ Header å‚æ•°</span><br><span class="line">  --latency          Print latency statistics æ˜¯å¦æ‰“å°è¯·æ±‚å»¶è¿Ÿç»Ÿè®¡</span><br><span class="line">  --timeout     &lt;T&gt;  Socket/request timeout è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´</span><br></pre></td></tr></table></figure><ul><li>output example</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¯¹ 10.20.172.196 nginx æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•</span></span><br><span class="line">â•­â”€root@test ~/wrk â€¹masterâ€º</span><br><span class="line">â•°â”€# ./wrk -t100 -c512 -d30s http://10.20.172.196</span><br><span class="line">Running 30s test @ http://10.20.172.196</span><br><span class="line">  100 threads and 512 connections</span><br><span class="line">  Thread Stats   Avg      Stdev     Max   +/- Stdev</span><br><span class="line"> Latency    44.71ms  108.75ms   1.99s    89.05%</span><br><span class="line"> Req/Sec   369.78    207.57     1.68k    71.50%</span><br><span class="line">  987158 requests in 30.10s, 840.66MB read</span><br><span class="line">  Socket errors: connect 0, read 0, write 0, timeout 22</span><br><span class="line">Requests/sec:  32797.65</span><br><span class="line">Transfer/sec:     27.93MB</span><br><span class="line"><span class="meta">#</span><span class="bash"> æµ‹è¯•ç»“æœï¼ŒåŸºæœ¬èƒ½è¾¾åˆ° 3W+ çš„ QPS çš„æ€§èƒ½</span></span><br></pre></td></tr></table></figure><h4 id="httperf"><a href="#httperf" class="headerlink" title="httperf"></a>httperf</h4><ul><li><p>install</p></li><li><p>usage</p></li><li><p>output example</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@ubuntu-238 ~</span><br><span class="line">â•°â”€# httperf --server 10.20.172.196 --port 80 --num-conns 100 --rate 10 --timeout 1</span><br><span class="line">httperf --timeout=1 --client=0/1 --server=10.20.172.196 --port=80 --uri=/ --rate=10 --send-buffer=4096 --recv-buffer=16384 --num-conns=100 --num-calls=1</span><br><span class="line">httperf: warning: open file limit &gt; FD_SETSIZE; limiting max. # of open files to FD_SETSIZE</span><br><span class="line">Maximum connect burst length: 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> å“åº”é€Ÿç‡</span></span><br><span class="line">Total: connections 100 requests 100 replies 100 test-duration 9.900 s</span><br><span class="line">Connection rate: 10.1 conn/s (99.0 ms/conn, &lt;=1 concurrent connections)</span><br><span class="line">Connection time [ms]: min 0.1 avg 0.1 max 0.2 median 0.5 stddev 0.0</span><br><span class="line">Connection time [ms]: connect 0.0</span><br><span class="line">Connection length [replies/conn]: 1.000</span><br><span class="line">Request rate: 10.1 req/s (99.0 ms/req)</span><br><span class="line">Request size [B]: 66.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡å™¨ä»è¯·æ±‚ä¸­æ¥æ”¶åˆ°ç¬¬ä¸€ä¸ªå­—èŠ‚å¼€å§‹ï¼Œåˆ°è¿æ¥æ”¶åˆ°ç¬¬ä¸€ä¸ªå­—èŠ‚æ‰€æ¶ˆè€—çš„æ—¶é—´</span></span><br><span class="line">Reply rate [replies/s]: min 10.0 avg 10.0 max 10.0 stddev 0.0 (1 samples)</span><br><span class="line">Reply time [ms]: response 0.1 transfer 0.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç»Ÿè®¡æ¯ä¸ªå›å¤çš„å¤§å°ï¼Œæ¯ä¸ªç»´åº¦çš„å•ä½éƒ½æ˜¯å­—èŠ‚(bytes),ä¸”éƒ½æ˜¯å¹³å‡æ•°</span></span><br><span class="line">Reply size [B]: header 244.0 content 649.0 footer 0.0 (total 893.0)</span><br><span class="line">Reply status: 1xx=0 2xx=100 3xx=0 4xx=0 5xx=0</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯CPUä½¿ç”¨ç‡çš„ç»Ÿè®¡ï¼ŒUserç”¨æˆ·æ¨¡å¼ï¼ŒSystemæ¨¡å¼</span></span><br><span class="line">CPU time [s]: user 3.85 system 6.05 (user 38.9% system 61.1% total 100.0%)</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç½‘ç»œçš„ååé‡</span></span><br><span class="line">Net I/O: 9.5 KB/s (0.1*10^6 bps)</span><br><span class="line"><span class="meta">#</span><span class="bash"> å‘ç”Ÿé”™è¯¯çš„æ€»æ•°,å®¢æˆ·ç«¯è¶…æ—¶è®¡æ•°ï¼Œæ¯æ¬¡ä»ç”Ÿæˆè¯·æ±‚å¼€å§‹ï¼Œå¦‚æœæ²¡æœ‰å“åº”å³è¶…æ—¶,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> TCPè¿æ¥å¤±è´¥</span></span><br><span class="line">Errors: total 0 client-timo 0 socket-timo 0 connrefused 0 connreset 0</span><br><span class="line">Errors: fd-unavail 0 addrunavail 0 ftab-full 0 other 0</span><br></pre></td></tr></table></figure><h4 id="ab"><a href="#ab" class="headerlink" title="ab"></a><a href="">ab</a></h4><ul><li><p>install</p></li><li><p>usage</p></li><li><p>output example</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@test ~</span><br><span class="line">â•°â”€# ab -n 1000 -c 1000 http://10.20.172.196/</span><br><span class="line">This is ApacheBench, Version 2.3 &lt;$Revision: 1430300 $&gt;</span><br><span class="line">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class="line">Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class="line">Benchmarking 10.20.172.196 (be patient)</span><br><span class="line">Completed 100 requests</span><br><span class="line">Completed 200 requests</span><br><span class="line">Completed 300 requests</span><br><span class="line">Completed 400 requests</span><br><span class="line">Completed 500 requests</span><br><span class="line">Completed 600 requests</span><br><span class="line">Completed 700 requests</span><br><span class="line">Completed 800 requests</span><br><span class="line">Completed 900 requests</span><br><span class="line">Completed 1000 requests</span><br><span class="line">Finished 1000 requests</span><br><span class="line">Server Software:        nginx/1.15.8.1</span><br><span class="line">Server Hostname:        10.20.172.196</span><br><span class="line">Server Port:            80</span><br><span class="line">Document Path:          /</span><br><span class="line">Document Length:        649 bytes</span><br><span class="line">Concurrency Level:      1000</span><br><span class="line">Time taken for tests:   0.107 seconds</span><br><span class="line">Complete requests:      1000</span><br><span class="line">Failed requests:        0</span><br><span class="line">Write errors:           0</span><br><span class="line">Total transferred:      888000 bytes</span><br><span class="line">HTML transferred:       649000 bytes</span><br><span class="line">Requests per second:    9313.50 [#/sec] (mean)</span><br><span class="line">Time per request:       107.371 [ms] (mean)</span><br><span class="line">Time per request:       0.107 [ms] (mean, across all concurrent requests)</span><br><span class="line">Transfer rate:          8076.55 [Kbytes/sec] received</span><br><span class="line"></span><br><span class="line">Connection Times (ms)</span><br><span class="line">  min  mean[+/-sd] median   max</span><br><span class="line">Connect:        0   29   8.1     29      42</span><br><span class="line">Processing:    17   36  14.3     45      51</span><br><span class="line">Waiting:        0   35  14.3     44      50</span><br><span class="line">Total:         42   65   9.0     64      87</span><br><span class="line"></span><br><span class="line">Percentage of the requests served within a certain time (ms)</span><br><span class="line"><span class="meta">  50%</span><span class="bash">     64</span></span><br><span class="line"><span class="meta">  66%</span><span class="bash">     69</span></span><br><span class="line"><span class="meta">  75%</span><span class="bash">     71</span></span><br><span class="line"><span class="meta">  80%</span><span class="bash">     73</span></span><br><span class="line"><span class="meta">  90%</span><span class="bash">     78</span></span><br><span class="line"><span class="meta">  95%</span><span class="bash">     81</span></span><br><span class="line"><span class="meta">  98%</span><span class="bash">     84</span></span><br><span class="line"><span class="meta">  99%</span><span class="bash">     86</span></span><br><span class="line"><span class="meta"> 100%</span><span class="bash">     87 (longest request)</span></span><br></pre></td></tr></table></figure><h4 id="stress"><a href="#stress" class="headerlink" title="stress"></a>stress</h4><blockquote><p><a href="https://www.tecmint.com/linux-cpu-load-stress-test-with-stress-ng-tool/" target="_blank" rel="noopener">Stress/Stress-NG</a>æ˜¯Linuxä¸‹ä¸¤ä¸ªå¸¸ç”¨çš„ç³»ç»Ÿçº§å‹åŠ›æµ‹è¯•å·¥å…·ï¼Œ<strong>stress</strong>å‘½ä»¤ç®€å•æ˜“ç”¨ï¼Œ<strong>stress-ng</strong>æ˜¯stressçš„å‡çº§ç‰ˆï¼Œæ”¯æŒ<strong>æ•°ç™¾ä¸ªå‚æ•°å®šåˆ¶å„ç§å‹CPUã€å†…å­˜ã€IOã€ç½‘ç»œ</strong>çš„å§¿åŠ¿ã€‚åœ¨ç³»ç»Ÿè¿‡è½½çš„åœºæ™¯ä¸‹ï¼Œåº”ç”¨æœåŠ¡å¯èƒ½ä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„é”™è¯¯æˆ–å¼‚å¸¸ï¼Œåœ¨æµ‹è¯•<strong>è´Ÿè½½å‡è¡¡å’Œç†”æ–­é™çº§</strong>æ—¶éå¸¸æœ‰ç”¨ã€‚è¿™é‡Œåªåˆ—ä¸¾äº†å‡ ä¸ªå¸¸ç”¨çš„å‘½ä»¤ï¼Œè¯¦ç»†ä½¿ç”¨å‚è€ƒâ€stress-ng â€“helpâ€æˆ–â€man stress-ngâ€ã€‚å¦å¤–ï¼Œè¿™äº›â€œçƒ¤æœºâ€å‘½ä»¤æ¥æµ‹è¯•æœåŠ¡å™¨æ€§èƒ½ä¹Ÿæ˜¯ä¸é”™çš„ã€‚</p></blockquote><ul><li>install</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> RHRL/CentOS</span></span><br><span class="line">yum install epel-release</span><br><span class="line">yum install stress stress-ng</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Debian/Ubuntu</span></span><br><span class="line">apt install stress stress-ng</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> stress-ng åŸºæœ¬ç”¨æ³•ä¸stresså®Œå…¨å…¼å®¹ï¼Œä½†æœ‰æ›´å¤šçš„å‚æ•°å¯é€‰ï¼Œå¹¶ä¸”å¯ä»¥æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><ul><li>usage</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åœ¨ä¸¤ä¸ªCPUæ ¸å¿ƒä¸Šè·‘å¼€æ–¹è¿ç®—ï¼Œå¹¶ä¸”å¯åŠ¨ä¸€ä¸ªä¸æ–­åˆ†é…é‡Šæ”¾1Gå†…å­˜çš„çº¿ç¨‹ï¼Œè¿è¡Œ10ç§’ååœæ­¢</span></span><br><span class="line">stress --cpu 2 --vm 1 --vm-bytes 1G  -v --timeout 10</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ä¸æ–­æ‰§è¡Œsyncç³»ç»Ÿè°ƒç”¨å›å†™ç£ç›˜ç¼“å­˜ï¼Œå¹¶ä¸”å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ä¸åœåœ°å†™å…¥åˆ é™¤512MBæ•°æ®ï¼Œè¿è¡Œ10ç§’åœæ­¢</span></span><br><span class="line">stress --io 1 --hdd 1 --hdd-bytes 512M -v --timeout 10</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> --sock å¯ä»¥æ¨¡æ‹Ÿå¤§é‡çš„socketè¿æ¥æ–­å¼€ä»¥åŠæ•°æ®çš„å‘é€æ¥æ”¶ç­‰ç­‰</span></span><br><span class="line">stress-ng --sock 2 -v --timeout 10 --metrics-brief</span><br></pre></td></tr></table></figure><ul><li>output example</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@debian /bashtop  â€¹masterâ€º</span><br><span class="line">â•°â”€# stress --cpu 4 --vm 1 --vm-bytes 1G  -v --timeout 3</span><br><span class="line">stress: info: [18174] dispatching hogs: 4 cpu, 0 io, 1 vm, 0 hdd</span><br><span class="line">stress: dbug: [18174] using backoff sleep of 3000us</span><br><span class="line">stress: dbug: [18174] setting timeout to 3s</span><br><span class="line">stress: dbug: [18174] --&gt; hogcpu worker 1 [18179] forked</span><br><span class="line">stress: dbug: [18176] allocating 1073741824 bytes ...</span><br><span class="line">stress: dbug: [18176] allocating 1073741824 bytes ...</span><br><span class="line">stress: dbug: [18176] touching bytes in strides of 4096 bytes ...</span><br><span class="line">stress: dbug: [18174] &lt;-- worker 18175 signalled normally</span><br><span class="line">stress: dbug: [18174] &lt;-- worker 18177 signalled normally</span><br><span class="line">stress: dbug: [18174] &lt;-- worker 18178 signalled normally</span><br><span class="line">stress: dbug: [18174] &lt;-- worker 18179 signalled normally</span><br><span class="line">stress: dbug: [18174] &lt;-- worker 18176 signalled normally</span><br><span class="line">stress: info: [18174] successful run completed in 3s</span><br></pre></td></tr></table></figure><p><img src="img/image-20200506154459952.png" alt="image-20200506154459952"></p><h3 id="å°å·¥å…·"><a href="#å°å·¥å…·" class="headerlink" title="å°å·¥å…·"></a>å°å·¥å…·</h3><h3 id="é•œåƒæº"><a href="#é•œåƒæº" class="headerlink" title="é•œåƒæº"></a>é•œåƒæº</h3><h2 id="å‘è¡Œç‰ˆ-1"><a href="#å‘è¡Œç‰ˆ-1" class="headerlink" title="å‘è¡Œç‰ˆ"></a>å‘è¡Œç‰ˆ</h2><h3 id="pxder"><a href="#pxder" class="headerlink" title="pxder"></a>pxder</h3><p>ä¸‹ç­ä¹‹åå›åˆ°å°çªä¹‹åå°±å¼€å§‹ä¸€å¤©ä¸­æœ€æœ€æ„‰æ‚¦çš„æ—¶åˆ»ï¼Œåœ¨ pixiv.net ä¸Šåˆ·å›¾ã€‚æ”¶è—å–œæ¬¢çš„<del>è€å©†</del>æ’ç”»ã€‚ä¸ºäº†ç®¡ç†å’Œä¸‹è½½è‡ªå·±æ”¶è—çš„æ’ç”»ä½œå“ï¼Œå½“ç„¶è¿˜æ˜¯é€‰æ‹©é£Ÿç”¨å·¥å…·æ¥ä¸‹è½½å•¦ğŸ˜‚ã€‚</p><p>åœ¨äºŒæœˆä»½çš„æ—¶å€™å¸®å°åœŸè±†å’Œ nova åŒå­¦æµ‹è¯• webp server go çš„ benchmark ï¼Œè¿™ä¸ª pxder å¸®äº†å’±å¾ˆå¤§çš„å¿™ï¼Œä¸‹è½½äº† 3W å¤šå¼ å›¾ç‰‡åšæµ‹è¯•æ ·æœ¬ï¼Œæœ€ç»ˆä½¿ç”¨è„šæœ¬ç­›é€‰å‡ºåˆé€‚çš„æ–‡ä»¶å¤§å°æ¥è¿›è¡Œ prefetc æµ‹è¯•ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€debian@debian /mnt/f/illustrations</span><br><span class="line">â•°â”€$ du -sh</span><br><span class="line">50G     .</span><br><span class="line">â•­â”€debian@debian /mnt/f/illustrations</span><br><span class="line">â•°â”€$ tree</span><br><span class="line">203 directories, 31831 files</span><br></pre></td></tr></table></figure><h3 id="æ‚ä¸ƒæ‚å…«çš„"><a href="#æ‚ä¸ƒæ‚å…«çš„" class="headerlink" title="æ‚ä¸ƒæ‚å…«çš„"></a>æ‚ä¸ƒæ‚å…«çš„</h3><h4 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h4><p>nginxï¼Œé™¤äº†å»ºç«™ç•¶ Web æœå‹™å™¨ï¼Œæ˜¯å’±åœ¨ openwrt ä¸Šè£çš„ï¼Œç›®çš„æ˜¯ç‚ºäº†æ“ºè„« ip çš„è¾¦å®šé™åˆ¶ã€‚å› ç‚ºæœ‰äº›è¨­å‚™é€šéåŸŸåä¾†è¨ªå•ï¼Œæ›´æ›ç¶²çµ¡ç’°å¢ƒï¼Œæ¯”å¦‚æ¬å®¶ä¹‹å¾Œåªéœ€è¦ç¶­ä¿®æ”¹ä¸€ä¸‹åŸŸåè§£æå³å¯ã€‚æ¯”å¦‚å’±ä½¿ç”¨ X.lo.502.li ä½œç‚ºä¸‰ç´šå­åŸŸååˆ†é…çµ¦æœ¬åœ°å…§ç¶²æ©Ÿå™¨ç”¨ã€‚</p><h4 id="ffmpeg"><a href="#ffmpeg" class="headerlink" title="ffmpeg"></a>ffmpeg</h4><p>ffmpeg èƒ½å¹²çš„äº‹æƒ…å¤ªå¤šäº†ï¼Œå’±ä½¿ç”¨æœ€å¤šçš„è¿˜æ˜¯åˆå¹¶è§†é¢‘è½¬ç è§†é¢‘ï¼Œæ¯”å¦‚å’±çš„ <a href="">mbcf</a> ï¼Œå…¨ç§° Merge bilibili cilent file</p><h4 id="pandoc"><a href="#pandoc" class="headerlink" title="pandoc"></a><a href="https://github.com/jgm/pandoc" target="_blank" rel="noopener">pandoc</a></h4><h4 id="rsync"><a href="#rsync" class="headerlink" title="rsync"></a>rsync</h4><h4 id="resilio-sync"><a href="#resilio-sync" class="headerlink" title="resilio sync"></a>resilio sync</h4><p>resilio sync ï¼Œæ˜¯å’±æœ€é‡è¦çš„æ•¸æ“šå‚™ä»½å·¥å…·ï¼Œæ¯”å¦‚å’±ä½¿ç”¨ pxder ä¸‹è¼‰å¥½æ”¶è—çš„è€å©†å€‘ï¼Œç‚ºäº†åœ¨æ‰‹æ©Ÿä¸Šä»”ç´°æ¬£è³è€å©†å€‘ï¼Œå’±å°±ç”¨ã€‚resilio sync å°‡ç›®éŒ„åŒæ­¥åˆ°æ‰‹æ©Ÿä¸Šï¼Œä¸¦ä¸”ä½¿ç”¨å®ƒä¾†èˆ‡ PCï¼ŒiPhone ï¼ŒAndroid ï¼ŒLinux ä¸‰è€…ç„¡ç¸«åŒæ­¥ã€‚ç°¡ç›´å¥½ç”¨æ¥µäº†ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè·¨å…¬ç¶²åŒæ­¥ï¼Œåœ¨ä¸€äº›ç¶²çµ¡ç’°å¢ƒä¸‹å› ç‚º GFW çš„ç·£æ•…ï¼Œç„¡æ³•å»ºç«‹èµ·éˆæ¥ï¼Œé€™æ™‚å€™éœ€è¦ä½¿ç”¨åˆ°é å®šç¾©ä¸»æ©Ÿã€‚å…¶ä¸­æœ‰å…©ç¨®æ¯”è¼ƒå¥½çš„æ–¹æ¡ˆï¼Œä¸€æ˜¯åœ¨å…¬ç¶² VPS æ©Ÿå™¨ä¸Šå®‰è£ resilio sync ä¸¦ä¸”åŠ å…¥åˆ°åŒæ­¥ä¸»æ©Ÿç•¶ä¸­ã€‚é€™é»ç¼ºé»ä¹Ÿæ˜é¡¯ï¼Œéœ€è¦ä½”ç”¨ç£ç›¤ç©ºé–“ï¼Œå¦‚æœåŒæ­¥å¤§é‡æ–‡ä»¶ä»¥åŠå¹¾åå¹¾ç™¾GBç´šåˆ¥çš„è©±ï¼Œå°ç›¤æ©Ÿæ˜¯æ‰›ä¸ä½çš„ï¼Œéœ€è¦å¦å¤–æ·»åŠ ç£ç›¤ã€‚æ–¹æ³•äºŒæ˜¯å’±æƒ³åˆ°çš„ï¼Œå±¢è©¦ä¸çˆ½ï¼Œå°±æ˜¯å°‡æœ¬æ©Ÿçš„ resilio sync ç›£è½ç«¯å£ 11354 ä½¿ç”¨ frp å…§ç¶²ç©¿é€åˆ°å…¬ç¶²æœå‹™å™¨ï¼Œç„¶å¾Œåœ¨å¦ä¸€å°æ©Ÿå™¨ä¸Šæ·»åŠ ä¸Šé å®šç¾©ä¸»æ©Ÿï¼ŒIP å°±æ˜¯ frp æœå‹™å™¨çš„ IPï¼Œç«¯å£å°±æ˜¯ frp å…§ç¶²ç©¿é€çš„ remote portã€‚é€™æ¨£æ·»åŠ å¥½é è¨‚èˆ‡ä¸»æ©Ÿä¹‹å¾Œï¼Œä¸åˆ°ä¸€åˆ†é˜å°±èƒ½ç™¼ç¾ä¸»æ©Ÿä¸¦å»ºç«‹èµ·é€£æ¥ã€‚</p><h4 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h4><h4 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h4><h4 id="oh-my-zsh"><a href="#oh-my-zsh" class="headerlink" title="oh-my-zsh"></a>oh-my-zsh</h4><h4 id="zsh"><a href="#zsh" class="headerlink" title="zsh"></a>zsh</h4><h4 id="frp"><a href="#frp" class="headerlink" title="frp"></a>frp</h4><h4 id="openwrt"><a href="#openwrt" class="headerlink" title="openwrt"></a>openwrt</h4><h4 id="Trojan"><a href="#Trojan" class="headerlink" title="Trojan"></a>Trojan</h4><h3 id="shell-å¸¸ç”¨è„šæœ¬"><a href="#shell-å¸¸ç”¨è„šæœ¬" class="headerlink" title="shell å¸¸ç”¨è„šæœ¬"></a>shell å¸¸ç”¨è„šæœ¬</h3><h4 id="VPS-init"><a href="#VPS-init" class="headerlink" title="VPS init"></a>VPS init</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install nload ncdu zsh git wget curl htop sysstat psmisc nginx-full fail2ban</span><br><span class="line">curl  https://get.acme.sh | sh</span><br><span class="line">sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"</span><br><span class="line">sed -i 's/ZSH_THEME="robbyrussell"/ZSH_THEME="bira"/g' ~/.zshrc</span><br></pre></td></tr></table></figure><h4 id="rawg"><a href="#rawg" class="headerlink" title="rawg"></a>rawg</h4><p>raw wget çš„ç¼©å†™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> data: 2020-03-31</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> author: muzi502</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span>: Fuck GFW and download some raw file form github without proxy using jsDelivr CDN</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> usage: save the .she to your <span class="built_in">local</span> such as /usr/bin/rawg, and chmod +x /usr/bin/rawg</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> use rawg https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh to download</span></span><br><span class="line"></span><br><span class="line">set -xue</span><br><span class="line"><span class="meta">#</span><span class="bash"> GitHub rul: https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> jsDelivr url: https://cdn.jsdelivr.net/gh/ohmyzsh/ohmyzsh/tools/install.sh</span></span><br><span class="line"></span><br><span class="line">wget $(echo $1 | sed 's/raw.githubusercontent.com/cdn.jsdelivr.net\/gh/' \</span><br><span class="line">                | sed 's/github.com/cdn.jsdelivr.net\/gh/' \</span><br><span class="line">                | sed 's/\/master//' | sed 's/\/blob//' )</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> curl $(<span class="built_in">echo</span> <span class="variable">$1</span> | sed <span class="string">'s/raw.githubusercontent.com/cdn.jsdelivr.net\/gh/'</span> \</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                | sed <span class="string">'s/github.com/cdn.jsdelivr.net\/gh/'</span> \</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                | sed <span class="string">'s/\/master//'</span> | sed <span class="string">'s/\/blob//'</span> )</span></span><br></pre></td></tr></table></figure><h4 id="kubeadm-pull-images"><a href="#kubeadm-pull-images" class="headerlink" title="kubeadm pull images"></a>kubeadm pull images</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span>: pull kubeamd images and get kubeadm kubectl kubelet binary</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> date: 2020-04-29</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> author: muzi502</span></span><br><span class="line"></span><br><span class="line">set -xue</span><br><span class="line">apt-get update &amp;&amp; apt-get install -y apt-transport-https curl</span><br><span class="line">curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -</span><br><span class="line">cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span><br><span class="line">deb https://apt.kubernetes.io/ kubernetes-xenial main</span><br><span class="line">EOF</span><br><span class="line">apt-get update</span><br><span class="line"></span><br><span class="line">for version in 1.17.5</span><br><span class="line">do</span><br><span class="line">    apt purge -y kubeadm kubelet kubectl</span><br><span class="line">    apt install -y kubeadm=$&#123;version&#125;-00 kubelet=$&#123;version&#125;-00 kubectl=$&#123;version&#125;-00</span><br><span class="line">    mkdir -p $&#123;version&#125;/bin</span><br><span class="line">    rm -rf $&#123;version&#125;/bin/*</span><br><span class="line">    cp -a $(whereis kubelet | awk -F ":" '&#123;print $2&#125;') $&#123;version&#125;/bin/</span><br><span class="line">    cp -a $(whereis kubeadm | awk -F ":" '&#123;print $2&#125;') $&#123;version&#125;/bin/</span><br><span class="line">    cp -a $(whereis kubectl | awk -F ":" '&#123;print $2&#125;') $&#123;version&#125;/bin/</span><br><span class="line">    kubeadm config images pull --kubernetes-version=$&#123;version&#125;</span><br><span class="line">    docker save -o kubeadm_v$&#123;version&#125;.tar `kubeadm config images list --kubernetes-version=$&#123;version&#125;`</span><br><span class="line">    mv kubeadm_v$&#123;version&#125;.tar $&#123;version&#125;</span><br><span class="line">    tar -czvf $&#123;version&#125;&#123;.tar.gz,&#125;</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h4 id="ss-obfs"><a href="#ss-obfs" class="headerlink" title="ss-obfs"></a>ss-obfs</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span>: install shadowsocks-libev and obfs</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> date: 2019-03-11</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> by: muzi502</span></span><br><span class="line">apt-get update</span><br><span class="line">apt-get -y  install shadowsocks-libev simple-obfs rng-tools</span><br><span class="line">rngd -r /dev/urandom</span><br><span class="line">mkdir -p /etc/shadowsocks-libev/</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/shadowsocks-libev/config.json &lt;&lt;EOF</span><br><span class="line">&#123;</span><br><span class="line">    "server":"0.0.0.0",</span><br><span class="line">    "server_port":8964,</span><br><span class="line">    "local_port":1080,</span><br><span class="line">    "password":"1984fuckGFW",</span><br><span class="line">    "timeout":60,</span><br><span class="line">    "method":"chacha20",</span><br><span class="line">    "plugin":"obfs-server",</span><br><span class="line">    "plugin_opts":"obfs=http"</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">systemctl restart shadowsocks-libev.service</span><br><span class="line">modprobe tcp_bbr</span><br><span class="line">echo "tcp_bbr" &gt;&gt; /etc/modules-load.d/modules.conf</span><br><span class="line">echo "net.core.default_qdisc=fq" &gt;&gt; /etc/sysctl.conf</span><br><span class="line">echo "net.ipv4.tcp_congestion_control=bbr" &gt;&gt; /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br><span class="line">sysctl net.ipv4.tcp_available_congestion_control</span><br><span class="line">sysctl net.ipv4.tcp_congestion_control</span><br><span class="line">touch /etc/sysctl.d/local.conf</span><br><span class="line">echo "net.core.wmem_max = 67108864" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.core.rmem_default = 65536" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.core.wmem_default = 65536" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.core.netdev_max_backlog = 4096" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.core.somaxconn = 4096" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_syncookies = 1" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_tw_reuse = 1" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_tw_recycle = 0" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_fin_timeout = 30" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_keepalive_time = 1200" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.ip_local_port_range = 10000 65000" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_max_syn_backlog = 4096" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_max_tw_buckets = 5000" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_fastopen = 3" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_rmem = 4096 87380 67108864" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_wmem = 4096 65536 67108864" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">echo "net.ipv4.tcp_mtu_probing = 1" &gt;&gt;/etc/sysctl.d/local.conf</span><br><span class="line">sysctl --system</span><br><span class="line">lsmod | grep bbr</span><br></pre></td></tr></table></figure><h4 id="mcbf"><a href="#mcbf" class="headerlink" title="mcbf"></a>mcbf</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span>: bulk merge bilibili UWP download file *.flv</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> by: blog.502.li</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> date: 2019-01-12</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°†è¯¥è„šæ”¾åˆ° UWP å®¢æˆ·ç«¯ä¸‹è½½ç¼“å­˜ä¸»ç›®å½•ä¸‹æ‰§è¡Œï¼Œå®‰è£… ffmpegã€jq</span></span><br><span class="line"></span><br><span class="line">set -xu</span><br><span class="line">download_dir=$(pwd)</span><br><span class="line">mp4_dir=$&#123;download_dir&#125;/mp4</span><br><span class="line">mkdir -p $&#123;mp4_dir&#125;</span><br><span class="line"></span><br><span class="line">for video_dir in $(ls | sort -n | grep -E -v "\.|mp4")</span><br><span class="line">do</span><br><span class="line">  cd $&#123;download_dir&#125;/$&#123;video_dir&#125;</span><br><span class="line">  up_name=$(jq ".Uploader" *.dvi | tr -d "[:punct:]\040\011\012\015")</span><br><span class="line">  mkdir -p $&#123;mp4_dir&#125;/$&#123;up_name&#125;</span><br><span class="line">  for p_dir in $(ls | sort -n | grep -v "\.")</span><br><span class="line">  do</span><br><span class="line">    cd $&#123;download_dir&#125;/$&#123;video_dir&#125;/$&#123;p_dir&#125;</span><br><span class="line">    video_name=$(jq ".Title" *.info | tr -d "[:punct:]\040\011\012\015")</span><br><span class="line">    part_name=$(jq ".PartName" *.info | tr -d "[:punct:]\040\011\012\015")</span><br><span class="line">    upload_time=$(grep -Eo "20[0-9][0-9]-[0-9][0-9]-[0-9][0-9]" *.info)</span><br><span class="line">    Uploader=$(jq ".Uploader" *.info | tr -d "[:punct:]\040\011\012\015")</span><br><span class="line">    mp4_audio=$(jq ".VideoDashInfo" *.info | tr -d "[:punct:]\040\011\012\015")</span><br><span class="line"></span><br><span class="line">    if [ "null" = "$&#123;part_name&#125;" ];then</span><br><span class="line">    mp4_file_name=$&#123;video_name&#125;.mp4</span><br><span class="line">    else</span><br><span class="line">    mp4_file_name=$&#123;video_name&#125;_$&#123;p_dir&#125;_$&#123;part_name&#125;.mp4</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    if [ "null" = "$&#123;mp4_audio&#125;" ];then</span><br><span class="line">    ls *.flv | sort -n &gt; ff.txt</span><br><span class="line">    sed -i 's/^/file /g' ff.txt</span><br><span class="line">    ffmpeg -f concat -i ff.txt -c copy $&#123;mp4_dir&#125;/$&#123;up_name&#125;/"$&#123;mp4_file_name&#125;";rm -rf ff.txt</span><br><span class="line">    else</span><br><span class="line">    ffmpeg  -i video.mp4 -i audio1.mp4 -c:v copy -c:a copy $&#123;mp4_dir&#125;/$&#123;up_name&#125;/"$&#123;mp4_file_name&#125;"</span><br><span class="line">    fi</span><br><span class="line">    cd $&#123;download_dir&#125;/$&#123;video_dir&#125;</span><br><span class="line">  cd $&#123;download_dir&#125;</span><br><span class="line">  done</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœéœ€è¦ä¿ç•™åŸè§†é¢‘è¯·æ³¨é‡Šæ‰ä¸‹é¢è¿™ä¸€è¡Œ</span></span><br><span class="line"><span class="meta">#</span><span class="bash">rm -rf <span class="variable">$&#123;download_dir&#125;</span>/<span class="variable">$&#123;video_dir&#125;</span></span></span><br><span class="line">done</span><br></pre></td></tr></table></figure><h4 id="conoha-wallpaper-download"><a href="#conoha-wallpaper-download" class="headerlink" title="conoha wallpaper download"></a>conoha wallpaper download</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span>: download conoha wallpaper</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> by: muzi502</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> date: 2020-02-11</span></span><br><span class="line">set -xue</span><br><span class="line"></span><br><span class="line">p=$(curl https://conoha.mikumo.com/wallpaper/ \</span><br><span class="line">| grep li | grep data-wallpaper-design= \</span><br><span class="line">| sed -e 's/&lt;li//g' | sed -e 's/"&gt;//g' | sed -e 's/^[ \t]*//g' \</span><br><span class="line">| sed -e 's/data-wallpaper-design="//g' \</span><br><span class="line">| sed 's/^/https:\/\/conoha.mikumo.com\/wp-content\/themes\/conohamikumo\/images\/wallpaper\//')</span><br><span class="line"></span><br><span class="line">for pic in $&#123;p&#125;</span><br><span class="line">do</span><br><span class="line">    file_name=$(echo $&#123;pic&#125; | awk -F "/" '&#123;print $9&#125;')</span><br><span class="line">    wget $&#123;pic&#125;/1080_1920.jpg -O $&#123;file_name&#125;_1080.jpg</span><br><span class="line">    wget $&#123;pic&#125;/2560_1440.jpg -O $&#123;file_name&#125;_1440.jpg</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="http://code2life.top/2019/05/02/0035-fault-injection/" target="_blank" rel="noopener">[DevOps] Linuxæ“ä½œç³»ç»Ÿå±‚çš„æ•…éšœæ³¨å…¥</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;å’•å’•å’•&quot;&gt;&lt;a href=&quot;#å’•å’•å’•&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Linux" scheme="https://blog.k8s.li/tags/Linux/"/>
    
      <category term="æ¬ç –" scheme="https://blog.k8s.li/tags/%E6%90%AC%E7%A0%96/"/>
    
      <category term="å·¥å…·" scheme="https://blog.k8s.li/tags/%E5%B7%A5%E5%85%B7/"/>
    
      <category term="å‘½ä»¤è¡Œ" scheme="https://blog.k8s.li/tags/%E5%91%BD%E4%BB%A4%E8%A1%8C/"/>
    
  </entry>
  
  <entry>
    <title>æ— ç –å¯æ¬çš„æ—¥å­|æ¢å‚è®°</title>
    <link href="https://blog.k8s.li/Brick-removal-note.html"/>
    <id>https://blog.k8s.li/Brick-removal-note.html</id>
    <published>2020-05-16T16:00:00.000Z</published>
    <updated>2020-06-18T14:28:38.129Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å’•å’•å’•"><a href="#å’•å’•å’•" class="headerlink" title="å’•å’•å’•"></a>å’•å’•å’•</h2><p>æœ¬æ¥æ‰“ç®—å†™ä¸€ç¯‡ã€Šæ¬ç –æ—¥è®°ä¸æ€è€ƒã€‹çš„ï¼Œè€Œä¸”æƒ³å†™çš„å†…å®¹éƒ½å·²ç»ä¿å­˜åœ¨äº†æˆ‘çš„ telegram é‡Œï¼Œä½†æ˜¯åæ¥è€ƒè™‘åˆ°æˆ‘çš„åšå®¢å°†ä¼šå…¬å¸ƒç»™åŒäº‹ä»¬ï¼Œä¸ºäº†ä¸å¿…è¦çš„å½±å“è¿˜æ˜¯å°†ä¸€äº›å†²å¡”çš„å†…å®¹ä¿å­˜åœ¨è‡ªå·±çš„æ—¥è®°é‡Œï¼Œç­‰ä»¥åå†å…¬å¸ƒå§ï¼Œæˆ–è®¸æ˜¯åå¹´äºŒåå¹´ä¹‹åå§ã€‚ä¸‹é¢çš„å†…å®¹å°±æ˜¯æˆ‘ä»å‰å…¬å¸ç¦»èŒåè¿™æ®µæ—¶é—´çš„ä¸€äº›ç»å†å§(â—Ë‡âˆ€Ë‡â—)ï¼Œå› ä¸ºæ˜¯ç¦»èŒäº†ï¼Œè¿™æ®µæ—¶é—´æš‚æ—¶æ€§åœ°æˆä¸ºäº†æ— ä¸šæ¸¸æ°‘ï¼Œä¹Ÿå°±æ— ç –å¯æ¬äº†ğŸ˜‚ï¼Œæ‰€ä»¥é¢˜åå°±å«ã€Šæ— ç –å¯æ¬çš„æ—¥å­|æ¢å‚è®°ã€‹å§ğŸ¤£</p><h2 id="é¢è¯•å°ç»“"><a href="#é¢è¯•å°ç»“" class="headerlink" title="é¢è¯•å°ç»“"></a>é¢è¯•å°ç»“</h2><table><thead><tr><th align="center">å…¬å¸</th><th align="center">åŸå¸‚</th><th align="center">æ–¹å¼</th><th align="center">é¢è¯•</th><th align="center">offer</th></tr></thead><tbody><tr><td align="center">XX</td><td align="center">æ·±åœ³</td><td align="center">Email</td><td align="center">âŒ</td><td align="center">âŒ</td></tr><tr><td align="center">XX</td><td align="center">ä¸Šæµ·</td><td align="center">Email</td><td align="center">â­•</td><td align="center">âŒ</td></tr><tr><td align="center">XX</td><td align="center">ä¸Šæµ·</td><td align="center">Email</td><td align="center">âŒ</td><td align="center">âŒ</td></tr><tr><td align="center">XXç§‘æŠ€</td><td align="center">æ­å·</td><td align="center">BOSS</td><td align="center">âœ…âœ…</td><td align="center">âœ…</td></tr><tr><td align="center">XXç§‘æŠ€</td><td align="center">æ·±åœ³</td><td align="center">Email</td><td align="center">âœ…</td><td align="center">âœ…</td></tr><tr><td align="center">XXç§‘æŠ€</td><td align="center">æ·±åœ³</td><td align="center">BOSS</td><td align="center">âŒ</td><td align="center">âŒ</td></tr><tr><td align="center">XXç§‘æŠ€</td><td align="center">ä¸Šæµ·</td><td align="center">BOSS</td><td align="center">âœ…âŒ</td><td align="center">âŒ</td></tr><tr><td align="center">è…¾è®¯äº‘</td><td align="center">æ·±åœ³</td><td align="center">BOSS</td><td align="center">âœ…âœ…âŒ</td><td align="center">âŒ</td></tr><tr><td align="center">XX</td><td align="center">æ­å·</td><td align="center">BOSS</td><td align="center">âœ…âŒ</td><td align="center">âŒ</td></tr><tr><td align="center">XX</td><td align="center">æ·±åœ³</td><td align="center">BOSS</td><td align="center">âœ…âœ…</td><td align="center">âœ…</td></tr><tr><td align="center">XX</td><td align="center">æ·±åœ³</td><td align="center">Email</td><td align="center">âœ…âœ…</td><td align="center">âœ…</td></tr></tbody></table><h2 id="9-å·"><a href="#9-å·" class="headerlink" title="9 å·"></a>9 å·</h2><p>æ—©ä¸Šå»äº†åŠå…¬å®¤ä¸Šç­ï¼Œæ”¶æ‹¾äº†ä¸€ä¸‹ç”µè„‘ï¼ŒæŠŠè‡ªå·±çš„å›ºæ€ç¡¬ç›˜æ‹†ä¸‹æ¥ï¼Œåˆé‡æ–°å®‰è£…äº† Windows æ–¹ä¾¿äº¤æ¥ç»™åŒäº‹ã€‚ä¹‹åå†æ‰¾é¢†å¯¼å’Œå…¬å¸è‘£äº‹ç­¾å­—ï¼Œè§åˆ°å…¬å¸çš„è‘£äº‹ï¼Œå¿ƒé‡Œè¿˜æ˜¯æˆ˜æˆ˜å…¢å…¢çš„ã€‚ä¸è¿‡å‡ºä¹æ„æ–™ï¼Œè¿‡ç¨‹å¾ˆé¡ºåˆ©ï¼Œå…¬å¸è‘£äº‹ä¹Ÿå¾ˆè´´åˆ‡ä¸´èµ°å‰ç®€å•åœ°ç¥ç¦äº†å‡ å¥ã€‚ç­¾å­—å®Œæˆä¹‹åè¿˜è¦å›å…¬å¸æœ¬éƒ¨åŠç†è´¢åŠ¡ç»“ç®—ä»¥åŠåŠ³åŠ¡åˆåŒç»ˆæ­¢åè®®ã€‚ä¹˜ç€åœ°é“æ¥åˆ°å…¬å¸ï¼Œæµ‹é‡ä½“æ¸©ç™»è®°å°±ä¸Šæ¥¼æ‰¾åˆ°äººäº‹ã€‚å’Œäººäº‹éƒ¨é—¨ç»ç†ç®€å•èŠäº†ä¸€ä¸‹ï¼Œä¸»è¦æ˜¯é—®äº†äº›è–ªèµ„å¾…é‡ã€ä¸ºä»€ä¹ˆè¦å»ä¸€çº¿åŸå¸‚çš„åŸå› ç­‰ç­‰ï¼Œè¿™äº›é—®é¢˜åœ¨æˆ‘é¢è¯•çš„è¿‡ç¨‹ä¸­ä¹Ÿè¢«ç»å¸¸é—®åˆ°è¿‡ï¼Œä¹Ÿå°±å¦‚å®åœ°å›ç­”äº†ã€‚</p><p>è¯´å®è¯ï¼Œå‰å…¬å¸æ— è®ºæ—¶å¾…é‡è¿˜æ˜¯åŒäº‹å…³ç³»ä¸Šï¼Œéƒ½å¾ˆå¥½ï¼Œè€Œä¸”åœ¨æˆ‘ç¦»èŒè´¢åŠ¡ç»“ç®—çš„æ—¶å€™ï¼Œæˆ‘æœ¬æ¥éœ€è¦ç¼´çº³ä¸€ç¬” 5000 å…ƒå·¦å³çš„æ¬¾é¡¹ï¼Œä½†æ˜¯å…¬å¸é¢†å¯¼å±‚è€ƒè™‘åˆ°æˆ‘è¿˜åˆšåˆšæ¯•ä¸šä¸€å¹´ï¼Œä¸ºæˆ‘çš„å‰ç¨‹ç€æƒ³æš‚æ—¶ä¸äºˆæ‰£é™¤ã€‚å¯¹æˆ‘æ¥è¯´è¿™ç¬”é’±ç®€ç›´æ˜¯ä¸ªå¤§æ•‘æ˜Ÿï¼Œå› ä¸ºåœ¨äº”ä¸€ä¹‹åèº«ä¸Šçš„ä½™é¢ä¸åˆ° 1 ä¸‡å…ƒï¼Œè‹¥æ˜¯æ²¡æœ‰å…¬å¸çš„è¿™ç¬”æ¬¾é¡¹è±å…ï¼Œæˆ–è®¸ç°åœ¨çš„æˆ‘åªèƒ½ç¡å‡ ç™¾å—é’±çš„é’æ—…ï¼Œå°†å°±ç€ä½å‡ ä¸ªæœˆæ‰èƒ½ç¼“è§£ä¸‹æ¥ï¼Œè¿™ä¸€ç‚¹çš„ç¡®å¯¹äºæˆ‘æ¥è¯´æ˜¯æå¤§çš„å¸®åŠ©ã€‚</p><p>å’Œå›½å†…æŸäº›å¤§å‚ç›¸æ¯”ï¼Œä¸œå®¶å¯¹å¾…ç¦»èŒå‘˜å·¥çš„æ€åº¦çœŸæ˜¯é«˜ä¸‹ç«‹åˆ¤å•ŠğŸ˜‚ã€‚çœ‹æ¥è‡ªå·±è¿˜æ˜¯å¾ˆå¹¸è¿å»å¹´æ¯•ä¸šçš„æ—¶å€™é‡åˆ°è¿™ä¹ˆå¥½çš„å…¬å¸ï¼Œè™½ç„¶å·²ç»ç¦»å¼€äº†é‚£é‡Œï¼Œä½†æ˜¯å¾ˆæ„Ÿè°¢ä»–ä»¬åœ¨è¿™æ®µæ—¶é—´ç»™äºˆçš„å¸®åŠ©ã€‚</p><p><img src="img/image-20200516131617183.png" alt="image-20200516131617183"></p><p>è¿˜æœ‰ä¸€ç‚¹ï¼Œåœ¨å››æœˆä»½æå‡ºç¦»èŒç”³è¯·çš„æ—¶å€™ï¼Œå¿ƒé‡Œååˆ†æ„§ç–šï¼Œå› ä¸ºåœ¨å»å¹´å…¥èŒçš„æ—¶å€™åˆšç­”åº”äº†é¢†å¯¼è¦åœ¨è¿™é‡Œå‘†ä¸‹å»çš„ã€‚è€Œä¸”é¢†å¯¼å¯¹æˆ‘ä»¬æ–°äººä¹Ÿæ˜¯ååˆ†å…³ç…§æœ‰åŠ ï¼šå»å¹´çš„æ—¶å€™å»å¤–åœ°å‡ºå·®ï¼Œé‚£å‡ å¤©ä¸€ç›´æ˜¯é¢†å¯¼è¯·å®¢åƒé¥­ï¼›ä¸Šä¸ªæœˆå…¬å¸ç»„ç»‡å»ä½“æ£€ï¼Œæˆ‘ä¸Šåˆä½“æ£€å®Œå›æ¥åä¸­åˆå–œæ 38 åº¦å‘çƒ­å¤§ç¤¼åŒ…ğŸ˜‚ã€‚ç„¶åå»åŒ»é™¢åšå·æ–°å† ç—…æ¯’æ£€éªŒï¼ŒæœŸé—´é¢†å¯¼ä¸€ç›´åœ¨æ‰“ç”µè¯ï¼Œå‰å‰ååä¸€å…±æ‰“äº†äºŒåä¸ªç”µè¯ï¼Œä¸€ç›´å…³æ³¨ç€æˆ‘èº«ä½“æƒ…å†µæ€ä¹ˆæ ·ï¼Œæœ‰æ²¡æœ‰å¥½è½¬ï¼Œæ™šä¸Šç¡è§‰å‰åˆæ‰“ç”µè¯é—®é€€çƒ§æ²¡æœ‰ã€‚ç”Ÿç—…çš„é‚£å‡ å¤©ï¼Œæ²¡æœ‰å’Œå®¶äººè¯´ï¼ŒçœŸæ­£æ‹…å¿ƒåˆ°æˆ‘çš„ä¹Ÿåªæœ‰é¢†å¯¼ä»¥åŠæˆ‘çš„å¦ä¸€ä¸ªåŒäº‹ã€‚é‚£ç‚¹æ—¶é—´æ‰è§‰ç€ï¼Œç°å®ä¸–ç•Œæ‰æ˜¯æˆ‘ä»¬åˆ‡åˆ‡å®å®èƒ½æ„Ÿè§¦åˆ°çš„ï¼Œåœ¨è‡ªå·±æœ€éš¾è¿‡çš„æ—¶å€™ï¼Œèƒ½ä¸»åŠ¨å¸®è‡ªå·±çš„äººæ˜¯å€¼å¾—çæƒœç»ˆç”Ÿçš„æœ‹å‹ã€‚</p><p>åŠå®Œç¦»èŒæ‰‹ç»­ï¼Œæ‹¿åˆ°ã€Šç»ˆæ­¢åŠ³åŠ¨åˆåŒé€šçŸ¥ä¹¦ã€‹ï¼Œæœ‰ç‚¹åƒå¤§å­¦çš„å½•å–é€šçŸ¥ä¹¦ğŸ˜‚ï¼Œå”¯æœ‰æ‹¿ç€å®ƒæ‰èƒ½å»ä¸‹ä¸€å®¶å…¬å¸å…¥èŒæŠ¥åˆ°ã€‚è¿˜æœ‰ä¸€ä»½ä¹‹å‰ç­¾è®¢çš„ä¿å¯†åè®®ï¼Œå› ä¸ºä»äº‹çš„å²—ä½æ¶‰åŠæœºå¯†ä¿¡æ¯ï¼Œæœ‰ä¸€ç‚¹é™åˆ¶ï¼Œæ¯”å¦‚ç¦»å¢ƒæˆ–å‡ºå›½ä¹‹å‰éœ€è¦æŠ¥å¤‡ï¼Œè¿™ä¸€ç‚¹æ¯”è¾ƒéº»çƒ¦ã€‚ä¸è¿‡è¿˜å¥½å•¦ï¼Œä¾ç…§ç›®å‰çš„ç–«æƒ…æƒ…å†µï¼Œä¼°è®¡ä¸€å¹´ä¹‹å†…ä¸ä¼šç¦»å¢ƒæˆ–å‡ºå›½äº†ã€‚</p><p>æ™šä¸Šçš„æ—¶å€™åœ¨ä½çš„å°åŒºé™„è¿‘åƒå®Œäº†æœ€åä¸€é¡¿æ™šé¥­ï¼Œé‚£ç§æ„Ÿè§‰çœŸæ˜¯â€¦â€¦æ­¤ç”Ÿå¯æ‹ğŸ˜­</p><blockquote class="twitter-tweet"><p lang="zh" dir="ltr">æ™šä¸Šåƒçš„è¿™é“èœå« â€œç«çˆ†èŒ„å­â€ï¼Œçš„ç¡®å¤Ÿç«çˆ†çš„ğŸ˜¡ï¼Œåƒå®Œä¹‹åæˆ‘ç«å†’ä¸‰ä¸ˆæƒ³ç ¸æ¡Œå­ï¼Œè‚šå­é‡Œä»¿ä½›æœ‰åƒåªè‰æ³¥é©¬å¥”è…¾ç€è€Œè¿‡â€¦â€¦èŠèŠ±è¦é­å— DDoS æ”»å‡»äº†ğŸ˜­ <a href="https://t.co/V4whuhJFwQ" target="_blank" rel="noopener">pic.twitter.com/V4whuhJFwQ</a></p>&mdash; æœ¨å­ (@muzi_ii) <a href="https://twitter.com/muzi_ii/status/1259090385491488770?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">May 9, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>æ™šä¸Šçš„æ—¶å€™è¿›è¡Œäº†æœ€åä¸€åœºé¢è¯•ï¼Œé¢è¯•çš„è¿‡ç¨‹è¿˜ç®—é¡ºåˆ©ï¼Œè™½ç„¶è¿˜ä¸çŸ¥é“ç»“æœï¼Œä½†æ˜¯ä¸ºäº†ä¿åº•çš„é€‰æ‹©ï¼Œè¿˜æ˜¯åŠ¨èº«å‰å¾€æ·±åœ³ã€‚å› ä¸ºæ·±åœ³çš„è¿™å®¶å…¬å¸è¦æ±‚çš„å…¥èŒæ—¶é—´å°±åœ¨è¿‘å‡ å¤©ï¼Œåˆ°é‚£é‡Œè¿˜è¦ç§Ÿæˆ¿ä½“æ£€ç­‰ä¸€å †æ‚äº‹å„¿è¦åšï¼Œè¿™éœ€è¦å‡ å¤©çš„å‡†å¤‡æ—¶é—´ã€‚</p><h2 id="10-å·"><a href="#10-å·" class="headerlink" title="10 å·"></a>10 å·</h2><p>ç¬¬äºŒå¤©æ—©ä¸Šè¿˜æ˜¯æŒ‰ç…§å¾€å¸¸çš„æ—¶é—´èµ·åºŠï¼Œæ”¶æ‹¾å¥½è¡Œæï¼Œä¸´èµ°ä¹‹å‰ç¯é¡¾äº†ä¸€ä¸‹ç”Ÿæ´»äº†ä¸€å¹´çš„å°çªï¼Œå¤šå°‘æœ‰ç‚¹ä¸èˆç¦»å¼€è¿™åº§ç”Ÿæ´»äº†äº”å¹´çš„åŸå¸‚ã€‚å›æƒ³èµ·å¤§ä¸€æ—¶ä»åƒé‡Œä¹‹å¤–çš„å®¶ä¹¡æ¥åˆ°è¿™é‡Œæ±‚å­¦è¯»ä¹¦ï¼Œåœ¨è¿™é‡Œå››äº”å¹´çš„ç”Ÿæ´»ï¼Œæ¸æ¸åœ°ä¹ æƒ¯äº†è¿™åº§åŸå¸‚ã€‚å¤§å­¦å’Œå‰å¥³å‹æ‹çˆ±çš„é‚£æ®µæ—¶é—´ä¹Ÿæ›¾è®¡åˆ’æˆ–å°†æ¥è¦åœ¨è¿™é‡Œå®‰èº«ç«‹å‘½ï¼Œæˆå®¶ç«‹ä¸šï¼Œæœ‰ä¸€ä¸ªå¹¸ç¦ç¾æ»¡çš„å®¶åº­ã€‚æˆ‘æƒ³è¿™ä¹Ÿæ˜¯å¤§å¤šæ•°äººçš„æ­£å¸¸ç”Ÿæ´»å’Œå½’å®¿å§ã€‚ä¸å¹¸çš„æ˜¯åæ¥è¿˜æ˜¯å’Œå‰å¥³å‹åˆ†æ‰‹äº†ï¼Œè‡ªé‚£ä»¥åä¹Ÿå†ä¹Ÿä¸æƒ³æ‹çˆ±äº†ï¼Œå› ä¸ºè‡ªå·±è¿˜æ˜¯å–œæ¬¢ä¸€ä¸ªäººçš„ç”Ÿæ´»ï¼Œè€Œä¸”å–œæ¬¢/çˆ±ä¸Šä»–äººæ˜¯ç§ä¸è‡ªç”±çš„ç”Ÿæ´»ï¼Œè¦è€ƒè™‘å¯¹æ–¹çš„æ„Ÿå—ï¼Œæœ‰æ—¶ä¸ºäº†ç»´ç³»äº²å¯†å…³ç³»ä¸å¾—ä¸è¿èƒŒè‡ªå·±çš„åŸåˆ™ï¼Œè¿™æ ·çš„ç”Ÿæ´»çœŸçš„çƒ­çˆ±ä¸èµ·æ¥ï¼Œè¿˜æ˜¯ä¸€ä¸ªäººç©æ³¥å·´çˆ½å‘€ğŸ˜‹ã€‚</p><p>å»å¹´æ¯•ä¸šä¹‹åå°±æ‰¾åˆ°è¿™é‡Œä½çš„ï¼Œä¸Šä¸‹é“ºçš„é’æ—…ï¼Œå››äººé—´æ¯äºº 300å…ƒï¼Œå¯¹äºåˆšæ¯•ä¸šçš„æˆ‘æ¥è¯´è¿™é‡Œæ— ç–‘æ˜¯æœ€å¥½çš„å½’å®¿ï¼Œå› ä¸ºå½“æ—¶å®ä¹ çš„å·¥èµ„æ¯å¤©ä¹Ÿå°± 120 å…ƒï¼Œè‡ªå·±åœ¨å…¬å¸é™„è¿‘å•ç‹¬ä½ä¸€é—´æˆ¿å­çš„è¯ï¼Œæ¯ä¸ªæœˆä½æˆ¿è´¹ç”¨è‡³å°‘è¦ 1300+ ï¼Œè€Œä½é’æ—…çš„è¯æ¯ä¸ªæœˆèƒ½èŠ‚çœ 1000 å…ƒã€‚å…¶æ¬¡é€‰åœ¨ä½åœ¨è¿™é‡Œæ˜¯å› ä¸ºè·ç¦»å…¬å¸åªæœ‰ 5 åˆ†é’Ÿçš„æ­¥è¡Œè·¯ç¨‹ï¼Œä¸­åˆçš„æ—¶å€™è¿˜èƒ½å›æ¥åˆä¼‘ç¡ä¸€ä¼šï¼Œç®€ç›´èˆ’æœæäº†ï¼Œç›¸æ¯”äºä¸€å—å…¥èŒçš„åŒäº‹æ¯å¤©è¦ 2 ä¸ªå¤šå°æ—¶çš„ä¸Šä¸‹ç­è·¯ç¨‹å¥½å¾ˆå¤šã€‚æœ¬æ¥å½“æ—¶æ‰“ç®—ä½åˆ°è½¬æ­£ä¹‹åå†æ¬å‡ºå»ä½çš„ï¼Œä¸è¿‡ç­‰åˆ°è½¬æ­£ä¹‹åï¼Œå‘ç°æ¸æ¸åœ°ä¹ æƒ¯ä¸Šäº†ï¼Œæ¥ç€ä½ä¸‹å»ä¹Ÿæ²¡é—®é¢˜ï¼Œäºæ˜¯å°±ä¸€ç›´ä½åˆ°æˆ‘ç¦»å¼€è¿™é‡Œï¼Œå°†è¿‘ä¸€å¹´çš„æ—¶é—´ã€‚</p><p>è€Œä¸‹ä¸€åº§åŸå¸‚ï¼ˆæ·±åœ³ï¼‰ä¹Ÿæ˜¯æ‰¾åˆ°ä¸Šä¸‹é“ºçš„é’æ—…ï¼Œå®åœ¨æ˜¯ä½ä¸èµ·å…¬å¸é™„è¿‘çš„æˆ¿å­ï¼Œå¯¹äºå‡ä»· 3000+ è€Œä¸”æŠ¼ä¸€ä»˜ä¸‰çš„æˆ¿å­æ¥è¯´ï¼Œæ¥è¿‘ 1 ä¸‡çš„ç§Ÿæˆ¿è´¹ç”¨å°±å¥½èŠ±è´¹æˆ‘æ‰€æœ‰çš„ç§¯è“„äº†ï¼Œæ²¡åŠæ³•åªèƒ½å†å»ä½ä¸Šä¸‹é“ºçš„é’æ—…æ¥ç»´æŒç”Ÿè®¡äº†ï¼Œä¸€ä¸ªå­—ï¼Œç©·å•Šï¼ˆï¼ˆï¼ˆ</p><blockquote class="twitter-tweet"><p lang="zh" dir="ltr">æºœäº†æºœäº†ï¼Œç¦»å¼€äº†å±…ä½äº†ä¸€å¹´çš„å°çªå’Œç”Ÿæ´»äº†äº”å¹´çš„åŸå¸‚ï¼‰<br><br>åªæ˜¯å†ä¹Ÿæ‰¾ä¸åˆ°æ¯æœˆä¸‰ç™¾å—é’±çš„æˆ¿å­äº†ï¼ˆ <a href="https://t.co/HIIoYTo95P" target="_blank" rel="noopener">pic.twitter.com/HIIoYTo95P</a></p>&mdash; æœ¨å­ (@muzi_ii) <a href="https://twitter.com/muzi_ii/status/1259296422228197376?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">May 10, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>åˆ°äº†æ—¶é—´ç‚¹å°±åŠ¨èº«å‰å¾€æœºåœºï¼Œè·¯ç¨‹äº”ååˆ†é’Ÿå·¦å³ï¼Œåœ¨è½¦ä¸Šæ‹¿èµ· kindle æ¥ç€çœ‹å¾è´²çš„ã€Šäººä»¥ä»€ä¹ˆç†ç”±æ¥è®°å¿†ã€‹ã€‚å› ä¸ºåœ¨äºŒæœˆä»½çš„æ—¶å€™å‰©ä½™ä»·å€¼é‡Œçš„ä¸€æœŸèŠ‚ç›®ä¸­æåˆ°è¿‡ã€Šå¸ƒè¾¾ä½©æ–¯å¾€äº‹ï¼šå†·æˆ˜æ—¶æœŸä¸€ä¸ªä¸œæ¬§å®¶åº­çš„ç§˜å¯†æ¡£æ¡ˆã€‹è¿™æœ¬ä¹¦ï¼Œè€Œè¿™æœ¬ä¹¦çš„åºè¨€æ­£æ˜¯å¾è´²è€å¸ˆå†™çš„ï¼Œä¹‹å‰æˆ‘ä¹Ÿè¯»è¿‡ä»–çš„è®ºæ–‡ <a href="https://matters.news/@philosophia1979/å¾è´²-ä¸­å›½çš„-æ–°ææƒä¸»ä¹‰-åŠå…¶æœ«ä¸–æ™¯è±¡-é‡å…½èè¯»-bafyreiegbg5tti3ljc7newaah5wp36ncf7fvb2oaovd6p7elc4xqfhbcd4" target="_blank" rel="noopener">ã€Šä¸­å›½çš„â€œæ–°ææƒä¸»ä¹‰â€åŠå…¶æœ«ä¸–æ™¯è±¡ã€‹</a>) ï¼Œéšæ„å¯¹ä»–å…³æ³¨çš„å†…å®¹ä¹Ÿæœ‰æ‰€äº†è§£ã€‚æ€»æ„Ÿè§‰è¿™æœ¬ä¹¦æ›´åƒæ˜¯é˜¿ä¼¦ç‰¹ã€åŠ ç¼ªã€è¨ç‰¹ã€å“ˆç»´å°”ç­‰äººå¯¹äºææƒä¸»ä¹‰è‘—ä½œåŠæ€æƒ³çš„è§£æã€‚å°±åƒåœ¨å‰©ä½™ä»·å€¼é‡Œæåˆ°çš„ï¼Œæˆ‘ä»¬è¯»è¿™äº›å†å²çš„æ—¶å€™ï¼Œè€Œå½“ä¸‹å°±ä»¿ä½›ç½®èº«äºå†å²ä¹‹ä¸­ä¸€æ ·ã€‚ä¹¦ä¸­è®°å½•è‹è”å’Œçº³ç²¹å¾·å›½ææƒç»Ÿæ²»æ”¹é€ äººæ€§çš„è¨€è®ºå®¡æŸ¥ã€ç§˜å¯†è­¦å¯Ÿã€é›†ä¸­è¥ã€æ— è¨€è®ºè‡ªç”±å’Œæ–°é—»è‡ªç”±ã€å…šåª’æ„šæ°‘æ´—è„‘ç­‰ï¼Œè¿™äº›æè¿°ææƒç»Ÿæ²»çš„å†å²ï¼Œå†çœ‹ä¸€çœ‹å½“ä¸‹ï¼Œæˆ‘ä»¬ä¸æ­£ç½®èº«äºå…¶ä¸­å—ï¼Ÿ</p><p>æ¥åˆ°æœºåœºåœ¨æœºåœºè¿‡å®‰æ£€æ£€æŸ¥è¡Œæçš„æ—¶å€™ï¼Œä¸€å—ç¥–ä¼ çš„æ°¸ç£é“è¢«æ‰£ä¸‹äº†ï¼Œï¼ˆè¿™å—ç£é“æ˜¯æˆ‘é«˜ä¸­æ—¶ä»å®¶é‡Œç ´æ—§çš„éŸ³å“ä¸Šæ‹†ä¸‹æ¥çš„ï¼Œä¸€ç›´æ‹¿æ¥ç£å¸ä¸€äº›èºä¸ç”¨ï¼Œåƒåœ¾ä½¬å¸¸ç”¨çš„å·¥å…·ï¼‰ã€‚è¿™æ‰çŸ¥é“é£æœºä¸Šæ˜¯ä¸èƒ½æºå¸¦ç£é“çš„â‰¡(â–”ï¹â–”)â‰¡ï¼Œæ²¡åŠæ³•ï¼Œåªèƒ½ä¸¢ä¸‹äº†ã€‚</p><p>é¡ºåˆ©è¿‡äº†å®‰æ£€ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´å¼€å§‹ç™»æœºï¼Œåº§ä½åœ¨é£æœºé çª—çš„ä½ç½®ï¼Œä¸­é€”çš„é£æ™¯è¿˜ä¸é”™ã€‚çœ‹åˆ°çª—å¤–çš„äº‘æœµï¼Œæƒ³èµ·äº†ã€Šåœ°çƒçš„æ¼”å˜æ•…äº‹ã€‹é‡Œæœ‰å…³å¤§æ°”å±‚çš„ç§‘æ™®ï¼š</p><blockquote><p>åœ°çƒå‘¨å›´çš„å¤§æ°”å±‚åœ¨å‚ç›´æ–¹å‘ä¸Šå¯ä»¥åˆ†ä¸ºå¯¹æµå±‚ã€å¹³æµå±‚ã€ä¸­é—´å±‚ã€çƒ­å±‚å’Œå¤–å±‚ã€‚å…¶ä¸­å¯¹æµå±‚æ˜¯æœ€ä½çš„ä¸€å±‚ï¼Œå’Œäººç±»çš„å…³ç³»æœ€ä¸ºå¯†åˆ‡ã€‚è€Œå¤§ä¸­å‹é£æœºé™¤èµ·é£å’Œé™è½å¤–ï¼Œå¤šæ˜¯åœ¨å¹³æµå±‚ä¸­é£è¡Œã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºï¼šå¹³æµå±‚ä¸­å¤§æ°”å‚ç›´è¿åŠ¨å¾ˆå°‘ï¼Œä»¥å¹³æµè¿åŠ¨ä¸ºä¸»ï¼Œé£æœºåœ¨å…¶ä¸­å—åŠ›æ¯”è¾ƒç¨³å®šï¼›æ°´æ±½å’Œå°˜åŸƒå«é‡å°‘ï¼Œèƒ½è§åº¦å¾ˆé«˜ï¼›å¯¹åœ°é¢çš„å™ªå£°æ±¡æŸ“ç›¸å¯¹è¾ƒå°ï¼›é£é¸Ÿé£è¡Œçš„é«˜åº¦ä¸€èˆ¬è¾¾ä¸åˆ°å¹³æµå±‚ï¼Œå¯ä»¥é¿å…æœºé¸Ÿç›¸æ’çš„äº‹æ•…ã€‚å¹³æµå±‚çš„è¿™äº›ç‰¹ç‚¹ï¼Œå†³å®šäº†é£æœºé€‚å®œåœ¨è¿™å±‚å¤§æ°”ä¸­é£è¡Œã€‚å¹³æµå±‚çš„æµ·æ‹”é«˜åº¦ä¸çº¬åº¦æœ‰å¾ˆå¤§å…³ç³»ã€‚ä½çº¬åº¦åœ°åŒºå¹³å‡åœ¨16ï½18åƒç±³ä»¥ä¸Šï¼Œä¸­çº¬åº¦åœ°åŒºå¹³å‡åœ¨10ï½12åƒç±³ä»¥ä¸Šï¼›é«˜çº¬åº¦åœ°åŒºå¹³å‡åœ¨8ï½9åƒç±³ä»¥ä¸Šã€‚</p><p>æˆ‘å›½æ°‘èˆªè§„å®šï¼Œä¸­å‹ä»¥ä¸Šçš„æ°‘èˆªé£æœºéƒ½åœ¨é«˜ç©ºé£è¡Œï¼Œæ­¤å¤„çš„é«˜ç©ºæ˜¯æŒ‡æµ·æ‹”7000ï½12000ç±³çš„ç©ºé—´ã€‚é£è¡Œé«˜åº¦å±‚é«˜åº¦8400ç±³ï¼ˆå«ï¼‰ä»¥ä¸‹ï¼Œæ¯300ç±³ä¸ºä¸€ä¸ªé£è¡Œé«˜åº¦å±‚ï¼›é£è¡Œé«˜åº¦å±‚é«˜åº¦8400ç±³ï¼ˆä¸å«ï¼‰ä»¥ä¸Šï¼Œæ¯600ç±³ä¸ºä¸€ä¸ªé£è¡Œé«˜åº¦å±‚ã€‚é£æœºåœ¨ç›¸å¯¹ã€äº¤å‰ã€è¶…è¶Šé£è¡Œæ—¶ï¼Œå¿…é¡»ä¿æŒä¸å¾—å°äºè§„å®šé«˜åº¦å±‚ç±³æ•°çš„å‚ç›´é—´éš”ï¼Œä»¥ç¡®ä¿é£è¡Œå®‰å…¨å’Œäº¤é€šé¡ºç•…ã€‚ æ­¤å¤–ï¼Œå°å‹é£æœºæ´»åŠ¨åŒºåŸŸä¸€èˆ¬åœ¨3000ç±³ä»¥ä¸‹ã€‚</p></blockquote><p><img src="img/20200510_045930999_iOS.jpg" alt="image-20200516201412794"></p><p>ä¸‹äº†é£æœºä¹‹åä¹˜ååœ°é“åˆ°å…¬å¸é™„è¿‘çš„åœ°é“ç«™ï¼Œå’Œæˆ¿ä¸œçº¦å®šå¥½äº†æ¥æ¥æˆ‘ã€‚å‡ºç«™ä¹‹åæˆ¿ä¸œå¸¦é¢†ç€å»å¥¹å®¶ï¼Œåˆ°äº†ä¹‹åæ„Ÿè§‰è½å·®ååˆ†å·¨å¤§w(ï¾ŸĞ”ï¾Ÿ)wã€‚åœ¨ä¸åˆ° 5 å¹³ç±³çš„æˆ¿é—´é‡Œå¡ä¸‹ä¸€å¼  0.8m*2mçš„åºŠï¼Œå¦å¤–åŠè¾¹æ˜¯ä¸åˆ°ä¸€ç±³çš„è¿‡é“ã€‚è¿™ä¹Ÿæ˜¯è¿«ä¸å¾—å·²çš„é€‰æ‹©å§ï¼Œå› ä¸ºé™„è¿‘çš„æˆ¿å­åŸºæœ¬ä¸Šéƒ½æ˜¯æŠ¼ä¸€ä»˜ä¸‰ï¼Œè€Œä¸”ä»·æ ¼æ™®éåœ¨ 3000+ ï¼Œå†ç¨å¾®è¿œä¸€ç‚¹èƒ½æ‰¾åˆ° 1500+ å·¦å³çš„æˆ¿å­ï¼Œä¸è¿‡å¯¹äºæŠ¼ä¸€ä»˜ä¸‰æ¥è¯´æˆ‘ä¾æ—§æ— æ³•æ‰¿æ‹…çš„èµ·ã€‚æ‰“ç®—å…ˆæš‚æ—¶åœ¨è¿™é‡Œå°†å°±ä¸€æ®µæ—¶é—´ï¼Œç­‰å­˜æ¬¾è¶³å¤Ÿäº†å°±æ¬å‡ºå»å•ç‹¬ä½ä¸€é—´ã€‚è¿™é‡Œçš„ä»·æ ¼ä¹Ÿä¸ä¾¿å®œï¼Œæ¯æœˆæˆ¿ç§Ÿ 800ï¼ŒæŠ¼é‡‘ 850ï¼Œä¸éœ€è¦äº¤æ°´ç”µæš–è´¹ç”¨ã€‚å’Œæˆ‘ä»¥å‰ä½çš„ 300 å—é’±çš„é’æ—…ç¯å¢ƒè¿˜æ˜¯å·®å¤ªè¿œäº†ğŸ˜‚ã€‚</p><p><img src="img/photo_2020-05-10_19-35-42.jpg" alt="img"></p><p>æ™šä¸Šåœ¨é™„è¿‘åƒäº†ä¸‰èœä¸€æ±¤çš„å¿«é¤ï¼Œæ™šä¸Šç¡è§‰çš„æ—¶å€™ååˆ†é…¸ç—›ï¼Œæˆ‘çš„è¡Œæè¿˜æ²¡æœ‰åˆ°ï¼Œåªèƒ½ç”¨åºŠå•ç®€å•åœ°ç›–åœ¨èº«ä¸Šã€‚åœ¨è¿™é‡Œç¡äº†å‡ æ™šï¼Œæ­¤ç”Ÿå¯æ‹ï¼Œä»¥åå†ä¹Ÿä¸æƒ³ä½é’æ—…äº†ã€‚æˆ‘è§‰ç€è¿˜æ˜¯åº”è¯¥å¯¹è‡ªå·±å¥½ä¸€ç‚¹ï¼Œæ‹¥æœ‰ä¸€ä¸ªè‡ªå·±ç‹¬ç«‹çš„å°çªå¤šä¹ˆåœ°é‡è¦ã€‚æ¯•ç«Ÿè°ä¹Ÿä¸çŸ¥é“è‡ªå·±ä¼šä¸ä¼šå‘ç”Ÿæ„å¤–çªç„¶ç¦»å¼€è¿™ä¸ªä¸–ç•Œï¼Œå¦‚æœç”Ÿå‰æ´»å¾—åƒæˆ‘è¿™æ ·åœ¨æ˜¯å¤ªæƒ¨äº†ğŸ˜‚ã€‚æ„Ÿè§‰åº”è¯¥å¯¹è‡ªå·±æ›´å¥½ä¸€ç‚¹ï¼Œæ¯”å¦‚å›å®¶çš„æ—¶å€™ä¹°ç«è½¦ç¥¨çš„æ—¶å€™ä¸èƒ½å†åƒä»¥å‰é‚£æ ·ä¹°äºŒåå‡ ä¸ªå°æ—¶çš„ç¡¬åº§ï¼Œè‡ªå·±èƒ½èµšé’±äº†åº”è¯¥é€‰æ‹©æ›´çœæ—¶èˆ’é€‚çš„å‡ºè¡Œæ–¹å¼ï¼Œåº”è¯¥å¤šå¤šæ”¹å–„ä¸€ä¸‹è‡ªå·±çš„ç”Ÿæ´»ï¼Œä¸èƒ½å†åƒä»¥å‰ç©·å­¦ç”Ÿä¸€æ ·è¿‡å¾—æƒ¨å…®å…®ğŸ˜‚</p><h2 id="11-å·"><a href="#11-å·" class="headerlink" title="11 å·"></a>11 å·</h2><p>æ—©èµ·å…«ç‚¹å¤šå»åŒ»é™¢ä½“æ£€ï¼Œå»åŒ»é™¢æœ‰ç‚¹å®³æ€•ã€‚å› ä¸ºä¸Šä¸ªæœˆå…¬å¸ç»„ç»‡å»åŒ»é™¢ä½“æ£€ï¼Œä»åŒ»é™¢å›æ¥ä¹‹åæˆ‘å°±çªç„¶å‘çƒ§äº†ï¼Œè¡€æ¸…æ£€æµ‹æ˜¯å› ä¸ºç»†èŒæ„ŸæŸ“ã€‚å¯¹äºæˆ‘è¿™ç§é•¿æœŸï¼ˆå…­å¹´ï¼‰ç´ é£Ÿçš„äººæ¥è¯´ï¼Œå¦‚æœä¸æ³¨é‡è¥å…»å‡è¡¡ï¼Œå…ç–«åŠ›ä¼šä¸‹é™çš„ï¼Œç°åœ¨æˆ‘å°±å±äºé‚£ç§å…ç–«åŠ›ä½ä¸‹çš„äººç¾¤ï¼Œç¨æœ‰ä¸æ…å°±ä¼šç”Ÿç—…ğŸ˜ã€‚ä¸è¿‡ä¸ºäº†åšæŒè‡ªå·±çš„åŸåˆ™ï¼Œè¿™ç‚¹ç‰ºç‰²è¿˜æ˜¯å¯ä»¥æ‰¿å—çš„(â—Ë‡âˆ€Ë‡â—)ã€‚</p><p>æ²¡æƒ³åˆ°åŒ»é™¢ä½“æ£€çš„äººæ•°é‚£ä¹ˆå¤šï¼Œéœ€è¦é¢„çº¦åˆ°åå¤©æ‰æœ‰ç©ºä½ï¼Œæœ€ç»ˆè¿˜æ˜¯é¢„çº¦åˆ°äº†åå¤©ã€‚é¢„çº¦å®Œä½“æ£€çš„æ—¶é—´ä¹‹åå°±å›åˆ°ä½çš„åœ°æ–¹ï¼Œå¤©æ°”å®åœ¨æ˜¯å¤ªçƒ­äº†ï¼Œåˆšæ¥è¿˜æ˜¯ä¸å¤ªä¹ æƒ¯ï¼ŒåŠ ä¸Šåˆæ˜¯ç‹­çª„çš„ç©ºé—´ï¼Œç»™äººä¸€ç§å¾ˆçƒ¦èºçš„æ„Ÿè§‰ã€‚è”ç³»äº†ä¸€ä¸‹å¦ä¸€å®¶å…¬å¸çš„ HR ï¼Œ(ä¹Ÿå°±æ˜¯ç°åœ¨æœ€ç»ˆå…¥èŒçš„å…¬å¸)ï¼Œç»™çš„å›å¤æ˜¯ä¸‰å¤©ä¹‹å†…ç»™å‡ºé¢è¯•ç»“æœã€‚å†…å¿ƒä¹Ÿååˆ†ç„¦æ€¥åœ°ç­‰å¾…ç€ï¼Œè‡ªå·±æ„Ÿè§‰åªæœ‰ä¸‰æˆçš„æŠŠæ¡æ‹¿åˆ° offerã€‚å¦‚æœæ‹¿åˆ°çš„è¯å°±è¦è€ƒè™‘ç¦»å¼€è¿™åº§åŸå¸‚ï¼Œåˆè¦ä»å¤´å¼€å§‹ï¼Œæ‰¾æˆ¿å­ï¼Œå¯„è¡Œæï¼Œä¹°æœºç¥¨ç­‰ç­‰ã€‚</p><p>èººåºŠä¸Šä¼‘æ¯ä¼šå„¿ï¼ŒåºŠæ¿å­å¤ªç¡¬äº†ï¼Œè¿˜æ˜¯åèµ·æ¥æ‹¿ç€ kindle çœ‹äº†ä¼šä¹¦ï¼Œä¸€ä¼šçš„æ—¶é—´å°±æŠŠã€Šä¸ƒå ‚æç®€ç‰©ç†è¯¾ã€‹çœ‹å®Œäº†ï¼Œè¿™æœ¬ä¹¦â€¦â€¦å†™çš„çœŸçš„ä¸å¤ªå¥½ï¼Œå¯¹äºå…·å¤‡åªæ˜¯ä¸€äº›ç®€å•çš„æ„Ÿå¿µæ™®åŠè€Œå·²ï¼Œå€’ä¸å¦‚å»çœ‹çœ‹ã€Šæ˜Ÿç©ºçš„ç´å¼¦ã€‹æˆ–è€…ã€Šä¸‡ç‰©ç®€å²ã€‹ã€‚</p><p>ä¸‹åˆçš„æ—¶å€™é¡ºä¸°å¿«é€’å¸ˆå‚…æ‰“ç”µè¯è®©æˆ‘å»å–ä»¶ï¼Œé‚®å¯„è¿‡æ¥çš„è¡Œæå·²ç»åˆ°äº†ã€‚70 å…¬æ–¤çš„è¡Œæä»å°åŒºé—¨å£æ¬è¿åˆ° 18 æ¥¼ï¼Œè¿˜å¥½å¿«é€’å¸ˆå‚…å€Ÿç»™äº†æˆ‘æ‰‹æ¨è½¦æ–¹ä¾¿äº†äº›ã€‚æŠŠè¡Œææ‹†å¼€åˆé‡æ–°åˆ†æ‹£äº†ä¸€ä¸‹</p><p>æ™šä¸Šçš„æ—¶å€™ç»ˆäºæ”¶åˆ°äº†é¢è¯•é€šè¿‡çš„æ¶ˆæ¯ï¼Œç®€å•è°ˆäº†ä¸€ä¸‹è–ªèµ„ã€‚æ¯”ç°åœ¨çš„è¿™å®¶å…¬å¸è–ªèµ„è¦ä½ 1kï¼Œè™½ç„¶ä½äº†ä¸€ç‚¹ä½†è¿˜æ˜¯èƒ½æ¥å—ã€‚äºæ˜¯å°±è®¡åˆ’ä¸€ä¸‹æ˜å¤©çš„äº‹æƒ…ï¼Œæ—©æ—©åœ°ç¡è§‰äº†ã€‚</p><h2 id="12-å·"><a href="#12-å·" class="headerlink" title="12 å·"></a>12 å·</h2><p>æ—©èµ·å»åŒ»é™¢å–æ¶ˆäº†ä½“æ£€é€€æ¬¾å¾ˆå¿«å°±åˆ°è´¦äº†ã€‚å›æ¥ä¹‹åå°±æ”¶æ‹¾è¡Œæï¼ŒæŠŠä¸€äº›æ²¡ç”¨çš„ç ´ç©æ„éƒ½æ‰”äº†ï¼Œæœºç®±å–å‡ºæ¥è‡ªå·±å¸¦åœ¨èº«ä¸Šã€‚ä¸ºäº†å‡è½»é‡é‡ï¼Œä¸Šæ¬¡é‚®å¯„å›æ¥ 70KG èŠ±äº† 318ï¿¥ğŸ˜­ã€‚è¿™æ¬¡æœ€ç»ˆå‡è½»åˆ° 50KG ï¼Œé‚®å¯„è´¹ç”¨ 210ï¿¥ï¼Œè¿˜ç®—èƒ½æ¥å—çš„èŒƒå›´ã€‚çœŸçš„<strong>æ˜¯ä¹°ä¹¦ä¸€æ—¶çˆ½ï¼Œæ¬å®¶ç«è‘¬åœºï¼</strong>å‡ åæ–¤ä¸­çš„ä¹¦ç±æ¬å®¶çœŸçš„æ˜¯ä¸ªç´¯èµ˜ğŸ˜­ã€‚æ”¶æ‹¾å®Œæ¯•åè”ç³»æ˜¨å¤©ç»™æˆ‘æ´¾é€å¿«é€’çš„å¸ˆå‚…é‚®å¯„å¿«é€’ï¼Œç”±äºåœ°ç‚¹æˆ¿å­è¿˜æ²¡æœ‰æ‰¾å¥½ï¼Œåœ°å€å°±å¡«å†™äº†å…¬å¸å¯¹é¢çš„å°åŒºï¼Œå¸Œæœ›åœ¨é‚£ä¸ªå°åŒºé‡Œæ‰¾åˆ°åˆé€‚çš„æˆ¿å­å§ã€‚</p><p>ä¸Šåˆåä¸€ç‚¹å¤šçš„æ—¶å€™æ”¶åˆ°äº†å…¬å¸çš„æ­£å¼ offer ï¼Œçº¦å®šå¥½ 18 å·å…¥èŒã€‚éšåè”ç³»å°†è¦ï¼ˆ13å·ï¼‰å…¥èŒçš„ A å…¬å¸ HR ï¼Œå‘å¥¹é“æ­‰å¹¶å¦‚å®åœ°è¯´æ˜äº†ä¸èƒ½å…¥èŒçš„åŸå› ã€‚å¤šå°‘æœ‰ç‚¹æ„§ç–šï¼Œå› ä¸ºç¬¬äºŒå¤©å°±è¦å…¥èŒäº†ï¼Œåœ¨å‰ä¸€å¤©å†é€šçŸ¥äººå®¶è¯´ä¸å»äº†ï¼Œæ¢åšè°éƒ½å¾ˆæ°”æ„¤å§ã€‚</p><p>ä¸‹åˆçš„æ—¶å€™ï¼Œæ”¶æ‹¾å¥½è¡Œäº†å°±å»æœºåœºé™„è¿‘çš„é…’åº—ï¼Œç”±äºæ˜¯æ—©ä¸Šçš„é£æœºï¼Œæ—¶é—´ç´§è¿«åªå¥½ä½åœ¨é…’åº—é™„è¿‘äº†ï¼Œè¿˜å¥½é…’åº—æä¾›å…è´¹æ¥é€çš„æœåŠ¡ï¼Œåœ¨å‰å°ç™»è®°ä¸€ä¸‹å‡ºå‘æ—¶é—´ï¼Œç¬¬äºŒå¤©å¸æœºå¸ˆå‚…ä¼šå¼€è½¦é€åˆ°æœºåœºã€‚</p><p>æ™šä¸Šçš„æ—¶å€™çº¦æœ‹å‹åƒé¥­ï¼Œä¸€ä¸ªé«˜ä¸­åŒå­¦ï¼Œå…³ç³»è¿˜å¯ä»¥ã€‚è¿™ä½æœ‹å‹æœ‰ç‚¹å¥‡è‘©ï¼Œå¤§ä¸€çš„æ—¶å€™æ˜¯åœ¨å¤§è¿æµ·äº‹å¤§å­¦ä¸Šçš„èˆªæµ·ä¸“ä¸šï¼Œå¤§ä¸€ä¸Šå®Œä¹‹åçš„æš‘å‡åˆé€€å­¦å›å®¶å¤è¯»ä¸€å¹´ï¼Œæœ€ç»ˆè€ƒä¸Šäº†ä¸€æ‰€ 211 å¤§å­¦å¹¶å­¦çš„è®¡ç®—æœºä¸“ä¸šï¼Œç°åœ¨åœ¨ BAT åšåç«¯å¼€å‘ï¼Œè–ªèµ„æ¯”æˆ‘é«˜å¾ˆå¤šï¼Œè€Œä¸”è¿˜æ‹¿åˆ°äº† shoppe çš„ offer ï¼Œæœ‰ç‚¹åŒè¾ˆå‹åŠ›ğŸï¼Œæ„Ÿè§‰è‡ªå·±å¤ªèœäº†ğŸ˜¥ã€‚äº¤è°ˆçš„è¿‡ç¨‹ä¸­æœ¬ä»¥ä¸ºä»–è¿˜æ˜¯ä»¥å¾€é‚£æ ·å²æœˆé™å¥½ï¼Œä¸è¿‡å°è±¡å¤§åè½¬ã€‚åŸæ¥æ˜¯ä»–å®¶ä¹Ÿé­å—åˆ°ç¤¾ä¼šä¸»ä¹‰é“æ‹³çš„é‡é”¤ğŸ˜‚ï¼Œå’Œæˆ‘ä¸€æ ·çš„æ„Ÿå—ã€‚ç„¶åè°ˆäº†å‡ ä½é«˜ä¸­åŒå­¦çš„ç°çŠ¶ï¼Œä»–è¿˜å˜²è®½å¦å‡ ä½å²æœˆé™å¥½çš„åŒç­åŒå­¦æ²¡æœ‰é­å—ç¤¾ä¼šé“æ‹³çš„æ¯’æ‰“ğŸ¤£ã€‚å“ˆå“ˆå•¥ï¼Œæˆ‘å€’æ˜¯è§‰ç€å²æœˆé™å¥½æ²¡æœ‰ä»€ä¹ˆä¸å¯¹çš„ï¼Œæˆ‘å¸Œæœ›ç¥ç¦ä»–ä»¬èƒ½è¿™æ ·å®‰å®‰ç¨³ç¨³åœ°ç”Ÿæ´»ä¸‹å»å§ï¼Œä½†æ„¿ä»–ä»¬ä¸è¦æƒ³æˆ‘è¿™æ ·é­å—ç¤¾ä¼šä¸»ä¹‰é“æ‹³çš„é‡é”¤ã€‚ã€Šå¿ƒç†æµ‹é‡è€…ã€‹å°è¯´é‡Œæ›¾æåˆ°è¿‡è¿™æ ·ä¸€æ®µå¯¹è¯ï¼š</p><blockquote><p>â€œå®‰å…¨ï¼Œå®Œç¾çš„ç¤¾ä¼šåªæ˜¯ä¸ªå¹»æƒ³ç½¢äº†ã€‚æˆ‘ä»¬ç”Ÿæ´»çš„ç¤¾ä¼šå¦‚ä»Šè¿˜æ˜¯â€˜å±é™©ç¤¾ä¼šâ€™â€</p><p>â€œä»€ä¹ˆæ„æ€â€¦â€¦ï¼Ÿâ€</p><p>â€œå¾ˆä¹…ä»¥å‰â€¦â€¦å¾·å›½è¿˜ç®—ä¸ªå›½å®¶çš„æ—¶å€™ï¼Œæœ‰ä¸ªç¤¾ä¼šå­¦å®¶ï¼Œä¹Œå°”å¸Œé‡ŒÂ·è´å…‹ï¼ˆç»å¸¸è¯´çš„è¯ã€‚æŒ‡ç¤¾ä¼šä¾èµ–â€˜ä¾¿åˆ©ä½†å±é™©â€™çš„ä¸œè¥¿ï¼Œæ”¿åºœè®©æˆ‘ä»¬èƒŒè´Ÿèµ·é£é™©â€¦â€¦ä½†é£é™©è¢«å·§å¦™åœ°åˆ†æ•£ï¼Œåˆ†é…ä»¥è‡³äºè°ä¹Ÿæ²¡è§‰å¯Ÿåˆ°ï¼Œä¸å¯¹ï¼Œä¸æ˜¯æ²¡è§‰å¯Ÿåˆ°ï¼Œè€Œæ˜¯å³ä½¿è§‰å¯Ÿäº†ä¹Ÿå½“æ²¡çœ‹è§ï¼Œæˆ–è®¸æ¯ä¸ªäººéƒ½åœ¨çä¸€åªé—­ä¸€åªçœ¼ï¼Œå±é™©å›ºç„¶å­˜åœ¨ï¼Œä½†å¦‚æœä¸åè¿‡æ¥å½“ä½œå…¶ä¸å­˜åœ¨çš„è¯å°±æ— æ³•ä¿æŒç†æ™ºã€‚ â€œè¿™åº§åŸå¸‚çš„å¸‚æ°‘ï¼Œä¼šæƒ³åˆ°è¿™ä¹ˆå¤šä¹ˆï¼Œå°±è¿æˆ‘ä¹Ÿç®—åœ¨å†…ã€‚â€œ</p></blockquote><p>æˆ‘ä»¬å…±åŒèƒŒè´Ÿç€æ”¿åºœå¼ºåŠ ç»™æˆ‘ä»¬çš„å±é™©ï¼Œè€Œè¿™ç§å±é™©æ¥è‡ªäºæƒåŠ›çš„é›†ä¸­åŒ–ã€‚è¿™ç§å±é™©å·§å¦™åœ°åˆ†æ•£åˆ°æ¯ä¸ªäººèº«ä¸Šï¼Œä»¥è‡³äºè°ä¹Ÿå¯Ÿè§‰ä¸åˆ°å®ƒçš„å­˜åœ¨ï¼Œå³ä¾¿æ˜¯å¯Ÿè§‰åˆ°ï¼Œä¹Ÿåªèƒ½çä¸€åªçœ¼é—­ä¸€åªçœ¼ã€‚å¦‚æœä¸æŠŠå®ƒå½“ä½œä¸å­˜åœ¨çš„è¯ï¼Œå°±æ— æ³•åœ¨è¿™ä¸ªç¤¾ä¼šç”Ÿå­˜ä¸‹å»ã€‚</p><p>å’Œæœ‹å‹å·²å¿«åˆ°æµ·è¾¹é€›äº†ä¸€ä¼šå„¿ï¼Œå¤§æ™šä¸Šçš„æµ·è¾¹çš„é£æ™¯ç¡®å®æ²¡æœ‰ä»€ä¹ˆå€¼å¾—æ¬£èµçš„ï¼Œä¹‹åå°±å›åˆ°é…’åº—ä¼‘æ¯äº†ã€‚</p><h2 id="13-å·"><a href="#13-å·" class="headerlink" title="13 å·"></a>13 å·</h2><p>å‡Œæ™¨ä¹˜é£æœºå‡ºå‘ï¼Œè¿˜å¥½é…’åº—çš„å¸ˆå‚…å…è´¹å¼€è½¦é€åˆ°æœºåœºï¼Œåœ¨åŠç†è¡Œææ‰˜è¿çš„æ—¶å€™ï¼Œè¡Œæè¶…é‡äº† 5KGï¼Œå°±æŠŠæˆ‘çš„å°å¼æœºæœºç®±å–äº†å‡ºæ¥æŠ±åœ¨æ€€é‡Œéšèº«æºå¸¦è€…å§ï¼Œä¹Ÿä¸çŸ¥é“èƒ½ä¸èƒ½è¿‡æ¡ˆä»¶ï¼Œæ¯•ç«Ÿæ˜¯æ¥è¿‘ 5KG çš„é‡è´§ã€‚è¿‡å®‰æ£€çš„æ—¶å€™æ²¡æƒ³åˆ°å¤§æ‘‡å¤§æ‘†åœ°æŠ±ç€æœºç®±å°±è¿‡äº†å®‰æ£€ï¼Œæœ‰ç‚¹å‡ºä¹æ„æ–™ã€‚é¡ºåˆ©ç™»æœºåååœ¨äº†é çª—çš„ä½ç½®ï¼Œä¼‘æ¯ä¸¤ä¸ªå°æ—¶ä¹‹åå°±åˆ°è¾¾äº†ç›®çš„åŸå¸‚ã€‚</p><p>ä¸‹é£æœºååæœºåœºå·´å£«åˆ°é…’åº—ï¼Œä¹Ÿæ˜¯åœ¨å…¬å¸é™„è¿‘ã€‚æ­‡æ¯ä¸€ä¼šå„¿åå¼€å§‹æ´—è¡£æœï¼Œé”™æŠŠé…’åº—æ´—è¡£æˆ¿é‡Œçš„æ¼‚ç™½ç²‰å½“ä½œæ´—è¡£ç²‰ç”¨äº†ï¼Œä¸€è‚¡è„‘åœ°æ”¾äº†ä¸€å¤§å‹ºå†æ´—è¡£æœºé‡Œï¼Œæ´—å®Œä¹‹åæˆ‘é‚£ä»¶é»‘è‰²çš„ USTC LUG å®šåˆ¶ç‰ˆ T æ¤è¢«åŠ ä¸Šäº†ä¸€å±‚çº¢è¤è‰²çš„æ»¤é•œï¼Œæˆ‘æ¬²å“­æˆ‘ç´¯ğŸ˜­ï¼Œå¤ªéš¾å—äº†ï¼Œæœ¬æ‰“ç®—ä¸‹å‘¨å…¥èŒçš„é‚£å¤©è¦ç©¿çš„ğŸ˜­ã€‚ä¸€ä»¶å¥½å¥½åœ° T æ¤å°±è¿™æ ·è¢«æ‘§æ®‹äº†ï¼Œéš¾å—æ­»äº†ğŸ˜‘ã€‚</p><p>ä¸‹åˆä¼‘æ¯äº†ä¸€ä¼šå»çœ‹æˆ¿ï¼Œè”ç³»çš„è›‹å£³å…¬å¯“ï¼Œçœ‹äº†ä¸¤æˆ·æˆ¿å­ï¼Œè¿˜ç®—æ»¡æ„ï¼Œå¹¶ä¸”å¯ä»¥æŠ¼ä¸€ä»˜ä¸€ï¼Œæ€»ä»·æ ¼ä¸åˆ° 3000 å…ƒï¼Œè¿˜èƒ½æ¥å—ã€‚ä¸è¿‡åˆ°æœ€åè›‹å£³å…¬å¯“çš„è€å“¥æ‰ç»™æˆ‘è°ˆåˆ†æœŸä»˜æ¬¾çš„äº‹å„¿ã€‚ä¹‹å‰æˆ‘ä»æœªä½è¿‡è¿™ç§è¿é”å…¬å¯“ï¼Œæ²¡æƒ³åˆ°éœ€è¦å’Œå¾®ä¼—é“¶è¡Œç­¾è®¢ä¸€å¹´çš„åˆ†æœŸåè®®ï¼Œè¿™ä¸€ç‚¹å¾ˆå‘ï¼Œè™½ç„¶ä»·æ ¼è¯±äººä½†æˆ‘æœ¬äººå¯¹è¿™ç§åˆ†æœŸçš„æ–¹å¼åŠå…¶åæ„Ÿäºæ˜¯è¿˜æ˜¯æ”¾å¼ƒäº†åœ¨è›‹å£³å…¬å¯“ä¸Šç§Ÿæˆ¿ã€‚æˆ¿å­å’Œå¸¦æˆ‘çœ‹æˆ¿çš„è€å“¥éƒ½å¾ˆæ»¡æ„ï¼Œåªæ˜¯ä¸æƒ³ä½¿ç”¨åˆ†æœŸä»˜æ¬¾çš„è¿™ç§æ–¹å¼ã€‚ä¹‹åå†æ”¯ä¹ä¸Šçœ‹åˆ°äº† <a href="https://zhuanlan.zhihu.com/p/139490531" target="_blank" rel="noopener">ä½†æœ‰â€œè›‹å£³â€æ–¹é¢çš„ç§Ÿæˆ¿æ‰¾ä½ ï¼Œåº”å±Šç”Ÿè¯·åŠ¡å¿…çœ‹å®Œè¿™ç¯‡æ–‡ç« </a>ï¼Œè¿˜å¥½æˆ‘æ²¡æœ‰è¸©å‘ï¼Œåº†å¹¸åº†å¹¸ã€‚ä¹‹ååˆè”ç³»äº†è‡ªå¦‚çš„æˆ¿å­ï¼Œè‡ªå¦‚æŠ¼ä¸€ä»˜ä¸€çš„æˆ¿å­ä»·æ ¼è´µäº†ä¸€å¤§æˆªï¼Œæˆ¿ç§Ÿæ¯æœˆè¦ 2100ï¼ŒæŠ¼é‡‘ 2000 æœ‰ç‚¹æ¥å—ä¸äº†å°±æ²¡æœ‰å†è€ƒè™‘ã€‚è´«ç©·ä½¿æˆ‘ä½ä¸èµ·æˆ¿ï¼ˆï¼ˆ</p><p>ç»ˆäºåœ¨é—²é±¼ä¸Šè”ç³»åˆ°ä¸€ä¸ªè€å“¥ï¼Œè¯´æ˜¯è½¬ç§Ÿçš„æˆ¿å­ï¼Œè€Œä¸”ä¸éœ€è¦æŠ¼é‡‘ï¼Œæ¯æœˆä»˜æˆ¿ç§Ÿå°±å¯ä»¥ï¼Œè¿™ç‚¹å¾ˆè¯±äººå•Šã€‚äºæ˜¯å°±è¿«ä¸åŠå¾…åœ°çœ‹æˆ¿ï¼Œæœ€ç»ˆè§é¢ä¹‹åï¼Œå¾ˆç—›å¿«çš„å®Œæˆäº†äº¤æ˜“ï¼Œç»ˆäºè§£å†³äº†æœ€å¤´ç–¼å¾—ä¸€ä»¶äº‹å„¿ã€‚</p><h2 id="14-å·"><a href="#14-å·" class="headerlink" title="14 å·"></a>14 å·</h2><p>ä¸Šåˆé…’åº—é€€æˆ¿ï¼Œæ¬åˆ°æ–°ä½çš„åœ°æ–¹ï¼Œæ”¶æ‹¾ä¸€ä¸‹æˆ¿é—´ï¼Œæ‹¿ä»¥å‰çš„æ¯›å·¾ç”¨æ‰‹æ‹–å®Œäº†åœ°æ¿ï¼Œåšäº†ä¸€ä¼šå®¶åŠ¡ã€‚ä¸‹åˆçš„æ—¶å€™é¡ºä¸°å¿«é€’å¯„è¡Œæï¼Œè¡Œæé€åˆ°å°åŒºé—¨å£ï¼Œ50å…¬æ–¤çš„è¡Œæï¼Œä»å°åŒºé—¨å£åˆ°æ¥¼ä¸‹å¤§æ¦‚ 200 ç±³çš„è·ç¦»ï¼Œæ‰›èµ·æ¥çœŸçš„æ˜¯æœ‰ç‚¹è¿œå•ŠğŸ˜­ï¼Œå› ä¸ºæ˜¯è‡ªä»ä¸Šå¤§å­¦ä¹‹åå°±æ²¡å†æ¬ç –å¹²å†œæ´»çš„åŸå› ï¼Œä½“åŠ›å¤§ä¸å¦‚ä»å‰ï¼Œæ‰›ç€ 100 æ–¤çš„è¡Œæï¼Œ200 ç±³çš„è·ç¦»æ¢äº†åå‡ æ¬¡çš„è‚©åœä¸‹æ¥æ­‡æ¯å‡ åˆ†é’Ÿï¼Œè¿œè¿œä½äºä¸šç•Œ 100KG/5KM ä¸æ¢è‚©çš„æ ‡å‡†ï¼Œå®åœ¨æ˜¯æ„§å¯¹äºè‡ªå·±çš„è‚Œè‚‰å•ŠğŸ™ƒï¼Œæƒ­æ„§æƒ­æ„§ï¼ˆä»¥å‰æˆ‘åäº”å²è¾å­¦å†å·¥åœ°ä¸Šæ¬ç –é‚£å¹´ï¼Œè‡ªå·±ä¸€ä¸ªäººæ‰›ä¸€ç™¾å¤šæ–¤ä¸­çš„æœºå™¨åœ¨å·¥åœ°ä¸Šè¡Œäº‘æµæ°´ç©¿æ¢­äºå„ä¸ªæ²Ÿé“ä¹‹é—´ï¼Œï¼ˆå·ç¬‘ï¼Œäººè€äº†å•Šï¼Œå¤±å»äº†å¹´è½»æ—¶çš„çƒ­è¡€.jpg</p><p>æ™šä¸Šä¹°äº›ç”Ÿæ´»ç”¨å“ï¼Œå°åœŸè±†å‘Šè¯‰æˆ‘åœ¨<code>è¿˜ä¸æ™š</code>ä¸Šä¹°åˆé€‚ï¼Œä»·æ ¼ä¾¿å®œè€Œä¸”ç§ç±»é½å…¨ã€‚è´«ç©·å¦‚æˆ‘åªèƒ½é æŠ å’Œè–…æ¥æ»¡è¶³ç”Ÿæ´»äº†ï¼Œå¬å°åœŸè±†çš„å»ºè®®åœ¨é©¬äº‘å®¶é€›äº†ä¸€ä¸ªå¤šå°æ—¶ä¹°å¥½äº†ä»¥åè¦ç”¨åˆ°çš„ç”Ÿæ´»ç‰©å“ã€‚æ¥ç€çœ‹äº†ä¸€ä¼šå¾è´²çš„ä¹¦å°±ç¡ç€äº†ï¼Œè‡ªå·±ç”±äºå¤ªå¿™çš„åŸå› é˜…è¯»çš„æ—¶é—´è¿œä¸å¦‚ä»å‰äº†ï¼ï¸¿ï¼œ</p><h2 id="15-å·"><a href="#15-å·" class="headerlink" title="15 å·"></a>15 å·</h2><p>æ—©ä¸Šèµ·æ¥ä¹‹åå‡ºé—¨éª‘è½¦å•è½¦å¾€å…¬å¸é™„è¿‘é€›ä¸€åœˆï¼Œç†Ÿæ‚‰ä¸€ä¸‹ä¸Šç­æ—¶çš„è·¯çº¿ï¼Œçœ‹çœ‹éœ€è¦èŠ±è´¹å¤šé•¿æ—¶é—´ã€‚å›æ¥ä¹‹åå°±æ¥ç€å»é“¶è¡ŒåŠç†é“¶è¡Œå¡ç”¨ä½œå·¥èµ„å¡ã€‚æ¥ç€å®Œæˆä¹‹ååˆå»äº†ç…§ç›¸é¦†æ‹ 1 å¯¸çš„ç…§ç‰‡ï¼ŒåŠç†ç¤¾ä¿å¡çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚ä¸­åˆçš„æ—¶å€™åœ¨é“¶è¡Œé™„è¿‘çš„å…°å·æ‹‰é¢é¤é¦†é‡Œåƒäº†ç¢—é¸¡è›‹æ‹‰é¢ï¼Œå‘³é“è¿˜æ˜¯æ­£å®—çš„å…°å·æ‹‰é¢ã€‚è€æ¿å’Œå¨å¸ˆçœ‹æ ·å­ä¹Ÿæ˜¯å›æ—äººã€‚çœ‹äº†ä¸€ä¸‹èœå•ï¼Œç•ªèŒ„ç‚’é¥­ã€é…¸è¾£ç™½èœã€é…¸è¾£åœŸè±†ä¸ã€é¸¡è›‹æ‹‰é¢ç­‰ã€‚å“ˆå“ˆå“ˆï¼Œè¿™å°±æ˜¯ä»¥åå¸¸æ¥åƒé¥­çš„åœ°æ–¹äº†ğŸ˜‚ã€‚</p><h2 id="16-å·"><a href="#16-å·" class="headerlink" title="16 å·"></a>16 å·</h2><p>æ—©ä¸Šå…«ç‚¹çš„æ—¶å€™å’Œé—²é±¼ä¸Šçš„è€å“¥çº¦å¥½å»æŸåœ°é¢åŸºäº¤æ˜“å±±åœ°è½¦ï¼Œå› ä¸ºè·ç¦»æ¯”è¾ƒè¿œæ‰€ä»¥å°±ä¹˜åå…¬äº¤åˆ°äº†çº¦å®šå¥½çš„åœ°æ–¹ã€‚è§é¢ä¹‹åç®€å•å¯’æš„äº†ä¸€ä¸‹ï¼Œå…ˆè¯•éª‘äº†ä¸€æ®µè·ç¦»ï¼Œåˆ¹è½¦å’Œå˜é€Ÿéƒ½è¿˜å¯ä»¥ï¼Œå°±å¾ˆç—›å¿«åœ°ä¹°ä¸‹æ¥è¿™è¾†è½¦ã€‚ä»æ­¤ä¹Ÿæ˜¯æœ‰è½¦ä¸€æ—äº†ï¼ˆå·ç¬‘ã€‚æœ‰äº†ä¸€è¾†è½¦çœŸæ˜¯æ–¹ä¾¿å•Šï¼Œä¹‹å‰ä¸‹æ¥¼åæ­¥è¡Œåˆ°å°åŒºé—¨å£éœ€è¦ 5 åˆ†é’Ÿï¼Œç°åœ¨éª‘è½¦åªéœ€ 1 åˆ†é’Ÿå°±å¤Ÿäº†ï¼Œæ¯”ä»¥å¾€å¿«äº†å¾ˆå¤šã€‚ä¹‹æ‰€ä»¥ä¹°ä¸€è¾†äºŒæ‰‹çš„å±±åœ°è½¦æ˜¯å› ä¸ºæ—©ä¸Šä¸Šç­æ—¶å°åŒºé—¨å£çš„å…±äº«å•è½¦éƒ½è¢«ä¸Šç­æ—éª‘èµ°äº†ï¼Œä¸ºäº†èŠ‚çœæ—¶é—´è¿˜æ˜¯æ•´è¾†è‡ªå·±çš„å•è½¦å§ï¼Œè€Œä¸”å…±äº«å•è½¦éª‘èµ·æ¥çœŸè´¹åŠ²ï¼Œé€Ÿåº¦å¤ªæ…¢äº†ã€‚æ¢åš 24 é€Ÿçš„å±±åœ°è½¦é€Ÿåº¦æå‡ä¸€å€ï¼Œæ—¶é—´ä¹Ÿèƒ½ç¼©çŸ­ä¸€åŠï¼Œä»¥å¾€ 15 åˆ†é’Ÿçš„éª‘è¡Œè·¯ç¨‹ç°åœ¨éª‘å¿«ä¸€ç‚¹çš„è¯åªéœ€è¦ 10 åˆ†é’Ÿã€‚é‚£è¿˜æ˜¯æŒ‰ç…§å¾€å¸¸é‚£æ · 8 ç‚¹åŠå‡ºå‘ï¼Œ9 ç‚¹ä¹‹å‰èµ¶åˆ°å…¬å¸æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚è€Œä¸”è‡ªå·±æœ€å–œæ¬¢çš„è¿åŠ¨ä¹Ÿæ˜¯éª‘è¡Œï¼Œé«˜ä¸­çš„æ˜¯åŸºæœ¬ä¸Šéƒ½æ˜¯éª‘è½¦å»ä¸Šå­¦ï¼Œé«˜è€ƒå®Œçš„æ—¶å€™æ›¾è‡ªå·±ä¸€ä¸ªäººéª‘è½¦å»åŒ—äº¬ã€‚æ¥å› 1000å…¬é‡Œçš„è·ç¦»ï¼Œæƒ³æƒ³å½“åˆä¹Ÿæ˜¯é—²ç€è›‹ç–¼ã€‚æ›¾åœ¨å¤§ä¸€çš„æ—¶å€™è®¡åˆ’æˆ–è¦å»éª‘è¡Œå·è—çº¿ï¼Œå››å¹´ä¹‹åçœ‹æ¥è¿™ä¸ªå°ç›®æ ‡è¦æ‰“æ°´æ¼‚äº†ã€‚æˆ–è€…ç­‰åˆ°å›½åº†çš„æ—¶å€™å‡†å¤‡éª‘è¡Œå»ç©å„¿ï¼Œéª‘è¡Œå»æµ·è¾¹ç©å„¿ï¼Œå—¯ï¼Œå°±è¿™æ ·å®šä¸‹æ¥äº†ï¼Œå¦‚æœè¯»è€…åˆæƒ³å»çš„è¯å¯ä»¥è”ç³»å’±ä¸€å—å»ğŸ˜‚</p><p>ä¸‹åˆä¿®ç©ºè°ƒï¼Œæ„Ÿè§‰è¢«å®°äº†ï¼Œæˆ‘ä¼°è®¡ç€åº”è¯¥å°±æ˜¯ä¸€æ ¹è·³çº¿æ²¡æœ‰æ¥å¥½æˆ–è€…æ¥å¯¹å¯¼è‡´ç©ºè°ƒä¸»æœºæ— æ³•å¼€å¯ã€‚è¦æ˜¯æ¢ä½œæˆ‘å®¶çš„ç©ºè°ƒï¼Œè¿™ç§å°é—®é¢˜è‡ªå·±å°±èƒ½è§£å†³ï¼Œæ¯•ç«Ÿå®¶é‡Œçš„ç”µç£ç‚‰æ´—è¡£æœºç©ºè°ƒç”µè§†æœºç”µé£æ‰‡ç­‰ç­‰å®¶ç”µè‡ªå·±éƒ½æ‹†è¿‡ä¿®è¿‡ğŸ˜‚ã€‚å› ä¸ºæˆ¿ä¸œå®¶çš„ç©ºè°ƒæ˜¯ä¸­å¤®ç©ºè°ƒä»·æ ¼æ˜‚è´µè‡ªå·±è¿˜æ˜¯ä¸æ•¢è½»æ˜“å°è¯•ï¼Œæ‰€ä»¥è¿˜æ˜¯è®©æˆ¿ä¸œæ¥è¯·ç»´ä¿®å·¥äººå¤„ç†å§ã€‚ä¸‹åˆçš„æ—¶å€™æˆ¿ä¸œè¯·æ¥çš„ç»´ä¿®å·¥äººå€’è…¾ä¸€ä¼šå„¿ç¡¬æ˜¯ç»™æˆ‘è¯´ä¸»æ¿åäº†(* ï¿£ï¸¿ï¿£)ã€‚äºæ˜¯å¥½æˆä¸Šåœºï¼Œæˆ‘å°±å’Œç»´ä¿®å·¥äººæ ä¸Šäº†ã€‚æˆ‘é—®ä»–ä¸»æ¿å“ªé‡Œåäº†ï¼Ÿä»–è¯´ç”µå®¹åäº†ï¼Œéœ€è¦æ›´æ¢ä¸»æ¿ã€‚æˆ‘å†…å¿ƒä¸€ä¸‡åŒ¹è‰æ³¥é©¬å¥”è…¾è€Œè¿‡ï¼Œä¸€ä¸ªç”µå®¹åäº†å°±è¦æ¢æ•´ä¸ªä¸»æ¿ï¼Ÿï¼Ÿï¼Ÿï¼Ÿæˆ‘å½“åœºæå‡ºæˆ‘ç¥–ä¼ çš„ç”µçƒ™é“è¦ç»™ä»–æ¼”ç¤ºä¸€ä¸‹æ€ä¹ˆæ¢ç”µå®¹ï¼Œé£çº¿æ¢ç”µå®¹æ¤çƒç­‰ç­‰è¿™ç‚¹æœ¬é¢†å’±è¿˜æ˜¯æœ‰æ»´ï¼Œç”µå®¹åäº†æ¢ç”µå®¹ä¸å¾—äº†ï¼Ÿå½“æˆ‘å‚»å­æ¥å¿½æ‚ å˜›ã€‚å·´æ‹‰å·´æ‹‰å’Œä»–æ‰¯äº†åŠå¤©ï¼Œæœ€ç»ˆâ€¦â€¦è¿˜æ˜¯æ”¶äº† 640ï¿¥ã€‚è™½ç„¶è¿™ç¬”é’±æ˜¯æˆ¿ä¸œæ¥ä»˜çš„ï¼Œä½†æ˜¯è¿˜æ˜¯å¾ˆä¸å¿ƒç”˜æƒ…æ„¿ï¼Œå°±è¿™æ ·è¢«åˆ«äººå®°ä¸€åˆ€ï¼Œæ— è®ºå®°åˆ°è°èº«ä¸Šéƒ½ä¸å¥½å—ã€‚</p><p><strong>ä¸»æ¿åäº†</strong> è¿™æ‹›å¯¹äºå®¶ç”µæˆ–è€…ç”µå­ç»´ä¿®æ˜‚è¡Œä¸šçš„ç¥å™¨å‘€ï¼Œç©ºè°ƒå°æ¯›ç—…ç»™ä½ æ•´ä¸ªä¸»æ¿åäº†çš„æ¥å£ä»ä½ èº«ä¸Šè–…ä¸€æŠŠç¾Šæ¯›ã€‚ç±»ä¼¼çš„äº‹æƒ…åœ¨ä¿®ç†ç¬”è®°æœ¬ç”µè„‘æˆ–è€…ç”µè§†æœºç­‰ç­‰éƒ½æ˜¯å¸¸è§çš„äº‹æƒ…ã€‚</p><p>ä¸‹åˆçš„æ—¶å€™æ•£çƒ­ç¡…è„‚å’Œ CPU å»¶é•¿çº¿åˆ°äº†ï¼Œæ‹¿äº†å¿«é€’ä¹‹åå°±å¼€å§‹ç»„è£…å°å¼æœºã€‚åœ¨æ‹†ä¸»æ¿çš„æ—¶å€™ï¼Œç®€ç›´éœ‡æƒŠæ­»æˆ‘ï¼Œæ²¡æƒ³åˆ°æˆ‘çš„ä¸»æ¿ CPU 4PIN å»¶é•¿çº¿å·²ç»è€åŒ–çŸ­è·¯çƒ§æ¯äº†ï¼Œæˆ‘ä½¿ç”¨äº†ä¸€å¹´ç«Ÿç„¶æµ‘ç„¶ä¸çŸ¥ã€‚ä¹‹å‰åœ¨ç»™ <a href="https://github.com/webp-sh/webp_server_go" target="_blank" rel="noopener">Webp Server Go</a> åš benchmark çš„æ—¶å€™ï¼ŒCPU ä¸€æ—¦æ»¡è½½å°±ç›´æ¥é»‘å±ï¼Œå„ç§æ’æŸ¥éƒ½æ²¡æœ‰æ‰¾åˆ°åŸå› ã€‚ç›´åˆ°ä»Šå¤©æˆ‘æ‰æ˜ç™½ï¼ŒåŸæ¥æ˜¯ CPU ä¾›ç”µçº¿çš„é—®é¢˜â€¦â€¦ï¼Œæˆ‘å†…å¿ƒä¸€ä¸‡åŒ¹è‰æ³¥é©¬ã€‚æ— è‰¯å•†å®¶å‘æƒ¨æˆ‘äº†ï¼Œå»å¹´çš„æ—¶å€™è£…æœºæ²¡æœ‰æ³¨æ„åˆ°è¿™æ ¹çº¿çš„è´¨é‡è¿™ä¹ˆå·®ï¼Œè¿˜å¥½ç°åœ¨æ‹†æœºçš„æ—¶å€™å‘ç°äº†ï¼Œä¸ç„¶é‚£ä¸€å¤©è¿™æ ¹çº¿æŠ½æäº†çªç„¶å°± BOOM å¯ä¸å¥½äº†ğŸ˜¡ã€‚</p><p><img src="img/20200514_070432138_iOS.jpg" alt="image-20200517101303617"></p><p>ç»„è£…åçš„å°å¼æœºæ•ˆæœå›¾ï¼ŒæŠŠè·¯ç”±å™¨æ”¾åœ¨äº†æœºç®±ä¸Šé¢ã€‚ä¸»è·¯ç”±å™¨è¿˜æ˜¯åŸæ¥çš„ <a href="https://www.netgear.com/support/product/R6300v2.aspx" target="_blank" rel="noopener">R6300V2</a> ï¼Œæ˜¯å»å¹´çš„æ—¶å€™èŠ±äº† 170ï¿¥ åœ¨é—²é±¼ä¸Šæ¡åƒåœ¾ææ¥çš„ã€‚æ—è¾¹ç™½è‰²çš„å°±æ˜¯ N1 ç›’å­ï¼Œå½“è½¯è·¯ç”±æ¥ç”¨(<a href="https://blog.k8s.li/N1-openwrt.html">N1 ç›’å­åˆ·å…¥ OpenWrt å¹¶éƒ¨ç½² K3s</a>)ã€‚R6300V2 çš„æ€§èƒ½è¿˜æ˜¯å¤ªå¼±ï¼Œå°¤å…¶æ˜¯å¯¹äº AES-256 æˆ–è€…  GCM-256 è¿™ç§åŠ å¯†ç®—æ³•è¿˜æ˜¯åŠ›ä¸ä»å¿ƒï¼ŒN1 ç›’å­å°é’¢ç‚®å½“æ—è·¯ç½‘å…³å†é€‚åˆä¸è¿‡äº†ã€‚å¦å¤–ä» R6300V2 çš„ USB æ¥å£ç»™ ESP8266 å¼€å‘æ¿ä¾›ç”µï¼Œç”¨æ¥è¿œç¨‹å¼€å…³æœº(<a href="https://blog.k8s.li/esp8266-pc-switch.html">ä½¿ç”¨ ESP8266 NodeMCU æ‰“é€  WiFi å¼€å…³</a>)ã€‚</p><p><img src="img/20200517_022447573_iOS.jpg" alt="img"></p><h2 id="17-å·"><a href="#17-å·" class="headerlink" title="17 å·"></a>17 å·</h2><p>ä»Šå¤©åˆæ˜¯ä¸€ä¸ªå¹³å‡¡çš„æ—¥å¸¸ï¼Œæ— éå°±æ˜¯æ‹¿äº†äº›å¿«é€’ï¼Œåœ¨ç½‘ä¸Šä¹°çš„ç”Ÿæ´»ç”¨å“ä¹Ÿåˆ°é½äº†ï¼Œä¹Ÿæ¸æ¸åœ°ä¹ æƒ¯äº†è¿™é‡Œçš„ç”Ÿæ´»ï¼Œæ…¢æ…¢åœ°èå…¥åˆ°è¿™é‡Œã€‚ä¹°äº†ä¸€ç®±æ‰‹æŠ“é¥¼å’Œä¸€äº›è”¬èœï¼Œå‡†å¤‡æ—©ä¸Šè‡ªå·±åšé¥­åƒï¼Œç´ é£Ÿè€…çš„ç¦éŸ³å‘€ï¼Œä¸€å¼ é¥¼è£¹ä¸Šå‡ ç‰‡èœå¶å­ï¼Œå†åŠ ä¸Šä¸€ä¸ªç…è›‹ï¼ŒæŠ¹ä¸Šç•ªèŒ„é…±å’Œæ²™æ‹‰é…±ï¼Œæœ´ç´ ä¸€é¤ğŸ˜‹</p><p>æ˜å¤©å°±è¦å…¥èŒå¼€å§‹æ¬ç –äº†ï¼Œåƒæ–°ç”Ÿå¼€å­¦ä¸€æ ·ï¼Œå……æ»¡ç€æœŸå¾…åˆæœ‰ä¸€ç‚¹å®³æ€•ï¼Œå¸Œæœ›æ˜å¤©é¡ºåˆ©å§ã€‚æ„Ÿè§‰å°±åƒæ˜¯å¤§ä¸€æ–°ç”Ÿå¼€å­¦ä¸€æ ·ï¼Œç¦»å¼€ç†Ÿæ‚‰å·²ä¹…å®¶æ¥åˆ°è¿™ä¸ªé™Œç”Ÿçš„åŸå¸‚ï¼Œæ‹¿ç€<del>å½•å–é€šçŸ¥ä¹¦</del>ã€Šå½•ç”¨é€šçŸ¥ä¹¦ã€‹å’Œã€Šç¦»èŒè¯æ˜ã€‹åˆ°æ–°å…¬å¸å…¥èŒï¼Œè®¤è¯†æ–°çš„æœ‹å‹ï¼Œå¼€å§‹ä¸€æ®µæ–°çš„æ—…ç¨‹ã€‚</p><p>å›æƒ³èµ·è¿™å‡ å¤©çš„ç»å†ï¼Œæˆ‘ä»æœªæƒ³è¿‡ä¼šæ¥åˆ°è¿™é‡Œï¼Œä¹Ÿä»æœªæƒ³è¿‡ä¼šç¦»å¼€ç”Ÿæ´»å·²ä¹…çš„åŸå¸‚ã€‚è‹¥æ˜¯è¯´è¿™ä¸€åˆ‡çš„èµ·ç‚¹ï¼Œå°±ç¿»äº†ç¿»å»å¹´å†™çš„<a href="https://blog.k8s.li/thinking-2019.html">ã€Šæ¯•ä¸šåçš„ä¸€ç‚¹æ€è€ƒã€‹</a></p><blockquote><p>æˆ‘ä¾ç¨€è®°å¾—é«˜ä¸­æ¯•ä¸šæ—¶æœ€åä¸€å ‚è¯¾ä¸Šï¼Œæˆ‘ä»¬çš„ç­ä¸»ä»»ç»™æˆ‘ä»¬ç­åŒå­¦è®²è¿‡ä¸€å¥è¯<strong>ä½ æ‰€è¯»è¿‡çš„ä¹¦å’Œä½ æ¥è§¦çš„äººï¼Œå†³å®šäº†ä½ ä»¥åèƒ½èµ°ä»€ä¹ˆæ ·çš„è·¯</strong>ï¼Œæˆ‘ä¸€ç›´é“­è®°è‡³ä»Šï¼Œå¹¶æŠŠå®ƒå½“ä½œå¤§å­¦å››å¹´çš„å”¯ä¸€ä¿¡æ¡ï¼Œå¾ˆåº†å¹¸ï¼Œæ­£æ˜¯è¿™åˆ™ä¿¡æ¡ä¼´éšç€æˆ‘å®Œæˆäº†æ€æƒ³çš„æ”¹é€ å’Œé‡å¡‘ã€‚ç°åœ¨æˆ‘æ‰‹æœºä¸Šè¿˜ä¿ç•™ç€å½“æ—¶ç­ä¸»ä»»è®²è¯æ—¶çš„å½•éŸ³ï¼Œæˆ–è®¸è¿™æ˜¯æˆ‘å€¼å¾—ä¿å­˜ä¼—ç”Ÿçš„è´¢å¯Œã€‚</p></blockquote><p>ä¹Ÿæ­£æ˜¯å› ä¸ºè¿™ç¯‡æ–‡ç« çš„å½±å“ï¼Œè®©æˆ‘è®¤è¯†åˆ°äº†ä¸€äº›æ–°çš„å°ä¼™ä¼´ï¼š<a href="https://nova.moe/" target="_blank" rel="noopener">nova</a> å’Œ <a href="https://dmesg.app/" target="_blank" rel="noopener">å°åœŸè±†</a> ã€‚è®¤è¯†åˆ°ä»–ä»¬ä¹‹åæœ‰ç‚¹åŒè¾ˆå‹åŠ›ğŸï¼Œä»–ä¿©éƒ½åœ¨å¾ˆç‰›é€¼çš„å…¬å¸ä¸Šç­ï¼Œè‡ªå·±å´åœ¨ä¸€ä¸ªäºŒçº¿å°åŸå¸‚è¿‡ç€å®‰é€¸çš„ç”Ÿæ´»ï¼Œè¿™ä¹Ÿè¿«ä½¿æˆ‘æƒ³è¦èµ°å‡ºå¿ƒé‡Œèˆ’é€‚åœˆï¼Œå»ä¸Šæµ·æˆ–æ·±åœ³é—¯ä¸€é—¯ï¼Œè€Œä¸”å’Œå°åœŸè±†ä¹Ÿçº¦å®šå¥½äº†ä¸€èµ·å»åŒä¸€ä¸ªåŸå¸‚ã€‚æœ€åè¿˜æ˜¯è¦æ„Ÿè°¢ä¸€ä¸‹å°åœŸè±†ï¼Œåœ¨æˆ‘åˆšå¼€å§‹æŠ•ç®€å†é¢è¯•çš„é‚£å‡ å¤©ç»™äºˆå¾ˆå¤šç²¾ç¥ä¸Šçš„å¸®åŠ©ğŸ˜˜ã€‚é‚£æ®µæ—¶é—´ç¡®å®å„ç§å‹åŠ›ã€æŒ«è´¥æ„Ÿã€è‡ªæˆ‘æ€€ç–‘å¦å®šã€æŠ‘éƒç­‰è´Ÿé¢æƒ…ç»ªç‰¹åˆ«ä¸¥é‡ï¼Œæœ‰æ—¶é¢è¯•ä¸‹æ¥è¿å‘¼å¸éƒ½æ„Ÿå—åˆ°å‹åŠ›èƒ¸é—·ã€‚æ²¡æœ‰è¿™ä¸¤ä½æœ‹å‹çš„å¸®åŠ©ï¼Œæˆ–è®¸åˆšæƒ³è¦ç ´å£³è€Œå‡ºçš„æˆ‘å› ä¸ºå®³æ€•å°±æ”¾å¼ƒäº†ï¼Œç°åœ¨å¯èƒ½è¿˜æ˜¯åŸåœ°ä¸åŠ¨ã€‚æ”¾å¼ƒå®‰å®‰ç¨³ç¨³çš„ç”Ÿæ´»èµ°å‡ºå¿ƒé‡Œèˆ’é€‚åœˆï¼Œç¡®å®é‚£ç§å‹åŠ›æ„Ÿä¸å¤ªå¥½å—ï¼Œä¼¤å¿ƒéš¾è¿‡çš„æ—¶å€™å°±æ‰¾ä¸ªæœ‹å‹æ¥å€¾è¯‰ä¸€ä¸‹ï¼Œä¸è¦ä¸€ä¸ªäººæ†‹ç€(oã‚œâ–½ã‚œ)oâ˜†ã€‚</p><p>Bless, Bless!</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;å’•å’•å’•&quot;&gt;&lt;a href=&quot;#å’•å’•å’•&quot;
        
      
    
    </summary>
    
    
      <category term="ç”Ÿæ´»" scheme="https://blog.k8s.li/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>kubelet æŒ‚è½½ volume åŸç†åˆ†æ</title>
    <link href="https://blog.k8s.li/kubelet-mount-volumes-analysis.html"/>
    <id>https://blog.k8s.li/kubelet-mount-volumes-analysis.html</id>
    <published>2020-04-30T16:00:00.000Z</published>
    <updated>2020-04-30T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨ kubernetes ä¸­ä½¿ç”¨ NFS å­˜å‚¨çš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ªå°é—®é¢˜ï¼Œä¹Ÿæ‰¾åˆ°äº†è§£å†³åŠæ³•ï¼Œä¸è¿‡è¿˜æ˜¯æƒ³æ·±å…¥åœ°äº†è§£ä¸€ä¸‹ kubelet æŒ‚è½½å­˜å‚¨çš„åŸç†å’Œè¿‡ç¨‹ï¼Œäºæ˜¯å°±æ°´äº†è¿™ç¯‡åšå®¢ ğŸ˜‚ã€‚è™½ç„¶å¹³æ—¶ä¹ŸçŸ¥é“ PV ã€PVC ã€å­˜å‚¨ç±»ç­‰æ€ä¹ˆä½¿ç”¨ï¼Œä½†èƒŒåçš„è¿‡ç¨‹å’ŒåŸç†å´æ²¡æœ‰æ·±ç©¶è¿‡ï¼Œæœ‰ç‚¹ä¸€çŸ¥åŠè§£çš„æ„Ÿè§‰ã€‚å”‰ï¼Œå¤ªèœäº† ğŸ˜‘ ï¼ˆ<code>æµä¸‹äº†æ²¡æœ‰æŠ€æœ¯çš„çœ¼æ³ª.jpg</code></p><h2 id="ç–‘æƒ‘"><a href="#ç–‘æƒ‘" class="headerlink" title="ç–‘æƒ‘"></a>ç–‘æƒ‘</h2><blockquote><p>å½“ä½¿ç”¨ NFS å­˜å‚¨çš„ Pod è°ƒåº¦åˆ°æ²¡æœ‰å®‰è£… NFS client (nfs-utils ã€nfs-common) Node èŠ‚ç‚¹ä¸Šçš„æ—¶å€™ï¼Œä¼šæç¤º NFS volume æŒ‚è½½å¤±è´¥ï¼ŒNode å®¿ä¸»æœºå®‰è£…ä¸Š NFS client åå°±å¯ä»¥æ­£å¸¸æŒ‚è½½äº†ï¼Œæˆ‘æƒ³æ˜¯ä¸æ˜¯ kubelet åœ¨å¯åŠ¨å®¹å™¨ä¹‹å‰æ˜¯ä¸æ˜¯è°ƒç”¨ system-run å»æŒ‚è½½ NFS ï¼Œå¦‚æœ Node å®¿ä¸»æœºæ²¡æœ‰å®‰è£… NFS client å°±æ— æ³•æŒ‚è½½ã€‚</p><p>ç¿»äº†ä¸€ä¸‹æºç  <a href="https://github.com/kubernetes/kubernetes/blob/master/vendor/k8s.io/utils/mount/mount_linux.go#L115" target="_blank" rel="noopener">mount_linux.go</a> å’Œ <a href="https://github.com/kubernetes/kubernetes/pull/49640" target="_blank" rel="noopener">49640</a> è¿™ä¸ª PRã€‚é‡Œé¢æåˆ°çš„æ˜¯ kubelet æŒ‚è½½å­˜å‚¨å·çš„æ—¶å€™ä½¿ç”¨ system-run æŒ‚è½½ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå³ä¾¿ kubelet æŒ‚æ‰æˆ–è€…é‡å¯çš„æ—¶å€™ä¹Ÿä¸ä¼šå½±å“åˆ°å®¹å™¨ä½¿ç”¨ kubelet æŒ‚è½½çš„å­˜å‚¨å·ã€‚</p></blockquote><p>è¯·æ•™äº†ä¸€ä¸‹ä¸¤ä¸ªå¤§ä½¬ <a href="https://zdyxry.github.io/" target="_blank" rel="noopener">Yiran</a> å’Œ <a href="http://gaocegege.com/Blog/about/" target="_blank" rel="noopener">é«˜ç­–</a>ï¼Œä»–ä»¬ä¹Ÿä¸å¤ªç†Ÿæ‚‰ğŸ˜‚ï¼Œä¸è¿‡ä¹Ÿæ‰¾åˆ°äº†è§£å†³æ€è·¯ã€‚åœ¨ä½¿ç”¨ GlusterFS çš„æ—¶å€™ï¼ŒNode èŠ‚ç‚¹ä¹Ÿéœ€è¦å®‰è£… GlusterFS çš„å®¢æˆ·ç«¯ï¼Œä¸ç„¶ kubelet ä¹Ÿæ˜¯æ— æ³•æŒ‚è½½ Pod çš„ volumeã€‚ç”±æ­¤å¯ä»¥ç¡®è®¤çš„æ˜¯ï¼š kubelet åœ¨ä¸º Pod æŒ‚è½½ volume çš„æ—¶å€™ï¼Œæ ¹æ® volume çš„ç±»å‹ï¼ˆNFSã€GlusterFSã€Ceph ç­‰ï¼‰ï¼ŒPod æ‰€åœ¨çš„ Node èŠ‚ç‚¹å®¿ä¸»æœºä¹Ÿéœ€è¦å®‰è£…å¥½å¯¹åº”çš„å®¢æˆ·ç«¯ç¨‹åºã€‚</p><h2 id="é—®é¢˜å¤ç°"><a href="#é—®é¢˜å¤ç°" class="headerlink" title="é—®é¢˜å¤ç°"></a>é—®é¢˜å¤ç°</h2><p>é›†ç¾¤ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-01 opt]# kubectl get node</span><br><span class="line">NAME            STATUS   ROLES    AGE    VERSION</span><br><span class="line">k8s-master-01   Ready    master   8d     v1.17.4</span><br><span class="line">k8s-master-02   Ready    master   8d     v1.17.4</span><br><span class="line">k8s-master-03   Ready    master   8d     v1.17.4</span><br><span class="line">k8s-node-02     Ready    &lt;none&gt; 8d     v1.17.4</span><br><span class="line">k8s-node-3      Ready    &lt;none&gt; 3d3h   v1.17.4</span><br><span class="line">node1           Ready    &lt;none&gt; 108s   v1.17.4</span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿å¤ç°é—®é¢˜è¿˜æ˜¯åœ¨ Rancher ä¸Šåˆ›å»ºäº† PV å’Œ PVCï¼Œä»¥åŠåŒ…å«ä¸¤ä¸ª Pod çš„ä¸€ä¸ª <code>Deploment</code>ï¼Œåœ¨åˆ›å»º Deploment çš„æ—¶å€™ï¼ŒæŒ‡å®šå°† Pod è°ƒåº¦åˆ°æ–°åŠ å…¥çš„èŠ‚ç‚¹ä¸Šï¼Œå³è¿™ä¸ªèŠ‚ç‚¹ä¸Šå¹¶æ²¡æœ‰å®‰è£… NFS å®¢æˆ·ç«¯ã€‚</p><p><strong>PV ä¿¡æ¯å¦‚ä¸‹ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-01 opt]# kubectl describe pv nfs211</span><br><span class="line">Name:            nfs211</span><br><span class="line">Labels:          cattle.io/creator=norman</span><br><span class="line">Annotations:     field.cattle.io/creatorId: user-gwgpp</span><br><span class="line">                 pv.kubernetes.io/bound-by-controller: yes</span><br><span class="line">Finalizers:      [kubernetes.io/pv-protection]</span><br><span class="line">StorageClass:    nfs216</span><br><span class="line">Status:          Bound</span><br><span class="line">Claim:           ops-test/nfs-211</span><br><span class="line">Reclaim Policy:  Retain</span><br><span class="line">Access Modes:    RWX</span><br><span class="line">VolumeMode:      Filesystem</span><br><span class="line">Capacity:        10Gi</span><br><span class="line">Node Affinity:   &lt;none&gt;</span><br><span class="line">Message:</span><br><span class="line">Source:</span><br><span class="line">    Type:      NFS (an NFS mount that lasts the lifetime of a pod)</span><br><span class="line">    Server:    10.20.172.211</span><br><span class="line">    Path:      /nfs</span><br><span class="line">    ReadOnly:  false</span><br><span class="line">Events:        &lt;none&gt;</span><br></pre></td></tr></table></figure><p><strong>PVC ä¿¡æ¯å¦‚ä¸‹</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"accessModes"</span>: [</span><br><span class="line">        <span class="string">"ReadWriteMany"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"annotations"</span>: &#123;</span><br><span class="line">        <span class="attr">"pv.kubernetes.io/bind-completed"</span>: <span class="string">"yes"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"baseType"</span>: <span class="string">"persistentVolumeClaim"</span>,</span><br><span class="line">    <span class="attr">"created"</span>: <span class="string">"2020-04-30T08:59:15Z"</span>,</span><br><span class="line">    <span class="attr">"createdTS"</span>: <span class="number">1588237155000</span>,</span><br><span class="line">    <span class="attr">"creatorId"</span>: <span class="string">"user-gwgpp"</span>,</span><br><span class="line">    <span class="attr">"id"</span>: <span class="string">"ops-test:nfs-211"</span>,</span><br><span class="line">    <span class="attr">"labels"</span>: &#123;</span><br><span class="line">        <span class="attr">"cattle.io/creator"</span>: <span class="string">"norman"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"links"</span>: &#123;</span><br><span class="line">        <span class="attr">"remove"</span>: <span class="string">"â€¦/v3/project/c-rl5jz:p-knsxt/persistentVolumeClaims/ops-test:nfs-211"</span>,</span><br><span class="line">        <span class="attr">"self"</span>: <span class="string">"â€¦/v3/project/c-rl5jz:p-knsxt/persistentVolumeClaims/ops-test:nfs-211"</span>,</span><br><span class="line">        <span class="attr">"update"</span>: <span class="string">"â€¦/v3/project/c-rl5jz:p-knsxt/persistentVolumeClaims/ops-test:nfs-211"</span>,</span><br><span class="line">        <span class="attr">"yaml"</span>: <span class="string">"â€¦/v3/project/c-rl5jz:p-knsxt/persistentVolumeClaims/ops-test:nfs-211/yaml"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"nfs-211"</span>,</span><br><span class="line">    <span class="attr">"namespaceId"</span>: <span class="string">"ops-test"</span>,</span><br><span class="line">    <span class="attr">"projectId"</span>: <span class="string">"c-rl5jz:p-knsxt"</span>,</span><br><span class="line">    <span class="attr">"resources"</span>: &#123;</span><br><span class="line">        <span class="attr">"requests"</span>: &#123;</span><br><span class="line">            <span class="attr">"storage"</span>: <span class="string">"10Gi"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"/v3/project/schemas/resourceRequirements"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"state"</span>: <span class="string">"bound"</span>,</span><br><span class="line">    <span class="attr">"status"</span>: &#123;</span><br><span class="line">        <span class="attr">"accessModes"</span>: [</span><br><span class="line">            <span class="string">"ReadWriteMany"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"capacity"</span>: &#123;</span><br><span class="line">            <span class="attr">"storage"</span>: <span class="string">"10Gi"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"phase"</span>: <span class="string">"Bound"</span>,</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"/v3/project/schemas/persistentVolumeClaimStatus"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"storageClassId"</span>: <span class="string">"nfs216"</span>,</span><br><span class="line">    <span class="attr">"transitioning"</span>: <span class="string">"no"</span>,</span><br><span class="line">    <span class="attr">"transitioningMessage"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"persistentVolumeClaim"</span>,</span><br><span class="line">    <span class="attr">"uuid"</span>: <span class="string">"660dc8d1-7911-4d30-b575-b54990de8667"</span>,</span><br><span class="line">    <span class="attr">"volumeId"</span>: <span class="string">"nfs211"</span>,</span><br><span class="line">    <span class="attr">"volumeMode"</span>: <span class="string">"Filesystem"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Deploment ä¿¡æ¯å¦‚ä¸‹ï¼š</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">deployment.kubernetes.io/revision:</span> <span class="string">"1"</span></span><br><span class="line">    <span class="attr">field.cattle.io/creatorId:</span> <span class="string">user-gwgpp</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="string">"2020-04-30T09:00:19Z"</span></span><br><span class="line">  <span class="attr">generation:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">cattle.io/creator:</span> <span class="string">norman</span></span><br><span class="line">    <span class="attr">workload.user.cattle.io/workloadselector:</span> <span class="string">deployment-ops-test-node1-nfs-test</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">node1-nfs-test</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops-test</span></span><br><span class="line">  <span class="attr">resourceVersion:</span> <span class="string">"1940561"</span></span><br><span class="line">  <span class="attr">selfLink:</span> <span class="string">/apis/apps/v1/namespaces/ops-test/deployments/node1-nfs-test</span></span><br><span class="line">  <span class="attr">uid:</span> <span class="string">5d14a158-1eef-4a94-8433-15ad002ee55c</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">progressDeadlineSeconds:</span> <span class="number">600</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">workload.user.cattle.io/workloadselector:</span> <span class="string">deployment-ops-test-node1-nfs-test</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxSurge:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">cattle.io/timestamp:</span> <span class="string">"2020-04-30T09:01:05Z"</span></span><br><span class="line">        <span class="attr">workload.cattle.io/state:</span> <span class="string">'&#123;"bm9kZTE=":"c-rl5jz:machine-wbs6r"&#125;'</span></span><br><span class="line">      <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">workload.user.cattle.io/workloadselector:</span> <span class="string">deployment-ops-test-node1-nfs-test</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">alpine</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">node1-nfs-test</span></span><br><span class="line">        <span class="attr">resources:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">allowPrivilegeEscalation:</span> <span class="literal">false</span></span><br><span class="line">          <span class="attr">capabilities:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">          <span class="attr">privileged:</span> <span class="literal">false</span></span><br><span class="line">          <span class="attr">readOnlyRootFilesystem:</span> <span class="literal">false</span></span><br><span class="line">          <span class="attr">runAsNonRoot:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">stdin:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">terminationMessagePath:</span> <span class="string">/dev/termination-log</span></span><br><span class="line">        <span class="attr">terminationMessagePolicy:</span> <span class="string">File</span></span><br><span class="line">        <span class="attr">tty:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/tmp</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">vol1</span></span><br><span class="line">      <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line">      <span class="attr">nodeName:</span> <span class="string">node1</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">      <span class="attr">schedulerName:</span> <span class="string">default-scheduler</span></span><br><span class="line">      <span class="attr">securityContext:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">30</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">vol1</span></span><br><span class="line">        <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">          <span class="attr">claimName:</span> <span class="string">nfs-211</span></span><br></pre></td></tr></table></figure><p>åˆ›å»ºå®Œ Deploment ä¹‹åï¼Œä½¿ç”¨ kubectl get pod å‘½ä»¤æŸ¥çœ‹ Pod åˆ›å»ºçš„è¿›åº¦ï¼Œå‘ç°ä¸€ç›´å¡åœ¨ <code>ContainerCreating</code> çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-01 opt]# kubectl get pod -n ops-test</span><br><span class="line">NAME                              READY   STATUS              RESTARTS   AGE</span><br><span class="line">node1-nfs-test-547c4d7678-j6kwv   0/1     ContainerCreating   0          2m12s</span><br><span class="line">node1-nfs-test-547c4d7678-vwdqg   0/1     ContainerCreating   0          2m12s</span><br></pre></td></tr></table></figure><p>kubectl describe pod çš„æ—¥å¿—å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-01 opt]# kubectl describe pod node1-nfs-test-547c4d7678-j6kwv -n ops-test</span><br><span class="line">Name:           node1-nfs-test-547c4d7678-j6kwv</span><br><span class="line">Namespace:      ops-test</span><br><span class="line">Priority:       0</span><br><span class="line">Node:           node1/10.10.107.214</span><br><span class="line">Start Time:     Thu, 30 Apr 2020 17:00:33 +0800</span><br><span class="line">Labels:         pod-template-hash=547c4d7678</span><br><span class="line">                workload.user.cattle.io/workloadselector=deployment-ops-test-node1-nfs-test</span><br><span class="line">Annotations:    cattle.io/timestamp: 2020-04-30T09:01:05Z</span><br><span class="line">                workload.cattle.io/state: &#123;"bm9kZTE=":"c-rl5jz:machine-wbs6r"&#125;</span><br><span class="line">Status:         Pending</span><br><span class="line">IP:</span><br><span class="line">IPs:            &lt;none&gt;</span><br><span class="line">Controlled By:  ReplicaSet/node1-nfs-test-547c4d7678</span><br><span class="line">Containers:</span><br><span class="line">  node1-nfs-test:</span><br><span class="line">    Container ID:</span><br><span class="line">    Image:          alpine</span><br><span class="line">    Image ID:</span><br><span class="line">    Port:           &lt;none&gt;</span><br><span class="line">    Host Port:      &lt;none&gt;</span><br><span class="line">    State:          Waiting</span><br><span class="line">      Reason:       ContainerCreating</span><br><span class="line">    Ready:          False</span><br><span class="line">    Restart Count:  0</span><br><span class="line">    Environment:    &lt;none&gt;</span><br><span class="line">    Mounts:</span><br><span class="line">      /tmp from vol1 (rw)</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from default-token-f6wjj (ro)</span><br><span class="line">Conditions:</span><br><span class="line">  Type              Status</span><br><span class="line">  Initialized       True</span><br><span class="line">  Ready             False</span><br><span class="line">  ContainersReady   False</span><br><span class="line">  PodScheduled      True</span><br><span class="line">Volumes:</span><br><span class="line">  vol1:</span><br><span class="line">    Type:       PersistentVolumeClaim (a reference to a PersistentVolumeClaim in the same namespace)</span><br><span class="line">    ClaimName:  nfs-211</span><br><span class="line">    ReadOnly:   false</span><br><span class="line">  default-token-f6wjj:</span><br><span class="line">    Type:        Secret (a volume populated by a Secret)</span><br><span class="line">    SecretName:  default-token-f6wjj</span><br><span class="line">    Optional:    false</span><br><span class="line">QoS Class:       BestEffort</span><br><span class="line">Node-Selectors:  &lt;none&gt;</span><br><span class="line">Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s</span><br><span class="line">                 node.kubernetes.io/unreachable:NoExecute for 300s</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason       Age    From            Message</span><br><span class="line">  ----  ------  ---- ----     -------</span><br><span class="line">  Warning  FailedMount  8m49s  kubelet, node1  MountVolume.SetUp failed for volume "nfs211" : mount failed: exit status 32</span><br><span class="line">Mounting command: systemd-run</span><br><span class="line">Mounting arguments: --description=Kubernetes transient mount for /var/lib/kubelet/pods/cddc94e7-8033-4150-bed5-d141e3b71e49/volumes/kubernetes.io~nfs/nfs211 --scope -- mount -t nfs 10.20.172.211:/nfs /var/lib/kubelet/pods/cddc94e7-8033-4150-bed5-d141e3b71e49/volumes/kubernetes.io~nfs/nfs211</span><br><span class="line">Output: Running scope as unit run-38284.scope.</span><br><span class="line">mount: wrong fs type, bad option, bad superblock on 10.20.172.211:/nfs,</span><br><span class="line">       missing codepage or helper program, or other error</span><br><span class="line">       (for several filesystems (e.g. nfs, cifs) you might</span><br><span class="line">       need a /sbin/mount.&lt;type&gt; helper program)</span><br><span class="line"></span><br><span class="line">       In some cases useful info is found in syslog - try</span><br><span class="line">       dmesg | tail or so.</span><br><span class="line">  Warning  FailedMount  8m48s  kubelet, node1  MountVolume.SetUp failed for volume "nfs211" : mount failed: exit status 32</span><br></pre></td></tr></table></figure><p>åœ¨ ä¸€å°æ²¡æœ‰å®‰è£… NFS å®¢æˆ·ç«¯çš„èŠ‚ç‚¹å°è¯•æŒ‚è½½ä¸€ä¸‹ NFS å­˜å‚¨ï¼Œå‘ç°æŠ¥é”™çš„æ—¥å¿—å’Œ kubelet çš„æ—¥å¿—ç›¸åŒğŸ¤”</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-03 ~]# mount -t nfs 10.20.172.211:/nfs /tmp</span><br><span class="line">mount: wrong fs type, bad option, bad superblock on 10.20.172.211:/nfs,</span><br><span class="line">       missing codepage or helper program, or other error</span><br><span class="line">       (for several filesystems (e.g. nfs, cifs) you might</span><br><span class="line">       need a /sbin/mount.&lt;type&gt; helper program)</span><br><span class="line"></span><br><span class="line">       In some cases useful info is found in syslog - try</span><br><span class="line">       dmesg | tail or so.</span><br></pre></td></tr></table></figure><h2 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h2><p>çœ‹åˆ° kubelet æŠ¥é”™çš„æ—¥å¿—å’Œæˆ‘ä»¬åœ¨å®¿ä¸»æœºä¸Šä½¿ç”¨ mount åæŒ‚è½½ NFS å­˜å‚¨æ—¶çš„é”™è¯¯ä¸€æ ·å°±å¯ä»¥æ–­å®šä¸ºæ˜¯å®¿ä¸»æœºçš„é—®é¢˜ã€‚æœäº†ä¸€ä¸‹æŠ¥é”™æ—¥å¿—ï¼Œåœ¨ <a href="https://askubuntu.com/questions/525243/why-do-i-get-wrong-fs-type-bad-option-bad-superblock-error" target="_blank" rel="noopener">Why do I get â€œwrong fs type, bad option, bad superblockâ€ error?</a> å¾—åˆ°æç¤ºè¯´éœ€è¦å®‰è£…ä¸€ä¸‹ NFS å®¢æˆ·ç«¯ (nfs-commonã€nfs-utils) ğŸ˜‚ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@node1 ~</span><br><span class="line">â•°â”€# yum install nfs-utils</span><br><span class="line">â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class="line">Install  1 Package (+15 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 1.5 M</span><br><span class="line">Installed size: 4.3 M</span><br><span class="line">Is this ok [y/d/N]:</span><br></pre></td></tr></table></figure><p>yum ä¸€æŠŠæ¢­åå‘ç° <code>nfs-utils</code> è¿˜çœŸæ²¡æœ‰å®‰è£…ğŸ˜‚ã€‚</p><p>å®‰è£…å®Œæ—¶å€™ä½¿ç”¨ kubectl åˆ é™¤æ‰ä¹‹å‰çš„ Podï¼ŒDeploment æ§åˆ¶å™¨ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å°† Pod æ•°é‡è°ƒå’Œåˆ°æŒ‡å®šçš„æ•°é‡ã€‚å¯ä»¥å‘ç° Pod æ‰€åœ¨å®¿ä¸»æœºå®‰è£… NFS å®¢æˆ·ç«¯ä¹‹å kubelet å°±èƒ½æ­£å¸¸ä¸º Pod æŒ‚è½½ volume äº† è€Œä¸” Pod ä¹Ÿæ­£å¸¸è¿è¡Œäº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-01 ~]# kubectl delete pod node1-nfs-test-547c4d7678-j6kwv node1-nfs-test-547c4d7678-vwdqg -n ops-test</span><br><span class="line">pod "node1-nfs-test-547c4d7678-j6kwv" deleted</span><br><span class="line">pod "node1-nfs-test-547c4d7678-vwdqg" deleted</span><br><span class="line">[root@k8s-master-01 ~]# kubectl get pod -n ops-test</span><br><span class="line">NAME                              READY   STATUS    RESTARTS   AGE</span><br><span class="line">node1-nfs-test-7589fb4787-cknz4   1/1     Running   0          18s</span><br><span class="line">node1-nfs-test-7589fb4787-l9bt2   1/1     Running   0          22s</span><br></pre></td></tr></table></figure><p>è¿›å…¥å®¹å™¨å†…æŸ¥çœ‹ä¸€ä¸‹å®¹å™¨å†…æŒ‚è½½ç‚¹çš„ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-01 ~]# kubectl exec -it node1-nfs-test-7589fb4787-cknz4 -n ops-test sh</span><br><span class="line">/ # df -h</span><br><span class="line">Filesystem                Size      Used Available Use% Mounted on</span><br><span class="line">overlay                  28.9G      4.1G     23.3G  15% /</span><br><span class="line">10.20.172.211:/nfs       28.9G     14.5G     12.9G  53% /tmp</span><br><span class="line">tmpfs                     1.8G         0      1.8G   0% /sys/firmware</span><br><span class="line">/ # mount</span><br><span class="line">rootfs on / type rootfs (rw)</span><br><span class="line">10.20.172.211:/nfs on /tmp type nfs (rw,relatime,vers=3,rsize=524288,wsize=524288,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,mountaddr=10.20.172.211,mountvers=3,mountport=20048,mountproto=udp,local_lock=none,addr=10.20.172.211)</span><br><span class="line"></span><br><span class="line">10.20.172.211:/nfs on /mnt/nfs type nfs (rw,relatime,vers=3,rsize=524288,wsize=524288,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,mountaddr=10.20.172.211,mountvers=3,mountport=20048,mountproto=udp,local_lock=none,addr=10.20.172.211)</span><br></pre></td></tr></table></figure><p>è‡³æ­¤é—®é¢˜å·²ç»è§£å†³äº†ï¼Œæ¥ä¸‹æ¥å°±åˆ°äº†æ­£æ–‡ï¼šå¼€å§‹åˆ†æä¸€ä¸‹  kubelet ä¸º Pod æŒ‚è½½ volume çš„æµç¨‹å’ŒåŸç†ğŸ˜‚</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><h3 id="å®¹å™¨å­˜å‚¨"><a href="#å®¹å™¨å­˜å‚¨" class="headerlink" title="å®¹å™¨å­˜å‚¨"></a>å®¹å™¨å­˜å‚¨</h3><p>åœ¨åˆ†æ Pod çš„ volume ä¹‹å‰éœ€è¦å…ˆäº†è§£ä¸€ä¸‹ docker å®¹å™¨çš„å­˜å‚¨ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ <code>docker inspect</code> &lt;å®¹å™¨ ID&gt; å‘½ä»¤æ¥æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯æ—¶ï¼Œåœ¨å®¹å™¨å…ƒæ•°æ®ä¿¡æ¯çš„ <code>GraphDriver</code> å­—æ®µä¸‹åŒ…å«ç€ä¸€ä¸ª <code>Mounts</code> ï¼Œè€Œ <code>Mounts</code> å­—æ®µé‡Œçš„æ­£æ˜¯å®¹å™¨æŒ‚è½½çš„å­˜å‚¨ï¼Œå…¶ä¸­é‡Œé¢çš„ <code>Type</code> å­—æ®µé‡Œæœ‰ <code>bind</code> å’Œ <code>volume</code> ï¼Œå…¶å®è¿˜æœ‰ä¸€ä¸ª <code>tmpfs</code>ã€‚</p><p>å¦å¤–å…¶ä¸­çš„ <code>Data</code> å­—æ®µé‡Œçš„ <code>LowerDir</code> æ­£æ˜¯å®¹å™¨çš„é•œåƒå±‚ï¼Œå…³äºå®¹å™¨é•œåƒå±‚çš„è®²è§£å»ºè®®é˜…è¯»ä¸€ä¸‹ <a href="https://arkingc.github.io/2018/01/15/2018-01-15-docker-storage-overlay2/" target="_blank" rel="noopener">Dockeræºç åˆ†æâ€”å­˜å‚¨é©±åŠ¨</a> ï¼Œè¿™ç¯‡æºç åˆ†æğŸ‘ï¼Œåœ¨è¿™é‡Œç‚¹åˆ°ä¸ºæ­¢å°±ä¸å†ç»†ç©¶äº†ğŸ˜‚</p><blockquote><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†è§£äº†å±‚çš„åˆ›å»ºå’Œåˆ é™¤è¿‡ç¨‹ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸€ç›´æ²¡æœ‰æåˆ°ä¸€ä¸ªé—®é¢˜ï¼š<strong>æˆ‘ä»¬åœ¨å®¹å™¨å†…çœ‹åˆ°çš„æ–‡ä»¶å­˜åœ¨å“ªï¼Ÿ</strong></p><p>æˆ‘ä»¬å·²ç»çŸ¥é“å±‚ç›®å½•ä¸‹æœ‰diffï¼Œmergedå’Œwork 3ä¸ªç›®å½•ã€‚diffå­˜å‚¨çš„æ˜¯è¯¥å±‚çš„æ–‡ä»¶ï¼Œworkæ˜¯æ‰§è¡Œä¸€äº›ç‰¹å®šæ“ä½œæ—¶æ‰€è¦ç”¨åˆ°çš„ç›®å½•ï¼Œæ‰€ä»¥å®é™…ä¸Šï¼Œ<strong>åœ¨å®¹å™¨å†…çœ‹åˆ°çš„æ–‡ä»¶ï¼Œå°±å­˜åœ¨äºmergedç›®å½•ä¸‹</strong></p><p><strong>mergedç›®å½•åœ¨å®¹å™¨æœªè¿è¡Œæ—¶ï¼Œæ˜¯ä¸€ä¸ªç©ºç›®å½•ï¼Œå½“å®¹å™¨å¯åŠ¨æ—¶ä¼šå°†è¯¥å®¹å™¨æ‰€æœ‰å±‚çš„diffç›®å½•è¿›è¡Œè”åˆæŒ‚è½½ï¼ŒæŒ‚è½½åˆ°mergedç›®å½•ä¸‹ï¼ŒæŒ‚è½½æ—¶ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿå°±æ˜¯å†…æ ¸OverlayFSæ–‡ä»¶ç³»ç»Ÿ</strong></p><blockquote><p>å¦‚æœæœ‰çœ‹è¿‡æˆ‘å…³äºå†…æ ¸OverlayFSç›¸å…³çš„åšæ–‡ï¼Œè¿™é‡Œåº”è¯¥å·²ç»å¯¹Dockerçš„overlay2å­˜å‚¨é©±åŠ¨ä¸å†…æ ¸OverlayFSçš„å…³ç³»æœ‰äº†ä¸€ä¸ªæ¯”è¾ƒæ¸…æ™°çš„è®¤è¯†</p></blockquote><p><strong>å½“æŒ‚è½½å®Œæˆåï¼Œå®¹å™¨å¤„äºä¸€ä¸ªå­æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ï¼Œåªèƒ½çœ‹åˆ°mergedç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œç›¸å½“äºchrootå‘½ä»¤çš„æ•ˆæœ</strong></p><p>æ‰€ä»¥ï¼Œåœ¨åœæ­¢ä¸€ä¸ªå®¹å™¨æ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯å¯¹mergedç›®å½•æ‰§è¡Œä¸€ä¸ªå¸è½½å‘½ä»¤</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">"GraphDriver": &#123;</span><br><span class="line">            "Data": &#123;</span><br><span class="line">                "LowerDir": "/var/lib/docker/overlay2/2a846f62b759d87bf8b2731960c4031585fb4ee14bbf313f58e0374c4fee9ce0-init/diff:/var/lib/docker/overlay2/29f9a1e9523d4ec323402a3c2da8a5e288cfe0e6f3168a57dd2388b63775c20a/diff:/var/lib/docker/overlay2/015afa447ae2fcfa592d257644312b286173b9a00d0f2017a4c6ede448a87d47/diff:/var/lib/docker/overlay2/2f71b56cd5550bf299ed33a04e385ef5578511e3a17d35162148f4b84bda4b26/diff",</span><br><span class="line">                "MergedDir": "/var/lib/docker/overlay2/2a846f62b759d87bf8b2731960c4031585fb4ee14bbf313f58e0374c4fee9ce0/merged",</span><br><span class="line">                "UpperDir": "/var/lib/docker/overlay2/2a846f62b759d87bf8b2731960c4031585fb4ee14bbf313f58e0374c4fee9ce0/diff",</span><br><span class="line">                "WorkDir": "/var/lib/docker/overlay2/2a846f62b759d87bf8b2731960c4031585fb4ee14bbf313f58e0374c4fee9ce0/work"</span><br><span class="line">            &#125;,</span><br><span class="line">            "Name": "overlay2"</span><br><span class="line">        &#125;,</span><br><span class="line">        "Mounts": [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"Type"</span>: <span class="string">"bind"</span>,</span><br><span class="line">                <span class="attr">"Source"</span>: <span class="string">"/opt/wordpress-nginx-docker/webp-server/config.json"</span>,</span><br><span class="line">                <span class="attr">"Destination"</span>: <span class="string">"/etc/config.json"</span>,</span><br><span class="line">                <span class="attr">"Mode"</span>: <span class="string">"rw"</span>,</span><br><span class="line">                <span class="attr">"RW"</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"Propagation"</span>: <span class="string">"rprivate"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"Type"</span>: <span class="string">"bind"</span>,</span><br><span class="line">                <span class="attr">"Source"</span>: <span class="string">"/opt/wordpress-nginx-docker/wordpress"</span>,</span><br><span class="line">                <span class="attr">"Destination"</span>: <span class="string">"/var/www/html"</span>,</span><br><span class="line">                <span class="attr">"Mode"</span>: <span class="string">"rw"</span>,</span><br><span class="line">                <span class="attr">"RW"</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"Propagation"</span>: <span class="string">"rprivate"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"Type"</span>: <span class="string">"volume"</span>,</span><br><span class="line">                <span class="attr">"Name"</span>: <span class="string">"36d087638f2e9ba8472c441bcf906320cfd80419874291f56e039e4f7d1278e7"</span>,</span><br><span class="line">                <span class="attr">"Source"</span>: <span class="string">"/var/lib/docker/volumes/36d087638f2e9ba8472c441bcf906320cfd80419874291f56e039e4f7d1278e7/_data"</span>,</span><br><span class="line">                <span class="attr">"Destination"</span>: <span class="string">"/opt/exhaust"</span>,</span><br><span class="line">                <span class="attr">"Driver"</span>: <span class="string">"local"</span>,</span><br><span class="line">                <span class="attr">"Mode"</span>: <span class="string">""</span>,</span><br><span class="line">                <span class="attr">"RW"</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"Propagation"</span>: <span class="string">""</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br></pre></td></tr></table></figure><p>æ ¹æ® docker çš„å®˜æ–¹æ–‡æ¡£ <a href="https://docs.docker.com/storage/" target="_blank" rel="noopener">Manage data in Docker</a> ï¼Œdocker æä¾›äº† 3 ç§æ–¹æ³•å°†æ•°æ®ä» Docker å®¿ä¸»æœºæŒ‚è½½ï¼ˆmountï¼‰åˆ°å®¹å™¨å†…ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="img/types-of-mounts.png" alt="docker-data"></p><p><code>å›¾ç‰‡ä» Docker å®˜æ–¹æ–‡æ¡£å·æ¥çš„ğŸ˜‚</code></p><blockquote><ul><li><strong>Volumes</strong> are stored in a part of the host filesystem which is <em>managed by Docker</em> (<code>/var/lib/docker/volumes/</code> on Linux). Non-Docker processes should not modify this part of the filesystem. Volumes are the best way to persist data in Docker.</li><li><strong>Bind mounts</strong> may be stored <em>anywhere</em> on the host system. They may even be important system files or directories. Non-Docker processes on the Docker host or a Docker container can modify them at any time.</li><li><strong><code>tmpfs</code> mounts</strong> are stored in the host systemâ€™s memory only, and are never written to the host systemâ€™s filesystem.</li></ul></blockquote><p>å¯ä»¥çœ‹åˆ°å®¹å™¨å¯ä»¥ä½¿ç”¨çš„å­˜å‚¨æœ‰ä¸‰ç§ï¼š</p><ul><li>Volumesï¼šä½¿ç”¨ Docker æ¥ç®¡ç†çš„å­˜å‚¨ï¼Œé»˜è®¤å­˜æ”¾åœ¨ <code>/var/lib/docker/volumes/</code> ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>docker volume</code> å­å‘½ä»¤æ¥ç®¡ç†è¿™äº› volume ï¼Œå¯ä»¥åˆ›å»ºã€æŸ¥çœ‹ã€åˆ—å‡ºã€æ¸…ç©ºã€åˆ é™¤ç­‰æ“ä½œã€‚é docker è¿›ç¨‹ä¸åº”è¯¥å»ä¿®æ”¹è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œ<strong>å·æ˜¯ Docker å®¹å™¨æŒä¹…åŒ–æ•°æ®çš„æœ€å¥½æ–¹å¼</strong>ã€‚</li></ul><blockquote><p><code>-v</code>æˆ–<code>--volume</code>ï¼šç”±3ä¸ªåŸŸç»„æˆï¼Œ<code>&#39;:&#39;</code>åˆ†éš”</p><ul><li>ç¬¬ä¸€ä¸ªåŸŸï¼šå¯¹äºå‘½åå·ï¼Œä¸ºå·åï¼›åŒ¿åå·ï¼Œåˆ™å¿½ç•¥ï¼Œæ­¤æ—¶ä¼šåˆ›å»ºåŒ¿åå·</li><li>ç¬¬äºŒä¸ªåŸŸï¼šå®¹å™¨ä¸­çš„æŒ‚è½½ç‚¹</li><li>ç¬¬ä¸‰ä¸ªåŸŸï¼šå¯é€‰å‚æ•°ï¼Œç”±<code>&#39;,&#39;</code>éš”å¼€ï¼Œå¦‚<code>ro</code></li></ul></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# docker volume</span><br><span class="line">Usage:  docker volume COMMAND</span><br><span class="line">Manage volumes</span><br><span class="line">Commands:</span><br><span class="line">  create      Create a volume</span><br><span class="line">  inspect     Display detailed information on one or more volumes</span><br><span class="line">  ls          List volumes</span><br><span class="line">  prune       Remove all unused local volumes</span><br><span class="line">  rm          Remove one or more volumes</span><br><span class="line">Run 'docker volume COMMAND --help' for more information on a command.</span><br></pre></td></tr></table></figure><p>å‡å¦‚åœ¨å†™ <code>Dockerfile</code> çš„æ—¶å€™ï¼Œä½¿ç”¨ <code>VOLUME</code> æŒ‡ä»¤æŒ‡å®šå®¹å™¨å†…çš„è·¯å¾„ã€‚åœ¨æˆ‘ä»¬å¯åŠ¨å®¹å™¨çš„æ—¶å€™ docker ä¼šå¸®æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨çš„ volumeã€‚ä¹Ÿå¯åœ¨ <code>docker run</code> æˆ–è€… <code>docker-compose.yaml</code> æŒ‡å®š <code>volume</code> ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# docker volume ls</span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line">local               docker-elk_elasticsearch</span><br><span class="line">local               opt</span><br><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# docker volume inspect opt</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"CreatedAt"</span>: <span class="string">"2020-03-12T06:58:15Z"</span>,</span><br><span class="line">        <span class="attr">"Driver"</span>: <span class="string">"local"</span>,</span><br><span class="line">        <span class="attr">"Labels"</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"Mountpoint"</span>: <span class="string">"/var/lib/docker/volumes/opt/_data"</span>,</span><br><span class="line">        <span class="attr">"Name"</span>: <span class="string">"opt"</span>,</span><br><span class="line">        <span class="attr">"Options"</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"Scope"</span>: <span class="string">"local"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">â•­â”€root@sg-02 /home/ubuntu</span><br><span class="line">â•°â”€# docker inspect docker-elk_elasticsearch</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"CreatedAt"</span>: <span class="string">"2020-04-24T01:37:07Z"</span>,</span><br><span class="line">        <span class="attr">"Driver"</span>: <span class="string">"local"</span>,</span><br><span class="line">        <span class="attr">"Labels"</span>: &#123;</span><br><span class="line">            <span class="attr">"com.docker.compose.project"</span>: <span class="string">"docker-elk"</span>,</span><br><span class="line">            <span class="attr">"com.docker.compose.version"</span>: <span class="string">"1.25.4"</span>,</span><br><span class="line">            <span class="attr">"com.docker.compose.volume"</span>: <span class="string">"elasticsearch"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"Mountpoint"</span>: <span class="string">"/var/lib/docker/volumes/docker-elk_elasticsearch/_data"</span>,</span><br><span class="line">        <span class="attr">"Name"</span>: <span class="string">"docker-elk_elasticsearch"</span>,</span><br><span class="line">        <span class="attr">"Options"</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"Scope"</span>: <span class="string">"local"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ul><li>Bind mountsï¼š</li></ul><p>ä½¿ç”¨ <code>Bind mounts</code> å°†å®¿ä¸»æœºçš„ç›®å½•æˆ–è€…æ–‡ä»¶æŒ‚è½½è¿›å®¹å™¨å†…ï¼Œè¿™ä¸ªæ–‡ä»¶å’Œç›®å½•å¯ä»¥æ˜¯å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„ä»»æ„ä½ç½®ï¼Œå¯ä»¥ä¸å— docker æ‰€ç®¡ç†ï¼Œæ¯”å¦‚ kubelet çš„ volumes ç›®å½•ï¼š<code>/var/lib/kubelet/pods/&lt;Podçš„ID&gt;/volumes/</code> ã€‚ kubelet åœ¨ä¸º Pod æŒ‚è½½å­˜å‚¨çš„æ—¶å€™ä¹Ÿæ­£æ˜¯é€šè¿‡ <code>Bind mounts</code> çš„æ–¹å¼å°† Pod çš„ volumes æŒ‚è½½åˆ°å®¹å™¨å†…ã€‚æ‰€ä»¥å½“æˆ‘ä»¬ä½¿ç”¨ docker inspect å‘½ä»¤å»æŸ¥çœ‹ Pod å†…å®¹å™¨çš„ <code>Mounts</code> ä¿¡æ¯æ˜¯ï¼Œ<code>Type</code> ç±»å‹å¤šä¸º <code>bind</code> æˆ–è€… <code>tmpfs</code> ï¼Œå¾ˆå°‘ä¼šç”¨åˆ° <code>volumes</code> ã€‚å¯ä»¥ç†è§£ä¸º kubelet çš„ volumes ç›®å½•å°±åƒ docker çš„ volumes é‚£æ ·ï¼Œæ˜¯ç”± kubelet è‡ªå·±æ¥ç®¡ç†çš„ï¼Œå…¶ä»–ç”¨æˆ·æˆ–è¿›ç¨‹ä¸åº”è¯¥å»ä¿®æ”¹å®ƒã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-node-3 ~</span><br><span class="line">â•°â”€# docker inspect f1111ee6ac84</span><br><span class="line">"Mounts": [</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="attr">"Type"</span>: <span class="string">"bind"</span>,</span><br><span class="line">      <span class="attr">"Source"</span>: <span class="string">"/var/lib/kubelet/pods/73fed6f3-4cbe-46a7-af7b-6fd912e6ebd4/volumes/kubernetes.io~nfs/nfs211"</span>,</span><br><span class="line">      <span class="attr">"Destination"</span>: <span class="string">"/var/www/html"</span>,</span><br><span class="line">      <span class="attr">"Mode"</span>: <span class="string">""</span>,</span><br><span class="line">      <span class="attr">"RW"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">"Propagation"</span>: <span class="string">"rprivate"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="attr">"Type"</span>: <span class="string">"bind"</span>,</span><br><span class="line">      <span class="attr">"Source"</span>: <span class="string">"/var/lib/kubelet/pods/73fed6f3-4cbe-46a7-af7b-6fd912e6ebd4/volumes/kubernetes.io~secret/default-token-wgfd9"</span>,</span><br><span class="line">      <span class="attr">"Destination"</span>: <span class="string">"/var/run/secrets/kubernetes.io/serviceaccount"</span>,</span><br><span class="line">      <span class="attr">"Mode"</span>: <span class="string">"ro,Z"</span>,</span><br><span class="line">      <span class="attr">"RW"</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">"Propagation"</span>: <span class="string">"rprivate"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="attr">"Type"</span>: <span class="string">"bind"</span>,</span><br><span class="line">      <span class="attr">"Source"</span>: <span class="string">"/var/lib/kubelet/pods/73fed6f3-4cbe-46a7-af7b-6fd912e6ebd4/etc-hosts"</span>,</span><br><span class="line">      <span class="attr">"Destination"</span>: <span class="string">"/etc/hosts"</span>,</span><br><span class="line">      <span class="attr">"Mode"</span>: <span class="string">"Z"</span>,</span><br><span class="line">      <span class="attr">"RW"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">"Propagation"</span>: <span class="string">"rprivate"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="attr">"Type"</span>: <span class="string">"bind"</span>,</span><br><span class="line">      <span class="attr">"Source"</span>: <span class="string">"/var/lib/kubelet/pods/73fed6f3-4cbe-46a7-af7b-6fd912e6ebd4/containers/nginx/f760f2be"</span>,</span><br><span class="line">      <span class="attr">"Destination"</span>: <span class="string">"/dev/termination-log"</span>,</span><br><span class="line">      <span class="attr">"Mode"</span>: <span class="string">"Z"</span>,</span><br><span class="line">      <span class="attr">"RW"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">"Propagation"</span>: <span class="string">"rprivate"</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>Bind mounts</code>å¯èƒ½ä¼šæœ‰å®‰å…¨é—®é¢˜ï¼šå®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹å¯ä»¥ä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬åˆ›å»ºï¼Œä¿®æ”¹ï¼Œåˆ é™¤é‡è¦çš„ç³»ç»Ÿæ–‡ä»¶æˆ–ç›®å½•ã€‚ä¸è¿‡å¯ä»¥åŠ å‚æ•°æŒ‚è½½ä¸ºåªè¯»ã€‚</p><blockquote><p><code>--mount</code>ï¼šç”±å¤šä¸ª<code>&#39;,&#39;</code>éš”å¼€çš„é”®å€¼å¯¹<key>=<value>ç»„æˆï¼š</p><ul><li>æŒ‚è½½ç±»å‹ï¼škeyä¸º<code>type</code>ï¼Œvalueä¸º<code>bind</code>ã€<code>volume</code>æˆ–<code>tmpfs</code></li><li>æŒ‚è½½æºï¼škeyä¸º<code>source</code>æˆ–<code>src</code>ï¼Œå¯¹äºå‘½åå·ï¼Œvalueä¸ºå·åï¼Œå¯¹äºåŒ¿åå·ï¼Œåˆ™å¿½ç•¥</li><li>å®¹å™¨ä¸­çš„æŒ‚è½½ç‚¹ï¼škeyä¸º<code>destination</code>ã€<code>dst</code>æˆ–<code>target</code>ï¼Œvalueä¸ºå®¹å™¨ä¸­çš„è·¯å¾„</li><li>è¯»å†™ç±»å‹ï¼švalueä¸º<code>readonly</code>ï¼Œæ²¡æœ‰key</li><li>è¯»å†™ç±»å‹ï¼švalueä¸º<code>readonly</code>ï¼Œæ²¡æœ‰key</li><li>volume-opté€‰é¡¹ï¼Œå¯ä»¥å‡ºç°å¤šæ¬¡ã€‚æ¯”å¦‚<code>volume-driver=local,volume-opt=type=nfs,...</code></li></ul></blockquote><ul><li><p>tmpsï¼š</p><p>  ç”¨æ¥å­˜å‚¨ä¸€äº›ä¸éœ€è¦æŒä¹…åŒ–çš„çŠ¶æ€æˆ–æ•æ„Ÿæ•°æ®ï¼Œæ¯”å¦‚ <code>kubernetes</code> ä¸­çš„å„ç§ <code>secret</code> ã€‚æ¯”å¦‚å½“æˆ‘ä»¬ä½¿ç”¨ <code>kubectl exec -it POD</code> ï¼Œè¿›å…¥åˆ° Pod å®¹å™¨å†…ï¼Œç„¶åä½¿ç”¨ mount å‘½ä»¤æŸ¥çœ‹å®¹å™¨å†…çš„æŒ‚è½½ç‚¹ä¿¡æ¯å°±ä¼šæœ‰å¾ˆå¤š tmpfs ç±»å‹çš„æŒ‚è½½ç‚¹ã€‚å…¶ä¸­çš„ <code>/run/secrets/kubernetes.io/serviceaccount/</code> ç›®å½•ä¸‹å°±æœ‰ç€æ¯”è¾ƒæ•æ„Ÿçš„ä¿¡æ¯ã€‚</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tmpfs on /run/secrets/kubernetes.io/serviceaccount type tmpfs (ro,relatime)</span><br><span class="line">/ # tree /run/secrets/kubernetes.io/serviceaccount/</span><br><span class="line">/run/secrets/kubernetes.io/serviceaccount/</span><br><span class="line">â”œâ”€â”€ ca.crt -&gt; ..data/ca.crt</span><br><span class="line">â”œâ”€â”€ namespace -&gt; ..data/namespace</span><br><span class="line">â””â”€â”€ token -&gt; ..data/token</span><br></pre></td></tr></table></figure></li></ul><blockquote><ul><li><p><code>--tmpfs</code>ï¼šç›´æ¥æŒ‡å®šå®¹å™¨ä¸­çš„æŒ‚è½½ç‚¹ã€‚ä¸å…è®¸æŒ‡å®šä»»ä½•é…ç½®é€‰é¡¹</p></li><li><p>â€“mountï¼šç”±å¤šä¸ªâ€™,â€™éš”å¼€çš„é”®å€¼å¯¹<key>=<value>ç»„æˆï¼š</p><p>  æŒ‚è½½ç±»å‹ï¼škeyä¸º<code>type</code>ï¼Œvalueä¸º<code>bind</code>ã€<code>volume</code>æˆ–<code>tmpfs</code></p><p>  å®¹å™¨ä¸­çš„æŒ‚è½½ç‚¹ï¼škeyä¸º<code>destination</code>ã€<code>dst</code>æˆ–<code>target</code>ï¼Œvalueä¸ºå®¹å™¨ä¸­çš„è·¯å¾„</p><p>  <code>tmpfs-size</code>å’Œ<code>tmpfs-mode</code>é€‰é¡¹</p></li></ul></blockquote><h3 id="kubelet-æŒ‚è½½å­˜å‚¨"><a href="#kubelet-æŒ‚è½½å­˜å‚¨" class="headerlink" title="kubelet æŒ‚è½½å­˜å‚¨"></a>kubelet æŒ‚è½½å­˜å‚¨</h3><p>å½“å¯¹å®¹å™¨å­˜å‚¨çš„ç±»å‹æœ‰äº†å¤§è‡´äº†è§£ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ Pod æ˜¯å¦‚ä½•è¿›è¡Œ volume æŒ‚è½½çš„ã€‚</p><p>å½“ Pod è¢«è°ƒåº¦åˆ°ä¸€ä¸ª Node èŠ‚ç‚¹ä¸Šåï¼ŒNode èŠ‚ç‚¹ä¸Šçš„ kubelet ç»„ä»¶å°±ä¼šä¸ºè¿™ä¸ª Pod åˆ›å»ºå®ƒçš„ Volume ç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹ kubelet ä¸º Volume åˆ›å»ºçš„ç›®å½•åœ¨ kubelet çš„å·¥ä½œç›®å½•ï¼ˆé»˜è®¤åœ¨ <code>/var/lib/kubelet</code> ï¼‰ï¼Œåœ¨ kubelet å¯åŠ¨çš„æ—¶å€™å¯ä»¥æ ¹æ® <code>â€“root-dir</code> å‚æ•°æ¥æŒ‡å®šå·¥ä½œç›®å½•ï¼Œä¸è¿‡ä¸€èˆ¬æ²¡å•¥ç‰¹æ®Šè¦æ±‚è¿˜æ˜¯ä½¿ç”¨é»˜è®¤çš„å°±å¥½ğŸ˜‚ã€‚Pod çš„ volume ç›®å½•å°±åœ¨è¯¥ç›®å½•ä¸‹ï¼Œè·¯å¾„æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/var/lib/kubelet/pods/&lt;Podçš„ID&gt;/volumes/kubernetes.io~&lt;Volumeç±»å‹&gt;/&lt;Volumeåå­—&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¯”å¦‚:</span></span><br><span class="line">/var/lib/kubelet/pods/c4b1998b-f5c1-440a-b9bc-7fbf87f3c267/volumes/kubernetes.io~nfs/nfs211</span><br></pre></td></tr></table></figure><p>åœ¨ Node èŠ‚ç‚¹ä¸Šå¯ä»¥ä½¿ç”¨ mount å‘½ä»¤æ¥æŸ¥çœ‹ kubelet ä¸º Pod æŒ‚è½½çš„æŒ‚è½½ç‚¹ä¿¡æ¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.10.107.216:/nfs on /var/lib/kubelet/pods/6750b756-d8e4-448a-93f9-8906f9c44788/volumes/kubernetes.io~nfs/nfs-test type nfs (rw,relatime,vers=3,rsize=1048576,wsize=1048576,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,mountaddr=10.10.107.216,mountvers=3,mountport=56389,mountproto=udp,local_lock=none,addr=10.10.107.216)</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-node-3 ~</span><br><span class="line">â•°â”€# mount | grep kubelet</span><br><span class="line">tmpfs on /var/lib/kubelet/pods/45c55c5e-ce96-47fd-94b3-60a334e5a44d/volumes/kubernetes.io~secret/kube-proxy-token-h4dfb type tmpfs (rw,relatime,seclabel)</span><br><span class="line">tmpfs on /var/lib/kubelet/pods/3fb63baa-27ec-4d76-8028-39a0a8f91749/volumes/kubernetes.io~secret/calico-node-token-4hks6 type tmpfs (rw,relatime,seclabel)</span><br><span class="line">tmpfs on /var/lib/kubelet/pods/05c75313-f932-4913-b09f-d7bccdfb6e62/volumes/kubernetes.io~secret/nginx-ingress-token-5569x type tmpfs (rw,relatime,seclabel)</span><br><span class="line">10.20.172.211:/nfs on /var/lib/kubelet/pods/c4b1998b-f5c1-440a-b9bc-7fbf87f3c267/volumes/kubernetes.io~nfs/nfs211 type nfs (rw,relatime,vers=3,rsize=524288,wsize=524288,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,mountaddr=10.20.172.211,mountvers=3,mountport=20048,mountproto=udp,local_lock=none,addr=10.20.172.211)</span><br><span class="line">tmpfs on /var/lib/kubelet/pods/73fed6f3-4cbe-46a7-af7b-6fd912e6ebd4/volumes/kubernetes.io~secret/default-token-wgfd9 type tmpfs (rw,relatime,seclabel)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ kubernetes ç›®å‰æ”¯æŒçš„ Volume çš„ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ <code>kubectl explain pod.spec.volumes</code>  æ¥æŸ¥çœ‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 ~</span><br><span class="line">â•°â”€# kubectl explain pod.spec.volumes | grep Object | cut -d "&lt;" -f1</span><br><span class="line">RESOURCE: volumes</span><br><span class="line">awsElasticBlockStore</span><br><span class="line">azureDisk</span><br><span class="line">azureFile</span><br><span class="line">cephfs</span><br><span class="line">cinder</span><br><span class="line">configMap</span><br><span class="line">csi</span><br><span class="line">downwardAPI</span><br><span class="line">emptyDir</span><br><span class="line">fc</span><br><span class="line">flexVolume</span><br><span class="line">flocker</span><br><span class="line">gcePersistentDisk</span><br><span class="line">gitRepo</span><br><span class="line">glusterfs</span><br><span class="line">hostPath</span><br><span class="line">iscsi</span><br><span class="line">nfs</span><br><span class="line">persistentVolumeClaim</span><br><span class="line">photonPersistentDisk</span><br><span class="line">portworxVolume</span><br><span class="line">projected</span><br><span class="line">quobyte</span><br><span class="line">rbd</span><br><span class="line">scaleIO</span><br><span class="line">secret</span><br><span class="line">storageos</span><br><span class="line">vsphereVolume</span><br></pre></td></tr></table></figure><h3 id="ç®¡-systemd-ä»€ä¹ˆäº‹å„¿ï¼Ÿ"><a href="#ç®¡-systemd-ä»€ä¹ˆäº‹å„¿ï¼Ÿ" class="headerlink" title="ç®¡ systemd ä»€ä¹ˆäº‹å„¿ï¼Ÿ"></a>ç®¡ systemd ä»€ä¹ˆäº‹å„¿ï¼Ÿ</h3><p>æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹å½“åˆçš„é”™è¯¯æ—¥å¿—ï¼š</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Events:</span><br><span class="line">  Type     Reason       Age    From            Message</span><br><span class="line">  ----  ------  ---- ----     -------</span><br><span class="line">  Warning  FailedMount  <span class="number">8</span>m49s  kubelet, node1  MountVolume<span class="variable">.SetUp</span> failed <span class="keyword">for</span> volume <span class="string">"nfs211"</span> : mount failed: exit status <span class="number">32</span></span><br><span class="line">Mounting command: systemd-run</span><br><span class="line">Mounting arguments: --description=Kubernetes transient mount <span class="keyword">for</span> /<span class="keyword">var</span>/lib/kubelet/pods/cddc94e7-<span class="number">8033</span>-<span class="number">4150</span>-bed5-d141e3b71e49/volumes/kubernetes<span class="variable">.io</span>~nfs/nfs211 --scope -- mount -t nfs <span class="number">10</span><span class="variable">.20</span><span class="variable">.172</span><span class="variable">.211</span>:/nfs /<span class="keyword">var</span>/lib/kubelet/pods/cddc94e7-<span class="number">8033</span>-<span class="number">4150</span>-bed5-d141e3b71e49/volumes/kubernetes<span class="variable">.io</span>~nfs/nfs211</span><br><span class="line">Output: Running scope as unit run-<span class="number">38284</span><span class="variable">.scope</span>.</span><br><span class="line">mount: wrong fs <span class="keyword">type</span>, bad option, bad superblock on <span class="number">10</span><span class="variable">.20</span><span class="variable">.172</span><span class="variable">.211</span>:/nfs,</span><br><span class="line">       missing codepage <span class="keyword">or</span> helper <span class="keyword">program</span>, <span class="keyword">or</span> other error</span><br><span class="line">       (<span class="keyword">for</span> several filesystems (e<span class="variable">.g</span>. nfs, cifs) you might</span><br><span class="line">       need a /sbin/mount.&lt;<span class="keyword">type</span>&gt; helper <span class="keyword">program</span>)</span><br><span class="line"></span><br><span class="line">       In some cases useful info is found in syslog - try</span><br><span class="line">       dmesg | tail <span class="keyword">or</span> so.</span><br><span class="line">  Warning  FailedMount  <span class="number">8</span>m48s  kubelet, node1  MountVolume<span class="variable">.SetUp</span> failed <span class="keyword">for</span> volume <span class="string">"nfs211"</span> : mount failed: exit status <span class="number">32</span></span><br></pre></td></tr></table></figure><p>å’¦ï¼Ÿå½“æ—¶æˆ‘è¿˜å¯»æ€ç€ kubelet æŒ‚è½½ volumes å’Œ systemd ä»€ä¹ˆå…³ç³»ï¼Ÿ<code>systemd</code> è¿™ä¸ªå¤§å¦ˆæ€ä¹ˆåˆæ¥ç®¡è¿™äº‹å„¿äº†ğŸ˜‚ï¼ˆä¹‹å‰æˆ‘å†™è¿‡ä¸€ç¯‡<a href="https://blog.k8s.li/systemd.html">ã€ŠLinux çš„å°ä¼™ä¼´ systemd è¯¦è§£ã€‹</a> ï¼Œæˆç§° systemd æ˜¯ Linux çš„å°ä¼™ä¼´ï¼Œçœ‹æ¥è¿™ä¸ªè¯´æ³•æ˜¯ä¸å¦¥çš„ã€‚systemd ç®€ç›´å°±æ˜¯ Linux é‡Œçš„ç‰©ä¸šå¤§å¦ˆå¥½å˜›ğŸ¤£ï¼Œä¸Šç®¡ service ä¸‹ç®¡ dev ã€ mount è®¾å¤‡ç­‰ã€‚å±‘ï¼Œç®€ç›´å°±æ˜¯ä¸ªç‰©ä¸šå¤§å¦ˆç®¡è¿™ç®¡é‚£çš„ã€‚å›åˆ°æ­£é¢˜ï¼Œäºæ˜¯é¡ºç€è¿™æ¡æŠ¥é”™æ—¥å¿—é¡ºè—¤æ‘¸ç“œæ‰¾åˆ°äº† <a href="https://github.com/kubernetes/kubernetes/pull/49640" target="_blank" rel="noopener">Run mount in its own systemd scope.</a> è¿™ä¸ª PRã€‚</p><blockquote><p>Kubelet needs to run /bin/mount in its own cgroup.</p><ul><li>When kubelet runs as a systemd service, â€œsystemctl restart kubeletâ€ may kill all processes in the same cgroup and thus terminate fuse daemons that are needed for gluster and cephfs mounts.</li><li>When kubelet runs in a docker container, restart of the container kills all fuse daemons started in the container.</li></ul><p>Killing fuse daemons is bad, it basically unmounts volumes from running pods.</p><p>This patch runs mount via â€œsystemd-run â€“scope /bin/mount â€¦â€, which makes sure that any fuse daemons are forked in its own systemd scope (= cgroup) and they will survive restart of kubeletâ€™s systemd service or docker container.</p><p>This helps with <a href="https://github.com/kubernetes/kubernetes/issues/34965" target="_blank" rel="noopener">#34965</a></p><p>As a downside, each new fuse daemon will run in its own transient systemd service and systemctl output may be cluttered.</p></blockquote><p>æ­£å¦‚æè¿™ä¸ª PR çš„å¤§ä½¬è®²çš„ï¼Œï¼ˆä¹‹å‰ï¼‰kubelet éœ€è¦åœ¨å®ƒè‡ªå·±çš„ <code>cgroup</code> é‡Œè¿è¡Œå®¿ä¸»æœºä¸Šçš„ <code>/bin/mount</code> æ¥ä¸º Pod æŒ‚è½½ volumes ï¼Œè€Œå½“ kubelet è¿›ç¨‹é‡å¯æˆ–è€…æŒ‚æ‰çš„æ—¶å€™ï¼Œè¿™äº›åœ¨ kubelet çš„  <code>cgroup</code> é‡Œè¿è¡Œçš„è¿›ç¨‹ä¹Ÿå°†ä¼šæŒ‚æ‰ï¼Œæ¯”å¦‚ï¼ˆglusterï¼Œcephï¼‰ã€‚ç„¶åå¤§ä½¬çš„è¿™ä¸ª patch é€šè¿‡ <code>systemd-run --scope /bin/mount</code> æ¥å»å¯åŠ¨ä¸€ä¸ªä¸´æ—¶çš„ systemd å•å…ƒæ¥ä¸º Pod æŒ‚è½½ volumesï¼Œè¿™æ ·ä¸€æ¥è¿™äº› <code>fuse daemons</code>  è¿›ç¨‹ï¼ˆglusterï¼Œcephï¼‰å°±ä¼š forked åˆ°å®ƒè‡ªå·±çš„ systemd scope é‡Œï¼Œè¿™æ ·å³ä¾¿ kubelet é‡å¯æˆ–è€…æŒ‚æ‰ä¹Ÿä¸ä¼šå½±å“æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä½¿ç”¨ volumesã€‚</p><p>è¿™ä¸€ç‚¹åƒ <a href="https://github.com/containerd/containerd" target="_blank" rel="noopener">containerd</a> ä¹‹äº dockerd ï¼Œå³ä¾¿ dockerd é‡å¯ä¹Ÿä¸ä¼šå½±å“åˆ°å®¹å™¨çš„è¿è¡Œï¼Œå› ä¸ºï¼Œåœ¨è¿è¡Œæ—¶è¿™ä¸€å—ï¼ŒçœŸæ­£è¿è¡Œå®¹å™¨çš„æ˜¯ containerd ä¸‹çš„å„ä¸ª containerd-shim å­è¿›ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ pstree å‘½ä»¤æ¥çœ‹ä¸€ä¸‹è¿™ç§å±‚çº§å…³ç³»ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€containerdâ”€â”¬â”€5*[containerd-shimâ”€â”¬â”€pause]</span><br><span class="line">â”‚            â”‚                    â””â”€9*[&#123;containerd-shim&#125;]]</span><br><span class="line">â”‚            â”œâ”€containerd-shimâ”€â”¬â”€pause</span><br><span class="line">â”‚            â”‚                 â””â”€10*[&#123;containerd-shim&#125;]</span><br><span class="line">â”‚            â”œâ”€containerd-shimâ”€â”¬â”€etcdâ”€â”€â”€15*[&#123;etcd&#125;]</span><br><span class="line">â”‚            â”‚                 â””â”€9*[&#123;containerd-shim&#125;]</span><br><span class="line">â”‚            â”œâ”€containerd-shimâ”€â”¬â”€kube-controllerâ”€â”€â”€12*[&#123;kube-controller&#125;]</span><br><span class="line">â”‚            â”‚                 â””â”€9*[&#123;containerd-shim&#125;]</span><br><span class="line">â”‚            â”œâ”€containerd-shimâ”€â”¬â”€kube-apiserverâ”€â”€â”€14*[&#123;kube-apiserver&#125;]</span><br><span class="line">â”‚            â”‚                 â””â”€9*[&#123;containerd-shim&#125;]</span><br><span class="line">â”‚            â”œâ”€containerd-shimâ”€â”¬â”€kube-schedulerâ”€â”€â”€13*[&#123;kube-scheduler&#125;]</span><br><span class="line">â”‚            â”‚                 â””â”€9*[&#123;containerd-shim&#125;]</span><br><span class="line">â”‚            â”œâ”€containerd-shimâ”€â”¬â”€kube-proxyâ”€â”€â”€11*[&#123;kube-proxy&#125;]</span><br><span class="line">â”‚            â”‚                 â””â”€9*[&#123;containerd-shim&#125;]</span><br><span class="line">â”‚            â”œâ”€containerd-shimâ”€â”¬â”€flanneldâ”€â”€â”€15*[&#123;flanneld&#125;]</span><br><span class="line">â”‚            â”‚                 â””â”€9*[&#123;containerd-shim&#125;]</span><br><span class="line">â”‚            â””â”€26*[&#123;containerd&#125;]</span><br></pre></td></tr></table></figure><p>æ¥ç€é¡ºè—¤æ‘¸ç“œç¿»åˆ°è¿™ä¸ª PR å¯¹åº”çš„æºç æ–‡ä»¶  <a href="https://github.com/kubernetes/kubernetes/blob/master/vendor/k8s.io/utils/mount/mount_linux.go#L115" target="_blank" rel="noopener">mount_linux.go</a>ï¼Œå…³é”®å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// doMount runs the mount command. mounterPath is the path to mounter binary if containerized mounter is used.</span></span><br><span class="line"><span class="comment">// sensitiveOptions is an extention of options except they will not be logged (because they may contain sensitive material)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mounter *Mounter)</span> <span class="title">doMount</span><span class="params">(mounterPath <span class="keyword">string</span>, mountCmd <span class="keyword">string</span>, source <span class="keyword">string</span>, target <span class="keyword">string</span>, fstype <span class="keyword">string</span>, options []<span class="keyword">string</span>, sensitiveOptions []<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">mountArgs, mountArgsLogStr := MakeMountArgsSensitive(source, target, fstype, options, sensitiveOptions)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(mounterPath) &gt; <span class="number">0</span> &#123;</span><br><span class="line">mountArgs = <span class="built_in">append</span>([]<span class="keyword">string</span>&#123;mountCmd&#125;, mountArgs...)</span><br><span class="line">mountArgsLogStr = mountCmd + <span class="string">" "</span> + mountArgsLogStr</span><br><span class="line">mountCmd = mounterPath</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> mounter.withSystemd &#123;</span><br><span class="line"><span class="comment">// Try to run mount via systemd-run --scope. This will escape the</span></span><br><span class="line"><span class="comment">// service where kubelet runs and any fuse daemons will be started in a</span></span><br><span class="line"><span class="comment">// specific scope. kubelet service than can be restarted without killing</span></span><br><span class="line"><span class="comment">// these fuse daemons.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Complete command line (when mounterPath is not used):</span></span><br><span class="line"><span class="comment">// systemd-run --description=... --scope -- mount -t &lt;type&gt; &lt;what&gt; &lt;where&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Expected flow:</span></span><br><span class="line"><span class="comment">// * systemd-run creates a transient scope (=~ cgroup) and executes its</span></span><br><span class="line"><span class="comment">//   argument (/bin/mount) there.</span></span><br><span class="line"><span class="comment">// * mount does its job, forks a fuse daemon if necessary and finishes.</span></span><br><span class="line"><span class="comment">//   (systemd-run --scope finishes at this point, returning mount's exit</span></span><br><span class="line"><span class="comment">//   code and stdout/stderr - thats one of --scope benefits).</span></span><br><span class="line"><span class="comment">// * systemd keeps the fuse daemon running in the scope (i.e. in its own</span></span><br><span class="line"><span class="comment">//   cgroup) until the fuse daemon dies (another --scope benefit).</span></span><br><span class="line"><span class="comment">//   Kubelet service can be restarted and the fuse daemon survives.</span></span><br><span class="line"><span class="comment">// * When the fuse daemon dies (e.g. during unmount) systemd removes the</span></span><br><span class="line"><span class="comment">//   scope automatically.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// systemd-mount is not used because it's too new for older distros</span></span><br><span class="line"><span class="comment">// (CentOS 7, Debian Jessie).</span></span><br><span class="line">mountCmd, mountArgs, mountArgsLogStr = AddSystemdScopeSensitive(<span class="string">"systemd-run"</span>, target, mountCmd, mountArgs, mountArgsLogStr)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// No systemd-run on the host (or we failed to check it), assume kubelet</span></span><br><span class="line"><span class="comment">// does not run as a systemd service.</span></span><br><span class="line"><span class="comment">// No code here, mountCmd and mountArgs are already populated.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Logging with sensitive mount options removed.</span></span><br><span class="line">klog.V(<span class="number">4</span>).Infof(<span class="string">"Mounting cmd (%s) with arguments (%s)"</span>, mountCmd, mountArgsLogStr)</span><br><span class="line">command := exec.Command(mountCmd, mountArgs...)</span><br><span class="line">output, err := command.CombinedOutput()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">klog.Errorf(<span class="string">"Mount failed: %v\nMounting command: %s\nMounting arguments: %s\nOutput: %s\n"</span>, err, mountCmd, mountArgsLogStr, <span class="keyword">string</span>(output))</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">"mount failed: %v\nMounting command: %s\nMounting arguments: %s\nOutput: %s"</span>,</span><br><span class="line">err, mountCmd, mountArgsLogStr, <span class="keyword">string</span>(output))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥çœ‹ä¸€ä¸‹ <code>doMount</code> è¿™ä¸ªå‡½æ•°çš„å‡ ä¸ªå½¢å‚ï¼š</p><ul><li>mounterPath ï¼š</li></ul><p>å°±æ˜¯æˆ‘ä»¬å®¿ä¸»æœºä¸Šçš„æŒ‚è½½å‘½ä»¤æ¯”å¦‚ <code>/sbin/mount.nfs</code> ã€<code>/sbin/mount.glusterfs</code> ç­‰ã€‚</p><ul><li><p>mountCmdï¼šæŒ‚è½½å‘½ä»¤å°±æ˜¯ <code>systemd-run</code></p></li><li><p>sourceï¼šæŒ‚è½½å­˜å‚¨çš„æºè·¯å¾„ï¼Œæ¯”å¦‚ NFS é‡Œçš„ <code>10.10.107.211:/nfs</code></p></li><li><p>target</p></li></ul><p>å°±æ˜¯æˆ‘ä»¬çš„ Pod çš„ volume ï¼Œåœ¨ <code>/var/lib/kubelet/pods/&lt;Podçš„ID&gt;/volumes/kubernetes.io~&lt;Volumeç±»å‹&gt;/&lt;Volumeåå­—&gt;</code> ï¼Œç€ç›®å½•åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™ä¼š bind mount åˆ°å®¹å™¨å†…çš„æŒ‚è½½ç‚¹</p><ul><li><p>fstypeï¼šæ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼ŒNFSã€cephã€GlusterFS</p></li><li><p>options []stringï¼šæŒ‚è½½çš„å‚æ•°ï¼Œæ¯”å¦‚ NFS çš„</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(rw,relatime,vers=3,rsize=524288,wsize=524288,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,mountaddr=10.20.172.211,mountvers=3,mountport=20048,mountproto=udp,local_lock=none,addr=10.20.172.211)</span><br></pre></td></tr></table></figure><ul><li>sensitiveOptions []stringï¼Œè¿™ä¸ªå‚æ•°æ²¡å»ä»”ç»†çœ‹ï¼Œå°±ç•¥è¿‡å§ï¼ˆ</li></ul><p>è‡³æ­¤ kubelet ä¸º Pod æŒ‚è½½çš„åŸç†å’Œæµç¨‹ä¹Ÿä¸€ç›®äº†ç„¶ï¼Œå…¶å®å¾ˆç®€å•çš„é€»è¾‘ï¼Œå¤§è‡´å¯ä»¥æ°›å›´</p><ul><li>Attach é˜¶æ®µï¼škubelet ä½¿ç”¨ systemd-run å•ç‹¬èµ·ä¸€ä¸ªä¸´æ—¶çš„ systemd scope æ¥è¿è¡Œåç«¯å­˜å‚¨çš„å®¢æˆ·ç«¯æ¯”å¦‚ï¼ˆ nfs ã€glusterã€cephï¼‰ï¼Œå°†è¿™äº›å­˜å‚¨æŒ‚è½½åˆ° <code>/var/lib/kubelet/pods/&lt;Podçš„ID&gt;/volumes/kubernetes.io~&lt;Volumeç±»å‹&gt;/&lt;Volumeåå­—&gt;</code></li><li>Mount é˜¶æ®µï¼šå®¹å™¨å¯åŠ¨çš„æ—¶å€™é€šè¿‡ bind mount çš„æ–¹å¼å°†  <code>/var/lib/kubelet/pods/&lt;Podçš„ID&gt;/volumes/kubernetes.io~&lt;Volumeç±»å‹&gt;/&lt;Volumeåå­—&gt;</code> è¿™ä¸ªç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…ã€‚è¿™ä¸€æ­¥ç›¸å½“äºä½¿ç”¨<code>docker run -v /var/lib/kubelet/pods/&lt;Podçš„ID&gt;/volumes/kubernetes.io~&lt;Volumeç±»å‹&gt;/&lt;Volumeåå­—&gt;:/&lt;å®¹å™¨å†…çš„ç›®æ ‡ç›®å½•&gt; æˆ‘çš„é•œåƒ</code> å¯åŠ¨ä¸€ä¸ªå®¹å™¨ã€‚</li></ul><p>å…³äºæ›´è¯¦ç»†çš„ CSI å­˜å‚¨å¯ä»¥å‚è€ƒä¸‹é¢æåˆ°çš„æ–‡ç« </p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>è™½ç„¶æ˜¯ä¸€ç¯‡å¾ˆç®€å•çš„åˆ†æï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å‚è€ƒäº†å¾ˆå¤šçš„åšå®¢ï¼Œæ²¡æœ‰è¿™äº›å¤§ä½¬çš„åˆ†äº«å°±æ²¡æœ‰è¿™ç¯‡æ–‡ç« ï¼šï¼‰ï¼Œè¿™äº›å¤§ä½¬ä»¬çš„åšå®¢æ–‡ç« æ¯”æˆ‘å†™çš„<code>ä¸çŸ¥é“é«˜åˆ°å“ªé‡Œå»äº†</code>ï¼Œæ‰€ä»¥å¦‚æœä½ çœ‹äº†è¿™ç¯‡æ–‡ç« è¿˜æ˜¯æ²¡æ‡‚çš„è¯ï¼Œä¸å¦¨ä¹Ÿçœ‹ä¸€ä¸‹ä¸‹é¢çš„è¿™äº›æ–‡ç« å°±èƒ½è±ç„¶å¼€æœ—äº†ğŸ˜‚ã€‚</p><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><ul><li><p><a href="https://github.com/kubernetes/kubernetes/blob/master/vendor/k8s.io/utils/mount/mount_linux.go#L115" target="_blank" rel="noopener">kubernetes/mount_linux.go at master Â· kubernetes/kubernetes</a></p></li><li><p><a href="https://github.com/kubernetes/kubernetes/pull/49640" target="_blank" rel="noopener">Run mount in its own systemd scope. by jsafrane Â· Pull Request #49640 Â· kubernetes/kubernetes</a></p></li></ul><h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><ul><li><p><a href="https://www.huweihuang.com/article/source-analysis/kubelet/create-pod-by-kubelet/#66-mount-volumes" target="_blank" rel="noopener">kubeletæºç åˆ†æï¼ˆå››ï¼‰ä¹‹ Podçš„åˆ›å»º - èƒ¡ä¼Ÿç…Œ | Blog</a></p></li><li><p><a href="http://ljchen.net/2018/10/28/kubelet%E6%BA%90%E7%A0%81%E6%9E%B6%E6%9E%84%E7%AE%80%E4%BB%8B/" target="_blank" rel="noopener">Kubeletæºç æ¶æ„ç®€ä»‹ | ljchenâ€™s Notes</a></p></li><li><p><a href="http://newgoo.org/2019/09/03/k8s/kubelet-%E6%BA%90%E7%A0%81/" target="_blank" rel="noopener">kubelet æºç åˆ†æ - Beantech | Newgoo | kubernates</a></p></li><li><p><a href="http://blog.xbblfz.site/2018/10/12/Kubelet%E5%90%AF%E5%8A%A8%E5%8F%8A%E5%AF%B9Docker%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">â€œKubeletå¯åŠ¨æºç åˆ†æâ€ - å¾æ³¢çš„åšå®¢ | Xu Blog</a></p></li><li><p><a href="https://cizixs.com/2017/06/06/kubelet-source-code-analysis-part-1/" target="_blank" rel="noopener">kubelet æºç åˆ†æï¼šå¯åŠ¨æµç¨‹ | Cizixs Write Here</a></p></li><li><p><a href="https://fankangbest.github.io/2017/12/17/kubelet%E5%88%86%E6%9E%90(%E4%B8%89)-volumeManager-v1-5-2/" target="_blank" rel="noopener">kubeletåˆ†æ(ä¸‰)-volumeManager-v1.5.2 | fankangbest</a></p></li><li><p><a href="https://wenfeng-gao.github.io/post/k8s-volume-manager-source-code-analysis/" target="_blank" rel="noopener">Kubernetesæºç åˆ†æä¹‹VolumeManager - Je pense donc je suis</a></p></li><li><p><a href="https://www.huweihuang.com/kubernetes-notes/code-analysis/kubelet/startKubelet.html" target="_blank" rel="noopener">startKubelet Â· Kubernetes å­¦ä¹ ç¬”è®°</a></p></li></ul><h3 id="å®˜æ–¹æ–‡æ¡£"><a href="#å®˜æ–¹æ–‡æ¡£" class="headerlink" title="å®˜æ–¹æ–‡æ¡£"></a>å®˜æ–¹æ–‡æ¡£</h3><ul><li><p><a href="https://docs.docker.com/storage/" target="_blank" rel="noopener">Manage data in Docker | Docker Documentation</a></p></li><li><p><a href="https://docs.docker.com/storage/bind-mounts/" target="_blank" rel="noopener">Use bind mounts | Docker Documentation</a></p></li><li><p><a href="https://docs.docker.com/storage/bind-mounts/" target="_blank" rel="noopener">Use bind mounts | Docker Documentation</a></p></li><li><p><a href="http://www.jinbuguo.com/man/mount.html" target="_blank" rel="noopener">mount ä¸­æ–‡æ‰‹å†Œ</a></p></li><li><p><a href="https://docs.docker.com/storage/storagedriver/overlayfs-driver/" target="_blank" rel="noopener">Use the OverlayFS storage driver</a></p></li></ul><h3 id="ç›¸å…³åšå®¢"><a href="#ç›¸å…³åšå®¢" class="headerlink" title="ç›¸å…³åšå®¢"></a>ç›¸å…³åšå®¢</h3><ul><li><p><a href="https://cizixs.com/2016/10/25/kubernetes-intro-kubelet/" target="_blank" rel="noopener">kubernetes ç®€ä»‹ï¼š kubelet å’Œ pod | Cizixs Write Here</a></p></li><li><p><a href="https://michaelyou.github.io/2017/09/17/Docker%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86-Volume%EF%BC%8C-bind-mount%E5%92%8Ctmpfs-mount/" target="_blank" rel="noopener">Dockeræ•°æ®ç®¡ç†-Volumeï¼Œ bind mountå’Œtmpfs mount | Youmai ã® Blog</a></p></li><li><p><a href="https://www.qikqiak.com/k8strain/storage/csi/" target="_blank" rel="noopener">å­˜å‚¨åŸç† - K8Sè®­ç»ƒè¥</a></p></li><li><p><a href="https://blog.fatedier.com/2020/04/17/pod-loopcrash-of-k8s-subpath/" target="_blank" rel="noopener">Kubernetes æŒ‚è½½ subpath çš„å®¹å™¨åœ¨ configmap å˜æ›´åé‡å¯æ—¶æŒ‚è½½å¤±è´¥</a></p></li><li><p><a href="https://www.infvie.com/ops-notes/kubernetes-storage.html" target="_blank" rel="noopener">ç†è§£kubernetesä¸­çš„Storage | Infvieâ€™s Blog</a></p></li><li><p><a href="https://arkingc.github.io/2018/12/11/2018-12-11-docker-storage-persist/" target="_blank" rel="noopener">Dockerå®¹å™¨æ•°æ®æŒä¹…åŒ–</a></p></li><li><p><a href="https://arkingc.github.io/2018/01/19/2018-01-19-docker-imagestore/" target="_blank" rel="noopener">Dockeræºç åˆ†æâ€”é•œåƒå­˜å‚¨</a></p></li><li><p><a href="https://arkingc.github.io/2018/01/15/2018-01-15-docker-storage-overlay2/" target="_blank" rel="noopener">Dockeræºç åˆ†æâ€”å­˜å‚¨é©±åŠ¨</a></p></li><li><p><a href="https://arkingc.github.io/2017/05/05/2017-05-05-docker-filesystem-overlay/" target="_blank" rel="noopener">Dockerå­˜å‚¨é©±åŠ¨â€”Overlay/Overlay2ã€Œè¯‘ã€</a></p></li><li><p><a href="https://blog.k8s.li/systemd.html">Linux çš„å°ä¼™ä¼´ systemd è¯¦è§£</a></p></li></ul><h2 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h2><p>æœ€åç¥å„ä½è¿˜åœ¨<code>æ¬ç –</code>çš„å·¥äººä»¬èŠ‚æ—¥å¿«ä¹ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;æœ€è¿‘åœ¨ kubernetes ä¸­ä½¿ç”¨ NFS
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="kubernetes" scheme="https://blog.k8s.li/tags/kubernetes/"/>
    
      <category term="docker" scheme="https://blog.k8s.li/tags/docker/"/>
    
      <category term="å®¹å™¨" scheme="https://blog.k8s.li/tags/%E5%AE%B9%E5%99%A8/"/>
    
      <category term="å­˜å‚¨" scheme="https://blog.k8s.li/tags/%E5%AD%98%E5%82%A8/"/>
    
      <category term="volumes" scheme="https://blog.k8s.li/tags/volumes/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€æ¬¡æœ‰è¶£çš„é¢è¯•ï¼šWordPress éƒ¨ç½²</title>
    <link href="https://blog.k8s.li/interview-wordpress-install.html"/>
    <id>https://blog.k8s.li/interview-wordpress-install.html</id>
    <published>2020-04-15T16:00:00.000Z</published>
    <updated>2020-04-27T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ”¶åˆ°ä¸€ä»½é¢è¯•é¢˜ï¼Œå†…å®¹çœ‹ä¼¼å¾ˆç®€å•ï¼š</p><blockquote><ol><li><p>CentOS7ï¼Œnginx æœ€æ–°ç‰ˆï¼Œphp 7.xï¼Œmysql ä¸åšè¦æ±‚ + wordpress</p></li><li><p>ä»¥æ–‡ä»¶çš„æ–¹å¼åˆ›å»ºå¹¶æŒ‚è½½2Gçš„swapåˆ†åŒº</p><p>è¯·æŠŠå­¦ä¹ è®°å½•ä»¥ URLï¼Œæˆªå›¾ç­‰æ–¹å¼ä¿ç•™ã€‚æœ€ç»ˆã€‚æˆ‘åœ¨æ‰‹æœºä¸Šå¯ä»¥çœ‹åˆ°wordpressç«™ç‚¹å°±å¥½ã€‚æ—¶é—´1å°æ—¶ä»¥å†…ï¼Œæ–¹æ³•æ–¹å¼ä¸é™</p></li></ol></blockquote><p>è™½ç„¶çœ‹èµ·æ¥å’Œç®€å•ï¼Œæ¯”å¦‚ç”¨ <code>docker-compose</code> ä¸€é”®å°±èƒ½å®Œæˆéƒ¨ç½²å®Œæˆï¼Œä¸è¿‡ä¸ºäº†æŠŠéƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜è¯¦ç»†åœ°è®°å½•ä¸‹æ¥ï¼Œä»¥åŠå‚è€ƒçš„ä¸€äº›æ–‡æ¡£ç­‰ï¼Œé€šè¿‡ä¸€ç¯‡æ­£å¼çš„åšå®¢å±•ç°å‡ºæ¥ï¼Œè¿™æ ·æ•ˆæœä¼šå¥½ä¸€äº›ã€‚åŒæ—¶å’±ä½œä¸ºå®Œç¾ä¸»ä¹‰è€…ï¼Œå¸Œæœ›ç»™å†åšä¸€äº›é¢å¤–çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚ HTTPS ï¼Œä»¥åŠä¸ä¹…å‰å’Œå’±ç»™åšå®¢åŠ çš„ Webp Server ğŸ˜‚ã€‚<a href="https://blog.k8s.li/oh-my-webpsh.html">è®©å›¾ç‰‡é£èµ·æ¥ oh-my-webp.sh ï¼</a> å’±æ¥æ¨é”€ <a href="https://github.com/webp-sh/webp_server_go" target="_blank" rel="noopener">Webp Server Go</a> å•¦ ï¼ˆå°å£°ã€‚</p><p>å¦å¤–æä¸€ç‚¹çš„æ˜¯ï¼Œå¦‚æœä½ æ·±å…¥ç†è§£ LNMP æŠ€æœ¯æ ˆçš„è¯ï¼Œè¿˜æ˜¯æ¨èä½¿ç”¨ä¼ ç»Ÿçš„æ–¹å¼æ¯”å¦‚ yum å®‰è£…æˆ–æºç ç¼–è¯‘å®‰è£…ï¼Œé‚£æ ·ä¼šèƒ½ç†è§£è¿™äº›æœåŠ¡ä¹‹é—´çš„å·¥ä½œæµç¨‹ï¼Œä¼šå¯¹æ•´ä¸ªç³»ç»Ÿæœ‰æ·±å…¥çš„äº†è§£ã€‚è€Œ <code>docker-compose</code> ç®€å•ç²—æš´çš„æ–¹å¼ä¸ºæˆ‘ä»¬å±è”½äº†è¿™äº›ç»†èŠ‚ï¼Œä¼šè®©æˆ‘ä»¬æ”¾å¼ƒå»æ€è€ƒè¿™äº›åº•å±‚çš„ç»†èŠ‚ï¼Œå¯¹äºæˆ‘ä»¬å­¦ä¹ è¿™é—¨æŠ€æœ¯æ ˆæ¥è®²ï¼Œè¿˜æ˜¯å¼Šå¤§äºåˆ©ã€‚ä¸è¿‡ä»Šå¤©ä¸ºäº†å¿«é€Ÿéƒ¨ç½²èµ·æ¥ï¼Œè¿˜æ˜¯é€‰ç”¨ docker-compose å§ğŸ˜‚</p><h2 id="WordPress"><a href="#WordPress" class="headerlink" title="WordPress"></a>WordPress</h2><blockquote><p>Get WordPress Use the software that powers over 35% of the web.</p></blockquote><p>WordPress æƒ³å¿…å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰å•¦ï¼Œæ¯•ç«Ÿæ”¶æ˜¯å…¨çƒå†…å®¹ç®¡ç†ç³»ç»Ÿé‡Œçš„è€å¤§å“¥ï¼Œå¸¸å¹´å æ®åœ¨ç¬¬ä¸€çš„ä½ç½®ï¼ˆå æœ‰ç‡ 35%ï¼‰ã€‚å®˜ç½‘ <a href="https://wordpress.org" target="_blank" rel="noopener">wordpress.org</a></p><h2 id="ä»»åŠ¡2-ä»¥æ–‡ä»¶çš„æ–¹å¼åˆ›å»ºå¹¶æŒ‚è½½2Gçš„swapåˆ†åŒº"><a href="#ä»»åŠ¡2-ä»¥æ–‡ä»¶çš„æ–¹å¼åˆ›å»ºå¹¶æŒ‚è½½2Gçš„swapåˆ†åŒº" class="headerlink" title="ä»»åŠ¡2 ä»¥æ–‡ä»¶çš„æ–¹å¼åˆ›å»ºå¹¶æŒ‚è½½2Gçš„swapåˆ†åŒº"></a>ä»»åŠ¡2 ä»¥æ–‡ä»¶çš„æ–¹å¼åˆ›å»ºå¹¶æŒ‚è½½2Gçš„swapåˆ†åŒº</h2><p>è¿™ä¸ªä»»åŠ¡ä¸ WordPress ä¸å¤ªç›¸å…³ï¼Œæ‰€ä»¥å°±å…ˆå®Œæˆè¿™ä¸ªã€‚æ‹¿åˆ°æœºå™¨å ssh ç™»å½•åˆ°ç³»ç»Ÿï¼Œå…ˆä½¿ç”¨å¸¸ç”¨çš„å‘½ä»¤çœ‹ä¸€ä¸‹æœåŠ¡å™¨çš„ä¿¡æ¯ï¼Œå¦å¤–åœ¨è‡ªå·±çš„åŸŸåä¸Šæ·»åŠ äº† A  è®°å½•<code>wordpress.k8s.li</code> åˆ°è¿™å°æœåŠ¡å™¨  IP ï¼Œå¹¶å¼€å¯ HTTPS ï¼Œé˜²æ­¢è¢« DDOS æ”»å‡»ï¼Œæ¯•ç«Ÿæœ‰ CloudFlare çš„ Anycast CDN ç»™æˆ‘ä»¬åœ¨å‰å¤´æ‰›ä¸€æŠŠğŸ˜‚è¿˜æ˜¯ä¸é”™æ»´ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@interview ~]# uname -a</span><br><span class="line">Linux interview 3.10.0-1062.12.1.el7.x86_64 #1 SMP Tue Feb 4 23:02:59 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line">[root@interview ~]# cat /proc/cpuinfo</span><br><span class="line">processor       : 0</span><br><span class="line">vendor_id       : GenuineIntel</span><br><span class="line">cpu family      : 6</span><br><span class="line">model           : 45</span><br><span class="line">model name      : Intel(R) Xeon(R) CPU E5-2670 0 @ 2.60GHz</span><br><span class="line">stepping        : 7</span><br><span class="line">microcode       : 0x710</span><br><span class="line">cpu MHz         : 2594.123</span><br><span class="line">cache size      : 20480 KB</span><br><span class="line">physical id     : 0</span><br><span class="line">siblings        : 1</span><br><span class="line">core id         : 0</span><br><span class="line">cpu cores       : 1</span><br><span class="line">apicid          : 0</span><br><span class="line">initial apicid  : 0</span><br><span class="line">fpu             : yes</span><br><span class="line">fpu_exception   : yes</span><br><span class="line">cpuid level     : 13</span><br><span class="line">wp              : yes</span><br><span class="line">flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat clflush mmx fxsr sse sse2 syscall nx rdtscp lm constant_tsc rep_good nopl eagerfpu pni pclmulqdq ssse3 cx16 sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes hypervisor lahf_lm</span><br><span class="line">bogomips        : 5187.68</span><br><span class="line">clflush size    : 64</span><br><span class="line">cache_alignment : 64</span><br><span class="line">address sizes   : 46 bits physical, 48 bits virtual</span><br><span class="line">power management:</span><br><span class="line"></span><br><span class="line">[root@interview ~]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           985M        150M        451M         12M        382M        680M</span><br><span class="line">Swap:            0B          0B          0B</span><br></pre></td></tr></table></figure><ul><li><code>unanme -a</code> æŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿçš„å†…æ ¸ç‰ˆæœ¬ ï¼Œ<code>3.10.0-1062</code> çš„å†…æ ¸çœ‹æ ·å­æ˜¯ CentOS7.7</li><li><code>cat /proc/cpuinfo</code> æŸ¥çœ‹ä¸€ä¸‹ CPU çš„ä¿¡æ¯ï¼ŒE5-2670 çš„ CPU ï¼Œå±äº Intel ç¬¬å…­ä»£ CPU ç³»åˆ—ã€‚</li><li><code>free</code> æŸ¥çœ‹ä¸€ä¸‹å†…å­˜çš„æƒ…å†µï¼Œ1GB çš„å°å†…å­˜ğŸ˜‚</li></ul><blockquote><p>Q2 ä»¥æ–‡ä»¶çš„æ–¹å¼åˆ›å»ºå¹¶æŒ‚è½½2Gçš„swapåˆ†åŒº</p></blockquote><p>è¿™ä¸ªé—®é¢˜æ¯”è¾ƒç®€å•ï¼Œä¹‹å‰è‡ªå·±çš„ GCE å°é¸¡ 512M å†…å­˜ä¸Šä¹Ÿæ˜¯ä½¿ç”¨æ–‡ä»¶çš„æ–¹å¼åˆ›å»º 2GB çš„äº¤æ¢åˆ†åŒºğŸ˜‚ã€‚æ‰€ä»¥å¯¹è¿™ä¸ªæ­¥éª¤æ—©å°±ç†Ÿè®°äºå¿ƒï¼Œå¹¶ä¸éœ€è¦æœç´¢å°±èƒ½æå®šğŸ˜‹ã€‚ä½¿ç”¨ dd å‘½ä»¤å³å¯ç”Ÿæˆä¸€ä¸ª 2GB å¤§å°çš„æ–‡ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@interview ~]# dd if&#x3D;&#x2F;dev&#x2F;zero of&#x3D;&#x2F;swapfile bs&#x3D;4M count&#x3D;500</span><br><span class="line">500+0 records in</span><br><span class="line">500+0 records out</span><br><span class="line">2097152000 bytes (2.1 GB) copied, 11.0648 s, 190 MB&#x2F;s</span><br></pre></td></tr></table></figure><p><code>2097152000 bytes (2.1 GB) copied, 11.0648 s, 190 MB/s</code> æ€ä¹ˆä¼šæ˜¯ 2.1 GB å‘¢ï¼Ÿï¼Œå¤šå‡ºæ¥ 0.1GB ï¼Œå¼ºè¿«ç—‡å—ä¸äº†ã€‚æƒ³èµ·æ¥äº†ï¼Œå¯èƒ½æ˜¯ <code>bs=4M</code> å‚æ•°çš„é—®é¢˜ã€‚äºæ˜¯æˆ‘åœ¨æˆ‘çš„ debian æœºå™¨ä¸Šæµ‹è¯•äº†ä¸€ä¸‹</p><p>é¡ºå¸¦ man ä¸€ä¸‹ dd çœ‹çœ‹ bs å‚æ•°æ˜¯æ€ä¹ˆå®šä¹‰çš„</p><blockquote><p>  bs=BYTES read and write up to BYTES bytes at a time (default: 512); overrides ibs and obs</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€debian@debian ~</span><br><span class="line">â•°â”€$ dd if=/dev/zero of=./test bs=4MB count=4</span><br><span class="line">4+0 records in</span><br><span class="line">4+0 records out</span><br><span class="line">16000000 bytes (16 MB, 15 MiB) copied, 0.0147078 s, 1.1 GB/s</span><br></pre></td></tr></table></figure><p>åŸå› æ˜¯æ–‡ä»¶å¤§å°å•ä½ä¸åŒï¼Œä¸€ä¸ªæ˜¯ <code>MB</code> å¦ä¸€ä¸ªæ˜¯ <code>MiB</code> ï¼Œåœ¨ Google ä¸Šæœç´¢äº†ä¸€ä¸‹ ã€‚çœ‹åˆ°ä¸Šçš„ä¸€ä¸ªå›ç­” <a href="https://www.quora.com/What-is-the-difference-between-1-MiB-and-1-MB-and-why-should-we-care" target="_blank" rel="noopener">What is the difference between 1 MiB and 1 MB and why should we care?</a> ã€‚ä¹Ÿæƒ³èµ·äº†å‰ä¸¤å¤©çœ‹åˆ° <a href="https://draveness.me/" target="_blank" rel="noopener">é¢å‘ä¿¡ä»°ç¼–ç¨‹</a> å¤§ä½¬çš„ä¸€ä¸ªæ¨æ–‡ï¼š</p><blockquote class="twitter-tweet"><p lang="zh" dir="ltr">æœ€è¿‘æ‰å‘ç° MB å’Œ MiB æ˜¯ä¸ä¸€æ ·çš„ï¼š<br><br>+ MiB æ˜¯ 1024 çš„å€æ•°<br>+ MB æ˜¯ 1000 çš„å€æ•°<br><br>Git ä¸‹è½½æ—¶çš„å•ä½æ˜¯ MiBï¼Œä½†æ˜¯ macOS é‡Œæ˜¾ç¤ºçš„ç¡®å® MBï¼Œéƒ¨åˆ†æœåŠ¡ä¼šæŠŠä¸¤è€…ç”¨æ··ï¼Œæ¯”å¦‚ DigitalOcean é‡Œçš„ S3 æœåŠ¡ï¼Œä¸‹è½½æ–‡ä»¶çš„æ—¶å€™æˆ‘è¿˜ä»¥ä¸ºåªä¸‹è½½äº†ä¸€éƒ¨åˆ†ğŸ˜‚ <a href="https://twitter.com/hashtag/%E5%86%B7%E7%9F%A5%E8%AF%86?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#å†·çŸ¥è¯†</a> <a href="https://t.co/U1IoRlgjXJ" target="_blank" rel="noopener">pic.twitter.com/U1IoRlgjXJ</a></p>&mdash; Draveness (@draven0xff) <a href="https://twitter.com/draven0xff/status/1249290829161590786?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">April 12, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>æ¥ä¸‹æ¥ä½¿ç”¨ <code>mkswap</code> å‘½ä»¤å°†åˆšåˆšåˆ›å»ºå¥½çš„ <code>/swapfile</code> æ–‡ä»¶æ ¼å¼åŒ–ä¸ºäº¤æ¢åˆ†åŒºæ‰€éœ€è¦çš„æ ¼å¼ï¼Œå¹¶ä¿®æ”¹ä¸€ä¸‹æ–‡ä»¶æƒé™ä¸º 600 ï¼Œå³åªèƒ½ç”± root ç”¨æˆ·è¯»ï¼Œä¸ç„¶é»˜è®¤çš„ 755 ä¼šè¢«å…¶ä»–ç”¨æˆ·çœ‹åˆ°ï¼Œè€Œé‡Œé¢çš„å†…å®¹æ˜¯å†…å­˜é‡Œçš„ä¿¡æ¯ï¼Œæ‰€ä»¥å®‰å…¨èµ·è§è¿˜æ˜¯ä¿®æ”¹ä¸€ä¸‹æƒé™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@interview ~]# mkswap /swapfile</span><br><span class="line">Setting up swapspace version 1, size = 2047996 KiB</span><br><span class="line">no label, UUID=a4eab465-75d1-4830-b870-c222c7e2e87b</span><br><span class="line">[root@interview ~]#</span><br><span class="line">[root@interview ~]# chmod 600 /swapfile</span><br><span class="line">[root@interview ~]# swapon !$</span><br><span class="line">swapon /swapfile</span><br><span class="line">[root@interview ~]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           985M        212M        140M         12M        633M        612M</span><br><span class="line">Swap:          2.0G          0B        2.0G</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ä»»åŠ¡äºŒå®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯é¢˜ç›®çš„æ ¸å¿ƒå®‰è£… WordPress å•¦</p><h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><p>åˆšå¼€å§‹æ‰“ç®—ä½¿ç”¨å¸¸è§„çš„æ–¹æ³•æ¥éƒ¨ç½² WordPress çš„ï¼Œä½¿ç”¨ Google æœç´¢å…³é”®å­— <code>CentOS install WordPress</code> ï¼Œæ’åç¬¬äºŒçš„æ˜¯ <code>DigitalOcean</code> å®˜æ–¹åšå®¢é‡Œçš„ <a href="https://www.digitalocean.com/community/tutorials/how-to-install-wordpress-on-centos-7" target="_blank" rel="noopener">How To Install WordPress on CentOS 7</a>ã€‚å®˜æ–¹åšå®¢é‡Œæåˆ°ï¼š</p><blockquote><p>Additionally, youâ€™ll need to have a LAMP (Linux, Apache, MySQL, and PHP) stack installed on your CentOS 7 server. If you donâ€™t have these components already installed or configured, you can use this guide to learn how to install LAMP on CentOS 7.</p></blockquote><p>è™½ç„¶ WordPress å®˜æ–¹æ²¡æœ‰ç»™å‡ºè¯¦ç»†çš„æ­å»ºæ­¥éª¤ï¼Œä½†å¯ä»¥å‚è€ƒ DigitalOcean å®˜æ–¹çš„å†…å®¹ï¼Œæ¯•ç«Ÿå…¬æœ‰äº‘æœåŠ¡æä¾›å•†çš„æŠ€æœ¯ä¸“å®¶å†™çš„åšå®¢æ›´å¯é ä¸€äº›ã€‚ç”±äºè¦æ±‚çš„æ˜¯ nginx æœ€æ–°ç‰ˆæœ¬ï¼Œyum å®‰è£…çš„ nginx ç‰ˆæœ¬å¯èƒ½ä¼šæ—§ä¸€äº›ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@interview wordpress]# yum list nginx</span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: centos-distro.1gservers.com</span><br><span class="line"> * epel: d2lzkl7pfhq30w.cloudfront.net</span><br><span class="line"> * extras: mirror.dal.nexril.net</span><br><span class="line"> * updates: mirror.dal10.us.leaseweb.net</span><br><span class="line">Available Packages</span><br><span class="line">nginx.x86_64       1:1.16.1-1.el7            epel</span><br></pre></td></tr></table></figure><p><code>yum list nginx</code> é‡Œçš„ä¿¡æ¯æ˜¾ç¤º nginx ç‰ˆæœ¬ä¸º 1.16.1 å¹¶ä¸æ˜¯ <a href="https://nginx.org/en/download.html" target="_blank" rel="noopener">å®˜ç½‘</a> ä¸Šçš„æœ€æ–°ç‰ˆ <code>1.17.10</code> ï¼Œæºç ç¼–è¯‘çš„æ—¶é—´å¯èƒ½ä¼šæœ‰ç‚¹é•¿ï¼Œå› ä¸ºå‰å¤©çœ‹åˆ°ä¸€ä¸ªæ¨æ–‡è¯´ä»–ä½¿ç”¨ GCP çš„å°é¸¡ç¼–è¯‘ nginx å¤§æ¦‚èŠ±äº† 3 ä¸ªå°æ—¶ğŸ˜‚ã€‚è€Œæˆ‘é¢è¯•è§„å®šçš„æ—¶é—´æ˜¯è¦æ±‚ 1 ä¸ªå°æ—¶å†…è§£å†³ã€‚æˆ‘å»ï¼Œæƒ³è¦æœ€æ–°ç‰ˆ nginx ï¼Œè€Œä¸”æœ€çœæ—¶é—´çš„åŠæ³•çœ‹æ¥åªç”¨ docker çš„æ–¹å¼å®‰è£… nginx äº† ï¼Œä½¿ç”¨ nginx å®˜æ–¹çš„é•œåƒ nginx:latest å³ä¸º nginx æœ€æ–°çš„ç‰ˆæœ¬ã€‚Google æœç´¢ <code>docker hub nginx</code> æ¥åˆ° docker å®˜æ–¹çš„  nginx é•œåƒä»“åº“ <a href="https://hub.docker.com/_/nginx" target="_blank" rel="noopener">nginx</a> ã€‚æˆ‘å“­äº†ï¼Œè™½ç„¶æ˜¯ 1.17 ç‰ˆæœ¬ï¼Œä½†æ˜¯ 1.17.9 ç‰ˆæœ¬è€Œä¸æ˜¯ 1.17.10 ï¼Œå°±å·®äº†ä¸€ç‚¹ç‚¹å•Šï¼æ€æ¡Œå„¿ï¼ˆã€‚å°†å°±ç€ç”¨å§ï¼Œè™½ç„¶å·®äº†é‚£ä¹ˆä¸€ç‚¹ç‚¹ã€‚</p><blockquote class="twitter-tweet"><p lang="zh" dir="ltr">å°æŠ˜è…¾äº†ä¸€æŠŠï¼šåœ¨é—²ç½®çš„æ‰‹æœºä¸Šè·‘äº†ä¸ªRuby on Railsç½‘ç«™ï¼Œå®ƒè¿˜å¸¦æœ‰HTTPSè¯ä¹¦ä¸”å…¬ç½‘å¯ä»¥è®¿é—®ã€‚æœ›ç€å±å¹•ä¸Šæ»šåŠ¨çš„Nginxæ—¥å¿—æ„Ÿè§‰è¿˜æŒºä¸å¯æ€è®®çš„ã€‚<br><br>ç³»ç»Ÿæ˜¯Androidä¸Šè·‘çš„Debianã€‚<br><br>å¦å¤–ç”¨è¿™å‡ å¹´å‰çš„æ‰‹æœºç¼–è¯‘Nginxå±…ç„¶åªèŠ±äº†å¤§æ¦‚3å°æ—¶ï¼Œæ¯”GCPæœ€ä½æ¡£çš„VPSè¿˜å¿«ã€‚ <a href="https://t.co/5PGy96al5D" target="_blank" rel="noopener">pic.twitter.com/5PGy96al5D</a></p>&mdash; ä¸å®‡ | DING Yu (@felixding) <a href="https://twitter.com/felixding/status/1249675123218497536?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">April 13, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>äº‹å®è¯æ˜æˆ‘æ¨æ–­é”™äº†ï¼Œç¬¬äºŒå¤©æˆ‘åœ¨æˆ‘çš„å¦ä¸€å°æœºå™¨ä¸Šç¼–è¯‘ nginx èŠ±äº†ä¸åˆ° 1 åˆ†é’Ÿï¼Œè¢«å¤§ä½¬å‘æƒ¨äº†å•ŠğŸ˜‚ã€‚åœ¨ GCE å°é¸¡ä¸Šç¼–è¯‘ nginx æ ¹æœ¬ä¸å¯èƒ½éœ€è¦ 3 å°æ—¶å§ï¼Œ3 åˆ†é’Ÿæ‰å¯¹çš„å§ã€‚å½“åˆçœ‹åˆ°åå°±æ„Ÿè§‰ç¼–è¯‘ nginx éœ€è¦ 3ä¸ªå°æ—¶å°±æœ‰ç‚¹é—®é¢˜ï¼Œä½†å¹¶æ²¡æœ‰äº²è‡ªå»éªŒè¯ã€‚å”‰ï¼Œè¿˜æ˜¯è‡ªå·±ä¸å¤Ÿç»†è‡´å•Šï¼Œ<strong>ä¸€çŸ¥åŠè§£çœŸæ˜¯å¾ˆå±é™©çš„äº‹å„¿ï¼</strong></p><h3 id="install-docker"><a href="#install-docker" class="headerlink" title="install docker"></a>install docker</h3><p>å®‰è£… docker çš„æ–¹å¼å†ç†Ÿæ‚‰ä¸è¿‡äº†ï¼Œä½¿ç”¨ä¸€ä¸ª curl å‘½ä»¤å°±èƒ½æå®š <code>curl -fsSL https://get.docker.com | bash -s docker</code> å¦‚æœåœ¨å›½å†…ç¯å¢ƒçš„è¯ï¼Œåé¢åŠ ä¸Š  <code>--mirror Aliyun</code>  å‚æ•°å°±èƒ½ä½¿ç”¨é˜¿é‡Œäº‘çš„é•œåƒç«™ï¼Œè¿™æ ·ä¼šæ›´å¿«ä¸€äº›ã€‚å³ <code>curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</code> ã€‚</p><p>ä¸è¿‡æˆ‘è¿˜æ˜¯ä»ç¬¬ä¸€æ¬¡æ¥è§¦çš„è§’åº¦æ¥å®‰è£… docker ï¼ŒGoogle æœç´¢ <code>centos install docker</code> ç‚¹è¿›å…¥ç¬¬ä¸€ä¸ªæœç´¢ç»“æœå³ä¸ºå®˜ç½‘ <a href="https://docs.docker.com/engine/install/centos/" target="_blank" rel="noopener">Install Docker Engine on CentOS</a> ï¼Œä¸ºäº†èŠ‚çœæ—¶é—´å°±æ²¡æœ‰æŒ‰ç…§å®˜ç½‘çš„æ­¥éª¤æ¥ï¼Œè€Œæ˜¯ä½¿ç”¨å®˜æ–¹çš„ä¸€é”®è„šæœ¬æ¥å®‰è£…ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@interview ~]# curl -fsSL https://get.docker.com -o get-docker.sh</span><br><span class="line">[root@interview ~]# ls</span><br><span class="line">get-docker.sh</span><br><span class="line">[root@interview ~]# chmod +x get-docker.sh</span><br><span class="line">[root@interview ~]# ./get-docker.sh</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆä¹‹åä½¿ç”¨ <code>docker info</code> æ¥æŸ¥çœ‹ä¸€ä¸‹ docker ä¿¡æ¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šç›®å‰æœ€æ–°ç‰ˆæœ¬çš„ docker é»˜è®¤ä¼˜å…ˆé‡‡ç”¨ <strong>overlay2</strong> çš„å­˜å‚¨é©±åŠ¨ï¼Œå¯¹äºå·²æ”¯æŒè¯¥é©±åŠ¨çš„ Linux å‘è¡Œç‰ˆï¼Œä¸éœ€è¦ä»»ä½•è¿›è¡Œä»»ä½•é¢å¤–çš„é…ç½®ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯<code>devicemapper</code> å­˜å‚¨é©±åŠ¨å·²ç»åœ¨ docker 18.09 ç‰ˆæœ¬ä¸­è¢«åºŸå¼ƒï¼Œdocker å®˜æ–¹æ¨èä½¿ç”¨ <code>overlay2</code> æ›¿ä»£<code>devicemapper</code>ï¼Œåœ¨æˆ‘å¸ç”Ÿäº§ç¯å¢ƒæ›¾ç»å› ä¸º <code>devicemapper</code> é‡åˆ°è¿‡å­˜å‚¨æŒ‚ä¸èµ·çš„å‘ğŸ˜‘ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@interview</span> <span class="string">~]#</span> <span class="string">docker</span> <span class="string">info</span></span><br><span class="line"><span class="attr">Client:</span></span><br><span class="line"> <span class="attr">Debug Mode:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">Server:</span></span><br><span class="line"> <span class="attr">Containers:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Running:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Paused:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Stopped:</span> <span class="number">0</span></span><br><span class="line"> <span class="attr">Images:</span> <span class="number">0</span></span><br><span class="line"> <span class="attr">Server Version:</span> <span class="number">19.03</span><span class="number">.8</span></span><br><span class="line"> <span class="attr">Storage Driver:</span> <span class="string">overlay2</span></span><br><span class="line">  <span class="attr">Backing Filesystem:</span> <span class="string">&lt;unknown&gt;</span></span><br><span class="line">  <span class="attr">Supports d_type:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">Native Overlay Diff:</span> <span class="literal">true</span></span><br><span class="line"> <span class="attr">Logging Driver:</span> <span class="string">json-file</span></span><br><span class="line"> <span class="attr">Cgroup Driver:</span> <span class="string">cgroupfs</span></span><br><span class="line"> <span class="attr">Plugins:</span></span><br><span class="line">  <span class="attr">Volume:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">Network:</span> <span class="string">bridge</span> <span class="string">host</span> <span class="string">ipvlan</span> <span class="string">macvlan</span> <span class="literal">null</span> <span class="string">overlay</span></span><br><span class="line">  <span class="attr">Log:</span> <span class="string">awslogs</span> <span class="string">fluentd</span> <span class="string">gcplogs</span> <span class="string">gelf</span> <span class="string">journald</span> <span class="string">json-file</span> <span class="string">local</span> <span class="string">logentries</span> <span class="string">splunk</span> <span class="string">syslog</span></span><br><span class="line"> <span class="attr">Swarm:</span> <span class="string">inactive</span></span><br><span class="line"> <span class="attr">Runtimes:</span> <span class="string">runc</span></span><br><span class="line"> <span class="attr">Default Runtime:</span> <span class="string">runc</span></span><br><span class="line"> <span class="attr">Init Binary:</span> <span class="string">docker-init</span></span><br><span class="line"> <span class="attr">containerd version:</span> <span class="string">7ad184331fa3e55e52b890ea95e65ba581ae3429</span></span><br><span class="line"> <span class="attr">runc version:</span> <span class="string">dc9208a3303feef5b3839f4323d9beb36df0a9dd</span></span><br><span class="line"> <span class="attr">init version:</span> <span class="string">fec3683</span></span><br><span class="line"> <span class="attr">Security Options:</span></span><br><span class="line">  <span class="string">seccomp</span></span><br><span class="line">   <span class="attr">Profile:</span> <span class="string">default</span></span><br><span class="line"> <span class="attr">Kernel Version:</span> <span class="number">3.10</span><span class="number">.0</span><span class="number">-1062.12</span><span class="number">.1</span><span class="string">.el7.x86_64</span></span><br><span class="line"> <span class="attr">Operating System:</span> <span class="string">CentOS</span> <span class="string">Linux</span> <span class="number">7</span> <span class="string">(Core)</span></span><br><span class="line"> <span class="attr">OSType:</span> <span class="string">linux</span></span><br><span class="line"> <span class="attr">Architecture:</span> <span class="string">x86_64</span></span><br><span class="line"> <span class="attr">CPUs:</span> <span class="number">1</span></span><br><span class="line"> <span class="attr">Total Memory:</span> <span class="number">985.</span><span class="string">3MiB</span></span><br><span class="line"> <span class="attr">Name:</span> <span class="string">interview</span></span><br><span class="line"> <span class="attr">ID:</span> <span class="string">YSZO:TT5U:GDLH:3FYT:LFGP:NLOS:L4YI:5LFU:3EAV:KHP2:F746:I5P3</span></span><br><span class="line"> <span class="attr">Docker Root Dir:</span> <span class="string">/var/lib/docker</span></span><br><span class="line"> <span class="attr">Debug Mode:</span> <span class="literal">false</span></span><br><span class="line"> <span class="attr">Registry:</span> <span class="string">https://index.docker.io/v1/</span></span><br><span class="line"> <span class="attr">Labels:</span></span><br><span class="line"> <span class="attr">Experimental:</span> <span class="literal">false</span></span><br><span class="line"> <span class="attr">Insecure Registries:</span></span><br><span class="line">  <span class="number">127.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/8</span></span><br><span class="line"> <span class="attr">Live Restore Enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="install-docker-compose"><a href="#install-docker-compose" class="headerlink" title="install docker-compose"></a>install docker-compose</h3><p>å®‰è£…å®Œ docker ä¹‹åï¼Œæ¥ä¸‹æ¥å®‰è£… docker-compose ï¼Œä½¿ç”¨ Google æœç´¢ <code>centos install docker-compose</code> ç‚¹è¿›å…¥ç¬¬ä¸€ä¸ªæœç´¢ç»“æœå³ä¸ºå®˜ç½‘çš„ <a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener">Install Docker Compose</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@interview ~] sudo curl -L "https://github.com/docker/compose/releases/download/1.25.4/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose</span><br><span class="line">[root@interview ~]# docker-compose version</span><br><span class="line">bash: /usr/local/bin/docker-compose: Permission denied</span><br><span class="line">[root@interview ~]# chmod +x /usr/local/bin/docker-compose</span><br><span class="line">[root@interview ~]# docker-compose version</span><br><span class="line">docker-compose version 1.25.4, build 8d51620a</span><br><span class="line">docker-py version: 4.1.0</span><br><span class="line">CPython version: 3.7.5</span><br><span class="line">OpenSSL version: OpenSSL 1.1.0l  10 Sep 2019</span><br></pre></td></tr></table></figure><p>é‡åˆ°äº† <code>Permission denied</code> é—®é¢˜ï¼ŒåŸæ¥æ˜¯å¿˜è®°åŠ æƒé™äº† <code>chmod +x /usr/local/bin/docker-compose</code> ä¸€ä¸‹å³å¯ã€‚</p><h3 id="WordPress-1"><a href="#WordPress-1" class="headerlink" title="WordPress"></a>WordPress</h3><p>å®˜æ–¹ <a href="https://docs.docker.com/compose/wordpress/" target="_blank" rel="noopener">Quickstart: Compose and WordPress</a> çš„ <code>docker-compose.yaml</code> ä¸­çš„ web æœåŠ¡å™¨æ˜¯ä½¿ç”¨çš„ apache è€Œä¸æ˜¯ nginx ï¼Œå› æ­¤è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ docker-compose.yamlï¼Œå‰æ®µæ—¶é—´åœ¨æŠ˜è…¾ Webp Server Go çš„æ—¶å€™é‡åˆ°è¿‡è¿™ç§éœ€æ±‚ã€‚äºæ˜¯åœ¨ GitHub ä¸Šæœç´¢ <code>wordpress nginx docker-compose</code> æ‰¾åˆ°äº†åˆé€‚çš„ repo å³ <a href="https://github.com/mjstealey/wordpress-nginx-docker" target="_blank" rel="noopener">wordpress-nginx-docker</a> ã€‚çœ‹ä¸€ä¸‹ docker-compose.yaml æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.6'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">wordpress:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">wordpress:$&#123;WORDPRESS_VERSION:-php7.3-fpm&#125;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">wordpress</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./config/php.conf.ini:/usr/local/etc/php/conf.d/conf.ini</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./wordpress:/var/www/html</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_DB_NAME=$&#123;WORDPRESS_DB_NAME:-wordpress&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_TABLE_PREFIX=$&#123;WORDPRESS_TABLE_PREFIX:-wp_&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_DB_HOST=$&#123;WORDPRESS_DB_HOST:-mysql&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_DB_USER=$&#123;WORDPRESS_DB_USER:-root&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_DB_PASSWORD=$&#123;WORDPRESS_DB_PASSWORD:-password&#125;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mariadb:$&#123;MARIADB_VERSION:-latest&#125;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql:/var/lib/mysql</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD:-password&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_USER=$&#123;MYSQL_USER:-root&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_PASSWORD=$&#123;MYSQL_PASSWORD:-password&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_DATABASE=$&#123;MYSQL_DATABASE:-wordpress&#125;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:$&#123;NGINX_VERSION:-latest&#125;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'80:80'</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'443:443'</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;NGINX_CONF_DIR:-./nginx&#125;:/etc/nginx/conf.d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;NGINX_LOG_DIR:-./logs/nginx&#125;:/var/log/nginx</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;WORDPRESS_DATA_DIR:-./wordpress&#125;:/var/www/html</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;SSL_CERTS_DIR:-./certs&#125;:/etc/letsencrypt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;SSL_CERTS_DATA_DIR:-./certs-data&#125;:/data/letsencrypt</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">wordpress</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">adminer:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">adminer</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8080</span><span class="string">:8080</span></span><br></pre></td></tr></table></figure><p>å…±æœ‰ 4 ä¸ªå®¹å™¨ï¼š wordpressã€mysqlã€nginxã€adminerï¼Œé»˜è®¤ä¸éœ€è¦ä¿®æ”¹æ—¢å¯ä»¥éƒ¨ç½²èµ·æ¥ã€‚adminer æ˜¯ä¸ª web ç«¯ç®¡ç† MySQL æ•°æ®åº“çš„ï¼Œå¯ä»¥åˆ æ‰ä¸éœ€è¦ã€‚</p><p>ç”±äºé»˜è®¤çš„ç³»ç»Ÿä¸å¸¦ git ï¼Œæ‰€ä»¥éœ€è¦å®‰è£…ä¸€ä¸‹ git <code>yum install git</code>ï¼Œç„¶åæŠŠ repo clone ä¸‹æ¥ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/mjstealey/wordpress-nginx-docker</span><br><span class="line">cd wordpress-nginx-docker</span><br><span class="line">docker-compose up</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä½¿ç”¨ <code>docker-compose up</code> å‘½ä»¤å°±èƒ½å¯åŠ¨ä¸€ä¸ª WordPress ç«™ç‚¹äº†ã€‚é€šè¿‡è®¿é—®åŸŸå <a href="https://wordpress.k8s.li/" target="_blank" rel="noopener"> wordpress.k8s.li</a> å³å¯è®¿é—®åˆšåˆšåˆ›å»ºå¥½çš„ç½‘ç«™äº†ã€‚</p><h3 id="Webp-Server"><a href="#Webp-Server" class="headerlink" title="Webp Server"></a>Webp Server</h3><p>ä¸ºäº†ä¼˜åŒ–ä¸€ä¸‹åšå®¢å›¾ç‰‡é™æ€èµ„æºçš„åŠ è½½é€Ÿåº¦ï¼Œå¯ä»¥ä¸º WordPress åŠ ä¸Šä¸€ä¸ª Webp Server æœåŠ¡ï¼Œå°†åŸå›¾ç‰‡å‹ç¼©ä¸º webp æ ¼å¼ã€‚éœ€è¦ä¿®æ”¹ä¸€ä¸‹ nginx çš„é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span><span class="regexp"> ^~</span> /wp-content/uploads/ &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://webp-server:3333;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ docker-compose.yaml æ–‡ä»¶ä¸­åŠ å…¥ webp server çš„å®¹å™¨</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.6'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">wordpress:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">wordpress:$&#123;WORDPRESS_VERSION:-php7.3-fpm&#125;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">wordpress</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./config/php.conf.ini:/usr/local/etc/php/conf.d/conf.ini</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./wordpress:/var/www/html</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_DB_NAME=$&#123;WORDPRESS_DB_NAME:-wordpress&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_TABLE_PREFIX=$&#123;WORDPRESS_TABLE_PREFIX:-wp_&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_DB_HOST=$&#123;WORDPRESS_DB_HOST:-mysql&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_DB_USER=$&#123;WORDPRESS_DB_USER:-root&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WORDPRESS_DB_PASSWORD=$&#123;WORDPRESS_DB_PASSWORD:-password&#125;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mariadb:$&#123;MARIADB_VERSION:-latest&#125;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql:/var/lib/mysql</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD:-password&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_USER=$&#123;MYSQL_USER:-root&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_PASSWORD=$&#123;MYSQL_PASSWORD:-password&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_DATABASE=$&#123;MYSQL_DATABASE:-wordpress&#125;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:$&#123;NGINX_VERSION:-latest&#125;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'80:80'</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'443:443'</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;NGINX_CONF_DIR:-./nginx&#125;:/etc/nginx/conf.d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;NGINX_LOG_DIR:-./logs/nginx&#125;:/var/log/nginx</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;WORDPRESS_DATA_DIR:-./wordpress&#125;:/var/www/html</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;SSL_CERTS_DIR:-./certs&#125;:/etc/letsencrypt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;SSL_CERTS_DATA_DIR:-./certs-data&#125;:/data/letsencrypt</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">wordpress</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">webp-server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">webpsh/webps:latest</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">webp-server</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./webp-server/config.json:/etc/config.json</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./wordpress:/var/www/html</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3333</span><span class="string">:3333</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å¥½ docker-compose.yaml æ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸º  webp-server å‡†å¤‡ä¸€ä¸ª config.json æ–‡ä»¶ï¼Œå­˜æ”¾åœ¨ <code>./webp-server/config.json</code>  ä¸‹ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"HOST"</span>: <span class="string">"0.0.0.0"</span>,</span><br><span class="line">  <span class="attr">"PORT"</span>: <span class="string">"3333"</span>,</span><br><span class="line">  <span class="attr">"QUALITY"</span>: <span class="string">"80"</span>,</span><br><span class="line">  <span class="attr">"IMG_PATH"</span>: <span class="string">"/var/www/html"</span>,</span><br><span class="line">  <span class="attr">"EXHAUST_PATH"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"ALLOWED_TYPES"</span>: [<span class="string">"jpg"</span>,<span class="string">"png"</span>,<span class="string">"jpeg"</span>,<span class="string">"bmp"</span>,<span class="string">"gif"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ <code>docker-compose restart</code> å‘½ä»¤é‡å¯ä¸€ä¸‹å®¹å™¨ï¼Œä¹‹åå† WordPress ç«¯ä¸Šä¼ ä¸€å¼ å›¾ç‰‡æµ‹è¯•ä¸€ä¸‹ã€‚ä¸Šä¼ å®Œæˆä¹‹åï¼Œæ‹¿åˆ°å›¾ç‰‡çš„ url ï¼Œç„¶åä½¿ç”¨ wget å‘½ä»¤æµ‹è¯•ä¸€ä¸‹ï¼Œæ˜¾ç¤º <code>Length: 102288 (100K)  [image/webp]</code> å°±è¯´æ˜æˆ‘ä»¬çš„ webp server å·²ç»æˆåŠŸè¿è¡Œå•¦ğŸ˜‚ã€‚å®Œæ•´çš„ repo åœ¨æˆ‘çš„ GitHub ä¸Š <a href="https://github.com/muzi502/Wwordpress" target="_blank" rel="noopener">Wwordpress</a> ï¼Œæ¬¢è¿æ¥é£Ÿç”¨å‘€ğŸ˜‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 /opt/wordpress-nginx-docker â€¹masterâ€º</span><br><span class="line">â•°â”€# wget  http://dl.amd64.xyz/wp-content/uploads/2020/04/74898710_p21.jpg</span><br><span class="line">--2020-04-17 01:06:29--  http://dl.amd64.xyz/wp-content/uploads/2020/04/74898710_p21.jpg</span><br><span class="line">Resolving dl.amd64.xyz (dl.amd64.xyz)... 3.1.38.108</span><br><span class="line">Connecting to dl.amd64.xyz (dl.amd64.xyz)|3.1.38.108|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 102288 (100K) [image/webp]</span><br><span class="line">Saving to: â€˜74898710_p21.jpgâ€™</span><br><span class="line"></span><br><span class="line">74898710_p21.jpg             100%[=======&gt;]  99.89K  --.-KB/s    in 0.001s</span><br><span class="line"></span><br><span class="line">2020-04-17 01:06:29 (130 MB/s) - â€˜74898710_p21.jpgâ€™ saved [102288/102288]</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><p><a href="https://wordpress.org/" target="_blank" rel="noopener">wordpress.org</a></p></li><li><p><a href="https://hub.docker.com/_/wordpress/" target="_blank" rel="noopener">dockerhub WordPress</a></p></li><li><p><a href="https://www.nginx.com/" target="_blank" rel="noopener">nginx.com</a></p></li><li><p><a href="https://github.com/mjstealey/wordpress-nginx-docker" target="_blank" rel="noopener">wordpress-nginx-docker</a></p></li><li><p><a href="https://github.com/muzi502/Wwordpress" target="_blank" rel="noopener">Wwordpress</a></p></li><li><p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-wordpress-on-centos-7" target="_blank" rel="noopener">How To Install WordPress on CentOS 7</a></p></li><li><p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-apache-mysql-php-lamp-stack-on-centos-7" target="_blank" rel="noopener">How To Install Linux, Apache, MySQL, PHP (LAMP) stack On CentOS 7</a></p></li><li><p><a href="https://docs.docker.com/compose/wordpress/" target="_blank" rel="noopener">Quickstart: Compose and WordPress</a></p></li><li><p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-wordpress-with-docker-compose" target="_blank" rel="noopener">How To Install WordPress With Docker Compose</a></p></li><li><p><a href="https://docs.docker.com/engine/install/centos/" target="_blank" rel="noopener">Install Docker Engine on CentOS</a></p></li><li><p><a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener">Install Docker Compose</a></p></li><li><p><a href="https://www.howtoforge.com/tutorial/how-to-build-nginx-from-source-on-ubuntu-1804-lts/" target="_blank" rel="noopener">How to Build NGINX from source on Ubuntu 18.04 LTS</a></p></li><li><p><a href="https://blog.k8s.li/oh-my-webpsh.html">è®©å›¾ç‰‡é£èµ·æ¥ oh-my-webp.sh ï¼</a></p></li></ul><h2 id="end"><a href="#end" class="headerlink" title="end"></a>end</h2><p>è‡³æ­¤éƒ¨ç½²ä¸€ä¸ª WordPress çš„æµç¨‹å°±ç»“æŸå•¦ï¼Œä¸ºäº†è¿½æ±‚é€Ÿåº¦å°±æ”¾å¼ƒäº†å¯¹ä¸€äº›ç»†èŠ‚çš„æ·±ç©¶ï¼Œå¾—ä¸å¿å¤±å•Šã€‚</p><p>æœ‰äº›å†…å®¹çœ‹ä¼¼ç®€å•ï¼Œä½†æƒ³æŠŠè¿™ä¸ªè¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ä»¥åŠæƒ³æ³•è½ç¬”æˆå­—ï¼Œå½¢æˆä¸€ç¯‡åšå®¢ï¼Œè¿˜æ˜¯éœ€è¦è¯­è¨€ç»„ç»‡èƒ½åŠ›ï¼Œçœ‹æ¥è‡ªå·±è¿™æ–¹é¢è¿˜æ˜¯æœ‰äº›æ¬ ç¼ºã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;ä»Šå¤©æ”¶åˆ°ä¸€ä»½é¢è¯•é¢˜ï¼Œå†…å®¹çœ‹ä¼¼å¾ˆç®€å•ï¼š&lt;/p&gt;
&lt;block
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="nginx" scheme="https://blog.k8s.li/tags/nginx/"/>
    
      <category term="WordPress" scheme="https://blog.k8s.li/tags/WordPress/"/>
    
      <category term="MySQL" scheme="https://blog.k8s.li/tags/MySQL/"/>
    
      <category term="PHP" scheme="https://blog.k8s.li/tags/PHP/"/>
    
      <category term="Webp" scheme="https://blog.k8s.li/tags/Webp/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ kubeadm å¿«é€Ÿéƒ¨ç½²ä½“éªŒ K8s</title>
    <link href="https://blog.k8s.li/kubeadm-deploy-k8s-v1.17.4.html"/>
    <id>https://blog.k8s.li/kubeadm-deploy-k8s-v1.17.4.html</id>
    <published>2020-04-14T16:00:00.000Z</published>
    <updated>2020-04-14T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç‚’å†·é¥­"><a href="#ç‚’å†·é¥­" class="headerlink" title="ç‚’å†·é¥­"></a>ç‚’å†·é¥­</h2><p>å¤§æ¦‚æ˜¯ä»å»å¹´ 5 æœˆå¼€å§‹æ‰æ¥è§¦  kubernetes ï¼Œæ—¶è‡³ä»Šæ—¥å·²ç»å¿«ä¸€å¹´ï¼Œå½“åˆå†™çš„ä¸€ç¯‡åšå®¢ <a href="https://blog.k8s.li/install-k8s-ubuntu18-04.html">ubuntu 1804 ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes</a> ç¿»å‡ºæ¥é‡æ–°ä¿®æ”¹ä¸€ä¸‹ï¼Œè®°å½•ä¸€ä¸‹ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes v1.17.4 ç‰ˆçš„æµç¨‹ã€‚é€‚ç”¨äºå›½å†…ç½‘ç»œç¯å¢ƒä¸‹ã€‚</p><h3 id="kubeadm"><a href="#kubeadm" class="headerlink" title="kubeadm"></a>kubeadm</h3><p>Kubernetes ä» 1.4 ç‰ˆæœ¬å¼€å§‹åå°±å¼•å…¥äº† kubeadm ç”¨äºç®€åŒ–é›†ç¾¤æ­å»ºçš„è¿‡ç¨‹ï¼Œåœ¨ Kubernetes 1.13 ç‰ˆæœ¬ä¸­ï¼Œkubeadm å·¥å…·è¿›å…¥ GA é˜¶æ®µï¼Œè€Œå½“å‰çš„ kubernetes æœ€æ–°ç‰ˆ stable ä¸º 1.18.1 ï¼Œkubeadm å·²ç»ç»å†è¿‡å¤šä¸ªç‰ˆæœ¬çš„è¿­ä»£ï¼Œå¯ç”¨äºç”Ÿäº§ç¯å¢ƒ Kubernetes é›†ç¾¤æ­å»ºã€‚å¯¹äºåˆšåˆšæ¥è§¦ kubernetes  çš„åˆå­¦è€…æ¥è®²ï¼Œkubeadm ä¹Ÿæ˜¯ä¸€ä¸ªå¿«é€Ÿéƒ¨ç½²ä½“éªŒ kubernetes çš„ä¸äºŒä¹‹é€‰ã€‚</p><h2 id="kubernetes-æ¶æ„"><a href="#kubernetes-æ¶æ„" class="headerlink" title="kubernetes æ¶æ„"></a>kubernetes æ¶æ„</h2><p><img src="img/components-of-kubernetes.png" alt="Components of Kubernetes"></p><p>æ¶æ„å›¾æ¥è‡ª kubernetes å®˜æ–¹æ–‡æ¡£ <a href="https://kubernetes.io/zh/docs/concepts/overview/components/" target="_blank" rel="noopener">Kubernetes ç»„ä»¶</a></p><h3 id="æ§åˆ¶å¹³é¢"><a href="#æ§åˆ¶å¹³é¢" class="headerlink" title="æ§åˆ¶å¹³é¢"></a>æ§åˆ¶å¹³é¢</h3><p>æ§åˆ¶å¹³é¢çš„ç»„ä»¶å¯¹é›†ç¾¤åšå‡ºå…¨å±€å†³ç­–(æ¯”å¦‚è°ƒåº¦)ï¼Œä»¥åŠæ£€æµ‹å’Œå“åº”é›†ç¾¤äº‹ä»¶ä¸»è¦çš„ç»„ä»¶ç”±</p><ul><li>kube-apiserverï¼šä¸»èŠ‚ç‚¹ä¸Šè´Ÿè´£æä¾› Kubernetes API æœåŠ¡çš„ç»„ä»¶ï¼›å®ƒæ˜¯ Kubernetes æ§åˆ¶é¢çš„å‰ç«¯ã€‚</li><li>etcdï¼šé›†ç¾¤ä¸­å”¯ä¸€ä¸€ä¸ªæœ‰çŠ¶æ€çš„æœåŠ¡ï¼Œç”¨æ¥å­˜å‚¨é›†ç¾¤ä¸­çš„æ‰€æœ‰èµ„æºä¿¡æ¯æ•°æ®ã€‚</li><li>kube-schedulerï¼šè´Ÿè´£è°ƒåº¦ Pod èµ„æºåˆ°æŸä¸ª Node èŠ‚ç‚¹ä¸Šã€‚</li><li>kube-controller-managerï¼šæ§åˆ¶å™¨ç®¡ç†å™¨ã€‚</li><li>kubeletï¼šå¦‚æœä½¿ç”¨ kubeadm éƒ¨ç½²çš„è¯éœ€è¦åœ¨ master èŠ‚ç‚¹å®‰è£… kubelet</li></ul><h3 id="å·¥ä½œå¹³é¢"><a href="#å·¥ä½œå¹³é¢" class="headerlink" title="å·¥ä½œå¹³é¢"></a>å·¥ä½œå¹³é¢</h3><ul><li>kubeletï¼šé€šè¿‡ç›‘å¬ kube-apiserver ï¼Œæ¥æ”¶ä¸€ç»„é€šè¿‡å„ç±»æœºåˆ¶æä¾›ç»™å®ƒçš„ PodSpecsï¼Œç¡®ä¿è¿™äº› PodSpecs ä¸­æè¿°çš„å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ä¸”å¥åº·ã€‚</li><li>kube-proxyï¼šå®ç° Kubernetes <a href="https://kubernetes.io/docs/concepts/services-networking/service/" target="_blank" rel="noopener">Service</a> æ¦‚å¿µçš„ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡ iptables è§„åˆ™å°† service è´Ÿè½½å‡è¡¡åˆ°å„ä¸ª Podã€‚</li><li>CRIå®¹å™¨è¿è¡Œæ—¶ï¼šæ ¹æ®ç»Ÿè®¡ç›®å‰ docker ä¾æ—§æ˜¯æ’åç¬¬ä¸€çš„å®¹å™¨è¿è¡Œæ—¶</li></ul><h3 id="kubeadm-init-æµç¨‹"><a href="#kubeadm-init-æµç¨‹" class="headerlink" title="kubeadm init æµç¨‹"></a>kubeadm init æµç¨‹</h3><p>åœ¨ä½¿ç”¨ kubeadm éƒ¨ç½²æ—¶ï¼Œé™¤äº† kubelet ç»„ä»¶éœ€è¦ä½¿ç”¨äºŒè¿›åˆ¶éƒ¨ç½²å¤–ï¼Œå…¶ä»–çš„ç»„ä»¶éƒ½æ˜¯ç”¨ <a href="">static Pod</a> çš„æ–¹å¼è¿è¡Œåœ¨ç›¸åº”çš„èŠ‚ç‚¹ã€‚</p><h2 id="èŠ‚ç‚¹åˆå§‹åŒ–"><a href="#èŠ‚ç‚¹åˆå§‹åŒ–" class="headerlink" title="èŠ‚ç‚¹åˆå§‹åŒ–"></a>èŠ‚ç‚¹åˆå§‹åŒ–</h2><p>ç³»ç»Ÿå»ºè®®é€‰æ‹© ubuntu 1804 æˆ–è€… CentOS 7.7ï¼Œå› ä¸º docker å®¹å™¨è™šæ‹ŸåŒ–ä»¥åŠ kubernetes è¿™äº›æ–°æŠ€æœ¯éƒ½æ˜¯å¾ˆä¾èµ–ä¸€äº›å†…æ ¸ç‰¹æ€§ï¼Œæ¯”å¦‚ overlay2ã€cgroupv2 ç­‰ï¼Œè¿™äº›ç‰¹æ€§åœ¨è¾ƒä½ç‰ˆæœ¬çš„å†…æ ¸ä¸Šå¹¶ä¸æ˜¯å¾ˆç¨³å®šï¼Œå»ºè®® 4.14 æˆ–è€… 4.19 ä»¥ä¸Šçš„ LTS  å†…æ ¸ï¼ŒåŠé•¿æœŸç¨³å®šæ”¯æŒç‰ˆå†…æ ¸ï¼Œåœ¨ <a href="https://www.kernel.org/category/releases.html" target="_blank" rel="noopener">kernel.org</a> ä¸Šæœ‰å†…æ ¸æ”¯æŒæ”¯æŒæƒ…å†µã€‚</p><h3 id="è®¾ç½®ä¸»æœºåå¹¶æ·»åŠ -hosts"><a href="#è®¾ç½®ä¸»æœºåå¹¶æ·»åŠ -hosts" class="headerlink" title="è®¾ç½®ä¸»æœºåå¹¶æ·»åŠ   hosts"></a>è®¾ç½®ä¸»æœºåå¹¶æ·»åŠ   hosts</h3><p>æ¯å°æœºå™¨ä¸Šéƒ½è¦è®¾ç½®ç›¸åº”çš„ä¸»æœºåå¹¶æ·»åŠ  hosts</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname k8s-maste-01</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /etc/hosts &lt;&lt;EOF</span><br><span class="line">10.20.172.211 k8s-master-01</span><br><span class="line">10.20.172.212 k8s-node-01</span><br><span class="line">10.20.172.213 k8s-node-02</span><br><span class="line">10.20.172.214 k8s-node-03</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="å…³é—­-swap-å’Œ-SELinux"><a href="#å…³é—­-swap-å’Œ-SELinux" class="headerlink" title="å…³é—­ swap å’Œ SELinux"></a>å…³é—­ swap å’Œ SELinux</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¸´æ—¶å…³é—­swapå’ŒSELinux</span></span><br><span class="line">swapoff -a</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ubuntu é»˜è®¤æ²¡æœ‰å®‰è£… SELinux å› ä¸ºæ— éœ€å…³é—­</span></span><br><span class="line">setenforce 0</span><br><span class="line">sed -i 's/^SELINUX=enforcing$/SELINUX= disabled/' /etc/selinux/config</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®å†…æ ¸å‚æ•°"><a href="#è®¾ç½®å†…æ ¸å‚æ•°" class="headerlink" title="è®¾ç½®å†…æ ¸å‚æ•°"></a>è®¾ç½®å†…æ ¸å‚æ•°</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/sysctl.d/99-kubernetes-cri.conf &lt;&lt;EOF</span><br><span class="line">net.bridge.bridge-nf-call-iptables  = 1</span><br><span class="line">enet.ipv4.ip_forward                = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">EOF</span><br><span class="line">sysctl --system</span><br></pre></td></tr></table></figure><h3 id="é…ç½®é•œåƒæºå’Œå®‰è£…"><a href="#é…ç½®é•œåƒæºå’Œå®‰è£…" class="headerlink" title="é…ç½®é•œåƒæºå’Œå®‰è£…"></a>é…ç½®é•œåƒæºå’Œå®‰è£…</h3><p>å¦‚æœå¯¹ docker-ce ç‰ˆæœ¬æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯å®‰è£… docker-ce æœ€æ–°çš„ stable ç‰ˆæœ¬ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br></pre></td></tr></table></figure><h4 id="CentOS7"><a href="#CentOS7" class="headerlink" title="CentOS7"></a>CentOS7</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœ docker ç‰ˆæœ¬ä½¿ç”¨ 18.09 + ä¸”å­˜å‚¨é©±åŠ¨ä½¿ç”¨ overlay2</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°±ä¸ç”¨ device-mapper-persistent-data å’Œ lvm2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ·»åŠ aliyunè½¯ä»¶åŒ…yumæº docker</span></span><br><span class="line">yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ·»åŠ aliyunè½¯ä»¶åŒ…yumæº kubelet kubeadm kubectl</span></span><br><span class="line"><span class="meta">cat&gt;</span><span class="bash">&gt;/etc/yum.repos.d/kubrenetes.repo&lt;&lt;EOF</span></span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes Repo</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">gpgcheck=0</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class="line">EOF</span><br><span class="line">yum makecache</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ—å‡ºå¯ä»¥å®‰è£…çš„ docker-ce ç‰ˆæœ¬ï¼Œå®‰è£…æŒ‡å®šçš„ docker ç‰ˆæœ¬</span></span><br><span class="line">yum list docker-ce --showduplicates|sort -r</span><br><span class="line">yum install -y docker-ce-19.03.3-3.el7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="comment"># åˆ—å‡ºå¯ä»¥å®‰è£…çš„ kubernetes ç‰ˆæœ¬ï¼Œå®‰è£…æŒ‡å®šçš„ kubeadm kubelet kubectl</span></span></span><br><span class="line">yum list kubeadm --showduplicates|sort -r</span><br><span class="line">yum install kubelet-1.17.4-0 kubeadm-1.17.4-0 kubectl-1.17.4-0 --disableexcludes=kubernetes</span><br></pre></td></tr></table></figure><h4 id="Ubuntu-1804"><a href="#Ubuntu-1804" class="headerlink" title="Ubuntu 1804"></a>Ubuntu 1804</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt-get install -y apt-transport-https ca-certificates curl software-properties-common</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ·»åŠ é˜¿é‡Œäº‘ docker-ce é•œåƒæº</span></span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line">add-apt-repository "deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable"</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ·»åŠ é˜¿é‡Œäº‘ kubernetes é•œåƒæº</span></span><br><span class="line">curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add -</span><br><span class="line">cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span><br><span class="line">deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main</span><br><span class="line">EOF</span><br><span class="line">apt-get update</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„ docker-ce</span></span><br><span class="line">apt list -a docker-ce</span><br><span class="line">apt install docker-ce=5:19.03.8~3-0~ubuntu-bionic</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„ kubernetes</span></span><br><span class="line">apt install kubeadm=1.17.4-00 kubelet=1.17.4-00 kubectl=1.17.4-00</span><br></pre></td></tr></table></figure><h4 id="åä¸ºäº‘å‘"><a href="#åä¸ºäº‘å‘" class="headerlink" title="åä¸ºäº‘å‘"></a>åä¸ºäº‘å‘</h4><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨çš„åä¸ºäº‘ kubernetes é•œåƒæºï¼Œç›®å‰ ï¼ˆ2020-04-15ï¼‰ åä¸ºäº‘ä¸Šçš„ kubernetes ç‰ˆæœ¬æœ€é«˜æ”¯æŒåˆ° 1.14.2ï¼Œè€Œ 1.14 ç‰ˆæœ¬ kubernetes å·²ç»ä¸åœ¨ç»´æŠ¤äº†ï¼Œæ‰€ä»¥æ¨èæ¢ä¸ªé•œåƒæºå®‰è£… v.1.16.8 æˆ–è€… v1.17.4 è¿™ä¸¤ä¸ªç‰ˆæœ¬ï¼Œv1.18.1 ä¹Ÿä¸å»ºè®®å»ºè®®å®‰è£…ä½¿ç”¨ã€‚å…³äºç‰ˆæœ¬çš„é€‰æ‹©å¯ä»¥å‚è€ƒ <a href="https://blog.k8s.li/How-to-choose-the-right-version-of-kubernetes.html">ç”Ÿäº§ç¯å¢ƒå¦‚ä½•ä¿å®ˆåœ°é€‰æ‹© kubernetes ç‰ˆæœ¬</a> ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 ~</span><br><span class="line">â•°â”€# yum list kubeadm --showduplicates|sort -r</span><br><span class="line">kubeadm.x86_64                       1.6.11-0                         kubernetes</span><br><span class="line">kubeadm.x86_64                       1.6.1-0                          kubernetes</span><br><span class="line">kubeadm.x86_64                       1.6.10-0                         kubernetes</span><br><span class="line">kubeadm.x86_64                       1.6.0-0                          kubernetes</span><br><span class="line">kubeadm.x86_64                       1.14.2-0                         kubernetes</span><br><span class="line">kubeadm.x86_64                       1.14.1-0                         kubernetes</span><br><span class="line">kubeadm.x86_64                       1.14.0-0                         kubernetes</span><br><span class="line">kubeadm.x86_64                       1.13.6-0                         kubernetes</span><br><span class="line">kubeadm.x86_64                       1.13.5-0                         kubernetes</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®-docker-çš„daemon-json"><a href="#è®¾ç½®-docker-çš„daemon-json" class="headerlink" title="è®¾ç½® docker çš„daemon.json"></a>è®¾ç½® docker çš„daemon.json</h3><p>å®‰è£…å®Œæˆä¹‹åå…ˆè®¾ç½®ä»¥ä¸‹ docker çš„å¯åŠ¨å‚æ•° <code>/etc/docker/daemon.json</code></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/docker/daemon.json &lt;&lt;EOF</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"exec-opts"</span>: [<span class="string">"native.cgroupdriver=systemd"</span>],</span><br><span class="line">  <span class="attr">"registry-mirrors"</span>: [<span class="string">"https://xlx9erfu.mirror.aliyuncs.com"</span>],</span><br><span class="line">  <span class="attr">"log-driver"</span>: <span class="string">"json-file"</span>,</span><br><span class="line">  <span class="attr">"log-opts"</span>: &#123;</span><br><span class="line">    <span class="attr">"max-size"</span>: <span class="string">"100m"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"storage-driver"</span>: <span class="string">"overlay2"</span></span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨"><a href="#è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨" class="headerlink" title="è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨"></a>è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable docker kubelet</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start docker kubelet</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">â•­â”€root@k8s-master-01</span> <span class="string">~</span></span><br><span class="line"><span class="string">â•°â”€#</span> <span class="string">docker</span> <span class="string">info</span></span><br><span class="line"><span class="attr">Client:</span></span><br><span class="line"> <span class="attr">Debug Mode:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">Server:</span></span><br><span class="line"> <span class="attr">Containers:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Running:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Paused:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Stopped:</span> <span class="number">0</span></span><br><span class="line"> <span class="attr">Images:</span> <span class="number">0</span></span><br><span class="line"> <span class="attr">Server Version:</span> <span class="number">19.03</span><span class="number">.3</span></span><br><span class="line"> <span class="attr">Storage Driver:</span> <span class="string">overlay2</span></span><br><span class="line">  <span class="attr">Backing Filesystem:</span> <span class="string">extfs</span></span><br><span class="line">  <span class="attr">Supports d_type:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">Native Overlay Diff:</span> <span class="literal">true</span></span><br><span class="line"> <span class="attr">Logging Driver:</span> <span class="string">json-file</span></span><br><span class="line"> <span class="attr">Cgroup Driver:</span> <span class="string">cgroupfs</span></span><br><span class="line"> <span class="attr">Plugins:</span></span><br><span class="line">  <span class="attr">Volume:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">Network:</span> <span class="string">bridge</span> <span class="string">host</span> <span class="string">ipvlan</span> <span class="string">macvlan</span> <span class="literal">null</span> <span class="string">overlay</span></span><br><span class="line">  <span class="attr">Log:</span> <span class="string">awslogs</span> <span class="string">fluentd</span> <span class="string">gcplogs</span> <span class="string">gelf</span> <span class="string">journald</span> <span class="string">json-file</span> <span class="string">local</span> <span class="string">logentries</span> <span class="string">splunk</span> <span class="string">syslog</span></span><br><span class="line"> <span class="attr">Swarm:</span> <span class="string">inactive</span></span><br><span class="line"> <span class="attr">Runtimes:</span> <span class="string">runc</span></span><br><span class="line"> <span class="attr">Default Runtime:</span> <span class="string">runc</span></span><br><span class="line"> <span class="attr">Init Binary:</span> <span class="string">docker-init</span></span><br><span class="line"> <span class="attr">containerd version:</span> <span class="string">894b81a4b802e4eb2a91d1ce216b8817763c29fb</span></span><br><span class="line"> <span class="attr">runc version:</span> <span class="string">425e105d5a03fabd737a126ad93d62a9eeede87f</span></span><br><span class="line"> <span class="attr">init version:</span> <span class="string">fec3683</span></span><br><span class="line"> <span class="attr">Security Options:</span></span><br><span class="line">  <span class="string">seccomp</span></span><br><span class="line">   <span class="attr">Profile:</span> <span class="string">default</span></span><br><span class="line"> <span class="attr">Kernel Version:</span> <span class="number">3.10</span><span class="number">.0</span><span class="number">-957.</span><span class="string">el7.x86_64</span></span><br><span class="line"> <span class="attr">Operating System:</span> <span class="string">CentOS</span> <span class="string">Linux</span> <span class="number">7</span> <span class="string">(Core)</span></span><br><span class="line"> <span class="attr">OSType:</span> <span class="string">linux</span></span><br><span class="line"> <span class="attr">Architecture:</span> <span class="string">x86_64</span></span><br><span class="line"> <span class="attr">CPUs:</span> <span class="number">4</span></span><br><span class="line"> <span class="attr">Total Memory:</span> <span class="number">3.</span><span class="string">683GiB</span></span><br><span class="line"> <span class="attr">Name:</span> <span class="string">k8s-master-01</span></span><br><span class="line"> <span class="attr">ID:</span> <span class="string">UXD4:IK6C:P3EO:TXRP:GQZD:STGH:GXZH:LO2C:HFBN:LV2B:LEVE:UWT2</span></span><br><span class="line"> <span class="attr">Docker Root Dir:</span> <span class="string">/var/lib/docker</span></span><br><span class="line"> <span class="attr">Debug Mode:</span> <span class="literal">false</span></span><br><span class="line"> <span class="attr">Registry:</span> <span class="string">https://index.docker.io/v1/</span></span><br><span class="line"> <span class="attr">Labels:</span></span><br><span class="line"> <span class="attr">Experimental:</span> <span class="literal">false</span></span><br><span class="line"> <span class="attr">Insecure Registries:</span></span><br><span class="line">  <span class="number">127.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/8</span></span><br><span class="line"> <span class="attr">Live Restore Enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>ç›®å‰æœ€æ–°ç‰ˆæœ¬çš„ docker é»˜è®¤ä¼˜å…ˆé‡‡ç”¨ <strong>overlay2</strong>  çš„å­˜å‚¨é©±åŠ¨ï¼Œå¯¹äºå·²æ”¯æŒè¯¥é©±åŠ¨çš„ Linux å‘è¡Œç‰ˆï¼Œä¸éœ€è¦ä»»ä½•è¿›è¡Œä»»ä½•é¢å¤–çš„é…ç½®ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯<code>devicemapper</code> å­˜å‚¨é©±åŠ¨å·²ç»åœ¨ docker 18.09 ç‰ˆæœ¬ä¸­è¢«åºŸå¼ƒï¼Œdocker å®˜æ–¹æ¨èä½¿ç”¨ <code>overlay2</code> æ›¿ä»£<code>devicemapper</code>ã€‚å¯ä½¿ç”¨ lsmod å‘½ä»¤æŸ¥çœ‹å½“å‰ç³»ç»Ÿå†…æ ¸æ˜¯å¦æ”¯æŒ overlay2 ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# lsmod |grep overlay</span><br><span class="line">overlay                71964  16</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²-master-èŠ‚ç‚¹"><a href="#éƒ¨ç½²-master-èŠ‚ç‚¹" class="headerlink" title="éƒ¨ç½² master èŠ‚ç‚¹"></a>éƒ¨ç½² master èŠ‚ç‚¹</h2><h3 id="å‡†å¤‡é•œåƒ"><a href="#å‡†å¤‡é•œåƒ" class="headerlink" title="å‡†å¤‡é•œåƒ"></a>å‡†å¤‡é•œåƒ</h3><p>å¯¹äº kubernetes 1.17.4 ç‰ˆæœ¬çš„ kubeadm éœ€è¦ä½¿ç”¨åˆ°ä»¥ä¸‹ docker é•œåƒå¦‚ä¸‹ï¼Œå¯¹äºå¢™å›½ç½‘ç»œç¯å¢ƒä¸‹ï¼Œä½ éœ€è¦æ‰¾å°å¯ä»¥è‡ªç”±è®¿é—®äº’è”ç½‘çš„æœåŠ¡å™¨ï¼Œåœ¨ä¸Šé¢æŠŠå®ƒ pull ä¸‹æ¥ï¼Œç„¶å save æˆ tar åŒ…ä¼ å›æœ¬åœ°å† docker load è¿›é•œåƒğŸ˜‚ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">k8s.gcr.io/kube-apiserver:v1.17.4</span><br><span class="line">k8s.gcr.io/kube-controller-manager:v1.17.4</span><br><span class="line">k8s.gcr.io/kube-scheduler:v1.17.4</span><br><span class="line">k8s.gcr.io/kube-proxy:v1.17.4</span><br><span class="line">k8s.gcr.io/pause:3.1</span><br><span class="line">k8s.gcr.io/etcd:3.4.3-0</span><br><span class="line">k8s.gcr.io/coredns:1.6.5</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä½¿ç”¨ kubeadm pull ç›¸å…³é•œåƒæ—¶ï¼Œkubeadm çš„ç‰ˆæœ¬æœ€å¥½å’Œ â€“kubernetes-version=${version} ç‰ˆæœ¬ä¸€è‡´ï¼Œä¸ä¸€è‡´çš„è¯æœ‰äº›ç‰ˆæœ¬çš„é•œåƒæ˜¯ pull ä¸ä¸‹æ¥çš„ã€‚å¯¹åº”ç‰ˆæœ¬çš„ kubenetes è¦ä½¿ç”¨å¯¹åº”ç‰ˆæœ¬çš„é•œåƒæ‰å¯ä»¥ã€‚å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è„šæœ¬åœ¨å¯ä»¥è‡ªç”±è®¿é—®äº’è”ç½‘çš„æœåŠ¡å™¨ä¸Šå°† pull æŒ‡å®šç‰ˆæœ¬çš„é•œåƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span>: use kubeadm pull kubernetes images</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> date: 2019-08-15</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> author: muzi502</span></span><br><span class="line"></span><br><span class="line">set -xue</span><br><span class="line">apt-get update &amp;&amp; apt-get install -y apt-transport-https curl</span><br><span class="line">curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -</span><br><span class="line">cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span><br><span class="line">deb https://apt.kubernetes.io/ kubernetes-xenial main</span><br><span class="line">EOF</span><br><span class="line">apt-get update</span><br><span class="line"></span><br><span class="line">for version in 1.17.4</span><br><span class="line">do</span><br><span class="line">    apt install kubeadm=$&#123;version&#125;-00</span><br><span class="line">    mkdir -p $&#123;version&#125;/bin</span><br><span class="line">    docker rmi $(docker images -q)</span><br><span class="line">    kubeadm config images pull --kubernetes-version=$&#123;version&#125;</span><br><span class="line">    docker save -o v$&#123;version&#125;.tar $(docker images | grep -v TAG | cut -d ' ' -f1)</span><br><span class="line">    gzip v$&#123;version&#125;.tar v$&#123;version&#125;.tar.gz</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>å¯¼å…¥ä¹‹åçš„é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# docker load &lt; v1.17.4.tar.gz</span><br><span class="line">fc4976bd934b: Loading layer [=============&gt;]  53.88MB/53.88MB</span><br><span class="line">f6953727aaba: Loading layer [=============&gt;]   42.1MB/42.1MB</span><br><span class="line">Loaded image: k8s.gcr.io/kube-scheduler:v1.17.4</span><br><span class="line">225df95e717c: Loading layer [=============&gt;]  336.4kB/336.4kB</span><br><span class="line">7c9b0f448297: Loading layer [=============&gt;]  41.37MB/41.37MB</span><br><span class="line">Loaded image: k8s.gcr.io/coredns:1.6.5</span><br><span class="line">fe9a8b4f1dcc: Loading layer [=============&gt;]  43.87MB/43.87MB</span><br><span class="line">ce04b89b7def: Loading layer [=============&gt;]  224.9MB/224.9MB</span><br><span class="line">1b2bc745b46f: Loading layer [=============&gt;]  21.22MB/21.22MB</span><br><span class="line">Loaded image: k8s.gcr.io/etcd:3.4.3-0</span><br><span class="line">e17133b79956: Loading layer [=============&gt;]  744.4kB/744.4kB</span><br><span class="line">Loaded image: k8s.gcr.io/pause:3.1</span><br><span class="line">682fbb19de80: Loading layer [=============&gt;]  21.06MB/21.06MB</span><br><span class="line">2dc2f2423ad1: Loading layer [=============&gt;]  5.168MB/5.168MB</span><br><span class="line">ad9fb2411669: Loading layer [=============&gt;]  4.608kB/4.608kB</span><br><span class="line">597151d24476: Loading layer [=============&gt;]  8.192kB/8.192kB</span><br><span class="line">0d8d54147a3a: Loading layer [=============&gt;]  8.704kB/8.704kB</span><br><span class="line">960d0ce862e2: Loading layer [=============&gt;]  37.81MB/37.81MB</span><br><span class="line">Loaded image: k8s.gcr.io/kube-proxy:v1.17.4</span><br><span class="line">9daac3fed755: Loading layer [=============&gt;]  118.7MB/118.7MB</span><br><span class="line">Loaded image: k8s.gcr.io/kube-apiserver:v1.17.4</span><br><span class="line">99df54617e88: Loading layer [=============&gt;]  108.6MB/108.6MB</span><br><span class="line">Loaded image: k8s.gcr.io/kube-controller-manager:v1.17.4</span><br><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# docker images</span><br><span class="line">REPOSITORY                           TAG                 CREATED             SIZE</span><br><span class="line">k8s.gcr.io/kube-proxy                v1.17.4             4 weeks ago         116MB</span><br><span class="line">k8s.gcr.io/kube-controller-manager   v1.17.4             4 weeks ago         161MB</span><br><span class="line">k8s.gcr.io/kube-apiserver            v1.17.4             4 weeks ago         171MB</span><br><span class="line">k8s.gcr.io/kube-scheduler            v1.17.4             4 weeks ago         94.4MB</span><br><span class="line">k8s.gcr.io/coredns                   1.6.5               5 months ago        41.6MB</span><br><span class="line">k8s.gcr.io/etcd                      3.4.3-0             5 months ago        288MB</span><br><span class="line">k8s.gcr.io/pause                     3.1                 2 years ago         742kB</span><br></pre></td></tr></table></figure><h3 id="åˆå§‹åŒ–-master-èŠ‚ç‚¹"><a href="#åˆå§‹åŒ–-master-èŠ‚ç‚¹" class="headerlink" title="åˆå§‹åŒ– master èŠ‚ç‚¹"></a>åˆå§‹åŒ– master èŠ‚ç‚¹</h3><p>ä½¿ç”¨ kubeadm init å‘½ä»¤åˆå§‹åŒ– master èŠ‚ç‚¹ï¼Œå…³äº kubeadm çš„å‚æ•°å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ <a href="https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/kubeadm-init/" target="_blank" rel="noopener">kubeadm init</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=10.20.172.211 --kubernetes-version=1.17.4</span><br></pre></td></tr></table></figure><ul><li>â€“pod-network-cidr= æŒ‡å®š Pod ç½‘æ®µçš„ IP åœ°å€å—</li><li>â€“apiserver-advertise-address= æŒ‡å®š api-server ç›‘å¬çš„åœ°å€</li><li>â€“kubernetes-version= æŒ‡å®š kubernetes çš„ç‰ˆæœ¬ï¼Œæœ€å¥½å’Œ kubeadm ç‰ˆæœ¬ä¿æŒä¸€è‡´</li></ul><p>æ­£å¸¸å®Œæˆä¹‹åçš„æ—¥å¿—è¾“å‡ºå¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=10.20.172.211 --kubernetes-version=1.17.4</span><br><span class="line"></span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  mkdir -p $HOME/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">Then you can join any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm join 10.20.172.211:6443 --token hi66lb.r13y2hottst2ks6f \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:9b96a436f2897a8371fccb3af4d8f2fff348fcb42763e005e9175a4e925c51d1</span><br></pre></td></tr></table></figure><p>åˆšåˆšå®‰è£…å®Œä¹‹å coreDNS çš„ Pod ä¼šä¸€ç›´å‡ºäº pending çŠ¶æ€ï¼Œè€Œä¸” Master çš„ STATUS çŠ¶æ€ä¹Ÿæ˜¯ <code>NotReady</code> ã€‚é‡åˆ°è¿™ç§é—®é¢˜<code>ä¸è¦æ…Œ,é—®é¢˜ä¸å¤§.jpg</code> è¿™æ˜¯å› ä¸ºé›†ç¾¤ä¸­è¿˜æ²¡æœ‰å®‰è£…å¥½ CNI ç½‘ç»œæ’ä»¶ï¼Œç­‰ä¸‹éƒ¨ç½²å¥½ flannel å°±å¯ä»¥ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl get node</span><br><span class="line">NAME            STATUS     ROLES    AGE     VERSION</span><br><span class="line">k8s-master-01   NotReady   master   9m19s   v1.17.4</span><br><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl get pod --all-namespaces</span><br><span class="line">NAMESPACE     NAME                                    READY   STATUS    RESTARTS   AGE</span><br><span class="line">kube-system   coredns-6955765f44-t4b6k                0/1     Pending   0          49s</span><br><span class="line">kube-system   coredns-6955765f44-vm5tm                0/1     Pending   0          49s</span><br><span class="line">kube-system   etcd-k8s-master-01                      1/1     Running   0          62s</span><br><span class="line">kube-system   kube-apiserver-k8s-master-01            1/1     Running   0          62s</span><br><span class="line">kube-system   kube-controller-manager-k8s-master-01   1/1     Running   0          62s</span><br><span class="line">kube-system   kube-proxy-rmgwl                        1/1     Running   0          49s</span><br><span class="line">kube-system   kube-scheduler-k8s-master-01            1/1     Running   0          62s</span><br></pre></td></tr></table></figure><h2 id="åŠ å…¥-node-èŠ‚ç‚¹"><a href="#åŠ å…¥-node-èŠ‚ç‚¹" class="headerlink" title="åŠ å…¥ node èŠ‚ç‚¹"></a>åŠ å…¥ node èŠ‚ç‚¹</h2><p>åœ¨å¦ä¸€å° Node èŠ‚ç‚¹ä¸Šé‡å¤èŠ‚ç‚¹åˆå§‹åŒ–çš„å†…å®¹ï¼Œå¹¶å°†å°†æ‰€éœ€çš„é•œåƒå¯¼å…¥åˆ° node èŠ‚ç‚¹ã€‚ä¹‹åä½¿ç”¨ kubeadm joine å‘½ä»¤å°† Node èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­å³å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-node-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubeadm join 10.20.172.211:6443 --token hi66lb.r13y2hottst2ks6f \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">     --discovery-token-ca-cert-hash sha256:9b96a436f2897a8371fccb3af4d8f2fff348fcb42763e005e9175a4e925c51d1</span></span><br><span class="line">W0415 00:52:08.127829    9901 join.go:346] [preflight] WARNING: JoinControlPane.controlPlane settings will be ignored when control-plane flag is not set.</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">        [WARNING Hostname]: hostname "k8s-node-01" could not be reached</span><br><span class="line">        [WARNING Hostname]: hostname "k8s-node-01": lookup k8s-node-01 on 192.168.10.254:53: no such host</span><br><span class="line">        [WARNING Service-Kubelet]: kubelet service is not enabled, please run 'systemctl enable kubelet.service'</span><br><span class="line">[preflight] Reading configuration from the cluster...</span><br><span class="line">[preflight] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml'</span><br><span class="line">[kubelet-start] Downloading configuration for the kubelet from the "kubelet-config-1.17" ConfigMap in the kube-system namespace</span><br><span class="line">[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"</span><br><span class="line">[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"</span><br><span class="line">[kubelet-start] Starting the kubelet</span><br><span class="line">[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...</span><br><span class="line"></span><br><span class="line">This node has joined the cluster:</span><br><span class="line">* Certificate signing request was sent to apiserver and a response was received.</span><br><span class="line">* The Kubelet was informed of the new secure connection details.</span><br><span class="line"></span><br><span class="line">Run 'kubectl get nodes' on the control-plane to see this node join the cluster.</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸å‡ºæ„å¤–çš„è¯ä¼šæç¤º <code>This node has joined the cluster:</code> ï¼Œç„¶ååœ¨ master èŠ‚ç‚¹çœ‹ä¸€ä¸‹èŠ‚ç‚¹æ˜¯å¦åŠ å…¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl get node</span><br><span class="line">NAME            STATUS     ROLES    AGE   VERSION</span><br><span class="line">k8s-master-01   NotReady   master   31m   v1.17.4</span><br><span class="line">k8s-node-01     NotReady   &lt;none&gt;   58s   v1.17.4</span><br></pre></td></tr></table></figure><p>å¦‚æœçŠ¶æ€è¿˜æ˜¯ <code>NotReady</code> ä¸è¦æ…Œï¼Œé—®é¢˜ä¸å¤§ï¼‰ã€‚æ¥ä¸‹æ¥å®‰è£… CNI ç½‘ç»œæ’ä»¶å³å¯</p><h2 id="éƒ¨ç½²ç½‘ç»œæ’ä»¶"><a href="#éƒ¨ç½²ç½‘ç»œæ’ä»¶" class="headerlink" title="éƒ¨ç½²ç½‘ç»œæ’ä»¶"></a>éƒ¨ç½²ç½‘ç»œæ’ä»¶</h2><p>åœ¨è¿™æˆ‘ä»¬ä½¿ç”¨ flannel ä½œä¸º Kubernetes ç½‘ç»œè§£å†³æ–¹æ¡ˆï¼Œåœ¨ kubeadm init çš„æ—¶å€™æŒ‡å®šçš„ â€“pod-network-cidr= æŒ‡å®š Pod ç½‘æ®µçš„ IP åœ°å€å—ï¼Œå³ä¸º flannel é»˜è®¤çš„ IP æ®µï¼Œå¦‚æœæ²¡æœ‰ä¿®æ”¹çš„è¯å°±ç›´æ¥åœ¨ master èŠ‚ç‚¹ä¸Šä½¿ç”¨ kubectl apply -f å‘½ä»¤éƒ¨ç½²å³å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure><p>ç”±äºå¢™å›½ç½‘ç»œåŸå› ï¼Œè®¿é—® <code>raw.githubusercontent.com</code> è¿™ä¸ªåŸŸåä¼šæ¯”è¾ƒæ…¢ï¼Œåœ¨è¿™é‡Œå¯ä»¥ä½¿ç”¨ jsdelivr æ¥è¿›è¡ŒåŠ é€Ÿã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl apply -f https://cdn.jsdelivr.net/gh/coreos/flannel/Documentation/kube-flannel.yml</span><br><span class="line">podsecuritypolicy.policy/psp.flannel.unprivileged created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/flannel created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/flannel created</span><br><span class="line">serviceaccount/flannel created</span><br><span class="line">configmap/kube-flannel-cfg created</span><br><span class="line">daemonset.apps/kube-flannel-ds-amd64 created</span><br><span class="line">daemonset.apps/kube-flannel-ds-arm64 created</span><br><span class="line">daemonset.apps/kube-flannel-ds-arm created</span><br><span class="line">daemonset.apps/kube-flannel-ds-ppc64le created</span><br><span class="line">daemonset.apps/kube-flannel-ds-s390x created</span><br></pre></td></tr></table></figure><p>flannel çš„ docker é•œåƒæ˜¯åœ¨ <code>quay.io/coreos/flannel</code> ä¸€èˆ¬æƒ…å†µä¸‹æ²¡é—®é¢˜èƒ½é¡ºåˆ© pull ä¸‹æ¥ã€‚ç„¶åä½¿ç”¨ <code>kubectl get pod -n kube-system</code> å‘½ä»¤æŸ¥çœ‹ pod çš„çŠ¶æ€æ˜¯ä¸æ˜¯éƒ½åœ¨ running çŠ¶æ€ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl get pod -n kube-system</span><br><span class="line">NAME                                    READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-6955765f44-g5fwl                1/1     Running   0          23h</span><br><span class="line">coredns-6955765f44-g7cls                1/1     Running   0          23h</span><br><span class="line">etcd-k8s-master-01                      1/1     Running   0          24h</span><br><span class="line">kube-apiserver-k8s-master-01            1/1     Running   0          24h</span><br><span class="line">kube-controller-manager-k8s-master-01   1/1     Running   0          24h</span><br><span class="line">kube-flannel-ds-amd64-94hfr             1/1     Running   0          23h</span><br><span class="line">kube-flannel-ds-amd64-vpdfd             1/1     Running   0          23h</span><br><span class="line">kube-proxy-rmgwl                        1/1     Running   0          24h</span><br><span class="line">kube-proxy-xqcsq                        1/1     Running   0          24h</span><br><span class="line">kube-scheduler-k8s-master-01            1/1     Running   0          24h</span><br><span class="line"></span><br><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl get node</span><br><span class="line">NAME            STATUS   ROLES    AGE   VERSION</span><br><span class="line">k8s-master-01   Ready    master   29h   v1.17.4</span><br><span class="line">k8s-node-01     Ready    &lt;none&gt;   28h   v1.17.4</span><br></pre></td></tr></table></figure><p>ç”±æ­¤ï¼Œä¸€ä¸ªç®€é™‹çš„ kubernetes é›†ç¾¤å·²ç»éƒ¨ç½²å®Œäº†ğŸ˜‚ï¼Œæ–‡ç« æœ‰ç‚¹æ°´äº†~~ã€‚å¯¹äºæƒ³è¦å…¥é—¨å’Œå­¦ä¹  kubernetes çš„åŒå­¦æ¥è¯´ kubeadm æ˜¯ä¸ªå¥½å·¥å…·ã€‚åç»­ä¼šæ›´æ–°ä¸€äº› kubernetes å†…å®¹ã€‚</p><h2 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h2><p>æœ€åæä¸€ä¸‹ï¼Œæ–‡ä¸­æåˆ°çš„å¯¹äºä¸‹è½½ github ä¸Šæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹è§„åˆ™è¿›è¡Œæ›¿æ¢ï¼Œå°±å¯ä»¥ä½¿ç”¨ jsdelivr æ¥ fuck ä¸€ä¸‹ GFW ï¼Œæ— ç—›ä¸‹è½½ GitHub ä¸Šçš„æ–‡ä»¶ã€‚è¿™è¿˜æ˜¯ä» <a href="https://chanshiyu.com/#/post/94" target="_blank" rel="noopener">JsDelivr å…¨ç«™æ‰˜ç®¡</a> å­¦æ¥çš„éªšæ“ä½œğŸ˜‚ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">GitHub rul:</span> <span class="string">https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh</span></span><br><span class="line"><span class="attr">jsDelivr url:</span> <span class="string">https://cdn.jsdelivr.net/gh/ohmyzsh/ohmyzsh/tools/install.sh</span></span><br></pre></td></tr></table></figure><p>è§„åˆ™å°±æ˜¯å°† <code>github.com</code> æ›¿æ¢ä¸º <code>cdn.jsdelivr.net/gh</code> ï¼Œç„¶åå»æ‰ <code>/blob/master</code>ï¼Œæ¥ä¸Š repo é‡Œæ–‡ä»¶çš„ç»å¯¹è·¯å¾„å³å¯ã€‚ä¹Ÿå¯ä»¥å°†ä»¥ä¸‹è„šæœ¬ä¿å­˜ä¸ºä¸€ä¸ªå¯æ‰§è¡Œè„šæœ¬æ–‡ä»¶ /usr/bin/rawgï¼Œå½“ä½¿ç”¨ rawg <a href="https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh" target="_blank" rel="noopener">https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh</a> å°±å¯ä»¥ç›´æ¥å°† url è¿›è¡Œæ›¿æ¢ï¼Œå¿«é€Ÿåœ°ä¸‹è½½æ–‡ä»¶ã€‚æ€ä¹ˆæ ·ï¼Œå¾ˆçˆ½å§ğŸ˜‚ï¼Œå¯¹äºæŸäº› Linux æœºå™¨ä¸Šæ²¡æœ‰ä»£ç†çš„æƒ…å†µä¸‹è¯¥æ–¹æ³•æœ‰æ•ˆã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> data: 2020-03-31</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> author: muzi502</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span>: Fuck GFW and download some raw file form github without proxy using jsDelivr CDN</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> usage: save the .she to your <span class="built_in">local</span> such as /usr/bin/rawg, and chmod +x /usr/bin/rawg</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> use rawg https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh to download</span></span><br><span class="line"></span><br><span class="line">set -xue</span><br><span class="line"><span class="meta">#</span><span class="bash"> GitHub rul: https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> jsDelivr url: https://cdn.jsdelivr.net/gh/ohmyzsh/ohmyzsh/tools/install.sh</span></span><br><span class="line"></span><br><span class="line">wget $(echo $1 | sed 's/raw.githubusercontent.com/cdn.jsdelivr.net\/gh/' \</span><br><span class="line">               | sed 's/github.com/cdn.jsdelivr.net\/gh/' \</span><br><span class="line">               | sed 's/\/master//' | sed 's/\/blob//' )</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> curl $(<span class="built_in">echo</span> <span class="variable">$1</span> | sed <span class="string">'s/raw.githubusercontent.com/cdn.jsdelivr.net\/gh/'</span> \</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                | sed <span class="string">'s/github.com/cdn.jsdelivr.net\/gh/'</span> \</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                | sed <span class="string">'s/\/master//'</span> | sed <span class="string">'s/\/blob//'</span> )</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;ç‚’å†·é¥­&quot;&gt;&lt;a href=&quot;#ç‚’å†·é¥­&quot;
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="kubernetes" scheme="https://blog.k8s.li/tags/kubernetes/"/>
    
      <category term="kubeadm" scheme="https://blog.k8s.li/tags/kubeadm/"/>
    
      <category term="ä»é›¶å¼€å§‹å­¦ä¹  K8s" scheme="https://blog.k8s.li/tags/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%AD%A6%E4%B9%A0-K8s/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäº Gitlab-ci + Harobr çš„ CI æµæ°´çº¿</title>
    <link href="https://blog.k8s.li/gitlab-ci-harbor.html"/>
    <id>https://blog.k8s.li/gitlab-ci-harbor.html</id>
    <published>2020-04-11T16:00:00.000Z</published>
    <updated>2020-04-11T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¯¹äº CI/CDï¼ˆæŒç»­é›†æˆä¸æŒç»­äº¤ä»˜ï¼‰çš„åŸºæœ¬æ¦‚å¿µç½‘ç»œä¸Šå·²ç»æœ‰å¾ˆå¤šå¤§ä½¬åœ¨æ™®åŠå•¦ï¼Œå’±æ‰ç–å­¦æµ…æ€•è¯¯äººå­å¼Ÿæ‰€ä»¥å°±å‰½çªƒä¸€ä¸‹åˆ«äººçš„è§£é‡Šå•¦ğŸ˜‚ã€‚ä¸‹é¢å°±å‰½çªƒä¸€ä¸‹çº¢å¸½å­å®¶çš„ <a href="https://www.redhat.com/zh/topics/devops/what-is-ci-cd" target="_blank" rel="noopener">CI/CDæ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ç†è§£æŒç»­é›†æˆã€æŒç»­äº¤ä»˜å’ŒæŒç»­éƒ¨ç½²</a> å®˜æ–¹æ–‡æ¡£ï¼š</p><p><strong>CI æŒç»­é›†æˆ</strong></p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/source/img/409-images-for-snap-blog-postedit_image1.png" alt="Continuous integration puts the integration phase earlier in the development cycle"></p><p>å›¾ç‰‡å‰½çªƒè‡ª  <a href="https://www.mindtheproduct.com/what-the-hell-are-ci-cd-and-devops-a-cheatsheet-for-the-rest-of-us/" target="_blank" rel="noopener">The Product Managersâ€™ Guide to Continuous Delivery and DevOps</a></p><blockquote><p>CI/CD ä¸­çš„â€œCIâ€å§‹ç»ˆæŒ‡æŒç»­é›†æˆï¼Œå®ƒå±äºå¼€å‘äººå‘˜çš„è‡ªåŠ¨åŒ–æµç¨‹ã€‚æˆåŠŸçš„ CI æ„å‘³ç€åº”ç”¨ä»£ç çš„æ–°æ›´æ”¹ä¼šå®šæœŸæ„å»ºã€æµ‹è¯•å¹¶åˆå¹¶åˆ°å…±äº«å­˜å‚¨åº“ä¸­ã€‚è¯¥è§£å†³æ–¹æ¡ˆå¯ä»¥è§£å†³åœ¨ä¸€æ¬¡å¼€å‘ä¸­æœ‰å¤ªå¤šåº”ç”¨åˆ†æ”¯ï¼Œä»è€Œå¯¼è‡´ç›¸äº’å†²çªçš„é—®é¢˜ã€‚</p></blockquote><p><strong>CD æŒç»­äº¤ä»˜</strong></p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/source/img/409-images-for-snap-blog-postedit_image4-manual.png" alt="Continuous Delivery is a software development discipline "></p><p>å›¾ç‰‡å‰½çªƒè‡ª <a href="https://www.mindtheproduct.com/what-the-hell-are-ci-cd-and-devops-a-cheatsheet-for-the-rest-of-us/" target="_blank" rel="noopener">The Product Managersâ€™ Guide to Continuous Delivery and DevOps</a></p><blockquote><p>CI/CD ä¸­çš„â€œCDâ€æŒ‡çš„æ˜¯æŒç»­äº¤ä»˜å’Œ/æˆ–æŒç»­éƒ¨ç½²ï¼Œè¿™äº›ç›¸å…³æ¦‚å¿µæœ‰æ—¶ä¼šäº¤å‰ä½¿ç”¨ã€‚ä¸¤è€…éƒ½äº‹å…³ç®¡é“åç»­é˜¶æ®µçš„è‡ªåŠ¨åŒ–ï¼Œä½†å®ƒä»¬æœ‰æ—¶ä¹Ÿä¼šå•ç‹¬ä½¿ç”¨ï¼Œç”¨äºè¯´æ˜è‡ªåŠ¨åŒ–ç¨‹åº¦ã€‚</p><p>æŒç»­<em>äº¤ä»˜</em>é€šå¸¸æ˜¯æŒ‡å¼€å‘äººå‘˜å¯¹åº”ç”¨çš„æ›´æ”¹ä¼šè‡ªåŠ¨è¿›è¡Œé”™è¯¯æµ‹è¯•å¹¶ä¸Šä¼ åˆ°å­˜å‚¨åº“ï¼ˆå¦‚ <a href="https://redhatofficial.github.io/#!/main" target="_blank" rel="noopener">GitHub</a> æˆ–å®¹å™¨æ³¨å†Œè¡¨ï¼‰ï¼Œç„¶åç”±è¿ç»´å›¢é˜Ÿå°†å…¶éƒ¨ç½²åˆ°å®æ—¶ç”Ÿäº§ç¯å¢ƒä¸­ã€‚è¿™æ—¨åœ¨è§£å†³å¼€å‘å’Œè¿ç»´å›¢é˜Ÿä¹‹é—´å¯è§æ€§åŠæ²Ÿé€šè¾ƒå·®çš„é—®é¢˜ã€‚å› æ­¤ï¼ŒæŒç»­äº¤ä»˜çš„ç›®çš„å°±æ˜¯ç¡®ä¿å°½å¯èƒ½å‡å°‘éƒ¨ç½²æ–°ä»£ç æ—¶æ‰€éœ€çš„å·¥ä½œé‡ã€‚</p></blockquote><p><strong>æŒç»­éƒ¨ç½²</strong></p><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/source/img/409-images-for-snap-blog-postedit_image4-manual-1585574252795.png" alt="Continuous Delivery is a software development discipline "></p><p>å›¾ç‰‡å‰½çªƒè‡ª  <a href="https://www.mindtheproduct.com/what-the-hell-are-ci-cd-and-devops-a-cheatsheet-for-the-rest-of-us/" target="_blank" rel="noopener">The Product Managersâ€™ Guide to Continuous Delivery and DevOps</a></p><blockquote><p>æŒç»­<em>éƒ¨ç½²</em>ï¼ˆå¦ä¸€ç§â€œCDâ€ï¼‰æŒ‡çš„æ˜¯è‡ªåŠ¨å°†å¼€å‘äººå‘˜çš„æ›´æ”¹ä»å­˜å‚¨åº“å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼Œä»¥ä¾›å®¢æˆ·ä½¿ç”¨ã€‚å®ƒä¸»è¦ä¸ºäº†è§£å†³å› æ‰‹åŠ¨æµç¨‹é™ä½åº”ç”¨äº¤ä»˜é€Ÿåº¦ï¼Œä»è€Œä½¿è¿ç»´å›¢é˜Ÿè¶…è´Ÿè·çš„é—®é¢˜ã€‚æŒç»­éƒ¨ç½²ä»¥æŒç»­äº¤ä»˜çš„ä¼˜åŠ¿ä¸ºæ ¹åŸºï¼Œå®ç°äº†ç®¡é“åç»­é˜¶æ®µçš„è‡ªåŠ¨åŒ–ã€‚</p></blockquote><p>æ€»ä¹‹è€Œè¨€  CI/CD æ˜¯ä¸€æ•´å¥—è½¯ä»¶å¼€å‘çš„æµæ°´çº¿ï¼Œå¼€å‘äººå‘˜æäº¤å®Œæ›´æ–°çš„ä»£ç ä¹‹åï¼Œæ ¹æ®æµæ°´çº¿çš„è§¦å‘æƒ…å†µæ¥æ‰§è¡Œè‡ªå®šä¹‰çš„æµæ°´çº¿ä»»åŠ¡ï¼Œæ¯”å¦‚ä»£ç è´¨é‡æ£€æµ‹ã€æ„å»º docker é•œåƒä¸ºäº¤ä»˜äº§å“ã€è‡ªåŠ¨åŒ–éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒæˆ–ç”Ÿäº§ç¯å¢ƒç­‰ç­‰ã€‚è¿™äº›éœ€è¦ä¸€ç³»åˆ—ç›¸å…³çš„è½¯ä»¶æ¥æ„å»ºè¿™å¥— CI/CD çš„ç³»ç»Ÿï¼Œæœ¬æ–‡å°±é€šè¿‡ Gitlab + gitlab-ci + Harbor æ„å»ºä¸€ä¸ªç®€é™‹çš„ CI/CD æµæ°´çº¿ã€‚</p><p>å¦å¤–æ¨èè¯»ä¸€ä¸‹è¿™ç¯‡ <a href="https://www.mindtheproduct.com/what-the-hell-are-ci-cd-and-devops-a-cheatsheet-for-the-rest-of-us/" target="_blank" rel="noopener">The Product Managersâ€™ Guide to Continuous Delivery and DevOps </a></p><h2 id="Gitlab"><a href="#Gitlab" class="headerlink" title="Gitlab"></a>Gitlab</h2><p>ç›®å‰ Gitlab å®˜æ–¹ç»™å‡ºçš„å®‰è£…æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œæ™®éé‡‡ç”¨ Omnibus åŒ…ã€Docker å®‰è£…ã€‚ä¹Ÿå¯ä»¥ç”¨å®˜æ–¹çš„ helm Chart éƒ¨ç½²åœ¨ Kubernenets é›†ç¾¤ä¸­ï¼Œç„¶åä½¿ç”¨ç½‘ç»œå­˜å‚¨ï¼Œæ¯”å¦‚ Glusterã€NFSã€Cephã€vSAN ç­‰è¿›è¡Œ PG æ•°æ®åº“å’Œä»£ç ä»“åº“æŒä¹…åŒ–å­˜å‚¨ã€‚</p><p><strong>å®˜æ–¹å»ºè®®é‡‡ç”¨ Omnibus æ–¹å¼å®‰è£…ï¼š</strong></p><blockquote><p>æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½¿ç”¨ Omnibus åŒ…å®‰è£… GitLab ï¼Œå› ä¸ºå®ƒå®‰è£…èµ·æ¥æ›´å¿«ã€æ›´å®¹æ˜“å‡çº§ç‰ˆæœ¬ï¼Œè€Œä¸”åŒ…å«äº†å…¶ä»–å®‰è£…æ–¹å¼æ‰€æ²¡æœ‰çš„å¯é æ€§åŠŸèƒ½ã€‚</p></blockquote><h3 id="Omnibus-åŒ…å®‰è£…æ–¹å¼æ¯”è¾ƒ"><a href="#Omnibus-åŒ…å®‰è£…æ–¹å¼æ¯”è¾ƒ" class="headerlink" title="Omnibus åŒ…å®‰è£…æ–¹å¼æ¯”è¾ƒ"></a>Omnibus åŒ…å®‰è£…æ–¹å¼æ¯”è¾ƒ</h3><p>æ‘˜è‡ªå®˜æ–¹æ–‡æ¡£</p><ul><li>âœ… - Installed by default</li><li>âš™ - Requires additional configuration, or GitLab Managed Apps</li><li>â¤“ - Manual installation required</li><li>âŒ - Not supported or no instructions available</li><li>N/A - Not applicable</li></ul><table><thead><tr><th align="left">Component</th><th align="left">Description</th><th align="center"><a href="https://docs.gitlab.com/omnibus/" target="_blank" rel="noopener">Omnibus GitLab</a></th><th align="center"><a href="https://docs.gitlab.com/charts/" target="_blank" rel="noopener">GitLab chart</a></th><th align="center"><a href="https://gitlab.com/" target="_blank" rel="noopener">GitLab.com</a></th></tr></thead><tbody><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#nginx" target="_blank" rel="noopener">NGINX</a></td><td align="left">Routes requests to appropriate components, terminates SSL</td><td align="center"><a href="https://docs.gitlab.com/omnibus/settings/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/nginx/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#service-architecture" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#unicorn" target="_blank" rel="noopener">Unicorn (GitLab Rails)</a></td><td align="left">Handles requests for the web interface and API</td><td align="center"><a href="https://docs.gitlab.com/omnibus/settings/unicorn.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/unicorn/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#unicorn" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#sidekiq" target="_blank" rel="noopener">Sidekiq</a></td><td align="left">Background jobs processor</td><td align="center"><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-config-template/gitlab.rb.template" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/sidekiq/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#sidekiq" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitaly" target="_blank" rel="noopener">Gitaly</a></td><td align="left">Git RPC service for handling all Git calls made by GitLab</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/gitaly/index.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/gitaly/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#service-architecture" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#praefect" target="_blank" rel="noopener">Praefect</a></td><td align="left">A transparent proxy between any Git client and Gitaly storage nodes.</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/gitaly/index.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/gitaly/" target="_blank" rel="noopener">âŒ</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#service-architecture" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-workhorse" target="_blank" rel="noopener">GitLab Workhorse</a></td><td align="left">Smart reverse proxy, handles large HTTP requests</td><td align="center"><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-config-template/gitlab.rb.template" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/unicorn/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#service-architecture" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-shell" target="_blank" rel="noopener">GitLab Shell</a></td><td align="left">Handles <code>git</code> over SSH sessions</td><td align="center"><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-config-template/gitlab.rb.template" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/gitlab-shell/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#service-architecture" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-pages" target="_blank" rel="noopener">GitLab Pages</a></td><td align="left">Hosts static websites</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/pages/index.html" target="_blank" rel="noopener">âš™</a></td><td align="center"><a href="https://gitlab.com/gitlab-org/charts/gitlab/issues/37" target="_blank" rel="noopener">âŒ</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#gitlab-pages" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#registry" target="_blank" rel="noopener">Registry</a></td><td align="left">Container registry, allows pushing and pulling of images</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/packages/container_registry.html#container-registry-domain-configuration" target="_blank" rel="noopener">âš™</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/registry/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/packages/container_registry/index.html#build-and-push-images-using-gitlab-cicd" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#redis" target="_blank" rel="noopener">Redis</a></td><td align="left">Caching service</td><td align="center"><a href="https://docs.gitlab.com/omnibus/settings/redis.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/omnibus/settings/redis.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#service-architecture" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#postgresql" target="_blank" rel="noopener">PostgreSQL</a></td><td align="left">Database</td><td align="center"><a href="https://docs.gitlab.com/omnibus/settings/database.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://github.com/helm/charts/tree/master/stable/postgresql" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#postgresql" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#pgbouncer" target="_blank" rel="noopener">PgBouncer</a></td><td align="left">Database connection pooling, failover</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/high_availability/pgbouncer.html" target="_blank" rel="noopener">âš™</a></td><td align="center"><a href="https://docs.gitlab.com/charts/installation/deployment.html#postgresql" target="_blank" rel="noopener">âŒ</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#database-architecture" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#consul" target="_blank" rel="noopener">Consul</a></td><td align="left">Database node discovery, failover</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/high_availability/consul.html" target="_blank" rel="noopener">âš™</a></td><td align="center"><a href="https://docs.gitlab.com/charts/installation/deployment.html#postgresql" target="_blank" rel="noopener">âŒ</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#consul" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#prometheus" target="_blank" rel="noopener">GitLab self-monitoring: Prometheus</a></td><td align="left">Time-series database, metrics collection, and query service</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/prometheus/index.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://github.com/helm/charts/tree/master/stable/prometheus" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#prometheus" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#alertmanager" target="_blank" rel="noopener">GitLab self-monitoring: Alertmanager</a></td><td align="left">Deduplicates, groups, and routes alerts from Prometheus</td><td align="center"><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-config-template/gitlab.rb.template" target="_blank" rel="noopener">âš™</a></td><td align="center"><a href="https://github.com/helm/charts/tree/master/stable/prometheus" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/monitoring/" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#grafana" target="_blank" rel="noopener">GitLab self-monitoring: Grafana</a></td><td align="left">Metrics dashboard</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/performance/grafana_configuration.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://github.com/helm/charts/tree/master/stable/grafana" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://dashboards.gitlab.com/d/RZmbBr7mk/gitlab-triage?refresh=30s" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#sentry" target="_blank" rel="noopener">GitLab self-monitoring: Sentry</a></td><td align="left">Track errors generated by the GitLab instance</td><td align="center"><a href="https://docs.gitlab.com/omnibus/settings/configuration.html#error-reporting-and-logging-with-sentry" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://gitlab.com/gitlab-org/charts/gitlab/issues/1319" target="_blank" rel="noopener">âŒ</a></td><td align="center"><a href="https://about.gitlab.com/handbook/support/workflows/500_errors.html#searching-sentry" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#jaeger" target="_blank" rel="noopener">GitLab self-monitoring: Jaeger</a></td><td align="left">View traces generated by the GitLab instance</td><td align="center"><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/issues/4104" target="_blank" rel="noopener">âŒ</a></td><td align="center"><a href="https://gitlab.com/gitlab-org/charts/gitlab/issues/1320" target="_blank" rel="noopener">âŒ</a></td><td align="center"><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/issues/4104" target="_blank" rel="noopener">âŒ</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#redis-exporter" target="_blank" rel="noopener">Redis Exporter</a></td><td align="left">Prometheus endpoint with Redis metrics</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/prometheus/redis_exporter.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/redis/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/monitoring/" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#postgresql-exporter" target="_blank" rel="noopener">PostgreSQL Exporter</a></td><td align="left">Prometheus endpoint with PostgreSQL metrics</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/prometheus/postgres_exporter.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://github.com/helm/charts/tree/master/stable/postgresql" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/monitoring/" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#pgbouncer-exporter" target="_blank" rel="noopener">PgBouncer Exporter</a></td><td align="left">Prometheus endpoint with PgBouncer metrics</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/prometheus/pgbouncer_exporter.html" target="_blank" rel="noopener">âš™</a></td><td align="center"><a href="https://docs.gitlab.com/charts/installation/deployment.html#postgresql" target="_blank" rel="noopener">âŒ</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/monitoring/" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-exporter" target="_blank" rel="noopener">GitLab Exporter</a></td><td align="left">Generates a variety of GitLab metrics</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/prometheus/gitlab_exporter.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/gitlab-exporter/index.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/monitoring/" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#node-exporter" target="_blank" rel="noopener">Node Exporter</a></td><td align="left">Prometheus endpoint with system metrics</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/prometheus/node_exporter.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://gitlab.com/gitlab-org/charts/gitlab/issues/1332" target="_blank" rel="noopener">N/A</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/monitoring/" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#mattermost" target="_blank" rel="noopener">Mattermost</a></td><td align="left">Open-source Slack alternative</td><td align="center"><a href="https://docs.gitlab.com/omnibus/gitlab-mattermost/" target="_blank" rel="noopener">âš™</a></td><td align="center"><a href="https://docs.mattermost.com/install/install-mmte-helm-gitlab-helm.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/integrations/mattermost.html" target="_blank" rel="noopener">â¤“</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#minio" target="_blank" rel="noopener">MinIO</a></td><td align="left">Object storage service</td><td align="center"><a href="https://min.io/download" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/minio/" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#storage-architecture" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-runner" target="_blank" rel="noopener">Runner</a></td><td align="left">Executes GitLab CI/CD jobs</td><td align="center"><a href="https://docs.gitlab.com/runner/" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/runner/install/kubernetes.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#shared-runners" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#database-migrations" target="_blank" rel="noopener">Database Migrations</a></td><td align="left">Database migrations</td><td align="center"><a href="https://docs.gitlab.com/omnibus/settings/database.html#disabling-automatic-database-migration" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/migrations/" target="_blank" rel="noopener">âœ…</a></td><td align="center">âœ…</td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#certificate-management" target="_blank" rel="noopener">Certificate Management</a></td><td align="left">TLS Settings, Letâ€™s Encrypt</td><td align="center"><a href="https://docs.gitlab.com/omnibus/settings/ssl.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://docs.gitlab.com/charts/installation/tls.html" target="_blank" rel="noopener">âœ…</a></td><td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#secrets-management" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-geo" target="_blank" rel="noopener">GitLab Geo Node</a></td><td align="left">Geographically distributed GitLab nodes</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/geo/replication/index.html#setup-instructions" target="_blank" rel="noopener">âš™</a></td><td align="center"><a href="https://gitlab.com/gitlab-org/charts/gitlab/issues/8" target="_blank" rel="noopener">âŒ</a></td><td align="center">âœ…</td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#ldap-authentication" target="_blank" rel="noopener">LDAP Authentication</a></td><td align="left">Authenticate users against centralized LDAP directory</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/auth/ldap.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/charts/charts/globals.html#ldap" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://about.gitlab.com/pricing/#gitlab-com" target="_blank" rel="noopener">âŒ</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#outbound-email" target="_blank" rel="noopener">Outbound email (SMTP)</a></td><td align="left">Send email messages to users</td><td align="center"><a href="https://docs.gitlab.com/omnibus/settings/smtp.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/charts/installation/command-line-options.html#outgoing-email-configuration" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#mail-configuration" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#inbound-email" target="_blank" rel="noopener">Inbound email (SMTP)</a></td><td align="left">Receive messages to update issues</td><td align="center"><a href="https://docs.gitlab.com/ee/administration/incoming_email.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/charts/installation/command-line-options.html#incoming-email-configuration" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#mail-configuration" target="_blank" rel="noopener">âœ…</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#elasticsearch" target="_blank" rel="noopener">Elasticsearch</a></td><td align="left">Improved search within GitLab</td><td align="center"><a href="https://docs.gitlab.com/ee/integration/elasticsearch.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/integration/elasticsearch.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://gitlab.com/groups/gitlab-org/-/epics/153" target="_blank" rel="noopener">âŒ</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#sentry" target="_blank" rel="noopener">Sentry integration</a></td><td align="left">Error tracking for deployed apps</td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/operations/error_tracking.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/operations/error_tracking.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/operations/error_tracking.html" target="_blank" rel="noopener">â¤“</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#jaeger" target="_blank" rel="noopener">Jaeger integration</a></td><td align="left">Distributed tracing for deployed apps</td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/operations/tracing.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/operations/tracing.html" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/operations/tracing.html" target="_blank" rel="noopener">â¤“</a></td></tr><tr><td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-managed-apps" target="_blank" rel="noopener">GitLab Managed Apps</a></td><td align="left">Deploy <a href="https://helm.sh/docs/" target="_blank" rel="noopener">Helm</a>, <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/" target="_blank" rel="noopener">Ingress</a>, <a href="https://docs.cert-manager.io/en/latest/" target="_blank" rel="noopener">Cert-Manager</a>, <a href="https://prometheus.io/docs/introduction/overview/" target="_blank" rel="noopener">Prometheus</a>, a <a href="https://docs.gitlab.com/runner/" target="_blank" rel="noopener">Runner</a>, <a href="https://jupyter.org/" target="_blank" rel="noopener">JupyterHub</a>, <a href="https://cloud.google.com/knative/" target="_blank" rel="noopener">Knative</a> to a cluster</td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/clusters/index.html#installing-applications" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/clusters/index.html#installing-applications" target="_blank" rel="noopener">â¤“</a></td><td align="center"><a href="https://docs.gitlab.com/ee/user/project/clusters/index.html#installing-applications" target="_blank" rel="noopener">â¤“</a></td></tr></tbody></table><h2 id="å®‰è£…-Gitlab"><a href="#å®‰è£…-Gitlab" class="headerlink" title="å®‰è£… Gitlab"></a>å®‰è£… Gitlab</h2><p>å’±éµä»å®˜æ–¹çš„å»ºè®®ï¼Œä½¿ç”¨ Omnibus åŒ…çš„æ–¹å¼æ¥éƒ¨ç½² Gitlab å®ä¾‹ã€‚</p><h3 id="Ubuntu-1804"><a href="#Ubuntu-1804" class="headerlink" title="Ubuntu 1804"></a>Ubuntu 1804</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br><span class="line">curl https://packages.gitlab.com/gpg.key 2&gt; /dev/null | sudo apt-key add - &amp;&gt;/dev/null</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ æ¸…åå¤§å­¦çš„é•œåƒç«™æº bionicæ˜¯ Ubuntu18.04 xenialæ˜¯16.04ï¼Œæ ¹æ®è‡ªå·±çš„ Ubuntu å‘è¡Œç‰ˆæœ¬ä¿®æ”¹ä¸€ä¸‹ä¸‹</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu bionic main</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install gitlab-ce</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ wget çš„æ–¹å¼æŠŠ deb åŒ…ä¸‹è½½ä¸‹æ¥</span></span><br><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu/pool/bionic/main/g/gitlab-ce/gitlab-ce_12.3.5-ce.0_amd64.deb</span><br><span class="line"></span><br><span class="line">opkg -i gitlab-ce/gitlab-ce_12.3.5-ce.0_amd64.deb</span><br></pre></td></tr></table></figure><h3 id="CentOS7"><a href="#CentOS7" class="headerlink" title="CentOS7"></a>CentOS7</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…ä¾èµ–</span></span><br><span class="line">sudo yum install -y curl policycoreutils-python openssh-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®é˜²ç«å¢™</span></span><br><span class="line">sudo firewall-cmd --permanent --add-service=http</span><br><span class="line">sudo systemctl reload firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ¸…åå¤§å­¦é•œåƒç«™çš„æºï¼Œä¸‹è½½é€Ÿåº¦ä¼šå¿«äº›ã€‚</span></span><br><span class="line">sudo cat &gt; /etc/yum.repos.d/gitlab-ce.repo &lt;&lt;EOF</span><br><span class="line">[gitlab-ce]</span><br><span class="line">name=Gitlab CE Repository</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">Ece</span><br><span class="line"></span><br><span class="line">sudo yum makecache</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¯ç”¨çš„ç‰ˆæœ¬neng'b</span></span><br><span class="line">yum list gitlab-ce --showduplicates</span><br><span class="line"><span class="comment"># ç„¶åå®‰è£…æœ€æ–°çš„ç‰ˆæœ¬</span></span><br><span class="line">yum install -y gitlab-ce</span><br><span class="line"><span class="comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬ 12.3.5</span></span><br><span class="line">yum install gitlab-ce-12.3.5-ce.0.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ä½¿ç”¨ wget çš„æ–¹å¼æŠŠ rpm åŒ…ä¸‹è½½ä¸‹æ¥å®‰è£…</span></span><br><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-12.8.2-ce.0.el7.x86_64.rpm</span><br><span class="line">yum install gitlab-ce-12.8.2-ce.0.el7.x86_64.rpm</span><br></pre></td></tr></table></figure><p>å®‰è£…æˆåŠŸä¹‹åä¼šå‡ºç° Gitlab çš„ Logo</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">       *.                  *.</span><br><span class="line">      ***                 ***</span><br><span class="line">     *****               *****</span><br><span class="line">    .******             *******</span><br><span class="line">    ********            ********</span><br><span class="line">   ,,,,,,,,,***********,,,,,,,,,</span><br><span class="line">  ,,,,,,,,,,,*********,,,,,,,,,,,</span><br><span class="line">  .,,,,,,,,,,,*******,,,,,,,,,,,,</span><br><span class="line">      ,,,,,,,,,*****,,,,,,,,,.</span><br><span class="line">         ,,,,,,,****,,,,,,</span><br><span class="line">            .,,,***,,,,</span><br><span class="line">                ,*,.</span><br><span class="line"></span><br><span class="line">     _______ __  __          __</span><br><span class="line">    / ____(_) /_/ /   ____ _/ /_</span><br><span class="line">   / / __/ / __/ /   / __ `/ __ \</span><br><span class="line">  / /_/ / / /_/ /___/ /_/ / /_/ /</span><br><span class="line">  \____/_/\__/_____/\__,_/_.___/</span><br><span class="line"></span><br><span class="line">Thank you for installing GitLab!</span><br><span class="line">GitLab was unable to detect a valid hostname for your instance.</span><br><span class="line">Please configure a URL for your GitLab instance by setting `external_url`</span><br><span class="line">configuration in /etc/gitlab/gitlab.rb file.</span><br><span class="line">Then, you can start your GitLab instance by running the following command:</span><br><span class="line">  sudo gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure><h3 id="2-æ‰“è¡¥ä¸ï¼Œè¡¥å……æ±‰åŒ–çš„è¡¥ä¸"><a href="#2-æ‰“è¡¥ä¸ï¼Œè¡¥å……æ±‰åŒ–çš„è¡¥ä¸" class="headerlink" title="2.æ‰“è¡¥ä¸ï¼Œè¡¥å……æ±‰åŒ–çš„è¡¥ä¸"></a>2.æ‰“è¡¥ä¸ï¼Œè¡¥å……æ±‰åŒ–çš„è¡¥ä¸</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://gitlab.com/xhang/gitlab.git</span><br><span class="line"><span class="built_in">cd</span> gitlab</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å½“å‰å®‰è£…çš„ç‰ˆæœ¬</span></span><br><span class="line">gitlab_version=$(cat /opt/gitlab/embedded/service/gitlab-rails/VERSION)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆå¯¹åº”ç‰ˆæœ¬è¡¥ä¸æ–‡ä»¶</span></span><br><span class="line">git diff v<span class="variable">$&#123;gitlab_version&#125;</span> v<span class="variable">$&#123;gitlab_version&#125;</span>-zh &gt; ../<span class="variable">$&#123;gitlab_version&#125;</span>-zh.diff</span><br><span class="line"></span><br><span class="line">gitlab-ctl stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“è¡¥ä¸çš„æ—¶å€™ä¼šæç¤ºä¸€äº›è¡¥ä¸æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¸€å®šè¦è·³è¿‡è¿™äº›æ–‡ä»¶ï¼Œä¸ç„¶åé¢reconfigçš„æ—¶å€™ä¼šæŠ¥é”™çš„ã€‚</span></span><br><span class="line">patch -d /opt/gitlab/embedded/service/gitlab-rails -p1 &lt; <span class="variable">$&#123;gitlab_version&#125;</span>-zh.diff</span><br></pre></td></tr></table></figure><h3 id="3-ä¿®æ”¹é»˜è®¤é…ç½®"><a href="#3-ä¿®æ”¹é»˜è®¤é…ç½®" class="headerlink" title="3. ä¿®æ”¹é»˜è®¤é…ç½®"></a>3. ä¿®æ”¹é»˜è®¤é…ç½®</h3><p>ä¿®æ”¹ gitlab çš„é…ç½®æ–‡ä»¶ <code>/etc/gitlab/gitlab.rb</code></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹ä¸ºä½ è‡ªå·±çš„åŸŸåæˆ–è€… IPï¼Œæ˜¯å•å¼•å·ï¼Œè€Œä¸”å‰é¢çš„ http ä¸è¦æ”¹</span></span><br><span class="line">external_url  'http://gitlab.domain'</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‚®ä»¶é…ç½®ï¼Œæ²¡æœ‰é‚®ä»¶æœåŠ¡å™¨å¯ä»¥å…³é—­é‚®ä»¶æœåŠ¡åŠŸèƒ½</span></span><br><span class="line">gitlab_rails['smtp_enable'] = false</span><br><span class="line">gitlab_rails['smtp_address'] = ""</span><br><span class="line">gitlab_rails['smtp_port'] =  587</span><br><span class="line">gitlab_rails['smtp_user_name'] = ""</span><br><span class="line">gitlab_rails['smtp_password'] = ""</span><br><span class="line">gitlab_rails['smtp_authentication'] = ""</span><br><span class="line">gitlab_rails['smtp_enable_starttls_auto'] =</span><br><span class="line">gitlab_rails['smtp_tls'] =</span><br><span class="line">gitlab_rails['gitlab_email_from'] = ''</span><br></pre></td></tr></table></figure><h3 id="4-åˆå§‹åŒ–è®¾ç½®"><a href="#4-åˆå§‹åŒ–è®¾ç½®" class="headerlink" title="4. åˆå§‹åŒ–è®¾ç½®"></a>4. åˆå§‹åŒ–è®¾ç½®</h3><p>ä¿®æ”¹å®Œæˆé…ç½®ä¹‹åä½¿ç”¨ <code>gitlab-ctl reconfigure</code> é‡æ–°æ›´æ–°ä¸€ä¸‹ gitlab æœåŠ¡çš„é…ç½®ï¼Œæ›´æ–°å®Œæˆé…ç½®ä¹‹åä½¿ç”¨<br><code>gitlab-ctl restart</code> æ¥é‡æ–°å¯åŠ¨ gitlab ã€‚å¦‚æœ reconfigure å¤±è´¥ï¼Œåˆ™éœ€è¦ <code>systemctl enable gitlab- runsvdir &amp;&amp; systemctl restart gitlab- runsvdir</code> é‡å¯ä¸€ä¸‹  <code>gitlab-runsvdir</code> æœåŠ¡ã€‚</p><p>æ‰“å¼€æµè§ˆå™¨è¿›è¡Œåˆå§‹åŒ–è´¦æˆ·è®¾å®šå¯†ç ï¼Œè¿™ä¸ªå¯†ç ä¸º root ç®¡ç†å‘˜è´¦æˆ·çš„å¯†ç ã€‚è®¾ç½®å®Œå¯†ç ä¹‹åä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢ã€‚username ä¸º <code>root</code> å¯†ç ä¸ºåˆšåˆšè®¾ç½®çš„å¯†ç ã€‚</p><h2 id="å®‰è£…-gitlab-runner"><a href="#å®‰è£…-gitlab-runner" class="headerlink" title="å®‰è£… gitlab-runner"></a>å®‰è£… gitlab-runner</h2><h3 id="Debian-Ubuntu"><a href="#Debian-Ubuntu" class="headerlink" title="Debian/Ubuntu"></a>Debian/Ubuntu</h3><p>é¦–å…ˆä¿¡ä»» GitLab çš„ GPG å…¬é’¥:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://packages.gitlab.com/gpg.key 2&gt; /dev/null | sudo apt-key add - &amp;&gt;/dev/null</span><br></pre></td></tr></table></figure><p>å†é€‰æ‹©ä½ çš„ Debian/Ubuntu ç‰ˆæœ¬ï¼Œæ–‡æœ¬æ¡†ä¸­å†…å®¹å†™è¿› <code>/etc/apt/sources.list.d/gitlab-runner.list</code></p><h4 id="Debian"><a href="#Debian" class="headerlink" title="Debian"></a>Debian</h4><p>æ ¹æ®è‡ªå·±çš„å‘è¡Œç‰ˆä»£å·ä¿®æ”¹ä¸€ä¸‹ <code>stretch</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/gitlab-runner/debian stretch main</span><br></pre></td></tr></table></figure><h4 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h4><p>æ ¹æ®è‡ªå·±çš„å‘è¡Œç‰ˆä»£å·ä¿®æ”¹ä¸€ä¸‹ <code>bionic</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/gitlab-runner/ubuntu bionic main</span><br></pre></td></tr></table></figure><p>é…ç½®å¥½ deb æºä¹‹åå†æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt uodate</span><br><span class="line">apt install gitlab-runner -y</span><br></pre></td></tr></table></figure><h3 id="CentOS7-1"><a href="#CentOS7-1" class="headerlink" title="CentOS7"></a>CentOS7</h3><p>æ–°å»º <code>/etc/yum.repos.d/gitlab-runner.repo</code>ï¼Œå†…å®¹ä¸º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[gitlab-runner]</span><br><span class="line">name=gitlab-runner</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-runner/yum/el7</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://packages.gitlab.com/gpg.key</span><br></pre></td></tr></table></figure><p>å†æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo yum makecache</span><br><span class="line">sudo yum install gitlab-runner -y</span><br><span class="line"><span class="comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬ å…¶ä¸­ 12.3.5 å³ä¸ºæŒ‡å®šçš„ç‰ˆæœ¬å·</span></span><br><span class="line">yum install gitlab-runner-12.3.5-1.x86_64 -y</span><br></pre></td></tr></table></figure><h3 id="æ³¨å†Œ-gitlab-runner"><a href="#æ³¨å†Œ-gitlab-runner" class="headerlink" title="æ³¨å†Œ gitlab-runner"></a>æ³¨å†Œ gitlab-runner</h3><p>ä½¿ç”¨ root ç”¨æˆ·ä» web ç«¯ç™»å½•åˆ° gitlab ç®¡ç†ä¸­å¿ƒã€‚åœ¨ <code>æ¦‚è§ˆ</code> â€“&gt; <code>Runner</code> ã€‚åœ¨å³ä¸Šè§’ä¼šæœ‰ä»¥ä¸‹ï¼Œç¨åä¼šç”¨åˆ°ã€‚</p><ul><li>åœ¨ Runner è®¾ç½®æ—¶æŒ‡å®šä»¥ä¸‹ URL</li><li>åœ¨å®‰è£…è¿‡ç¨‹ä¸­ä½¿ç”¨ä»¥ä¸‹æ³¨å†Œä»¤ç‰Œï¼š</li></ul><p>å®‰è£…å¥½ gitlab-runner ä¹‹åå¦‚æœç›´æ¥å‘ gitlab æ³¨å†Œåˆ™ä¼šæç¤ºå¤±è´¥ï¼Œæç¤º <code>ERROR: Registering runner... failed   runner=qRGh2M86 status=500 Internal Server Error</code> ã€‚è¿™æ˜¯å› ä¸º Gitlab é»˜è®¤ç¦æ­¢äº†ç§æœ‰ç½‘æ®µ IP é‡Œçš„ API è¯·æ±‚ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯æ‰è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab ~</span><br><span class="line">â•°â”€<span class="comment"># gitlab-runner register</span></span><br><span class="line">Runtime platform   arch=amd64 os=linux pid=6818 revision=1b659122 version=12.8.0</span><br><span class="line">Running <span class="keyword">in</span> system-mode.</span><br><span class="line">Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):</span><br><span class="line">http://10.10.107.216/</span><br><span class="line">Please enter the gitlab-ci token <span class="keyword">for</span> this runner:</span><br><span class="line">qRGh2M86iTasjBn1dU8L</span><br><span class="line">Please enter the gitlab-ci description <span class="keyword">for</span> this runner:</span><br><span class="line">[gitlab]: runner-centos</span><br><span class="line">Please enter the gitlab-ci tags <span class="keyword">for</span> this runner (comma separated):</span><br><span class="line">centos</span><br><span class="line">ERROR: Registering runner... failed   runner=qRGh2M86 status=500 Internal Server Error</span><br><span class="line">PANIC: Failed to register this runner. Perhaps you are having network problems</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-gitlab-é»˜è®¤ç½‘ç»œè®¾ç½®"><a href="#ä¿®æ”¹-gitlab-é»˜è®¤ç½‘ç»œè®¾ç½®" class="headerlink" title="ä¿®æ”¹ gitlab é»˜è®¤ç½‘ç»œè®¾ç½®"></a>ä¿®æ”¹ gitlab é»˜è®¤ç½‘ç»œè®¾ç½®</h3><p>ä½¿ç”¨ root ç”¨æˆ·ä» web ç«¯ç™»å½•åˆ° gitlab ç®¡ç†ä¸­å¿ƒ http://${ip}/admin ã€‚ç®¡ç†ä¸­å¿ƒ â€“&gt; è®¾ç½® â€“&gt; ç½‘ç»œ â€“&gt; å¤–å‘è¯·æ±‚ â€“&gt; å…è®¸æ¥è‡ªé’©å­å’ŒæœåŠ¡çš„å¯¹æœ¬åœ°ç½‘ç»œçš„è¯·æ±‚ã€‚ä»¥ä¸‹é€‰é¡¹å…¨éƒ¨å…è®¸ï¼Œæ‰èƒ½é€šè¿‡å¤–éƒ¨è¯·æ±‚çš„æ–¹å¼æ³¨å†Œ gitlab-runnerã€‚</p><ul><li>Allow requests to the local network from web hooks and services</li><li>Allow requests to the local network from system hooks</li></ul><p><strong>ä¸ºäº†å®‰å…¨èµ·è§</strong>ï¼Œä¹Ÿå¯ä»¥åœ¨ Whitelist to allow requests to the local network from hooks and services ä¸‹æ–¹çš„é‚£ä¸ªæ¡†æ¡†é‡Œæ·»åŠ ä¸Šç™½åå•ï¼Œå…è®¸æˆæƒçš„ IP ã€‚ä¿®æ”¹å¥½ä¹‹åä¸è¦å¿˜è®°ç‚¹å‡»åº•éƒ¨é‚£ä¸ªç»¿è‰²æŒ‰é’® <code>ä¿å­˜ä¿®æ”¹</code> ã€‚</p><h4 id="500-é”™è¯¯"><a href="#500-é”™è¯¯" class="headerlink" title="500 é”™è¯¯"></a>500 é”™è¯¯</h4><p>å¦‚æœç‚¹å‡» <code>ä¿å­˜ä¿®æ”¹</code> ä¹‹åå°±è·³è½¬åˆ° Gitlab 500 é”™è¯¯çš„é¡µé¢ã€‚å°è¯•åœ¨ç®¡ç†ä¸­å¿ƒä¿®æ”¹å…¶ä»–è®¾ç½®ä¿å­˜æ—¶ï¼Œä¹Ÿä¼šå‡ºç° 500 çš„æƒ…å†µã€‚åœ¨å®‰è£… gitlab çš„æœºå™¨ä¸ŠæŸ¥çœ‹ä¸€ä¸‹æ—¥å¿—ã€‚è¿è¡Œ <code>gitlab-ctl tail</code> æŸ¥çœ‹å®æ—¶çš„æ—¥å¿—ã€‚æ­¤æ—¶ç­‰åˆ°æ—¥å¿—è¾“å‡ºå‡æ…¢çš„æ—¶å€™æˆ‘ä»¬å¤šæŒ‰å‡ ä¸‹å›è½¦ï¼Œç„¶åå°±ç«‹å³å»ç‚¹å‡»<code>ä¿å­˜ä¿®æ”¹</code>  æŒ‰é’®ï¼Œè¿™æ ·å°±èƒ½æ•æ‰åˆ°æ­¤åˆ»çš„é”™è¯¯æ—¥å¿—ã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">==&gt; /<span class="keyword">var</span>/log/gitlab/gitlab-rails/production<span class="variable">.log</span> &lt;==</span><br><span class="line">Started PATCH <span class="string">"/admin/application_settings/network"</span> <span class="keyword">for</span> <span class="number">10</span><span class="variable">.0</span><span class="variable">.30</span><span class="variable">.2</span> at <span class="number">2020</span>-<span class="number">03</span>-<span class="number">10</span> <span class="number">11</span>:<span class="number">08</span>:<span class="number">20</span> +<span class="number">0000</span></span><br><span class="line">Processing by Admin::ApplicationSettingsController#network as HTML</span><br><span class="line">  Parameters: &#123;<span class="string">"utf8"</span>=&gt;<span class="string">"âœ“"</span>, <span class="string">"authenticity_token"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"application_setting"</span>=&gt;&#123;<span class="string">"allow_local_requests_from_web_hooks_and_services"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"allow_local_requests_from_system_hooks"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"outbound_local_requests_whitelist_raw"</span>=&gt;<span class="string">""</span>, <span class="string">"dns_rebinding_protection_enabled"</span>=&gt;<span class="string">"1"</span>&#125;&#125;</span><br><span class="line">Completed <span class="number">500</span> Internal Server Error in <span class="number">40</span>ms (ActiveRecord: <span class="number">14</span><span class="variable">.5ms</span> | Elasticsearch: <span class="number">0</span><span class="variable">.0ms</span>)</span><br><span class="line">OpenSSL::Cipher::CipherError ():</span><br><span class="line">lib/gitlab/crypto_helper<span class="variable">.rb</span>:<span class="number">27</span>:in <span class="meta">`aes256_gcm_decrypt'</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­é”™è¯¯çš„è¾“å‡ºæ˜¯åœ¨ <code>OpenSSL::Cipher::CipherError ():</code></p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Processing by Admin::ApplicationSettingsController#network as HTML</span><br><span class="line">  Parameters: &#123;<span class="string">"utf8"</span>=&gt;<span class="string">"âœ“"</span>, <span class="string">"authenticity_token"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"application_setting"</span>=&gt;&#123;<span class="string">"allow_local_requests_from_web_hooks_and_services"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"allow_local_requests_from_system_hooks"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"outbound_local_requests_whitelist_raw"</span>=&gt;<span class="string">""</span>, <span class="string">"dns_rebinding_protection_enabled"</span>=&gt;<span class="string">"1"</span>&#125;&#125;</span><br><span class="line">Completed <span class="number">500</span> Internal Server Error in <span class="number">40</span>ms (ActiveRecord: <span class="number">14</span><span class="variable">.5ms</span> | Elasticsearch: <span class="number">0</span><span class="variable">.0ms</span>)</span><br><span class="line">OpenSSL::Cipher::CipherError ():</span><br></pre></td></tr></table></figure><blockquote><p>æœç´¢äº†ä¸€ä¸‹ï¼Œå‘ç°ç½‘ä¸Šè¯´æ˜¯ç”±äºè¿ç§»å¯¼å…¥é¡¹ç›®åï¼Œæ²¡æœ‰å¯¼å…¥åŸæ¥çš„åŠ å¯†ä¿¡æ¯<code>/etc/gitlab/gitlab-secrets.json</code>ï¼Œ ä½†æ˜¯åŸæ¥çš„åŠ å¯†ä¿¡æ¯æ–‡ä»¶æˆ‘å·²ç»æ‰¾ä¸åˆ°äº†ï¼Œåé¢å‘ç°å¯ä»¥ç›´æ¥é‡ç½®å°±è¡Œäº†</p><p>å‚è€ƒ <a href="https://hihozhou.com/blog/2019/08/01/gitlab-500.html" target="_blank" rel="noopener">è‡ªæ­gitlabæŠ¥500é”™è¯¯</a></p></blockquote><p>å‘½ä»¤è¡Œè¾“å…¥<code>gitlab-rails console</code>ï¼Œç„¶åè¾“å…¥</p><p><code>ApplicationSetting.current.reset_runners_registration_token!</code>å³å¯ï¼Œè¿™æ ·åœ¨ä¿å­˜ä¿®æ”¹çš„æ—¶å€™å°±ä¸ä¼šå†æŠ¥ 500 çš„é—®é¢˜äº†ã€‚åº”è¯¥æ˜¯é‡æ–°å®‰è£… Gitlab ä¹‹åçš„åŠ å¯†ä¿¡æ¯ä¸å¯¹æ‰€è‡´ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab ~</span><br><span class="line">â•°â”€<span class="comment"># gitlab-rails console</span></span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line"> GitLab:       12.3.5 (2417d5becc7)</span><br><span class="line"> GitLab Shell: 10.0.0</span><br><span class="line"> PostgreSQL:   10.9</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Loading production environment (Rails 5.2.3)</span><br><span class="line">irb(main):001:0&gt; ApplicationSetting.current.reset_runners_registration_token!</span><br><span class="line">=&gt; <span class="literal">true</span></span><br><span class="line">irb(main):002:0&gt; <span class="built_in">exit</span></span><br></pre></td></tr></table></figure><h3 id="åœ¨é¡¹ç›®ä¸­æ³¨å†Œ-Runner"><a href="#åœ¨é¡¹ç›®ä¸­æ³¨å†Œ-Runner" class="headerlink" title="åœ¨é¡¹ç›®ä¸­æ³¨å†Œ Runner"></a>åœ¨é¡¹ç›®ä¸­æ³¨å†Œ Runner</h3><p>ä»¥ä¸Šå·²ç»å®‰è£…å¥½å¹¶ä¿®æ”¹é»˜è®¤çš„ç½‘ç»œè®¾ç½®å…è®¸ runner æ‰€åœ¨çš„ IP å‘ gitlab å‘èµ·å¤–éƒ¨è¯·æ±‚ã€‚è¿è¡Œ <code>gitlab-runner register</code> æ ¹æ®ç›¸åº”çš„æç¤ºè¾“å…¥ <code>URL</code> å’Œ <code>token</code> å³å¯ã€‚æœ€åæ ¹æ®æœºå™¨çš„ç±»å‹é€‰æ‹©å¥½ runner çš„ç±»å‹ï¼Œè¿™ä¸ªä¹Ÿæ˜¯è·‘ CI ä»»åŠ¡æ—¶çš„ç¯å¢ƒï¼Œåˆ°æ—¶å€™å¯ä»¥åœ¨é¡¹ç›®çš„è®¾ç½®ä¸­é€‰æ‹©å¯åŠ¨ç›¸åº”çš„ runner ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@runner ~</span><br><span class="line">â•°â”€<span class="comment"># gitlab-runner register</span></span><br><span class="line">Runtime platform   arch=amd64 os=linux pid=7501 revision=1b659122 version=12.8.0</span><br><span class="line">Running <span class="keyword">in</span> system-mode.</span><br><span class="line">Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):</span><br><span class="line">http://10.10.107.216/</span><br><span class="line">Please enter the gitlab-ci token <span class="keyword">for</span> this runner:</span><br><span class="line">4hjjA7meRGuxEm3LyMjq</span><br><span class="line">Please enter the gitlab-ci description <span class="keyword">for</span> this runner:</span><br><span class="line">[runner]:</span><br><span class="line">Please enter the gitlab-ci tags <span class="keyword">for</span> this runner (comma separated):</span><br><span class="line">centos</span><br><span class="line">Registering runner... succeeded                     runner=4hjjA7me</span><br><span class="line">Please enter the executor: shell, ssh, virtualbox, docker-ssh+machine, kubernetes, docker, docker-ssh, parallels, docker+machine, custom:</span><br><span class="line">[shell]: shell</span><br><span class="line">Runner registered successfully. Feel free to start it, but <span class="keyword">if</span> it<span class="string">'s running already the config should be automatically reloaded!</span></span><br></pre></td></tr></table></figure><ul><li>æç¤ºæˆåŠŸä¹‹åç„¶ååœ¨ <code>ç®¡ç†ä¸­å¿ƒ</code>â€“&gt; <code>æ¦‚è§ˆ</code> â€“&gt; <code>Runner</code> å¯ä»¥æŸ¥çœ‹åˆ°ç›¸åº”çš„ Runner äº†ã€‚ä¹Ÿå¯ä»¥æ‰‹åŠ¨ç¼–è¾‘ <code>/etc/gitlab-runner/config.toml</code> æ¥æ³¨å†Œç›¸åº”ç±»å‹çš„  Runner</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">concurrent</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">check_interval</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="section">[session_server]</span></span><br><span class="line">  session_timeout = 1800</span><br><span class="line"></span><br><span class="line"><span class="section">[[runners]]</span></span><br><span class="line">  name = "runner"</span><br><span class="line">  url = "http://10.10.107.216/"</span><br><span class="line">  token = "ZTSAQ3q6x_upW9toyKTY"</span><br><span class="line">  executor = "shell"</span><br><span class="line">  <span class="section">[runners.custom_build_dir]</span></span><br><span class="line">  <span class="section">[runners.cache]</span></span><br><span class="line">    <span class="section">[runners.cache.s3]</span></span><br><span class="line">    <span class="section">[runners.cache.gcs]</span></span><br><span class="line"></span><br><span class="line"><span class="section">[[runners]]</span></span><br><span class="line">  name = "docker-runner"</span><br><span class="line">  url = "http://10.10.107.216/"</span><br><span class="line">  token = "Cf1cy6yx4Y-bGjVnRf8m"</span><br><span class="line">  executor = "docker"</span><br><span class="line">  <span class="section">[runners.custom_build_dir]</span></span><br><span class="line">  <span class="section">[runners.cache]</span></span><br><span class="line">    <span class="section">[runners.cache.s3]</span></span><br><span class="line">    <span class="section">[runners.cache.gcs]</span></span><br><span class="line">  <span class="section">[runners.docker]</span></span><br><span class="line">  <span class="comment"># åœ¨è¿™é‡Œéœ€è¦æ·»åŠ ä¸Š harbor çš„åœ°å€ï¼Œæ‰èƒ½å…è®¸ pull ç§æœ‰ registry çš„é•œåƒ</span></span><br><span class="line">    allowed_images = ["10.10.107.217/*:*"]</span><br><span class="line">    tls_verify = false</span><br><span class="line">    image = "golang:latest"</span><br><span class="line">    privileged = true</span><br><span class="line">    disable_entrypoint_overwrite = false</span><br><span class="line">    oom_kill_disable = false</span><br><span class="line">    disable_cache = false</span><br><span class="line">    volumes = ["/cache"]</span><br><span class="line">    shm_size = 0</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²-Harbor"><a href="#éƒ¨ç½²-Harbor" class="headerlink" title="éƒ¨ç½² Harbor"></a>éƒ¨ç½² Harbor</h2><ul><li>åœ¨ harbor é¡¹ç›®çš„ release é¡µé¢ä¸‹è½½ç¦»çº¿å®‰è£…åŒ… <a href="https://github.com/goharbor/harbor/releases/download/v1.9.4/harbor-offline-installer-v1.9.4.tgz" target="_blank" rel="noopener">harbor-offline-installer-v1.9.4.tgz</a> åˆ°éƒ¨ç½²çš„æœºå™¨ä¸Šã€‚éƒ¨ç½²ä¹‹å‰éœ€è¦å®‰è£…å¥½ <code>docker</code> å’Œ <code>docker-compose</code> ã€‚ä¹‹åå†ä¿®æ”¹ <code>harbor.yml</code> é…ç½®æ–‡ä»¶ä¸­çš„ä»¥ä¸‹å†…å®¹ï¼š</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hostname éœ€è¦ä¿®æ”¹ä¸ºç›¸åº”çš„åŸŸåæˆ–è€… IP</span></span><br><span class="line"><span class="attr">hostname:</span> <span class="number">10.10</span><span class="number">.107</span><span class="number">.217</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># http related config</span></span><br><span class="line"><span class="attr">http:</span></span><br><span class="line">  <span class="comment"># port for http, default is 80. If https enabled, this port will redirect to https port</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é¦–æ¬¡ç™»å½•æ—¶è®¾å®šçš„ admin è´¦æˆ·å¯†ç </span></span><br><span class="line"><span class="attr">harbor_admin_password:</span> <span class="string">Harbor12345</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®å­˜å‚¨çš„ç›®å½•</span></span><br><span class="line"><span class="attr">data_volume:</span> <span class="string">/data</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># clair CVE æ¼æ´æ•°æ®åº“æ›´æ–°ï¼Œè¿™é‡Œå»ºè®®è®¾ç½®ä¸º 1h</span></span><br><span class="line"><span class="comment"># ç”±äº clair æ•°æ®åº“åœ¨å›½å†…ç½‘ç»œè®¿é—®é—®é¢˜ï¼Œéœ€è¦è®¾ç½® http ä»£ç†</span></span><br><span class="line"><span class="attr">clair:</span></span><br><span class="line">  <span class="comment"># The interval of clair updaters, the unit is hour, set to 0 to disable the updaters.</span></span><br><span class="line">  <span class="attr">updaters_interval:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">proxy:</span></span><br><span class="line">  <span class="attr">http_proxy:</span> <span class="number">10.20</span><span class="number">.172</span><span class="number">.106</span><span class="string">:2080</span></span><br><span class="line">  <span class="attr">https_proxy:</span></span><br><span class="line">  <span class="attr">no_proxy:</span></span><br><span class="line">  <span class="attr">components:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">clair</span></span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶ä¹‹åå†è¿è¡Œ <code>./install.sh --with-clair --with-chartmuseum</code> å°† clair é›†æˆåˆ° harbor ä¸­ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@harbor /opt/harbor</span><br><span class="line">â•°â”€# ./install.sh --with-clair --with-chartmuseum</span><br><span class="line">[Step 0]: checking installation environment ...</span><br><span class="line">[Step 1]: loading Harbor images ...</span><br><span class="line">[Step 2]: preparing environment ...</span><br><span class="line">[Step 3]: starting Harbor ...</span><br><span class="line">Creating network "harbor_harbor" with the default driver</span><br><span class="line">Creating network "harbor_harbor-clair" with the default driver</span><br><span class="line">Creating network "harbor_harbor-chartmuseum" with the default driver</span><br><span class="line">Creating harbor-log ... done</span><br><span class="line">Creating harbor-db     ... done</span><br><span class="line">Creating registryctl   ... done</span><br><span class="line">Creating harbor-portal ... done</span><br><span class="line">Creating chartmuseum   ... done</span><br><span class="line">Creating registry      ... done</span><br><span class="line">Creating redis         ... done</span><br><span class="line">Creating clair         ... done</span><br><span class="line">Creating harbor-core   ... done</span><br><span class="line">Creating harbor-jobservice ... done</span><br><span class="line">Creating nginx             ... done</span><br><span class="line"></span><br><span class="line">âœ” ----Harbor has been installed and started successfully.----</span><br><span class="line"></span><br><span class="line">Now you should be able to visit the admin portal at http://10.20.172.236.</span><br><span class="line">For more details, please visit https://github.com/goharbor/harbor .</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>docker-compose ps</code> æ£€æŸ¥ harbor ç›¸å…³å®¹å™¨æ˜¯å¦æ­£å¸¸ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@harbor /opt/harbor</span><br><span class="line">â•°â”€# docker-compose ps</span><br><span class="line">      Name                     Command                  State                 Ports</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line">chartmuseum         /docker-entrypoint.sh            Up (healthy)   9999/tcp</span><br><span class="line">clair               /docker-entrypoint.sh            Up (healthy)   6060/tcp, 6061/tcp</span><br><span class="line">harbor-core         /harbor/harbor_core              Up (healthy)</span><br><span class="line">harbor-db           /docker-entrypoint.sh            Up (healthy)   5432/tcp</span><br><span class="line">harbor-jobservice   /harbor/harbor_jobservice  ...   Up (healthy)</span><br><span class="line">harbor-log          /bin/sh -c /usr/local/bin/ ...   Up (healthy)   127.0.0.1:1514-&gt;10514/tcp</span><br><span class="line">harbor-portal       nginx -g daemon off;             Up (healthy)   8080/tcp</span><br><span class="line">nginx               nginx -g daemon off;             Up (healthy)   0.0.0.0:80-&gt;8080/tcp</span><br><span class="line">redis               redis-server /etc/redis.conf     Up (healthy)   6379/tcp</span><br><span class="line">registry            /entrypoint.sh /etc/regist ...   Up (healthy)   5000/tcp</span><br><span class="line">registryctl         /harbor/start.sh                 Up (healthy)</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200326163733610.png" alt="image-20200326163733610"></p><h3 id="è®¾ç½®-insecure-registry"><a href="#è®¾ç½®-insecure-registry" class="headerlink" title="è®¾ç½® insecure registry"></a>è®¾ç½® insecure registry</h3><ul><li>åœ¨ runner æœåŠ¡å™¨ä¸Šè®¾ç½®ä¸€ä¸‹ <code>/etc/docker/daemon.json</code> å°†ç§æœ‰ registry çš„ IP åœ°å€å¡«å…¥åˆ° <code>insecure-registries</code> æ•°ç»„ä¸­ã€‚è¿™æ ·æ‰å¯ä»¥æ¨é€å’Œæ‹‰å–é•œåƒ</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"insecure-registries"</span> : [<span class="string">"10.10.107.217"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>docker login</code> æµ‹è¯•æ˜¯å¦èƒ½ç™»å½•æˆåŠŸï¼š</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@docker-230 /opt</span><br><span class="line">â•°â”€# docker login 10.10.107.217</span><br><span class="line">Username: admin</span><br><span class="line">Password:</span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure><ul><li>ç™»å½•åˆ° harbor æ–°å»ºä¸€ä¸ªé¡¹ç›®ä»“åº“ï¼Œå¹¶æŒ‰ç…§ <code>docker tag SOURCE_IMAGE[:TAG] 10.20.172.236/ciest/IMAGE[:TAG]</code> æ ¼å¼ç»™æœ¬åœ° docker é•œåƒæ‰“ä¸Š tag å¹¶æµ‹è¯•æ¨é€åˆ° harbor æ˜¯å¦æˆåŠŸã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@docker-230 /opt</span><br><span class="line">â•°â”€# docker tag openjdk:8-jdk-alpine 10.10.107.217/ops/openjdk:8-jdk-alpine</span><br><span class="line">â•­â”€root@docker-230 /opt</span><br><span class="line">â•°â”€# docker push !$</span><br><span class="line">â•­â”€root@docker-230 /opt</span><br><span class="line">â•°â”€# docker push 10.10.107.217/ops/openjdk:8-jdk-alpine</span><br><span class="line">The push refers to repository [10.10.107.217/ops/openjdk]</span><br><span class="line">ceaf9e1ebef5: Mounted from ops/ci-test</span><br><span class="line">9b9b7f3d56a0: Mounted from ops/ci-test</span><br><span class="line">f1b5933fe4b5: Mounted from ops/ci-test</span><br><span class="line">8-jdk-alpine: digest: sha256:44b3cea369c947527e266275cee85c71a81f20fc5076f6ebb5a13f19015dce71 size: 947</span><br></pre></td></tr></table></figure><ul><li>åœ¨ harbor é¡¹ç›®çš„é¡µé¢æŸ¥çœ‹æ˜¯å¦æ¨é€æˆåŠŸ</li></ul><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200326170403918.png" alt="image-20200326170403918"></p><h2 id="æµ‹è¯•-CI-CD-é¡¹ç›®"><a href="#æµ‹è¯•-CI-CD-é¡¹ç›®" class="headerlink" title="æµ‹è¯• CI/CD é¡¹ç›®"></a>æµ‹è¯• CI/CD é¡¹ç›®</h2><ul><li>åœ¨ Gitlab ä¸­ä½¿ç”¨ Spring æ¨¡æ¿æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå¹¶æ·»åŠ  <code>.gitlab-ci.yaml</code> é…ç½®æ–‡ä»¶ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200326170523433.png" alt="image-20200326170523433"></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line"><span class="attr">build-master:</span></span><br><span class="line">  <span class="comment"># Official docker image.</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">docker:latest</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">maven-runner</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">services:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker:dind</span></span><br><span class="line">  <span class="attr">before_script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">login</span> <span class="string">-u</span> <span class="string">"$CI_REGISTRY_USER"</span> <span class="string">-p</span> <span class="string">"$CI_REGISTRY_PASSWORD"</span> <span class="string">$CI_REGISTRY</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">info</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">build</span> <span class="string">--pull</span> <span class="string">-t</span> <span class="string">"$CI_REGISTRY_IMAGE"</span> <span class="string">.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">push</span> <span class="string">"$CI_REGISTRY_IMAGE"</span></span><br><span class="line">  <span class="attr">allow_failure:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="comment"># Official docker image.</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">docker:latest</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">services:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker:dind</span></span><br><span class="line">  <span class="attr">before_script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">login</span> <span class="string">-u</span> <span class="string">"$CI_REGISTRY_USER"</span> <span class="string">-p</span> <span class="string">"$CI_REGISTRY_PASSWORD"</span> <span class="string">$CI_REGISTRY</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">build</span> <span class="string">--pull</span> <span class="string">-t</span> <span class="string">"$CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG"</span> <span class="string">.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">push</span> <span class="string">"$CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG"</span></span><br><span class="line">  <span class="attr">except:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><h3 id="gitlab-ci-yaml"><a href="#gitlab-ci-yaml" class="headerlink" title=".gitlab-ci.yaml"></a>.gitlab-ci.yaml</h3><p><code>.gitlab-ci.yaml</code> æ–‡ä»¶çš„é…ç½®é«˜åº¦ä¾èµ–äºé¡¹ç›®æœ¬èº«ï¼Œä»¥åŠ CI/CD æµæ°´çº¿çš„éœ€æ±‚ã€‚å…¶é…ç½®æ–‡ä»¶ä¸»è¦ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š</p><h4 id="Pipeline"><a href="#Pipeline" class="headerlink" title="Pipeline"></a>Pipeline</h4><p>ä¸€æ¬¡ Pipeline å…¶å®ç›¸å½“äºä¸€æ¬¡æ„å»ºä»»åŠ¡ï¼Œé‡Œé¢å¯ä»¥åŒ…å«å¾ˆå¤šä¸ªæµç¨‹ï¼Œå¦‚å®‰è£…ä¾èµ–ã€è¿è¡Œæµ‹è¯•ã€ç¼–è¯‘ã€éƒ¨ç½²æµ‹è¯•æœåŠ¡å™¨ã€éƒ¨ç½²ç”Ÿäº§æœåŠ¡å™¨ç­‰æµç¨‹ã€‚ä»»ä½•æäº¤æˆ–è€… Merge Request çš„åˆå¹¶éƒ½å¯ä»¥è§¦å‘ Pipeline æ„å»ºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+------------------+           +----------------+</span><br><span class="line">|                  |  trigger  |                |</span><br><span class="line">|   Commit &#x2F; MR    +----------&gt;+    Pipeline    |</span><br><span class="line">|                  |           |                |</span><br><span class="line">+------------------+           +----------------+</span><br></pre></td></tr></table></figure><h4 id="Stages"><a href="#Stages" class="headerlink" title="Stages"></a>Stages</h4><p>Stages è¡¨ç¤ºä¸€ä¸ªæ„å»ºé˜¶æ®µï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„ä¸€ä¸ªæµç¨‹ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¸€æ¬¡ Pipeline ä¸­å®šä¹‰å¤šä¸ª Stagesï¼Œè¿™äº› Stages ä¼šæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>æ‰€æœ‰ Stages ä¼šæŒ‰ç…§é¡ºåºè¿è¡Œï¼Œå³å½“ä¸€ä¸ª Stage å®Œæˆåï¼Œä¸‹ä¸€ä¸ª Stage æ‰ä¼šå¼€å§‹</li><li>åªæœ‰å½“æ‰€æœ‰ Stages å®Œæˆåï¼Œè¯¥æ„å»ºä»»åŠ¡ (Pipeline) æ‰ä¼šæˆåŠŸ</li><li>å¦‚æœä»»ä½•ä¸€ä¸ª Stage å¤±è´¥ï¼Œé‚£ä¹ˆåé¢çš„ Stages ä¸ä¼šæ‰§è¡Œï¼Œè¯¥æ„å»ºä»»åŠ¡ (Pipeline) å¤±è´¥</li></ul><p>Stages å’Œ Pipeline çš„å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+--------------------------------------------------------+</span><br><span class="line">|                                                        |</span><br><span class="line">|  Pipeline                                              |</span><br><span class="line">|                                                        |</span><br><span class="line">|  +-----------+     +------------+      +------------+  |</span><br><span class="line">|  |  Stage 1  |----&gt;|   Stage 2  |-----&gt;|   Stage 3  |  |</span><br><span class="line">|  +-----------+     +------------+      +------------+  |</span><br><span class="line">|                                                        |</span><br><span class="line">+--------------------------------------------------------+</span><br></pre></td></tr></table></figure><h4 id="Jobs"><a href="#Jobs" class="headerlink" title="Jobs"></a>Jobs</h4><p>Jobs è¡¨ç¤ºæ„å»ºå·¥ä½œï¼Œè¡¨ç¤ºæŸä¸ª Stage é‡Œé¢æ‰§è¡Œçš„å·¥ä½œã€‚æˆ‘ä»¬å¯ä»¥åœ¨ Stages é‡Œé¢å®šä¹‰å¤šä¸ª Jobsï¼Œè¿™äº› Jobs ä¼šæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>ç›¸åŒ Stage ä¸­çš„ Jobs ä¼šå¹¶è¡Œæ‰§è¡Œ</li><li>ç›¸åŒ Stage ä¸­çš„ Jobs éƒ½æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œè¯¥ Stage æ‰ä¼šæˆåŠŸ</li><li>å¦‚æœä»»ä½•ä¸€ä¸ª Job å¤±è´¥ï¼Œé‚£ä¹ˆè¯¥ Stage å¤±è´¥ï¼Œå³è¯¥æ„å»ºä»»åŠ¡ (Pipeline) å¤±è´¥</li></ul><p>Jobs å’Œ Stage çš„å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+------------------------------------------+</span><br><span class="line">|                                          |</span><br><span class="line">|  Stage 1                                 |</span><br><span class="line">|                                          |</span><br><span class="line">|  +---------+  +---------+  +---------+   |</span><br><span class="line">|  |  Job 1  |  |  Job 2  |  |  Job 3  |   |</span><br><span class="line">|  +---------+  +---------+  +---------+   |</span><br><span class="line">|                                          |</span><br><span class="line">+------------------------------------------+</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸€ä¸ª<code>.gitlab-ci.yaml</code>  æ ·ä¾‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">analytics</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">package</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">analytics</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tags</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== å¼€å§‹ä»£ç è´¨é‡æ£€æµ‹ ==============="</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== ç»“æŸä»£ç è´¨é‡æ£€æµ‹ ==============="</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tags</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">runner-tag</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== å¼€å§‹ç¼–è¯‘ä»»åŠ¡ ==============="</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== ç»“æŸç¼–è¯‘ä»»åŠ¡ ==============="</span></span><br><span class="line"></span><br><span class="line"><span class="attr">package:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">package</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">runner-tag</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== å¼€å§‹æ‰“åŒ…ä»»åŠ¡  ==============="</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== ç»“æŸæ‰“åŒ…ä»»åŠ¡  ==============="</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tags</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">runner-tag</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== å¼€å§‹æµ‹è¯•ä»»åŠ¡ ==============="</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== ç»“æŸæµ‹è¯•ä»»åŠ¡ ==============="</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy_test:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">deploy</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">runner-tag</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== è‡ªåŠ¨éƒ¨ç½²åˆ°æµ‹è¯•æœåŠ¡å™¨  ==============="</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">test</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://staging.example.com</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy_test_manual:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">deploy</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">runner-tag</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== æ‰‹åŠ¨éƒ¨ç½²åˆ°æµ‹è¯•æœåŠ¡å™¨  ==============="</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">test</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://staging.example.com</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">manual</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy_production_manual:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">deploy</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">runner-tag</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== æ‰‹åŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨  ==============="</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">production</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://staging.example.com</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">manual</span></span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹å¥½ <code>.gitlab-ci.yaml</code> ä¹‹åï¼Œå°† CI/CD è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°çš„ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œä½¿ç”¨å˜é‡çš„æ–¹å¼å¡«å…¥åœ¨ é¡¹ç›® <code>è®¾ç½®</code> â€”&gt; <code>CI/CD</code> â€”&gt; <code>å˜é‡</code> é‡Œã€‚æ¯”å¦‚ Harbor ä»“åº“çš„ç”¨æˆ·åå¯†ç ã€ssh å¯†é’¥ä¿¡æ¯ã€æ•°æ®åº“é…ç½®ä¿¡æ¯ç­‰æœºå¯†ä¿¡æ¯ã€‚</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CI_REGISTRY: # Harbor é•œåƒä»“åº“çš„åœ°å€</span><br><span class="line">CI_REGISTRY_USER: # Harbor ç”¨æˆ·å</span><br><span class="line">CI_REGISTRY_PASSWORD: # Harbor å¯†ç </span><br><span class="line">CI_REGISTRY_IMAGE: # æ„å»ºé•œåƒçš„åç§°</span><br><span class="line">SSH_PASSWORD: # éƒ¨ç½²æµ‹è¯•æœåŠ¡å™¨ ssh å¯†ç </span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200327102511419.png" alt="image-20200327102511419"></p><ul><li>è®¾ç½®å¥½ç›¸å…³å˜é‡ä¹‹ååœ¨ï¼Œåœ¨é¡¹ç›®é¡µé¢çš„ <code>CI/CD</code> â€”â€“&gt; <code>æµæ°´çº¿</code> é¡µé¢ç‚¹å‡» <code>è¿è¡Œæµæ°´çº¿</code>æ‰‹åŠ¨è§¦å‘æµæ°´çº¿ä»»åŠ¡è¿›è¡Œæµ‹è¯•ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200325163138089.png" alt="image-20200325163138089"></p><ul><li>å¦‚æœæµæ°´çº¿ä»»åŠ¡æ„å»ºæˆåŠŸçš„è¯ï¼Œä¼šæ˜¾ç¤º <code>å·²é€šè¿‡</code> çš„è¡¨ç¤º</li></ul><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200325163254316.png" alt="image-20200325163254316"></p><ul><li>ç™»å½•åˆ° Harbor <a href="http://10.10.107.217" target="_blank" rel="noopener">http://10.10.107.217</a> æŸ¥çœ‹é•œåƒæ˜¯å¦æ„å»ºæˆåŠŸ</li></ul><p><img src="https://cdn.jsdelivr.net/gh/muzi502/blog/source/img/image-20200325163400519.png" alt="image-20200325163400519"></p><h2 id="å‚è€ƒ-æ¨è"><a href="#å‚è€ƒ-æ¨è" class="headerlink" title="å‚è€ƒ/æ¨è"></a>å‚è€ƒ/æ¨è</h2><ul><li><p><a href="https://docs.gitlab.com/runner/" target="_blank" rel="noopener">GitLab Runner Docs</a></p></li><li><p><a href="https://docs.gitlab.com/ee/README.html" target="_blank" rel="noopener">GitLab Docs</a></p></li><li><p><a href="https://nicksors.cc/2019/07/12/kubernetesç³»åˆ—ä¹‹ã€Šæ„å»ºä¼ä¸šçº§CICDå¹³å°-ä¸€-ã€‹.html" target="_blank" rel="noopener">kubernetesç³»åˆ—ä¹‹ã€Šæ„å»ºä¼ä¸šçº§CICDå¹³å°(ä¸€)ã€‹</a></p></li><li><p><a href="https://notes.mengxin.science/2018/09/02/gitlab-ci-cd-question-and-answer/" target="_blank" rel="noopener">GitLabçš„CI/CDä½¿ç”¨é—®é¢˜æ±‡æ€»</a></p></li><li><p><a href="https://moelove.info/2018/08/05/%E5%9F%BA%E4%BA%8E-GitLab-%E7%9A%84-CI-%E5%AE%9E%E8%B7%B5/" target="_blank" rel="noopener">åŸºäº GitLab çš„ CI å®è·µ</a></p></li><li><p><a href="https://blog.fleeto.us/courses/gitlab-notes/" target="_blank" rel="noopener">gitlab-notes</a></p></li><li><p><a href="https://xiaogenban1993.github.io/18.5/xiaomi_gitlabrunner.html" target="_blank" rel="noopener">gitlab runneréƒ¨ç½²ç»†èŠ‚ä¼˜åŒ–</a></p></li><li><p><a href="https://tech.meituan.com/2018/08/02/erp-cd-jenkins-pipeline.html" target="_blank" rel="noopener">Jenkinsçš„Pipelineè„šæœ¬åœ¨ç¾å›¢é¤é¥®SaaSä¸­çš„å®è·µ</a></p></li><li><p><a href="https://laogen.site/gitlab-ci/example-docker-ssh-deploy/" target="_blank" rel="noopener">GitLab CI ç¤ºä¾‹ï¼šDocker é•œåƒæ‰“åŒ…å‘å¸ƒ &amp; SSH éƒ¨ç½²</a></p></li><li><p><a href="https://theviper.xyz/gitlab-ci-cd-optimize.html" target="_blank" rel="noopener">gitlab CI/CDä¼˜åŒ–</a></p></li><li><p><a href="http://zacksleo.top/2017/04/22/GitLab-CI%E4%BD%BF%E7%94%A8Docker%E8%BF%9B%E8%A1%8C%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2/" target="_blank" rel="noopener">GitLab-CIä½¿ç”¨Dockerè¿›è¡ŒæŒç»­éƒ¨ç½²</a></p></li><li><p><a href="https://furur.xyz/2019/11/03/docker-gitlab-ci-deploy-springboot-project/" target="_blank" rel="noopener">Docker Gitlab CI éƒ¨ç½² Spring Boot é¡¹ç›®</a></p></li><li><p><a href="https://wsgzao.github.io/post/gitlab/" target="_blank" rel="noopener">RHEL7/CentOS7 åœ¨çº¿å’Œç¦»çº¿å®‰è£… GitLab é…ç½®ä½¿ç”¨å®è·µ</a></p></li><li><p><a href="https://wayjam.me/post/how-gitlab-shell-works-with-ssh.md" target="_blank" rel="noopener">GitLab Shellå¦‚ä½•é€šè¿‡SSHå·¥ä½œ</a></p></li><li><p><a href="https://websoft9.gitbook.io/gitlab-image-guide/" target="_blank" rel="noopener">GitLabé•œåƒæ‰‹å†Œ</a></p></li><li><p><a href="https://xuanwo.io/2016/04/13/gitlab-install-intro/" target="_blank" rel="noopener">Gitlabéƒ¨ç½²å’Œæ±‰åŒ–ä»¥åŠç®€å•è¿ç»´</a></p></li></ul><h2 id="ç¤¾ç¾¤é—®ç­”-QA-CI-CD-ç›¸å…³"><a href="#ç¤¾ç¾¤é—®ç­”-QA-CI-CD-ç›¸å…³" class="headerlink" title="ç¤¾ç¾¤é—®ç­” QA | CI/CD ç›¸å…³"></a>ç¤¾ç¾¤é—®ç­” QA | CI/CD ç›¸å…³</h2><p>ä»¥ä¸‹å†…å®¹æ˜¯æ•´ç†æ‘˜è‡ª <a href="https://blog.k8s.li/K8s-QA.html">ã€Š(2000+) kubernetes ç¤¾ç¾¤åˆ†äº« QA æ±‡æ€»ã€‹</a>ï¼Œä¸­æœ‰å…³ CI/CD ç›¸å…³çš„é—®ç­”ï¼Œä» 2000 å¤šä¸ª QA é‡Œä½¿ç”¨å…³é”®å­—æœç´¢ Gitlabã€CI/CDã€Jenkins ç­‰ï¼Œç„¶åå°†ä¸€äº›ç›¸å…³çš„é—®é¢˜è¿›è¡Œæ±‡æ€»ã€‚æ–¹ä¾¿é—®é¢˜è‡ªæŸ¥å’Œä»ä¸­å¸å–ç»éªŒã€‚</p><h3 id="2019-04-03ï¼šå®¹å™¨ç¯å¢ƒä¸‹çš„æŒç»­é›†æˆæœ€ä½³å®è·µ"><a href="#2019-04-03ï¼šå®¹å™¨ç¯å¢ƒä¸‹çš„æŒç»­é›†æˆæœ€ä½³å®è·µ" class="headerlink" title="2019-04-03ï¼šå®¹å™¨ç¯å¢ƒä¸‹çš„æŒç»­é›†æˆæœ€ä½³å®è·µ"></a>2019-04-03ï¼šå®¹å™¨ç¯å¢ƒä¸‹çš„æŒç»­é›†æˆæœ€ä½³å®è·µ</h3><blockquote><p>Qï¼šKubernetes ä¸Šä¸»æµçš„ CI/CD æ–¹æ¡ˆæ˜¯å•¥ï¼Ÿ</p></blockquote><p>Aï¼šå…¶å®è¿™æ— å…³Kubernetesï¼Œä»å¸‚åœºå æœ‰ç‡æ¥çœ‹ï¼Œå‰ä¸‰ååˆ†åˆ«æ˜¯ Jenkinsã€JetBrains TeamCityã€CircleCIã€‚<a href="https://www.datanyze.com/market-share/ci" target="_blank" rel="noopener">æ¥æºï¼š</a></p><blockquote><p>Qï¼šGitLab è‡ªå¸¦çš„ CI ä¸Jenkins å’Œ GitLab ç»“åˆçš„ CIï¼Œè¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿæƒ³çŸ¥é“æ›´æ·±å±‚æ¬¡çš„ç†è§£ã€‚</p></blockquote><p>Aï¼šè¿˜æ˜¯è¦ç»“åˆè‡ªå·±å›¢é˜Ÿçš„å®é™…æƒ…å†µåšé€‰æ‹©ã€‚ä»æˆç†Ÿåº¦æ¥è¯´ï¼Œè‚¯å®šæ˜¯ Jenkinsç”¨æˆ·æœ€å¤šï¼Œæˆç†Ÿåº¦æœ€é«˜ï¼Œç¼ºç‚¹æ˜¯ä¾§é‡ Javaï¼Œé…ç½®ç›¸å¯¹ç¹çã€‚GitLab è‡ªå¸¦çš„ CIç›¸å¯¹ç®€å•ï¼Œå¯ä»¥ç”¨ yamlï¼Œå’Œ GitLab ç»“åˆçš„æœ€å¥½ï¼Œä½†åŠŸèƒ½è‚¯å®šæ²¡æœ‰ Jenkinså…¨é¢ã€‚å¦‚æœæ˜¯å°å›¢é˜Ÿæ–°é¡¹ç›®ï¼ŒGitLab CI åˆå·²ç»å¯ä»¥æ»¡è¶³éœ€æ±‚çš„è¯ï¼Œå¹¶ä¸éœ€è¦ä¸ŠJenkinsï¼Œå¦‚æœæ˜¯è¾ƒå¤§çš„å›¢é˜Ÿï¼Œåˆæ˜¯å Java çš„ï¼Œä¸ªäººæ›´åå‘ Jenkinsã€‚</p><blockquote><p>Qï¼šJenkins å¦‚æœä¸æƒ³è¿è¡Œåœ¨ Kubernetes é‡Œé¢ï¼Œè¯¥æ€ä¹ˆå’Œ Kubernetes é›†æˆï¼Ÿ</p></blockquote><p>Aï¼šä» CI çš„æµç¨‹æ¥è¯´ï¼ŒCI åº”ç”¨æ˜¯ä¸æ˜¯è·‘åœ¨ Kubernetes çš„å¹¶ä¸é‡è¦ï¼ŒCIåªè¦èƒ½è®¿é—®ä»£ç åº“ï¼Œæœ‰æƒé™åœ¨ç”Ÿäº§ç¯å¢ƒå‘å¸ƒï¼Œæ˜¯ä¸æ˜¯è·‘åœ¨å®¹å™¨é‡Œä»æ•ˆæœæ¥è¯´å…¶å®æ²¡æœ‰åŒºåˆ«ï¼Œåªæ˜¯ç”¨Kubernetes éƒ¨ç½² Jenkinsçš„è¯ï¼Œè¿ç»´çš„ä¸€è‡´æ€§æ¯”è¾ƒå¥½ï¼Œè¿ç»´å›¢é˜Ÿä¸ç”¨é¢å¤–èŠ±æ—¶é—´ç»´æŠ¤ä¸€å¥—ç‰©ç†æœºçš„éƒ¨ç½²æ–¹æ¡ˆã€‚</p><blockquote><p>Qï¼šKubernetesçš„å›æ»šæ–¹æ¡ˆæ˜¯å›æ»šä»£ç ï¼Œé‡åšé•œåƒï¼Œè¿˜æ˜¯å…ˆåˆ‡æµé‡ï¼Œååšä¿®æ”¹ï¼Ÿ</p></blockquote><p>Aï¼šä»£ç ä¸€å®šæ˜¯æ‰“åŒ…åˆ°é•œåƒé‡Œçš„ï¼Œé•œåƒçš„ç‰ˆæœ¬å°±æ˜¯ä»£ç çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¸€å®šæ˜¯åˆ‡é•œåƒã€‚è‡³äºå›æ»šæ“ä½œæœ¬èº«ï¼ŒKuberneteså·²ç»å†…ç½®äº†å¾ˆå¤šæ»šåŠ¨å‘å¸ƒï¼ˆRollingupdateï¼‰çš„ç­–ç•¥ï¼Œæ— è®ºæ˜¯å‘æ–°ç‰ˆæœ¬è¿˜æ˜¯å›æ»šç‰ˆæœ¬ï¼Œéƒ½å¯ä»¥åšåˆ°ç”¨æˆ·æ— æ„ŸçŸ¥ã€‚</p><blockquote><p>Qï¼šé•œåƒå¤§åˆ°å‡  G çš„è¯å¦‚ä½•æ›´æ–°éƒ¨ç½²ï¼Œæœ‰ä»€ä¹ˆå¥½çš„å®è·µå‘¢ï¼Œä»¥åŠå¦‚ä½•å›æ»šï¼Ÿ</p></blockquote><p>Aï¼šå‡ ä¸ªè¦ç‚¹ï¼š&gt; Qï¼šDrone å¼€æ”¾ API æœåŠ¡å—ï¼Ÿè¿™æ ·æ–¹ä¾¿å…¶ä»–ç³»ç»Ÿé›†æˆã€‚</p><p>Aï¼šå¯ä»¥è°ƒæ•´ä¸€ä¸‹æ€è·¯ï¼Œç›´æ¥æŠŠéœ€è¦çš„åŠŸèƒ½åšæˆé•œåƒåœ¨ Drone é‡Œè°ƒç”¨å°±å¥½äº†ã€‚</p><blockquote><p>Qï¼šå¦‚æœæœ‰ Drone çš„ Serveræ€ä¹ˆåšé«˜å¯ç”¨ï¼Ÿ</p></blockquote><p>Aï¼šDrone serve rç”¨ Kuberneteséƒ¨ç½²çš„è¯æœ¬èº«åªèµ·åˆ°äº†ä¸€ä¸ªä»»åŠ¡è°ƒåº¦çš„ä½œç”¨ï¼Œå¾ˆéš¾ä¼šé‡åˆ°æ€§èƒ½ç“¶é¢ˆã€‚çœŸçš„æœ‰æ€§èƒ½é—®é¢˜å¯ä»¥å°è¯•æ°´å¹³æ‰©å±•Drone serverï¼Œå…±äº«åŒä¸€æ•°æ®åº“ã€‚</p><h3 id="åŸºäº-GitLab-çš„-CI-å®è·µ"><a href="#åŸºäº-GitLab-çš„-CI-å®è·µ" class="headerlink" title="åŸºäº GitLab çš„ CI å®è·µ"></a><a href="https://moelove.info/2018/08/05/åŸºäº-GitLab-çš„-CI-å®è·µ/" target="_blank" rel="noopener">åŸºäº GitLab çš„ CI å®è·µ</a></h3><blockquote><p>Qï¼šæ‚¨æåˆ°æŠŠå„ç§ä¾èµ–éƒ½ä»¥ Service çš„æä¾›ï¼Œè¯·é—®æ˜¯ä»¥å“ªç§æ–¹å¼å‘¢ï¼Ÿ æ¯”å¦‚Pythonçš„ä¾èµ–ï¼Œæ€ä¹ˆåšæˆServiceå‘¢ï¼Ÿ</p></blockquote><p>Aï¼šService åŒ–çš„ä¾èµ–ï¼Œä¸»è¦æ˜¯æŒ‡ç±»ä¼¼ DB / MySQL/ Reids ä¹‹ç±»çš„ã€‚ æˆ–è€…æ˜¯ dind å…¶å®å®ƒæä¾›çš„æ˜¯ 2375 ç«¯å£çš„TCPæœåŠ¡ã€‚ Python çš„ä¾èµ–ï¼Œæˆ‘æ¨èçš„åšæ³•æ˜¯ï¼Œ æ„å»ºä¸€ä¸ªæ¢äº†æºçš„ Python é•œåƒã€‚ å®‰è£…ä¾èµ–çš„æ—¶å€™ï¼Œè€—æ—¶ä¼šå°‘å¾ˆå¤šã€‚ æˆ–è€…è¯´ï¼Œ å¯ä»¥åœ¨å®šä¹‰ Pipeline çš„æ—¶å€™ï¼Œ å°†è™šæ‹Ÿç¯å¢ƒçš„ venv æ–‡ä»¶å¤¹ä½œä¸º cache ï¼Œä¹‹åçš„å®‰è£…ä¹Ÿä¼šæ£€æŸ¥è¿™ä¸ªï¼Œé¿å…ä¸å¿…è¦çš„å®‰è£…ã€‚</p><blockquote><p>Qï¼šè¯·é—®ï¼Œä½ ä»¬ä¸ºä»€ä¹ˆä¸ç”¨Jenkins Pipelineï¼Œè€Œä½¿ç”¨GitLab CIï¼Ÿ</p></blockquote><p>Aï¼šä¸»è¦åŸå› æ˜¯æˆ‘æåˆ°çš„é‚£å‡ ä¸ªæ–¹é¢ã€‚ é›†æˆè¾ƒå¥½ï¼Œ ç•Œé¢ç¾è§‚ä¼˜é›…ï¼Œ ä½¿ç”¨ç®€å•ï¼ˆæ‰€æœ‰æœ‰ä»“åº“å†™æƒé™çš„äºº éƒ½å¯ä»¥ä½¿ç”¨ï¼Œ åªè¦åˆ›å»º .gitlab-ci.yml å¹¶ä¸”é…ç½®äº† Runner å³å¯ä½¿ç”¨ï¼‰ ã€‚æ¢ä¸ªè§’åº¦ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä½¿ç”¨Jenkins çš„é—®é¢˜ï¼Œ Jenkins å¯¹äºé¡¹ç›®çš„é…ç½®å…¶å®å’Œ GitLab çš„ä»£ç æ˜¯åˆ†ç¦»çš„ï¼Œ ä¸¤éƒ¨åˆ†çš„ï¼Œ ç”¨æˆ·ï¼ˆæˆ–è€…è¯´æˆ‘ä»¬çš„å¼€å‘è€…ï¼‰åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œ éœ€è¦æœ‰ä¸¤ä¸ªå¹³å°ï¼Œ å¹¶ä¸”ï¼Œå¤§å¤šæ•°æ—¶å€™ï¼Œ Jenkins çš„æƒé™æ˜¯ä¸æ”¾å¼€çš„ã€‚ å¯¹ç”¨æˆ·æ¥è®²ï¼Œ é‚£ç›¸å½“äºæ˜¯ä¸ªé»‘ç›’ã€‚ é‚£å¯èƒ½çš„é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ é‡åˆ°æ„å»ºå¤±è´¥äº†ï¼Œ ä½†æ˜¯åªæœ‰è¿ç»´çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä½†æ˜¯ç ”å‘æ— èƒ½ä¸ºåŠ›ï¼Œå› ä¸ºæ²¡æœ‰æƒé™ã€‚ ä½¿ç”¨GItLabçš„å¥½å¤„ï¼Œè¿™ä¸ªæ—¶å€™å°±æ›´åŠ çªå‡ºäº†ï¼Œ é…ç½®å°±åœ¨ä»£ç ä»“åº“é‡Œé¢ï¼Œå¹¶ä¸”ä½¿ç”¨ YAML çš„é…ç½®ï¼Œå¾ˆç®€å•ã€‚ æœ‰å•¥é—®é¢˜ï¼Œç›´æ¥æŸ¥ï¼Œç›´æ¥æ”¹ã€‚</p><blockquote><p>Qï¼šå…³äº Runner çš„æ¸…ç†çš„é—®é¢˜ï¼Œåœ¨é•¿æ—¶é—´ä½¿ç”¨åï¼ŒRunner æœºå™¨ä¸Šå›äº§ç”Ÿå¾ˆå¤šçš„ Cache å®¹å™¨ï¼Œå¦‚ä½•æ¸…ç†å‘¢ã€‚èƒ½å¤Ÿåœ¨ä»»åŠ¡ä¸­è‡ªåŠ¨æ¸…é™¤å—ï¼Ÿ</p></blockquote><p>Aï¼šè¿™ä¸ªå°±ç›¸å¯¹ç®€å•äº†ï¼Œé¦–å…ˆï¼Œ å¦‚æœä½ çš„ Cache å®¹å™¨ç¡®è®¤æ²¡ç”¨äº†ï¼Œ æ¯ä¸ª Cache å®¹å™¨å…¶å®éƒ½æœ‰åå­—çš„ï¼Œ ç›´æ¥æŒ‰ Cache çš„åå­—è¿‡ç•¥ï¼Œ æ‰¹é‡åˆ æ‰ã€‚ å¦‚æœä½ ä¸ç¡®å®šå®ƒæ˜¯å¦æœ‰ç”¨ï¼Œé‚£ä½ ç›´æ¥åˆ æ‰ä¹Ÿæ˜¯ä¸å½±å“çš„ï¼Œ å› ä¸º Docker Excutor çš„æ‰§è¡Œæœºåˆ¶æ˜¯åˆ›å»ºå®Œ Service å®¹å™¨åï¼Œ åˆ›å»º Cache å®¹å™¨ã€‚ è¦æ˜¯åˆ æ‰äº†ï¼Œå®ƒåªæ˜¯ä¼šå†åˆ›å»ºä¸€æ¬¡ã€‚ å¦‚æœä½ æƒ³åœ¨ä»»åŠ¡ä¸­æ¸…é™¤ï¼Œ ç›®å‰è¿˜æ²¡åšç›¸å…³çš„å®è·µï¼Œå¾…æˆ‘å®è·µåï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å¾ˆä¼˜é›…çš„æ–¹å¼ã€‚</p><blockquote><p>Qï¼šè¯·é—®ä¸‹Mavençš„settings.xmlæ€ä¹ˆå¤„ç†ï¼Ÿæœ¬åœ°Mavenä»“åº“å‘¢ï¼Ÿ</p></blockquote><p>Aï¼šæˆ‘ä»¬æ„å»ºäº†ç§æœ‰çš„ Maven é•œåƒï¼Œ ç§æœ‰é•œåƒä¸­æ˜¯é»˜è®¤ä½¿ç”¨äº†æˆ‘ä»¬çš„ç§æœ‰æºã€‚ å¯¹äºé¡¹ç›®ä¸­ç”¨æˆ·æ— éœ€å…³æ³¨ settings.xml ä¸­æ˜¯å¦é…ç½®repoã€‚</p><blockquote><p>Qï¼šåœ¨GitLabçš„CDæ–¹æ¡ˆä¸­ï¼Œåœ¨éƒ¨ç½²çš„æ—¶å€™ï¼Œéœ€è¦åœ¨å˜é‡ä¸­é…ç½®è·³æ¿æœºçš„ç§é’¥ï¼Œå¦‚æœè¿™ä¸ªé¡¹ç›®æ˜¯å¯¹å…¬å¸æ•´éƒ¨é—¨å¼€å‘ï¼Œé‚£ä¹ˆå¦‚ä½•ä¿æŠ¤è¿™ä¸ªç§é’¥å‘¢ï¼Ÿ</p></blockquote><p>Aï¼šå¯ä»¥ä½¿ç”¨ secret variable å°†ç§é’¥å†™å…¥å…¶ä¸­ï¼Œ ï¼ˆä½†æ˜¯é¡¹ç›®çš„ç®¡ç†å‘˜ï¼Œå…·å¤‡æŸ¥çœ‹è¯¥ variable çš„æƒé™ï¼‰å¼€å‘ä¸€ä¸ª web server ï¼ˆå…¶å®åªè¦æš´éœ² IP ç«¯å£ä¹‹ç±»çš„å°±å¯ä»¥ï¼‰ åœ¨ CI æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å»è¯·æ±‚ï¼Œ server å¯¹æ¥æºåšåˆ¤æ–­ ï¼ˆæ¯”å¦‚ æ‰§è¡ŒCI çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€äº›ç‰¹å®šçš„å˜é‡ï¼Œä»¥æ­¤æ¥åˆ¤æ–­ï¼Œæ˜¯å¦çœŸçš„æ˜¯ CI åœ¨è¯·æ±‚ï¼‰ç„¶åè¿”å›ç§é’¥ã€‚</p><blockquote><p>Qï¼šGitLab CIé€‚åˆä»€ä¹ˆç±»å‹çš„é¡¹ç›®å‘¢ï¼Ÿå›½å†…ç›®å‰è¿˜æ¯”è¾ƒå°ä¼—å§ï¼Ÿ</p></blockquote><p>Aï¼šå›½å†…ç›®å‰è¿˜è¾ƒä¸ºå°ä¼—ï¼ˆç›¸æ¯” Jenkins æ¥è¯´ï¼‰å…¶å®åªè¦éœ€è¦ CI çš„é¡¹ç›®ï¼Œå®ƒéƒ½é€‚åˆã€‚</p><h2 id="2015-09-23ï¼šåŸºäºDockerå’ŒJavaçš„æŒç»­é›†æˆå®è·µ"><a href="#2015-09-23ï¼šåŸºäºDockerå’ŒJavaçš„æŒç»­é›†æˆå®è·µ" class="headerlink" title="2015-09-23ï¼šåŸºäºDockerå’ŒJavaçš„æŒç»­é›†æˆå®è·µ"></a>2015-09-23ï¼šåŸºäºDockerå’ŒJavaçš„æŒç»­é›†æˆå®è·µ</h2><blockquote><p>Qï¼šCIè¿‡ç¨‹ä¸­testéœ€è¦è¿æ¥æ•°æ®åº“çš„ä»£ç æ—¶ï¼Œæ‚¨åœ¨å†™æµ‹è¯•æ¡ˆä¾‹æ–¹é¢æœ‰å“ªäº›ç»éªŒåˆ†äº«ï¼Ÿ</p></blockquote><p>Aï¼šå•å…ƒæµ‹è¯•ä¸èƒ½ä¾èµ–å¤–éƒ¨èµ„æºï¼Œç”¨mockï¼Œæˆ–è€…ç”¨h2ç­‰å†…å­˜æ•°æ®åº“æ›¿ä»£ã€‚é›†æˆæµ‹è¯•çš„æ—¶å€™æ˜¯ä»æ¥å£å±‚ç›´æ¥è°ƒç”¨æµ‹è¯•çš„ï¼Œæµ‹è¯•ç”¨ä¾‹å¯¹æ•°æ®åº“æ— æ„ŸçŸ¥ã€‚</p><blockquote><p>Qï¼šè¯·é—®éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ˜¯è‡ªåŠ¨è§¦å‘è¿˜æ˜¯éœ€è¦æ‰‹åŠ¨å®¡æ‰¹ï¼ŸSQLæ‰§è¡Œæˆ–å›æ»šæ˜¯å¦è‡ªåŠ¨åŒ–ï¼Ÿ</p></blockquote><p>Aï¼šå½“å‰æ˜¯éœ€è¦æ‰‹åŠ¨è§¦å‘ã€‚SQLæ›´æ–°å½“å‰æ²¡åšåˆ°è‡ªåŠ¨åŒ–ï¼Œè¿™å—æ­£åœ¨æ”¹è¿›ï¼Œå› ä¸ºéƒ¨ç½²ç§æœ‰ç¯å¢ƒéœ€è¦ã€‚SQLä¸æ”¯æŒå›æ»šï¼Œä»£ç åšå…¼å®¹ã€‚Dockeré•œåƒå›æ»šæ²¡æœ‰è‡ªåŠ¨åŒ–ã€‚</p><blockquote><p>Qï¼š é—®ä¸€ä¸‹ä½ ä»¬çš„Rediså†…å­˜ç‰ˆæ˜¯ç”¨çš„ä»€ä¹ˆï¼Ÿ</p></blockquote><p>Aï¼šæˆ‘ä»¬ç”¨çš„å†…å­˜ç‰ˆçš„redisæ˜¯ <a href="https://github.com/spullara/redis-protocol" target="_blank" rel="noopener">spullara/redis-protocol</a>ä¸­çš„serverå®ç°ã€‚ä¸è¿‡è¿™ä¸ªå®ç°éƒ¨åˆ†åŠŸèƒ½æ²¡æ”¯æŒï¼Œæ¯”å¦‚luaè„šæœ¬ï¼Œæˆ‘ä»¬è‡ªå·±åšäº†æ”¹è¿›ã€‚</p><blockquote><p>Qï¼šä»‹ç»ä¸‹workflowå¸¦æ¥çš„å¥½å¤„ã€‚</p></blockquote><p>Aï¼šworkflowçš„å¥½å¤„æˆ‘é‚£ç¯‡æ–‡ç« ä¸­æœ‰è¯´æ˜ï¼Œå¦‚æœæ²¡æœ‰workflowï¼Œæ‰€æœ‰çš„æ­¥éª¤éƒ½åœ¨åŒä¸€ä¸ªé…ç½®çš„ä¸åŒstepå®ç°ï¼Œå¦‚æœåé¢çš„å¤±è´¥ï¼Œè¦é‡æ–°ä»å¤´å¼€å§‹ã€‚workflowå¯ä»¥ä¸­é€”å¼€å§‹ï¼Œå¹¶ä¸”æ¯ä¸€æ­¥éª¤å®Œæˆéƒ½ä¼šè§¦å‘é€šçŸ¥ã€‚</p><blockquote><p>Qï¼šh2å¹¶ä¸å®Œå…¨å…¼å®¹MySQLè„šæœ¬ï¼Œä½ ä»¬å¦‚ä½•å¤„ç†çš„ï¼Ÿ</p></blockquote><p>Aï¼šæˆ‘ä»¬é€šè¿‡ä¸€äº›hackçš„åŠæ³•ï¼Œä¼šæ¢æµ‹ä¸‹æ•°æ®åº“æ˜¯ä»€ä¹ˆç±»å‹çš„ï¼Œæ›¿æ¢æ‰ä¸€äº›ä¸å…¼å®¹çš„SQLï¼Œè¿›è¡Œå®¹é”™ã€‚</p><blockquote><p>Qï¼šè¯·é—®ä½ ä»¬åœ¨æ„å»ºçš„æ—¶å€™ï¼Œä½ è¯´æœ‰äº›éœ€è¦åŠä¸ªå°æ—¶å·¦å³ï¼Œé‚£ä¹ˆæ„å»ºè¿‡ç¨‹çš„è¿›åº¦ç›‘æ§å’Œå¥åº·ç›‘æ§ä½ ä»¬æ€ä¹ˆåšçš„å‘¢ï¼Œå¦‚æœæœ‰buildå¤±è´¥äº†æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p></blockquote><p>Aï¼šCIçš„æ¯ä¸€æ­¥éƒ½æœ‰è¿›åº¦çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„å›¢é˜Ÿé€šè®¯å·¥å…·å¯ä»¥å’ŒCIé›†æˆï¼Œå¦‚æœå¤±è´¥ä¼šå‘æ¶ˆæ¯åˆ°ç¾¤é‡Œé€šçŸ¥å¤§å®¶ã€‚</p><blockquote><p>Qï¼šcleanupè„šæœ¬åšå“ªäº›ï¼Ÿ</p></blockquote><p>Aï¼šä¸»è¦æ˜¯æ¸…ç†æ—§çš„Dockeré•œåƒï¼Œä»¥åŠæ¸…ç†è‡ªåŠ¨åŒ–æµ‹è¯•äº§ç”Ÿçš„åƒåœ¾æ•°æ®ã€‚</p><blockquote><p>Qï¼šè¯·é—®ä½ ä»¬æ–‡ä»¶å­˜å‚¨æ€ä¹ˆè§£å†³çš„å‘¢ï¼Œä½¿ç”¨è‡ªå·±çš„ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿè¿˜æ˜¯äº‘æœåŠ¡ï¼Ÿ</p></blockquote><p>Aï¼šæ–‡ä»¶ç³»ç»Ÿæ”¯æŒå¤šç§storageé…ç½®ï¼Œå¯ä»¥æ˜¯æœ¬åœ°ç›®å½•ï¼ˆä¾¿äºæµ‹è¯•ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿äº‘æœåŠ¡ï¼ˆæ¯”å¦‚s3ï¼‰ã€‚</p><blockquote><p>Qï¼šåˆšæ‰è¯´ä½ ä»¬èƒ½é€šè¿‡ä¸€é”®éƒ¨ç½²ï¼Œä½†æ˜¯ä¸­é—´æ— æ³•ç›‘æ§ï¼Œæµ‹è¯•ç¯å¢ƒå¯ä»¥è¿™ä¹ˆç©ï¼Œé‚£ç”Ÿäº§ç¯å¢ƒä½ ä»¬æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿè¿˜æœ‰ä½ ä»¬åç»­çš„æ”¹é€ æ–¹å‘æ˜¯è‡ªå·±å¼€å‘ï¼Ÿè¿˜æ˜¯é‡‡ç”¨é›†æˆç¬¬ä¸‰æ–¹è½¯ä»¶ï¼Ÿ</p></blockquote><p>Aï¼šç”Ÿäº§ç¯å¢ƒshellå½“å‰åªèƒ½æ˜¯å¤šåŠ é”™è¯¯åˆ¤æ–­ã€‚è¿™å—æˆ‘ä»¬åœ¨æ”¹è¿›ï¼Œæ¯”å¦‚é€šè¿‡ansibleç­‰å·¥å…·ï¼Œä»¥åŠä½¿ç”¨Kuberneteså†…ç½®çš„rolling-updateã€‚è‡ªåŠ¨åŒ–éƒ¨ç½²è¿™å—è¿˜æ²¡æœ‰å¥½çš„å¼€æºå·¥å…·ã€‚</p><blockquote><p>Qï¼šä½ ä»¬çš„æµ‹è¯•ç”¨äº†å¾ˆå¤šä»£æ›¿æ–¹æ¡ˆã€å¦‚h2ä»£MySQLï¼Œè¦ä¿è¯æµ‹è¯•æ•ˆæœï¼Œé™¤äº†ä½ ä»¬ç”¨çš„hackæ–¹æ³•ä¹‹å¤–ï¼Œæ˜¯ä¸æ˜¯ä»å†™ä»£ç çš„æ—¶å€™å°±å¼€å§‹åšäº†æ–¹ä¾¿æµ‹è¯•çš„è®¾è®¡ï¼Ÿ</p></blockquote><p>Aï¼šå¯¹ã€‚è¿™ä¹Ÿæ˜¯æˆ‘æ–‡ç« ä¸­åˆ†äº«çš„è§‚ç‚¹ä¹‹ä¸€ã€‚æµ‹è¯•ç”¨ä¾‹çš„ç¼–å†™äººå‘˜è¦æœ‰ä¸šåŠ¡ä»£ç çš„ä¿®æ”¹æƒé™ï¼Œæœ€å¥½æ˜¯åŒä¸€ä¸ªäººã€‚è¦åšè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œä¸šåŠ¡ä»£ç å¿…é¡»è¦ç»™æµ‹è¯•ç•™å„ç§é’©å­ä»¥åŠåé—¨ã€‚</p><blockquote><p>Qï¼šè¯·é—®ä½ ä»¬çš„é›†ç¾¤åº”ç”¨ç¼–æ’æ€ä¹ˆåšçš„ï¼Ÿ</p></blockquote><p>Aï¼šä¸Šé¢è¯´äº†ï¼Œè¿˜æ²¡ç”¨åˆ°ç¼–æ’ã€‚ä¸€ç›´ç­‰ç¼–æ’å·¥å…·çš„æˆç†Ÿã€‚æ­£åœ¨æµ‹è¯•k8sã€‚</p><blockquote><p>Qï¼šä½ ä»¬åšè¿™ä¸ªé¡¹ç›®é€‰å‹æ˜¯å‡ºäºä»€ä¹ˆè€ƒè™‘çš„ï¼Œä»‹ç»é‡Œæœ‰æåˆ°ä½¿ç”¨ä¸€äº›è„šæœ¬æ¥ç®¡ç†å®¹å™¨è§£å†³å¼€å‘å’Œæµ‹è¯•å„ç§é—®é¢˜ï¼Œæ„Ÿè§‰è¿™ç§ç®¡ç†å®¹å™¨æ–¹å¼è¿‡äºç®€å•ä¼šå¸¦æ¥ç®¡ç†é—®é¢˜ï¼Œä¸ºä½•ä¸ç”¨ç¬¬ä¸‰æ–¹å¼€æºé¡¹ç›®æ¥åšäºŒæ¬¡å¼€å‘ï¼Œå¦‚ï¼šKubernetesï¼›å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä¸‹ä¸€æ­¥æœ‰æ²¡æœ‰è€ƒè™‘å¦‚ä½•è®©ä½ çš„Dockerå’Œäº‘æœåŠ¡å¹³å°ç»“åˆï¼Œè¦è§£å†³è¿è¥æˆæœ¬é—®é¢˜ï¼ˆDockeræœ€å¤§å¸å¼•åŠ›åœ¨è¿™é‡Œï¼‰ï¼Œè€Œä¸åªæ˜¯è§£å†³å¼€å‘æµ‹è¯•é—®é¢˜ï¼Ÿ</p></blockquote><p>Aï¼šå› ä¸ºæˆ‘ä»¬æœ€æ—©ç”¨çš„æ—¶å€™k8s 1.0 è¿˜æ²¡æœ‰ï¼Œå˜åŒ–å¤ªå¤§ï¼Œåˆ›ä¸šå›¢é˜Ÿæ²¡ç²¾åŠ›è·Ÿè¿›ï¼Œè„šæœ¬æ˜¯ç²—æš´ç®€å•çš„åŠæ³•ã€‚ä¸€ç›´åœ¨ç­‰å¾…å„ç§åŸºäºDockerçš„äº‘è§£å†³æ–¹æ¡ˆå‘€ï¼Œè‚¯å®šè€ƒè™‘ç»“åˆã€‚</p><blockquote><p>Qï¼šå¯¹äºDocker storageåˆ†åŒºç”¨å®Œé—®é¢˜ï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹ï¼Œä½ ä»¬æ˜¯ä½¿ç”¨Dockerå®˜æ–¹æä¾›çš„Registryä»“åº“å—ï¼Œå¦‚ä½•è§£å†³ä»“åº“å•ç‚¹é—®é¢˜ï¼Œè¿™æœºå™¨è¦æ˜¯æ•…éšœäº†æ€ä¹ˆåŠï¼Ÿ</p></blockquote><p>Aï¼šRegistryç”¨çš„æ˜¯å®˜æ–¹çš„ï¼Œåç«¯å­˜å‚¨æ˜¯æŒ‚è½½åˆ°s3ä¸Šçš„ã€‚æ²¡æœ‰s3,æ¨èä½¿ç”¨äº¬ä¸œç”°çªå›¢é˜Ÿå¼€æºçš„<a href="https://github.com/jcloudpub/speedy" target="_blank" rel="noopener">Speedy</a>ï¼Œå®ç°äº†åˆ†å¸ƒå¼å­˜å‚¨ã€‚</p><blockquote><p>Qï¼šé™¤äº†ä»‹ç»çš„Javaç›¸å…³çš„CIæ–¹æ¡ˆï¼Œå¯¹äºC/C++å¼€å‘è¯­è¨€æœ‰æ²¡æœ‰æ¨èçš„CIæ–¹æ¡ˆï¼Ÿ</p></blockquote><p>Aï¼šTeamcity/Jenkinsç­‰CIå·¥å…·æ”¯æŒä»»ä½•è¯­è¨€çš„ã€‚å…¶å®ä»»ä½•è¯­è¨€çš„CIéƒ½å·®ä¸å¤šï¼Œå•å…ƒæµ‹è¯•ï¼Œé›†æˆæµ‹è¯•ã€‚å…³é”®è¿˜åœ¨äºä¾èµ–ç¯å¢ƒçš„å‡†å¤‡ä»¥åŠé›†æˆæµ‹è¯•ç”¨ä¾‹çš„ç®¡ç†ã€‚</p><blockquote><p>Qï¼šæˆ‘çœ‹åˆ°ä½ ä»¬ä¸ºäº†æ–¹ä¾¿æµ‹è¯•å’Œè°ƒè¯•ä¼šæœ‰ç‹¬ç«‹çš„é›†åˆDockerç¯å¢ƒï¼Œè¿™ç§ç¯å¢ƒå’Œä¸Šçº¿ç¯å¢ƒå…¶å®æ˜¯æœ‰å·®åˆ«çš„ï¼Œè¿™æ ·æµ‹è¯•çš„ç»“æœèƒ½å¤Ÿä»£è¡¨çº¿ä¸Šç¯å¢ƒå—ï¼Ÿè¿™ç§é—®é¢˜æ€ä¹ˆçœ‹å¾…ï¼Ÿ</p></blockquote><p>Aï¼šæ‰€ä»¥æˆ‘ä»¬æœ‰å¤šä¸ªæµç¨‹ã€‚æ¸…ç†æ•°æ®çš„æµ‹è¯•ç¯å¢ƒï¼Œä»¥åŠä¸æ¸…ç†ç¯å¢ƒçš„æ²™ç®±ç¯å¢ƒã€‚ä½†è¿™ä¹Ÿä¸èƒ½é¿å…ä¸€éƒ¨åˆ†çº¿ä¸Šç¯å¢ƒçš„æ•°æ®å¯¼è‡´çš„bugã€‚å¦å¤–å°±æ˜¯é…åˆç°åº¦ä¸Šçº¿æœºåˆ¶ã€‚å½“å‰æˆ‘ä»¬çš„ç°åº¦æ˜¯é€šè¿‡ä»£ç ä¸­çš„å¼€å…³å®ç°çš„ï¼Œä½¿ç”¨è¿™ç§æ–¹æ¡ˆçš„ä¹Ÿå¾ˆå¤šï¼Œæ¯”å¦‚facebookçš„Gatekeeperã€‚</p><blockquote><p>Qï¼šè¯·é—®Groukæœ‰æ¶‰åŠå‰ç«¯ï¼ˆNode.jsæ–¹é¢çš„ï¼‰å¹¶ç»“åˆDockerçš„CI/CDç»å†å—ï¼Œå¯ä»¥åˆ†äº«ä¸‹å—ï¼Ÿ</p></blockquote><p>Aï¼šè¿™æˆ‘ä»¬ä¹Ÿåœ¨å°è¯•ã€‚å½“å‰jsçš„æµ‹è¯•ä¸»è¦è¿˜æ˜¯åŸºäº<a href="https://github.com/ariya/phantomjs" target="_blank" rel="noopener">ariya/phantomjs</a>ï¼Œçº¯ç²¹çš„jsåº“æ¯”è¾ƒæ–¹ä¾¿æµ‹è¯•ï¼Œä½†å¦‚æœç‰µæ‰¯åˆ°ç•Œé¢ï¼Œå°±æ¯”è¾ƒå¤æ‚äº›äº†ã€‚</p><h2 id="2015-12-22ï¼šåŸºäºDockerå’ŒGitçš„æŒç»­é›†æˆå·¥ä½œæµ"><a href="#2015-12-22ï¼šåŸºäºDockerå’ŒGitçš„æŒç»­é›†æˆå·¥ä½œæµ" class="headerlink" title="2015-12-22ï¼šåŸºäºDockerå’ŒGitçš„æŒç»­é›†æˆå·¥ä½œæµ"></a>2015-12-22ï¼šåŸºäºDockerå’ŒGitçš„æŒç»­é›†æˆå·¥ä½œæµ</h2><blockquote><p>Qï¼šå¼€å‘æ¯æäº¤ä¸€ä¸ªbugfixï¼Œéƒ½ä¼šè§¦å‘jinkenså»æ„å»ºé•œåƒï¼Œé‚£ä¹ˆå¤šçš„å¼€å‘è€…ï¼Œå²‚ä¸æ˜¯è¦æ„å»ºå¾ˆå¤šé•œåƒï¼Ÿ</p></blockquote><p>Aï¼šæ²¡æœ‰é”™ï¼Œæˆ‘ä»¬æ˜¯æ¯æ¬¡éƒ½è§¦å‘æ„å»º imageï¼Œç”±äºimageæ˜¯åˆ†å±‚çš„ï¼Œåº•å±‚å·²ç»å­˜åœ¨çš„çˆ¶å¯¹è±¡ï¼Œæ˜¯ä¸ç”¨å­˜å‚¨ï¼Œåªå­˜å‚¨å˜åŒ–çš„éƒ¨åˆ†æ‰€ä»¥å†ç”¨çš„ç£ç›˜ç©ºé—´å¾ˆä½ï¼Œåœ¨ç³»ç»Ÿå¼€å§‹åˆï¼Œæˆ‘åšè¿‡ç»Ÿè®¡ï¼Œ1000ä¸ª image ä¹Ÿä¸åˆ° 9Gï¼Œè¿™å…¶ä¸­è¿˜æœ‰å¾ˆå¤šåŸºç¡€é•œåƒã€‚</p><blockquote><p>Qï¼šæƒ³é—®ä¸€ä¸ªé›†ç¾¤ç›¸å…³çš„ï¼ŒåƒDockeréƒ¨ç½²è¿™éƒ¨æ˜¯ç›´æ¥è°ƒç”¨Dockeréƒ¨ç½²å®¹å™¨ï¼Œè¿˜æ˜¯é€šè¿‡Ansibleæˆ–å…¶ä»–å·¥å…·ï¼Ÿ</p></blockquote><p>Aï¼šæœ‰äº† Kubernetes ç®¡ç†é›†ç¾¤åï¼Œå‘å¸ƒçš„å·¥ä½œå°±æ¯”è¾ƒç®€å•äº†ï¼Œç”¨ä¸ä¸Š Ansibleã€‚ä½†æ˜¯ Ansible è¿˜æ˜¯æœ‰å®ƒçš„ç”¨å¤„çš„ï¼Œæ¯”å¦‚æ¸…ç†é›†ç¾¤ä¸­è¿‡æ—¶çš„ imageï¼Œå’Œå·²ç»é€€å‡ºçš„ Containerç­‰ã€‚</p><blockquote><p>Qï¼šä½ å¥½ï¼Œä»¥å‰ä¹Ÿåšè¿‡ç±»ä¼¼çš„æœåŠ¡â€ç¬¬ä¸‰æ­¥ï¼šJenkins ä¼šæŠŠç›¸åº”çš„ imageéƒ¨ç½²åˆ°æœåŠ¡å™¨é›†ç¾¤ä¸­ï¼Œå¼€å‘è€…å°±å¯ä»¥é€šè¿‡ iss001.kingdeeè¿™ä¸ªåŸŸåè®¿é—®åˆšåˆšå¯¹åº”åˆ†æ”¯çš„æœåŠ¡äº†â€ï¼Œå•ç‹¬ä¸€ä¸ªåˆ†æ”¯è§£å†³äº†å¯¹åº”çš„bugï¼Œä½†å®é™…ç”Ÿäº§ä¸­éå¸¸å®¹æ˜“ä¿®æ”¹ä¸€ä¸ªbugå¼•èµ·å…¶ä»–çš„bugï¼Œä½ ä»¬æ˜¯æ€ä¹ˆå»æŠŠæ§æ•´ä½“çš„ç¨³å®šæ€§ï¼Ÿå¦‚ä½•æé«˜è¿™ç§å•ä¸ªbugåˆ†æ”¯å•ä¸ªæµ‹è¯•ç¯å¢ƒçš„æ„ä¹‰ï¼Ÿ</p></blockquote><p>Aï¼šè¿™ä¸ª pull-request çš„å·¥ä½œæ–¹å¼æ˜¯åº”å¯¹åŠŸèƒ½å¼€å‘çš„ï¼Œå¦‚åƒé•¿æœŸå¼€å‘æŸä¸ª new featureï¼Œä½ åˆšåˆšè¯´çš„ä¸€ä¸ª bug äº§ç”Ÿå¦å¤–ä¸€ä¸ªbugï¼Œæˆ‘ä»¬çš„åšæ³•æ˜¯æœ‰å›å½’æµ‹è¯•ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª smoke åˆ†æ”¯ï¼ŒæŒç»­ä¸æ–­çš„å¯¹å…¶åšåŠŸèƒ½å›å½’æµ‹è¯•ï¼Œåªæœ‰é€šè¿‡çš„æ‰èƒ½ cherry pick åˆ°release ä¸Šã€‚</p><blockquote><p>Qï¼šæµ‹è¯•ç¯å¢ƒä¾èµ–çš„redis/MQä¹‹ç±»çš„å¤–éƒ¨æœåŠ¡å¦‚ä½•åšçš„éš”ç¦»?æ¯æ¬¡æµ‹è¯•å•ç‹¬æ‹‰èµ·æ¥ä¸€å¥—å¤–éƒ¨ä¾èµ–çš„æœåŠ¡å—ï¼Ÿ</p></blockquote><p>Aï¼šæˆ‘ä»¬é€šè¿‡å¤šä¸ªæ‰‹æ®µæ¥å®ç°å…±äº«æ•°æ®ï¼šmasterã€smokeã€release åˆ†æ”¯æµ‹è¯•éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ä¸­é—´ä»¶ï¼Œè¦æ˜¯ä¸ç”¨è®¿é—®å…±äº«çš„æ•°æ®ï¼Œå¯ä»¥éƒ¨ç½²å¦‚ MQ imageï¼Œä»£ç å±‚é¢çš„ï¼Œå¦‚ MQ key çš„åç§°åŠ ä¸Šæœºå™¨çš„ IPã€‚</p><blockquote><p>Qï¼šæœ‰æ²¡æœ‰ç”¨åˆ°Mesosï¼Ÿæ˜¯å¦å®¹æ˜“é‡åˆ°é—®é¢˜ï¼Ÿè¿™æ–¹é¢çš„æ–‡æ¡£å¥½åƒå¹¶ä¸å¤šã€‚</p></blockquote><p>Aï¼šMesos æ˜¯ä¸ªäºŒçº§è°ƒåº¦ï¼Œé€‚ç”¨äºåƒå­˜åœ¨å¤šå¥—é›†ç¾¤çš„æƒ…å†µï¼Œæ¥å‡è¡¡èµ„æºï¼Œå¦‚ï¼šéƒ¨ç½²äº† Hadoop å’Œ storm ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨ storm æ¥å¤„ç†å®æ—¶çš„è¯·æ±‚ï¼ŒHadoop åšç¦»çº¿å·¥ä½œã€‚æ™šä¸Šå’Œç™½å¤©å°±å­˜åœ¨ä¸€ç§å¯èƒ½å°±æ˜¯ Hadoop é—²ç½®ï¼Œä½†æ˜¯ storm å¯èƒ½å¾ˆå¿™ï¼Œè¿™æ—¶ Mesos è¿™æ ·çš„äºŒçº§è°ƒåº¦å°±å¯ä»¥å¹³è¡¡èµ„æºï¼ŒèŠ‚çº¦æˆæœ¬ï¼Œæˆ‘ä»¬æš‚æ—¶æ²¡æœ‰è¿™æ ·çš„éœ€æ±‚ã€‚è‡³äºæ–‡æ¡£æ–¹é¢æˆ‘ä¹Ÿæ²¡æœ‰æ·±å…¥ç ”ç©¶ï¼Œå»ºè®®çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p><blockquote><p>Qï¼šè¯·é—®ä½ ä»¬åœ¨æ„å»ºçš„æ—¶å€™ï¼Œä½ è¯´æœ‰äº›éœ€è¦åŠä¸ªå°æ—¶å·¦å³ï¼Œé‚£ä¹ˆæ„å»ºè¿‡ç¨‹çš„è¿›åº¦ç›‘æ§å’Œå¥åº·ç›‘æ§ä½ ä»¬æ€ä¹ˆåšçš„å‘¢ï¼Œå¦‚æœæœ‰buildå¤±è´¥äº†æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p></blockquote><p>Aï¼šCIçš„æ¯ä¸€æ­¥éƒ½æœ‰è¿›åº¦çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„å›¢é˜Ÿé€šè®¯å·¥å…·å¯ä»¥å’ŒCIé›†æˆï¼Œå¦‚æœå¤±è´¥ä¼šå‘æ¶ˆæ¯åˆ°ç¾¤é‡Œé€šçŸ¥å¤§å®¶ã€‚</p><h2 id="QA-Gitlab"><a href="#QA-Gitlab" class="headerlink" title="QA Gitlab"></a>QA Gitlab</h2><blockquote><p>Q9ï¼šgitlabæ¥æ”¶ä¸€ä¸ªpush eventè§¦å‘æ„å»ºï¼Œè¿™ä¸ªæ˜¯ç›‘æ§æ‰€æœ‰çš„åˆ†æ”¯å—ï¼Œåˆ†æ”¯æ¨¡å‹æ˜¯æ€ä¹ˆæ ·çš„</p></blockquote><p>Aï¼šä¸æ˜¯çš„ï¼ŒæŒ‰éœ€ã€‚æˆ‘ä»¬å†…éƒ¨åˆ†æ”¯æ¨¡å‹å¤§æ¦‚æœ‰å››ç§ï¼Œdevâ€”â€”&gt;testâ€”â€”&gt;releaseâ€”â€”&gt;masterã€‚masterä»¥å¤–çš„ä¸ºäº†æ•ˆç‡éƒ½ä¼šåšè‡ªåŠ¨è§¦å‘</p><blockquote><p>Q11ï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨gitlab-runner è€Œæ¥jenkins</p></blockquote><p>Aï¼šgitlab-runner éœ€è¦æ¯ä¸ªä»“åº“éƒ½é…ç½®æ„å»ºä¿¡æ¯ï¼Œå½“éœ€è¦ç»Ÿä¸€ä¿®æ”¹æ„å»ºçš„æ—¶å€™å¾ˆéº»çƒ¦</p><blockquote><p>Qï¼šæŒç»­é›†æˆç³»ç»Ÿå…·ä½“çš„ç»†èŠ‚å¯ä»¥é€éœ²ä¸‹å—ï¼ŸåŸºäºgitlab ciï¼Œjekinsï¼Ÿæˆ–è€…å°å…¬å¸å¯ä»¥ç›´æ¥ç”¨Spinnaker è¿™äº›å—ï¼Ÿ</p></blockquote><p>Aï¼šci cdçš„è¯å› ä¸ºæˆ‘ä»¬æœ‰è‡ªå·±ç°æœ‰çš„å‘å¸ƒå¹³å°ï¼ŒèƒŒåçš„åŸç†å®é™…ä¸Šè¿˜æ˜¯è°ƒç”¨jenkinså»å¤„ç†</p><blockquote><p>Qï¼šå’Œgitlab ciç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿</p></blockquote><p>Aï¼š å’Œ gitlab ci ç›¸æ¯”çš„ä¼˜åŠ¿å¯ä»¥å‚è€ƒä¸‹ jenkins ä¸ jenkins xçš„å¯¹æ¯”ã€‚åœ¨ç”¨æˆ·è§’åº¦æ¥è¯´ï¼Œä»¥åº”ç”¨ä¸ºè§†è§’ä½¿ç”¨èµ·æ¥ä¼šæ›´åŠ æ–¹ä¾¿ï¼Œä¹Ÿæ–¹ä¾¿åˆ©ç”¨ç¤¾åŒºèµ„æºã€‚ä»æ¶æ„å’Œå¯ç»´æŠ¤æ€§æ¥è¯´ï¼ŒJenkins X çš„æ¶æ„ä¼šç›¸å¯¹æ›´åŠ å…ˆè¿›ï¼ˆä¸è¯ç”Ÿå¹´ä»£æœ‰ç›´æ¥å…³ç³»)ã€‚</p><blockquote><p>Qï¼š ç›®å‰æˆ‘ä»¬ä½¿ç”¨çš„gitlab-ci-runner éƒ¨ç½²äºk8sä¹‹å¤–å®ç°ci/cdã€‚å‘ç°gitlab-ciåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°å¡æ­»æŠ¥é”™ã€‚è¯·é—®ä¸‹ï¼Œç›¸æ¯”jenkins åšci/cd æ˜¯ä¼šæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Œä¹‹å‰å¹¶æ²¡æœ‰ä½¿ç”¨è¿‡jenkins.</p></blockquote><p>Aï¼šgitlab-ciç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰ä½¿ç”¨ï¼Œæˆ‘ä»¬è°ƒç ”çš„ç»“æœæ˜¯1ã€æœ‰ä¾µå…¥æ€§ 2ã€pipelineåŠŸèƒ½è¾ƒå¼±ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯é‡åˆ°é”™è¯¯å¥½åƒè¿˜å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚jenkinsé‡åˆ°é”™è¯¯ä¼šä¸­æ–­æµç¨‹ã€‚</p><blockquote><p>Qï¼šè¯·é—®Jenkinswebhooké‚£äº›æ„å»ºå‚æ•°å¦‚ä½•ä¼ å…¥GitLabè§¦å‘ï¼Ÿ</p></blockquote><p>Aï¼šwebhookçš„è§¦å‘å’Œç•Œé¢å‚æ•°ä¼šæœ‰ä¸€äº›åŒºåˆ«ï¼Œæˆ‘ä»¬åœ¨è„šæœ¬é‡Œé¢åšäº†å¤„ç†ã€‚</p><blockquote><p>Qï¼šç¦»çº¿éƒ¨ç½²ï¼Œæ˜¯ä¸æ˜¯é€šè¿‡æ‰“å‡ºé•œåƒå‹ç¼©åŒ…ï¼Œç„¶åå¸¦ç€é•œåƒåŒ…åˆ°ç°åœºéƒ¨ç½²çš„å®¹å™¨äº‘å¹³å°ä¸Šï¼Œä¸Šä¼ éƒ¨ç½²çš„æ–¹å¼ï¼Ÿ</p></blockquote><p>Aï¼šæ˜¯åœ¨å®¶é‡Œæ‰“å‡ºé•œåƒå‹ç¼©åŒ…ï¼Œç„¶ååˆ°ç°åœºè§£å‹å‡ºæ¥ï¼Œæ ¹æ®é•œåƒç±»å‹è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚ä¸€äº›åŸºç¡€é•œåƒï¼Œä¼šç›´æ¥ä¸Šä¼ åˆ°èŠ‚ç‚¹ï¼Œä¸šåŠ¡çš„é•œåƒä¼šåœ¨éƒ¨ç½²å®Œæˆåä¸Šä¼ åˆ°Harborï¼Œç„¶åèŠ‚ç‚¹ä»Harborå»æ‹‰å–ã€‚</p><blockquote><p>Qï¼šGitLab è‡ªå¸¦çš„ CI ä¸Jenkins å’Œ GitLab ç»“åˆçš„ CIï¼Œè¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿæƒ³çŸ¥é“æ›´æ·±å±‚æ¬¡çš„ç†è§£ã€‚</p></blockquote><p>Aï¼šè¿˜æ˜¯è¦ç»“åˆè‡ªå·±å›¢é˜Ÿçš„å®é™…æƒ…å†µåšé€‰æ‹©ã€‚ä»æˆç†Ÿåº¦æ¥è¯´ï¼Œè‚¯å®šæ˜¯ Jenkinsç”¨æˆ·æœ€å¤šï¼Œæˆç†Ÿåº¦æœ€é«˜ï¼Œç¼ºç‚¹æ˜¯ä¾§é‡ Javaï¼Œé…ç½®ç›¸å¯¹ç¹çã€‚GitLab è‡ªå¸¦çš„ CIç›¸å¯¹ç®€å•ï¼Œå¯ä»¥ç”¨ yamlï¼Œå’Œ GitLab ç»“åˆçš„æœ€å¥½ï¼Œä½†åŠŸèƒ½è‚¯å®šæ²¡æœ‰ Jenkinså…¨é¢ã€‚å¦‚æœæ˜¯å°å›¢é˜Ÿæ–°é¡¹ç›®ï¼ŒGitLab CI åˆå·²ç»å¯ä»¥æ»¡è¶³éœ€æ±‚çš„è¯ï¼Œå¹¶ä¸éœ€è¦ä¸ŠJenkinsï¼Œå¦‚æœæ˜¯è¾ƒå¤§çš„å›¢é˜Ÿï¼Œåˆæ˜¯å Java çš„ï¼Œä¸ªäººæ›´åå‘ Jenkinsã€‚</p><blockquote><p>Qï¼šæœ‰äº†Gerritï¼Œä¸ºä»€ä¹ˆè¿˜è¦GitLabï¼ŒGerritä¹Ÿå¯ä»¥æ‰˜ç®¡ä»£ç å•Šï¼Ÿ</p></blockquote><p>Aï¼šè¿™ä¸ªæ˜¯æœ‰å†å²èƒŒæ™¯çš„ï¼Œæˆ‘ä»¬æ˜¯å…ˆé€‰æ‹©ä½¿ç”¨GitLabåšä»£ç æ‰˜ç®¡ï¼ŒåæœŸæ‰åŠ å…¥Gerritåšcode reviewã€‚Gerritåœ¨ä»£ç reviewæ–¹é¢æ¯”GitLabçš„merge requestè¦æ–¹ä¾¿è®¸å¤šï¼Œæ›´é€‚åˆä¼ä¸šå†…éƒ¨ä½¿ç”¨ã€‚å…³äºè¿™ä¸ªï¼Œæˆ‘çš„æƒ³æ³•æ˜¯ï¼Œè¦ä¹ˆå°†GitLabè¿ç§»åˆ°Gerritï¼Œè¦ä¹ˆä¸ç”¨Gerritï¼Œå¯ä»¥ä½¿ç”¨GitLabçš„merge requestæ¥è¿›è¡Œreviewï¼Œé‚£GitLabå…¶å®æ˜¯å¯ä»¥ä¸è¦çš„ã€‚</p><blockquote><p>Qï¼šå…¬å¸ç¯å¢ƒè¾ƒå¤æ‚ï¼šåŒ…å«Javaé¡¹ç›®ã€PHPé¡¹ç›®ï¼ŒJavaé¡¹ç›®ç›®å‰å¤§å¤šæ˜¯SpringBootæ¡†æ¶ï¼ŒPHPæ˜¯ThinkPHPæ¡†æ¶ï¼Œé¡¹ç›®æ¶æ„å¹¶ä¸å¤æ‚ï¼Œæœ‰å°‘è®¸Javaé¡¹ç›®éœ€è¦ç”¨Redisåˆ°Memcachedã€ç¼“å­˜æœºåˆ¶ã€‚æœ€å¤§é—®é¢˜çš„æ˜¯å¤šï¼Œé¡¹ç›®åº”è¯¥å¦‚ä½•è¾ƒå¥½çš„ä¾æ‰˜Kubernetesé¡ºåˆ©æ¶æ„ï¼Œå°†é¡¹ç›®å¯æŒç»­é›†æˆï¼Ÿ</p></blockquote><p>Aï¼šæˆ‘ä»¬çš„Redisè¿™ä¸€ç±»ä¸­é—´ä»¶è¿˜æ”¾åœ¨VMä¸Šï¼Œç›®å‰å°šæœªæ‰“ç®—æ¬ç§»åˆ°Kubernetesä¸Šï¼ŒKubernetes+Dockerå¤©ç„¶æ˜¯è·¨å¹³å°çš„ï¼ŒPHPä¹Ÿå¯ä»¥æ”¯æŒï¼Œå¹¶ä¸”å¯¹å®¹å™¨é›†ç¾¤ï¼ˆæ—¢åº”ç”¨é›†ç¾¤ï¼‰ç®¡ç†éå¸¸å‡ºè‰²ï¼ŒåŒ…å«éƒ¨åˆ†è‡ªåŠ¨åŒ–è¿ç»´ï¼Œå¹¶ä¸ä¼šå› å¤šç§å¼€å‘è¯­è¨€è€Œå¢åŠ è´Ÿæ‹…ï¼ŒæŒç»­é›†æˆæ˜¯å¦å¤–ä¸€å—ï¼Œç›®å‰å„å¤§CIå·¥å…·å‚å•†ä¹Ÿéƒ½æ”¯æŒKubernetesï¼Œæ¯”è¾ƒå‹å¥½ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„æ˜¯GitLab-CIã€‚</p><blockquote><p>Qï¼šSonarQubeçš„æƒé™æ§åˆ¶åŠæ€§èƒ½å½“é¢ï¼Ÿ</p></blockquote><p>Aï¼šæƒé™æ§åˆ¶ä½¿ç”¨SonarQubeæä¾›çš„APIï¼Œå°†é¡¹ç›®è·ŸGitLabä¸­ç›¸åº”é¡¹ç›®æƒé™åŒ¹é…èµ·æ¥ï¼ŒGitLabä¸­å¯ä»¥æŸ¥çœ‹è¿™ä¸ªé¡¹ç›®ä»£ç ï¼Œé‚£ä¹ˆSonarQubeä¸­å°±èƒ½çœ‹åˆ°è¿™ä¸ªé¡¹ç›®ç»“æœå’ŒCodeã€‚</p><blockquote><p>Q: ä½ ä»¬æ˜¯ç›´æ¥å°†SonarQubeã€GitLab/Jenkinsçš„æƒé™æ§åˆ¶åˆ°ä¸€èµ·äº†ï¼Ÿæ€æ ·åšçš„ç»Ÿä¸€ï¼Ÿ</p></blockquote><p>Aï¼šä½¿ç”¨LDAPè®¤è¯ã€‚</p><blockquote><p>Qï¼šGit Checkoutçš„æ—¶å€™ï¼Œä½ ä»¬çš„Git SCMæ²¡æœ‰è€ƒè™‘éšç§å®‰å…¨çš„äº‹æƒ…å—ï¼Œæ¯”å¦‚ä»£ç æƒé™å—é™ï¼Ÿ</p></blockquote><p>Aï¼šJenkinsä½¿ç”¨äº†ä¸€ä¸ªæœ€å°æƒé™ç”¨æˆ·å»GitLabä¸Šæ‹‰ä»£ç ã€‚å®‰å…¨æ–¹é¢ï¼ŒJenkinsæ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯å¯æ§çš„ã€‚</p><blockquote><p>Qï¼šJenkinsçš„æŒç»­é›†æˆæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿæ¯”å¦‚ä¸åŒçš„æºç ä»“åº“çš„æäº¤è§¦å‘ï¼Œå¦‚GitHubã€GitLabç‰ˆæœ¬å·æ€ä¹ˆæ§åˆ¶çš„ï¼Ÿ</p></blockquote><p>Aï¼šJenkinsçš„CIæµç¨‹è§¦å‘å¯ä»¥æœ‰å¾ˆå¤šç§ï¼Œä»£ç æäº¤è§¦å‘ï¼Œå®šæ—¶è§¦å‘ï¼Œæ‰‹åŠ¨è§¦å‘ã€‚ç‰ˆæœ¬å·çš„æ§åˆ¶ä¹Ÿå¯ä»¥æœ‰å¾ˆå¤šæ–¹æ¡ˆï¼Œæ¯”å¦‚ä½¿ç”¨jobçš„ç¼–å·ï¼Œä½¿ç”¨Gitçš„commitå·ï¼Œä½¿ç”¨æ—¶é—´æˆ³ç­‰ç­‰ã€‚</p><blockquote><p>Qï¼šè¯·é—®ï¼Œæˆ‘ä»¬æ˜¯javaé¡¹ç›®ï¼Œåœ¨ä¸šåŠ¡ä»£ç æ‰“æˆwaråŒ…åï¼ŒwaråŒ…å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œåœ¨å‘å¸ƒæµç¨‹ä¸­ï¼Œå¦‚ä½•å®Œæˆpodä¸­çš„å®¹å™¨çš„ä»£ç æ›´æ–°ï¼Œæ˜¯é‡‡ç”¨æŒ‚è½½ä»£ç åé‡å¯å®¹å™¨æ–¹å¼ï¼Œè¿˜æ˜¯é‡‡ç”¨æ¯æ¬¡é‡æ–°æ„å»ºä»£ç é•œåƒï¼Œç›´æ¥æ›´æ–°å®¹å™¨ï¼Œæˆ–è€…æœ‰ä»€ä¹ˆæ›´å¥½çš„å»ºè®®å—</p></blockquote><p>Aï¼šé…ç½®åˆ†ç¦»ï¼ˆä¸Šé…ç½®ä¸­å¿ƒ)ï¼Œå‚æ•°é€šè¿‡å¯åŠ¨é‰´æƒä¸‹è½½é…ç½®æ–‡ä»¶å¯åŠ¨ï¼Œè¿™æ ·å­ç¯å¢ƒçš„æ›´æ–°åªéœ€è¦åŸºäºé€šè¿‡ä¸€ä¸ªåŒ…å³å¯ã€‚</p><blockquote><p>Qï¼šä¸€ä¸ªJobç”Ÿæˆæ‰€æœ‰çš„Dockeré•œåƒï¼Œå¦‚æœæ„å»ºé‡åˆ°é—®é¢˜ï¼Œæ€ä¹ˆå»è¿½è¸ªè¿™äº›è®°å½•ï¼Ÿ</p></blockquote><p>Aï¼šåœ¨é¡¹ç›®å‰æœŸæ¥å…¥æ—¶ï¼Œç”Ÿæˆé•œåƒçš„æµç¨‹éƒ½ä½œäº†å®£ä¼ å’Œæ¨å¹¿ã€‚æ ‡å‡†åŒ–çš„æµç¨‹ï¼Œä¼šå‡å°‘äº§ç”Ÿé—®é¢˜çš„æœºç‡ã€‚å¦‚æœåœ¨æ„å»ºä¸­é‡åˆ°é—®é¢˜ï¼ŒPrism4kçš„ç•Œé¢ä¸­ï¼Œä¼šç›´æ¥æœ‰é“¾æ¥åˆ°æœ¬æ¬¡å»ºçš„æ¬¡åºå·ã€‚ç‚¹å‡»é“¾æ¥ï¼Œå¯ç›´æ¥å®šä½åˆ°Consoleè¾“å‡ºã€‚</p><blockquote><p>Qï¼šJobå’Œdindå¦‚ä½•é…åˆå»å®ç°æ‰“åŒ…é•œåƒçš„å‘¢ï¼Ÿ</p></blockquote><p>Aï¼šé¦–å…ˆæ˜¯dindæŠ€æœ¯ï¼Œé€šè¿‡æŒ‚è½½å®¿ä¸»æœºçš„docker clientå’Œdockersockï¼Œå¯ä»¥å®ç°åœ¨å®¹å™¨å†…è°ƒç”¨å®¿ä¸»æœºçš„Dockeræ¥åšä¸€äº›äº‹æƒ…ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦å°±ç”¨äºbuildã€‚Kubernetesçš„Jobåˆ™æ˜¯ç”¨äºæ‰§è¡Œè¿™ä¸ªæ„å»ºworkerçš„æ–¹å¼ï¼Œåˆ©ç”¨Kubernetesçš„Jobæ¥è°ƒåº¦æ„å»ºä»»åŠ¡ï¼Œå……åˆ†åˆ©ç”¨æµ‹è¯•é›†ç¾¤çš„ç©ºé—²èµ„æºã€‚</p><blockquote><p>Qï¼šè¯·é—®ä¸‹Mavençš„settings.xmlæ€ä¹ˆå¤„ç†ï¼Ÿæœ¬åœ°Mavenä»“åº“å‘¢ï¼Ÿ</p></blockquote><p>Aï¼šæˆ‘ä»¬æ„å»ºäº†ç§æœ‰çš„ Maven é•œåƒï¼Œ ç§æœ‰é•œåƒä¸­æ˜¯é»˜è®¤ä½¿ç”¨äº†æˆ‘ä»¬çš„ç§æœ‰æºã€‚ å¯¹äºé¡¹ç›®ä¸­ç”¨æˆ·æ— éœ€å…³æ³¨ settings.xml ä¸­æ˜¯å¦é…ç½®repoã€‚</p><blockquote><p>Qï¼šç”Ÿæˆæ–°çš„é•œåƒæ€ä¹ˆè‡ªåŠ¨æ‰“æ–°çš„tagï¼Ÿ</p></blockquote><p>Aï¼šæˆ‘ä»¬é•œåƒTagä½¿ç”¨æœ¬æ¬¡æ„å»ºé€‰å®šçš„Gitç‰ˆæœ¬ï¼Œå¦‚åˆ†æ”¯åç§°æˆ–è€…Tagã€‚</p><blockquote><p>Qï¼š å¦‚ä½•åŠ¨æ€ç”ŸæˆDockerfileï¼Œå¦‚ä½•åœ¨Dockeré•œåƒé‡Œé…ç½®JVMå‚æ•°ï¼Ÿ</p></blockquote><p>Aï¼šDockerfileæ–‡ä»¶ï¼šæˆ‘ä»¬æ˜¯ä½¿ç”¨shè„šæœ¬ç”Ÿæˆçš„ï¼Œå°†å†…å®¹ &gt;&gt; Dockerfileä¸­ï¼›JVMå‚æ•°æ˜¯åœ¨åº”ç”¨ä¸­é…ç½®çš„ï¼Œå‘é€æ„å»ºæ¶ˆæ¯æ—¶ï¼Œä½œä¸ºæ¶ˆæ¯å†…å®¹é€è¿‡å»ã€‚</p><blockquote><p>Qï¼šDocker çš„æ­£ç¡®çš„ä½¿ç”¨å§¿åŠ¿ï¼Œåœ¨æœ¬åœ°ç¯å¢ƒå·²ç»æ„å»ºäº†ä¼ä¸šç§æœ‰ Registry Harborï¼Œé‚£ä¹ˆæˆ‘è¦æ„å»ºåŸºäºä¸šåŠ¡çš„åº”ç”¨æ—¶ï¼Œæ˜¯å…ˆä» Linux ç³»åˆ—çš„åƒ Ubuntu æˆ– CentOS çš„ Base çš„ Docker é•œåƒå¼€å§‹ï¼Œç„¶åé€šè¿‡ Dockerfile å®šåˆ¶ä¸šåŠ¡éœ€æ±‚ï¼Œæ¥ä½¿ç”¨å—ï¼Ÿ</p></blockquote><p>Aï¼šæˆ‘ä»¬åŸºç¡€é•œåƒç»Ÿä¸€é‡‡ç”¨ CentOS 6.8ï¼Œä¸åŒçš„ä¸šåŠ¡æœ‰ä¸åŒçš„ Dockerfile æ¨¡æ¿ï¼Œç”Ÿæˆé•œåƒçš„è¿‡ç¨‹ä¸šåŠ¡å¯¹ Dockerfile æ˜¯é€æ˜çš„ã€‚</p><blockquote><p>Qï¼šä½¿ç”¨Pipelineå…ˆæ„å»ºç¼–è¯‘ç¯å¢ƒé•œåƒï¼Œå†ç¼–è¯‘ï¼Œæ˜¯å¦ä¼šå¯¼è‡´æ•´ä¸ªæµç¨‹éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Ÿæ˜¯å¦æœ‰ä¼˜åŒ–æ–¹æ¡ˆï¼Ÿ</p></blockquote><p>Aï¼šç¼–è¯‘é•œåƒç”±äºä¸ä¼šç»å¸¸å˜åŠ¨ï¼Œå› æ­¤è¿™ä¸ªé•œåƒçš„æ„å»ºé€šå¸¸ä½¿ç”¨cacheå°±èƒ½ç›´æ¥å®Œæˆï¼Œå¦å¤–æˆ‘ä»¬ä¹ŸæŠŠç¼–è¯‘ç¯å¢ƒé•œåƒæ‰“åŒ…è¿™ä¸ªæ­¥éª¤æŠ½å‡ºæ¥å•ç‹¬ä½œä¸ºjobæ‰§è¡Œäº†ï¼Œè¿™æ ·åœ¨å®é™…ç¼–è¯‘æµç¨‹ä¸­å°±æ— éœ€å†è¿›è¡Œç¼–è¯‘ç¯å¢ƒæ„å»ºã€‚</p><blockquote><p>Qï¼šDockerå­˜å‚¨è€ƒè™‘è¿‡Overlayå½“æ—¶å—ï¼Ÿæ®è¯´è¿™ç§æ„å»ºé•œåƒæ¯”è¾ƒå¿«ã€‚</p></blockquote><p>Aï¼šè€ƒè™‘è¿‡ï¼Œå½“æ—¶ä¹Ÿåšè¿‡å„ä¸ªæ–¹é¢çš„æµ‹è¯•ï¼Œè¿™ç§å¢é‡å¼çš„æ„å»ºï¼Œè‚¯å®šæœ€å¿«ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æœ‰ä¸“äººä»æºç çº§åˆ«å¯¹å…¶è¿›è¡Œç»´æŠ¤ï¼Œæˆæœ¬å¯¹äºæˆ‘ä»¬è¿˜æ˜¯æœ‰ç‚¹é«˜ï¼Œæˆ‘ä»¬åæœŸæ‰“ç®—é‡‡ç”¨ç¯å¢ƒå’Œä»£ç åˆ†ç¦»çš„æ–¹å¼ï¼Œå³ç¯å¢ƒéƒ¨ç½²ä¸€æ¬¡ï¼Œä»£ç å¤šæ¬¡éƒ¨ç½²æ¥æå‡æ•ˆç‡ã€‚</p><blockquote><p>Qï¼šæ‚¨æåˆ°ä¸è¿‡åˆ†å¼ºè°ƒæµ‹è¯•è‡ªåŠ¨åŒ–ï¼Œå°½é‡ä¸æ”¹å˜æµ‹è¯•æµç¨‹ï¼Œé‚£ä¹ˆå¯¹äºè‡ªåŠ¨æ„å»ºå’Œå•å…ƒæµ‹è¯•çš„è‡ªåŠ¨åŒ–æœ‰æ²¡æœ‰è€ƒè™‘å‘¢ï¼Ÿæ¯•ç«Ÿè¿™äº›æ˜¯æ¯”è¾ƒæ¶ˆè€—äººåŠ›çš„éƒ¨åˆ†ã€‚</p></blockquote><p>Aï¼šè‡ªåŠ¨æ„å»ºæˆ‘è®¤ä¸ºæ¯”è¾ƒç°å®ï¼Œå•å…ƒæµ‹è¯•æœ‰è€ƒè™‘ã€‚ä¸è¿‡æˆ‘ä»¬æµ‹è¯•æ¡ˆä¾‹è¿‡äºå¤æ‚ï¼Œç›®å‰çœ‹çŸ­æœŸå®ç°ä¸å¤ªç°å®ã€‚è€Œä¸”æ€§èƒ½ä¹Ÿæ˜¯ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸‹ä¸€æ­¥è¦åšæˆ‘ä»¬ä¼šæ›´å¤šè€ƒè™‘ä¸€äº›ç‰¹å®šåœºæ™¯ã€‚æ¯”å¦‚äº§å“å‘å¸ƒåçš„å›å½’æµ‹è¯•ï¼Œè¿™ä¸ªæœ‰å¯èƒ½ï¼Œä½†ä¸ä¼šæ˜¯æ™®éåº”ç”¨ã€‚</p><blockquote><p>Qï¼šè‡ªåŠ¨åŒ–æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå¯¹åº”ç”¨çš„æµ‹è¯•æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</p></blockquote><p>Aï¼šå•å…ƒæµ‹è¯•å¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™å®Œæˆï¼ŒåŠŸèƒ½æµ‹è¯•éœ€è¦å¯åŠ¨éƒ¨ç½²ã€‚</p><blockquote><p>Qï¼šé€šè¿‡é•œåƒçš„æ„å»ºè„šæœ¬æ˜¯æ€ä¹ˆç”Ÿæˆé•œåƒçš„ï¼Ÿåœ¨åŸºç¡€é•œåƒä¸Šæ‰§è¡Œç›¸å…³è„šæœ¬ä¹ˆï¼Ÿä¸€äº›ç«¯å£å­˜å‚¨å·ç¯å¢ƒå˜é‡è¿™äº›é•œåƒä¸­çš„ä¿¡æ¯æ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿ</p></blockquote><p>Aï¼šæˆ‘ä»¬å¯¹Dockerfileè¿›è¡Œäº†å°è£…ï¼Œä¸šåŠ¡å’Œå¼€å‘äººå‘˜ä¸éœ€è¦å…³å¿ƒDockerfileè¯­æ³•ï¼Œç›´æ¥å†™ä¸€ä¸ªé•œåƒæ„å»ºè„šæœ¬ï¼Œæœ€åæ ¹æ®ä¸€å®šçš„è§„åˆ™ç”±Harborç”ŸæˆDockerfileï¼Œä¹‹åè°ƒç”¨docker buildå»ç”Ÿæˆé•œåƒã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ é•œåƒçš„åç§°ï¼Œç‰ˆæœ¬éƒ½å·²ç»æ ¹æ®è§„åˆ™ç”Ÿæˆ</p><blockquote><p>Qï¼šåœ¨æ„å»ºæ—¶å€™ï¼Œè¿™äº›ç¯å¢ƒå¯ä»¥æå‰å®‰è£…å¥½ï¼Ÿ</p></blockquote><p>Aï¼šåº”ç”¨é‡Œéƒ½æœ‰è‡ªå·±çš„ç‰ˆæœ¬æ¦‚å¿µï¼Œæ¯ä¸ªåº”ç”¨ç‰ˆæœ¬é‡Œæœ‰ï¼šé•œåƒç‰ˆæœ¬ï¼Œç¯å¢ƒå˜é‡ã€ exportã€Volmueç­‰ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨å›é€€æˆ–è€…å‡çº§æ—¶å€™ï¼Œæœ€ç»ˆçš„è¡¨ç°å½¢å¼å°±æ˜¯æ€æ‰æ—§å®¹å™¨ï¼Œæ ¹æ®ç‰ˆæœ¬çš„å‚æ•°åˆ›å»ºæ–°å®¹å™¨ã€‚</p><blockquote><p>Qï¼šè¯·é—®æ„å»ºä¸€æ¬¡å¹³å‡è¦å¤šé•¿æ—¶é—´ï¼Ÿ</p></blockquote><p>Aï¼šç°åœ¨Javaã€Dubboã€Pythonã€goçš„å¤šï¼Œ ä¸€èˆ¬2åˆ†é’Ÿï¼Œè€Œä¸”æœ‰çš„é•œåƒç”¨æˆ·å¼€å¯äº†è‡ªåŠ¨æ„å»ºåï¼Œåœ¨ä»–ä»¬æ²¡æ„è¯†çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½å·²ç»æ„å»ºå®Œæˆã€‚ åˆ°æ—¶å€™å‡çº§æ—¶å€™ï¼Œé€‰æ‹©å¯¹åº”çš„é•œåƒç‰ˆæœ¬å³å¯ã€‚</p><blockquote><p>Qï¼šAppçš„æ¯ä¸€æ¬¡æäº¤éƒ½æ˜¯ä¸€ä¸ªversionå—ï¼Œæ˜¯ä¸æ˜¯æ¯æ¬¡æ„å»ºå®Œæµ‹è¯•å®Œæˆï¼Œå°±å¯ä»¥å‘å¸ƒäº†ï¼Ÿ</p></blockquote><p>Aï¼šApp æ²¡æœ‰æäº¤çš„æ¦‚å¿µï¼Œæ‚¨è¯´çš„åº”è¯¥æ˜¯é•œåƒï¼Œæˆ‘ä»¬è®¾è®¡çš„æ˜¯ä¸€ä¸ªé•œåƒå¯¹åº”ä¸€ä¸ªGitä»“åº“ä»¥åŠåˆ†æ”¯ã€‚å½“æœ‰pushæˆ–è€…tagæ“ä½œåï¼Œä¼šè‡ªåŠ¨è§¦å‘æ„å»ºï¼Œæ„å»ºçš„è¡Œä¸ºæ˜¯æ ¹æ®ç”¨æˆ·å†™çš„é•œåƒæ„å»ºshellè„šæœ¬æ¥å†³å®šçš„ã€‚ ä¸€èˆ¬æˆ‘ä»¬å»ºè®®ä¸šåŠ¡éƒ¨é—¨åšå‡ºçš„é•œåƒè·Ÿæµ‹è¯•ç¯å¢ƒå’Œç”Ÿæˆç¯å¢ƒæ²¡å…³ç³»ã€‚ é•œåƒå°±æ˜¯é•œåƒï¼Œåªæœ‰åº”ç”¨æœ‰æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;å¯¹äº
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="gitlab" scheme="https://blog.k8s.li/tags/gitlab/"/>
    
      <category term="CI/CD" scheme="https://blog.k8s.li/tags/CI-CD/"/>
    
      <category term="harbor" scheme="https://blog.k8s.li/tags/harbor/"/>
    
  </entry>
  
  <entry>
    <title>å’Œè‰æ—¶é›¨çš„æœ‰è¶£ç¬”è°ˆ</title>
    <link href="https://blog.k8s.li/with-chanshiyu-qa.html"/>
    <id>https://blog.k8s.li/with-chanshiyu-qa.html</id>
    <published>2020-04-04T16:00:00.000Z</published>
    <updated>2020-04-09T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç”±æ¥"><a href="#ç”±æ¥" class="headerlink" title="ç”±æ¥"></a>ç”±æ¥</h2><p>èµ·åˆæ˜¯å’±çœ‹åˆ° <a href="https://blog.yoitsu.moe" target="_blank" rel="noopener">èŒç‹¼</a> å†™çš„ <a href="https://blog.yoitsu.moe/life/question_exchange_fiveyellowmice.html" target="_blank" rel="noopener">å’Œ FiveYellowMice äº¤æ¢é—®é¢˜ï¼</a> åšå®¢åå°±æƒ³ç€æ‰¾å‡ ä¸ªå‹é“¾é‡Œçš„å‹äººæ¥æ¬¡ç±»ä¼¼çš„ç¬”è°ˆï¼Œä½†ä¹Ÿæ˜¯å¾ˆçº ç»“æ€•è¢«æ‹’ç»å”‰ï¼Œæ‰€ä»¥å†ä¸‰æ–Ÿé…Œäº†ä¸€ä¸‹å°±æ‰¾åˆ°äº†å’±åšå®¢é‡Œç•™è¨€æ¬¡æ•°æœ€å¤šçš„å‹äºº <a href="https://chanshiyu.com/#/" target="_blank" rel="noopener">è‰æ—¶é›¨</a> æ¥è¿›è¡Œæ­¤æ¬¡ç¬”è°ˆğŸ˜‚ã€‚</p><h2 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h2><h3 id="Q1ï¼šæœ¨å­ã®ç‹¬ç™½ï¼Ÿä¸€å¥è¯ä»‹ç»è‡ªå·±"><a href="#Q1ï¼šæœ¨å­ã®ç‹¬ç™½ï¼Ÿä¸€å¥è¯ä»‹ç»è‡ªå·±" class="headerlink" title="Q1ï¼šæœ¨å­ã®ç‹¬ç™½ï¼Ÿä¸€å¥è¯ä»‹ç»è‡ªå·±~"></a>Q1ï¼šæœ¨å­ã®ç‹¬ç™½ï¼Ÿä¸€å¥è¯ä»‹ç»è‡ªå·±~</h3><p>æƒ³äº†åŠå¤©è§‰ç€è¿™ä¸ªé—®é¢˜ä¼°è®¡æ˜¯ 10 ä¸ªé—®é¢˜é‡Œæœ€éš¾çš„ğŸ˜‚ï¼ŒæŒ‘å‡ ä¸ª bio æ¥æ¦‚æ‹¬ä¸€ä¸‹å’±çš„ç»„æˆå§ğŸ˜‹ï¼š</p><p><strong>åœ°çƒäººã€ç´ é£Ÿè€…ã€æ°´æœè¿·ã€ç”µå­å‰å“¨åŸºé‡‘ä¼šæˆå‘˜ã€æ¬ç –ç¤¾ç•œã€è¿ç»´æ”»åŸç‹®ã€‚</strong></p><ul><li><p>åœ°çƒäººï¼šå› ä¸ºè¿™æ¬¡æ­¦æ±‰è‚ºç‚ç—…æ¯’ç–«æƒ…çš„å½±å“ï¼Œå…¨ä¸–ç•Œéƒ½åœ¨é­å—è¿™åœºç˜Ÿç–«çš„æŠ˜ç£¨ï¼Œè€Œæˆ‘ç°å®ä¸–ç•Œé‡Œå‘¨å›´çš„äººå´åœ¨å¹¸ç¾ä¹ç¥¸åœ°åº†ç¥æ¬§ç¾å›½å®¶æ„ŸæŸ“äººæ•°è¶Šå¤šè¶Šå¥½ã€‚æ¯å¬åˆ°èº«è¾¹çš„äººå¯¹å…¶ä»–å›½å®¶æ„Ÿäººäººæ•°å¢å¤šè€Œå¹¸ç¾ä¹ç¥¸åœ°å˜²ç¬‘ï¼Œå“å‘€ï¼å’±æ°”å¾—è·ºè„šå•Šï¼(æ€æ¡Œå„¿ã€‚åœ¨ææƒä¸“åˆ¶å›½å®¶ï¼Œç»Ÿæ²»è€…ä¸ºäº†ç»´æŠ¤å…¶æƒåŠ›çš„åˆæ³•æ€§è€Œè¿›è¡Œæ„è¯†å½¢æ€æ§åˆ¶ä½äººæ°‘çš„æ€æƒ³ï¼Œé€šè¿‡åˆ¶é€ ä»‡æ¨æ¥å¡‘é€ ä¸€ä¸ªè¿œåœ¨å¤©è¾¹çš„æ•Œäººè€Œè®©äººæ°‘å¿˜è®°èº«è¾¹çš„ç—›è‹¦ã€‚å’±å°±æƒ³ï¼šå’±ä¸åš<code>èµµ</code>å›½äººï¼Œåšä¸ªåœ°çƒäººå¤šå¥½å‘€ï¼›å¦‚æœäººç±»èƒ½å¤ŸæŠ›å¼ƒå›½å®¶å’Œæ°‘æ—è¿™ç§æ„è¯†å½¢æ€ä¸Šçš„èº«ä»½ï¼Œéƒ½æŠŠäººç±»å½“ä½œè¿™ä¸ªå­¤ç‹¬æ˜Ÿçƒä¸Šçš„åŒèƒï¼Œå‹å¥½ç›¸å¤„å¤šå¥½å‘€ã€‚</p></li><li><p>ç´ é£Ÿè€…ï¼šæœ‰æ—¶å’±åœ¨æƒ³æˆ‘ä»¬åœ¨å¤§è‡ªç„¶ä¸­ç´¢å–äº†å¤ªå¤šï¼ŒåŒæ—¶åˆä¸æ–­åœ°ç ´åå¤§è‡ªç„¶çš„ç”Ÿæ€å¹³è¡¡ã€‚æˆ‘ä»¬æœ‰ä¹‰åŠ¡ä¸ºå¤§è‡ªç„¶å»åšå‡ºç›¸åº”çš„è¡¥å¿ã€‚æˆ‘è‡ªå·±èº«ä½“åŠ›è¡Œçš„åšæ³•å°±æ˜¯åšä¸€ä¸ªç´ é£Ÿè€…ï¼Œå°½è‡ªå·±æœ€å¤§åŠªåŠ›å°Šé‡å’Œä¿æŠ¤åŠ¨ç‰©ã€‚æˆ‘ä¸æ˜¯åŠ¨ç‰©æƒåˆ©çš„å€¡å¯¼è€…ï¼Œæˆ‘è¿™æ ·åšåªæ˜¯å‡ºäºå¯¹å¤§è‡ªç„¶ï¼Œå¯¹ç”Ÿå‘½å°Šä¸¥çš„æ€è€ƒã€‚æ±‰å¯†å°”é¡¿æ³•åˆ™æ¨¡å‹è®¤ä¸º rB &gt; C æ˜¯åˆ©ä»–è¡Œä¸ºå‘ç”Ÿçš„åŸå› ï¼Œè€Œè¿™æ˜¯åŠ¨ç‰©çš„å¤©æ€§ã€‚å…¶ä¸­ r æ˜¯æ–½åˆ©è€…ä¸å—å®³è€…ä¹‹é—´çš„å…³ç³»ï¼Œå…³ç³»è¶Šå¥½å°±è¶Šé«˜ã€B æ˜¯å—åˆ©è€…æ‰€èƒ½è·å¾—çš„åˆ©ç›Šã€Cæ˜¯æ–½åˆ©è€…æ‰€éœ€ä»˜å‡ºçš„ä»£ä»·ã€‚æ‰€ä»¥ä¸¤è€…å…³ç³»è¶Šç´§å¯†ï¼Œé‚£ä¹ˆåˆ©ä»–è¡Œä¸ºè¶Šå®¹æ˜“å‘ç”Ÿã€‚æ­£æ˜¯å› ä¸º r å¾ˆå¤§è¿™ä¸ªåŸå› ï¼Œäººç±»å¾ˆå°‘ä¼šæŠŠçµé•¿ç±»åŠ¨ç‰©å½“ä½œé£Ÿç‰©ï¼Œä¹Ÿè¶Šæ¥è¶Šå°‘åœ°æŠŠäº²å¯†çš„åŠ¨ç‰©æ¯”å¦‚çŒ«ç‹—å½“ä½œé£Ÿç‰©ã€‚è€Œä» C è§’åº¦ä¹Ÿå°±æ˜¯äººç±»çš„ä»£ä»·æ¥çœ‹ï¼Œäººç±»æ‹¯æ•‘å…¶ä»–åŠ¨ç‰©çš„åˆ©ä»–è¡Œä¸ºï¼Œä¹Ÿå’Œäººç±»å‘å±•çš„ç¨‹åº¦æœ‰å…³ï¼Œå‘å±•ç¨‹åº¦è¶Šé«˜å¯ä»¥åšåˆ°çš„äº‹æƒ…ä¹Ÿå°±è¶Šå¤šï¼Œä¹Ÿå°±å¯ä»¥è€ƒè™‘æ›´å¤šçš„äº‹æƒ…ï¼Œè€Œç´ é£Ÿè¿™æ ·çš„äº‹æƒ…å¹¶ä¸éœ€è¦ä»˜å‡ºæé«˜çš„ä»£ä»·ï¼Œè¿™æ ·çš„äº‹æƒ…ä¸ºä»€ä¹ˆä¸åšå‘¢?</p></li><li><p>æ°´æœè¿·ï¼šå› ä¸ºå’±ç´ é£Ÿåå°±å¤±å»äº†å¾ˆå¤šç¾å‘³é£Ÿç‰©ï¼Œæ‰€ä»¥å”¯æœ‰æ°´æœæ‰èƒ½æ»¡è¶³å’±çš„èƒƒå£å•¦ï¼Œå’±ä¸æŒ‘é£Ÿï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„æ°´æœå’±éƒ½å–œæ¬¢åƒğŸ˜‹ã€‚è‘¡è„ğŸ‡å’Œè‰è“ğŸ“å¯èƒ½æ›´å–œæ¬¢ä¸€ç‚¹ğŸ˜‚</p></li><li><p>ç”µå­å‰å“¨åŸºé‡‘ä¼šæˆå‘˜ï¼šå…¶å®æ¯ä¸ªæœˆç»™ EFF æèµ å°±å¯ä»¥å•¦ğŸ˜‚ã€‚è‡ªä»å’±å¤§å­¦æ¯•ä¸šå½“äº†ç¤¾ç•œå¼€å§‹æ¬ç –ä¹‹åï¼Œè‡ªå·±èƒ½èµšä¸€ç‚¹å°é’±äº†ï¼Œæ‰€ä»¥å°±æ¯æœˆç»™ EFF ç”µå­å‰å“¨åŸºé‡‘ä¼šæèµ  5$ ã€‚å› ä¸º EFF æ˜¯ä¸€ä¸ªå…·æœ‰é¢†å¯¼åœ°ä½çš„éç›ˆåˆ©ç»„ç»‡ï¼Œè‡´åŠ›äºåœ¨æ•°å­—ä¸–ç•Œæå«å…¬æ°‘è‡ªç”±ã€‚è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šå’Œç”µå­å‰çº¿åŸºé‡‘ä¼šä¸€ç›´æ˜¯è‡ªç”±äº’è”ç½‘ä¸–ç•Œé‡Œå¯¹æŠ— BIG BROTHER çš„æœ€å‰çº¿ï¼Œè¿™ç§å¯¹æŠ—ä¸ä»…ä»…æ˜¯åœ¨æŠ€æœ¯é¢†åŸŸï¼Œæ³•å¾‹é¢†åŸŸä¹Ÿæ˜¯å¦‚æ­¤ã€‚EFF è¿‡å»çš„ 30 å¤šå¹´ä¸­ï¼Œé€šè¿‡å½±å“è¯‰è®¼ï¼Œæ”¿ç­–åˆ†æï¼ŒåŸºå±‚è¡ŒåŠ¨ä»¥åŠæŠ€æœ¯ç ”å‘ï¼Œæå«ç”¨æˆ·éšç§ï¼Œè¨€è®ºè‡ªç”±ä»¥åŠåˆ›æ–°ã€‚è¯¥åŸºé‡‘ä¼šçš„è¯•å›¾é€šè¿‡åŠªåŠ›ä¿éšœï¼Œåœ¨æŠ€æœ¯è¿›æ­¥çš„å‰æä¸‹ï¼Œäººä»¬çš„è‡ªç”±å’ŒæƒåŠ›ä¹Ÿå—åˆ°ç›¸åº”çš„ä¿æŠ¤ã€‚è™½ç„¶ä¸ªäººçš„æèµ å¯¹äºæ€»ä½“æ¥è®²å¾®ä¹å…¶å¾®ï¼Œ<strong>ä½†æ— è®ºæ•´ä½“ç»“æœå¦‚ä½•ï¼Œå¿ äºåŸåˆ™çš„è¡Œä¸ºï¼Œéƒ½æœ‰å…¶æœ¬èº«çš„é“å¾·ä»·å€¼ï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚</strong> å’±åšä¿¡çš„é“å¾·ä»·å€¼å°±æ˜¯ï¼š<strong>æ— è®ºå¢™æœ‰å¤šé«˜ï¼Œéƒ½ä¸èƒ½æ”¾å¼ƒå¯¹è‡ªç”±äº’è”ç½‘çš„è¿½æ±‚</strong>ï¼Œè€Œæèµ æ”¯æŒåƒç”µå­å‰å“¨åŸºé‡‘ä¼šã€ç»´åŸºåª’ä½“åŸºé‡‘ä¼šã€è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šã€äº’è”ç½‘æ¡£æ¡ˆé¦†ç­‰è¿™äº›æå«äº’è”ç½‘è‡ªç”±çš„éè¥åˆ©æ€§ç»„ç»‡ï¼Œæ­£æ˜¯åœ¨ä¼ æ’­è‡ªç”±äº’è”ç½‘çš„ç²¾ç¥ã€‚</p></li></ul><h3 id="Q2ï¼šå¯¹æ—¶é›¨çš„åˆå°è±¡ï¼Ÿ"><a href="#Q2ï¼šå¯¹æ—¶é›¨çš„åˆå°è±¡ï¼Ÿ" class="headerlink" title="Q2ï¼šå¯¹æ—¶é›¨çš„åˆå°è±¡ï¼Ÿ"></a>Q2ï¼šå¯¹æ—¶é›¨çš„åˆå°è±¡ï¼Ÿ</h3><ul><li>å¯çˆ±æ¸©æŸ” <strong>(<em>â‰§ï¸¶â‰¦))(ï¿£â–½ï¿£</em> )ã‚</strong>ï¼š</li></ul><p>å’±ç¬¬ä¸€æ¬¡è®¿é—®æ—¶é›¨çš„åšå®¢æ˜¯æ±åœ¨å’±é‚£ç¯‡<a href="https://blog.k8s.li/Kindle-Oasis2-vs-Paperwhite3.html">ã€ŠKindle Oasis å’Œ Kindle Paperwhite3 ä½¿ç”¨ä½“éªŒã€‹</a> å®¢ç•™è¨€ä¹‹åï¼Œå’±æ‰æ³¨æ„åˆ°æ—¶é›¨ï¼Œå› ä¸ºä¹‹å‰å¾ˆå°‘ä¼šæœ‰äººåœ¨å’±åšå®¢å¤šæ¬¡ç•™è¨€ã€‚äºæ˜¯å’±å¥½å¥‡åœ°ç‚¹å¼€äº†æ—¶é›¨çš„åšå®¢ï¼Œç¬¬ä¸€çœ¼å°±æƒŠå‘†äº†<strong>w(ï¾ŸĞ”ï¾Ÿ)w</strong>ã€‚è¿™ä¹Ÿæ˜¯å’±è§è¿‡çš„æœ€æœ‰å¿ƒçš„åšå®¢ï¼Œè¢«æ—¶é›¨çš„æ‰èƒ½æ·±æ·±æŠ˜æœï¼ˆå•†ä¸šèƒ¡å¹ğŸ˜‚ã€‚ç„¶åå’±å°±ç¿»éäº†æ—¶é›¨çš„åšå®¢å’Œ dispus ä¸Šçš„è¯„è®ºï¼Œæƒ³è¦è®¤è¯†ä¸€ä¸‹æ—¶é›¨ã€‚ä¸ä»…ä»…æ˜¯åšå®¢çš„è®¾è®¡å’Œä¸»é¢˜ï¼Œè¿æ–‡å­—éƒ½ä¼šå¸¦ç€å¯çˆ±çš„<code>å£°éŸ³</code>ã€‚æ¯”å¦‚ <code>ï½</code> å’Œ <code>â€—ã€‚â€—</code> ç­‰æ ‡ç‚¹ç¬¦å·ï¼Œä»¿ä½›å°±åƒæ–‡ç« çš„æŒ‡çº¹ï¼Œè¯»èµ·æ¥å°±åƒæœ‰äº†å£°éŸ³ä¸€æ ·ç¥å¥‡ã€‚å’±å¥½åƒä¹Ÿå—æ±çš„å½±å“è€¶ï¼Œæ…¢æ…¢åœ°åœ°å–œæ¬¢åŠ ä¸€äº›æ ‡ç‚¹ç¬¦å·ğŸ˜‚ã€‚</p><ul><li>è¯—æ„å°‘å¹´ï¼š</li></ul><blockquote><p>å¤æ—¥ä¼—è‰é¸£å«æ­¤èµ·å½¼ä¼å¥½ä¼¼è½é›¨ï¼Œè‰å„¿ä»¬ä¼¼è¦å°†ä»…å­˜çš„çš„ç”Ÿå‘½ç‡ƒçƒ§å¥å‡ºæœ€åçš„éŸ³ç¬¦ï¼Œç»šçƒ‚ä¸å£®ç¾ä¸­æ°¤æ°²ç€æ²‰å¯‚ä¸æ— å¸¸ï¼Œæ˜¯æ—¥æœ¬å¤å¤©æœ€å…·ä»£è¡¨æ€§çš„å­£èŠ‚ç‰©è¯­ä¹‹ä¸€ã€‚</p></blockquote><ul><li><p>å–„è‰¯çƒ­å¿ƒï¼šå°†è‡ªå·±å†™çš„åšå®¢ä¸»é¢˜å¼€æºåˆ†äº«å‡ºæ¥ï¼Œè€Œä¸”çƒ­å¿ƒå¸®åŠ©ä»–äººæ€ä¹ˆå»é£Ÿç”¨ ğŸ˜‹</p></li><li><p>å¿ƒæ€ç»†è…»ï¼šé€šè¿‡æ±çš„æ–‡ç« å’Œæµè¨€å¯ä»¥çŒœæµ‹å‡ºï¼Œç°å®ä¸­æ¯”è¾ƒå†…å‘ä¸å–„è¡¨è¾¾ï¼Œä½†å¿ƒé‡Œæ´»åŠ¨ä¸°å¯Œï¼Œæƒ³äº¤æµçš„è¯ä¹Ÿå¾ˆå¤šçš„æ ·å­è€¶ã€‚</p></li></ul><p>ä»¥ä¸Šå°±æ˜¯å’±å¯¹æ—¶é›¨çš„åˆå°è±¡å•¦ğŸ˜Š</p><h3 id="Q3ï¼šå–œæ¬¢ä»€ä¹ˆç±»å‹çš„éŸ³ä¹ï¼Ÿæ¨èä¸€é¦–å•æ›²å¾ªç¯çš„æ­Œï¼Ÿ"><a href="#Q3ï¼šå–œæ¬¢ä»€ä¹ˆç±»å‹çš„éŸ³ä¹ï¼Ÿæ¨èä¸€é¦–å•æ›²å¾ªç¯çš„æ­Œï¼Ÿ" class="headerlink" title="Q3ï¼šå–œæ¬¢ä»€ä¹ˆç±»å‹çš„éŸ³ä¹ï¼Ÿæ¨èä¸€é¦–å•æ›²å¾ªç¯çš„æ­Œï¼Ÿ"></a>Q3ï¼šå–œæ¬¢ä»€ä¹ˆç±»å‹çš„éŸ³ä¹ï¼Ÿæ¨èä¸€é¦–å•æ›²å¾ªç¯çš„æ­Œï¼Ÿ</h3><ul><li><p>ä¸€äº›åŠ¨ç”»çš„ OP/ED/ç‰¹å…¸/BGM ï¼Œæ¯”å¦‚ï¼š å››æœˆã¯å›ã®å˜˜ã€ ãƒªã‚ºã¨é’ã„é³¥ã€ NARUTO -ãƒŠãƒ«ãƒˆ-ã€ã€Œæ—¥å¸¸ã€ã®åˆå”±æ›²</p></li><li><p>å•æ›²å¾ªç¯çš„ï¼šå½“ç„¶æ˜¯å’±æœ€å–œæ¬¢çš„ã€Œå››æœˆã¯å›ã®å˜˜ã€ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°ãƒ†ãƒ¼ãƒã€å…‰ã‚‹ãªã‚‰ã€å•¦ğŸ˜‹</p></li></ul><h3 id="Q4ï¼šå–œæ¬¢ä»€ä¹ˆç±»å‹çš„ä¹¦ç±ï¼Ÿå¯¹çº¸è´¨ä¹¦å’Œç”µå­ä¹¦ä¸¤ç§é˜…è¯»æ–¹å¼çš„çœ‹æ³•ï¼Ÿ"><a href="#Q4ï¼šå–œæ¬¢ä»€ä¹ˆç±»å‹çš„ä¹¦ç±ï¼Ÿå¯¹çº¸è´¨ä¹¦å’Œç”µå­ä¹¦ä¸¤ç§é˜…è¯»æ–¹å¼çš„çœ‹æ³•ï¼Ÿ" class="headerlink" title="Q4ï¼šå–œæ¬¢ä»€ä¹ˆç±»å‹çš„ä¹¦ç±ï¼Ÿå¯¹çº¸è´¨ä¹¦å’Œç”µå­ä¹¦ä¸¤ç§é˜…è¯»æ–¹å¼çš„çœ‹æ³•ï¼Ÿ"></a>Q4ï¼šå–œæ¬¢ä»€ä¹ˆç±»å‹çš„ä¹¦ç±ï¼Ÿå¯¹çº¸è´¨ä¹¦å’Œç”µå­ä¹¦ä¸¤ç§é˜…è¯»æ–¹å¼çš„çœ‹æ³•ï¼Ÿ</h3><p>è™½ç„¶å„æ–¹é¢çš„ä¹¦éƒ½æœ‰æ‰€æ¶‰çŒï¼Œä½†æ›´åå‘äºè‡ªç„¶ç§‘å­¦ä¹‹ç±»çš„ä¹¦ç±ã€‚å› ä¸ºè¿™äº›ä¹¦å…±åŒç‚¹å°±æ˜¯æ»¡è¶³è‡ªå·±çš„å¥½å¥‡å¿ƒå’Œæ±‚çŸ¥æ¬²ï¼Œä½¿è‡ªå·±æ›´åŠ æ¸…æ¥šä¸‡äº‹ä¸‡ç‰©èƒŒåçš„è‡ªç„¶çœŸç†ï¼Œä»è€Œå¯¹å¤§è‡ªç„¶ä»¥åŠç”Ÿå‘½æ€€æœ‰å´‡é«˜çš„æ•¬æ„ï¼Œè¿™æ ·æ‰èƒ½æ˜ç™½äººç±»çš„æ¸ºå°å’Œæ— çŸ¥ã€‚</p><p>æ¯”å¦‚å’±æƒ³çŸ¥é“æœ¨æ˜Ÿä¸Šçš„é‚£å—èƒ½åä¸‹åœ°çƒçš„å¤§çº¢æ–‘ï¼›å’±æƒ³çŸ¥é“åœ°çƒçš„å†…æ ¸æ—¶å›ºæ€çš„è¿˜æ˜¯æ¶²æ€çš„ï¼Ÿåœ°ç£åœºå¦‚ä½•å½¢æˆï¼Œä¸ºä»€ä¹ˆåœ°ç£åœºä¼šå€’è½¬ï¼Ÿåœ°çƒçš„ç”Ÿå‘½èµ·æºä»¥åŠå‡ åäº¿å¹´çš„ç”Ÿå‘½è¿›åŒ–å†ç¨‹ï¼›å’±ä»¬äººç±»çš„ç¥–å…ˆæ™ºäººä»ä¸œéå¤§è£‚è°·èµ°å‡ºåå†ç»ä¸‡å¹´çš„è¿ç§»è¿›åŒ–ä¹‹æ—…ï¼Ÿå’±æƒ³çŸ¥é“ç»†èƒä¸­çš„ç»†èƒå™¨æ˜¯å¦‚ä½•è¿›åŒ–è€Œæ¥çš„ï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´å¦‚ä½•åˆ†å·¥åˆä½œçš„ï¼›DNA å¦‚ä½•æ§åˆ¶åŸºå› è¡¨è¾¾ä»¥åˆ›é€ å‡ºä¸ä¼—ä¸åŒçš„ä¸‡ç‰©ç”Ÿçµã€‚è¿˜æœ‰å’±æƒ³çŸ¥é“å¤å¸Œè…ŠåŸé‚¦é›…å…¸æ–‡æ˜ï¼›æƒ³çŸ¥é“é‡‘å­—å¡”å¦‚ä½•å»ºé€ ä»¥åŠå¤åŸƒåŠæ³•è€è¿½æ±‚æ°¸ç”Ÿèµ‹äºˆçš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿæƒ³çŸ¥é“ NASA æ¢ç´¢å¤ªç©ºçš„è‰°è¾›å†ç¨‹ï¼Ÿæƒ³çŸ¥é“é£å‡ºæ˜Ÿé™…ç©ºé—´çš„æ—…è¡Œè€… 1 å·ç°åœ¨è¿˜å¥½å—ï¼Ÿ</p><p><img src="img/image-20200404190616475.png" alt="image-20200404190616475"></p><p>æ€»ä¹‹è™½ç„¶å’±éƒ½å·²ç»æ˜¯äºŒåæœ‰äº”çš„äººæˆå¹´äººäº†ï¼Œä½†å’±çš„å¿ƒæ™ºè¿˜æ˜¯å’Œä¸­å°å­¦ç”Ÿä¸€æ ·ï¼Œé•¿ä¸å¤§çš„å¥½å¥‡å®å®ï¼Œæƒ³çŸ¥é“çš„äº‹æƒ…è¿˜æœ‰å¾ˆå¤šå¾ˆå¤šã€‚è¿™ä¸€ç‚¹å’±å’Œ <a href="https://twitter.com/Philo2018" target="_blank" rel="noopener">Philo</a> æœ‰ç‚¹åƒ ğŸ˜‚ï¼Œæ±å¯ä»¥çœ‹çœ‹å¥¹å†™çš„ <a href="http://lulalap.com/2020/01/02/collection-of-interesting-ideas-2019/" target="_blank" rel="noopener">Philoçš„è„‘æ´åˆé›†ï¼ˆ2019ï¼‰</a> ã€‚è€Œè¯»è¿™ç±»ä¹¦ç±æ­£æ˜¯æ»¡è¶³å’±å¥½å¥‡å¿ƒï¼Œæ±²å–çŸ¥è¯†çš„æµ·æ´‹ï¼Œè¿™ä¹Ÿæ˜¯å’±è¯»ä¹¦çš„åŸå› ã€‚æƒ³èµ·äº†æ³•å›½åšç‰©å­¦å®¶ <a href="https://zh.wikipedia.org/wiki/%E5%B8%83%E4%B8%B0" target="_blank" rel="noopener">å¸ƒä¸°</a> åœ¨ã€Šè‡ªç„¶å²ã€‹ä¹¦ä¸­çš„è¯—å¥ï¼š</p><blockquote><p>ä¸–ç•Œä¸‡ç‰©è¿è½¬æ— æ­¢æ¯ï¼Œä¸‡ç‰©éƒ½åœ¨çš„ä¸–é—´æ´ªæµä¸­ç›¸é‡ï¼Œåœ¨å¹¿è¢¤æ— å°½çš„ç©ºé—´ä¸­ï¼Œä»¥åŠç‰©æ¢æ˜Ÿç§»çš„æ¥è½¨ç¬é—´ï¼Œä¸‡ç‰©æ··æˆå†¥æ²³ï¼Œä¸æ‹˜ä»»ä½•å½¢ä½“ï¼Œä¸æ‹˜ä»»ä½•è¢«èµ‹äºˆçš„å½¢è±¡ã€‚å› æ­¤ï¼Œä¸‡äº‹ä¸‡ç‰©æˆ–ç›¸è¿‘ï¼Œæˆ–è¿œç¦»ï¼Œæˆ–åˆä¸€ï¼Œæˆ–åˆ†ç¦»æˆ–ç›¸å®¹ï¼Œæˆ–ç›¸æ–¥ï¼Œæˆ–ç”Ÿï¼Œæˆ–ç­ï¼Œæ’ä¹…ä¸å˜çš„ï¼Œåªæœ‰äº¤äº’ä½œç”¨çš„åŠ›ã€‚æ£æ„æ¨ªè¡Œï¼Œå´çµå·§è€Œä¸è‡ªä¼ï¼Œä¸ºå®‡å®™ç‡ƒèµ·ç”Ÿå‘½æ°”æ¯ï¼Œè®©ç”Ÿå‘½èˆå°ä¸Šï¼Œæ— æ—¶æ— åˆ»ä¸Šæ¼”ç€æ–°çš„æˆç ï¼Œå†™ä¸‹ç”Ÿç”Ÿä¸æ¯ï¼Œæ°¸æ— æ­¢å¢ƒçš„è¯—ç¯‡ã€‚</p></blockquote><p>é€šè¿‡é˜…è¯»è¿™ç±»ä¹¦ç±å»å’Œå…ˆè´¤å“²äººä»¬äº¤æµï¼Œæ€€æ£ç€æ‡µæ‡‚çš„å¥½å¥‡å¿ƒå»æ„Ÿæ‚Ÿå¤§è‡ªç„¶çš„ç¥å¥‡å’Œå¥¥ç§˜ã€‚</p><p>å…³äºçº¸è´¨ä¹¦ï¼šå’±å–œæ¬¢çš„è¯»ä¹¦æ–¹å¼è¿˜æ˜¯å€¾å‘äºçº¸è´¨ä¹¦ï¼Œå› ä¸ºä¹¦è¿™ç§ä¸œè¥¿ä¸ä»…ä»…æ˜¯ç”¨æ¥çœ‹ä¸Šé¢çš„æ–‡å­—ï¼Œä¹Ÿæ˜¯ç”¨æ¥è°ƒæ•´è‡ªå·±æ„Ÿè§‰å¾—å·¥å…·ã€‚å½“æ‰‹æŒ‡è§¦ç¢°ä¹¦é¡µæ—¶çš„æ„Ÿè§‰å’Œå“—å•¦å•¦ç¿»ä¹¦çš„ç¬é—´ç»™ç¥ç»çš„åˆºæ¿€æ˜¯ç”µå­ä¹¦æ— æ³•æ›¿ä»£çš„ã€‚è€Œä¸”å’±è¯»ä¹¦çš„æ—¶å€™å–œæ¬¢æ‹¿ä¸€æ”¯ç¬”åœ¨ä¹¦ä¸­æœ‰è¶£çš„åœ°æ–¹ä¹±æ¶‚ä¹±ç”»ğŸ˜‚ï¼Œå†™ä¸‹è‡ªå·±çš„æ„Ÿæ‚Ÿå’Œæ€è€ƒã€‚å–œæ¬¢æŠŠä¸€äº›ç²¾ç¾çš„ç‰‡æ®µæ‘˜æŠ„åœ¨çº¸è´¨æ‘˜æŠ„æœ¬ä¸Šï¼Œè¯»ä¹¦çš„æ€è€ƒç¬”è®°å†™åœ¨æ—¥è®°æœ¬ä¸Šã€‚å¤§å­¦çš„æ—¶å€™å†™äº†å¾ˆå¤šçš„æ‘˜æŠ„æœ¬å’Œæ—¥è®°ï¼Œç°åœ¨ç¿»æ¥çœ‹çœ‹æœ‰æ—¶è§‰ç€å½“åˆå¥½å¹¼ç¨šğŸ˜‚ã€‚è¿™ä¸ªä¹ æƒ¯è‡ªä»æ¯•ä¸šä¹‹åå°±åºŸå¼ƒäº†ï¼Œå› ä¸ºæ…¢æ…¢åœ°ä¹ æƒ¯ä¸Šåœ¨ kindle ä¸Šè¯»ä¹¦ï¼Œæ‘˜æŠ„å’Œç¬”è®°ä¹Ÿéƒ½æ˜¯æ ‡æ³¨å’Œæ‰“å­—çš„æ–¹å¼ï¼Œä»¿ä½›å¤±å»äº†å½“åˆåœ¨å¤§å­¦æ—¶è¯»ä¹¦çš„é‚£ç§çº¯çœŸï¼Œæœ‰ç‚¹é—æ†¾ï¼Œæœ‰æ—¶åˆæƒ³æ¡èµ·è¿™ä¸ªä¹ æƒ¯ã€‚</p><p>å¤§å­¦çš„æ—¶å€™å’±è¯»çš„åŸºæœ¬ä¸Šå…¨æ˜¯çº¸è´¨ä¹¦ï¼Œæ•´å¤©æ³¡å›¾ä¹¦é¦†é‡Œæ‘¸é±¼ğŸ˜‚ã€‚å››å¹´é—´ä¹°äº†ä¸å°‘ä¹¦ï¼Œæ¯•ä¸šå‰æèµ ç»™å›¾ä¹¦é¦†å¾ˆå¤§ä¸€éƒ¨åˆ†ï¼Œé€ç»™å­¦å¼Ÿå­¦å¦¹ä»¬ä¸€äº›ï¼Œåˆ°æœ€åè¿˜å‰©ä¸¤éº»è¢‹çš„ä¹¦ä¸èˆå¾—ä»å°±é‚®å¯„å›å®¶äº†ã€‚å½“æ—¶å¯„å¿«é€’çš„æ—¶å€™è´¹äº†å¾ˆå¤§çš„åŠŸå¤«ï¼Œè¦é€åˆ°ä¸‰åå…¬é‡Œå¤–çš„ç‰©æµå›­åŒºï¼Œå¯æŠŠå’±ç´¯åäº†ğŸ˜‘ã€‚ä»æ¯•ä¸šä¹‹åå°±å¾ˆå°‘å†ä¹°çº¸è´¨ä¹¦äº†ï¼Œæ¬å®¶çš„æ—¶å€™å¤ªä¸æ–¹ä¾¿äº†ï¼Œä¸æƒ³å†ä½“éªŒç¬¬äºŒæ¬¡äº†ğŸ˜‚ï¼Œæ‰€ä»¥åæ¥å°±æ…¢æ…¢ä¹ æƒ¯ç”¨ kindle çœ‹ä¹¦äº†ã€‚</p><p>kindle ç”µå­ä¹¦ä¹Ÿæ˜¯å¿«è¦å¤§å››çš„æ—¶å€™æ‰ä¹°çš„ã€‚å†åˆ°å»å¹´çš„æ—¶å€™åˆæ¢äº† kindle oasisï¼Œå¸¦æœ‰ç‰©ç†ç¿»é¡µé”®ï¼Œæœ‰äº†ä¸€ç§è¯»çº¸è´¨ä¹¦æ—¶ç¿»é¡µçš„æ„Ÿè§‰ï¼Œç›´åˆ°ç°åœ¨ä¸€ç›´æ˜¯å’±æ¯å¤©å¿…é¡»è¦ç”¨åˆ°çš„ç¡å‰è¯»ç‰© + å‚¬çœ ç¥å™¨ğŸ˜‚</p><p>ç”µå­ä¹¦å’Œçº¸è´¨ä¹¦åªæ˜¯æ–‡å­—çš„æ‰¿è½½æ–¹å¼å˜äº†ï¼Œåªè¦æˆ‘ä»¬ä¸“å¿ƒè®¤çœŸåœ°å»è¯»ä¼šå°±ä¼šç¼©å°ä¸¤ç§é˜…è¯»æ–¹å¼ä¹‹é—´çš„å·®è·ï¼Œæˆ‘ç›¸ä¿¡å³ä¾¿è¯»ç”µå­ä¹¦ä¹Ÿæ˜¯èƒ½å’Œçº¸è´¨ä¹¦é‚£æ ·æœ‰åŒæ ·çš„æ•ˆæœå’Œä½“éªŒã€‚çŠ¶æ€ä¸å¥½æ—¶ï¼Œæœ‰æ—¶å€™ä¼šè¯»ä¸ä¸‹å»ï¼Œè¿™æ—¶å€™å°±è¦æ€è€ƒæ˜¯ä»€ä¹ˆå¹²æ‰°äº†è¯»ä¹¦ï¼Œæœ‰äº›ä¹¦å³ä½¿åœ¨çŠ¶æ€ä¸å¥½æ—¶ä¹Ÿèƒ½é¡ºåˆ©çš„çœ‹ä¸‹å»ï¼Œè¿™æ—¶å€™å°±æƒ³æƒ³ä¸ºä»€ä¹ˆä¼šè¿™æ ·ã€‚</p><p>ç”µå­ä¹¦å’±è¿˜æ˜¯å–œæ¬¢ kindle è¿™ç§ç®€å•çš„è¯»ä¹¦å·¥å…·ï¼Œæ²¡æœ‰æ‚ä¸ƒæ‚å…«çš„èŠ±æ¶å­ã€‚è€Œæ‰‹æœºä¸Šçš„ app å…¶å®å¹¶ä¸é€‚åˆè¯»ä¹¦ï¼Œæ¯”å¦‚å¾®ä¿¡è¯»ä¹¦ç­‰è½¯ä»¶ï¼Œä»–ä»¬é™¤äº†è¯»ä¹¦åŠŸèƒ½ä»¥å¤–è¿˜å¤¹å¸¦ç¤¾äº¤åŠŸèƒ½ï¼Œå¹¿å‘Šæµé‡å•†ä¸šåŒ–ä¹Ÿå¾ˆä»¤äººä½œå‘•ã€‚æˆ‘ä»…ä»…æ˜¯çº¯ç²¹åœ°è¯»ä¸ªä¹¦è€Œå·²ï¼Œè€Œè¿™äº›è½¯ä»¶å´åœ¨ç¤¾äº¤å’Œæ”€æ¯”è™šè£ã€‚</p><p>è€Œä¸”å’±ç”¨ kindle è¯»ä¹¦ï¼Œé‡åˆ°å–œæ¬¢çš„ä¹¦ä¸€å£æ°”è¯»ä¸€ä¸¤ä¸ªå°æ—¶ä¸ä¸­æ–­å¯ä»¥è½»è½»æ¾æ¾åœ°åšåˆ°ï¼Œè€Œæ‰‹æœºä¸Šå’Œé˜…è¯»æ— å…³çš„ä¿¡æ¯æµå¤ªå¤šï¼Œæå®¹æ˜“è¢«æ³›æ»¥çš„ä¿¡æ¯æ‰€æŸç¼šä½è€Œç”¨å®é™…é˜…è¯»ï¼Œæˆ‘ç›¸ä¿¡å¾ˆå¤šäººéƒ½æ— æ³•åšåˆ°åšæŒä¸‰ååˆ†é’Ÿä¸ä¸­æ–­ã€‚è¿™ä¹Ÿæ˜¯å’±å…‹åˆ¶æ¯å¤©ä½¿ç”¨æ‰‹æœºæ—¶é•¿ä¸è¶…è¿‡ä¸€ä¸ªå°æ—¶çš„åŸå› ï¼Œå’±ä½¿ç”¨ kindle çš„æ—¶é—´æ˜¯æ‰‹æœºäº†ä¸¤å€ğŸ˜‚ã€‚æœ‰æ—¶å€™æ¥å—çš„ä¿¡æ¯å¤ªå¤šä¹Ÿæ˜¯ä¸€ç§æŸç¼šï¼Œä½¿è‡ªå·±æ— æ³•é›†ä¸­ç²¾åŠ›åœ¨é‡è¦çš„é˜…è¯»ä¸Šã€‚</p><h3 id="Q5ï¼šå¯¹å½“ä»Šæ—¶ä»£ç‹¬ç«‹åšå®¢çš„å‘å±•ä¸å±•æœ›ï¼Ÿ"><a href="#Q5ï¼šå¯¹å½“ä»Šæ—¶ä»£ç‹¬ç«‹åšå®¢çš„å‘å±•ä¸å±•æœ›ï¼Ÿ" class="headerlink" title="Q5ï¼šå¯¹å½“ä»Šæ—¶ä»£ç‹¬ç«‹åšå®¢çš„å‘å±•ä¸å±•æœ›ï¼Ÿ"></a>Q5ï¼šå¯¹å½“ä»Šæ—¶ä»£ç‹¬ç«‹åšå®¢çš„å‘å±•ä¸å±•æœ›ï¼Ÿ</h3><p>æœ¨å­ä¸ºä»€ä¹ˆè¦å†™ä¸ªäººç‹¬ç«‹åšå®¢å‘ï¼Œæˆ‘æƒ³å½“ä»Šå›½å†…å±€åŸŸç½‘å¤§è§„æ¨¡åˆ å¸–å°å·ã€ä¿¡æ¯å°é”ã€æ„šæ°‘æ´—è„‘ã€å…¬æƒé€ è°£å¼è¾Ÿè°£çš„äº‹æƒ…å·²ç»ç»™å‡ºå¾ˆæ˜ç¡®çš„ç­”æ¡ˆã€‚</p><p>è™½è¯´å„å›½éƒ½ä¼šæœ‰å®¡æŸ¥åˆ¶åº¦çš„å­˜åœ¨ï¼Œä½†å¤©æœè¿™ç§å®¡æŸ¥åˆ¶åº¦ï¼Œæ˜¯ä»¥äººæ€§æ”¹é€ ä¸ºç›®çš„æ€æƒ³é’³åˆ¶ï¼Œæ˜¯ä½œä¸ºæ¬ºéª—æ‰‹æ®µçš„è°è¨€å®£ä¼ ï¼›æ˜¯ææƒç»Ÿæ²»è€…å°†äººæ°‘é©¯æœä¸ºå›½å®¶æœºå™¨å¥´éš¶çš„å·¥å…·ã€‚æ­¦æ±‰è‚ºç‚ç—…æ¯’ç–«æƒ…å·²ç»è¿‡å»ä¸€ç™¾å¤šå¤©ï¼Œå†çœ‹çœ‹ç°åœ¨çš„å›½å†…åª’ä½“èˆ†è®ºã€‚æ—©å·²ç»æ²¡äº†å½“åˆå¯¹è°æŠ¥å»¶è¯¯ç–«æƒ…çš„è¿½ç©¶é—®è´£ï¼›æ—©å·²ç»æ²¡äº†å¯¹ææ–‡äº®åŒ»ç”Ÿè¢«è®­è¯«èƒŒåè¨€è®ºè‡ªç”±å’Œæ–°é—»è‡ªç”±çš„è¯‰æ±‚ï¼›æ—©å·²ç»æ²¡æœ‰äº†å¯¹çº¢åå­—ä¼šçš„æ¸èŒçš„è¿½è´£ã€‚ç°åœ¨ä¸»æµçš„å£°éŸ³è€Œæ˜¯å¯¹ç¾å¸å›½ä¸»ä¹‰çš„å¹¸ç¾ä¹ç¥¸ï¼›å¯¹å®˜åƒšä½“åˆ¶æ— èƒ½è…è´¥çš„æ©é¥°ï¼›å¯¹æƒè´µä»¬ä¸çŸ¥ç¾è€»çš„æ­ŒåŠŸèµå¾·ã€‚æ›´å¯æ€•çš„æ˜¯ï¼Œè¿™å°ææƒç»Ÿæ²»çš„æœºå™¨ç°åœ¨åœ¨è¯•å›¾ç¯¡æ”¹è¿™æ®µè®°å¿†ï¼Œå»æŠ¹å»ä»–å½“åˆç’æŠ¥ç–«æƒ…çš„ç½ªè´£ï¼Œå°†ç—…æ¯’çš„æºå¤´è½¬å«åˆ°å›½å¤–ã€‚è€Œåœ¨è¿™ä¸€åˆ‡çš„èƒŒåï¼Œéƒ½æ˜¯äº’è”ç½‘è¿™ä¸ªå·¥å…·åœ¨å¸®åŠ©ææƒç»Ÿæ²»è€…ä¸ºè™ä½œä¼¥ï¼Œåªå­˜åœ¨å¯¹ä»–æœ‰åˆ©çš„å£°éŸ³è€Œè¾¾åˆ°é›†ä½“æ´—è„‘æ§åˆ¶ã€‚ä¹Ÿæ°æ°éªŒè¯äº†â€œå½“åª’ä½“éƒ½å§“å…šâ€æ—¶ï¼Œâ€œäººæ°‘å°±è¢«æŠ›å¼ƒâ€äº†çš„ç°å®ã€‚æ²¡æœ‰äº†åª’ä½“ä»£è¡¨äººæ°‘åˆ©ç›Šå»å…¬å‘Šäº‹å®çš„çœŸç›¸ï¼Œå‰©ä¸‹çš„å°±æ˜¯äººæ°‘çš„ç”Ÿå‘½è¢«ç—…æ¯’å’Œä½“åˆ¶çš„é‡ç—…å…±åŒä¼¤å®³çš„ç»“æœã€‚</p><p>æˆ‘ä¸è®¤ä¸ºäº’è”ç½‘å°é”ã€æµé‡å„æ–­ã€è¨€è®ºå®¡æŸ¥æ˜¯äº’è”ç½‘è¯¥æœ‰çš„æ ·å­ï¼Œäº’è”ç½‘çš„åˆ›é€ å’Œæ™®åŠæ˜¯æˆ‘å¿ƒç›®ä¸­äººç±»æœ‰å²ä»¥æ¥æœ€ä¼Ÿå¤§çš„å…¬ç›Šäº‹ä¸šã€‚ç»´åŸºç™¾ç§‘å’Œäº’è”ç½‘æ¡£æ¡ˆé¦†ä»¥åŠçŸ¥è¯†å…±äº«ç¤¾åŒºä»–ä»¬å€ŸåŠ©äº’è”ç½‘ä¸ºå…¨ä¸–ç•Œæ¯ä¸€ä¸ªäººæä¾›å¹³ç­‰è·å–çŸ¥è¯†çš„æƒåˆ©ï¼Œè¿™äº›çŸ¥è¯†æ˜¯æˆ‘ä»¬å…¨äººç±»æ™ºæ…§æ–‡æ˜çš„ç»“æ™¶ï¼Œè€Œåœ¨æœ‰äº›å›½å®¶å´åœ¨å°é”ç»´åŸºç™¾ç§‘ï¼Œä¸ºä»€ä¹ˆè¦å°æ€ç»´åŸºç™¾ç§‘ï¼Œå› ä¸ºç»´åŸºç™¾ç§‘ä¸Šå®¢è§‚å­˜åœ¨çš„å†å²äº‹å®è®©ç»Ÿæ²»è€…æ‹…æƒŠå—æ€•ã€‚æˆ‘æ— æ³•ç°è±¡æˆé•¿åœ¨ GFW ä¸‹çš„åè¾ˆä»¬ä»–ä»¬è®¤ä¸ºçš„äº’è”ç½‘æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿæ˜¯åƒç™¾åº¦é‚£æ ·ä¸ç¾è€»åœ°ä½œæ¶ï¼Œåˆ å¸–å°å·æ˜¯å¯¹çš„ï¼Œè¨€è®ºå®¡æŸ¥æ˜¯æ­£å½“çš„ï¼Ÿ</p><p>å¥½åƒæœ‰ç‚¹è·‘é¢˜äº†ğŸ˜‚å¯¹äºï¼ˆä¸­æ–‡ï¼‰ç‹¬ç«‹åšå®¢çš„å‘å±•å’Œæœªæ¥ï¼Œæˆ‘æ˜¯æŒºæ‚²è§‚çš„ã€‚å› ä¸ºå¢™è¶Šæ¥è¶Šé«˜äº†ï¼Œè€Œä¼šç¿»å¢™çš„ä¸­å­¦ç”Ÿæˆ–å¤§å­¦ç”Ÿåˆæ˜¯æå°‘æ•°ï¼Œå‰©ä¸‹çš„éƒ½æ˜¯äº›å°ç²‰çº¢ä»¬ï¼Œåœ¨ GFW ä¸‹æˆé•¿èµ·æ¥çš„ä¸€ä»£è¿˜æ˜ç™½è‡ªç”±äº’è”ç½‘çš„ç²¾ç¥å—ï¼Ÿéšç€ GFW çš„ä¸æ–­å‡çº§ã€GitHub ä¸€æ¬¡æ¬¡é­å—å±è”½ã€RSSHUB ä¹Ÿè¢«å°æ€ã€å›½å†…çš„åŸŸåå¤‡æ¡ˆåˆè¿›ä¸€æ­¥åŠ å¼ºã€‚è¿™ä¼šé€¼é€€é‚£äº›æƒ³è¦æ‹¥æœ‰ç‹¬ç«‹åšå®¢çš„äººå¼€å€’è½¦å›å¢™å†…ï¼Œä¹Ÿè®¸å¤§å¤šæ•°æƒ³å†™åšå®¢çš„äººéƒ½ä¼šæ”¾å¼ƒç‹¬ç«‹åšå®¢ï¼Œè½¬è€ŒæŠ•æŠ¥å¾®ä¿¡å…¬ä¼—å·ã€çŸ¥ä¹ä¸“æ ã€ç®€ä¹¦æ˜é‡‘ã€CSDN åšå®¢å›­è¿™ç±»åšå®¢å¹³å°ã€‚æ¯•ç«Ÿä»–ä»¬å„æ–­ç€å›½å†…ä¿¡æ¯è·å–çš„æµé‡ã€‚åœ¨è¿™äº›å¹³å°ä¸Šç”˜æ„¿è‡ªæˆ‘å®¡æŸ¥å’Œè‡ªæˆ‘é˜‰å‰²ï¼Œåœ¨è‡ªæˆ‘å¿ƒä¸­æ ‘ç«‹ä¸€é“å¢™ã€‚è€Œæœ€å¯æ€•çš„åæœå°±æ˜¯è¿™ç±»å¹³å°<strong>è®©èƒ½å†™æ–‡ç« çš„äººå¥½åƒæˆä¸ºäº†è¿™ä¸ªå¹³å°çš„ä¸€ä¸ªå†™ä½œçš„å¥´éš¶ï¼Œè€Œä¸æ˜¯è®©ä»–ä»¬çš„æ–‡ç« ä¸­çš„å†…å®¹å’Œè§‚ç‚¹å¯ä»¥æœ‰é•¿æ—¶é—´çš„å½±å“åŠ›ã€‚æ¢è¨€ä¹‹ï¼Œåœ¨ç¤¾äº¤ç½‘ç»œä¸Šï¼Œå¦‚æœä½ è¦æœ‰å½±å“åŠ›ï¼Œä½ å°±è¦ä½¿åŠ²å†™ï¼Œéœ€è¦æ›´å¤šçš„ç²‰ä¸å’Œè®¢é˜…è€…ã€‚æˆ‘ä¸ªäººè®¤ä¸ºè¿™æ˜¯è¿åäº†ä¿¡æ¯ä¼ æ’­è§„å¾‹çš„ã€‚</strong></p><p>å¯¹äºç‹¬ç«‹åšå®¢ï¼Œå’±æ¯”è¾ƒå–œæ¬¢ <a href="https://coolshell.cn/haoel" target="_blank" rel="noopener">é™ˆçš“</a> å‰è¾ˆå†™è¿‡çš„ä¸€ç¯‡æ–‡ç«  <a href="https://coolshell.cn/articles/17391.html" target="_blank" rel="noopener">ã€Šæˆ‘ä¸ºä»€ä¹ˆä¸åœ¨å¾®ä¿¡å…¬ä¼—å·å†™æ–‡ç« ã€‹</a></p><blockquote class="twitter-tweet"><p lang="zh" dir="ltr">åŒäº‹å¼€äº†å¾®ä¿¡å…¬ä¼—å·ï¼Œå‘æˆ‘äºŒç»´ğŸè®©æˆ‘å»å…³æ³¨ä¸€æ³¢ã€‚æˆ‘ç›´æ¥ä¸€ç¯‡ <a href="https://twitter.com/haoel?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@haoel</a> çš„ã€Šä¸ºä»€ä¹ˆæˆ‘ä¸åœ¨å¾®ä¿¡å…¬ä¼—å·ä¸Šå†™æ–‡ç« ã€‹å›ç»äº†è¿‡å» ğŸ˜‚ï¼Œåƒè¾›ä¸‡è‹¦ç¿»å‡ºæ¥äº†å¹²å˜›è¿˜è¦å¼€å€’è½¦å›å¢™å†…ğŸ¤”ã€‚<a href="https://t.co/NEyO9RucrV" target="_blank" rel="noopener">https://t.co/NEyO9RucrV</a></p>&mdash; HTTP 502 (@muzi_ii) <a href="https://twitter.com/muzi_ii/status/1238335413799890944?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">March 13, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>æˆ‘å¸Œæœ›äº’è”ç½‘èƒ½å¤ŸæŒç»­å…¬å¼€é€æ˜å¯æ£€ç´¢ï¼Œæ‰€æœ‰äººéƒ½å¯ä»¥åœ¨ç½‘ç»œä¸–ç•Œé‡Œè‡ªç”±å’Œç‹¬ç«‹åœ°è¡¨è¾¾è‡ªæˆ‘ã€‚è€Œè¨€è®ºå®¡æŸ¥ã€äº’è”ç½‘å°é”ã€æµé‡å„æ–­ç­‰ç­‰è¿™ä¸æ˜¯ä¸‡ç»´ç½‘ä¹‹çˆ¶ <a href="https://zh.wikipedia.org/zh-cn/%E8%92%82%E5%A7%86%C2%B7%E4%BC%AF%E7%BA%B3%E6%96%AF-%E6%9D%8E" target="_blank" rel="noopener">è’‚å§†Â·ä¼¯çº³æ–¯-æ</a> å‰è¾ˆå½“åˆæ‰€åˆ›é€ çš„ç½‘ç»œä¸–ç•Œï¼Œä¹Ÿä¸æ˜¯äº’è”ç½‘ä¹‹å­ <a href="https://coolshell.cn/articles/11928.html" target="_blank" rel="noopener">äºšä¼¦Â·æ–¯æ²ƒèŒ¨</a> ç”¨ç”Ÿå‘½å»æå«çš„èµ›åšç©ºé—´ã€‚</p><p>å‡è‹¥æœ‰äººçœ‹åˆ°å’±çš„åšå®¢ï¼Œæˆ–è®¸èƒ½æ”¹å˜ä»–ä»¬ï¼Œè®©ä»–ä»¬ä¹Ÿèƒ½åŠ å…¥åˆ°å’±ä»¬ä¸­æ¥ã€‚è¿™ä¹Ÿæ˜¯å’±å†™è¿™ä¸ªåšå®¢ç°åœ¨çš„åŠ¨åŠ›å§ã€‚å…¶å®å’±å¹¶ä¸æ˜¯å¾ˆå–œæ¬¢å†™æŠ€æœ¯ç›¸å…³çš„å†…å®¹ï¼Œå°±å¦‚é²è¿…å…ˆç”Ÿæ‰€è¨€ï¼šå­¦åŒ»æ•‘ä¸äº†ä¸­å›½äººä¸€æ ·ğŸ˜‚ã€‚å’±è§‰ç€å’±å†™æŠ€æœ¯æ–‡ç« ä¹Ÿæ•‘ä¸äº†èº«è¾¹è¢«çœŸç†éƒ¨æ„šæ°‘æ´—è„‘çš„ç²‰çº¢ä»¬ã€‚æ‰€ä»¥å’±è§‰ç€åœ¨è¯»ä¹¦å’Œå†™åšå®¢çš„åŒæ—¶ï¼Œå’±æ›´åº”è¯¥è‚©è´Ÿèµ·çŸ¥è¯†ä»½å­æœ€åº”æœ‰çš„è´£ä»»ï¼š<strong>ä¼ æ’­å¸¸è¯†è®©äººæ‘†è„±æ— çŸ¥ï¼Œå¯äººæ€è€ƒè®©äººèµ°å‡ºæ„šæ˜§ï¼Œæ­éœ²çœŸç›¸è®©äººè¿œç¦»è°è¨€ã€‚</strong></p><p>å’±çš„åšå®¢å°±æ˜¯å’±çš„â€œå¦ä¸€åŠâ€ï¼Œæ°¸è¿œä¼šå®ˆæŠ¤ç€ä»–ã€‚ä¸è¿‡å’±ä¹Ÿåœ¨å¼•å¯¼ä¸€äº›æ–°äººåŠ å…¥åˆ°ç‹¬ç«‹åšå®¢ä¸­æ¥ï¼Œæ¯”å¦‚å»å¹´æš‘å‡çš„æ—¶å€™è®¤è¯†çš„ä¸€ä¸ªå°å­¦å¼Ÿï¼Œå’±å°±æ•™ä»–ä¸€äº›æ­å»ºåšå®¢ã€ä¹°æœåŠ¡å™¨ã€æ³¨å†ŒåŸŸåçš„æ–¹æ³•ï¼Œå¼•å¯¼ä»–ä¹Ÿæ¥å†™åšå®¢ğŸ¤£ã€‚æ‰€ä»¥å’±çš„åšå®¢å†™å¥½äº†ï¼Œä¹Ÿæ˜¯å¯¹åè¾ˆä»¬çš„ä¸€ç§æŒ‡å¼•ï¼Œå»æŒ‡å¼•ä»–ä»¬åœ¨è‡ªç”±çš„äº’è”ç½‘å‹‡äºä¼ æ’­è‡ªå·±çš„æ€æƒ³ã€‚</p><p>æ€»ä¹‹ç‹¬ç«‹åšå®¢çš„å‰é€”è¿˜è¦æˆ‘ä»¬å…±åŒåŠªåŠ›ï¼Œç‹¬ç«‹åšå®¢æ˜¯å’±ä»¬è‡ªå·±çš„å°ä¸–ç•Œï¼Œå°±åƒæ—¶é›¨è‡ªå·±å†™çš„åšå®¢ä¸€æ ·ã€‚ç²¾å¿ƒæ‰“ç†å‘µæŠ¤ï¼Œåƒä¸€ä»¶è‰ºæœ¯å“ä¸€æ ·å»é›•ç¢å®ƒï¼Œè¿™ä¹Ÿæ˜¯ç‹¬ç«‹åšå®¢è¿·äººä¹‹å¤„ï¼Œä¹Ÿæ­£æ˜¯åƒæ—¶é›¨è¿™æ ·å¼€æºåˆ†äº«çš„ç²¾ç¥ï¼Œä¼šå¸å¼•æ›´å¤šçš„äººåŠ å…¥åˆ°ç‹¬ç«‹åšå®¢ä¸­æ¥ã€‚ç‹¬ç«‹åšå®¢ä¸Šçš„æ–‡ç« åªè¦åŸŸåå’ŒæœåŠ¡å™¨è¿˜åœ¨ï¼Œå°±ä¼šè¢«æœç´¢å¼•æ“æ£€ç´¢åˆ°ï¼Œä¸ç®¡å¤šä¹…å®ƒéƒ½ä¼šè¢«éœ€è¦å®ƒçš„äººå‘æ˜åˆ°ã€‚</p><p><img src="img/image-20200404190715388.png" alt="image-20200404190715388"></p><p><img src="img/image-20200404190726626.png" alt="image-20200404190726626"></p><p>æœ€åè¿˜æƒ³è¯´çš„æ˜¯ï¼Œé˜¿æˆ¿å®«çš„æ¥¼å®‡å®«é˜æ—©å·²è¡ç„¶æ— å­˜ï¼Œä½†æœç‰§çš„é˜¿æˆ¿å®«èµ‹å´èƒ½æµèŠ³ç™¾ä¸–ã€‚ä¹¦å†™èƒ½è®°è½½ç€æˆ‘ä»¬çš„æ€æƒ³ï¼Œå¹¶è·¨è¶Šæ—¶é—´å’Œç©ºå‰ä¼ æ’­å®ƒä»¬ï¼Œä½†æ„¿åƒç™¾å¹´åçš„äº’è”ç½‘è¿˜èƒ½æ£€ç´¢åˆ°å’±æ›¾ç»ç•™ä¸‹çš„é—²è¨€ç¢è¯­ã€‚ç‹¬ç«‹åšå®¢å°±åƒä¸€è‰˜å°èˆ¹ï¼Œåœ¨è‡ªç”±çš„äº’è”ç½‘èˆªè¡Œï¼Œè€Œæˆ‘ä»¬å½¼æ­¤ä¹‹é—´çš„è¿æ¥ï¼Œæ„ç­‘æˆäº†ä¸€ä¸ªç‹¬ç«‹çš„ä¸–ç•Œï¼Œè¿™ä¸ªä¸–ç•Œé‡Œæ²¡æœ‰åˆ å¸–å°å·ï¼Œæ²¡æœ‰è¨€è®ºå®¡æŸ¥ã€æ²¡æœ‰äº’è”ç½‘å°é”ï¼Œæœ‰çš„æ˜¯ä¸åŒçš„å£°éŸ³ï¼›æœ‰çš„æ˜¯æ€æƒ³ç¢°æ’çš„ç«èŠ±ï¼›æœ‰çš„æ˜¯è‡ªç”±çš„ç²¾ç¥å’Œç‹¬ç«‹çš„æ€æƒ³ï¼</p><h3 id="Q6ï¼šæœ¨å­æœ€æƒ³è·å¾—çš„ä¸€ä»½èƒ½åŠ›ï¼Ÿ"><a href="#Q6ï¼šæœ¨å­æœ€æƒ³è·å¾—çš„ä¸€ä»½èƒ½åŠ›ï¼Ÿ" class="headerlink" title="Q6ï¼šæœ¨å­æœ€æƒ³è·å¾—çš„ä¸€ä»½èƒ½åŠ›ï¼Ÿ"></a>Q6ï¼šæœ¨å­æœ€æƒ³è·å¾—çš„ä¸€ä»½èƒ½åŠ›ï¼Ÿ</h3><p>ç›®å‰æ¥è®²ç°å®ä¸­æœ€éœ€è¦çš„æ˜¯æ¬ç –èƒ½åŠ›ï¼Œæ¯”å¦‚ï¼šç²¾é€š K8s ã€ç²¾é€š Golang ç¼–ç¨‹ ã€ç²¾é€š LinuxğŸ˜‚ ï¼Œç„¶åä¹Ÿèƒ½åƒæ—¶é›¨çš„ <a href="https://github.com/chanshiyucx/aurora" target="_blank" rel="noopener">Aurora</a> é‚£æ ·ï¼Œæœ‰ä¸ªå¯ä»¥æ‹¿çš„å‡ºæ‰‹çš„å¼€æºé¡¹ç›®åˆ†äº«ç»™å¤§å®¶ã€‚å› ä¸ºæ¬ç –æŠ€æœ¯å¤ªèœäº†ï¼Œé¢è¯•äº†å¥½å‡ å®¶å…¬å¸éƒ½ä¸è¦å’±ï¼ˆå¤§å“­ã€‚å’±ä¸æ”¾å¼ƒï¼Œå’±è€¶åœ¨åŠªåŠ›å­¦ä¹ ingï¼Œäº‰å–æ—©ä¸€å¤©ç¦»å¼€è¿™é‡Œï¼ŒæˆåŠŸæ‹¿åˆ°å¿ƒæ»¡æ„è¶³çš„ offer ï¼</p><h3 id="Q7ï¼šå¯¹äº-ACGN-çš„çœ‹æ³•ï¼Ÿ"><a href="#Q7ï¼šå¯¹äº-ACGN-çš„çœ‹æ³•ï¼Ÿ" class="headerlink" title="Q7ï¼šå¯¹äº ACGN çš„çœ‹æ³•ï¼Ÿ"></a>Q7ï¼šå¯¹äº ACGN çš„çœ‹æ³•ï¼Ÿ</h3><p><code>æ­¤ç”Ÿæ— æ‚”å…¥ä¸œæ–¹ï¼Œæ¥ä¸–æ„¿ç”Ÿå¹»æƒ³ä¹¡ğŸ˜‚</code></p><p>é¦–å…ˆæƒ³åˆ°çš„ä¸€ä¸ªè¯æ—¶ <strong>çº¯ç²¹</strong> ï¼ŒACGN é‡Œé¢çš„ä½œå“å’Œäººç‰©å¾ˆå°‘æœ‰ä¸‰æ¬¡å…ƒæ˜æ˜Ÿæ­Œæ˜Ÿé‚£æ ·çš„å…‰ç¯æ•ˆåº”ï¼Œä¸€éƒ¨ä½œå“å£ç¢‘å’Œä¸€ä¸ªäººç‰©è§’è‰²å¡‘é€ ï¼Œéƒ½æ˜¯å…¨å‡­å®åŠ›ï¼Œæ²¡æœ‰æ‚ä¸ƒæ‚å…«çš„èŠ±æ¶å­ã€‚</p><p>ä¸­å­¦æ—¶ä»£æ›¾è¿½è¿‡ç«å½±å¿è€…ï¼Œç›´åˆ°é«˜ä¸­æ¯•ä¸šåçš„ä¸ä¹…ç«å½±å®Œç»“ã€‚è¿™éƒ¨åŠ¨æ¼«ä¸ºé«˜ä¸‰æ¯ç‡¥çš„è‹¦é€¼å­¦ä¹ ç”Ÿæ´»å¢æ·»äº†ä¸€æŠ¹è‰²å½©ï¼Œæ¯å‘¨çš„å‘¨å››æ™šè‡ªä¹ åï¼Œå’±å°±å¸¦å¤´åœ¨ç­é‡Œå…¬å¼€æ”¾æ˜ ï¼Œéš”å£ç­é‡Œä¹Ÿä¼šæ¥å¾ˆå¤šäººï¼Œå‡‘åœ¨ä¸€èµ·åæ¥ä¸ªäººã€‚ææ€•å½“æ—¶ä¹Ÿæ˜¯å…¨æ ¡å”¯ä¸€ä¸€ä¸ªæ•¢å¦‚æ­¤èƒ†å¤§å¦„ä¸ºçš„ç­çº§äº†ğŸ˜‚ã€‚é‚£æ—¶ï¼Œç«å½±ç¡®å®æ˜¯å’±æ¯å‘¨çš„å¿«ä¹è°ƒå‰‚ï¼Œæ²¡æœ‰å®ƒçš„é«˜ä¸‰æ˜¯å¤šä¹ˆåœ°æ— å‘³ã€‚</p><p>å†åˆ°åæ¥ä¸Šå¤§å­¦åï¼Œç»ˆäºæœ‰äº†å……è¶³çš„æ—¶é—´æ¥è¿½ç•ªã€‚è¿™æ‰çœŸæ­£æ„ä¹‰ä¸Šå¼€å§‹äº†è§£ ACGN ï¼Œå¤§ä¸€å¤§äºŒçš„æ—¶å€™å¼€å§‹å…¥å®…ï¼Œæ¯å¤©ä¸‹è¯¾åéƒ½èº²åˆ°å®¿èˆè¿½ç•ªï¼Œæ­»è‚¥å®…ä¸€ä¸ªğŸ˜‚ã€‚å†åˆ°ç°åœ¨ä¹Ÿä¼šçœ‹ä¸€äº›æ¼«ç”»å’Œè½»å°è¯´ï¼Œæ¯å­£åº¦è¿½ 1~2 éƒ¨åŠ¨ç”»ã€‚æ¯•ç«Ÿæ¯å‘¨æœ‰ç‚¹ç›¼å¤´ä¹Ÿæ˜¯å’±ç”Ÿæ´»çš„ä¹è¶£å‘€ã€‚</p><p>è‡³äºæ¸¸æˆï¼Œå’±ä¸å¤ªä¼šç©å„¿ï¼Œæ‰‹æ®‹å…šğŸ˜‚ï¼Œè™½ç„¶ä¹Ÿæƒ³ä»ä¸­æ”¶è·å¿«ä¹ï¼Œä½†æ˜¯å°±æ˜¯è§‰ç€æ¸¸æˆå’Œå’±è¿˜æ˜¯ä¸å¤ªèˆ¬é…ã€‚å»å¹´çš„æ—¶å€™ç©è¿‡ä¸€ç‚¹ <code>å´©å 3rd</code> åæ¥å°±å¼ƒå‘äº†ï¼Œå› ä¸ºä»ä¸­æ‰¾ä¸åˆ°å¿«ä¹ï¼ä¸å¦‚åƒçœ‹ä¹¦å’Œçœ‹æ¼«ç”»å»æ€è€ƒè¿™éƒ¨ä½œå“è¡¨è¾¾ä¿¡å¿µé‚£æ ·æœ‰è¶£ï¼Œæ€»ä¹‹æ¸¸æˆæ˜¯å¥½ç©çš„ä¸€ç‚¹ï¼Œä½†å´ä¸åƒå…¶ä»–æ–‡åŒ–ä½œå“ä¸€æ ·èƒ½å¤Ÿå¯å‘äººä»¬å»æ€è€ƒä¸€äº›äº‹æƒ…ã€‚</p><p>æ€»ä¹‹ ACNG ä¹Ÿæ˜¯æˆ‘ä»¬æˆé•¿ä¸­çš„è€å¸ˆï¼Œå®ƒä»¬ä¼šä¼´éšç€æˆ‘èµ°å®Œè¿™ä¸€ç”Ÿï¼Œæ— è®ºå¤šä¹…éƒ½ä¸ä¼šå¿˜è®°è¿™ä»½åˆå¿ƒã€‚</p><h3 id="Q8ï¼šå¯¹å¯„æ‰˜äºå†…å¿ƒå¹»æƒ³ä¸–ç•Œçš„ç”Ÿæ´»æ€åº¦çš„çœ‹æ³•ï¼Ÿ"><a href="#Q8ï¼šå¯¹å¯„æ‰˜äºå†…å¿ƒå¹»æƒ³ä¸–ç•Œçš„ç”Ÿæ´»æ€åº¦çš„çœ‹æ³•ï¼Ÿ" class="headerlink" title="Q8ï¼šå¯¹å¯„æ‰˜äºå†…å¿ƒå¹»æƒ³ä¸–ç•Œçš„ç”Ÿæ´»æ€åº¦çš„çœ‹æ³•ï¼Ÿ"></a>Q8ï¼šå¯¹å¯„æ‰˜äºå†…å¿ƒå¹»æƒ³ä¸–ç•Œçš„ç”Ÿæ´»æ€åº¦çš„çœ‹æ³•ï¼Ÿ</h3><p>å†…å¿ƒå¹»æƒ³ä¸–ç•Œ?è«éè¯´çš„æ˜¯å’±ğŸ˜‚(å¤§é›¾ã€‚å¹»æƒ³ã€æƒ³æƒ³ã€æ€è€ƒï¼Œè¿™ä¸‰è€…å æ®äº†å’±ä¸€å¤©ä¸­é™¤äº†å·¥ä½œæ—¶é—´ä»¥å¤–çš„ç»å¤§å¤šæ•°çš„æ—¶é—´ï¼Œåªæ˜¯æ¯”ä¾‹ä¸åŒè€Œå·²ã€‚åªè¦ä¸å½±å“æ­£å¸¸çš„å·¥ä½œå’Œå­¦ä¹ ï¼Œéƒ½å¯ä»¥å‘€ï¼Œåæ­£å’±å–œæ¬¢è¿™æ ·çš„ç”Ÿæ´»æ€åº¦ï¼Œæ€»æ¯”é‚£äº›ä¸€å¤©åˆ°æ™šåªé¡¾çš„æé’±ï¼Œå¨±ä¹è‡³æ­»åœ°åˆ·çŸ­è§†é¢‘çš„ç”Ÿæ´»æ€åº¦è¦å¥½å‘€ã€‚</p><p>å’±ä¸­å­¦æ—¶æœ‰è¿‡ä¸€æ®µæ—¶é—´æ´»åœ¨çº¯ç²¹å¹»æƒ³çš„ä¸–ç•Œä¸­(ä¸­äºŒç—…ï¼Œç»å¯¹çš„é»‘å†å²ï¼Œä»æ¥æ²¡å’Œä»–äººæè¿‡ğŸ˜‚ã€‚é‚£æ—¶å’±çœ‹äº†å¾ˆå¤šå¾ˆå¤šçš„ç„å¹»/ç©¿è¶Š/ä¿®çœŸå°è¯´ï¼ŒåŠ èµ·æ¥è‡³å°‘è¦ 1000 ä¸‡å­—å§(æƒŠï¼ä¸»è¦æ˜¯å› ä¸ºè®¨åŒå­¦ä¹ ä¸æƒ³ä¸Šå­¦ï¼Œä¸Šè¯¾æ—¶å°±å¹»æƒ³è€…å’Œå°è¯´ä¸­çš„ä¸»äººå…¬ä¸€æ ·åœ¨å¼‚ä¸–ç•Œä¿®çœŸæ‰“æ€ªå‡çº§ï¼Œå¹»æƒ³ç€å¥³ä¸»è§’å°±æ˜¯ç­é‡Œå–œæ¬¢çš„é‚£ä¸ªå¥³ç”ŸğŸ˜‚ã€‚æ€»ä¹‹æˆ‘æ„Ÿè§‰é‚£æ®µæ—¶é—´æ˜¯æ´»åœ¨ç™½æ—¥æ¢¦ä¸­ï¼Œä¸ºäº†é€ƒé¿æ¯ç‡¥çš„å­¦ä¹ è€Œæ´»åœ¨å¹»æƒ³çš„ä¸–ç•Œä¸­ã€‚åæ¥ç›´åˆ°é«˜ä¸­æ—¶ä¹Ÿä¼šåœ¨è¯¾ä¸Šå¬ä¸ä¸‹å»çš„æ—¶å€™å¹»æƒ³äº›åˆ«çš„ã€‚ä¸Šå¤§å­¦ä¹‹åå°±å¾ˆå°‘å†å¹»æƒ³äº†ï¼Œå› ä¸ºç°å®ä¸–ç•Œå……å®èµ·æ¥å¾ˆå°‘æœ‰æ—¶é—´å¹»æƒ³è¿™äº›äº‹å„¿äº†ã€‚</p><p>ç°åœ¨å‘¢ï¼Ÿæœ‰æ—¶ä¹Ÿä¼šå¹»æƒ³ç€ä»¥åçš„ç”Ÿæ´»ï¼Œå¹»æƒ³ç€å°†æ¥å¦‚ä½•æ•´ç†è‡ªå·±çš„å°çªå’Œä¹¦æˆ¿ï¼›å¹»æƒ³ç€å’Œæƒ³è§çš„äººé¢å¯¹é¢è®¨è®ºæœ¨æ˜Ÿä¸Šçš„é‚£å—å¤§çº¢æ–‘ï¼Ÿå¹»æƒ³ç€åƒè‹¹æœä¹‹çˆ¶ <a href="https://zh.wikipedia.org/wiki/%E6%96%AF%E8%92%82%E5%A4%AB%C2%B7%E6%B2%83%E5%85%B9%E5%B0%BC%E4%BA%9A%E5%85%8B" target="_blank" rel="noopener">æ²ƒå…¹</a> çš„çˆ¶äº²é‚£æ ·æ•™æœªæ¥çš„å„¿å­æœ‰å…³ç”µå­ç”µé˜»çš„çŸ¥è¯†ï¼ˆå› ä¸ºçœ‹äº† <a href="https://m.douban.com/book/subject/21966356/" target="_blank" rel="noopener">ã€Šæ²ƒå…¹ä¼ :ä¸è‹¹æœä¸€èµ·ç–¯ç‹‚ã€‹</a> ,çˆ¶ä¸å­ç»“å¯¹ç¼–ç¨‹å¤šå¥½ç©å‘€(å¤§é›¾ ã€‚å¹»æƒ³ç€é€æœªæ¥çš„å„¿å­å»ä¸Šå­¦â€¦â€¦ å¹»æƒ³ç€å¾ˆå¤šæœªæ¥çš„ç”Ÿæ´»ã€‚ä¸åŒäºä¸­å­¦ä¸­äºŒç—…æ—¶æœŸçš„é‚£æ ·ï¼Œç°åœ¨çš„å¹»æƒ³å¤šå°‘ç»™äº†ç‚¹è‡ªå·±æ´»ä¸‹å»çš„åŠ¨åŠ›å’Œå¸Œæœ›å§ï¼Œä¹Ÿè®¸æœ‰äº›äº‹æƒ…æ°¸è¿œä¸ä¼šå®ç°ï¼Œä½†ä¿æŒå¯¹æœªæ¥çš„æœŸå¾…å’Œå¹»æƒ³æ‰è®©å½“ä¸‹çš„ç”Ÿæ´»æ‰æœ‰æ„ä¹‰å‘€ã€‚</p><p>æ€è€ƒå’Œæƒ³è±¡åˆ™èµ‹äºˆå’±æ›´å¤šç°å®æ„ä¹‰ï¼Œä¹¦ç±å°±å¦‚å’±æ€è€ƒçš„æºæ³‰ï¼Œè€Œæƒ³è±¡åˆ™æ˜¯æ€æƒ³ç¢°æ’ğŸ’¥åçš„æ¶Ÿæ¼ªï¼Œå°±å¦‚ <a href="https://zh.wikipedia.org/zh-cn/%E5%AE%87%E5%AE%99%E6%97%B6%E7%A9%BA%E4%B9%8B%E6%97%85" target="_blank" rel="noopener">ã€Šå®‡å®™æ—¶ç©ºä¹‹æ—…ã€‹</a> é‡Œçš„æƒ³è±¡ä¹‹èˆŸï¼Œå¸¦ç€å’±ä»å¤©æ–‡å­¦çŸ¥è¯†åˆ°ç”Ÿå‘½èµ·æºã€æ°”å€™å˜åŒ–ã€ç§‘å­¦ç²¾ç¥éƒ½ä¸€ä¸€æ¢è®¨ï¼Œè¶³ä»¥æ”¹å˜äººç”Ÿè§‚ï¼Œè®©äººåœ¨æŠ¬å¤´ä»°æœ›æ˜Ÿç©ºæ—¶ï¼Œå°‘ä¸€ç‚¹è¿·ä¿¡å’Œæ— çŸ¥ï¼Œå¤šä¸€ä»½å¥½å¥‡ä¸å…³çˆ±ã€‚</p><p><img src="img/image-20200404190442465.png" alt="image-20200404190442465"></p><p>ä½†å‰ææ˜¯ä¸è¦å½±å“åˆ°ç°å®ä¸­çš„å·¥ä½œå’Œå­¦ä¹ å“¦ï¼Œæ¯•ç«Ÿç°å®ä¸–ç•Œä¹Ÿå¾ˆé‡è¦å‘€ã€‚è‡ªå·±çš„å°ä¸–ç•Œè¦é åœ¨ç°å®ä¸–ç•Œé‡Œçš„ä»˜å‡ºæ‰èƒ½ç»´æŒä½çš„ï¼Œå½“å®Œæˆç°å®ä¸–ç•Œé‡Œçš„ä»»åŠ¡å°±èº²åˆ°è‡ªå·±çš„å°ä¸–ç•Œé‡Œå¤©é©¬è¡Œç©ºé¨æ¸¸æ˜Ÿé™…ã€‚è¿™æ‰æ˜¯æˆ‘ä»¬ä½œä¸ºäººåŸæœ¬çš„ç”Ÿæ´»æ€åº¦å‘€ï¼Œæ¯›èŒ¹é¥®è¡€çš„å¤äººä»¬æ™šä¸Šä»°æœ›æ˜Ÿç©ºæ—¶ä¸æ­£ä¹Ÿåœ¨å¹»æƒ³æˆ‘ä»¬æ­£åœ¨å¹»æƒ³çš„å®‡å®™å˜›~</p><p>ç¡è§‰å§ï¼Œæ¢¦é‡Œå•¥éƒ½æœ‰ï¼ˆå·ç¬‘</p><h3 id="Q9ï¼šæœ¨å­å¦‚ä½•åœ¨ä¸€ä¸ªäººçš„è‡ªç”±ç”Ÿæ´»å¦‚ä½•è·å¾—å¿«ä¹è°ƒå‰‚ï¼Ÿ"><a href="#Q9ï¼šæœ¨å­å¦‚ä½•åœ¨ä¸€ä¸ªäººçš„è‡ªç”±ç”Ÿæ´»å¦‚ä½•è·å¾—å¿«ä¹è°ƒå‰‚ï¼Ÿ" class="headerlink" title="Q9ï¼šæœ¨å­å¦‚ä½•åœ¨ä¸€ä¸ªäººçš„è‡ªç”±ç”Ÿæ´»å¦‚ä½•è·å¾—å¿«ä¹è°ƒå‰‚ï¼Ÿ"></a>Q9ï¼šæœ¨å­å¦‚ä½•åœ¨ä¸€ä¸ªäººçš„è‡ªç”±ç”Ÿæ´»å¦‚ä½•è·å¾—å¿«ä¹è°ƒå‰‚ï¼Ÿ</h3><p>ä¸»è¦æ˜¯é€šè¿‡å­¦ä¹ æ–°çŸ¥è¯†å’ŒçæŠ˜è…¾æ¥æ»¡è¶³å¥½å¥‡å¿ƒå’Œæ±‚çŸ¥æ¬²ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­æ”¶è·çš„çŸ¥è¯†æ˜¯æœ€ç¾å‘³çš„å¿«ä¹è°ƒå‰‚ã€‚</p><p>æ¯”å¦‚ä¹‹å‰å’±åœ¨å»å¹´çš„æ—¶å€™æŠ˜è…¾è¿‡ <a href="https://blog.k8s.li/esp8266-pc-switch.html">ã€Šä½¿ç”¨ ESP8266 NodeMCU æ‰“é€  WiFi å¼€å…³ã€‹</a>ï¼Œå½“æ—¶å’±å¯¹åµŒå…¥å¼å¼€å‘ä¸€ç‚¹éƒ½ä¸ç†Ÿæ‚‰ï¼Œå¯¹é€»è¾‘ç”µè·¯ä¹Ÿä¸å¤ªæ‡‚ã€‚è‡ªå·±å°±ä»é›¶å¼€å§‹å­¦ä¹ å„ç§æ¦‚å¿µå’ŒåŸç†ï¼Œçœ‹äº†ä¸€äº›ç§‘æ™®è§†é¢‘ï¼Œé‚£æœŸå’±ç»ˆäºç†è§£äº†åœºæ•ˆåº”ç®¡ã€æ”¾å¤§å™¨ã€ä¸‰ææ™¶ä½“ç®¡ã€è§¦å‘å™¨ã€æ™¶ä½“ç®¡ç­‰åŸç†ï¼Œæ‰ä½“ä¼šåˆ°ç”± 0 å’Œ 1 æ§åˆ¶çš„ç”µå­ä¸–ç•Œçš„ç¥å¥‡ï¼</p><blockquote class="twitter-tweet"><p lang="zh" dir="ltr">ä»Šå¤©èŠ±äº†ä¸€æ•´å¤©ï¼Œä»é›¶å¼€å§‹å­¦ä¹ äº† Arduino ç¼–ç¨‹ï¼Œåˆ¶ä½œå¥½äº†ä¸€ä¸ª WiFi æ§åˆ¶çš„ç»§ç”µå™¨å¼€å…³ï¼Œè¿™æ ·åœ¨å…¬å¸ä¹Ÿèƒ½é€šè¿‡ä¸€ä¸ª curl å‘½ä»¤æ§åˆ¶å®¶é‡Œçš„ä¸»æœºå¼€å…³å•¦ï¼<br>ç”± 0å’Œ1 æ§åˆ¶çš„ä¸–ç•ŒçœŸç¥å¥‡ï¼ <a href="https://t.co/ubt8ncbK1z" target="_blank" rel="noopener">pic.twitter.com/ubt8ncbK1z</a></p>&mdash; HTTP 502 (@muzi_ii) <a href="https://twitter.com/muzi_ii/status/1175408986557779968?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">September 21, 2019</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><blockquote><p>ã€æˆ‘ä¸€ç›´è§‰å¾—ï¼Œè´¹é©¬ã€æ¬§æ‹‰ã€å“¥å¾·å·´èµ«ç­‰äººä¸ç°ä»£äººç›¸æ¯”ï¼Œä»–ä»¬å…·æœ‰æ ¼å¤–æ—ºç››çš„å¥½å¥‡å¿ƒå’Œä¸°å¯Œçš„æƒ³è±¡åŠ›ï¼Œå¹¶ä¸”å……æ»¡äº†ç”Ÿæœºä¸æ´»åŠ›ã€‚éšç€ç¤¾ä¼šå‘å±•çš„æ—¥ç›Šæˆç†Ÿï¼Œå¥½å¥‡å¿ƒå’Œæƒ³è±¡åŠ›ä¸å¯é¿å…åœ°ä¸æ–­é™ä½ï¼Œä½†å¹¶ä¸ä»£è¡¨ç°ä»£ç¤¾ä¼šä¸å†éœ€è¦å¥½å¥‡å¿ƒå’Œæƒ³è±¡åŠ›ã€‚ã€</p></blockquote><blockquote class="twitter-tweet"><p lang="zh" dir="ltr">ä½œä¸ºä¸€ä¸ªåƒåœ¾ä½¬ï¼Œå½“ç„¶è¦è‡ªå·± xjb æ£é¼“å•¦ï¼ŒæŠ˜è…¾èµ·æ¥å¾ˆæœ‰æˆå°±æ„ŸğŸ˜‚<br>æœŸé—´å­¦åˆ°ä¸å°‘ä¸œè¥¿ï¼ŒGPIO å¼•è„šå®šä¹‰ã€ä¸‰æç®¡çš„åŸç†ã€ç»§ç”µå™¨ã€ESP8266 ç”µè·¯å›¾ã€é€šè¿‡å‘½ä»¤è¡Œæ§åˆ¶ USB ç”µæºã€Arduino IDE ã€è®¾å¤‡æ ‘ã€å…‰è€¦éš”ç¦»ã€AT æŒ‡ä»¤ ã€TCP/IP ã€ä¸²å£é€šä¿¡ã€æ³¢ç‰¹ç‡ç­‰<br>æŠ˜è…¾çš„æ„ä¹‰ä¹Ÿå°±åœ¨äºæ­¤å§ï¼Œå»æ¢ç©¶ç”µå­ä¸–ç•Œå¦‚ä½•è¿è¡Œçš„ã€‚</p>&mdash; HTTP 502 (@muzi_ii) <a href="https://twitter.com/muzi_ii/status/1175445308681015298?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">September 21, 2019</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>å’±åˆšæ¯•ä¸šé‚£ä¼šï¼Œè‡ªå·±ä¸€ä¸ªäººç”Ÿæ´»äº†ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿæ˜¯ä¸çŸ¥é“æ€ä¹ˆç»™è‡ªå·±æ‰¾ä¹è¶£å„¿ï¼Œæ•´å¤©ä¹Ÿæ˜¯å¾ˆæŠ‘éƒçš„ã€‚ä¸è¿‡åæ¥çœ‹äº† <a href="https://twitter.com/Philo2018" target="_blank" rel="noopener">Philo</a> åˆ†äº«çš„ <a href="https://twitter.com/Philo2018/status/1160151987654025218" target="_blank" rel="noopener">å¼€ä¸€ä¸ª thread åˆ†äº« #å¦‚ä½•å˜å¿«ä¹</a> tweet ä¹‹åå’±ä¹Ÿè¯•ç€æ”¹å˜è‡ªå·±çš„ç”Ÿæ´»æ€åº¦ã€‚ä¹Ÿå¼€å§‹ç»™è‡ªå·±æ‰¾å¿«ä¹ï¼Œä»¥å‰è¿½ä¸åˆ°è‡ªå·±å–œæ¬¢çš„å¥³ç”Ÿä¼šé—·é—·ä¸ä¹ï¼Œä½†æ…¢æ…¢åœ°è½¬å˜äº†è¿‡æ¥ã€‚è‡ªå·±æƒ³è¦å¿«ä¹è¿˜æ˜¯è¦è‡ªå·±åˆ¶é€ ï¼Œä¸èƒ½ä¾èµ–äºä»–äººï¼Œæ²¡æœ‰å¿…é¡»è¦å¾—åˆ°çš„ä¸œè¥¿ï¼Œä¹Ÿæ²¡æœ‰ä¸èƒ½æ— æ³•å¤±å»çš„ä¸œè¥¿ã€‚åªæœ‰è‡ªå·±ä¸ä¼šæŠ›å¼ƒè‡ªå·±ï¼Œæ‰€ä»¥ä¸€ä¸ªäººçš„å¿«ä¹è¦å­¦ä¼šä»è‡ªå·±èº«ä¸Šå‘æ˜ã€‚å¥½å¥‡å¿ƒä¿ƒä½¿ç€å’±å»å‘æ˜æ–°é²œäº‹ç‰©ï¼Œå»æ¢ç´¢æœªçŸ¥ä¸–ç•Œã€‚</p><p>ä»¥ä¸Šå°±æ˜¯å’±è‡ªå·±ä¸€ä¸ªäºº<code>ç©æ³¥å·´</code>æ—¶å€™çš„å¿«ä¹è°ƒå‰‚ï¼š<strong>å¥½å¥‡å¿ƒå’Œæ±‚çŸ¥æ¬²ï¼</strong></p><h3 id="Q10ï¼šæœ¨å­ã®å¿ƒæ„¿å•ï¼Ÿæœ€æƒ³æ”¶åˆ°çš„ä¸€ä»½ç¤¼ç‰©ï¼Ÿ"><a href="#Q10ï¼šæœ¨å­ã®å¿ƒæ„¿å•ï¼Ÿæœ€æƒ³æ”¶åˆ°çš„ä¸€ä»½ç¤¼ç‰©ï¼Ÿ" class="headerlink" title="Q10ï¼šæœ¨å­ã®å¿ƒæ„¿å•ï¼Ÿæœ€æƒ³æ”¶åˆ°çš„ä¸€ä»½ç¤¼ç‰©ï¼Ÿ"></a>Q10ï¼šæœ¨å­ã®å¿ƒæ„¿å•ï¼Ÿæœ€æƒ³æ”¶åˆ°çš„ä¸€ä»½ç¤¼ç‰©ï¼Ÿ</h3><ul><li><p>æœªæ¥èƒ½æ‹¥æœ‰å±äºè‡ªå·±çš„å°çªå’Œä¹¦æˆ¿ğŸ˜</p></li><li><p>ã€Šæ•°å­¦å¥³å­©4ï¼šéšæœºç®—æ³•ã€‹</p></li><li><p>ã€Šæ³•å¾‹ç«‹æ³•ä¸è‡ªç”±ã€‹</p></li><li><p>ã€Šæœ«æ—¥ä¸‰é—®ã€‹</p><p><code>åšä¸€ç”Ÿçš„æœ‹å‹åˆ¸</code> å‡ºè‡ªåŠ¨ç”» <a href="https://bgm.tv/subject/9912" target="_blank" rel="noopener">æ—¥å¸¸ nichijou</a> 25 è¯ğŸ˜„</p></li></ul><p><img src="img/nichijo.png" alt="img"></p><h2 id="end"><a href="#end" class="headerlink" title="end"></a>end</h2><p>å»æ‰äº†ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œå†…å®¹å°‘æœ‰ä¿®æ”¹~~</p><blockquote><p>  æ¯ä¸€ä¸ªå¹³å‡¡çš„æ—¥å¸¸éƒ½æ˜¯è¿ç»­å‘ç”Ÿä¸­çš„å¥‡è¿¹</p><p>  åƒè¿™æ ·ç§ç§å¾®å°çš„äº‹æƒ…åŠ èµ·æ¥ï¼Œæ‰å½¢æˆäº†ã€å½“ä¸‹ã€çš„æˆ‘ä»¬å•Š</p></blockquote><p>æ±æƒ³å’Œå’±ä»¥ç¬”è°ˆçš„æ–¹å¼äº¤æ¢é—®é¢˜ï¼Œæ¬¢è¿å•¦ğŸ˜‚ï¼Œå’±ä¼šè®¤çœŸå›å¤çš„ï¼‰å…¶å®ä¸‹ä¸€ä¸ªäººå’±å·²ç»æƒ³å¥½å•¦ğŸ˜‚</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;ç”±æ¥&quot;&gt;&lt;a href=&quot;#ç”±æ¥&quot;
        
      
    
    </summary>
    
    
      <category term="ç”Ÿæ´»" scheme="https://blog.k8s.li/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
      <category term="life" scheme="https://blog.k8s.li/tags/life/"/>
    
      <category term="ç¬”è°ˆ" scheme="https://blog.k8s.li/tags/%E7%AC%94%E8%B0%88/"/>
    
  </entry>
  
</feed>
